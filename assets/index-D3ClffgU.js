function wP(_,b){for(var I=0;I<b.length;I++){const z=b[I];if(typeof z!="string"&&!Array.isArray(z)){for(const B in z)if(B!=="default"&&!(B in _)){const $=Object.getOwnPropertyDescriptor(z,B);$&&Object.defineProperty(_,B,$.get?$:{enumerable:!0,get:()=>z[B]})}}}return Object.freeze(Object.defineProperty(_,Symbol.toStringTag,{value:"Module"}))}(function(){const b=document.createElement("link").relList;if(b&&b.supports&&b.supports("modulepreload"))return;for(const B of document.querySelectorAll('link[rel="modulepreload"]'))z(B);new MutationObserver(B=>{for(const $ of B)if($.type==="childList")for(const re of $.addedNodes)re.tagName==="LINK"&&re.rel==="modulepreload"&&z(re)}).observe(document,{childList:!0,subtree:!0});function I(B){const $={};return B.integrity&&($.integrity=B.integrity),B.referrerPolicy&&($.referrerPolicy=B.referrerPolicy),B.crossOrigin==="use-credentials"?$.credentials="include":B.crossOrigin==="anonymous"?$.credentials="omit":$.credentials="same-origin",$}function z(B){if(B.ep)return;B.ep=!0;const $=I(B);fetch(B.href,$)}})();function X_(_){return _&&_.__esModule&&Object.prototype.hasOwnProperty.call(_,"default")?_.default:_}var zv={exports:{}},ig={},kv={exports:{}},mi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _2;function bP(){if(_2)return mi;_2=1;var _=Symbol.for("react.element"),b=Symbol.for("react.portal"),I=Symbol.for("react.fragment"),z=Symbol.for("react.strict_mode"),B=Symbol.for("react.profiler"),$=Symbol.for("react.provider"),re=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),ce=Symbol.for("react.suspense"),be=Symbol.for("react.memo"),Se=Symbol.for("react.lazy"),Me=Symbol.iterator;function tt(rt){return rt===null||typeof rt!="object"?null:(rt=Me&&rt[Me]||rt["@@iterator"],typeof rt=="function"?rt:null)}var wt={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Xt=Object.assign,Be={};function ct(rt,Ot,Pr){this.props=rt,this.context=Ot,this.refs=Be,this.updater=Pr||wt}ct.prototype.isReactComponent={},ct.prototype.setState=function(rt,Ot){if(typeof rt!="object"&&typeof rt!="function"&&rt!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,rt,Ot,"setState")},ct.prototype.forceUpdate=function(rt){this.updater.enqueueForceUpdate(this,rt,"forceUpdate")};function Tt(){}Tt.prototype=ct.prototype;function Dt(rt,Ot,Pr){this.props=rt,this.context=Ot,this.refs=Be,this.updater=Pr||wt}var Vt=Dt.prototype=new Tt;Vt.constructor=Dt,Xt(Vt,ct.prototype),Vt.isPureReactComponent=!0;var jt=Array.isArray,vr=Object.prototype.hasOwnProperty,hr={current:null},Kt={key:!0,ref:!0,__self:!0,__source:!0};function Wt(rt,Ot,Pr){var Hr,br={},Br=null,Sr=null;if(Ot!=null)for(Hr in Ot.ref!==void 0&&(Sr=Ot.ref),Ot.key!==void 0&&(Br=""+Ot.key),Ot)vr.call(Ot,Hr)&&!Kt.hasOwnProperty(Hr)&&(br[Hr]=Ot[Hr]);var vn=arguments.length-2;if(vn===1)br.children=Pr;else if(1<vn){for(var Ar=Array(vn),Pi=0;Pi<vn;Pi++)Ar[Pi]=arguments[Pi+2];br.children=Ar}if(rt&&rt.defaultProps)for(Hr in vn=rt.defaultProps,vn)br[Hr]===void 0&&(br[Hr]=vn[Hr]);return{$$typeof:_,type:rt,key:Br,ref:Sr,props:br,_owner:hr.current}}function Cr(rt,Ot){return{$$typeof:_,type:rt.type,key:Ot,ref:rt.ref,props:rt.props,_owner:rt._owner}}function oi(rt){return typeof rt=="object"&&rt!==null&&rt.$$typeof===_}function fn(rt){var Ot={"=":"=0",":":"=2"};return"$"+rt.replace(/[=:]/g,function(Pr){return Ot[Pr]})}var ui=/\/+/g;function gr(rt,Ot){return typeof rt=="object"&&rt!==null&&rt.key!=null?fn(""+rt.key):Ot.toString(36)}function Mr(rt,Ot,Pr,Hr,br){var Br=typeof rt;(Br==="undefined"||Br==="boolean")&&(rt=null);var Sr=!1;if(rt===null)Sr=!0;else switch(Br){case"string":case"number":Sr=!0;break;case"object":switch(rt.$$typeof){case _:case b:Sr=!0}}if(Sr)return Sr=rt,br=br(Sr),rt=Hr===""?"."+gr(Sr,0):Hr,jt(br)?(Pr="",rt!=null&&(Pr=rt.replace(ui,"$&/")+"/"),Mr(br,Ot,Pr,"",function(Pi){return Pi})):br!=null&&(oi(br)&&(br=Cr(br,Pr+(!br.key||Sr&&Sr.key===br.key?"":(""+br.key).replace(ui,"$&/")+"/")+rt)),Ot.push(br)),1;if(Sr=0,Hr=Hr===""?".":Hr+":",jt(rt))for(var vn=0;vn<rt.length;vn++){Br=rt[vn];var Ar=Hr+gr(Br,vn);Sr+=Mr(Br,Ot,Pr,Ar,br)}else if(Ar=tt(rt),typeof Ar=="function")for(rt=Ar.call(rt),vn=0;!(Br=rt.next()).done;)Br=Br.value,Ar=Hr+gr(Br,vn++),Sr+=Mr(Br,Ot,Pr,Ar,br);else if(Br==="object")throw Ot=String(rt),Error("Objects are not valid as a React child (found: "+(Ot==="[object Object]"?"object with keys {"+Object.keys(rt).join(", ")+"}":Ot)+"). If you meant to render a collection of children, use an array instead.");return Sr}function rn(rt,Ot,Pr){if(rt==null)return rt;var Hr=[],br=0;return Mr(rt,Hr,"","",function(Br){return Ot.call(Pr,Br,br++)}),Hr}function nn(rt){if(rt._status===-1){var Ot=rt._result;Ot=Ot(),Ot.then(function(Pr){(rt._status===0||rt._status===-1)&&(rt._status=1,rt._result=Pr)},function(Pr){(rt._status===0||rt._status===-1)&&(rt._status=2,rt._result=Pr)}),rt._status===-1&&(rt._status=0,rt._result=Ot)}if(rt._status===1)return rt._result.default;throw rt._result}var un={current:null},At={transition:null},Tr={ReactCurrentDispatcher:un,ReactCurrentBatchConfig:At,ReactCurrentOwner:hr};function Ht(){throw Error("act(...) is not supported in production builds of React.")}return mi.Children={map:rn,forEach:function(rt,Ot,Pr){rn(rt,function(){Ot.apply(this,arguments)},Pr)},count:function(rt){var Ot=0;return rn(rt,function(){Ot++}),Ot},toArray:function(rt){return rn(rt,function(Ot){return Ot})||[]},only:function(rt){if(!oi(rt))throw Error("React.Children.only expected to receive a single React element child.");return rt}},mi.Component=ct,mi.Fragment=I,mi.Profiler=B,mi.PureComponent=Dt,mi.StrictMode=z,mi.Suspense=ce,mi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Tr,mi.act=Ht,mi.cloneElement=function(rt,Ot,Pr){if(rt==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+rt+".");var Hr=Xt({},rt.props),br=rt.key,Br=rt.ref,Sr=rt._owner;if(Ot!=null){if(Ot.ref!==void 0&&(Br=Ot.ref,Sr=hr.current),Ot.key!==void 0&&(br=""+Ot.key),rt.type&&rt.type.defaultProps)var vn=rt.type.defaultProps;for(Ar in Ot)vr.call(Ot,Ar)&&!Kt.hasOwnProperty(Ar)&&(Hr[Ar]=Ot[Ar]===void 0&&vn!==void 0?vn[Ar]:Ot[Ar])}var Ar=arguments.length-2;if(Ar===1)Hr.children=Pr;else if(1<Ar){vn=Array(Ar);for(var Pi=0;Pi<Ar;Pi++)vn[Pi]=arguments[Pi+2];Hr.children=vn}return{$$typeof:_,type:rt.type,key:br,ref:Br,props:Hr,_owner:Sr}},mi.createContext=function(rt){return rt={$$typeof:re,_currentValue:rt,_currentValue2:rt,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},rt.Provider={$$typeof:$,_context:rt},rt.Consumer=rt},mi.createElement=Wt,mi.createFactory=function(rt){var Ot=Wt.bind(null,rt);return Ot.type=rt,Ot},mi.createRef=function(){return{current:null}},mi.forwardRef=function(rt){return{$$typeof:s,render:rt}},mi.isValidElement=oi,mi.lazy=function(rt){return{$$typeof:Se,_payload:{_status:-1,_result:rt},_init:nn}},mi.memo=function(rt,Ot){return{$$typeof:be,type:rt,compare:Ot===void 0?null:Ot}},mi.startTransition=function(rt){var Ot=At.transition;At.transition={};try{rt()}finally{At.transition=Ot}},mi.unstable_act=Ht,mi.useCallback=function(rt,Ot){return un.current.useCallback(rt,Ot)},mi.useContext=function(rt){return un.current.useContext(rt)},mi.useDebugValue=function(){},mi.useDeferredValue=function(rt){return un.current.useDeferredValue(rt)},mi.useEffect=function(rt,Ot){return un.current.useEffect(rt,Ot)},mi.useId=function(){return un.current.useId()},mi.useImperativeHandle=function(rt,Ot,Pr){return un.current.useImperativeHandle(rt,Ot,Pr)},mi.useInsertionEffect=function(rt,Ot){return un.current.useInsertionEffect(rt,Ot)},mi.useLayoutEffect=function(rt,Ot){return un.current.useLayoutEffect(rt,Ot)},mi.useMemo=function(rt,Ot){return un.current.useMemo(rt,Ot)},mi.useReducer=function(rt,Ot,Pr){return un.current.useReducer(rt,Ot,Pr)},mi.useRef=function(rt){return un.current.useRef(rt)},mi.useState=function(rt){return un.current.useState(rt)},mi.useSyncExternalStore=function(rt,Ot,Pr){return un.current.useSyncExternalStore(rt,Ot,Pr)},mi.useTransition=function(){return un.current.useTransition()},mi.version="18.3.1",mi}var y2;function Lx(){return y2||(y2=1,kv.exports=bP()),kv.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v2;function TP(){if(v2)return ig;v2=1;var _=Lx(),b=Symbol.for("react.element"),I=Symbol.for("react.fragment"),z=Object.prototype.hasOwnProperty,B=_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,$={key:!0,ref:!0,__self:!0,__source:!0};function re(s,ce,be){var Se,Me={},tt=null,wt=null;be!==void 0&&(tt=""+be),ce.key!==void 0&&(tt=""+ce.key),ce.ref!==void 0&&(wt=ce.ref);for(Se in ce)z.call(ce,Se)&&!$.hasOwnProperty(Se)&&(Me[Se]=ce[Se]);if(s&&s.defaultProps)for(Se in ce=s.defaultProps,ce)Me[Se]===void 0&&(Me[Se]=ce[Se]);return{$$typeof:b,type:s,key:tt,ref:wt,props:Me,_owner:B.current}}return ig.Fragment=I,ig.jsx=re,ig.jsxs=re,ig}var x2;function SP(){return x2||(x2=1,zv.exports=TP()),zv.exports}var H=SP(),Fe=Lx();const Nr=X_(Fe),Ox=wP({__proto__:null,default:Nr},[Fe]);var E_={},Dv={exports:{}},al={},Lv={exports:{}},Ov={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var w2;function EP(){return w2||(w2=1,function(_){function b(At,Tr){var Ht=At.length;At.push(Tr);e:for(;0<Ht;){var rt=Ht-1>>>1,Ot=At[rt];if(0<B(Ot,Tr))At[rt]=Tr,At[Ht]=Ot,Ht=rt;else break e}}function I(At){return At.length===0?null:At[0]}function z(At){if(At.length===0)return null;var Tr=At[0],Ht=At.pop();if(Ht!==Tr){At[0]=Ht;e:for(var rt=0,Ot=At.length,Pr=Ot>>>1;rt<Pr;){var Hr=2*(rt+1)-1,br=At[Hr],Br=Hr+1,Sr=At[Br];if(0>B(br,Ht))Br<Ot&&0>B(Sr,br)?(At[rt]=Sr,At[Br]=Ht,rt=Br):(At[rt]=br,At[Hr]=Ht,rt=Hr);else if(Br<Ot&&0>B(Sr,Ht))At[rt]=Sr,At[Br]=Ht,rt=Br;else break e}}return Tr}function B(At,Tr){var Ht=At.sortIndex-Tr.sortIndex;return Ht!==0?Ht:At.id-Tr.id}if(typeof performance=="object"&&typeof performance.now=="function"){var $=performance;_.unstable_now=function(){return $.now()}}else{var re=Date,s=re.now();_.unstable_now=function(){return re.now()-s}}var ce=[],be=[],Se=1,Me=null,tt=3,wt=!1,Xt=!1,Be=!1,ct=typeof setTimeout=="function"?setTimeout:null,Tt=typeof clearTimeout=="function"?clearTimeout:null,Dt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Vt(At){for(var Tr=I(be);Tr!==null;){if(Tr.callback===null)z(be);else if(Tr.startTime<=At)z(be),Tr.sortIndex=Tr.expirationTime,b(ce,Tr);else break;Tr=I(be)}}function jt(At){if(Be=!1,Vt(At),!Xt)if(I(ce)!==null)Xt=!0,nn(vr);else{var Tr=I(be);Tr!==null&&un(jt,Tr.startTime-At)}}function vr(At,Tr){Xt=!1,Be&&(Be=!1,Tt(Wt),Wt=-1),wt=!0;var Ht=tt;try{for(Vt(Tr),Me=I(ce);Me!==null&&(!(Me.expirationTime>Tr)||At&&!fn());){var rt=Me.callback;if(typeof rt=="function"){Me.callback=null,tt=Me.priorityLevel;var Ot=rt(Me.expirationTime<=Tr);Tr=_.unstable_now(),typeof Ot=="function"?Me.callback=Ot:Me===I(ce)&&z(ce),Vt(Tr)}else z(ce);Me=I(ce)}if(Me!==null)var Pr=!0;else{var Hr=I(be);Hr!==null&&un(jt,Hr.startTime-Tr),Pr=!1}return Pr}finally{Me=null,tt=Ht,wt=!1}}var hr=!1,Kt=null,Wt=-1,Cr=5,oi=-1;function fn(){return!(_.unstable_now()-oi<Cr)}function ui(){if(Kt!==null){var At=_.unstable_now();oi=At;var Tr=!0;try{Tr=Kt(!0,At)}finally{Tr?gr():(hr=!1,Kt=null)}}else hr=!1}var gr;if(typeof Dt=="function")gr=function(){Dt(ui)};else if(typeof MessageChannel<"u"){var Mr=new MessageChannel,rn=Mr.port2;Mr.port1.onmessage=ui,gr=function(){rn.postMessage(null)}}else gr=function(){ct(ui,0)};function nn(At){Kt=At,hr||(hr=!0,gr())}function un(At,Tr){Wt=ct(function(){At(_.unstable_now())},Tr)}_.unstable_IdlePriority=5,_.unstable_ImmediatePriority=1,_.unstable_LowPriority=4,_.unstable_NormalPriority=3,_.unstable_Profiling=null,_.unstable_UserBlockingPriority=2,_.unstable_cancelCallback=function(At){At.callback=null},_.unstable_continueExecution=function(){Xt||wt||(Xt=!0,nn(vr))},_.unstable_forceFrameRate=function(At){0>At||125<At?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Cr=0<At?Math.floor(1e3/At):5},_.unstable_getCurrentPriorityLevel=function(){return tt},_.unstable_getFirstCallbackNode=function(){return I(ce)},_.unstable_next=function(At){switch(tt){case 1:case 2:case 3:var Tr=3;break;default:Tr=tt}var Ht=tt;tt=Tr;try{return At()}finally{tt=Ht}},_.unstable_pauseExecution=function(){},_.unstable_requestPaint=function(){},_.unstable_runWithPriority=function(At,Tr){switch(At){case 1:case 2:case 3:case 4:case 5:break;default:At=3}var Ht=tt;tt=At;try{return Tr()}finally{tt=Ht}},_.unstable_scheduleCallback=function(At,Tr,Ht){var rt=_.unstable_now();switch(typeof Ht=="object"&&Ht!==null?(Ht=Ht.delay,Ht=typeof Ht=="number"&&0<Ht?rt+Ht:rt):Ht=rt,At){case 1:var Ot=-1;break;case 2:Ot=250;break;case 5:Ot=1073741823;break;case 4:Ot=1e4;break;default:Ot=5e3}return Ot=Ht+Ot,At={id:Se++,callback:Tr,priorityLevel:At,startTime:Ht,expirationTime:Ot,sortIndex:-1},Ht>rt?(At.sortIndex=Ht,b(be,At),I(ce)===null&&At===I(be)&&(Be?(Tt(Wt),Wt=-1):Be=!0,un(jt,Ht-rt))):(At.sortIndex=Ot,b(ce,At),Xt||wt||(Xt=!0,nn(vr))),At},_.unstable_shouldYield=fn,_.unstable_wrapCallback=function(At){var Tr=tt;return function(){var Ht=tt;tt=Tr;try{return At.apply(this,arguments)}finally{tt=Ht}}}}(Ov)),Ov}var b2;function IP(){return b2||(b2=1,Lv.exports=EP()),Lv.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var T2;function AP(){if(T2)return al;T2=1;var _=Lx(),b=IP();function I(d){for(var p="https://reactjs.org/docs/error-decoder.html?invariant="+d,T=1;T<arguments.length;T++)p+="&args[]="+encodeURIComponent(arguments[T]);return"Minified React error #"+d+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var z=new Set,B={};function $(d,p){re(d,p),re(d+"Capture",p)}function re(d,p){for(B[d]=p,d=0;d<p.length;d++)z.add(p[d])}var s=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ce=Object.prototype.hasOwnProperty,be=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Se={},Me={};function tt(d){return ce.call(Me,d)?!0:ce.call(Se,d)?!1:be.test(d)?Me[d]=!0:(Se[d]=!0,!1)}function wt(d,p,T,R){if(T!==null&&T.type===0)return!1;switch(typeof p){case"function":case"symbol":return!0;case"boolean":return R?!1:T!==null?!T.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function Xt(d,p,T,R){if(p===null||typeof p>"u"||wt(d,p,T,R))return!0;if(R)return!1;if(T!==null)switch(T.type){case 3:return!p;case 4:return p===!1;case 5:return isNaN(p);case 6:return isNaN(p)||1>p}return!1}function Be(d,p,T,R,N,Z,de){this.acceptsBooleans=p===2||p===3||p===4,this.attributeName=R,this.attributeNamespace=N,this.mustUseProperty=T,this.propertyName=d,this.type=p,this.sanitizeURL=Z,this.removeEmptyString=de}var ct={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){ct[d]=new Be(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var p=d[0];ct[p]=new Be(p,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){ct[d]=new Be(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){ct[d]=new Be(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){ct[d]=new Be(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){ct[d]=new Be(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){ct[d]=new Be(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){ct[d]=new Be(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){ct[d]=new Be(d,5,!1,d.toLowerCase(),null,!1,!1)});var Tt=/[\-:]([a-z])/g;function Dt(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var p=d.replace(Tt,Dt);ct[p]=new Be(p,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var p=d.replace(Tt,Dt);ct[p]=new Be(p,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var p=d.replace(Tt,Dt);ct[p]=new Be(p,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){ct[d]=new Be(d,1,!1,d.toLowerCase(),null,!1,!1)}),ct.xlinkHref=new Be("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){ct[d]=new Be(d,1,!1,d.toLowerCase(),null,!0,!0)});function Vt(d,p,T,R){var N=ct.hasOwnProperty(p)?ct[p]:null;(N!==null?N.type!==0:R||!(2<p.length)||p[0]!=="o"&&p[0]!=="O"||p[1]!=="n"&&p[1]!=="N")&&(Xt(p,T,N,R)&&(T=null),R||N===null?tt(p)&&(T===null?d.removeAttribute(p):d.setAttribute(p,""+T)):N.mustUseProperty?d[N.propertyName]=T===null?N.type===3?!1:"":T:(p=N.attributeName,R=N.attributeNamespace,T===null?d.removeAttribute(p):(N=N.type,T=N===3||N===4&&T===!0?"":""+T,R?d.setAttributeNS(R,p,T):d.setAttribute(p,T))))}var jt=_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,vr=Symbol.for("react.element"),hr=Symbol.for("react.portal"),Kt=Symbol.for("react.fragment"),Wt=Symbol.for("react.strict_mode"),Cr=Symbol.for("react.profiler"),oi=Symbol.for("react.provider"),fn=Symbol.for("react.context"),ui=Symbol.for("react.forward_ref"),gr=Symbol.for("react.suspense"),Mr=Symbol.for("react.suspense_list"),rn=Symbol.for("react.memo"),nn=Symbol.for("react.lazy"),un=Symbol.for("react.offscreen"),At=Symbol.iterator;function Tr(d){return d===null||typeof d!="object"?null:(d=At&&d[At]||d["@@iterator"],typeof d=="function"?d:null)}var Ht=Object.assign,rt;function Ot(d){if(rt===void 0)try{throw Error()}catch(T){var p=T.stack.trim().match(/\n( *(at )?)/);rt=p&&p[1]||""}return`
`+rt+d}var Pr=!1;function Hr(d,p){if(!d||Pr)return"";Pr=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(p)if(p=function(){throw Error()},Object.defineProperty(p.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(p,[])}catch(_t){var R=_t}Reflect.construct(d,[],p)}else{try{p.call()}catch(_t){R=_t}d.call(p.prototype)}else{try{throw Error()}catch(_t){R=_t}d()}}catch(_t){if(_t&&R&&typeof _t.stack=="string"){for(var N=_t.stack.split(`
`),Z=R.stack.split(`
`),de=N.length-1,De=Z.length-1;1<=de&&0<=De&&N[de]!==Z[De];)De--;for(;1<=de&&0<=De;de--,De--)if(N[de]!==Z[De]){if(de!==1||De!==1)do if(de--,De--,0>De||N[de]!==Z[De]){var Ge=`
`+N[de].replace(" at new "," at ");return d.displayName&&Ge.includes("<anonymous>")&&(Ge=Ge.replace("<anonymous>",d.displayName)),Ge}while(1<=de&&0<=De);break}}}finally{Pr=!1,Error.prepareStackTrace=T}return(d=d?d.displayName||d.name:"")?Ot(d):""}function br(d){switch(d.tag){case 5:return Ot(d.type);case 16:return Ot("Lazy");case 13:return Ot("Suspense");case 19:return Ot("SuspenseList");case 0:case 2:case 15:return d=Hr(d.type,!1),d;case 11:return d=Hr(d.type.render,!1),d;case 1:return d=Hr(d.type,!0),d;default:return""}}function Br(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case Kt:return"Fragment";case hr:return"Portal";case Cr:return"Profiler";case Wt:return"StrictMode";case gr:return"Suspense";case Mr:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case fn:return(d.displayName||"Context")+".Consumer";case oi:return(d._context.displayName||"Context")+".Provider";case ui:var p=d.render;return d=d.displayName,d||(d=p.displayName||p.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case rn:return p=d.displayName||null,p!==null?p:Br(d.type)||"Memo";case nn:p=d._payload,d=d._init;try{return Br(d(p))}catch{}}return null}function Sr(d){var p=d.type;switch(d.tag){case 24:return"Cache";case 9:return(p.displayName||"Context")+".Consumer";case 10:return(p._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=p.render,d=d.displayName||d.name||"",p.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return p;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Br(p);case 8:return p===Wt?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p}return null}function vn(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function Ar(d){var p=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(p==="checkbox"||p==="radio")}function Pi(d){var p=Ar(d)?"checked":"value",T=Object.getOwnPropertyDescriptor(d.constructor.prototype,p),R=""+d[p];if(!d.hasOwnProperty(p)&&typeof T<"u"&&typeof T.get=="function"&&typeof T.set=="function"){var N=T.get,Z=T.set;return Object.defineProperty(d,p,{configurable:!0,get:function(){return N.call(this)},set:function(de){R=""+de,Z.call(this,de)}}),Object.defineProperty(d,p,{enumerable:T.enumerable}),{getValue:function(){return R},setValue:function(de){R=""+de},stopTracking:function(){d._valueTracker=null,delete d[p]}}}}function qi(d){d._valueTracker||(d._valueTracker=Pi(d))}function us(d){if(!d)return!1;var p=d._valueTracker;if(!p)return!0;var T=p.getValue(),R="";return d&&(R=Ar(d)?d.checked?"true":"false":d.value),d=R,d!==T?(p.setValue(d),!0):!1}function vi(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function xn(d,p){var T=p.checked;return Ht({},p,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:T??d._wrapperState.initialChecked})}function aa(d,p){var T=p.defaultValue==null?"":p.defaultValue,R=p.checked!=null?p.checked:p.defaultChecked;T=vn(p.value!=null?p.value:T),d._wrapperState={initialChecked:R,initialValue:T,controlled:p.type==="checkbox"||p.type==="radio"?p.checked!=null:p.value!=null}}function hs(d,p){p=p.checked,p!=null&&Vt(d,"checked",p,!1)}function Ho(d,p){hs(d,p);var T=vn(p.value),R=p.type;if(T!=null)R==="number"?(T===0&&d.value===""||d.value!=T)&&(d.value=""+T):d.value!==""+T&&(d.value=""+T);else if(R==="submit"||R==="reset"){d.removeAttribute("value");return}p.hasOwnProperty("value")?ds(d,p.type,T):p.hasOwnProperty("defaultValue")&&ds(d,p.type,vn(p.defaultValue)),p.checked==null&&p.defaultChecked!=null&&(d.defaultChecked=!!p.defaultChecked)}function Ul(d,p,T){if(p.hasOwnProperty("value")||p.hasOwnProperty("defaultValue")){var R=p.type;if(!(R!=="submit"&&R!=="reset"||p.value!==void 0&&p.value!==null))return;p=""+d._wrapperState.initialValue,T||p===d.value||(d.value=p),d.defaultValue=p}T=d.name,T!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,T!==""&&(d.name=T)}function ds(d,p,T){(p!=="number"||vi(d.ownerDocument)!==d)&&(T==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+T&&(d.defaultValue=""+T))}var Oi=Array.isArray;function Zs(d,p,T,R){if(d=d.options,p){p={};for(var N=0;N<T.length;N++)p["$"+T[N]]=!0;for(T=0;T<d.length;T++)N=p.hasOwnProperty("$"+d[T].value),d[T].selected!==N&&(d[T].selected=N),N&&R&&(d[T].defaultSelected=!0)}else{for(T=""+vn(T),p=null,N=0;N<d.length;N++){if(d[N].value===T){d[N].selected=!0,R&&(d[N].defaultSelected=!0);return}p!==null||d[N].disabled||(p=d[N])}p!==null&&(p.selected=!0)}}function la(d,p){if(p.dangerouslySetInnerHTML!=null)throw Error(I(91));return Ht({},p,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function ho(d,p){var T=p.value;if(T==null){if(T=p.children,p=p.defaultValue,T!=null){if(p!=null)throw Error(I(92));if(Oi(T)){if(1<T.length)throw Error(I(93));T=T[0]}p=T}p==null&&(p=""),T=p}d._wrapperState={initialValue:vn(T)}}function xs(d,p){var T=vn(p.value),R=vn(p.defaultValue);T!=null&&(T=""+T,T!==d.value&&(d.value=T),p.defaultValue==null&&d.defaultValue!==T&&(d.defaultValue=T)),R!=null&&(d.defaultValue=""+R)}function Oa(d){var p=d.textContent;p===d._wrapperState.initialValue&&p!==""&&p!==null&&(d.value=p)}function hl(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ks(d,p){return d==null||d==="http://www.w3.org/1999/xhtml"?hl(p):d==="http://www.w3.org/2000/svg"&&p==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var Wo,ca=function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(p,T,R,N){MSApp.execUnsafeLocalFunction(function(){return d(p,T,R,N)})}:d}(function(d,p){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=p;else{for(Wo=Wo||document.createElement("div"),Wo.innerHTML="<svg>"+p.valueOf().toString()+"</svg>",p=Wo.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;p.firstChild;)d.appendChild(p.firstChild)}});function Zo(d,p){if(p){var T=d.firstChild;if(T&&T===d.lastChild&&T.nodeType===3){T.nodeValue=p;return}}d.textContent=p}var Hi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ds=["Webkit","ms","Moz","O"];Object.keys(Hi).forEach(function(d){Ds.forEach(function(p){p=p+d.charAt(0).toUpperCase()+d.substring(1),Hi[p]=Hi[d]})});function wa(d,p,T){return p==null||typeof p=="boolean"||p===""?"":T||typeof p!="number"||p===0||Hi.hasOwnProperty(d)&&Hi[d]?(""+p).trim():p+"px"}function ba(d,p){d=d.style;for(var T in p)if(p.hasOwnProperty(T)){var R=T.indexOf("--")===0,N=wa(T,p[T],R);T==="float"&&(T="cssFloat"),R?d.setProperty(T,N):d[T]=N}}var dl=Ht({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ua(d,p){if(p){if(dl[d]&&(p.children!=null||p.dangerouslySetInnerHTML!=null))throw Error(I(137,d));if(p.dangerouslySetInnerHTML!=null){if(p.children!=null)throw Error(I(60));if(typeof p.dangerouslySetInnerHTML!="object"||!("__html"in p.dangerouslySetInnerHTML))throw Error(I(61))}if(p.style!=null&&typeof p.style!="object")throw Error(I(62))}}function Fa(d,p){if(d.indexOf("-")===-1)return typeof p.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Un=null;function Qr(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var Wn=null,In=null,Nn=null;function Ri(d){if(d=zh(d)){if(typeof Wn!="function")throw Error(I(280));var p=d.stateNode;p&&(p=qc(p),Wn(d.stateNode,d.type,p))}}function Wi(d){In?Nn?Nn.push(d):Nn=[d]:In=d}function ft(){if(In){var d=In,p=Nn;if(Nn=In=null,Ri(d),p)for(d=0;d<p.length;d++)Ri(p[d])}}function ws(d,p){return d(p)}function Xs(){}var fo=!1;function en(d,p,T){if(fo)return d(p,T);fo=!0;try{return ws(d,p,T)}finally{fo=!1,(In!==null||Nn!==null)&&(Xs(),ft())}}function Oe(d,p){var T=d.stateNode;if(T===null)return null;var R=qc(T);if(R===null)return null;T=R[p];e:switch(p){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(R=!R.disabled)||(d=d.type,R=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!R;break e;default:d=!1}if(d)return null;if(T&&typeof T!="function")throw Error(I(231,p,typeof T));return T}var Y=!1;if(s)try{var Q={};Object.defineProperty(Q,"passive",{get:function(){Y=!0}}),window.addEventListener("test",Q,Q),window.removeEventListener("test",Q,Q)}catch{Y=!1}function he(d,p,T,R,N,Z,de,De,Ge){var _t=Array.prototype.slice.call(arguments,3);try{p.apply(T,_t)}catch(tr){this.onError(tr)}}var we=!1,me=null,Ae=!1,Ne=null,Ce={onError:function(d){we=!0,me=d}};function je(d,p,T,R,N,Z,de,De,Ge){we=!1,me=null,he.apply(Ce,arguments)}function nt(d,p,T,R,N,Z,de,De,Ge){if(je.apply(this,arguments),we){if(we){var _t=me;we=!1,me=null}else throw Error(I(198));Ae||(Ae=!0,Ne=_t)}}function Ue(d){var p=d,T=d;if(d.alternate)for(;p.return;)p=p.return;else{d=p;do p=d,(p.flags&4098)!==0&&(T=p.return),d=p.return;while(d)}return p.tag===3?T:null}function Et(d){if(d.tag===13){var p=d.memoizedState;if(p===null&&(d=d.alternate,d!==null&&(p=d.memoizedState)),p!==null)return p.dehydrated}return null}function $t(d){if(Ue(d)!==d)throw Error(I(188))}function Yt(d){var p=d.alternate;if(!p){if(p=Ue(d),p===null)throw Error(I(188));return p!==d?null:d}for(var T=d,R=p;;){var N=T.return;if(N===null)break;var Z=N.alternate;if(Z===null){if(R=N.return,R!==null){T=R;continue}break}if(N.child===Z.child){for(Z=N.child;Z;){if(Z===T)return $t(N),d;if(Z===R)return $t(N),p;Z=Z.sibling}throw Error(I(188))}if(T.return!==R.return)T=N,R=Z;else{for(var de=!1,De=N.child;De;){if(De===T){de=!0,T=N,R=Z;break}if(De===R){de=!0,R=N,T=Z;break}De=De.sibling}if(!de){for(De=Z.child;De;){if(De===T){de=!0,T=Z,R=N;break}if(De===R){de=!0,R=Z,T=N;break}De=De.sibling}if(!de)throw Error(I(189))}}if(T.alternate!==R)throw Error(I(190))}if(T.tag!==3)throw Error(I(188));return T.stateNode.current===T?d:p}function mr(d){return d=Yt(d),d!==null?_r(d):null}function _r(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var p=_r(d);if(p!==null)return p;d=d.sibling}return null}var xr=b.unstable_scheduleCallback,$r=b.unstable_cancelCallback,Rr=b.unstable_shouldYield,jn=b.unstable_requestPaint,on=b.unstable_now,ti=b.unstable_getCurrentPriorityLevel,An=b.unstable_ImmediatePriority,bn=b.unstable_UserBlockingPriority,gi=b.unstable_NormalPriority,xi=b.unstable_LowPriority,hi=b.unstable_IdlePriority,Zi=null,Ui=null;function $s(d){if(Ui&&typeof Ui.onCommitFiberRoot=="function")try{Ui.onCommitFiberRoot(Zi,d,void 0,(d.current.flags&128)===128)}catch{}}var po=Math.clz32?Math.clz32:ad,bs=Math.log,$l=Math.LN2;function ad(d){return d>>>=0,d===0?32:31-(bs(d)/$l|0)|0}var Gl=64,ql=4194304;function Hl(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function Ic(d,p){var T=d.pendingLanes;if(T===0)return 0;var R=0,N=d.suspendedLanes,Z=d.pingedLanes,de=T&268435455;if(de!==0){var De=de&~N;De!==0?R=Hl(De):(Z&=de,Z!==0&&(R=Hl(Z)))}else de=T&~N,de!==0?R=Hl(de):Z!==0&&(R=Hl(Z));if(R===0)return 0;if(p!==0&&p!==R&&(p&N)===0&&(N=R&-R,Z=p&-p,N>=Z||N===16&&(Z&4194240)!==0))return p;if((R&4)!==0&&(R|=T&16),p=d.entangledLanes,p!==0)for(d=d.entanglements,p&=R;0<p;)T=31-po(p),N=1<<T,R|=d[T],p&=~N;return R}function Ac(d,p){switch(d){case 1:case 2:case 4:return p+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function dh(d,p){for(var T=d.suspendedLanes,R=d.pingedLanes,N=d.expirationTimes,Z=d.pendingLanes;0<Z;){var de=31-po(Z),De=1<<de,Ge=N[de];Ge===-1?((De&T)===0||(De&R)!==0)&&(N[de]=Ac(De,p)):Ge<=p&&(d.expiredLanes|=De),Z&=~De}}function _u(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function ha(){var d=Gl;return Gl<<=1,(Gl&4194240)===0&&(Gl=64),d}function mo(d){for(var p=[],T=0;31>T;T++)p.push(d);return p}function Ys(d,p,T){d.pendingLanes|=p,p!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,p=31-po(p),d[p]=T}function fl(d,p){var T=d.pendingLanes&~p;d.pendingLanes=p,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=p,d.mutableReadLanes&=p,d.entangledLanes&=p,p=d.entanglements;var R=d.eventTimes;for(d=d.expirationTimes;0<T;){var N=31-po(T),Z=1<<N;p[N]=0,R[N]=-1,d[N]=-1,T&=~Z}}function Xo(d,p){var T=d.entangledLanes|=p;for(d=d.entanglements;T;){var R=31-po(T),N=1<<R;N&p|d[R]&p&&(d[R]|=p),T&=~N}}var Yn=0;function yu(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var Ta,Cc,Wl,Mc,ld,fh=!1,Ls=[],Co=null,da=null,Yo=null,vu=new Map,xu=new Map,fa=[],gn="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ph(d,p){switch(d){case"focusin":case"focusout":Co=null;break;case"dragenter":case"dragleave":da=null;break;case"mouseover":case"mouseout":Yo=null;break;case"pointerover":case"pointerout":vu.delete(p.pointerId);break;case"gotpointercapture":case"lostpointercapture":xu.delete(p.pointerId)}}function Na(d,p,T,R,N,Z){return d===null||d.nativeEvent!==Z?(d={blockedOn:p,domEventName:T,eventSystemFlags:R,nativeEvent:Z,targetContainers:[N]},p!==null&&(p=zh(p),p!==null&&Cc(p)),d):(d.eventSystemFlags|=R,p=d.targetContainers,N!==null&&p.indexOf(N)===-1&&p.push(N),d)}function mh(d,p,T,R,N){switch(p){case"focusin":return Co=Na(Co,d,p,T,R,N),!0;case"dragenter":return da=Na(da,d,p,T,R,N),!0;case"mouseover":return Yo=Na(Yo,d,p,T,R,N),!0;case"pointerover":var Z=N.pointerId;return vu.set(Z,Na(vu.get(Z)||null,d,p,T,R,N)),!0;case"gotpointercapture":return Z=N.pointerId,xu.set(Z,Na(xu.get(Z)||null,d,p,T,R,N)),!0}return!1}function vp(d){var p=Gc(d.target);if(p!==null){var T=Ue(p);if(T!==null){if(p=T.tag,p===13){if(p=Et(T),p!==null){d.blockedOn=p,ld(d.priority,function(){Wl(T)});return}}else if(p===3&&T.stateNode.current.memoizedState.isDehydrated){d.blockedOn=T.tag===3?T.stateNode.containerInfo:null;return}}}d.blockedOn=null}function Zl(d){if(d.blockedOn!==null)return!1;for(var p=d.targetContainers;0<p.length;){var T=zc(d.domEventName,d.eventSystemFlags,p[0],d.nativeEvent);if(T===null){T=d.nativeEvent;var R=new T.constructor(T.type,T);Un=R,T.target.dispatchEvent(R),Un=null}else return p=zh(T),p!==null&&Cc(p),d.blockedOn=T,!1;p.shift()}return!0}function Xl(d,p,T){Zl(d)&&T.delete(p)}function Yl(){fh=!1,Co!==null&&Zl(Co)&&(Co=null),da!==null&&Zl(da)&&(da=null),Yo!==null&&Zl(Yo)&&(Yo=null),vu.forEach(Xl),xu.forEach(Xl)}function Pc(d,p){d.blockedOn===p&&(d.blockedOn=null,fh||(fh=!0,b.unstable_scheduleCallback(b.unstable_NormalPriority,Yl)))}function Rc(d){function p(N){return Pc(N,d)}if(0<Ls.length){Pc(Ls[0],d);for(var T=1;T<Ls.length;T++){var R=Ls[T];R.blockedOn===d&&(R.blockedOn=null)}}for(Co!==null&&Pc(Co,d),da!==null&&Pc(da,d),Yo!==null&&Pc(Yo,d),vu.forEach(p),xu.forEach(p),T=0;T<fa.length;T++)R=fa[T],R.blockedOn===d&&(R.blockedOn=null);for(;0<fa.length&&(T=fa[0],T.blockedOn===null);)vp(T),T.blockedOn===null&&fa.shift()}var pa=jt.ReactCurrentBatchConfig,gh=!0;function pl(d,p,T,R){var N=Yn,Z=pa.transition;pa.transition=null;try{Yn=1,wu(d,p,T,R)}finally{Yn=N,pa.transition=Z}}function cd(d,p,T,R){var N=Yn,Z=pa.transition;pa.transition=null;try{Yn=4,wu(d,p,T,R)}finally{Yn=N,pa.transition=Z}}function wu(d,p,T,R){if(gh){var N=zc(d,p,T,R);if(N===null)vd(d,p,R,Mo,T),ph(d,R);else if(mh(N,d,p,T,R))R.stopPropagation();else if(ph(d,R),p&4&&-1<gn.indexOf(d)){for(;N!==null;){var Z=zh(N);if(Z!==null&&Ta(Z),Z=zc(d,p,T,R),Z===null&&vd(d,p,R,Mo,T),Z===N)break;N=Z}N!==null&&R.stopPropagation()}else vd(d,p,R,null,T)}}var Mo=null;function zc(d,p,T,R){if(Mo=null,d=Qr(R),d=Gc(d),d!==null)if(p=Ue(d),p===null)d=null;else if(T=p.tag,T===13){if(d=Et(p),d!==null)return d;d=null}else if(T===3){if(p.stateNode.current.memoizedState.isDehydrated)return p.tag===3?p.stateNode.containerInfo:null;d=null}else p!==d&&(d=null);return Mo=d,null}function Kl(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ti()){case An:return 1;case bn:return 4;case gi:case xi:return 16;case hi:return 536870912;default:return 16}default:return 16}}var Sa=null,_h=null,kc=null;function Jl(){if(kc)return kc;var d,p=_h,T=p.length,R,N="value"in Sa?Sa.value:Sa.textContent,Z=N.length;for(d=0;d<T&&p[d]===N[d];d++);var de=T-d;for(R=1;R<=de&&p[T-R]===N[Z-R];R++);return kc=N.slice(d,1<R?1-R:void 0)}function Gs(d){var p=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&p===13&&(d=13)):d=p,d===10&&(d=13),32<=d||d===13?d:0}function bu(){return!0}function Dc(){return!1}function Ts(d){function p(T,R,N,Z,de){this._reactName=T,this._targetInst=N,this.type=R,this.nativeEvent=Z,this.target=de,this.currentTarget=null;for(var De in d)d.hasOwnProperty(De)&&(T=d[De],this[De]=T?T(Z):Z[De]);return this.isDefaultPrevented=(Z.defaultPrevented!=null?Z.defaultPrevented:Z.returnValue===!1)?bu:Dc,this.isPropagationStopped=Dc,this}return Ht(p.prototype,{preventDefault:function(){this.defaultPrevented=!0;var T=this.nativeEvent;T&&(T.preventDefault?T.preventDefault():typeof T.returnValue!="unknown"&&(T.returnValue=!1),this.isDefaultPrevented=bu)},stopPropagation:function(){var T=this.nativeEvent;T&&(T.stopPropagation?T.stopPropagation():typeof T.cancelBubble!="unknown"&&(T.cancelBubble=!0),this.isPropagationStopped=bu)},persist:function(){},isPersistent:bu}),p}var _n={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ko=Ts(_n),yh=Ht({},_n,{view:0,detail:0}),_f=Ts(yh),lr,Tu,ml,Ba=Ht({},yh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ql,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==ml&&(ml&&d.type==="mousemove"?(lr=d.screenX-ml.screenX,Tu=d.screenY-ml.screenY):Tu=lr=0,ml=d),lr)},movementY:function(d){return"movementY"in d?d.movementY:Tu}}),Po=Ts(Ba),yf=Ht({},Ba,{dataTransfer:0}),Su=Ts(yf),Qt=Ht({},yh,{relatedTarget:0}),Pn=Ts(Qt),Cn=Ht({},_n,{animationName:0,elapsedTime:0,pseudoElement:0}),Ro=Ts(Cn),gl=Ht({},_n,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),Rn=Ts(gl),ud=Ht({},_n,{data:0}),Eu=Ts(ud),vh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ks={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$i={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mm(d){var p=this.nativeEvent;return p.getModifierState?p.getModifierState(d):(d=$i[d])?!!p[d]:!1}function Ql(){return mm}var ec=Ht({},yh,{key:function(d){if(d.key){var p=vh[d.key]||d.key;if(p!=="Unidentified")return p}return d.type==="keypress"?(d=Gs(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?Ks[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ql,charCode:function(d){return d.type==="keypress"?Gs(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?Gs(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),xh=Ts(ec),hd=Ht({},Ba,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Iu=Ts(hd),dd=Ht({},yh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ql}),Js=Ts(dd),_l=Ht({},_n,{propertyName:0,elapsedTime:0,pseudoElement:0}),go=Ts(_l),Lc=Ht({},Ba,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),Gr=Ts(Lc),Bt=[9,13,27,32],zo=s&&"CompositionEvent"in window,ur=null;s&&"documentMode"in document&&(ur=document.documentMode);var Fi=s&&"TextEvent"in window&&!ur,Au=s&&(!zo||ur&&8<ur&&11>=ur),ar=" ",Oc=!1;function Fc(d,p){switch(d){case"keyup":return Bt.indexOf(p.keyCode)!==-1;case"keydown":return p.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function yl(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var Nc=!1;function ma(d,p){switch(d){case"compositionend":return yl(p);case"keypress":return p.which!==32?null:(Oc=!0,ar);case"textInput":return d=p.data,d===ar&&Oc?null:d;default:return null}}function Qs(d,p){if(Nc)return d==="compositionend"||!zo&&Fc(d,p)?(d=Jl(),kc=_h=Sa=null,Nc=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(p.ctrlKey||p.altKey||p.metaKey)||p.ctrlKey&&p.altKey){if(p.char&&1<p.char.length)return p.char;if(p.which)return String.fromCharCode(p.which)}return null;case"compositionend":return Au&&p.locale!=="ko"?null:p.data;default:return null}}var wh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function is(d){var p=d&&d.nodeName&&d.nodeName.toLowerCase();return p==="input"?!!wh[d.type]:p==="textarea"}function fd(d,p,T,R){Wi(R),p=$c(p,"onChange"),0<p.length&&(T=new Ko("onChange","change",null,T,R),d.push({event:T,listeners:p}))}var ko=null,ss=null;function bh(d){bf(d,0)}function pd(d){var p=ac(d);if(us(p))return d}function gm(d,p){if(d==="change")return p}var vl=!1;if(s){var tc;if(s){var xl="oninput"in document;if(!xl){var Bc=document.createElement("div");Bc.setAttribute("oninput","return;"),xl=typeof Bc.oninput=="function"}tc=xl}else tc=!1;vl=tc&&(!document.documentMode||9<document.documentMode)}function vf(){ko&&(ko.detachEvent("onpropertychange",Th),ss=ko=null)}function Th(d){if(d.propertyName==="value"&&pd(ss)){var p=[];fd(p,ss,d,Qr(d)),en(bh,p)}}function xf(d,p,T){d==="focusin"?(vf(),ko=p,ss=T,ko.attachEvent("onpropertychange",Th)):d==="focusout"&&vf()}function wl(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return pd(ss)}function _m(d,p){if(d==="click")return pd(p)}function ym(d,p){if(d==="input"||d==="change")return pd(p)}function xp(d,p){return d===p&&(d!==0||1/d===1/p)||d!==d&&p!==p}var ga=typeof Object.is=="function"?Object.is:xp;function Ea(d,p){if(ga(d,p))return!0;if(typeof d!="object"||d===null||typeof p!="object"||p===null)return!1;var T=Object.keys(d),R=Object.keys(p);if(T.length!==R.length)return!1;for(R=0;R<T.length;R++){var N=T[R];if(!ce.call(p,N)||!ga(d[N],p[N]))return!1}return!0}function md(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function wf(d,p){var T=md(d);d=0;for(var R;T;){if(T.nodeType===3){if(R=d+T.textContent.length,d<=p&&R>=p)return{node:T,offset:p-d};d=R}e:{for(;T;){if(T.nextSibling){T=T.nextSibling;break e}T=T.parentNode}T=void 0}T=md(T)}}function Sh(d,p){return d&&p?d===p?!0:d&&d.nodeType===3?!1:p&&p.nodeType===3?Sh(d,p.parentNode):"contains"in d?d.contains(p):d.compareDocumentPosition?!!(d.compareDocumentPosition(p)&16):!1:!1}function gd(){for(var d=window,p=vi();p instanceof d.HTMLIFrameElement;){try{var T=typeof p.contentWindow.location.href=="string"}catch{T=!1}if(T)d=p.contentWindow;else break;p=vi(d.document)}return p}function Eh(d){var p=d&&d.nodeName&&d.nodeName.toLowerCase();return p&&(p==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||p==="textarea"||d.contentEditable==="true")}function qs(d){var p=gd(),T=d.focusedElem,R=d.selectionRange;if(p!==T&&T&&T.ownerDocument&&Sh(T.ownerDocument.documentElement,T)){if(R!==null&&Eh(T)){if(p=R.start,d=R.end,d===void 0&&(d=p),"selectionStart"in T)T.selectionStart=p,T.selectionEnd=Math.min(d,T.value.length);else if(d=(p=T.ownerDocument||document)&&p.defaultView||window,d.getSelection){d=d.getSelection();var N=T.textContent.length,Z=Math.min(R.start,N);R=R.end===void 0?Z:Math.min(R.end,N),!d.extend&&Z>R&&(N=R,R=Z,Z=N),N=wf(T,Z);var de=wf(T,R);N&&de&&(d.rangeCount!==1||d.anchorNode!==N.node||d.anchorOffset!==N.offset||d.focusNode!==de.node||d.focusOffset!==de.offset)&&(p=p.createRange(),p.setStart(N.node,N.offset),d.removeAllRanges(),Z>R?(d.addRange(p),d.extend(de.node,de.offset)):(p.setEnd(de.node,de.offset),d.addRange(p)))}}for(p=[],d=T;d=d.parentNode;)d.nodeType===1&&p.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<p.length;T++)d=p[T],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var Ih=s&&"documentMode"in document&&11>=document.documentMode,rc=null,Ah=null,ja=null,nc=!1;function _d(d,p,T){var R=T.window===T?T.document:T.nodeType===9?T:T.ownerDocument;nc||rc==null||rc!==vi(R)||(R=rc,"selectionStart"in R&&Eh(R)?R={start:R.selectionStart,end:R.selectionEnd}:(R=(R.ownerDocument&&R.ownerDocument.defaultView||window).getSelection(),R={anchorNode:R.anchorNode,anchorOffset:R.anchorOffset,focusNode:R.focusNode,focusOffset:R.focusOffset}),ja&&Ea(ja,R)||(ja=R,R=$c(Ah,"onSelect"),0<R.length&&(p=new Ko("onSelect","select",null,p,T),d.push({event:p,listeners:R}),p.target=rc)))}function jc(d,p){var T={};return T[d.toLowerCase()]=p.toLowerCase(),T["Webkit"+d]="webkit"+p,T["Moz"+d]="moz"+p,T}var Os={animationend:jc("Animation","AnimationEnd"),animationiteration:jc("Animation","AnimationIteration"),animationstart:jc("Animation","AnimationStart"),transitionend:jc("Transition","TransitionEnd")},Cu={},Ct={};s&&(Ct=document.createElement("div").style,"AnimationEvent"in window||(delete Os.animationend.animation,delete Os.animationiteration.animation,delete Os.animationstart.animation),"TransitionEvent"in window||delete Os.transitionend.transition);function Mu(d){if(Cu[d])return Cu[d];if(!Os[d])return d;var p=Os[d],T;for(T in p)if(p.hasOwnProperty(T)&&T in Ct)return Cu[d]=p[T];return d}var Vc=Mu("animationend"),Uc=Mu("animationiteration"),Pu=Mu("animationstart"),Ru=Mu("transitionend"),Ia=new Map,Ch="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ss(d,p){Ia.set(d,p),$(p,[d])}for(var tn=0;tn<Ch.length;tn++){var ic=Ch[tn],vm=ic.toLowerCase(),xm=ic[0].toUpperCase()+ic.slice(1);Ss(vm,"on"+xm)}Ss(Vc,"onAnimationEnd"),Ss(Uc,"onAnimationIteration"),Ss(Pu,"onAnimationStart"),Ss("dblclick","onDoubleClick"),Ss("focusin","onFocus"),Ss("focusout","onBlur"),Ss(Ru,"onTransitionEnd"),re("onMouseEnter",["mouseout","mouseover"]),re("onMouseLeave",["mouseout","mouseover"]),re("onPointerEnter",["pointerout","pointerover"]),re("onPointerLeave",["pointerout","pointerover"]),$("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),$("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),$("onBeforeInput",["compositionend","keypress","textInput","paste"]),$("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),$("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),$("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var sc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),wm=new Set("cancel close invalid load scroll toggle".split(" ").concat(sc));function di(d,p,T){var R=d.type||"unknown-event";d.currentTarget=T,nt(R,p,void 0,d),d.currentTarget=null}function bf(d,p){p=(p&4)!==0;for(var T=0;T<d.length;T++){var R=d[T],N=R.event;R=R.listeners;e:{var Z=void 0;if(p)for(var de=R.length-1;0<=de;de--){var De=R[de],Ge=De.instance,_t=De.currentTarget;if(De=De.listener,Ge!==Z&&N.isPropagationStopped())break e;di(N,De,_t),Z=Ge}else for(de=0;de<R.length;de++){if(De=R[de],Ge=De.instance,_t=De.currentTarget,De=De.listener,Ge!==Z&&N.isPropagationStopped())break e;di(N,De,_t),Z=Ge}}}if(Ae)throw d=Ne,Ae=!1,Ne=null,d}function zi(d,p){var T=p[qa];T===void 0&&(T=p[qa]=new Set);var R=d+"__bubble";T.has(R)||(wp(p,d,2,!1),T.add(R))}function Tf(d,p,T){var R=0;p&&(R|=4),wp(T,d,R,p)}var yd="_reactListening"+Math.random().toString(36).slice(2);function Mh(d){if(!d[yd]){d[yd]=!0,z.forEach(function(T){T!=="selectionchange"&&(wm.has(T)||Tf(T,!1,d),Tf(T,!0,d))});var p=d.nodeType===9?d:d.ownerDocument;p===null||p[yd]||(p[yd]=!0,Tf("selectionchange",!1,p))}}function wp(d,p,T,R){switch(Kl(p)){case 1:var N=pl;break;case 4:N=cd;break;default:N=wu}T=N.bind(null,p,T,d),N=void 0,!Y||p!=="touchstart"&&p!=="touchmove"&&p!=="wheel"||(N=!0),R?N!==void 0?d.addEventListener(p,T,{capture:!0,passive:N}):d.addEventListener(p,T,!0):N!==void 0?d.addEventListener(p,T,{passive:N}):d.addEventListener(p,T,!1)}function vd(d,p,T,R,N){var Z=R;if((p&1)===0&&(p&2)===0&&R!==null)e:for(;;){if(R===null)return;var de=R.tag;if(de===3||de===4){var De=R.stateNode.containerInfo;if(De===N||De.nodeType===8&&De.parentNode===N)break;if(de===4)for(de=R.return;de!==null;){var Ge=de.tag;if((Ge===3||Ge===4)&&(Ge=de.stateNode.containerInfo,Ge===N||Ge.nodeType===8&&Ge.parentNode===N))return;de=de.return}for(;De!==null;){if(de=Gc(De),de===null)return;if(Ge=de.tag,Ge===5||Ge===6){R=Z=de;continue e}De=De.parentNode}}R=R.return}en(function(){var _t=Z,tr=Qr(T),rr=[];e:{var Jt=Ia.get(d);if(Jt!==void 0){var Ir=Ko,Or=d;switch(d){case"keypress":if(Gs(T)===0)break e;case"keydown":case"keyup":Ir=xh;break;case"focusin":Or="focus",Ir=Pn;break;case"focusout":Or="blur",Ir=Pn;break;case"beforeblur":case"afterblur":Ir=Pn;break;case"click":if(T.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ir=Po;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ir=Su;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ir=Js;break;case Vc:case Uc:case Pu:Ir=Ro;break;case Ru:Ir=go;break;case"scroll":Ir=_f;break;case"wheel":Ir=Gr;break;case"copy":case"cut":case"paste":Ir=Rn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ir=Iu}var Ur=(p&4)!==0,ys=!Ur&&d==="scroll",at=Ur?Jt!==null?Jt+"Capture":null:Jt;Ur=[];for(var et=_t,dt;et!==null;){dt=et;var or=dt.stateNode;if(dt.tag===5&&or!==null&&(dt=or,at!==null&&(or=Oe(et,at),or!=null&&Ur.push(Ph(et,or,dt)))),ys)break;et=et.return}0<Ur.length&&(Jt=new Ir(Jt,Or,null,T,tr),rr.push({event:Jt,listeners:Ur}))}}if((p&7)===0){e:{if(Jt=d==="mouseover"||d==="pointerover",Ir=d==="mouseout"||d==="pointerout",Jt&&T!==Un&&(Or=T.relatedTarget||T.fromElement)&&(Gc(Or)||Or[Ga]))break e;if((Ir||Jt)&&(Jt=tr.window===tr?tr:(Jt=tr.ownerDocument)?Jt.defaultView||Jt.parentWindow:window,Ir?(Or=T.relatedTarget||T.toElement,Ir=_t,Or=Or?Gc(Or):null,Or!==null&&(ys=Ue(Or),Or!==ys||Or.tag!==5&&Or.tag!==6)&&(Or=null)):(Ir=null,Or=_t),Ir!==Or)){if(Ur=Po,or="onMouseLeave",at="onMouseEnter",et="mouse",(d==="pointerout"||d==="pointerover")&&(Ur=Iu,or="onPointerLeave",at="onPointerEnter",et="pointer"),ys=Ir==null?Jt:ac(Ir),dt=Or==null?Jt:ac(Or),Jt=new Ur(or,et+"leave",Ir,T,tr),Jt.target=ys,Jt.relatedTarget=dt,or=null,Gc(tr)===_t&&(Ur=new Ur(at,et+"enter",Or,T,tr),Ur.target=dt,Ur.relatedTarget=ys,or=Ur),ys=or,Ir&&Or)t:{for(Ur=Ir,at=Or,et=0,dt=Ur;dt;dt=zu(dt))et++;for(dt=0,or=at;or;or=zu(or))dt++;for(;0<et-dt;)Ur=zu(Ur),et--;for(;0<dt-et;)at=zu(at),dt--;for(;et--;){if(Ur===at||at!==null&&Ur===at.alternate)break t;Ur=zu(Ur),at=zu(at)}Ur=null}else Ur=null;Ir!==null&&Sf(rr,Jt,Ir,Ur,!1),Or!==null&&ys!==null&&Sf(rr,ys,Or,Ur,!0)}}e:{if(Jt=_t?ac(_t):window,Ir=Jt.nodeName&&Jt.nodeName.toLowerCase(),Ir==="select"||Ir==="input"&&Jt.type==="file")var Jr=gm;else if(is(Jt))if(vl)Jr=ym;else{Jr=wl;var sn=xf}else(Ir=Jt.nodeName)&&Ir.toLowerCase()==="input"&&(Jt.type==="checkbox"||Jt.type==="radio")&&(Jr=_m);if(Jr&&(Jr=Jr(d,_t))){fd(rr,Jr,T,tr);break e}sn&&sn(d,Jt,_t),d==="focusout"&&(sn=Jt._wrapperState)&&sn.controlled&&Jt.type==="number"&&ds(Jt,"number",Jt.value)}switch(sn=_t?ac(_t):window,d){case"focusin":(is(sn)||sn.contentEditable==="true")&&(rc=sn,Ah=_t,ja=null);break;case"focusout":ja=Ah=rc=null;break;case"mousedown":nc=!0;break;case"contextmenu":case"mouseup":case"dragend":nc=!1,_d(rr,T,tr);break;case"selectionchange":if(Ih)break;case"keydown":case"keyup":_d(rr,T,tr)}var mn;if(zo)e:{switch(d){case"compositionstart":var En="onCompositionStart";break e;case"compositionend":En="onCompositionEnd";break e;case"compositionupdate":En="onCompositionUpdate";break e}En=void 0}else Nc?Fc(d,T)&&(En="onCompositionEnd"):d==="keydown"&&T.keyCode===229&&(En="onCompositionStart");En&&(Au&&T.locale!=="ko"&&(Nc||En!=="onCompositionStart"?En==="onCompositionEnd"&&Nc&&(mn=Jl()):(Sa=tr,_h="value"in Sa?Sa.value:Sa.textContent,Nc=!0)),sn=$c(_t,En),0<sn.length&&(En=new Eu(En,d,null,T,tr),rr.push({event:En,listeners:sn}),mn?En.data=mn:(mn=yl(T),mn!==null&&(En.data=mn)))),(mn=Fi?ma(d,T):Qs(d,T))&&(_t=$c(_t,"onBeforeInput"),0<_t.length&&(tr=new Eu("onBeforeInput","beforeinput",null,T,tr),rr.push({event:tr,listeners:_t}),tr.data=mn))}bf(rr,p)})}function Ph(d,p,T){return{instance:d,listener:p,currentTarget:T}}function $c(d,p){for(var T=p+"Capture",R=[];d!==null;){var N=d,Z=N.stateNode;N.tag===5&&Z!==null&&(N=Z,Z=Oe(d,T),Z!=null&&R.unshift(Ph(d,Z,N)),Z=Oe(d,p),Z!=null&&R.push(Ph(d,Z,N))),d=d.return}return R}function zu(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function Sf(d,p,T,R,N){for(var Z=p._reactName,de=[];T!==null&&T!==R;){var De=T,Ge=De.alternate,_t=De.stateNode;if(Ge!==null&&Ge===R)break;De.tag===5&&_t!==null&&(De=_t,N?(Ge=Oe(T,Z),Ge!=null&&de.unshift(Ph(T,Ge,De))):N||(Ge=Oe(T,Z),Ge!=null&&de.push(Ph(T,Ge,De)))),T=T.return}de.length!==0&&d.push({event:p,listeners:de})}var Ef=/\r\n?/g,xd=/\u0000|\uFFFD/g;function wd(d){return(typeof d=="string"?d:""+d).replace(Ef,`
`).replace(xd,"")}function Va(d,p,T){if(p=wd(p),wd(d)!==p&&T)throw Error(I(425))}function bl(){}var ku=null,Du=null;function oc(d,p){return d==="textarea"||d==="noscript"||typeof p.children=="string"||typeof p.children=="number"||typeof p.dangerouslySetInnerHTML=="object"&&p.dangerouslySetInnerHTML!==null&&p.dangerouslySetInnerHTML.__html!=null}var bd=typeof setTimeout=="function"?setTimeout:void 0,If=typeof clearTimeout=="function"?clearTimeout:void 0,Af=typeof Promise=="function"?Promise:void 0,Lu=typeof queueMicrotask=="function"?queueMicrotask:typeof Af<"u"?function(d){return Af.resolve(null).then(d).catch(Td)}:bd;function Td(d){setTimeout(function(){throw d})}function Ou(d,p){var T=p,R=0;do{var N=T.nextSibling;if(d.removeChild(T),N&&N.nodeType===8)if(T=N.data,T==="/$"){if(R===0){d.removeChild(N),Rc(p);return}R--}else T!=="$"&&T!=="$?"&&T!=="$!"||R++;T=N}while(T);Rc(p)}function Ua(d){for(;d!=null;d=d.nextSibling){var p=d.nodeType;if(p===1||p===3)break;if(p===8){if(p=d.data,p==="$"||p==="$!"||p==="$?")break;if(p==="/$")return null}}return d}function Rh(d){d=d.previousSibling;for(var p=0;d;){if(d.nodeType===8){var T=d.data;if(T==="$"||T==="$!"||T==="$?"){if(p===0)return d;p--}else T==="/$"&&p++}d=d.previousSibling}return null}var $a=Math.random().toString(36).slice(2),Aa="__reactFiber$"+$a,Fu="__reactProps$"+$a,Ga="__reactContainer$"+$a,qa="__reactEvents$"+$a,bp="__reactListeners$"+$a,Tp="__reactHandles$"+$a;function Gc(d){var p=d[Aa];if(p)return p;for(var T=d.parentNode;T;){if(p=T[Ga]||T[Aa]){if(T=p.alternate,p.child!==null||T!==null&&T.child!==null)for(d=Rh(d);d!==null;){if(T=d[Aa])return T;d=Rh(d)}return p}d=T,T=d.parentNode}return null}function zh(d){return d=d[Aa]||d[Ga],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function ac(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(I(33))}function qc(d){return d[Fu]||null}var Nu=[],Jo=-1;function Ha(d){return{current:d}}function ki(d){0>Jo||(d.current=Nu[Jo],Nu[Jo]=null,Jo--)}function Di(d,p){Jo++,Nu[Jo]=d.current,d.current=p}var Do={},Ki=Ha(Do),_o=Ha(!1),Es=Do;function Tl(d,p){var T=d.type.contextTypes;if(!T)return Do;var R=d.stateNode;if(R&&R.__reactInternalMemoizedUnmaskedChildContext===p)return R.__reactInternalMemoizedMaskedChildContext;var N={},Z;for(Z in T)N[Z]=p[Z];return R&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=p,d.__reactInternalMemoizedMaskedChildContext=N),N}function Fs(d){return d=d.childContextTypes,d!=null}function Hc(){ki(_o),ki(Ki)}function Sd(d,p,T){if(Ki.current!==Do)throw Error(I(168));Di(Ki,p),Di(_o,T)}function Ed(d,p,T){var R=d.stateNode;if(p=p.childContextTypes,typeof R.getChildContext!="function")return T;R=R.getChildContext();for(var N in R)if(!(N in p))throw Error(I(108,Sr(d)||"Unknown",N));return Ht({},T,R)}function Wc(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||Do,Es=Ki.current,Di(Ki,d),Di(_o,_o.current),!0}function Bu(d,p,T){var R=d.stateNode;if(!R)throw Error(I(169));T?(d=Ed(d,p,Es),R.__reactInternalMemoizedMergedChildContext=d,ki(_o),ki(Ki),Di(Ki,d)):ki(_o),Di(_o,T)}var Lo=null,ju=!1,Zc=!1;function Cf(d){Lo===null?Lo=[d]:Lo.push(d)}function Sp(d){ju=!0,Cf(d)}function Oo(){if(!Zc&&Lo!==null){Zc=!0;var d=0,p=Yn;try{var T=Lo;for(Yn=1;d<T.length;d++){var R=T[d];do R=R(!0);while(R!==null)}Lo=null,ju=!1}catch(N){throw Lo!==null&&(Lo=Lo.slice(d+1)),xr(An,Oo),N}finally{Yn=p,Zc=!1}}return null}var Xc=[],Vu=0,Id=null,Ad=0,yo=[],_a=0,Wa=null,Ca=1,Za="";function Qo(d,p){Xc[Vu++]=Ad,Xc[Vu++]=Id,Id=d,Ad=p}function Cd(d,p,T){yo[_a++]=Ca,yo[_a++]=Za,yo[_a++]=Wa,Wa=d;var R=Ca;d=Za;var N=32-po(R)-1;R&=~(1<<N),T+=1;var Z=32-po(p)+N;if(30<Z){var de=N-N%5;Z=(R&(1<<de)-1).toString(32),R>>=de,N-=de,Ca=1<<32-po(p)+N|T<<N|R,Za=Z+d}else Ca=1<<Z|T<<N|R,Za=d}function kh(d){d.return!==null&&(Qo(d,1),Cd(d,1,0))}function Md(d){for(;d===Id;)Id=Xc[--Vu],Xc[Vu]=null,Ad=Xc[--Vu],Xc[Vu]=null;for(;d===Wa;)Wa=yo[--_a],yo[_a]=null,Za=yo[--_a],yo[_a]=null,Ca=yo[--_a],yo[_a]=null}var fs=null,Is=null,Ni=!1,Ns=null;function Dh(d,p){var T=Ji(5,null,null,0);T.elementType="DELETED",T.stateNode=p,T.return=d,p=d.deletions,p===null?(d.deletions=[T],d.flags|=16):p.push(T)}function Uu(d,p){switch(d.tag){case 5:var T=d.type;return p=p.nodeType!==1||T.toLowerCase()!==p.nodeName.toLowerCase()?null:p,p!==null?(d.stateNode=p,fs=d,Is=Ua(p.firstChild),!0):!1;case 6:return p=d.pendingProps===""||p.nodeType!==3?null:p,p!==null?(d.stateNode=p,fs=d,Is=null,!0):!1;case 13:return p=p.nodeType!==8?null:p,p!==null?(T=Wa!==null?{id:Ca,overflow:Za}:null,d.memoizedState={dehydrated:p,treeContext:T,retryLane:1073741824},T=Ji(18,null,null,0),T.stateNode=p,T.return=d,d.child=T,fs=d,Is=null,!0):!1;default:return!1}}function Lh(d){return(d.mode&1)!==0&&(d.flags&128)===0}function Oh(d){if(Ni){var p=Is;if(p){var T=p;if(!Uu(d,p)){if(Lh(d))throw Error(I(418));p=Ua(T.nextSibling);var R=fs;p&&Uu(d,p)?Dh(R,T):(d.flags=d.flags&-4097|2,Ni=!1,fs=d)}}else{if(Lh(d))throw Error(I(418));d.flags=d.flags&-4097|2,Ni=!1,fs=d}}}function $u(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;fs=d}function lc(d){if(d!==fs)return!1;if(!Ni)return $u(d),Ni=!0,!1;var p;if((p=d.tag!==3)&&!(p=d.tag!==5)&&(p=d.type,p=p!=="head"&&p!=="body"&&!oc(d.type,d.memoizedProps)),p&&(p=Is)){if(Lh(d))throw Mf(),Error(I(418));for(;p;)Dh(d,p),p=Ua(p.nextSibling)}if($u(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(I(317));e:{for(d=d.nextSibling,p=0;d;){if(d.nodeType===8){var T=d.data;if(T==="/$"){if(p===0){Is=Ua(d.nextSibling);break e}p--}else T!=="$"&&T!=="$!"&&T!=="$?"||p++}d=d.nextSibling}Is=null}}else Is=fs?Ua(d.stateNode.nextSibling):null;return!0}function Mf(){for(var d=Is;d;)d=Ua(d.nextSibling)}function Yc(){Is=fs=null,Ni=!1}function Fo(d){Ns===null?Ns=[d]:Ns.push(d)}var bm=jt.ReactCurrentBatchConfig;function Fh(d,p,T){if(d=T.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(T._owner){if(T=T._owner,T){if(T.tag!==1)throw Error(I(309));var R=T.stateNode}if(!R)throw Error(I(147,d));var N=R,Z=""+d;return p!==null&&p.ref!==null&&typeof p.ref=="function"&&p.ref._stringRef===Z?p.ref:(p=function(de){var De=N.refs;de===null?delete De[Z]:De[Z]=de},p._stringRef=Z,p)}if(typeof d!="string")throw Error(I(284));if(!T._owner)throw Error(I(290,d))}return d}function Gu(d,p){throw d=Object.prototype.toString.call(p),Error(I(31,d==="[object Object]"?"object with keys {"+Object.keys(p).join(", ")+"}":d))}function Ep(d){var p=d._init;return p(d._payload)}function Kc(d){function p(at,et){if(d){var dt=at.deletions;dt===null?(at.deletions=[et],at.flags|=16):dt.push(et)}}function T(at,et){if(!d)return null;for(;et!==null;)p(at,et),et=et.sibling;return null}function R(at,et){for(at=new Map;et!==null;)et.key!==null?at.set(et.key,et):at.set(et.index,et),et=et.sibling;return at}function N(at,et){return at=So(at,et),at.index=0,at.sibling=null,at}function Z(at,et,dt){return at.index=dt,d?(dt=at.alternate,dt!==null?(dt=dt.index,dt<et?(at.flags|=2,et):dt):(at.flags|=2,et)):(at.flags|=1048576,et)}function de(at){return d&&at.alternate===null&&(at.flags|=2),at}function De(at,et,dt,or){return et===null||et.tag!==6?(et=ed(dt,at.mode,or),et.return=at,et):(et=N(et,dt),et.return=at,et)}function Ge(at,et,dt,or){var Jr=dt.type;return Jr===Kt?tr(at,et,dt.props.children,or,dt.key):et!==null&&(et.elementType===Jr||typeof Jr=="object"&&Jr!==null&&Jr.$$typeof===nn&&Ep(Jr)===et.type)?(or=N(et,dt.props),or.ref=Fh(at,et,dt),or.return=at,or):(or=Vo(dt.type,dt.key,dt.props,null,at.mode,or),or.ref=Fh(at,et,dt),or.return=at,or)}function _t(at,et,dt,or){return et===null||et.tag!==4||et.stateNode.containerInfo!==dt.containerInfo||et.stateNode.implementation!==dt.implementation?(et=vc(dt,at.mode,or),et.return=at,et):(et=N(et,dt.children||[]),et.return=at,et)}function tr(at,et,dt,or,Jr){return et===null||et.tag!==7?(et=Uo(dt,at.mode,or,Jr),et.return=at,et):(et=N(et,dt),et.return=at,et)}function rr(at,et,dt){if(typeof et=="string"&&et!==""||typeof et=="number")return et=ed(""+et,at.mode,dt),et.return=at,et;if(typeof et=="object"&&et!==null){switch(et.$$typeof){case vr:return dt=Vo(et.type,et.key,et.props,null,at.mode,dt),dt.ref=Fh(at,null,et),dt.return=at,dt;case hr:return et=vc(et,at.mode,dt),et.return=at,et;case nn:var or=et._init;return rr(at,or(et._payload),dt)}if(Oi(et)||Tr(et))return et=Uo(et,at.mode,dt,null),et.return=at,et;Gu(at,et)}return null}function Jt(at,et,dt,or){var Jr=et!==null?et.key:null;if(typeof dt=="string"&&dt!==""||typeof dt=="number")return Jr!==null?null:De(at,et,""+dt,or);if(typeof dt=="object"&&dt!==null){switch(dt.$$typeof){case vr:return dt.key===Jr?Ge(at,et,dt,or):null;case hr:return dt.key===Jr?_t(at,et,dt,or):null;case nn:return Jr=dt._init,Jt(at,et,Jr(dt._payload),or)}if(Oi(dt)||Tr(dt))return Jr!==null?null:tr(at,et,dt,or,null);Gu(at,dt)}return null}function Ir(at,et,dt,or,Jr){if(typeof or=="string"&&or!==""||typeof or=="number")return at=at.get(dt)||null,De(et,at,""+or,Jr);if(typeof or=="object"&&or!==null){switch(or.$$typeof){case vr:return at=at.get(or.key===null?dt:or.key)||null,Ge(et,at,or,Jr);case hr:return at=at.get(or.key===null?dt:or.key)||null,_t(et,at,or,Jr);case nn:var sn=or._init;return Ir(at,et,dt,sn(or._payload),Jr)}if(Oi(or)||Tr(or))return at=at.get(dt)||null,tr(et,at,or,Jr,null);Gu(et,or)}return null}function Or(at,et,dt,or){for(var Jr=null,sn=null,mn=et,En=et=0,Hs=null;mn!==null&&En<dt.length;En++){mn.index>En?(Hs=mn,mn=null):Hs=mn.sibling;var Ei=Jt(at,mn,dt[En],or);if(Ei===null){mn===null&&(mn=Hs);break}d&&mn&&Ei.alternate===null&&p(at,mn),et=Z(Ei,et,En),sn===null?Jr=Ei:sn.sibling=Ei,sn=Ei,mn=Hs}if(En===dt.length)return T(at,mn),Ni&&Qo(at,En),Jr;if(mn===null){for(;En<dt.length;En++)mn=rr(at,dt[En],or),mn!==null&&(et=Z(mn,et,En),sn===null?Jr=mn:sn.sibling=mn,sn=mn);return Ni&&Qo(at,En),Jr}for(mn=R(at,mn);En<dt.length;En++)Hs=Ir(mn,at,En,dt[En],or),Hs!==null&&(d&&Hs.alternate!==null&&mn.delete(Hs.key===null?En:Hs.key),et=Z(Hs,et,En),sn===null?Jr=Hs:sn.sibling=Hs,sn=Hs);return d&&mn.forEach(function(sh){return p(at,sh)}),Ni&&Qo(at,En),Jr}function Ur(at,et,dt,or){var Jr=Tr(dt);if(typeof Jr!="function")throw Error(I(150));if(dt=Jr.call(dt),dt==null)throw Error(I(151));for(var sn=Jr=null,mn=et,En=et=0,Hs=null,Ei=dt.next();mn!==null&&!Ei.done;En++,Ei=dt.next()){mn.index>En?(Hs=mn,mn=null):Hs=mn.sibling;var sh=Jt(at,mn,Ei.value,or);if(sh===null){mn===null&&(mn=Hs);break}d&&mn&&sh.alternate===null&&p(at,mn),et=Z(sh,et,En),sn===null?Jr=sh:sn.sibling=sh,sn=sh,mn=Hs}if(Ei.done)return T(at,mn),Ni&&Qo(at,En),Jr;if(mn===null){for(;!Ei.done;En++,Ei=dt.next())Ei=rr(at,Ei.value,or),Ei!==null&&(et=Z(Ei,et,En),sn===null?Jr=Ei:sn.sibling=Ei,sn=Ei);return Ni&&Qo(at,En),Jr}for(mn=R(at,mn);!Ei.done;En++,Ei=dt.next())Ei=Ir(mn,at,En,Ei.value,or),Ei!==null&&(d&&Ei.alternate!==null&&mn.delete(Ei.key===null?En:Ei.key),et=Z(Ei,et,En),sn===null?Jr=Ei:sn.sibling=Ei,sn=Ei);return d&&mn.forEach(function(wy){return p(at,wy)}),Ni&&Qo(at,En),Jr}function ys(at,et,dt,or){if(typeof dt=="object"&&dt!==null&&dt.type===Kt&&dt.key===null&&(dt=dt.props.children),typeof dt=="object"&&dt!==null){switch(dt.$$typeof){case vr:e:{for(var Jr=dt.key,sn=et;sn!==null;){if(sn.key===Jr){if(Jr=dt.type,Jr===Kt){if(sn.tag===7){T(at,sn.sibling),et=N(sn,dt.props.children),et.return=at,at=et;break e}}else if(sn.elementType===Jr||typeof Jr=="object"&&Jr!==null&&Jr.$$typeof===nn&&Ep(Jr)===sn.type){T(at,sn.sibling),et=N(sn,dt.props),et.ref=Fh(at,sn,dt),et.return=at,at=et;break e}T(at,sn);break}else p(at,sn);sn=sn.sibling}dt.type===Kt?(et=Uo(dt.props.children,at.mode,or,dt.key),et.return=at,at=et):(or=Vo(dt.type,dt.key,dt.props,null,at.mode,or),or.ref=Fh(at,et,dt),or.return=at,at=or)}return de(at);case hr:e:{for(sn=dt.key;et!==null;){if(et.key===sn)if(et.tag===4&&et.stateNode.containerInfo===dt.containerInfo&&et.stateNode.implementation===dt.implementation){T(at,et.sibling),et=N(et,dt.children||[]),et.return=at,at=et;break e}else{T(at,et);break}else p(at,et);et=et.sibling}et=vc(dt,at.mode,or),et.return=at,at=et}return de(at);case nn:return sn=dt._init,ys(at,et,sn(dt._payload),or)}if(Oi(dt))return Or(at,et,dt,or);if(Tr(dt))return Ur(at,et,dt,or);Gu(at,dt)}return typeof dt=="string"&&dt!==""||typeof dt=="number"?(dt=""+dt,et!==null&&et.tag===6?(T(at,et.sibling),et=N(et,dt),et.return=at,at=et):(T(at,et),et=ed(dt,at.mode,or),et.return=at,at=et),de(at)):T(at,et)}return ys}var Sl=Kc(!0),Xa=Kc(!1),cc=Ha(null),uc=null,Jc=null,hc=null;function dc(){hc=Jc=uc=null}function qu(d){var p=cc.current;ki(cc),d._currentValue=p}function Nh(d,p,T){for(;d!==null;){var R=d.alternate;if((d.childLanes&p)!==p?(d.childLanes|=p,R!==null&&(R.childLanes|=p)):R!==null&&(R.childLanes&p)!==p&&(R.childLanes|=p),d===T)break;d=d.return}}function fc(d,p){uc=d,hc=Jc=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&p)!==0&&(to=!0),d.firstContext=null)}function ps(d){var p=d._currentValue;if(hc!==d)if(d={context:d,memoizedValue:p,next:null},Jc===null){if(uc===null)throw Error(I(308));Jc=d,uc.dependencies={lanes:0,firstContext:d}}else Jc=Jc.next=d;return p}var vo=null;function Ft(d){vo===null?vo=[d]:vo.push(d)}function Pf(d,p,T,R){var N=p.interleaved;return N===null?(T.next=T,Ft(p)):(T.next=N.next,N.next=T),p.interleaved=T,Ya(d,R)}function Ya(d,p){d.lanes|=p;var T=d.alternate;for(T!==null&&(T.lanes|=p),T=d,d=d.return;d!==null;)d.childLanes|=p,T=d.alternate,T!==null&&(T.childLanes|=p),T=d,d=d.return;return T.tag===3?T.stateNode:null}var xo=!1;function Ka(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function sr(d,p){d=d.updateQueue,p.updateQueue===d&&(p.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function ea(d,p){return{eventTime:d,lane:p,tag:0,payload:null,callback:null,next:null}}function pc(d,p,T){var R=d.updateQueue;if(R===null)return null;if(R=R.shared,(V&2)!==0){var N=R.pending;return N===null?p.next=p:(p.next=N.next,N.next=p),R.pending=p,Ya(d,T)}return N=R.interleaved,N===null?(p.next=p,Ft(R)):(p.next=N.next,N.next=p),R.interleaved=p,Ya(d,T)}function Pd(d,p,T){if(p=p.updateQueue,p!==null&&(p=p.shared,(T&4194240)!==0)){var R=p.lanes;R&=d.pendingLanes,T|=R,p.lanes=T,Xo(d,T)}}function Rd(d,p){var T=d.updateQueue,R=d.alternate;if(R!==null&&(R=R.updateQueue,T===R)){var N=null,Z=null;if(T=T.firstBaseUpdate,T!==null){do{var de={eventTime:T.eventTime,lane:T.lane,tag:T.tag,payload:T.payload,callback:T.callback,next:null};Z===null?N=Z=de:Z=Z.next=de,T=T.next}while(T!==null);Z===null?N=Z=p:Z=Z.next=p}else N=Z=p;T={baseState:R.baseState,firstBaseUpdate:N,lastBaseUpdate:Z,shared:R.shared,effects:R.effects},d.updateQueue=T;return}d=T.lastBaseUpdate,d===null?T.firstBaseUpdate=p:d.next=p,T.lastBaseUpdate=p}function Bh(d,p,T,R){var N=d.updateQueue;xo=!1;var Z=N.firstBaseUpdate,de=N.lastBaseUpdate,De=N.shared.pending;if(De!==null){N.shared.pending=null;var Ge=De,_t=Ge.next;Ge.next=null,de===null?Z=_t:de.next=_t,de=Ge;var tr=d.alternate;tr!==null&&(tr=tr.updateQueue,De=tr.lastBaseUpdate,De!==de&&(De===null?tr.firstBaseUpdate=_t:De.next=_t,tr.lastBaseUpdate=Ge))}if(Z!==null){var rr=N.baseState;de=0,tr=_t=Ge=null,De=Z;do{var Jt=De.lane,Ir=De.eventTime;if((R&Jt)===Jt){tr!==null&&(tr=tr.next={eventTime:Ir,lane:0,tag:De.tag,payload:De.payload,callback:De.callback,next:null});e:{var Or=d,Ur=De;switch(Jt=p,Ir=T,Ur.tag){case 1:if(Or=Ur.payload,typeof Or=="function"){rr=Or.call(Ir,rr,Jt);break e}rr=Or;break e;case 3:Or.flags=Or.flags&-65537|128;case 0:if(Or=Ur.payload,Jt=typeof Or=="function"?Or.call(Ir,rr,Jt):Or,Jt==null)break e;rr=Ht({},rr,Jt);break e;case 2:xo=!0}}De.callback!==null&&De.lane!==0&&(d.flags|=64,Jt=N.effects,Jt===null?N.effects=[De]:Jt.push(De))}else Ir={eventTime:Ir,lane:Jt,tag:De.tag,payload:De.payload,callback:De.callback,next:null},tr===null?(_t=tr=Ir,Ge=rr):tr=tr.next=Ir,de|=Jt;if(De=De.next,De===null){if(De=N.shared.pending,De===null)break;Jt=De,De=Jt.next,Jt.next=null,N.lastBaseUpdate=Jt,N.shared.pending=null}}while(!0);if(tr===null&&(Ge=rr),N.baseState=Ge,N.firstBaseUpdate=_t,N.lastBaseUpdate=tr,p=N.shared.interleaved,p!==null){N=p;do de|=N.lane,N=N.next;while(N!==p)}else Z===null&&(N.shared.lanes=0);pe|=de,d.lanes=de,d.memoizedState=rr}}function Ip(d,p,T){if(d=p.effects,p.effects=null,d!==null)for(p=0;p<d.length;p++){var R=d[p],N=R.callback;if(N!==null){if(R.callback=null,R=T,typeof N!="function")throw Error(I(191,N));N.call(R)}}}var Hu={},Ja=Ha(Hu),jh=Ha(Hu),Bs=Ha(Hu);function El(d){if(d===Hu)throw Error(I(174));return d}function js(d,p){switch(Di(Bs,p),Di(jh,d),Di(Ja,Hu),d=p.nodeType,d){case 9:case 11:p=(p=p.documentElement)?p.namespaceURI:ks(null,"");break;default:d=d===8?p.parentNode:p,p=d.namespaceURI||null,d=d.tagName,p=ks(p,d)}ki(Ja),Di(Ja,p)}function No(){ki(Ja),ki(jh),ki(Bs)}function mc(d){El(Bs.current);var p=El(Ja.current),T=ks(p,d.type);p!==T&&(Di(jh,d),Di(Ja,T))}function Wu(d){jh.current===d&&(ki(Ja),ki(jh))}var Li=Ha(0);function Il(d){for(var p=d;p!==null;){if(p.tag===13){var T=p.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||T.data==="$?"||T.data==="$!"))return p}else if(p.tag===19&&p.memoizedProps.revealOrder!==void 0){if((p.flags&128)!==0)return p}else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===d)break;for(;p.sibling===null;){if(p.return===null||p.return===d)return null;p=p.return}p.sibling.return=p.return,p=p.sibling}return null}var zd=[];function Ma(){for(var d=0;d<zd.length;d++)zd[d]._workInProgressVersionPrimary=null;zd.length=0}var zn=jt.ReactCurrentDispatcher,Qc=jt.ReactCurrentBatchConfig,Bo=0,Gi=null,ms=null,As=null,kd=!1,Qa=!1,Pa=0,gt=0;function It(){throw Error(I(321))}function Al(d,p){if(p===null)return!1;for(var T=0;T<p.length&&T<d.length;T++)if(!ga(d[T],p[T]))return!1;return!0}function fi(d,p,T,R,N,Z){if(Bo=Z,Gi=p,p.memoizedState=null,p.updateQueue=null,p.lanes=0,zn.current=d===null||d.memoizedState===null?Gh:Vd,d=T(R,N),Qa){Z=0;do{if(Qa=!1,Pa=0,25<=Z)throw Error(I(301));Z+=1,As=ms=null,p.updateQueue=null,zn.current=Ju,d=T(R,N)}while(Qa)}if(zn.current=za,p=ms!==null&&ms.next!==null,Bo=0,As=ms=Gi=null,kd=!1,p)throw Error(I(300));return d}function ke(){var d=Pa!==0;return Pa=0,d}function gs(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return As===null?Gi.memoizedState=As=d:As=As.next=d,As}function wo(){if(ms===null){var d=Gi.alternate;d=d!==null?d.memoizedState:null}else d=ms.next;var p=As===null?Gi.memoizedState:As.next;if(p!==null)As=p,ms=d;else{if(d===null)throw Error(I(310));ms=d,d={memoizedState:ms.memoizedState,baseState:ms.baseState,baseQueue:ms.baseQueue,queue:ms.queue,next:null},As===null?Gi.memoizedState=As=d:As=As.next=d}return As}function gc(d,p){return typeof p=="function"?p(d):p}function Vh(d){var p=wo(),T=p.queue;if(T===null)throw Error(I(311));T.lastRenderedReducer=d;var R=ms,N=R.baseQueue,Z=T.pending;if(Z!==null){if(N!==null){var de=N.next;N.next=Z.next,Z.next=de}R.baseQueue=N=Z,T.pending=null}if(N!==null){Z=N.next,R=R.baseState;var De=de=null,Ge=null,_t=Z;do{var tr=_t.lane;if((Bo&tr)===tr)Ge!==null&&(Ge=Ge.next={lane:0,action:_t.action,hasEagerState:_t.hasEagerState,eagerState:_t.eagerState,next:null}),R=_t.hasEagerState?_t.eagerState:d(R,_t.action);else{var rr={lane:tr,action:_t.action,hasEagerState:_t.hasEagerState,eagerState:_t.eagerState,next:null};Ge===null?(De=Ge=rr,de=R):Ge=Ge.next=rr,Gi.lanes|=tr,pe|=tr}_t=_t.next}while(_t!==null&&_t!==Z);Ge===null?de=R:Ge.next=De,ga(R,p.memoizedState)||(to=!0),p.memoizedState=R,p.baseState=de,p.baseQueue=Ge,T.lastRenderedState=R}if(d=T.interleaved,d!==null){N=d;do Z=N.lane,Gi.lanes|=Z,pe|=Z,N=N.next;while(N!==d)}else N===null&&(T.lanes=0);return[p.memoizedState,T.dispatch]}function Dd(d){var p=wo(),T=p.queue;if(T===null)throw Error(I(311));T.lastRenderedReducer=d;var R=T.dispatch,N=T.pending,Z=p.memoizedState;if(N!==null){T.pending=null;var de=N=N.next;do Z=d(Z,de.action),de=de.next;while(de!==N);ga(Z,p.memoizedState)||(to=!0),p.memoizedState=Z,p.baseQueue===null&&(p.baseState=Z),T.lastRenderedState=Z}return[Z,R]}function Rf(){}function eu(d,p){var T=Gi,R=wo(),N=p(),Z=!ga(R.memoizedState,N);if(Z&&(R.memoizedState=N,to=!0),R=R.queue,tl(zf.bind(null,T,R,d),[d]),R.getSnapshot!==p||Z||As!==null&&As.memoizedState.tag&1){if(T.flags|=2048,Zu(9,Cp.bind(null,T,R,N,p),void 0,null),W===null)throw Error(I(349));(Bo&30)!==0||Ap(T,p,N)}return N}function Ap(d,p,T){d.flags|=16384,d={getSnapshot:p,value:T},p=Gi.updateQueue,p===null?(p={lastEffect:null,stores:null},Gi.updateQueue=p,p.stores=[d]):(T=p.stores,T===null?p.stores=[d]:T.push(d))}function Cp(d,p,T,R){p.value=T,p.getSnapshot=R,Uh(p)&&Ld(d)}function zf(d,p,T){return T(function(){Uh(p)&&Ld(d)})}function Uh(d){var p=d.getSnapshot;d=d.value;try{var T=p();return!ga(d,T)}catch{return!0}}function Ld(d){var p=Ya(d,1);p!==null&&Mt(p,d,1,-1)}function Od(d){var p=gs();return typeof d=="function"&&(d=d()),p.memoizedState=p.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:gc,lastRenderedState:d},p.queue=d,d=d.dispatch=Bd.bind(null,Gi,d),[p.memoizedState,d]}function Zu(d,p,T,R){return d={tag:d,create:p,destroy:T,deps:R,next:null},p=Gi.updateQueue,p===null?(p={lastEffect:null,stores:null},Gi.updateQueue=p,p.lastEffect=d.next=d):(T=p.lastEffect,T===null?p.lastEffect=d.next=d:(R=T.next,T.next=d,d.next=R,p.lastEffect=d)),d}function $h(){return wo().memoizedState}function _c(d,p,T,R){var N=gs();Gi.flags|=d,N.memoizedState=Zu(1|p,T,void 0,R===void 0?null:R)}function el(d,p,T,R){var N=wo();R=R===void 0?null:R;var Z=void 0;if(ms!==null){var de=ms.memoizedState;if(Z=de.destroy,R!==null&&Al(R,de.deps)){N.memoizedState=Zu(p,T,Z,R);return}}Gi.flags|=d,N.memoizedState=Zu(1|p,T,Z,R)}function Fd(d,p){return _c(8390656,8,d,p)}function tl(d,p){return el(2048,8,d,p)}function Vs(d,p){return el(4,2,d,p)}function Mp(d,p){return el(4,4,d,p)}function Xu(d,p){if(typeof p=="function")return d=d(),p(d),function(){p(null)};if(p!=null)return d=d(),p.current=d,function(){p.current=null}}function Kn(d,p,T){return T=T!=null?T.concat([d]):null,el(4,4,Xu.bind(null,p,d),T)}function pn(){}function Nd(d,p){var T=wo();p=p===void 0?null:p;var R=T.memoizedState;return R!==null&&p!==null&&Al(p,R[1])?R[0]:(T.memoizedState=[d,p],d)}function rl(d,p){var T=wo();p=p===void 0?null:p;var R=T.memoizedState;return R!==null&&p!==null&&Al(p,R[1])?R[0]:(d=d(),T.memoizedState=[d,p],d)}function Yu(d,p,T){return(Bo&21)===0?(d.baseState&&(d.baseState=!1,to=!0),d.memoizedState=T):(ga(T,p)||(T=ha(),Gi.lanes|=T,pe|=T,d.baseState=!0),p)}function Ku(d,p){var T=Yn;Yn=T!==0&&4>T?T:4,d(!0);var R=Qc.transition;Qc.transition={};try{d(!1),p()}finally{Yn=T,Qc.transition=R}}function Cl(){return wo().memoizedState}function kf(d,p,T){var R=Lt(d);if(T={lane:R,action:T,hasEagerState:!1,eagerState:null,next:null},tu(d))jd(p,T);else if(T=Pf(d,p,T,R),T!==null){var N=Pt();Mt(T,d,R,N),Ra(T,p,R)}}function Bd(d,p,T){var R=Lt(d),N={lane:R,action:T,hasEagerState:!1,eagerState:null,next:null};if(tu(d))jd(p,N);else{var Z=d.alternate;if(d.lanes===0&&(Z===null||Z.lanes===0)&&(Z=p.lastRenderedReducer,Z!==null))try{var de=p.lastRenderedState,De=Z(de,T);if(N.hasEagerState=!0,N.eagerState=De,ga(De,de)){var Ge=p.interleaved;Ge===null?(N.next=N,Ft(p)):(N.next=Ge.next,Ge.next=N),p.interleaved=N;return}}catch{}finally{}T=Pf(d,p,N,R),T!==null&&(N=Pt(),Mt(T,d,R,N),Ra(T,p,R))}}function tu(d){var p=d.alternate;return d===Gi||p!==null&&p===Gi}function jd(d,p){Qa=kd=!0;var T=d.pending;T===null?p.next=p:(p.next=T.next,T.next=p),d.pending=p}function Ra(d,p,T){if((T&4194240)!==0){var R=p.lanes;R&=d.pendingLanes,T|=R,p.lanes=T,Xo(d,T)}}var za={readContext:ps,useCallback:It,useContext:It,useEffect:It,useImperativeHandle:It,useInsertionEffect:It,useLayoutEffect:It,useMemo:It,useReducer:It,useRef:It,useState:It,useDebugValue:It,useDeferredValue:It,useTransition:It,useMutableSource:It,useSyncExternalStore:It,useId:It,unstable_isNewReconciler:!1},Gh={readContext:ps,useCallback:function(d,p){return gs().memoizedState=[d,p===void 0?null:p],d},useContext:ps,useEffect:Fd,useImperativeHandle:function(d,p,T){return T=T!=null?T.concat([d]):null,_c(4194308,4,Xu.bind(null,p,d),T)},useLayoutEffect:function(d,p){return _c(4194308,4,d,p)},useInsertionEffect:function(d,p){return _c(4,2,d,p)},useMemo:function(d,p){var T=gs();return p=p===void 0?null:p,d=d(),T.memoizedState=[d,p],d},useReducer:function(d,p,T){var R=gs();return p=T!==void 0?T(p):p,R.memoizedState=R.baseState=p,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:p},R.queue=d,d=d.dispatch=kf.bind(null,Gi,d),[R.memoizedState,d]},useRef:function(d){var p=gs();return d={current:d},p.memoizedState=d},useState:Od,useDebugValue:pn,useDeferredValue:function(d){return gs().memoizedState=d},useTransition:function(){var d=Od(!1),p=d[0];return d=Ku.bind(null,d[1]),gs().memoizedState=d,[p,d]},useMutableSource:function(){},useSyncExternalStore:function(d,p,T){var R=Gi,N=gs();if(Ni){if(T===void 0)throw Error(I(407));T=T()}else{if(T=p(),W===null)throw Error(I(349));(Bo&30)!==0||Ap(R,p,T)}N.memoizedState=T;var Z={value:T,getSnapshot:p};return N.queue=Z,Fd(zf.bind(null,R,Z,d),[d]),R.flags|=2048,Zu(9,Cp.bind(null,R,Z,T,p),void 0,null),T},useId:function(){var d=gs(),p=W.identifierPrefix;if(Ni){var T=Za,R=Ca;T=(R&~(1<<32-po(R)-1)).toString(32)+T,p=":"+p+"R"+T,T=Pa++,0<T&&(p+="H"+T.toString(32)),p+=":"}else T=gt++,p=":"+p+"r"+T.toString(32)+":";return d.memoizedState=p},unstable_isNewReconciler:!1},Vd={readContext:ps,useCallback:Nd,useContext:ps,useEffect:tl,useImperativeHandle:Kn,useInsertionEffect:Vs,useLayoutEffect:Mp,useMemo:rl,useReducer:Vh,useRef:$h,useState:function(){return Vh(gc)},useDebugValue:pn,useDeferredValue:function(d){var p=wo();return Yu(p,ms.memoizedState,d)},useTransition:function(){var d=Vh(gc)[0],p=wo().memoizedState;return[d,p]},useMutableSource:Rf,useSyncExternalStore:eu,useId:Cl,unstable_isNewReconciler:!1},Ju={readContext:ps,useCallback:Nd,useContext:ps,useEffect:tl,useImperativeHandle:Kn,useInsertionEffect:Vs,useLayoutEffect:Mp,useMemo:rl,useReducer:Dd,useRef:$h,useState:function(){return Dd(gc)},useDebugValue:pn,useDeferredValue:function(d){var p=wo();return ms===null?p.memoizedState=d:Yu(p,ms.memoizedState,d)},useTransition:function(){var d=Dd(gc)[0],p=wo().memoizedState;return[d,p]},useMutableSource:Rf,useSyncExternalStore:eu,useId:Cl,unstable_isNewReconciler:!1};function eo(d,p){if(d&&d.defaultProps){p=Ht({},p),d=d.defaultProps;for(var T in d)p[T]===void 0&&(p[T]=d[T]);return p}return p}function os(d,p,T,R){p=d.memoizedState,T=T(R,p),T=T==null?p:Ht({},p,T),d.memoizedState=T,d.lanes===0&&(d.updateQueue.baseState=T)}var Ml={isMounted:function(d){return(d=d._reactInternals)?Ue(d)===d:!1},enqueueSetState:function(d,p,T){d=d._reactInternals;var R=Pt(),N=Lt(d),Z=ea(R,N);Z.payload=p,T!=null&&(Z.callback=T),p=pc(d,Z,N),p!==null&&(Mt(p,d,N,R),Pd(p,d,N))},enqueueReplaceState:function(d,p,T){d=d._reactInternals;var R=Pt(),N=Lt(d),Z=ea(R,N);Z.tag=1,Z.payload=p,T!=null&&(Z.callback=T),p=pc(d,Z,N),p!==null&&(Mt(p,d,N,R),Pd(p,d,N))},enqueueForceUpdate:function(d,p){d=d._reactInternals;var T=Pt(),R=Lt(d),N=ea(T,R);N.tag=2,p!=null&&(N.callback=p),p=pc(d,N,R),p!==null&&(Mt(p,d,R,T),Pd(p,d,R))}};function Pl(d,p,T,R,N,Z,de){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(R,Z,de):p.prototype&&p.prototype.isPureReactComponent?!Ea(T,R)||!Ea(N,Z):!0}function Ud(d,p,T){var R=!1,N=Do,Z=p.contextType;return typeof Z=="object"&&Z!==null?Z=ps(Z):(N=Fs(p)?Es:Ki.current,R=p.contextTypes,Z=(R=R!=null)?Tl(d,N):Do),p=new p(T,Z),d.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,p.updater=Ml,d.stateNode=p,p._reactInternals=d,R&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=N,d.__reactInternalMemoizedMaskedChildContext=Z),p}function qh(d,p,T,R){d=p.state,typeof p.componentWillReceiveProps=="function"&&p.componentWillReceiveProps(T,R),typeof p.UNSAFE_componentWillReceiveProps=="function"&&p.UNSAFE_componentWillReceiveProps(T,R),p.state!==d&&Ml.enqueueReplaceState(p,p.state,null)}function Hh(d,p,T,R){var N=d.stateNode;N.props=T,N.state=d.memoizedState,N.refs={},Ka(d);var Z=p.contextType;typeof Z=="object"&&Z!==null?N.context=ps(Z):(Z=Fs(p)?Es:Ki.current,N.context=Tl(d,Z)),N.state=d.memoizedState,Z=p.getDerivedStateFromProps,typeof Z=="function"&&(os(d,p,Z,T),N.state=d.memoizedState),typeof p.getDerivedStateFromProps=="function"||typeof N.getSnapshotBeforeUpdate=="function"||typeof N.UNSAFE_componentWillMount!="function"&&typeof N.componentWillMount!="function"||(p=N.state,typeof N.componentWillMount=="function"&&N.componentWillMount(),typeof N.UNSAFE_componentWillMount=="function"&&N.UNSAFE_componentWillMount(),p!==N.state&&Ml.enqueueReplaceState(N,N.state,null),Bh(d,T,N,R),N.state=d.memoizedState),typeof N.componentDidMount=="function"&&(d.flags|=4194308)}function nl(d,p){try{var T="",R=p;do T+=br(R),R=R.return;while(R);var N=T}catch(Z){N=`
Error generating stack: `+Z.message+`
`+Z.stack}return{value:d,source:p,stack:N,digest:null}}function as(d,p,T){return{value:d,source:null,stack:T??null,digest:p??null}}function ru(d,p){try{console.error(p.value)}catch(T){setTimeout(function(){throw T})}}var Df=typeof WeakMap=="function"?WeakMap:Map;function $d(d,p,T){T=ea(-1,T),T.tag=3,T.payload={element:null};var R=p.value;return T.callback=function(){ot||(ot=!0,ze=R),ru(d,p)},T}function Rl(d,p,T){T=ea(-1,T),T.tag=3;var R=d.type.getDerivedStateFromError;if(typeof R=="function"){var N=p.value;T.payload=function(){return R(N)},T.callback=function(){ru(d,p)}}var Z=d.stateNode;return Z!==null&&typeof Z.componentDidCatch=="function"&&(T.callback=function(){ru(d,p),typeof R!="function"&&($e===null?$e=new Set([this]):$e.add(this));var de=p.stack;this.componentDidCatch(p.value,{componentStack:de!==null?de:""})}),T}function Qu(d,p,T){var R=d.pingCache;if(R===null){R=d.pingCache=new Df;var N=new Set;R.set(p,N)}else N=R.get(p),N===void 0&&(N=new Set,R.set(p,N));N.has(T)||(N.add(T),d=bi.bind(null,d,p,T),p.then(d,d))}function Gd(d){do{var p;if((p=d.tag===13)&&(p=d.memoizedState,p=p!==null?p.dehydrated!==null:!0),p)return d;d=d.return}while(d!==null);return null}function Wh(d,p,T,R,N){return(d.mode&1)===0?(d===p?d.flags|=65536:(d.flags|=128,T.flags|=131072,T.flags&=-52805,T.tag===1&&(T.alternate===null?T.tag=17:(p=ea(-1,1),p.tag=2,pc(T,p,1))),T.lanes|=1),d):(d.flags|=65536,d.lanes=N,d)}var nu=jt.ReactCurrentOwner,to=!1;function Cs(d,p,T,R){p.child=d===null?Xa(p,null,T,R):Sl(p,d.child,T,R)}function iu(d,p,T,R,N){T=T.render;var Z=p.ref;return fc(p,N),R=fi(d,p,T,R,Z,N),T=ke(),d!==null&&!to?(p.updateQueue=d.updateQueue,p.flags&=-2053,d.lanes&=~N,$n(d,p,N)):(Ni&&T&&kh(p),p.flags|=1,Cs(d,p,R,N),p.child)}function eh(d,p,T,R,N){if(d===null){var Z=T.type;return typeof Z=="function"&&!jo(Z)&&Z.defaultProps===void 0&&T.compare===null&&T.defaultProps===void 0?(p.tag=15,p.type=Z,qd(d,p,Z,R,N)):(d=Vo(T.type,null,R,p,p.mode,N),d.ref=p.ref,d.return=p,p.child=d)}if(Z=d.child,(d.lanes&N)===0){var de=Z.memoizedProps;if(T=T.compare,T=T!==null?T:Ea,T(de,R)&&d.ref===p.ref)return $n(d,p,N)}return p.flags|=1,d=So(Z,R),d.ref=p.ref,d.return=p,p.child=d}function qd(d,p,T,R,N){if(d!==null){var Z=d.memoizedProps;if(Ea(Z,R)&&d.ref===p.ref)if(to=!1,p.pendingProps=R=Z,(d.lanes&N)!==0)(d.flags&131072)!==0&&(to=!0);else return p.lanes=d.lanes,$n(d,p,N)}return th(d,p,T,R,N)}function Zh(d,p,T){var R=p.pendingProps,N=R.children,Z=d!==null?d.memoizedState:null;if(R.mode==="hidden")if((p.mode&1)===0)p.memoizedState={baseLanes:0,cachePool:null,transitions:null},Di(le,se),se|=T;else{if((T&1073741824)===0)return d=Z!==null?Z.baseLanes|T:T,p.lanes=p.childLanes=1073741824,p.memoizedState={baseLanes:d,cachePool:null,transitions:null},p.updateQueue=null,Di(le,se),se|=d,null;p.memoizedState={baseLanes:0,cachePool:null,transitions:null},R=Z!==null?Z.baseLanes:T,Di(le,se),se|=R}else Z!==null?(R=Z.baseLanes|T,p.memoizedState=null):R=T,Di(le,se),se|=R;return Cs(d,p,N,T),p.child}function Lf(d,p){var T=p.ref;(d===null&&T!==null||d!==null&&d.ref!==T)&&(p.flags|=512,p.flags|=2097152)}function th(d,p,T,R,N){var Z=Fs(T)?Es:Ki.current;return Z=Tl(p,Z),fc(p,N),T=fi(d,p,T,R,Z,N),R=ke(),d!==null&&!to?(p.updateQueue=d.updateQueue,p.flags&=-2053,d.lanes&=~N,$n(d,p,N)):(Ni&&R&&kh(p),p.flags|=1,Cs(d,p,T,N),p.child)}function Of(d,p,T,R,N){if(Fs(T)){var Z=!0;Wc(p)}else Z=!1;if(fc(p,N),p.stateNode===null)su(d,p),Ud(p,T,R),Hh(p,T,R,N),R=!0;else if(d===null){var de=p.stateNode,De=p.memoizedProps;de.props=De;var Ge=de.context,_t=T.contextType;typeof _t=="object"&&_t!==null?_t=ps(_t):(_t=Fs(T)?Es:Ki.current,_t=Tl(p,_t));var tr=T.getDerivedStateFromProps,rr=typeof tr=="function"||typeof de.getSnapshotBeforeUpdate=="function";rr||typeof de.UNSAFE_componentWillReceiveProps!="function"&&typeof de.componentWillReceiveProps!="function"||(De!==R||Ge!==_t)&&qh(p,de,R,_t),xo=!1;var Jt=p.memoizedState;de.state=Jt,Bh(p,R,de,N),Ge=p.memoizedState,De!==R||Jt!==Ge||_o.current||xo?(typeof tr=="function"&&(os(p,T,tr,R),Ge=p.memoizedState),(De=xo||Pl(p,T,De,R,Jt,Ge,_t))?(rr||typeof de.UNSAFE_componentWillMount!="function"&&typeof de.componentWillMount!="function"||(typeof de.componentWillMount=="function"&&de.componentWillMount(),typeof de.UNSAFE_componentWillMount=="function"&&de.UNSAFE_componentWillMount()),typeof de.componentDidMount=="function"&&(p.flags|=4194308)):(typeof de.componentDidMount=="function"&&(p.flags|=4194308),p.memoizedProps=R,p.memoizedState=Ge),de.props=R,de.state=Ge,de.context=_t,R=De):(typeof de.componentDidMount=="function"&&(p.flags|=4194308),R=!1)}else{de=p.stateNode,sr(d,p),De=p.memoizedProps,_t=p.type===p.elementType?De:eo(p.type,De),de.props=_t,rr=p.pendingProps,Jt=de.context,Ge=T.contextType,typeof Ge=="object"&&Ge!==null?Ge=ps(Ge):(Ge=Fs(T)?Es:Ki.current,Ge=Tl(p,Ge));var Ir=T.getDerivedStateFromProps;(tr=typeof Ir=="function"||typeof de.getSnapshotBeforeUpdate=="function")||typeof de.UNSAFE_componentWillReceiveProps!="function"&&typeof de.componentWillReceiveProps!="function"||(De!==rr||Jt!==Ge)&&qh(p,de,R,Ge),xo=!1,Jt=p.memoizedState,de.state=Jt,Bh(p,R,de,N);var Or=p.memoizedState;De!==rr||Jt!==Or||_o.current||xo?(typeof Ir=="function"&&(os(p,T,Ir,R),Or=p.memoizedState),(_t=xo||Pl(p,T,_t,R,Jt,Or,Ge)||!1)?(tr||typeof de.UNSAFE_componentWillUpdate!="function"&&typeof de.componentWillUpdate!="function"||(typeof de.componentWillUpdate=="function"&&de.componentWillUpdate(R,Or,Ge),typeof de.UNSAFE_componentWillUpdate=="function"&&de.UNSAFE_componentWillUpdate(R,Or,Ge)),typeof de.componentDidUpdate=="function"&&(p.flags|=4),typeof de.getSnapshotBeforeUpdate=="function"&&(p.flags|=1024)):(typeof de.componentDidUpdate!="function"||De===d.memoizedProps&&Jt===d.memoizedState||(p.flags|=4),typeof de.getSnapshotBeforeUpdate!="function"||De===d.memoizedProps&&Jt===d.memoizedState||(p.flags|=1024),p.memoizedProps=R,p.memoizedState=Or),de.props=R,de.state=Or,de.context=Ge,R=_t):(typeof de.componentDidUpdate!="function"||De===d.memoizedProps&&Jt===d.memoizedState||(p.flags|=4),typeof de.getSnapshotBeforeUpdate!="function"||De===d.memoizedProps&&Jt===d.memoizedState||(p.flags|=1024),R=!1)}return Hd(d,p,T,R,Z,N)}function Hd(d,p,T,R,N,Z){Lf(d,p);var de=(p.flags&128)!==0;if(!R&&!de)return N&&Bu(p,T,!1),$n(d,p,Z);R=p.stateNode,nu.current=p;var De=de&&typeof T.getDerivedStateFromError!="function"?null:R.render();return p.flags|=1,d!==null&&de?(p.child=Sl(p,d.child,null,Z),p.child=Sl(p,null,De,Z)):Cs(d,p,De,Z),p.memoizedState=R.state,N&&Bu(p,T,!0),p.child}function Ff(d){var p=d.stateNode;p.pendingContext?Sd(d,p.pendingContext,p.pendingContext!==p.context):p.context&&Sd(d,p.context,!1),js(d,p.containerInfo)}function Nf(d,p,T,R,N){return Yc(),Fo(N),p.flags|=256,Cs(d,p,T,R),p.child}var Xh={dehydrated:null,treeContext:null,retryLane:0};function Wd(d){return{baseLanes:d,cachePool:null,transitions:null}}function Bf(d,p,T){var R=p.pendingProps,N=Li.current,Z=!1,de=(p.flags&128)!==0,De;if((De=de)||(De=d!==null&&d.memoizedState===null?!1:(N&2)!==0),De?(Z=!0,p.flags&=-129):(d===null||d.memoizedState!==null)&&(N|=1),Di(Li,N&1),d===null)return Oh(p),d=p.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((p.mode&1)===0?p.lanes=1:d.data==="$!"?p.lanes=8:p.lanes=1073741824,null):(de=R.children,d=R.fallback,Z?(R=p.mode,Z=p.child,de={mode:"hidden",children:de},(R&1)===0&&Z!==null?(Z.childLanes=0,Z.pendingProps=de):Z=yc(de,R,0,null),d=Uo(d,R,T,null),Z.return=p,d.return=p,Z.sibling=d,p.child=Z,p.child.memoizedState=Wd(T),p.memoizedState=Xh,d):Zd(p,de));if(N=d.memoizedState,N!==null&&(De=N.dehydrated,De!==null))return Pp(d,p,de,R,De,N,T);if(Z){Z=R.fallback,de=p.mode,N=d.child,De=N.sibling;var Ge={mode:"hidden",children:R.children};return(de&1)===0&&p.child!==N?(R=p.child,R.childLanes=0,R.pendingProps=Ge,p.deletions=null):(R=So(N,Ge),R.subtreeFlags=N.subtreeFlags&14680064),De!==null?Z=So(De,Z):(Z=Uo(Z,de,T,null),Z.flags|=2),Z.return=p,R.return=p,R.sibling=Z,p.child=R,R=Z,Z=p.child,de=d.child.memoizedState,de=de===null?Wd(T):{baseLanes:de.baseLanes|T,cachePool:null,transitions:de.transitions},Z.memoizedState=de,Z.childLanes=d.childLanes&~T,p.memoizedState=Xh,R}return Z=d.child,d=Z.sibling,R=So(Z,{mode:"visible",children:R.children}),(p.mode&1)===0&&(R.lanes=T),R.return=p,R.sibling=null,d!==null&&(T=p.deletions,T===null?(p.deletions=[d],p.flags|=16):T.push(d)),p.child=R,p.memoizedState=null,R}function Zd(d,p){return p=yc({mode:"visible",children:p},d.mode,0,null),p.return=d,d.child=p}function Yh(d,p,T,R){return R!==null&&Fo(R),Sl(p,d.child,null,T),d=Zd(p,p.pendingProps.children),d.flags|=2,p.memoizedState=null,d}function Pp(d,p,T,R,N,Z,de){if(T)return p.flags&256?(p.flags&=-257,R=as(Error(I(422))),Yh(d,p,de,R)):p.memoizedState!==null?(p.child=d.child,p.flags|=128,null):(Z=R.fallback,N=p.mode,R=yc({mode:"visible",children:R.children},N,0,null),Z=Uo(Z,N,de,null),Z.flags|=2,R.return=p,Z.return=p,R.sibling=Z,p.child=R,(p.mode&1)!==0&&Sl(p,d.child,null,de),p.child.memoizedState=Wd(de),p.memoizedState=Xh,Z);if((p.mode&1)===0)return Yh(d,p,de,null);if(N.data==="$!"){if(R=N.nextSibling&&N.nextSibling.dataset,R)var De=R.dgst;return R=De,Z=Error(I(419)),R=as(Z,R,void 0),Yh(d,p,de,R)}if(De=(de&d.childLanes)!==0,to||De){if(R=W,R!==null){switch(de&-de){case 4:N=2;break;case 16:N=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:N=32;break;case 536870912:N=268435456;break;default:N=0}N=(N&(R.suspendedLanes|de))!==0?0:N,N!==0&&N!==Z.retryLane&&(Z.retryLane=N,Ya(d,N),Mt(R,d,N,-1))}return qn(),R=as(Error(I(421))),Yh(d,p,de,R)}return N.data==="$?"?(p.flags|=128,p.child=d.child,p=ri.bind(null,d),N._reactRetry=p,null):(d=Z.treeContext,Is=Ua(N.nextSibling),fs=p,Ni=!0,Ns=null,d!==null&&(yo[_a++]=Ca,yo[_a++]=Za,yo[_a++]=Wa,Ca=d.id,Za=d.overflow,Wa=p),p=Zd(p,R.children),p.flags|=4096,p)}function jf(d,p,T){d.lanes|=p;var R=d.alternate;R!==null&&(R.lanes|=p),Nh(d.return,p,T)}function Vf(d,p,T,R,N){var Z=d.memoizedState;Z===null?d.memoizedState={isBackwards:p,rendering:null,renderingStartTime:0,last:R,tail:T,tailMode:N}:(Z.isBackwards=p,Z.rendering=null,Z.renderingStartTime=0,Z.last=R,Z.tail=T,Z.tailMode=N)}function Rp(d,p,T){var R=p.pendingProps,N=R.revealOrder,Z=R.tail;if(Cs(d,p,R.children,T),R=Li.current,(R&2)!==0)R=R&1|2,p.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=p.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&jf(d,T,p);else if(d.tag===19)jf(d,T,p);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===p)break e;for(;d.sibling===null;){if(d.return===null||d.return===p)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}R&=1}if(Di(Li,R),(p.mode&1)===0)p.memoizedState=null;else switch(N){case"forwards":for(T=p.child,N=null;T!==null;)d=T.alternate,d!==null&&Il(d)===null&&(N=T),T=T.sibling;T=N,T===null?(N=p.child,p.child=null):(N=T.sibling,T.sibling=null),Vf(p,!1,N,T,Z);break;case"backwards":for(T=null,N=p.child,p.child=null;N!==null;){if(d=N.alternate,d!==null&&Il(d)===null){p.child=N;break}d=N.sibling,N.sibling=T,T=N,N=d}Vf(p,!0,T,null,Z);break;case"together":Vf(p,!1,null,null,void 0);break;default:p.memoizedState=null}return p.child}function su(d,p){(p.mode&1)===0&&d!==null&&(d.alternate=null,p.alternate=null,p.flags|=2)}function $n(d,p,T){if(d!==null&&(p.dependencies=d.dependencies),pe|=p.lanes,(T&p.childLanes)===0)return null;if(d!==null&&p.child!==d.child)throw Error(I(153));if(p.child!==null){for(d=p.child,T=So(d,d.pendingProps),p.child=T,T.return=p;d.sibling!==null;)d=d.sibling,T=T.sibling=So(d,d.pendingProps),T.return=p;T.sibling=null}return p.child}function zp(d,p,T){switch(p.tag){case 3:Ff(p),Yc();break;case 5:mc(p);break;case 1:Fs(p.type)&&Wc(p);break;case 4:js(p,p.stateNode.containerInfo);break;case 10:var R=p.type._context,N=p.memoizedProps.value;Di(cc,R._currentValue),R._currentValue=N;break;case 13:if(R=p.memoizedState,R!==null)return R.dehydrated!==null?(Di(Li,Li.current&1),p.flags|=128,null):(T&p.child.childLanes)!==0?Bf(d,p,T):(Di(Li,Li.current&1),d=$n(d,p,T),d!==null?d.sibling:null);Di(Li,Li.current&1);break;case 19:if(R=(T&p.childLanes)!==0,(d.flags&128)!==0){if(R)return Rp(d,p,T);p.flags|=128}if(N=p.memoizedState,N!==null&&(N.rendering=null,N.tail=null,N.lastEffect=null),Di(Li,Li.current),R)break;return null;case 22:case 23:return p.lanes=0,Zh(d,p,T)}return $n(d,p,T)}var Kh,Jh,Uf,rh;Kh=function(d,p){for(var T=p.child;T!==null;){if(T.tag===5||T.tag===6)d.appendChild(T.stateNode);else if(T.tag!==4&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===p)break;for(;T.sibling===null;){if(T.return===null||T.return===p)return;T=T.return}T.sibling.return=T.return,T=T.sibling}},Jh=function(){},Uf=function(d,p,T,R){var N=d.memoizedProps;if(N!==R){d=p.stateNode,El(Ja.current);var Z=null;switch(T){case"input":N=xn(d,N),R=xn(d,R),Z=[];break;case"select":N=Ht({},N,{value:void 0}),R=Ht({},R,{value:void 0}),Z=[];break;case"textarea":N=la(d,N),R=la(d,R),Z=[];break;default:typeof N.onClick!="function"&&typeof R.onClick=="function"&&(d.onclick=bl)}ua(T,R);var de;T=null;for(_t in N)if(!R.hasOwnProperty(_t)&&N.hasOwnProperty(_t)&&N[_t]!=null)if(_t==="style"){var De=N[_t];for(de in De)De.hasOwnProperty(de)&&(T||(T={}),T[de]="")}else _t!=="dangerouslySetInnerHTML"&&_t!=="children"&&_t!=="suppressContentEditableWarning"&&_t!=="suppressHydrationWarning"&&_t!=="autoFocus"&&(B.hasOwnProperty(_t)?Z||(Z=[]):(Z=Z||[]).push(_t,null));for(_t in R){var Ge=R[_t];if(De=N?.[_t],R.hasOwnProperty(_t)&&Ge!==De&&(Ge!=null||De!=null))if(_t==="style")if(De){for(de in De)!De.hasOwnProperty(de)||Ge&&Ge.hasOwnProperty(de)||(T||(T={}),T[de]="");for(de in Ge)Ge.hasOwnProperty(de)&&De[de]!==Ge[de]&&(T||(T={}),T[de]=Ge[de])}else T||(Z||(Z=[]),Z.push(_t,T)),T=Ge;else _t==="dangerouslySetInnerHTML"?(Ge=Ge?Ge.__html:void 0,De=De?De.__html:void 0,Ge!=null&&De!==Ge&&(Z=Z||[]).push(_t,Ge)):_t==="children"?typeof Ge!="string"&&typeof Ge!="number"||(Z=Z||[]).push(_t,""+Ge):_t!=="suppressContentEditableWarning"&&_t!=="suppressHydrationWarning"&&(B.hasOwnProperty(_t)?(Ge!=null&&_t==="onScroll"&&zi("scroll",d),Z||De===Ge||(Z=[])):(Z=Z||[]).push(_t,Ge))}T&&(Z=Z||[]).push("style",T);var _t=Z;(p.updateQueue=_t)&&(p.flags|=4)}},rh=function(d,p,T,R){T!==R&&(p.flags|=4)};function ou(d,p){if(!Ni)switch(d.tailMode){case"hidden":p=d.tail;for(var T=null;p!==null;)p.alternate!==null&&(T=p),p=p.sibling;T===null?d.tail=null:T.sibling=null;break;case"collapsed":T=d.tail;for(var R=null;T!==null;)T.alternate!==null&&(R=T),T=T.sibling;R===null?p||d.tail===null?d.tail=null:d.tail.sibling=null:R.sibling=null}}function Ms(d){var p=d.alternate!==null&&d.alternate.child===d.child,T=0,R=0;if(p)for(var N=d.child;N!==null;)T|=N.lanes|N.childLanes,R|=N.subtreeFlags&14680064,R|=N.flags&14680064,N.return=d,N=N.sibling;else for(N=d.child;N!==null;)T|=N.lanes|N.childLanes,R|=N.subtreeFlags,R|=N.flags,N.return=d,N=N.sibling;return d.subtreeFlags|=R,d.childLanes=T,p}function Qh(d,p,T){var R=p.pendingProps;switch(Md(p),p.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ms(p),null;case 1:return Fs(p.type)&&Hc(),Ms(p),null;case 3:return R=p.stateNode,No(),ki(_o),ki(Ki),Ma(),R.pendingContext&&(R.context=R.pendingContext,R.pendingContext=null),(d===null||d.child===null)&&(lc(p)?p.flags|=4:d===null||d.memoizedState.isDehydrated&&(p.flags&256)===0||(p.flags|=1024,Ns!==null&&(dr(Ns),Ns=null))),Jh(d,p),Ms(p),null;case 5:Wu(p);var N=El(Bs.current);if(T=p.type,d!==null&&p.stateNode!=null)Uf(d,p,T,R,N),d.ref!==p.ref&&(p.flags|=512,p.flags|=2097152);else{if(!R){if(p.stateNode===null)throw Error(I(166));return Ms(p),null}if(d=El(Ja.current),lc(p)){R=p.stateNode,T=p.type;var Z=p.memoizedProps;switch(R[Aa]=p,R[Fu]=Z,d=(p.mode&1)!==0,T){case"dialog":zi("cancel",R),zi("close",R);break;case"iframe":case"object":case"embed":zi("load",R);break;case"video":case"audio":for(N=0;N<sc.length;N++)zi(sc[N],R);break;case"source":zi("error",R);break;case"img":case"image":case"link":zi("error",R),zi("load",R);break;case"details":zi("toggle",R);break;case"input":aa(R,Z),zi("invalid",R);break;case"select":R._wrapperState={wasMultiple:!!Z.multiple},zi("invalid",R);break;case"textarea":ho(R,Z),zi("invalid",R)}ua(T,Z),N=null;for(var de in Z)if(Z.hasOwnProperty(de)){var De=Z[de];de==="children"?typeof De=="string"?R.textContent!==De&&(Z.suppressHydrationWarning!==!0&&Va(R.textContent,De,d),N=["children",De]):typeof De=="number"&&R.textContent!==""+De&&(Z.suppressHydrationWarning!==!0&&Va(R.textContent,De,d),N=["children",""+De]):B.hasOwnProperty(de)&&De!=null&&de==="onScroll"&&zi("scroll",R)}switch(T){case"input":qi(R),Ul(R,Z,!0);break;case"textarea":qi(R),Oa(R);break;case"select":case"option":break;default:typeof Z.onClick=="function"&&(R.onclick=bl)}R=N,p.updateQueue=R,R!==null&&(p.flags|=4)}else{de=N.nodeType===9?N:N.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=hl(T)),d==="http://www.w3.org/1999/xhtml"?T==="script"?(d=de.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof R.is=="string"?d=de.createElement(T,{is:R.is}):(d=de.createElement(T),T==="select"&&(de=d,R.multiple?de.multiple=!0:R.size&&(de.size=R.size))):d=de.createElementNS(d,T),d[Aa]=p,d[Fu]=R,Kh(d,p,!1,!1),p.stateNode=d;e:{switch(de=Fa(T,R),T){case"dialog":zi("cancel",d),zi("close",d),N=R;break;case"iframe":case"object":case"embed":zi("load",d),N=R;break;case"video":case"audio":for(N=0;N<sc.length;N++)zi(sc[N],d);N=R;break;case"source":zi("error",d),N=R;break;case"img":case"image":case"link":zi("error",d),zi("load",d),N=R;break;case"details":zi("toggle",d),N=R;break;case"input":aa(d,R),N=xn(d,R),zi("invalid",d);break;case"option":N=R;break;case"select":d._wrapperState={wasMultiple:!!R.multiple},N=Ht({},R,{value:void 0}),zi("invalid",d);break;case"textarea":ho(d,R),N=la(d,R),zi("invalid",d);break;default:N=R}ua(T,N),De=N;for(Z in De)if(De.hasOwnProperty(Z)){var Ge=De[Z];Z==="style"?ba(d,Ge):Z==="dangerouslySetInnerHTML"?(Ge=Ge?Ge.__html:void 0,Ge!=null&&ca(d,Ge)):Z==="children"?typeof Ge=="string"?(T!=="textarea"||Ge!=="")&&Zo(d,Ge):typeof Ge=="number"&&Zo(d,""+Ge):Z!=="suppressContentEditableWarning"&&Z!=="suppressHydrationWarning"&&Z!=="autoFocus"&&(B.hasOwnProperty(Z)?Ge!=null&&Z==="onScroll"&&zi("scroll",d):Ge!=null&&Vt(d,Z,Ge,de))}switch(T){case"input":qi(d),Ul(d,R,!1);break;case"textarea":qi(d),Oa(d);break;case"option":R.value!=null&&d.setAttribute("value",""+vn(R.value));break;case"select":d.multiple=!!R.multiple,Z=R.value,Z!=null?Zs(d,!!R.multiple,Z,!1):R.defaultValue!=null&&Zs(d,!!R.multiple,R.defaultValue,!0);break;default:typeof N.onClick=="function"&&(d.onclick=bl)}switch(T){case"button":case"input":case"select":case"textarea":R=!!R.autoFocus;break e;case"img":R=!0;break e;default:R=!1}}R&&(p.flags|=4)}p.ref!==null&&(p.flags|=512,p.flags|=2097152)}return Ms(p),null;case 6:if(d&&p.stateNode!=null)rh(d,p,d.memoizedProps,R);else{if(typeof R!="string"&&p.stateNode===null)throw Error(I(166));if(T=El(Bs.current),El(Ja.current),lc(p)){if(R=p.stateNode,T=p.memoizedProps,R[Aa]=p,(Z=R.nodeValue!==T)&&(d=fs,d!==null))switch(d.tag){case 3:Va(R.nodeValue,T,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&Va(R.nodeValue,T,(d.mode&1)!==0)}Z&&(p.flags|=4)}else R=(T.nodeType===9?T:T.ownerDocument).createTextNode(R),R[Aa]=p,p.stateNode=R}return Ms(p),null;case 13:if(ki(Li),R=p.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(Ni&&Is!==null&&(p.mode&1)!==0&&(p.flags&128)===0)Mf(),Yc(),p.flags|=98560,Z=!1;else if(Z=lc(p),R!==null&&R.dehydrated!==null){if(d===null){if(!Z)throw Error(I(318));if(Z=p.memoizedState,Z=Z!==null?Z.dehydrated:null,!Z)throw Error(I(317));Z[Aa]=p}else Yc(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;Ms(p),Z=!1}else Ns!==null&&(dr(Ns),Ns=null),Z=!0;if(!Z)return p.flags&65536?p:null}return(p.flags&128)!==0?(p.lanes=T,p):(R=R!==null,R!==(d!==null&&d.memoizedState!==null)&&R&&(p.child.flags|=8192,(p.mode&1)!==0&&(d===null||(Li.current&1)!==0?ge===0&&(ge=3):qn())),p.updateQueue!==null&&(p.flags|=4),Ms(p),null);case 4:return No(),Jh(d,p),d===null&&Mh(p.stateNode.containerInfo),Ms(p),null;case 10:return qu(p.type._context),Ms(p),null;case 17:return Fs(p.type)&&Hc(),Ms(p),null;case 19:if(ki(Li),Z=p.memoizedState,Z===null)return Ms(p),null;if(R=(p.flags&128)!==0,de=Z.rendering,de===null)if(R)ou(Z,!1);else{if(ge!==0||d!==null&&(d.flags&128)!==0)for(d=p.child;d!==null;){if(de=Il(d),de!==null){for(p.flags|=128,ou(Z,!1),R=de.updateQueue,R!==null&&(p.updateQueue=R,p.flags|=4),p.subtreeFlags=0,R=T,T=p.child;T!==null;)Z=T,d=R,Z.flags&=14680066,de=Z.alternate,de===null?(Z.childLanes=0,Z.lanes=d,Z.child=null,Z.subtreeFlags=0,Z.memoizedProps=null,Z.memoizedState=null,Z.updateQueue=null,Z.dependencies=null,Z.stateNode=null):(Z.childLanes=de.childLanes,Z.lanes=de.lanes,Z.child=de.child,Z.subtreeFlags=0,Z.deletions=null,Z.memoizedProps=de.memoizedProps,Z.memoizedState=de.memoizedState,Z.updateQueue=de.updateQueue,Z.type=de.type,d=de.dependencies,Z.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),T=T.sibling;return Di(Li,Li.current&1|2),p.child}d=d.sibling}Z.tail!==null&&on()>Ye&&(p.flags|=128,R=!0,ou(Z,!1),p.lanes=4194304)}else{if(!R)if(d=Il(de),d!==null){if(p.flags|=128,R=!0,T=d.updateQueue,T!==null&&(p.updateQueue=T,p.flags|=4),ou(Z,!0),Z.tail===null&&Z.tailMode==="hidden"&&!de.alternate&&!Ni)return Ms(p),null}else 2*on()-Z.renderingStartTime>Ye&&T!==1073741824&&(p.flags|=128,R=!0,ou(Z,!1),p.lanes=4194304);Z.isBackwards?(de.sibling=p.child,p.child=de):(T=Z.last,T!==null?T.sibling=de:p.child=de,Z.last=de)}return Z.tail!==null?(p=Z.tail,Z.rendering=p,Z.tail=p.sibling,Z.renderingStartTime=on(),p.sibling=null,T=Li.current,Di(Li,R?T&1|2:T&1),p):(Ms(p),null);case 22:case 23:return wi(),R=p.memoizedState!==null,d!==null&&d.memoizedState!==null!==R&&(p.flags|=8192),R&&(p.mode&1)!==0?(se&1073741824)!==0&&(Ms(p),p.subtreeFlags&6&&(p.flags|=8192)):Ms(p),null;case 24:return null;case 25:return null}throw Error(I(156,p.tag))}function zl(d,p){switch(Md(p),p.tag){case 1:return Fs(p.type)&&Hc(),d=p.flags,d&65536?(p.flags=d&-65537|128,p):null;case 3:return No(),ki(_o),ki(Ki),Ma(),d=p.flags,(d&65536)!==0&&(d&128)===0?(p.flags=d&-65537|128,p):null;case 5:return Wu(p),null;case 13:if(ki(Li),d=p.memoizedState,d!==null&&d.dehydrated!==null){if(p.alternate===null)throw Error(I(340));Yc()}return d=p.flags,d&65536?(p.flags=d&-65537|128,p):null;case 19:return ki(Li),null;case 4:return No(),null;case 10:return qu(p.type._context),null;case 22:case 23:return wi(),null;case 24:return null;default:return null}}var au=!1,On=!1,il=typeof WeakSet=="function"?WeakSet:Set,Er=null;function kl(d,p){var T=d.ref;if(T!==null)if(typeof T=="function")try{T(null)}catch(R){zr(d,p,R)}else T.current=null}function Xd(d,p,T){try{T()}catch(R){zr(d,p,R)}}var kp=!1;function nh(d,p){if(ku=gh,d=gd(),Eh(d)){if("selectionStart"in d)var T={start:d.selectionStart,end:d.selectionEnd};else e:{T=(T=d.ownerDocument)&&T.defaultView||window;var R=T.getSelection&&T.getSelection();if(R&&R.rangeCount!==0){T=R.anchorNode;var N=R.anchorOffset,Z=R.focusNode;R=R.focusOffset;try{T.nodeType,Z.nodeType}catch{T=null;break e}var de=0,De=-1,Ge=-1,_t=0,tr=0,rr=d,Jt=null;t:for(;;){for(var Ir;rr!==T||N!==0&&rr.nodeType!==3||(De=de+N),rr!==Z||R!==0&&rr.nodeType!==3||(Ge=de+R),rr.nodeType===3&&(de+=rr.nodeValue.length),(Ir=rr.firstChild)!==null;)Jt=rr,rr=Ir;for(;;){if(rr===d)break t;if(Jt===T&&++_t===N&&(De=de),Jt===Z&&++tr===R&&(Ge=de),(Ir=rr.nextSibling)!==null)break;rr=Jt,Jt=rr.parentNode}rr=Ir}T=De===-1||Ge===-1?null:{start:De,end:Ge}}else T=null}T=T||{start:0,end:0}}else T=null;for(Du={focusedElem:d,selectionRange:T},gh=!1,Er=p;Er!==null;)if(p=Er,d=p.child,(p.subtreeFlags&1028)!==0&&d!==null)d.return=p,Er=d;else for(;Er!==null;){p=Er;try{var Or=p.alternate;if((p.flags&1024)!==0)switch(p.tag){case 0:case 11:case 15:break;case 1:if(Or!==null){var Ur=Or.memoizedProps,ys=Or.memoizedState,at=p.stateNode,et=at.getSnapshotBeforeUpdate(p.elementType===p.type?Ur:eo(p.type,Ur),ys);at.__reactInternalSnapshotBeforeUpdate=et}break;case 3:var dt=p.stateNode.containerInfo;dt.nodeType===1?dt.textContent="":dt.nodeType===9&&dt.documentElement&&dt.removeChild(dt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(I(163))}}catch(or){zr(p,p.return,or)}if(d=p.sibling,d!==null){d.return=p.return,Er=d;break}Er=p.return}return Or=kp,kp=!1,Or}function lu(d,p,T){var R=p.updateQueue;if(R=R!==null?R.lastEffect:null,R!==null){var N=R=R.next;do{if((N.tag&d)===d){var Z=N.destroy;N.destroy=void 0,Z!==void 0&&Xd(p,T,Z)}N=N.next}while(N!==R)}}function ta(d,p){if(p=p.updateQueue,p=p!==null?p.lastEffect:null,p!==null){var T=p=p.next;do{if((T.tag&d)===d){var R=T.create;T.destroy=R()}T=T.next}while(T!==p)}}function cu(d){var p=d.ref;if(p!==null){var T=d.stateNode;switch(d.tag){case 5:d=T;break;default:d=T}typeof p=="function"?p(d):p.current=d}}function Yd(d){var p=d.alternate;p!==null&&(d.alternate=null,Yd(p)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(p=d.stateNode,p!==null&&(delete p[Aa],delete p[Fu],delete p[qa],delete p[bp],delete p[Tp])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function ih(d){return d.tag===5||d.tag===3||d.tag===4}function uu(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||ih(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function ka(d,p,T){var R=d.tag;if(R===5||R===6)d=d.stateNode,p?T.nodeType===8?T.parentNode.insertBefore(d,p):T.insertBefore(d,p):(T.nodeType===8?(p=T.parentNode,p.insertBefore(d,T)):(p=T,p.appendChild(d)),T=T._reactRootContainer,T!=null||p.onclick!==null||(p.onclick=bl));else if(R!==4&&(d=d.child,d!==null))for(ka(d,p,T),d=d.sibling;d!==null;)ka(d,p,T),d=d.sibling}function ra(d,p,T){var R=d.tag;if(R===5||R===6)d=d.stateNode,p?T.insertBefore(d,p):T.appendChild(d);else if(R!==4&&(d=d.child,d!==null))for(ra(d,p,T),d=d.sibling;d!==null;)ra(d,p,T),d=d.sibling}var Ai=null,ro=!1;function l(d,p,T){for(T=T.child;T!==null;)t(d,p,T),T=T.sibling}function t(d,p,T){if(Ui&&typeof Ui.onCommitFiberUnmount=="function")try{Ui.onCommitFiberUnmount(Zi,T)}catch{}switch(T.tag){case 5:On||kl(T,p);case 6:var R=Ai,N=ro;Ai=null,l(d,p,T),Ai=R,ro=N,Ai!==null&&(ro?(d=Ai,T=T.stateNode,d.nodeType===8?d.parentNode.removeChild(T):d.removeChild(T)):Ai.removeChild(T.stateNode));break;case 18:Ai!==null&&(ro?(d=Ai,T=T.stateNode,d.nodeType===8?Ou(d.parentNode,T):d.nodeType===1&&Ou(d,T),Rc(d)):Ou(Ai,T.stateNode));break;case 4:R=Ai,N=ro,Ai=T.stateNode.containerInfo,ro=!0,l(d,p,T),Ai=R,ro=N;break;case 0:case 11:case 14:case 15:if(!On&&(R=T.updateQueue,R!==null&&(R=R.lastEffect,R!==null))){N=R=R.next;do{var Z=N,de=Z.destroy;Z=Z.tag,de!==void 0&&((Z&2)!==0||(Z&4)!==0)&&Xd(T,p,de),N=N.next}while(N!==R)}l(d,p,T);break;case 1:if(!On&&(kl(T,p),R=T.stateNode,typeof R.componentWillUnmount=="function"))try{R.props=T.memoizedProps,R.state=T.memoizedState,R.componentWillUnmount()}catch(De){zr(T,p,De)}l(d,p,T);break;case 21:l(d,p,T);break;case 22:T.mode&1?(On=(R=On)||T.memoizedState!==null,l(d,p,T),On=R):l(d,p,T);break;default:l(d,p,T)}}function i(d){var p=d.updateQueue;if(p!==null){d.updateQueue=null;var T=d.stateNode;T===null&&(T=d.stateNode=new il),p.forEach(function(R){var N=Tn.bind(null,d,R);T.has(R)||(T.add(R),R.then(N,N))})}}function c(d,p){var T=p.deletions;if(T!==null)for(var R=0;R<T.length;R++){var N=T[R];try{var Z=d,de=p,De=de;e:for(;De!==null;){switch(De.tag){case 5:Ai=De.stateNode,ro=!1;break e;case 3:Ai=De.stateNode.containerInfo,ro=!0;break e;case 4:Ai=De.stateNode.containerInfo,ro=!0;break e}De=De.return}if(Ai===null)throw Error(I(160));t(Z,de,N),Ai=null,ro=!1;var Ge=N.alternate;Ge!==null&&(Ge.return=null),N.return=null}catch(_t){zr(N,p,_t)}}if(p.subtreeFlags&12854)for(p=p.child;p!==null;)f(p,d),p=p.sibling}function f(d,p){var T=d.alternate,R=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(c(p,d),m(d),R&4){try{lu(3,d,d.return),ta(3,d)}catch(Ur){zr(d,d.return,Ur)}try{lu(5,d,d.return)}catch(Ur){zr(d,d.return,Ur)}}break;case 1:c(p,d),m(d),R&512&&T!==null&&kl(T,T.return);break;case 5:if(c(p,d),m(d),R&512&&T!==null&&kl(T,T.return),d.flags&32){var N=d.stateNode;try{Zo(N,"")}catch(Ur){zr(d,d.return,Ur)}}if(R&4&&(N=d.stateNode,N!=null)){var Z=d.memoizedProps,de=T!==null?T.memoizedProps:Z,De=d.type,Ge=d.updateQueue;if(d.updateQueue=null,Ge!==null)try{De==="input"&&Z.type==="radio"&&Z.name!=null&&hs(N,Z),Fa(De,de);var _t=Fa(De,Z);for(de=0;de<Ge.length;de+=2){var tr=Ge[de],rr=Ge[de+1];tr==="style"?ba(N,rr):tr==="dangerouslySetInnerHTML"?ca(N,rr):tr==="children"?Zo(N,rr):Vt(N,tr,rr,_t)}switch(De){case"input":Ho(N,Z);break;case"textarea":xs(N,Z);break;case"select":var Jt=N._wrapperState.wasMultiple;N._wrapperState.wasMultiple=!!Z.multiple;var Ir=Z.value;Ir!=null?Zs(N,!!Z.multiple,Ir,!1):Jt!==!!Z.multiple&&(Z.defaultValue!=null?Zs(N,!!Z.multiple,Z.defaultValue,!0):Zs(N,!!Z.multiple,Z.multiple?[]:"",!1))}N[Fu]=Z}catch(Ur){zr(d,d.return,Ur)}}break;case 6:if(c(p,d),m(d),R&4){if(d.stateNode===null)throw Error(I(162));N=d.stateNode,Z=d.memoizedProps;try{N.nodeValue=Z}catch(Ur){zr(d,d.return,Ur)}}break;case 3:if(c(p,d),m(d),R&4&&T!==null&&T.memoizedState.isDehydrated)try{Rc(p.containerInfo)}catch(Ur){zr(d,d.return,Ur)}break;case 4:c(p,d),m(d);break;case 13:c(p,d),m(d),N=d.child,N.flags&8192&&(Z=N.memoizedState!==null,N.stateNode.isHidden=Z,!Z||N.alternate!==null&&N.alternate.memoizedState!==null||(Le=on())),R&4&&i(d);break;case 22:if(tr=T!==null&&T.memoizedState!==null,d.mode&1?(On=(_t=On)||tr,c(p,d),On=_t):c(p,d),m(d),R&8192){if(_t=d.memoizedState!==null,(d.stateNode.isHidden=_t)&&!tr&&(d.mode&1)!==0)for(Er=d,tr=d.child;tr!==null;){for(rr=Er=tr;Er!==null;){switch(Jt=Er,Ir=Jt.child,Jt.tag){case 0:case 11:case 14:case 15:lu(4,Jt,Jt.return);break;case 1:kl(Jt,Jt.return);var Or=Jt.stateNode;if(typeof Or.componentWillUnmount=="function"){R=Jt,T=Jt.return;try{p=R,Or.props=p.memoizedProps,Or.state=p.memoizedState,Or.componentWillUnmount()}catch(Ur){zr(R,T,Ur)}}break;case 5:kl(Jt,Jt.return);break;case 22:if(Jt.memoizedState!==null){M(rr);continue}}Ir!==null?(Ir.return=Jt,Er=Ir):M(rr)}tr=tr.sibling}e:for(tr=null,rr=d;;){if(rr.tag===5){if(tr===null){tr=rr;try{N=rr.stateNode,_t?(Z=N.style,typeof Z.setProperty=="function"?Z.setProperty("display","none","important"):Z.display="none"):(De=rr.stateNode,Ge=rr.memoizedProps.style,de=Ge!=null&&Ge.hasOwnProperty("display")?Ge.display:null,De.style.display=wa("display",de))}catch(Ur){zr(d,d.return,Ur)}}}else if(rr.tag===6){if(tr===null)try{rr.stateNode.nodeValue=_t?"":rr.memoizedProps}catch(Ur){zr(d,d.return,Ur)}}else if((rr.tag!==22&&rr.tag!==23||rr.memoizedState===null||rr===d)&&rr.child!==null){rr.child.return=rr,rr=rr.child;continue}if(rr===d)break e;for(;rr.sibling===null;){if(rr.return===null||rr.return===d)break e;tr===rr&&(tr=null),rr=rr.return}tr===rr&&(tr=null),rr.sibling.return=rr.return,rr=rr.sibling}}break;case 19:c(p,d),m(d),R&4&&i(d);break;case 21:break;default:c(p,d),m(d)}}function m(d){var p=d.flags;if(p&2){try{e:{for(var T=d.return;T!==null;){if(ih(T)){var R=T;break e}T=T.return}throw Error(I(160))}switch(R.tag){case 5:var N=R.stateNode;R.flags&32&&(Zo(N,""),R.flags&=-33);var Z=uu(d);ra(d,Z,N);break;case 3:case 4:var de=R.stateNode.containerInfo,De=uu(d);ka(d,De,de);break;default:throw Error(I(161))}}catch(Ge){zr(d,d.return,Ge)}d.flags&=-3}p&4096&&(d.flags&=-4097)}function y(d,p,T){Er=d,w(d)}function w(d,p,T){for(var R=(d.mode&1)!==0;Er!==null;){var N=Er,Z=N.child;if(N.tag===22&&R){var de=N.memoizedState!==null||au;if(!de){var De=N.alternate,Ge=De!==null&&De.memoizedState!==null||On;De=au;var _t=On;if(au=de,(On=Ge)&&!_t)for(Er=N;Er!==null;)de=Er,Ge=de.child,de.tag===22&&de.memoizedState!==null?P(N):Ge!==null?(Ge.return=de,Er=Ge):P(N);for(;Z!==null;)Er=Z,w(Z),Z=Z.sibling;Er=N,au=De,On=_t}S(d)}else(N.subtreeFlags&8772)!==0&&Z!==null?(Z.return=N,Er=Z):S(d)}}function S(d){for(;Er!==null;){var p=Er;if((p.flags&8772)!==0){var T=p.alternate;try{if((p.flags&8772)!==0)switch(p.tag){case 0:case 11:case 15:On||ta(5,p);break;case 1:var R=p.stateNode;if(p.flags&4&&!On)if(T===null)R.componentDidMount();else{var N=p.elementType===p.type?T.memoizedProps:eo(p.type,T.memoizedProps);R.componentDidUpdate(N,T.memoizedState,R.__reactInternalSnapshotBeforeUpdate)}var Z=p.updateQueue;Z!==null&&Ip(p,Z,R);break;case 3:var de=p.updateQueue;if(de!==null){if(T=null,p.child!==null)switch(p.child.tag){case 5:T=p.child.stateNode;break;case 1:T=p.child.stateNode}Ip(p,de,T)}break;case 5:var De=p.stateNode;if(T===null&&p.flags&4){T=De;var Ge=p.memoizedProps;switch(p.type){case"button":case"input":case"select":case"textarea":Ge.autoFocus&&T.focus();break;case"img":Ge.src&&(T.src=Ge.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(p.memoizedState===null){var _t=p.alternate;if(_t!==null){var tr=_t.memoizedState;if(tr!==null){var rr=tr.dehydrated;rr!==null&&Rc(rr)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(I(163))}On||p.flags&512&&cu(p)}catch(Jt){zr(p,p.return,Jt)}}if(p===d){Er=null;break}if(T=p.sibling,T!==null){T.return=p.return,Er=T;break}Er=p.return}}function M(d){for(;Er!==null;){var p=Er;if(p===d){Er=null;break}var T=p.sibling;if(T!==null){T.return=p.return,Er=T;break}Er=p.return}}function P(d){for(;Er!==null;){var p=Er;try{switch(p.tag){case 0:case 11:case 15:var T=p.return;try{ta(4,p)}catch(Ge){zr(p,T,Ge)}break;case 1:var R=p.stateNode;if(typeof R.componentDidMount=="function"){var N=p.return;try{R.componentDidMount()}catch(Ge){zr(p,N,Ge)}}var Z=p.return;try{cu(p)}catch(Ge){zr(p,Z,Ge)}break;case 5:var de=p.return;try{cu(p)}catch(Ge){zr(p,de,Ge)}}}catch(Ge){zr(p,p.return,Ge)}if(p===d){Er=null;break}var De=p.sibling;if(De!==null){De.return=p.return,Er=De;break}Er=p.return}}var O=Math.ceil,D=jt.ReactCurrentDispatcher,F=jt.ReactCurrentOwner,q=jt.ReactCurrentBatchConfig,V=0,W=null,X=null,J=0,se=0,le=Ha(0),ge=0,_e=null,pe=0,ue=0,ye=0,xe=null,Pe=null,Le=0,Ye=1/0,Xe=null,ot=!1,ze=null,$e=null,Ie=!1,Je=null,Ve=0,st=0,vt=null,Qe=-1,pt=0;function Pt(){return(V&6)!==0?on():Qe!==-1?Qe:Qe=on()}function Lt(d){return(d.mode&1)===0?1:(V&2)!==0&&J!==0?J&-J:bm.transition!==null?(pt===0&&(pt=ha()),pt):(d=Yn,d!==0||(d=window.event,d=d===void 0?16:Kl(d.type)),d)}function Mt(d,p,T,R){if(50<st)throw st=0,vt=null,Error(I(185));Ys(d,T,R),((V&2)===0||d!==W)&&(d===W&&((V&2)===0&&(ue|=T),ge===4&&dn(d,J)),Nt(d,R),T===1&&V===0&&(p.mode&1)===0&&(Ye=on()+500,ju&&Oo()))}function Nt(d,p){var T=d.callbackNode;dh(d,p);var R=Ic(d,d===W?J:0);if(R===0)T!==null&&$r(T),d.callbackNode=null,d.callbackPriority=0;else if(p=R&-R,d.callbackPriority!==p){if(T!=null&&$r(T),p===1)d.tag===0?Sp(Gn.bind(null,d)):Cf(Gn.bind(null,d)),Lu(function(){(V&6)===0&&Oo()}),T=null;else{switch(yu(R)){case 1:T=An;break;case 4:T=bn;break;case 16:T=gi;break;case 536870912:T=hi;break;default:T=gi}T=no(T,er.bind(null,d))}d.callbackPriority=p,d.callbackNode=T}}function er(d,p){if(Qe=-1,pt=0,(V&6)!==0)throw Error(I(327));var T=d.callbackNode;if(kn()&&d.callbackNode!==T)return null;var R=Ic(d,d===W?J:0);if(R===0)return null;if((R&30)!==0||(R&d.expiredLanes)!==0||p)p=Ci(d,R);else{p=R;var N=V;V|=2;var Z=Wr();(W!==d||J!==p)&&(Xe=null,Ye=on()+500,yr(d,p));do try{Sn();break}catch(De){Lr(d,De)}while(!0);dc(),D.current=Z,V=N,X!==null?p=0:(W=null,J=0,p=ge)}if(p!==0){if(p===2&&(N=_u(d),N!==0&&(R=N,p=nr(d,N))),p===1)throw T=_e,yr(d,0),dn(d,R),Nt(d,on()),T;if(p===6)dn(d,R);else{if(N=d.current.alternate,(R&30)===0&&!Dr(N)&&(p=Ci(d,R),p===2&&(Z=_u(d),Z!==0&&(R=Z,p=nr(d,Z))),p===1))throw T=_e,yr(d,0),dn(d,R),Nt(d,on()),T;switch(d.finishedWork=N,d.finishedLanes=R,p){case 0:case 1:throw Error(I(345));case 2:yi(d,Pe,Xe);break;case 3:if(dn(d,R),(R&130023424)===R&&(p=Le+500-on(),10<p)){if(Ic(d,0)!==0)break;if(N=d.suspendedLanes,(N&R)!==R){Pt(),d.pingedLanes|=d.suspendedLanes&N;break}d.timeoutHandle=bd(yi.bind(null,d,Pe,Xe),p);break}yi(d,Pe,Xe);break;case 4:if(dn(d,R),(R&4194240)===R)break;for(p=d.eventTimes,N=-1;0<R;){var de=31-po(R);Z=1<<de,de=p[de],de>N&&(N=de),R&=~Z}if(R=N,R=on()-R,R=(120>R?120:480>R?480:1080>R?1080:1920>R?1920:3e3>R?3e3:4320>R?4320:1960*O(R/1960))-R,10<R){d.timeoutHandle=bd(yi.bind(null,d,Pe,Xe),R);break}yi(d,Pe,Xe);break;case 5:yi(d,Pe,Xe);break;default:throw Error(I(329))}}}return Nt(d,on()),d.callbackNode===T?er.bind(null,d):null}function nr(d,p){var T=xe;return d.current.memoizedState.isDehydrated&&(yr(d,p).flags|=256),d=Ci(d,p),d!==2&&(p=Pe,Pe=T,p!==null&&dr(p)),d}function dr(d){Pe===null?Pe=d:Pe.push.apply(Pe,d)}function Dr(d){for(var p=d;;){if(p.flags&16384){var T=p.updateQueue;if(T!==null&&(T=T.stores,T!==null))for(var R=0;R<T.length;R++){var N=T[R],Z=N.getSnapshot;N=N.value;try{if(!ga(Z(),N))return!1}catch{return!1}}}if(T=p.child,p.subtreeFlags&16384&&T!==null)T.return=p,p=T;else{if(p===d)break;for(;p.sibling===null;){if(p.return===null||p.return===d)return!0;p=p.return}p.sibling.return=p.return,p=p.sibling}}return!0}function dn(d,p){for(p&=~ye,p&=~ue,d.suspendedLanes|=p,d.pingedLanes&=~p,d=d.expirationTimes;0<p;){var T=31-po(p),R=1<<T;d[T]=-1,p&=~R}}function Gn(d){if((V&6)!==0)throw Error(I(327));kn();var p=Ic(d,0);if((p&1)===0)return Nt(d,on()),null;var T=Ci(d,p);if(d.tag!==0&&T===2){var R=_u(d);R!==0&&(p=R,T=nr(d,R))}if(T===1)throw T=_e,yr(d,0),dn(d,p),Nt(d,on()),T;if(T===6)throw Error(I(345));return d.finishedWork=d.current.alternate,d.finishedLanes=p,yi(d,Pe,Xe),Nt(d,on()),null}function Mn(d,p){var T=V;V|=1;try{return d(p)}finally{V=T,V===0&&(Ye=on()+500,ju&&Oo())}}function wn(d){Je!==null&&Je.tag===0&&(V&6)===0&&kn();var p=V;V|=1;var T=q.transition,R=Yn;try{if(q.transition=null,Yn=1,d)return d()}finally{Yn=R,q.transition=T,V=p,(V&6)===0&&Oo()}}function wi(){se=le.current,ki(le)}function yr(d,p){d.finishedWork=null,d.finishedLanes=0;var T=d.timeoutHandle;if(T!==-1&&(d.timeoutHandle=-1,If(T)),X!==null)for(T=X.return;T!==null;){var R=T;switch(Md(R),R.tag){case 1:R=R.type.childContextTypes,R!=null&&Hc();break;case 3:No(),ki(_o),ki(Ki),Ma();break;case 5:Wu(R);break;case 4:No();break;case 13:ki(Li);break;case 19:ki(Li);break;case 10:qu(R.type._context);break;case 22:case 23:wi()}T=T.return}if(W=d,X=d=So(d.current,null),J=se=p,ge=0,_e=null,ye=ue=pe=0,Pe=xe=null,vo!==null){for(p=0;p<vo.length;p++)if(T=vo[p],R=T.interleaved,R!==null){T.interleaved=null;var N=R.next,Z=T.pending;if(Z!==null){var de=Z.next;Z.next=N,R.next=de}T.pending=R}vo=null}return d}function Lr(d,p){do{var T=X;try{if(dc(),zn.current=za,kd){for(var R=Gi.memoizedState;R!==null;){var N=R.queue;N!==null&&(N.pending=null),R=R.next}kd=!1}if(Bo=0,As=ms=Gi=null,Qa=!1,Pa=0,F.current=null,T===null||T.return===null){ge=1,_e=p,X=null;break}e:{var Z=d,de=T.return,De=T,Ge=p;if(p=J,De.flags|=32768,Ge!==null&&typeof Ge=="object"&&typeof Ge.then=="function"){var _t=Ge,tr=De,rr=tr.tag;if((tr.mode&1)===0&&(rr===0||rr===11||rr===15)){var Jt=tr.alternate;Jt?(tr.updateQueue=Jt.updateQueue,tr.memoizedState=Jt.memoizedState,tr.lanes=Jt.lanes):(tr.updateQueue=null,tr.memoizedState=null)}var Ir=Gd(de);if(Ir!==null){Ir.flags&=-257,Wh(Ir,de,De,Z,p),Ir.mode&1&&Qu(Z,_t,p),p=Ir,Ge=_t;var Or=p.updateQueue;if(Or===null){var Ur=new Set;Ur.add(Ge),p.updateQueue=Ur}else Or.add(Ge);break e}else{if((p&1)===0){Qu(Z,_t,p),qn();break e}Ge=Error(I(426))}}else if(Ni&&De.mode&1){var ys=Gd(de);if(ys!==null){(ys.flags&65536)===0&&(ys.flags|=256),Wh(ys,de,De,Z,p),Fo(nl(Ge,De));break e}}Z=Ge=nl(Ge,De),ge!==4&&(ge=2),xe===null?xe=[Z]:xe.push(Z),Z=de;do{switch(Z.tag){case 3:Z.flags|=65536,p&=-p,Z.lanes|=p;var at=$d(Z,Ge,p);Rd(Z,at);break e;case 1:De=Ge;var et=Z.type,dt=Z.stateNode;if((Z.flags&128)===0&&(typeof et.getDerivedStateFromError=="function"||dt!==null&&typeof dt.componentDidCatch=="function"&&($e===null||!$e.has(dt)))){Z.flags|=65536,p&=-p,Z.lanes|=p;var or=Rl(Z,De,p);Rd(Z,or);break e}}Z=Z.return}while(Z!==null)}hn(T)}catch(Jr){p=Jr,X===T&&T!==null&&(X=T=T.return);continue}break}while(!0)}function Wr(){var d=D.current;return D.current=za,d===null?za:d}function qn(){(ge===0||ge===3||ge===2)&&(ge=4),W===null||(pe&268435455)===0&&(ue&268435455)===0||dn(W,J)}function Ci(d,p){var T=V;V|=2;var R=Wr();(W!==d||J!==p)&&(Xe=null,yr(d,p));do try{Zn();break}catch(N){Lr(d,N)}while(!0);if(dc(),V=T,D.current=R,X!==null)throw Error(I(261));return W=null,J=0,ge}function Zn(){for(;X!==null;)_i(X)}function Sn(){for(;X!==null&&!Rr();)_i(X)}function _i(d){var p=bo(d.alternate,d,se);d.memoizedProps=d.pendingProps,p===null?hn(d):X=p,F.current=null}function hn(d){var p=d;do{var T=p.alternate;if(d=p.return,(p.flags&32768)===0){if(T=Qh(T,p,se),T!==null){X=T;return}}else{if(T=zl(T,p),T!==null){T.flags&=32767,X=T;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{ge=6,X=null;return}}if(p=p.sibling,p!==null){X=p;return}X=p=d}while(p!==null);ge===0&&(ge=5)}function yi(d,p,T){var R=Yn,N=q.transition;try{q.transition=null,Yn=1,Jn(d,p,T,R)}finally{q.transition=N,Yn=R}return null}function Jn(d,p,T,R){do kn();while(Je!==null);if((V&6)!==0)throw Error(I(327));T=d.finishedWork;var N=d.finishedLanes;if(T===null)return null;if(d.finishedWork=null,d.finishedLanes=0,T===d.current)throw Error(I(177));d.callbackNode=null,d.callbackPriority=0;var Z=T.lanes|T.childLanes;if(fl(d,Z),d===W&&(X=W=null,J=0),(T.subtreeFlags&2064)===0&&(T.flags&2064)===0||Ie||(Ie=!0,no(gi,function(){return kn(),null})),Z=(T.flags&15990)!==0,(T.subtreeFlags&15990)!==0||Z){Z=q.transition,q.transition=null;var de=Yn;Yn=1;var De=V;V|=4,F.current=null,nh(d,T),f(T,d),qs(Du),gh=!!ku,Du=ku=null,d.current=T,y(T),jn(),V=De,Yn=de,q.transition=Z}else d.current=T;if(Ie&&(Ie=!1,Je=d,Ve=N),Z=d.pendingLanes,Z===0&&($e=null),$s(T.stateNode),Nt(d,on()),p!==null)for(R=d.onRecoverableError,T=0;T<p.length;T++)N=p[T],R(N.value,{componentStack:N.stack,digest:N.digest});if(ot)throw ot=!1,d=ze,ze=null,d;return(Ve&1)!==0&&d.tag!==0&&kn(),Z=d.pendingLanes,(Z&1)!==0?d===vt?st++:(st=0,vt=d):st=0,Oo(),null}function kn(){if(Je!==null){var d=yu(Ve),p=q.transition,T=Yn;try{if(q.transition=null,Yn=16>d?16:d,Je===null)var R=!1;else{if(d=Je,Je=null,Ve=0,(V&6)!==0)throw Error(I(331));var N=V;for(V|=4,Er=d.current;Er!==null;){var Z=Er,de=Z.child;if((Er.flags&16)!==0){var De=Z.deletions;if(De!==null){for(var Ge=0;Ge<De.length;Ge++){var _t=De[Ge];for(Er=_t;Er!==null;){var tr=Er;switch(tr.tag){case 0:case 11:case 15:lu(8,tr,Z)}var rr=tr.child;if(rr!==null)rr.return=tr,Er=rr;else for(;Er!==null;){tr=Er;var Jt=tr.sibling,Ir=tr.return;if(Yd(tr),tr===_t){Er=null;break}if(Jt!==null){Jt.return=Ir,Er=Jt;break}Er=Ir}}}var Or=Z.alternate;if(Or!==null){var Ur=Or.child;if(Ur!==null){Or.child=null;do{var ys=Ur.sibling;Ur.sibling=null,Ur=ys}while(Ur!==null)}}Er=Z}}if((Z.subtreeFlags&2064)!==0&&de!==null)de.return=Z,Er=de;else e:for(;Er!==null;){if(Z=Er,(Z.flags&2048)!==0)switch(Z.tag){case 0:case 11:case 15:lu(9,Z,Z.return)}var at=Z.sibling;if(at!==null){at.return=Z.return,Er=at;break e}Er=Z.return}}var et=d.current;for(Er=et;Er!==null;){de=Er;var dt=de.child;if((de.subtreeFlags&2064)!==0&&dt!==null)dt.return=de,Er=dt;else e:for(de=et;Er!==null;){if(De=Er,(De.flags&2048)!==0)try{switch(De.tag){case 0:case 11:case 15:ta(9,De)}}catch(Jr){zr(De,De.return,Jr)}if(De===de){Er=null;break e}var or=De.sibling;if(or!==null){or.return=De.return,Er=or;break e}Er=De.return}}if(V=N,Oo(),Ui&&typeof Ui.onPostCommitFiberRoot=="function")try{Ui.onPostCommitFiberRoot(Zi,d)}catch{}R=!0}return R}finally{Yn=T,q.transition=p}}return!1}function Xn(d,p,T){p=nl(T,p),p=$d(d,p,1),d=pc(d,p,1),p=Pt(),d!==null&&(Ys(d,1,p),Nt(d,p))}function zr(d,p,T){if(d.tag===3)Xn(d,d,T);else for(;p!==null;){if(p.tag===3){Xn(p,d,T);break}else if(p.tag===1){var R=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof R.componentDidCatch=="function"&&($e===null||!$e.has(R))){d=nl(T,d),d=Rl(p,d,1),p=pc(p,d,1),d=Pt(),p!==null&&(Ys(p,1,d),Nt(p,d));break}}p=p.return}}function bi(d,p,T){var R=d.pingCache;R!==null&&R.delete(p),p=Pt(),d.pingedLanes|=d.suspendedLanes&T,W===d&&(J&T)===T&&(ge===4||ge===3&&(J&130023424)===J&&500>on()-Le?yr(d,0):ye|=T),Nt(d,p)}function _s(d,p){p===0&&((d.mode&1)===0?p=1:(p=ql,ql<<=1,(ql&130023424)===0&&(ql=4194304)));var T=Pt();d=Ya(d,p),d!==null&&(Ys(d,p,T),Nt(d,T))}function ri(d){var p=d.memoizedState,T=0;p!==null&&(T=p.retryLane),_s(d,T)}function Tn(d,p){var T=0;switch(d.tag){case 13:var R=d.stateNode,N=d.memoizedState;N!==null&&(T=N.retryLane);break;case 19:R=d.stateNode;break;default:throw Error(I(314))}R!==null&&R.delete(p),_s(d,T)}var bo;bo=function(d,p,T){if(d!==null)if(d.memoizedProps!==p.pendingProps||_o.current)to=!0;else{if((d.lanes&T)===0&&(p.flags&128)===0)return to=!1,zp(d,p,T);to=(d.flags&131072)!==0}else to=!1,Ni&&(p.flags&1048576)!==0&&Cd(p,Ad,p.index);switch(p.lanes=0,p.tag){case 2:var R=p.type;su(d,p),d=p.pendingProps;var N=Tl(p,Ki.current);fc(p,T),N=fi(null,p,R,d,N,T);var Z=ke();return p.flags|=1,typeof N=="object"&&N!==null&&typeof N.render=="function"&&N.$$typeof===void 0?(p.tag=1,p.memoizedState=null,p.updateQueue=null,Fs(R)?(Z=!0,Wc(p)):Z=!1,p.memoizedState=N.state!==null&&N.state!==void 0?N.state:null,Ka(p),N.updater=Ml,p.stateNode=N,N._reactInternals=p,Hh(p,R,d,T),p=Hd(null,p,R,!0,Z,T)):(p.tag=0,Ni&&Z&&kh(p),Cs(null,p,N,T),p=p.child),p;case 16:R=p.elementType;e:{switch(su(d,p),d=p.pendingProps,N=R._init,R=N(R._payload),p.type=R,N=p.tag=To(R),d=eo(R,d),N){case 0:p=th(null,p,R,d,T);break e;case 1:p=Of(null,p,R,d,T);break e;case 11:p=iu(null,p,R,d,T);break e;case 14:p=eh(null,p,R,eo(R.type,d),T);break e}throw Error(I(306,R,""))}return p;case 0:return R=p.type,N=p.pendingProps,N=p.elementType===R?N:eo(R,N),th(d,p,R,N,T);case 1:return R=p.type,N=p.pendingProps,N=p.elementType===R?N:eo(R,N),Of(d,p,R,N,T);case 3:e:{if(Ff(p),d===null)throw Error(I(387));R=p.pendingProps,Z=p.memoizedState,N=Z.element,sr(d,p),Bh(p,R,null,T);var de=p.memoizedState;if(R=de.element,Z.isDehydrated)if(Z={element:R,isDehydrated:!1,cache:de.cache,pendingSuspenseBoundaries:de.pendingSuspenseBoundaries,transitions:de.transitions},p.updateQueue.baseState=Z,p.memoizedState=Z,p.flags&256){N=nl(Error(I(423)),p),p=Nf(d,p,R,T,N);break e}else if(R!==N){N=nl(Error(I(424)),p),p=Nf(d,p,R,T,N);break e}else for(Is=Ua(p.stateNode.containerInfo.firstChild),fs=p,Ni=!0,Ns=null,T=Xa(p,null,R,T),p.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(Yc(),R===N){p=$n(d,p,T);break e}Cs(d,p,R,T)}p=p.child}return p;case 5:return mc(p),d===null&&Oh(p),R=p.type,N=p.pendingProps,Z=d!==null?d.memoizedProps:null,de=N.children,oc(R,N)?de=null:Z!==null&&oc(R,Z)&&(p.flags|=32),Lf(d,p),Cs(d,p,de,T),p.child;case 6:return d===null&&Oh(p),null;case 13:return Bf(d,p,T);case 4:return js(p,p.stateNode.containerInfo),R=p.pendingProps,d===null?p.child=Sl(p,null,R,T):Cs(d,p,R,T),p.child;case 11:return R=p.type,N=p.pendingProps,N=p.elementType===R?N:eo(R,N),iu(d,p,R,N,T);case 7:return Cs(d,p,p.pendingProps,T),p.child;case 8:return Cs(d,p,p.pendingProps.children,T),p.child;case 12:return Cs(d,p,p.pendingProps.children,T),p.child;case 10:e:{if(R=p.type._context,N=p.pendingProps,Z=p.memoizedProps,de=N.value,Di(cc,R._currentValue),R._currentValue=de,Z!==null)if(ga(Z.value,de)){if(Z.children===N.children&&!_o.current){p=$n(d,p,T);break e}}else for(Z=p.child,Z!==null&&(Z.return=p);Z!==null;){var De=Z.dependencies;if(De!==null){de=Z.child;for(var Ge=De.firstContext;Ge!==null;){if(Ge.context===R){if(Z.tag===1){Ge=ea(-1,T&-T),Ge.tag=2;var _t=Z.updateQueue;if(_t!==null){_t=_t.shared;var tr=_t.pending;tr===null?Ge.next=Ge:(Ge.next=tr.next,tr.next=Ge),_t.pending=Ge}}Z.lanes|=T,Ge=Z.alternate,Ge!==null&&(Ge.lanes|=T),Nh(Z.return,T,p),De.lanes|=T;break}Ge=Ge.next}}else if(Z.tag===10)de=Z.type===p.type?null:Z.child;else if(Z.tag===18){if(de=Z.return,de===null)throw Error(I(341));de.lanes|=T,De=de.alternate,De!==null&&(De.lanes|=T),Nh(de,T,p),de=Z.sibling}else de=Z.child;if(de!==null)de.return=Z;else for(de=Z;de!==null;){if(de===p){de=null;break}if(Z=de.sibling,Z!==null){Z.return=de.return,de=Z;break}de=de.return}Z=de}Cs(d,p,N.children,T),p=p.child}return p;case 9:return N=p.type,R=p.pendingProps.children,fc(p,T),N=ps(N),R=R(N),p.flags|=1,Cs(d,p,R,T),p.child;case 14:return R=p.type,N=eo(R,p.pendingProps),N=eo(R.type,N),eh(d,p,R,N,T);case 15:return qd(d,p,p.type,p.pendingProps,T);case 17:return R=p.type,N=p.pendingProps,N=p.elementType===R?N:eo(R,N),su(d,p),p.tag=1,Fs(R)?(d=!0,Wc(p)):d=!1,fc(p,T),Ud(p,R,N),Hh(p,R,N,T),Hd(null,p,R,!0,d,T);case 19:return Rp(d,p,T);case 22:return Zh(d,p,T)}throw Error(I(156,p.tag))};function no(d,p){return xr(d,p)}function na(d,p,T,R){this.tag=d,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=p,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=R,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ji(d,p,T,R){return new na(d,p,T,R)}function jo(d){return d=d.prototype,!(!d||!d.isReactComponent)}function To(d){if(typeof d=="function")return jo(d)?1:0;if(d!=null){if(d=d.$$typeof,d===ui)return 11;if(d===rn)return 14}return 2}function So(d,p){var T=d.alternate;return T===null?(T=Ji(d.tag,p,d.key,d.mode),T.elementType=d.elementType,T.type=d.type,T.stateNode=d.stateNode,T.alternate=d,d.alternate=T):(T.pendingProps=p,T.type=d.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=d.flags&14680064,T.childLanes=d.childLanes,T.lanes=d.lanes,T.child=d.child,T.memoizedProps=d.memoizedProps,T.memoizedState=d.memoizedState,T.updateQueue=d.updateQueue,p=d.dependencies,T.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext},T.sibling=d.sibling,T.index=d.index,T.ref=d.ref,T}function Vo(d,p,T,R,N,Z){var de=2;if(R=d,typeof d=="function")jo(d)&&(de=1);else if(typeof d=="string")de=5;else e:switch(d){case Kt:return Uo(T.children,N,Z,p);case Wt:de=8,N|=8;break;case Cr:return d=Ji(12,T,p,N|2),d.elementType=Cr,d.lanes=Z,d;case gr:return d=Ji(13,T,p,N),d.elementType=gr,d.lanes=Z,d;case Mr:return d=Ji(19,T,p,N),d.elementType=Mr,d.lanes=Z,d;case un:return yc(T,N,Z,p);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case oi:de=10;break e;case fn:de=9;break e;case ui:de=11;break e;case rn:de=14;break e;case nn:de=16,R=null;break e}throw Error(I(130,d==null?d:typeof d,""))}return p=Ji(de,T,p,N),p.elementType=d,p.type=R,p.lanes=Z,p}function Uo(d,p,T,R){return d=Ji(7,d,R,p),d.lanes=T,d}function yc(d,p,T,R){return d=Ji(22,d,R,p),d.elementType=un,d.lanes=T,d.stateNode={isHidden:!1},d}function ed(d,p,T){return d=Ji(6,d,null,p),d.lanes=T,d}function vc(d,p,T){return p=Ji(4,d.children!==null?d.children:[],d.key,p),p.lanes=T,p.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},p}function $f(d,p,T,R,N){this.tag=p,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mo(0),this.expirationTimes=mo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mo(0),this.identifierPrefix=R,this.onRecoverableError=N,this.mutableSourceEagerHydrationData=null}function hu(d,p,T,R,N,Z,de,De,Ge){return d=new $f(d,p,T,De,Ge),p===1?(p=1,Z===!0&&(p|=8)):p=0,Z=Ji(3,null,null,p),d.current=Z,Z.stateNode=d,Z.memoizedState={element:R,isDehydrated:T,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ka(Z),d}function Kd(d,p,T){var R=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:hr,key:R==null?null:""+R,children:d,containerInfo:p,implementation:T}}function td(d){if(!d)return Do;d=d._reactInternals;e:{if(Ue(d)!==d||d.tag!==1)throw Error(I(170));var p=d;do{switch(p.tag){case 3:p=p.stateNode.context;break e;case 1:if(Fs(p.type)){p=p.stateNode.__reactInternalMemoizedMergedChildContext;break e}}p=p.return}while(p!==null);throw Error(I(171))}if(d.tag===1){var T=d.type;if(Fs(T))return Ed(d,T,p)}return p}function Da(d,p,T,R,N,Z,de,De,Ge){return d=hu(T,R,!0,d,N,Z,de,De,Ge),d.context=td(null),T=d.current,R=Pt(),N=Lt(T),Z=ea(R,N),Z.callback=p??null,pc(T,Z,N),d.current.lanes=N,Ys(d,N,R),Nt(d,R),d}function Dl(d,p,T,R){var N=p.current,Z=Pt(),de=Lt(N);return T=td(T),p.context===null?p.context=T:p.pendingContext=T,p=ea(Z,de),p.payload={element:d},R=R===void 0?null:R,R!==null&&(p.callback=R),d=pc(N,p,de),d!==null&&(Mt(d,N,de,Z),Pd(d,N,de)),de}function sl(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 5:return d.child.stateNode;default:return d.child.stateNode}}function Ll(d,p){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var T=d.retryLane;d.retryLane=T!==0&&T<p?T:p}}function Gf(d,p){Ll(d,p),(d=d.alternate)&&Ll(d,p)}function Jd(){return null}var qf=typeof reportError=="function"?reportError:function(d){console.error(d)};function Dp(d){this._internalRoot=d}Hf.prototype.render=Dp.prototype.render=function(d){var p=this._internalRoot;if(p===null)throw Error(I(409));Dl(d,p,null,null)},Hf.prototype.unmount=Dp.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var p=d.containerInfo;wn(function(){Dl(null,d,null,null)}),p[Ga]=null}};function Hf(d){this._internalRoot=d}Hf.prototype.unstable_scheduleHydration=function(d){if(d){var p=Mc();d={blockedOn:null,target:d,priority:p};for(var T=0;T<fa.length&&p!==0&&p<fa[T].priority;T++);fa.splice(T,0,d),T===0&&vp(d)}};function Lp(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function Wf(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function Tm(){}function rd(d,p,T,R,N){if(N){if(typeof R=="function"){var Z=R;R=function(){var _t=sl(de);Z.call(_t)}}var de=Da(p,R,d,0,null,!1,!1,"",Tm);return d._reactRootContainer=de,d[Ga]=de.current,Mh(d.nodeType===8?d.parentNode:d),wn(),de}for(;N=d.lastChild;)d.removeChild(N);if(typeof R=="function"){var De=R;R=function(){var _t=sl(Ge);De.call(_t)}}var Ge=hu(d,0,!1,null,null,!1,!1,"",Tm);return d._reactRootContainer=Ge,d[Ga]=Ge.current,Mh(d.nodeType===8?d.parentNode:d),wn(function(){Dl(p,Ge,T,R)}),Ge}function Zf(d,p,T,R,N){var Z=T._reactRootContainer;if(Z){var de=Z;if(typeof N=="function"){var De=N;N=function(){var Ge=sl(de);De.call(Ge)}}Dl(p,de,d,N)}else de=rd(T,p,d,N,R);return sl(de)}Ta=function(d){switch(d.tag){case 3:var p=d.stateNode;if(p.current.memoizedState.isDehydrated){var T=Hl(p.pendingLanes);T!==0&&(Xo(p,T|1),Nt(p,on()),(V&6)===0&&(Ye=on()+500,Oo()))}break;case 13:wn(function(){var R=Ya(d,1);if(R!==null){var N=Pt();Mt(R,d,1,N)}}),Gf(d,1)}},Cc=function(d){if(d.tag===13){var p=Ya(d,134217728);if(p!==null){var T=Pt();Mt(p,d,134217728,T)}Gf(d,134217728)}},Wl=function(d){if(d.tag===13){var p=Lt(d),T=Ya(d,p);if(T!==null){var R=Pt();Mt(T,d,p,R)}Gf(d,p)}},Mc=function(){return Yn},ld=function(d,p){var T=Yn;try{return Yn=d,p()}finally{Yn=T}},Wn=function(d,p,T){switch(p){case"input":if(Ho(d,T),p=T.name,T.type==="radio"&&p!=null){for(T=d;T.parentNode;)T=T.parentNode;for(T=T.querySelectorAll("input[name="+JSON.stringify(""+p)+'][type="radio"]'),p=0;p<T.length;p++){var R=T[p];if(R!==d&&R.form===d.form){var N=qc(R);if(!N)throw Error(I(90));us(R),Ho(R,N)}}}break;case"textarea":xs(d,T);break;case"select":p=T.value,p!=null&&Zs(d,!!T.multiple,p,!1)}},ws=Mn,Xs=wn;var io={usingClientEntryPoint:!1,Events:[zh,ac,qc,Wi,ft,Mn]},xc={findFiberByHostInstance:Gc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},xy={bundleType:xc.bundleType,version:xc.version,rendererPackageName:xc.rendererPackageName,rendererConfig:xc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:jt.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=mr(d),d===null?null:d.stateNode},findFiberByHostInstance:xc.findFiberByHostInstance||Jd,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Op=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Op.isDisabled&&Op.supportsFiber)try{Zi=Op.inject(xy),Ui=Op}catch{}}return al.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=io,al.createPortal=function(d,p){var T=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Lp(p))throw Error(I(200));return Kd(d,p,null,T)},al.createRoot=function(d,p){if(!Lp(d))throw Error(I(299));var T=!1,R="",N=qf;return p!=null&&(p.unstable_strictMode===!0&&(T=!0),p.identifierPrefix!==void 0&&(R=p.identifierPrefix),p.onRecoverableError!==void 0&&(N=p.onRecoverableError)),p=hu(d,1,!1,null,null,T,!1,R,N),d[Ga]=p.current,Mh(d.nodeType===8?d.parentNode:d),new Dp(p)},al.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var p=d._reactInternals;if(p===void 0)throw typeof d.render=="function"?Error(I(188)):(d=Object.keys(d).join(","),Error(I(268,d)));return d=mr(p),d=d===null?null:d.stateNode,d},al.flushSync=function(d){return wn(d)},al.hydrate=function(d,p,T){if(!Wf(p))throw Error(I(200));return Zf(null,d,p,!0,T)},al.hydrateRoot=function(d,p,T){if(!Lp(d))throw Error(I(405));var R=T!=null&&T.hydratedSources||null,N=!1,Z="",de=qf;if(T!=null&&(T.unstable_strictMode===!0&&(N=!0),T.identifierPrefix!==void 0&&(Z=T.identifierPrefix),T.onRecoverableError!==void 0&&(de=T.onRecoverableError)),p=Da(p,null,d,1,T??null,N,!1,Z,de),d[Ga]=p.current,Mh(d),R)for(d=0;d<R.length;d++)T=R[d],N=T._getVersion,N=N(T._source),p.mutableSourceEagerHydrationData==null?p.mutableSourceEagerHydrationData=[T,N]:p.mutableSourceEagerHydrationData.push(T,N);return new Hf(p)},al.render=function(d,p,T){if(!Wf(p))throw Error(I(200));return Zf(null,d,p,!1,T)},al.unmountComponentAtNode=function(d){if(!Wf(d))throw Error(I(40));return d._reactRootContainer?(wn(function(){Zf(null,null,d,!1,function(){d._reactRootContainer=null,d[Ga]=null})}),!0):!1},al.unstable_batchedUpdates=Mn,al.unstable_renderSubtreeIntoContainer=function(d,p,T,R){if(!Wf(T))throw Error(I(200));if(d==null||d._reactInternals===void 0)throw Error(I(38));return Zf(d,p,T,!1,R)},al.version="18.3.1-next-f1338f8080-20240426",al}var S2;function jT(){if(S2)return Dv.exports;S2=1;function _(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(_)}catch(b){console.error(b)}}return _(),Dv.exports=AP(),Dv.exports}var E2;function CP(){if(E2)return E_;E2=1;var _=jT();return E_.createRoot=_.createRoot,E_.hydrateRoot=_.hydrateRoot,E_}var MP=CP();const PP=X_(MP);var VT=jT();const RP=X_(VT);/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function gg(){return gg=Object.assign?Object.assign.bind():function(_){for(var b=1;b<arguments.length;b++){var I=arguments[b];for(var z in I)Object.prototype.hasOwnProperty.call(I,z)&&(_[z]=I[z])}return _},gg.apply(this,arguments)}var cf;(function(_){_.Pop="POP",_.Push="PUSH",_.Replace="REPLACE"})(cf||(cf={}));const I2="popstate";function zP(_){_===void 0&&(_={});function b(B,$){let{pathname:re="/",search:s="",hash:ce=""}=fp(B.location.hash.substr(1));return!re.startsWith("/")&&!re.startsWith(".")&&(re="/"+re),hx("",{pathname:re,search:s,hash:ce},$.state&&$.state.usr||null,$.state&&$.state.key||"default")}function I(B,$){let re=B.document.querySelector("base"),s="";if(re&&re.getAttribute("href")){let ce=B.location.href,be=ce.indexOf("#");s=be===-1?ce:ce.slice(0,be)}return s+"#"+(typeof $=="string"?$:UT($))}function z(B,$){Fx(B.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify($)+")")}return DP(b,I,z,_)}function uo(_,b){if(_===!1||_===null||typeof _>"u")throw new Error(b)}function Fx(_,b){if(!_){typeof console<"u"&&console.warn(b);try{throw new Error(b)}catch{}}}function kP(){return Math.random().toString(36).substr(2,8)}function A2(_,b){return{usr:_.state,key:_.key,idx:b}}function hx(_,b,I,z){return I===void 0&&(I=null),gg({pathname:typeof _=="string"?_:_.pathname,search:"",hash:""},typeof b=="string"?fp(b):b,{state:I,key:b&&b.key||z||kP()})}function UT(_){let{pathname:b="/",search:I="",hash:z=""}=_;return I&&I!=="?"&&(b+=I.charAt(0)==="?"?I:"?"+I),z&&z!=="#"&&(b+=z.charAt(0)==="#"?z:"#"+z),b}function fp(_){let b={};if(_){let I=_.indexOf("#");I>=0&&(b.hash=_.substr(I),_=_.substr(0,I));let z=_.indexOf("?");z>=0&&(b.search=_.substr(z),_=_.substr(0,z)),_&&(b.pathname=_)}return b}function DP(_,b,I,z){z===void 0&&(z={});let{window:B=document.defaultView,v5Compat:$=!1}=z,re=B.history,s=cf.Pop,ce=null,be=Se();be==null&&(be=0,re.replaceState(gg({},re.state,{idx:be}),""));function Se(){return(re.state||{idx:null}).idx}function Me(){s=cf.Pop;let ct=Se(),Tt=ct==null?null:ct-be;be=ct,ce&&ce({action:s,location:Be.location,delta:Tt})}function tt(ct,Tt){s=cf.Push;let Dt=hx(Be.location,ct,Tt);I&&I(Dt,ct),be=Se()+1;let Vt=A2(Dt,be),jt=Be.createHref(Dt);try{re.pushState(Vt,"",jt)}catch(vr){if(vr instanceof DOMException&&vr.name==="DataCloneError")throw vr;B.location.assign(jt)}$&&ce&&ce({action:s,location:Be.location,delta:1})}function wt(ct,Tt){s=cf.Replace;let Dt=hx(Be.location,ct,Tt);I&&I(Dt,ct),be=Se();let Vt=A2(Dt,be),jt=Be.createHref(Dt);re.replaceState(Vt,"",jt),$&&ce&&ce({action:s,location:Be.location,delta:0})}function Xt(ct){let Tt=B.location.origin!=="null"?B.location.origin:B.location.href,Dt=typeof ct=="string"?ct:UT(ct);return Dt=Dt.replace(/ $/,"%20"),uo(Tt,"No window.location.(origin|href) available to create URL for href: "+Dt),new URL(Dt,Tt)}let Be={get action(){return s},get location(){return _(B,re)},listen(ct){if(ce)throw new Error("A history only accepts one active listener");return B.addEventListener(I2,Me),ce=ct,()=>{B.removeEventListener(I2,Me),ce=null}},createHref(ct){return b(B,ct)},createURL:Xt,encodeLocation(ct){let Tt=Xt(ct);return{pathname:Tt.pathname,search:Tt.search,hash:Tt.hash}},push:tt,replace:wt,go(ct){return re.go(ct)}};return Be}var C2;(function(_){_.data="data",_.deferred="deferred",_.redirect="redirect",_.error="error"})(C2||(C2={}));function LP(_,b,I){return I===void 0&&(I="/"),OP(_,b,I)}function OP(_,b,I,z){let B=typeof b=="string"?fp(b):b,$=qT(B.pathname||"/",I);if($==null)return null;let re=$T(_);FP(re);let s=null;for(let ce=0;s==null&&ce<re.length;++ce){let be=XP($);s=HP(re[ce],be)}return s}function $T(_,b,I,z){b===void 0&&(b=[]),I===void 0&&(I=[]),z===void 0&&(z="");let B=($,re,s)=>{let ce={relativePath:s===void 0?$.path||"":s,caseSensitive:$.caseSensitive===!0,childrenIndex:re,route:$};ce.relativePath.startsWith("/")&&(uo(ce.relativePath.startsWith(z),'Absolute route path "'+ce.relativePath+'" nested under path '+('"'+z+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),ce.relativePath=ce.relativePath.slice(z.length));let be=lp([z,ce.relativePath]),Se=I.concat(ce);$.children&&$.children.length>0&&(uo($.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+be+'".')),$T($.children,b,Se,be)),!($.path==null&&!$.index)&&b.push({path:be,score:GP(be,$.index),routesMeta:Se})};return _.forEach(($,re)=>{var s;if($.path===""||!((s=$.path)!=null&&s.includes("?")))B($,re);else for(let ce of GT($.path))B($,re,ce)}),b}function GT(_){let b=_.split("/");if(b.length===0)return[];let[I,...z]=b,B=I.endsWith("?"),$=I.replace(/\?$/,"");if(z.length===0)return B?[$,""]:[$];let re=GT(z.join("/")),s=[];return s.push(...re.map(ce=>ce===""?$:[$,ce].join("/"))),B&&s.push(...re),s.map(ce=>_.startsWith("/")&&ce===""?"/":ce)}function FP(_){_.sort((b,I)=>b.score!==I.score?I.score-b.score:qP(b.routesMeta.map(z=>z.childrenIndex),I.routesMeta.map(z=>z.childrenIndex)))}const NP=/^:[\w-]+$/,BP=3,jP=2,VP=1,UP=10,$P=-2,M2=_=>_==="*";function GP(_,b){let I=_.split("/"),z=I.length;return I.some(M2)&&(z+=$P),b&&(z+=jP),I.filter(B=>!M2(B)).reduce((B,$)=>B+(NP.test($)?BP:$===""?VP:UP),z)}function qP(_,b){return _.length===b.length&&_.slice(0,-1).every((z,B)=>z===b[B])?_[_.length-1]-b[b.length-1]:0}function HP(_,b,I){let{routesMeta:z}=_,B={},$="/",re=[];for(let s=0;s<z.length;++s){let ce=z[s],be=s===z.length-1,Se=$==="/"?b:b.slice($.length)||"/",Me=WP({path:ce.relativePath,caseSensitive:ce.caseSensitive,end:be},Se),tt=ce.route;if(!Me)return null;Object.assign(B,Me.params),re.push({params:B,pathname:lp([$,Me.pathname]),pathnameBase:QP(lp([$,Me.pathnameBase])),route:tt}),Me.pathnameBase!=="/"&&($=lp([$,Me.pathnameBase]))}return re}function WP(_,b){typeof _=="string"&&(_={path:_,caseSensitive:!1,end:!0});let[I,z]=ZP(_.path,_.caseSensitive,_.end),B=b.match(I);if(!B)return null;let $=B[0],re=$.replace(/(.)\/+$/,"$1"),s=B.slice(1);return{params:z.reduce((be,Se,Me)=>{let{paramName:tt,isOptional:wt}=Se;if(tt==="*"){let Be=s[Me]||"";re=$.slice(0,$.length-Be.length).replace(/(.)\/+$/,"$1")}const Xt=s[Me];return wt&&!Xt?be[tt]=void 0:be[tt]=(Xt||"").replace(/%2F/g,"/"),be},{}),pathname:$,pathnameBase:re,pattern:_}}function ZP(_,b,I){b===void 0&&(b=!1),I===void 0&&(I=!0),Fx(_==="*"||!_.endsWith("*")||_.endsWith("/*"),'Route path "'+_+'" will be treated as if it were '+('"'+_.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+_.replace(/\*$/,"/*")+'".'));let z=[],B="^"+_.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(re,s,ce)=>(z.push({paramName:s,isOptional:ce!=null}),ce?"/?([^\\/]+)?":"/([^\\/]+)"));return _.endsWith("*")?(z.push({paramName:"*"}),B+=_==="*"||_==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):I?B+="\\/*$":_!==""&&_!=="/"&&(B+="(?:(?=\\/|$))"),[new RegExp(B,b?void 0:"i"),z]}function XP(_){try{return _.split("/").map(b=>decodeURIComponent(b).replace(/\//g,"%2F")).join("/")}catch(b){return Fx(!1,'The URL path "'+_+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+b+").")),_}}function qT(_,b){if(b==="/")return _;if(!_.toLowerCase().startsWith(b.toLowerCase()))return null;let I=b.endsWith("/")?b.length-1:b.length,z=_.charAt(I);return z&&z!=="/"?null:_.slice(I)||"/"}function YP(_,b){b===void 0&&(b="/");let{pathname:I,search:z="",hash:B=""}=typeof _=="string"?fp(_):_;return{pathname:I?I.startsWith("/")?I:KP(I,b):b,search:eR(z),hash:tR(B)}}function KP(_,b){let I=b.replace(/\/+$/,"").split("/");return _.split("/").forEach(B=>{B===".."?I.length>1&&I.pop():B!=="."&&I.push(B)}),I.length>1?I.join("/"):"/"}function Fv(_,b,I,z){return"Cannot include a '"+_+"' character in a manually specified "+("`to."+b+"` field ["+JSON.stringify(z)+"].  Please separate it out to the ")+("`to."+I+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function JP(_){return _.filter((b,I)=>I===0||b.route.path&&b.route.path.length>0)}function HT(_,b){let I=JP(_);return b?I.map((z,B)=>B===I.length-1?z.pathname:z.pathnameBase):I.map(z=>z.pathnameBase)}function WT(_,b,I,z){z===void 0&&(z=!1);let B;typeof _=="string"?B=fp(_):(B=gg({},_),uo(!B.pathname||!B.pathname.includes("?"),Fv("?","pathname","search",B)),uo(!B.pathname||!B.pathname.includes("#"),Fv("#","pathname","hash",B)),uo(!B.search||!B.search.includes("#"),Fv("#","search","hash",B)));let $=_===""||B.pathname==="",re=$?"/":B.pathname,s;if(re==null)s=I;else{let Me=b.length-1;if(!z&&re.startsWith("..")){let tt=re.split("/");for(;tt[0]==="..";)tt.shift(),Me-=1;B.pathname=tt.join("/")}s=Me>=0?b[Me]:"/"}let ce=YP(B,s),be=re&&re!=="/"&&re.endsWith("/"),Se=($||re===".")&&I.endsWith("/");return!ce.pathname.endsWith("/")&&(be||Se)&&(ce.pathname+="/"),ce}const lp=_=>_.join("/").replace(/\/\/+/g,"/"),QP=_=>_.replace(/\/+$/,"").replace(/^\/*/,"/"),eR=_=>!_||_==="?"?"":_.startsWith("?")?_:"?"+_,tR=_=>!_||_==="#"?"":_.startsWith("#")?_:"#"+_;function rR(_){return _!=null&&typeof _.status=="number"&&typeof _.statusText=="string"&&typeof _.internal=="boolean"&&"data"in _}const ZT=["post","put","patch","delete"];new Set(ZT);const nR=["get",...ZT];new Set(nR);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _g(){return _g=Object.assign?Object.assign.bind():function(_){for(var b=1;b<arguments.length;b++){var I=arguments[b];for(var z in I)Object.prototype.hasOwnProperty.call(I,z)&&(_[z]=I[z])}return _},_g.apply(this,arguments)}const Nx=Fe.createContext(null),iR=Fe.createContext(null),Eg=Fe.createContext(null),Y_=Fe.createContext(null),pp=Fe.createContext({outlet:null,matches:[],isDataRoute:!1}),XT=Fe.createContext(null);function Ig(){return Fe.useContext(Y_)!=null}function Ag(){return Ig()||uo(!1),Fe.useContext(Y_).location}function YT(_){Fe.useContext(Eg).static||Fe.useLayoutEffect(_)}function Bx(){let{isDataRoute:_}=Fe.useContext(pp);return _?_R():sR()}function sR(){Ig()||uo(!1);let _=Fe.useContext(Nx),{basename:b,future:I,navigator:z}=Fe.useContext(Eg),{matches:B}=Fe.useContext(pp),{pathname:$}=Ag(),re=JSON.stringify(HT(B,I.v7_relativeSplatPath)),s=Fe.useRef(!1);return YT(()=>{s.current=!0}),Fe.useCallback(function(be,Se){if(Se===void 0&&(Se={}),!s.current)return;if(typeof be=="number"){z.go(be);return}let Me=WT(be,JSON.parse(re),$,Se.relative==="path");_==null&&b!=="/"&&(Me.pathname=Me.pathname==="/"?b:lp([b,Me.pathname])),(Se.replace?z.replace:z.push)(Me,Se.state,Se)},[b,z,re,$,_])}function oR(_,b){return aR(_,b)}function aR(_,b,I,z){Ig()||uo(!1);let{navigator:B}=Fe.useContext(Eg),{matches:$}=Fe.useContext(pp),re=$[$.length-1],s=re?re.params:{};re&&re.pathname;let ce=re?re.pathnameBase:"/";re&&re.route;let be=Ag(),Se;if(b){var Me;let ct=typeof b=="string"?fp(b):b;ce==="/"||(Me=ct.pathname)!=null&&Me.startsWith(ce)||uo(!1),Se=ct}else Se=be;let tt=Se.pathname||"/",wt=tt;if(ce!=="/"){let ct=ce.replace(/^\//,"").split("/");wt="/"+tt.replace(/^\//,"").split("/").slice(ct.length).join("/")}let Xt=LP(_,{pathname:wt}),Be=dR(Xt&&Xt.map(ct=>Object.assign({},ct,{params:Object.assign({},s,ct.params),pathname:lp([ce,B.encodeLocation?B.encodeLocation(ct.pathname).pathname:ct.pathname]),pathnameBase:ct.pathnameBase==="/"?ce:lp([ce,B.encodeLocation?B.encodeLocation(ct.pathnameBase).pathname:ct.pathnameBase])})),$,I,z);return b&&Be?Fe.createElement(Y_.Provider,{value:{location:_g({pathname:"/",search:"",hash:"",state:null,key:"default"},Se),navigationType:cf.Pop}},Be):Be}function lR(){let _=gR(),b=rR(_)?_.status+" "+_.statusText:_ instanceof Error?_.message:JSON.stringify(_),I=_ instanceof Error?_.stack:null,B={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Fe.createElement(Fe.Fragment,null,Fe.createElement("h2",null,"Unexpected Application Error!"),Fe.createElement("h3",{style:{fontStyle:"italic"}},b),I?Fe.createElement("pre",{style:B},I):null,null)}const cR=Fe.createElement(lR,null);class uR extends Fe.Component{constructor(b){super(b),this.state={location:b.location,revalidation:b.revalidation,error:b.error}}static getDerivedStateFromError(b){return{error:b}}static getDerivedStateFromProps(b,I){return I.location!==b.location||I.revalidation!=="idle"&&b.revalidation==="idle"?{error:b.error,location:b.location,revalidation:b.revalidation}:{error:b.error!==void 0?b.error:I.error,location:I.location,revalidation:b.revalidation||I.revalidation}}componentDidCatch(b,I){console.error("React Router caught the following error during render",b,I)}render(){return this.state.error!==void 0?Fe.createElement(pp.Provider,{value:this.props.routeContext},Fe.createElement(XT.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function hR(_){let{routeContext:b,match:I,children:z}=_,B=Fe.useContext(Nx);return B&&B.static&&B.staticContext&&(I.route.errorElement||I.route.ErrorBoundary)&&(B.staticContext._deepestRenderedBoundaryId=I.route.id),Fe.createElement(pp.Provider,{value:b},z)}function dR(_,b,I,z){var B;if(b===void 0&&(b=[]),I===void 0&&(I=null),z===void 0&&(z=null),_==null){var $;if(!I)return null;if(I.errors)_=I.matches;else if(($=z)!=null&&$.v7_partialHydration&&b.length===0&&!I.initialized&&I.matches.length>0)_=I.matches;else return null}let re=_,s=(B=I)==null?void 0:B.errors;if(s!=null){let Se=re.findIndex(Me=>Me.route.id&&s?.[Me.route.id]!==void 0);Se>=0||uo(!1),re=re.slice(0,Math.min(re.length,Se+1))}let ce=!1,be=-1;if(I&&z&&z.v7_partialHydration)for(let Se=0;Se<re.length;Se++){let Me=re[Se];if((Me.route.HydrateFallback||Me.route.hydrateFallbackElement)&&(be=Se),Me.route.id){let{loaderData:tt,errors:wt}=I,Xt=Me.route.loader&&tt[Me.route.id]===void 0&&(!wt||wt[Me.route.id]===void 0);if(Me.route.lazy||Xt){ce=!0,be>=0?re=re.slice(0,be+1):re=[re[0]];break}}}return re.reduceRight((Se,Me,tt)=>{let wt,Xt=!1,Be=null,ct=null;I&&(wt=s&&Me.route.id?s[Me.route.id]:void 0,Be=Me.route.errorElement||cR,ce&&(be<0&&tt===0?(yR("route-fallback"),Xt=!0,ct=null):be===tt&&(Xt=!0,ct=Me.route.hydrateFallbackElement||null)));let Tt=b.concat(re.slice(0,tt+1)),Dt=()=>{let Vt;return wt?Vt=Be:Xt?Vt=ct:Me.route.Component?Vt=Fe.createElement(Me.route.Component,null):Me.route.element?Vt=Me.route.element:Vt=Se,Fe.createElement(hR,{match:Me,routeContext:{outlet:Se,matches:Tt,isDataRoute:I!=null},children:Vt})};return I&&(Me.route.ErrorBoundary||Me.route.errorElement||tt===0)?Fe.createElement(uR,{location:I.location,revalidation:I.revalidation,component:Be,error:wt,children:Dt(),routeContext:{outlet:null,matches:Tt,isDataRoute:!0}}):Dt()},null)}var KT=function(_){return _.UseBlocker="useBlocker",_.UseRevalidator="useRevalidator",_.UseNavigateStable="useNavigate",_}(KT||{}),JT=function(_){return _.UseBlocker="useBlocker",_.UseLoaderData="useLoaderData",_.UseActionData="useActionData",_.UseRouteError="useRouteError",_.UseNavigation="useNavigation",_.UseRouteLoaderData="useRouteLoaderData",_.UseMatches="useMatches",_.UseRevalidator="useRevalidator",_.UseNavigateStable="useNavigate",_.UseRouteId="useRouteId",_}(JT||{});function fR(_){let b=Fe.useContext(Nx);return b||uo(!1),b}function pR(_){let b=Fe.useContext(iR);return b||uo(!1),b}function mR(_){let b=Fe.useContext(pp);return b||uo(!1),b}function QT(_){let b=mR(),I=b.matches[b.matches.length-1];return I.route.id||uo(!1),I.route.id}function gR(){var _;let b=Fe.useContext(XT),I=pR(),z=QT();return b!==void 0?b:(_=I.errors)==null?void 0:_[z]}function _R(){let{router:_}=fR(KT.UseNavigateStable),b=QT(JT.UseNavigateStable),I=Fe.useRef(!1);return YT(()=>{I.current=!0}),Fe.useCallback(function(B,$){$===void 0&&($={}),I.current&&(typeof B=="number"?_.navigate(B):_.navigate(B,_g({fromRouteId:b},$)))},[_,b])}const P2={};function yR(_,b,I){P2[_]||(P2[_]=!0)}function vR(_,b){_?.v7_startTransition,_?.v7_relativeSplatPath}function xR(_){let{to:b,replace:I,state:z,relative:B}=_;Ig()||uo(!1);let{future:$,static:re}=Fe.useContext(Eg),{matches:s}=Fe.useContext(pp),{pathname:ce}=Ag(),be=Bx(),Se=WT(b,HT(s,$.v7_relativeSplatPath),ce,B==="path"),Me=JSON.stringify(Se);return Fe.useEffect(()=>be(JSON.parse(Me),{replace:I,state:z,relative:B}),[be,Me,B,I,z]),null}function ch(_){uo(!1)}function wR(_){let{basename:b="/",children:I=null,location:z,navigationType:B=cf.Pop,navigator:$,static:re=!1,future:s}=_;Ig()&&uo(!1);let ce=b.replace(/^\/*/,"/"),be=Fe.useMemo(()=>({basename:ce,navigator:$,static:re,future:_g({v7_relativeSplatPath:!1},s)}),[ce,s,$,re]);typeof z=="string"&&(z=fp(z));let{pathname:Se="/",search:Me="",hash:tt="",state:wt=null,key:Xt="default"}=z,Be=Fe.useMemo(()=>{let ct=qT(Se,ce);return ct==null?null:{location:{pathname:ct,search:Me,hash:tt,state:wt,key:Xt},navigationType:B}},[ce,Se,Me,tt,wt,Xt,B]);return Be==null?null:Fe.createElement(Eg.Provider,{value:be},Fe.createElement(Y_.Provider,{children:I,value:Be}))}function bR(_){let{children:b,location:I}=_;return oR(dx(b),I)}new Promise(()=>{});function dx(_,b){b===void 0&&(b=[]);let I=[];return Fe.Children.forEach(_,(z,B)=>{if(!Fe.isValidElement(z))return;let $=[...b,B];if(z.type===Fe.Fragment){I.push.apply(I,dx(z.props.children,$));return}z.type!==ch&&uo(!1),!z.props.index||!z.props.children||uo(!1);let re={id:z.props.id||$.join("-"),caseSensitive:z.props.caseSensitive,element:z.props.element,Component:z.props.Component,index:z.props.index,path:z.props.path,loader:z.props.loader,action:z.props.action,errorElement:z.props.errorElement,ErrorBoundary:z.props.ErrorBoundary,hasErrorBoundary:z.props.ErrorBoundary!=null||z.props.errorElement!=null,shouldRevalidate:z.props.shouldRevalidate,handle:z.props.handle,lazy:z.props.lazy};z.props.children&&(re.children=dx(z.props.children,$)),I.push(re)}),I}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const TR="6";try{window.__reactRouterVersion=TR}catch{}const SR="startTransition",R2=Ox[SR];function ER(_){let{basename:b,children:I,future:z,window:B}=_,$=Fe.useRef();$.current==null&&($.current=zP({window:B,v5Compat:!0}));let re=$.current,[s,ce]=Fe.useState({action:re.action,location:re.location}),{v7_startTransition:be}=z||{},Se=Fe.useCallback(Me=>{be&&R2?R2(()=>ce(Me)):ce(Me)},[ce,be]);return Fe.useLayoutEffect(()=>re.listen(Se),[re,Se]),Fe.useEffect(()=>vR(z),[z]),Fe.createElement(wR,{basename:b,children:I,location:s.location,navigationType:s.action,navigator:re,future:z})}var z2;(function(_){_.UseScrollRestoration="useScrollRestoration",_.UseSubmit="useSubmit",_.UseSubmitFetcher="useSubmitFetcher",_.UseFetcher="useFetcher",_.useViewTransitionState="useViewTransitionState"})(z2||(z2={}));var k2;(function(_){_.UseFetcher="useFetcher",_.UseFetchers="useFetchers",_.UseScrollRestoration="useScrollRestoration"})(k2||(k2={}));function D2(_,b){if(typeof _=="function")return _(b);_!=null&&(_.current=b)}function eS(..._){return b=>{let I=!1;const z=_.map(B=>{const $=D2(B,b);return!I&&typeof $=="function"&&(I=!0),$});if(I)return()=>{for(let B=0;B<z.length;B++){const $=z[B];typeof $=="function"?$():D2(_[B],null)}}}}function mp(..._){return Fe.useCallback(eS(..._),_)}function jx(_){const b=AR(_),I=Fe.forwardRef((z,B)=>{const{children:$,...re}=z,s=Fe.Children.toArray($),ce=s.find(MR);if(ce){const be=ce.props.children,Se=s.map(Me=>Me===ce?Fe.Children.count(be)>1?Fe.Children.only(null):Fe.isValidElement(be)?be.props.children:null:Me);return H.jsx(b,{...re,ref:B,children:Fe.isValidElement(be)?Fe.cloneElement(be,void 0,Se):null})}return H.jsx(b,{...re,ref:B,children:$})});return I.displayName=`${_}.Slot`,I}var IR=jx("Slot");function AR(_){const b=Fe.forwardRef((I,z)=>{const{children:B,...$}=I;if(Fe.isValidElement(B)){const re=RR(B),s=PR($,B.props);return B.type!==Fe.Fragment&&(s.ref=z?eS(z,re):re),Fe.cloneElement(B,s)}return Fe.Children.count(B)>1?Fe.Children.only(null):null});return b.displayName=`${_}.SlotClone`,b}var CR=Symbol("radix.slottable");function MR(_){return Fe.isValidElement(_)&&typeof _.type=="function"&&"__radixId"in _.type&&_.type.__radixId===CR}function PR(_,b){const I={...b};for(const z in b){const B=_[z],$=b[z];/^on[A-Z]/.test(z)?B&&$?I[z]=(...s)=>{const ce=$(...s);return B(...s),ce}:B&&(I[z]=B):z==="style"?I[z]={...B,...$}:z==="className"&&(I[z]=[B,$].filter(Boolean).join(" "))}return{..._,...I}}function RR(_){let b=Object.getOwnPropertyDescriptor(_.props,"ref")?.get,I=b&&"isReactWarning"in b&&b.isReactWarning;return I?_.ref:(b=Object.getOwnPropertyDescriptor(_,"ref")?.get,I=b&&"isReactWarning"in b&&b.isReactWarning,I?_.props.ref:_.props.ref||_.ref)}function tS(_){var b,I,z="";if(typeof _=="string"||typeof _=="number")z+=_;else if(typeof _=="object")if(Array.isArray(_)){var B=_.length;for(b=0;b<B;b++)_[b]&&(I=tS(_[b]))&&(z&&(z+=" "),z+=I)}else for(I in _)_[I]&&(z&&(z+=" "),z+=I);return z}function rS(){for(var _,b,I=0,z="",B=arguments.length;I<B;I++)(_=arguments[I])&&(b=tS(_))&&(z&&(z+=" "),z+=b);return z}const L2=_=>typeof _=="boolean"?`${_}`:_===0?"0":_,O2=rS,nS=(_,b)=>I=>{var z;if(b?.variants==null)return O2(_,I?.class,I?.className);const{variants:B,defaultVariants:$}=b,re=Object.keys(B).map(be=>{const Se=I?.[be],Me=$?.[be];if(Se===null)return null;const tt=L2(Se)||L2(Me);return B[be][tt]}),s=I&&Object.entries(I).reduce((be,Se)=>{let[Me,tt]=Se;return tt===void 0||(be[Me]=tt),be},{}),ce=b==null||(z=b.compoundVariants)===null||z===void 0?void 0:z.reduce((be,Se)=>{let{class:Me,className:tt,...wt}=Se;return Object.entries(wt).every(Xt=>{let[Be,ct]=Xt;return Array.isArray(ct)?ct.includes({...$,...s}[Be]):{...$,...s}[Be]===ct})?[...be,Me,tt]:be},[]);return O2(_,re,ce,I?.class,I?.className)},Vx="-",zR=_=>{const b=DR(_),{conflictingClassGroups:I,conflictingClassGroupModifiers:z}=_;return{getClassGroupId:re=>{const s=re.split(Vx);return s[0]===""&&s.length!==1&&s.shift(),iS(s,b)||kR(re)},getConflictingClassGroupIds:(re,s)=>{const ce=I[re]||[];return s&&z[re]?[...ce,...z[re]]:ce}}},iS=(_,b)=>{if(_.length===0)return b.classGroupId;const I=_[0],z=b.nextPart.get(I),B=z?iS(_.slice(1),z):void 0;if(B)return B;if(b.validators.length===0)return;const $=_.join(Vx);return b.validators.find(({validator:re})=>re($))?.classGroupId},F2=/^\[(.+)\]$/,kR=_=>{if(F2.test(_)){const b=F2.exec(_)[1],I=b?.substring(0,b.indexOf(":"));if(I)return"arbitrary.."+I}},DR=_=>{const{theme:b,classGroups:I}=_,z={nextPart:new Map,validators:[]};for(const B in I)fx(I[B],z,B,b);return z},fx=(_,b,I,z)=>{_.forEach(B=>{if(typeof B=="string"){const $=B===""?b:N2(b,B);$.classGroupId=I;return}if(typeof B=="function"){if(LR(B)){fx(B(z),b,I,z);return}b.validators.push({validator:B,classGroupId:I});return}Object.entries(B).forEach(([$,re])=>{fx(re,N2(b,$),I,z)})})},N2=(_,b)=>{let I=_;return b.split(Vx).forEach(z=>{I.nextPart.has(z)||I.nextPart.set(z,{nextPart:new Map,validators:[]}),I=I.nextPart.get(z)}),I},LR=_=>_.isThemeGetter,OR=_=>{if(_<1)return{get:()=>{},set:()=>{}};let b=0,I=new Map,z=new Map;const B=($,re)=>{I.set($,re),b++,b>_&&(b=0,z=I,I=new Map)};return{get($){let re=I.get($);if(re!==void 0)return re;if((re=z.get($))!==void 0)return B($,re),re},set($,re){I.has($)?I.set($,re):B($,re)}}},px="!",mx=":",FR=mx.length,NR=_=>{const{prefix:b,experimentalParseClassName:I}=_;let z=B=>{const $=[];let re=0,s=0,ce=0,be;for(let Xt=0;Xt<B.length;Xt++){let Be=B[Xt];if(re===0&&s===0){if(Be===mx){$.push(B.slice(ce,Xt)),ce=Xt+FR;continue}if(Be==="/"){be=Xt;continue}}Be==="["?re++:Be==="]"?re--:Be==="("?s++:Be===")"&&s--}const Se=$.length===0?B:B.substring(ce),Me=BR(Se),tt=Me!==Se,wt=be&&be>ce?be-ce:void 0;return{modifiers:$,hasImportantModifier:tt,baseClassName:Me,maybePostfixModifierPosition:wt}};if(b){const B=b+mx,$=z;z=re=>re.startsWith(B)?$(re.substring(B.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:re,maybePostfixModifierPosition:void 0}}if(I){const B=z;z=$=>I({className:$,parseClassName:B})}return z},BR=_=>_.endsWith(px)?_.substring(0,_.length-1):_.startsWith(px)?_.substring(1):_,jR=_=>{const b=Object.fromEntries(_.orderSensitiveModifiers.map(z=>[z,!0]));return z=>{if(z.length<=1)return z;const B=[];let $=[];return z.forEach(re=>{re[0]==="["||b[re]?(B.push(...$.sort(),re),$=[]):$.push(re)}),B.push(...$.sort()),B}},VR=_=>({cache:OR(_.cacheSize),parseClassName:NR(_),sortModifiers:jR(_),...zR(_)}),UR=/\s+/,$R=(_,b)=>{const{parseClassName:I,getClassGroupId:z,getConflictingClassGroupIds:B,sortModifiers:$}=b,re=[],s=_.trim().split(UR);let ce="";for(let be=s.length-1;be>=0;be-=1){const Se=s[be],{isExternal:Me,modifiers:tt,hasImportantModifier:wt,baseClassName:Xt,maybePostfixModifierPosition:Be}=I(Se);if(Me){ce=Se+(ce.length>0?" "+ce:ce);continue}let ct=!!Be,Tt=z(ct?Xt.substring(0,Be):Xt);if(!Tt){if(!ct){ce=Se+(ce.length>0?" "+ce:ce);continue}if(Tt=z(Xt),!Tt){ce=Se+(ce.length>0?" "+ce:ce);continue}ct=!1}const Dt=$(tt).join(":"),Vt=wt?Dt+px:Dt,jt=Vt+Tt;if(re.includes(jt))continue;re.push(jt);const vr=B(Tt,ct);for(let hr=0;hr<vr.length;++hr){const Kt=vr[hr];re.push(Vt+Kt)}ce=Se+(ce.length>0?" "+ce:ce)}return ce};function GR(){let _=0,b,I,z="";for(;_<arguments.length;)(b=arguments[_++])&&(I=sS(b))&&(z&&(z+=" "),z+=I);return z}const sS=_=>{if(typeof _=="string")return _;let b,I="";for(let z=0;z<_.length;z++)_[z]&&(b=sS(_[z]))&&(I&&(I+=" "),I+=b);return I};function qR(_,...b){let I,z,B,$=re;function re(ce){const be=b.reduce((Se,Me)=>Me(Se),_());return I=VR(be),z=I.cache.get,B=I.cache.set,$=s,s(ce)}function s(ce){const be=z(ce);if(be)return be;const Se=$R(ce,I);return B(ce,Se),Se}return function(){return $(GR.apply(null,arguments))}}const Io=_=>{const b=I=>I[_]||[];return b.isThemeGetter=!0,b},oS=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,aS=/^\((?:(\w[\w-]*):)?(.+)\)$/i,HR=/^\d+\/\d+$/,WR=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,ZR=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,XR=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,YR=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,KR=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Jp=_=>HR.test(_),ci=_=>!!_&&!Number.isNaN(Number(_)),af=_=>!!_&&Number.isInteger(Number(_)),Nv=_=>_.endsWith("%")&&ci(_.slice(0,-1)),id=_=>WR.test(_),JR=()=>!0,QR=_=>ZR.test(_)&&!XR.test(_),lS=()=>!1,ez=_=>YR.test(_),tz=_=>KR.test(_),rz=_=>!Yr(_)&&!Kr(_),nz=_=>cm(_,hS,lS),Yr=_=>oS.test(_),ip=_=>cm(_,dS,QR),Bv=_=>cm(_,lz,ci),B2=_=>cm(_,cS,lS),iz=_=>cm(_,uS,tz),I_=_=>cm(_,fS,ez),Kr=_=>aS.test(_),sg=_=>um(_,dS),sz=_=>um(_,cz),j2=_=>um(_,cS),oz=_=>um(_,hS),az=_=>um(_,uS),A_=_=>um(_,fS,!0),cm=(_,b,I)=>{const z=oS.exec(_);return z?z[1]?b(z[1]):I(z[2]):!1},um=(_,b,I=!1)=>{const z=aS.exec(_);return z?z[1]?b(z[1]):I:!1},cS=_=>_==="position"||_==="percentage",uS=_=>_==="image"||_==="url",hS=_=>_==="length"||_==="size"||_==="bg-size",dS=_=>_==="length",lz=_=>_==="number",cz=_=>_==="family-name",fS=_=>_==="shadow",uz=()=>{const _=Io("color"),b=Io("font"),I=Io("text"),z=Io("font-weight"),B=Io("tracking"),$=Io("leading"),re=Io("breakpoint"),s=Io("container"),ce=Io("spacing"),be=Io("radius"),Se=Io("shadow"),Me=Io("inset-shadow"),tt=Io("text-shadow"),wt=Io("drop-shadow"),Xt=Io("blur"),Be=Io("perspective"),ct=Io("aspect"),Tt=Io("ease"),Dt=Io("animate"),Vt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],jt=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],vr=()=>[...jt(),Kr,Yr],hr=()=>["auto","hidden","clip","visible","scroll"],Kt=()=>["auto","contain","none"],Wt=()=>[Kr,Yr,ce],Cr=()=>[Jp,"full","auto",...Wt()],oi=()=>[af,"none","subgrid",Kr,Yr],fn=()=>["auto",{span:["full",af,Kr,Yr]},af,Kr,Yr],ui=()=>[af,"auto",Kr,Yr],gr=()=>["auto","min","max","fr",Kr,Yr],Mr=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],rn=()=>["start","end","center","stretch","center-safe","end-safe"],nn=()=>["auto",...Wt()],un=()=>[Jp,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...Wt()],At=()=>[_,Kr,Yr],Tr=()=>[...jt(),j2,B2,{position:[Kr,Yr]}],Ht=()=>["no-repeat",{repeat:["","x","y","space","round"]}],rt=()=>["auto","cover","contain",oz,nz,{size:[Kr,Yr]}],Ot=()=>[Nv,sg,ip],Pr=()=>["","none","full",be,Kr,Yr],Hr=()=>["",ci,sg,ip],br=()=>["solid","dashed","dotted","double"],Br=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Sr=()=>[ci,Nv,j2,B2],vn=()=>["","none",Xt,Kr,Yr],Ar=()=>["none",ci,Kr,Yr],Pi=()=>["none",ci,Kr,Yr],qi=()=>[ci,Kr,Yr],us=()=>[Jp,"full",...Wt()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[id],breakpoint:[id],color:[JR],container:[id],"drop-shadow":[id],ease:["in","out","in-out"],font:[rz],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[id],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[id],shadow:[id],spacing:["px",ci],text:[id],"text-shadow":[id],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Jp,Yr,Kr,ct]}],container:["container"],columns:[{columns:[ci,Yr,Kr,s]}],"break-after":[{"break-after":Vt()}],"break-before":[{"break-before":Vt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:vr()}],overflow:[{overflow:hr()}],"overflow-x":[{"overflow-x":hr()}],"overflow-y":[{"overflow-y":hr()}],overscroll:[{overscroll:Kt()}],"overscroll-x":[{"overscroll-x":Kt()}],"overscroll-y":[{"overscroll-y":Kt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:Cr()}],"inset-x":[{"inset-x":Cr()}],"inset-y":[{"inset-y":Cr()}],start:[{start:Cr()}],end:[{end:Cr()}],top:[{top:Cr()}],right:[{right:Cr()}],bottom:[{bottom:Cr()}],left:[{left:Cr()}],visibility:["visible","invisible","collapse"],z:[{z:[af,"auto",Kr,Yr]}],basis:[{basis:[Jp,"full","auto",s,...Wt()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[ci,Jp,"auto","initial","none",Yr]}],grow:[{grow:["",ci,Kr,Yr]}],shrink:[{shrink:["",ci,Kr,Yr]}],order:[{order:[af,"first","last","none",Kr,Yr]}],"grid-cols":[{"grid-cols":oi()}],"col-start-end":[{col:fn()}],"col-start":[{"col-start":ui()}],"col-end":[{"col-end":ui()}],"grid-rows":[{"grid-rows":oi()}],"row-start-end":[{row:fn()}],"row-start":[{"row-start":ui()}],"row-end":[{"row-end":ui()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":gr()}],"auto-rows":[{"auto-rows":gr()}],gap:[{gap:Wt()}],"gap-x":[{"gap-x":Wt()}],"gap-y":[{"gap-y":Wt()}],"justify-content":[{justify:[...Mr(),"normal"]}],"justify-items":[{"justify-items":[...rn(),"normal"]}],"justify-self":[{"justify-self":["auto",...rn()]}],"align-content":[{content:["normal",...Mr()]}],"align-items":[{items:[...rn(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...rn(),{baseline:["","last"]}]}],"place-content":[{"place-content":Mr()}],"place-items":[{"place-items":[...rn(),"baseline"]}],"place-self":[{"place-self":["auto",...rn()]}],p:[{p:Wt()}],px:[{px:Wt()}],py:[{py:Wt()}],ps:[{ps:Wt()}],pe:[{pe:Wt()}],pt:[{pt:Wt()}],pr:[{pr:Wt()}],pb:[{pb:Wt()}],pl:[{pl:Wt()}],m:[{m:nn()}],mx:[{mx:nn()}],my:[{my:nn()}],ms:[{ms:nn()}],me:[{me:nn()}],mt:[{mt:nn()}],mr:[{mr:nn()}],mb:[{mb:nn()}],ml:[{ml:nn()}],"space-x":[{"space-x":Wt()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":Wt()}],"space-y-reverse":["space-y-reverse"],size:[{size:un()}],w:[{w:[s,"screen",...un()]}],"min-w":[{"min-w":[s,"screen","none",...un()]}],"max-w":[{"max-w":[s,"screen","none","prose",{screen:[re]},...un()]}],h:[{h:["screen","lh",...un()]}],"min-h":[{"min-h":["screen","lh","none",...un()]}],"max-h":[{"max-h":["screen","lh",...un()]}],"font-size":[{text:["base",I,sg,ip]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[z,Kr,Bv]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Nv,Yr]}],"font-family":[{font:[sz,Yr,b]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[B,Kr,Yr]}],"line-clamp":[{"line-clamp":[ci,"none",Kr,Bv]}],leading:[{leading:[$,...Wt()]}],"list-image":[{"list-image":["none",Kr,Yr]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Kr,Yr]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:At()}],"text-color":[{text:At()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...br(),"wavy"]}],"text-decoration-thickness":[{decoration:[ci,"from-font","auto",Kr,ip]}],"text-decoration-color":[{decoration:At()}],"underline-offset":[{"underline-offset":[ci,"auto",Kr,Yr]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Wt()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Kr,Yr]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Kr,Yr]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:Tr()}],"bg-repeat":[{bg:Ht()}],"bg-size":[{bg:rt()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},af,Kr,Yr],radial:["",Kr,Yr],conic:[af,Kr,Yr]},az,iz]}],"bg-color":[{bg:At()}],"gradient-from-pos":[{from:Ot()}],"gradient-via-pos":[{via:Ot()}],"gradient-to-pos":[{to:Ot()}],"gradient-from":[{from:At()}],"gradient-via":[{via:At()}],"gradient-to":[{to:At()}],rounded:[{rounded:Pr()}],"rounded-s":[{"rounded-s":Pr()}],"rounded-e":[{"rounded-e":Pr()}],"rounded-t":[{"rounded-t":Pr()}],"rounded-r":[{"rounded-r":Pr()}],"rounded-b":[{"rounded-b":Pr()}],"rounded-l":[{"rounded-l":Pr()}],"rounded-ss":[{"rounded-ss":Pr()}],"rounded-se":[{"rounded-se":Pr()}],"rounded-ee":[{"rounded-ee":Pr()}],"rounded-es":[{"rounded-es":Pr()}],"rounded-tl":[{"rounded-tl":Pr()}],"rounded-tr":[{"rounded-tr":Pr()}],"rounded-br":[{"rounded-br":Pr()}],"rounded-bl":[{"rounded-bl":Pr()}],"border-w":[{border:Hr()}],"border-w-x":[{"border-x":Hr()}],"border-w-y":[{"border-y":Hr()}],"border-w-s":[{"border-s":Hr()}],"border-w-e":[{"border-e":Hr()}],"border-w-t":[{"border-t":Hr()}],"border-w-r":[{"border-r":Hr()}],"border-w-b":[{"border-b":Hr()}],"border-w-l":[{"border-l":Hr()}],"divide-x":[{"divide-x":Hr()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":Hr()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...br(),"hidden","none"]}],"divide-style":[{divide:[...br(),"hidden","none"]}],"border-color":[{border:At()}],"border-color-x":[{"border-x":At()}],"border-color-y":[{"border-y":At()}],"border-color-s":[{"border-s":At()}],"border-color-e":[{"border-e":At()}],"border-color-t":[{"border-t":At()}],"border-color-r":[{"border-r":At()}],"border-color-b":[{"border-b":At()}],"border-color-l":[{"border-l":At()}],"divide-color":[{divide:At()}],"outline-style":[{outline:[...br(),"none","hidden"]}],"outline-offset":[{"outline-offset":[ci,Kr,Yr]}],"outline-w":[{outline:["",ci,sg,ip]}],"outline-color":[{outline:At()}],shadow:[{shadow:["","none",Se,A_,I_]}],"shadow-color":[{shadow:At()}],"inset-shadow":[{"inset-shadow":["none",Me,A_,I_]}],"inset-shadow-color":[{"inset-shadow":At()}],"ring-w":[{ring:Hr()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:At()}],"ring-offset-w":[{"ring-offset":[ci,ip]}],"ring-offset-color":[{"ring-offset":At()}],"inset-ring-w":[{"inset-ring":Hr()}],"inset-ring-color":[{"inset-ring":At()}],"text-shadow":[{"text-shadow":["none",tt,A_,I_]}],"text-shadow-color":[{"text-shadow":At()}],opacity:[{opacity:[ci,Kr,Yr]}],"mix-blend":[{"mix-blend":[...Br(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":Br()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[ci]}],"mask-image-linear-from-pos":[{"mask-linear-from":Sr()}],"mask-image-linear-to-pos":[{"mask-linear-to":Sr()}],"mask-image-linear-from-color":[{"mask-linear-from":At()}],"mask-image-linear-to-color":[{"mask-linear-to":At()}],"mask-image-t-from-pos":[{"mask-t-from":Sr()}],"mask-image-t-to-pos":[{"mask-t-to":Sr()}],"mask-image-t-from-color":[{"mask-t-from":At()}],"mask-image-t-to-color":[{"mask-t-to":At()}],"mask-image-r-from-pos":[{"mask-r-from":Sr()}],"mask-image-r-to-pos":[{"mask-r-to":Sr()}],"mask-image-r-from-color":[{"mask-r-from":At()}],"mask-image-r-to-color":[{"mask-r-to":At()}],"mask-image-b-from-pos":[{"mask-b-from":Sr()}],"mask-image-b-to-pos":[{"mask-b-to":Sr()}],"mask-image-b-from-color":[{"mask-b-from":At()}],"mask-image-b-to-color":[{"mask-b-to":At()}],"mask-image-l-from-pos":[{"mask-l-from":Sr()}],"mask-image-l-to-pos":[{"mask-l-to":Sr()}],"mask-image-l-from-color":[{"mask-l-from":At()}],"mask-image-l-to-color":[{"mask-l-to":At()}],"mask-image-x-from-pos":[{"mask-x-from":Sr()}],"mask-image-x-to-pos":[{"mask-x-to":Sr()}],"mask-image-x-from-color":[{"mask-x-from":At()}],"mask-image-x-to-color":[{"mask-x-to":At()}],"mask-image-y-from-pos":[{"mask-y-from":Sr()}],"mask-image-y-to-pos":[{"mask-y-to":Sr()}],"mask-image-y-from-color":[{"mask-y-from":At()}],"mask-image-y-to-color":[{"mask-y-to":At()}],"mask-image-radial":[{"mask-radial":[Kr,Yr]}],"mask-image-radial-from-pos":[{"mask-radial-from":Sr()}],"mask-image-radial-to-pos":[{"mask-radial-to":Sr()}],"mask-image-radial-from-color":[{"mask-radial-from":At()}],"mask-image-radial-to-color":[{"mask-radial-to":At()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":jt()}],"mask-image-conic-pos":[{"mask-conic":[ci]}],"mask-image-conic-from-pos":[{"mask-conic-from":Sr()}],"mask-image-conic-to-pos":[{"mask-conic-to":Sr()}],"mask-image-conic-from-color":[{"mask-conic-from":At()}],"mask-image-conic-to-color":[{"mask-conic-to":At()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:Tr()}],"mask-repeat":[{mask:Ht()}],"mask-size":[{mask:rt()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Kr,Yr]}],filter:[{filter:["","none",Kr,Yr]}],blur:[{blur:vn()}],brightness:[{brightness:[ci,Kr,Yr]}],contrast:[{contrast:[ci,Kr,Yr]}],"drop-shadow":[{"drop-shadow":["","none",wt,A_,I_]}],"drop-shadow-color":[{"drop-shadow":At()}],grayscale:[{grayscale:["",ci,Kr,Yr]}],"hue-rotate":[{"hue-rotate":[ci,Kr,Yr]}],invert:[{invert:["",ci,Kr,Yr]}],saturate:[{saturate:[ci,Kr,Yr]}],sepia:[{sepia:["",ci,Kr,Yr]}],"backdrop-filter":[{"backdrop-filter":["","none",Kr,Yr]}],"backdrop-blur":[{"backdrop-blur":vn()}],"backdrop-brightness":[{"backdrop-brightness":[ci,Kr,Yr]}],"backdrop-contrast":[{"backdrop-contrast":[ci,Kr,Yr]}],"backdrop-grayscale":[{"backdrop-grayscale":["",ci,Kr,Yr]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[ci,Kr,Yr]}],"backdrop-invert":[{"backdrop-invert":["",ci,Kr,Yr]}],"backdrop-opacity":[{"backdrop-opacity":[ci,Kr,Yr]}],"backdrop-saturate":[{"backdrop-saturate":[ci,Kr,Yr]}],"backdrop-sepia":[{"backdrop-sepia":["",ci,Kr,Yr]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":Wt()}],"border-spacing-x":[{"border-spacing-x":Wt()}],"border-spacing-y":[{"border-spacing-y":Wt()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Kr,Yr]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[ci,"initial",Kr,Yr]}],ease:[{ease:["linear","initial",Tt,Kr,Yr]}],delay:[{delay:[ci,Kr,Yr]}],animate:[{animate:["none",Dt,Kr,Yr]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[Be,Kr,Yr]}],"perspective-origin":[{"perspective-origin":vr()}],rotate:[{rotate:Ar()}],"rotate-x":[{"rotate-x":Ar()}],"rotate-y":[{"rotate-y":Ar()}],"rotate-z":[{"rotate-z":Ar()}],scale:[{scale:Pi()}],"scale-x":[{"scale-x":Pi()}],"scale-y":[{"scale-y":Pi()}],"scale-z":[{"scale-z":Pi()}],"scale-3d":["scale-3d"],skew:[{skew:qi()}],"skew-x":[{"skew-x":qi()}],"skew-y":[{"skew-y":qi()}],transform:[{transform:[Kr,Yr,"","none","gpu","cpu"]}],"transform-origin":[{origin:vr()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:us()}],"translate-x":[{"translate-x":us()}],"translate-y":[{"translate-y":us()}],"translate-z":[{"translate-z":us()}],"translate-none":["translate-none"],accent:[{accent:At()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:At()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Kr,Yr]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Wt()}],"scroll-mx":[{"scroll-mx":Wt()}],"scroll-my":[{"scroll-my":Wt()}],"scroll-ms":[{"scroll-ms":Wt()}],"scroll-me":[{"scroll-me":Wt()}],"scroll-mt":[{"scroll-mt":Wt()}],"scroll-mr":[{"scroll-mr":Wt()}],"scroll-mb":[{"scroll-mb":Wt()}],"scroll-ml":[{"scroll-ml":Wt()}],"scroll-p":[{"scroll-p":Wt()}],"scroll-px":[{"scroll-px":Wt()}],"scroll-py":[{"scroll-py":Wt()}],"scroll-ps":[{"scroll-ps":Wt()}],"scroll-pe":[{"scroll-pe":Wt()}],"scroll-pt":[{"scroll-pt":Wt()}],"scroll-pr":[{"scroll-pr":Wt()}],"scroll-pb":[{"scroll-pb":Wt()}],"scroll-pl":[{"scroll-pl":Wt()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Kr,Yr]}],fill:[{fill:["none",...At()]}],"stroke-w":[{stroke:[ci,sg,ip,Bv]}],stroke:[{stroke:["none",...At()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},hz=qR(uz);function od(..._){return hz(rS(_))}const dz=nS("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),ts=Fe.forwardRef(({className:_,variant:b,size:I,asChild:z=!1,...B},$)=>{const re=z?IR:"button";return H.jsx(re,{className:od(dz({variant:b,size:I,className:_})),ref:$,...B})});ts.displayName="Button";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fz=_=>_.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),pz=_=>_.replace(/^([A-Z])|[\s-_]+(\w)/g,(b,I,z)=>z?z.toUpperCase():I.toLowerCase()),V2=_=>{const b=pz(_);return b.charAt(0).toUpperCase()+b.slice(1)},pS=(..._)=>_.filter((b,I,z)=>!!b&&b.trim()!==""&&z.indexOf(b)===I).join(" ").trim(),mz=_=>{for(const b in _)if(b.startsWith("aria-")||b==="role"||b==="title")return!0};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var gz={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _z=Fe.forwardRef(({color:_="currentColor",size:b=24,strokeWidth:I=2,absoluteStrokeWidth:z,className:B="",children:$,iconNode:re,...s},ce)=>Fe.createElement("svg",{ref:ce,...gz,width:b,height:b,stroke:_,strokeWidth:z?Number(I)*24/Number(b):I,className:pS("lucide",B),...!$&&!mz(s)&&{"aria-hidden":"true"},...s},[...re.map(([be,Se])=>Fe.createElement(be,Se)),...Array.isArray($)?$:[$]]));/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vi=(_,b)=>{const I=Fe.forwardRef(({className:z,...B},$)=>Fe.createElement(_z,{ref:$,iconNode:b,className:pS(`lucide-${fz(V2(_))}`,`lucide-${_}`,z),...B}));return I.displayName=V2(_),I};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yz=[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]],vz=Vi("arrow-down-left",yz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xz=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],wz=Vi("arrow-left",xz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bz=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],U2=Vi("arrow-up-right",bz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tz=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Sz=Vi("chevron-right",Tz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ez=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Iz=Vi("circle-check-big",Ez);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Az=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Cz=Vi("circle-x",Az);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mz=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],U_=Vi("clock",Mz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pz=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],Rz=Vi("credit-card",Pz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zz=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],kz=Vi("crown",zz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dz=[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]],Lz=Vi("heart",Dz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oz=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],Fz=Vi("history",Oz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nz=[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]],K_=Vi("leaf",Nz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bz=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Ux=Vi("map-pin",Bz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jz=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],mS=Vi("message-circle",jz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vz=[["path",{d:"M5 12h14",key:"1ays0h"}]],Uz=Vi("minus",Vz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $z=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],gS=Vi("navigation",$z);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gz=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],_S=Vi("plus",Gz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qz=[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]],Hz=Vi("rocket",qz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wz=[["path",{d:"M17 12v4a1 1 0 0 1-1 1h-4",key:"uk4fdo"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M17 8V7",key:"q2g9wo"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M7 17h.01",key:"19xn7k"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["rect",{x:"7",y:"7",width:"5",height:"5",rx:"1",key:"m9kyts"}]],$x=Vi("scan-qr-code",Wz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zz=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Xz=Vi("share-2",Zz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yz=[["path",{d:"M12 2v13",key:"1km8f5"}],["path",{d:"m16 6-4-4-4 4",key:"13yo43"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}]],jv=Vi("share",Yz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kz=[["path",{d:"M7 20h10",key:"e6iznv"}],["path",{d:"M10 20c5.5-2.5.8-6.4 3-10",key:"161w41"}],["path",{d:"M9.5 9.4c1.1.8 1.8 2.2 2.3 3.7-2 .4-3.5.4-4.8-.3-1.2-.6-2.3-1.9-3-4.2 2.8-.5 4.4 0 5.5.8z",key:"9gtqwd"}],["path",{d:"M14.1 6a7 7 0 0 0-1.1 4c1.9-.1 3.3-.6 4.3-1.4 1-1 1.6-2.3 1.7-4.6-2.7.1-4 1-4.9 2z",key:"bkxnd2"}]],Vv=Vi("sprout",Kz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jz=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Qz=Vi("square",Jz);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ek=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],$2=Vi("star",ek);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tk=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],rk=Vi("trophy",tk);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nk=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],ik=Vi("user",nk);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sk=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],ok=Vi("users",sk);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ak=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],gx=Vi("wallet",ak);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lk=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],ck=Vi("zap",lk),uk=[{id:"home",label:"Главная",icon:$x,path:"/"},{id:"profile",label:"Профиль",icon:ik,path:"/profile"},{id:"history",label:"История",icon:Fz,path:"/history"}];function hk(){const _=Ag(),b=Bx();return H.jsx("nav",{className:"relative bg-white border-t border-gray-200 px-4 py-2 pb-5 z-1 w-full",children:H.jsx("div",{className:"flex justify-around",children:uk.map(I=>{const z=I.icon,B=_.pathname===I.path;return H.jsxs(ts,{variant:"ghost",className:`flex-col h-auto py-2 px-3 ${B?"text-blue-600":"text-gray-600"}`,onClick:()=>b(I.path),children:[H.jsx(z,{className:"h-5 w-5 mb-1"}),H.jsx("span",{className:"text-xs",children:I.label})]},I.id)})})})}var dk=Object.defineProperty,fk=(_,b,I)=>b in _?dk(_,b,{enumerable:!0,configurable:!0,writable:!0,value:I}):_[b]=I,Fl=(_,b,I)=>(fk(_,typeof b!="symbol"?b+"":b,I),I);function yS(_,b){let I;const z=()=>{I!==void 0&&b&&b(I),I=void 0};return[()=>I===void 0?I=_(z):I,z]}let pk=class{constructor(b,I={}){this.scope=b,this.options=I}print(b,...I){const z=new Date,B=Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,timeZone:"UTC"}).format(z),{textColor:$,bgColor:re}=this.options,s="font-weight: bold;padding: 0 5px;border-radius:5px";console[b](`%c${B}%c / %c${this.scope}`,`${s};background-color: lightblue;color:black`,"",`${s};${$?`color:${$};`:""}${re?`background-color:${re}`:""}`,...I)}error(...b){this.print("error",...b)}log(...b){this.print("log",...b)}};const mk=new pk("SDK",{bgColor:"forestgreen",textColor:"white"});let _x=class{constructor(){Fl(this,"listeners",new Map),Fl(this,"listenersCount",0),Fl(this,"subscribeListeners",[])}clear(){this.listeners.clear(),this.subscribeListeners=[]}get count(){return this.listenersCount+this.subscribeListeners.length}emit(b,...I){this.subscribeListeners.forEach(z=>z({event:b,args:I})),(this.listeners.get(b)||[]).forEach(([z,B])=>{z(...I),B&&this.off(b,z)})}on(b,I,z){let B=this.listeners.get(b);return B||this.listeners.set(b,B=[]),B.push([I,z]),this.listenersCount+=1,()=>this.off(b,I)}off(b,I){const z=this.listeners.get(b)||[];for(let B=0;B<z.length;B+=1)if(I===z[B][0]){z.splice(B,1),this.listenersCount-=1;return}}subscribe(b){return this.subscribeListeners.push(b),()=>this.unsubscribe(b)}unsubscribe(b){for(let I=0;I<this.subscribeListeners.length;I+=1)if(this.subscribeListeners[I]===b){this.subscribeListeners.splice(I,1);return}}};function G2(_,b,I){return window.addEventListener(_,b,I),()=>window.removeEventListener(_,b,I)}function Gx(..._){let b=!1;const I=_.flat(1);return[z=>!b&&I.push(z),()=>{b||(b=!0,I.forEach(z=>z()))},b]}let gk=class vS extends Error{constructor(b,I,z){super(I,{cause:z}),this.type=b,Object.setPrototypeOf(this,vS.prototype)}};function up(_,b,I){return new gk(_,b,I)}const _k="ERR_METHOD_UNSUPPORTED",yk="ERR_METHOD_PARAMETER_UNSUPPORTED",vk="ERR_UNKNOWN_ENV",xk="ERR_TIMED_OUT",wk="ERR_UNEXPECTED_TYPE",xS="ERR_PARSE";function Cg(){return up(wk,"Value has unexpected type")}let qx=class{constructor(b,I,z){this.parser=b,this.isOptional=I,this.type=z}parse(b){if(!(this.isOptional&&b===void 0))try{return this.parser(b)}catch(I){throw up(xS,`Unable to parse value${this.type?` as ${this.type}`:""}`,I)}}optional(){return this.isOptional=!0,this}};function hm(_,b){return()=>new qx(_,!1,b)}const uf=hm(_=>{if(typeof _=="boolean")return _;const b=String(_);if(b==="1"||b==="true")return!0;if(b==="0"||b==="false")return!1;throw Cg()},"boolean");function wS(_,b){const I={};for(const z in _){const B=_[z];if(!B)continue;let $,re;if(typeof B=="function"||"parse"in B)$=z,re=typeof B=="function"?B:B.parse.bind(B);else{const{type:s}=B;$=B.from||z,re=typeof s=="function"?s:s.parse.bind(s)}try{const s=re(b($));s!==void 0&&(I[z]=s)}catch(s){throw up(xS,`Unable to parse field "${z}"`,s)}}return I}function bS(_){let b=_;if(typeof b=="string"&&(b=JSON.parse(b)),typeof b!="object"||b===null||Array.isArray(b))throw Cg();return b}function op(_,b){return new qx(I=>{const z=bS(I);return wS(_,B=>z[B])},!1,b)}const om=hm(_=>{if(typeof _=="number")return _;if(typeof _=="string"){const b=Number(_);if(!Number.isNaN(b))return b}throw Cg()},"number"),cs=hm(_=>{if(typeof _=="string"||typeof _=="number")return _.toString();throw Cg()},"string");function bk(_){return op({eventType:cs(),eventData:b=>b}).parse(_)}function Tk(){["TelegramGameProxy_receiveEvent","TelegramGameProxy","Telegram"].forEach(_=>{delete window[_]})}function Sk(_,b){window.dispatchEvent(new MessageEvent("message",{data:JSON.stringify({eventType:_,eventData:b}),source:window.parent}))}function Ek(){[["TelegramGameProxy_receiveEvent"],["TelegramGameProxy","receiveEvent"],["Telegram","WebView","receiveEvent"]].forEach(_=>{let b=window;_.forEach((I,z,B)=>{if(z===B.length-1){b[I]=Sk;return}I in b||(b[I]={}),b=b[I]})})}const Ik={clipboard_text_received:op({req_id:cs(),data:_=>_===null?_:cs().optional().parse(_)}),custom_method_invoked:op({req_id:cs(),result:_=>_,error:cs().optional()}),popup_closed:{parse(_){return op({button_id:b=>b==null?void 0:cs().parse(b)}).parse(_??{})}},viewport_changed:op({height:om(),width:_=>_==null?window.innerWidth:om().parse(_),is_state_stable:uf(),is_expanded:uf()})};function Ak(){const _=new _x,b=new _x;b.subscribe(z=>{_.emit("event",{name:z.event,payload:z.args[0]})}),Ek();const[,I]=Gx(Tk,G2("resize",()=>{b.emit("viewport_changed",{width:window.innerWidth,height:window.innerHeight,is_state_stable:!0,is_expanded:!0})}),G2("message",z=>{if(z.source!==window.parent)return;let B;try{B=bk(z.data)}catch{return}const{eventType:$,eventData:re}=B,s=Ik[$];try{const ce=s?s.parse(re):re;b.emit(...ce?[$,ce]:[$])}catch(ce){mk.error(`An error occurred processing the "${$}" event from the Telegram application.
Please, file an issue here:
https://github.com/Telegram-Mini-Apps/telegram-apps/issues/new/choose`,B,ce)}}),()=>_.clear(),()=>b.clear());return[{on:b.on.bind(b),off:b.off.bind(b),subscribe(z){return _.on("event",z)},unsubscribe(z){_.off("event",z)},get count(){return b.count+_.count}},I]}const[Ck,dB]=yS(_=>{const[b,I]=Ak(),z=b.off.bind(b);return b.off=(B,$)=>{const{count:re}=b;z(B,$),re&&!b.count&&_()},[b,I]},([,_])=>_());function Mk(){return Ck()[0]}function Pk(_,b,I){return Mk().on(_,b,I)}function Hx(_){return typeof _=="object"&&_!==null&&!Array.isArray(_)}function Rk(_,b){const I=_.split("."),z=b.split("."),B=Math.max(I.length,z.length);for(let $=0;$<B;$+=1){const re=parseInt(I[$]||"0",10),s=parseInt(z[$]||"0",10);if(re!==s)return re>s?1:-1}return 0}function bc(_,b){return Rk(_,b)<=0}function yx(_,b,I){if(typeof I=="string"){if(_==="web_app_open_link"){if(b==="try_instant_view")return bc("6.4",I);if(b==="try_browser")return bc("7.6",I)}if(_==="web_app_set_header_color"&&b==="color")return bc("6.9",I);if(_==="web_app_close"&&b==="return_back")return bc("7.6",I)}switch(_){case"web_app_open_tg_link":case"web_app_open_invoice":case"web_app_setup_back_button":case"web_app_set_background_color":case"web_app_set_header_color":case"web_app_trigger_haptic_feedback":return bc("6.1",b);case"web_app_open_popup":return bc("6.2",b);case"web_app_close_scan_qr_popup":case"web_app_open_scan_qr_popup":case"web_app_read_text_from_clipboard":return bc("6.4",b);case"web_app_switch_inline_query":return bc("6.7",b);case"web_app_invoke_custom_method":case"web_app_request_write_access":case"web_app_request_phone":return bc("6.9",b);case"web_app_setup_settings_button":return bc("6.10",b);case"web_app_biometry_get_info":case"web_app_biometry_open_settings":case"web_app_biometry_request_access":case"web_app_biometry_request_auth":case"web_app_biometry_update_token":return bc("7.2",b);case"web_app_setup_swipe_behavior":return bc("7.7",b);default:return["iframe_ready","iframe_will_reload","web_app_close","web_app_data_send","web_app_expand","web_app_open_link","web_app_ready","web_app_request_theme","web_app_request_viewport","web_app_setup_main_button","web_app_setup_closing_behavior"].includes(_)}}function zk(_){return"external"in _&&Hx(_.external)&&"notify"in _.external&&typeof _.external.notify=="function"}function kk(_){return"TelegramWebviewProxy"in _&&Hx(_.TelegramWebviewProxy)&&"postEvent"in _.TelegramWebviewProxy&&typeof _.TelegramWebviewProxy.postEvent=="function"}function Dk(){try{return window.self!==window.top}catch{return!0}}const Lk="https://web.telegram.org";let Ok=Lk;function Fk(){return Ok}function TS(_,b,I){let z={},B;if(!b&&!I?z={}:b&&I?(z=I,B=b):b&&("targetOrigin"in b?z=b:B=b),Dk())return window.parent.postMessage(JSON.stringify({eventType:_,eventData:B}),z.targetOrigin||Fk());if(zk(window)){window.external.notify(JSON.stringify({eventType:_,eventData:B}));return}if(kk(window)){window.TelegramWebviewProxy.postEvent(_,JSON.stringify(B));return}throw up(vk,"Unable to determine current environment and possible way to send event. You are probably trying to use Mini Apps method outside the Telegram application environment.")}function Nk(_){return(b,I)=>{if(!yx(b,_))throw up(_k,`Method "${b}" is unsupported in Mini Apps version ${_}`);if(Hx(I)&&b==="web_app_set_header_color"&&"color"in I&&!yx(b,"color",_))throw up(yk,`Parameter "color" of "${b}" method is unsupported in Mini Apps version ${_}`);return TS(b,I)}}function Bk(_){return up(xk,`Timeout reached: ${_}ms`)}function jk(_,b){return Promise.race([typeof _=="function"?_():_,new Promise((I,z)=>{setTimeout(()=>{z(Bk(b))},b)})])}async function Vk(_){let b;const I=new Promise(s=>b=s),{event:z,capture:B,timeout:$}=_,[,re]=Gx((Array.isArray(z)?z:[z]).map(s=>Pk(s,ce=>{(!B||(Array.isArray(z)?B({event:s,payload:ce}):B(ce)))&&b(ce)})));try{return(_.postEvent||TS)(_.method,_.params),await($?jk(I,$):I)}finally{re()}}function Uk(_){return/^#[\da-f]{6}$/i.test(_)}function $k(_){return/^#[\da-f]{3}$/i.test(_)}function Gk(_){const b=_.replace(/\s/g,"").toLowerCase();if(Uk(b))return b;if($k(b)){let z="#";for(let B=0;B<3;B+=1)z+=b[1+B].repeat(2);return z}const I=b.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||b.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(!I)throw new Error(`Value "${_}" does not satisfy any of known RGB formats.`);return I.slice(1).reduce((z,B)=>{const $=parseInt(B,10).toString(16);return z+($.length===1?"0":"")+$},"#")}let qk=class{constructor(b){Fl(this,"ee",new _x),Fl(this,"on",this.ee.on.bind(this.ee)),Fl(this,"off",this.ee.off.bind(this.ee)),this.state=b}clone(){return{...this.state}}set(b,I){Object.entries(typeof b=="string"?{[b]:I}:b).reduce((z,[B,$])=>this.state[B]===$||$===void 0?z:(this.state[B]=$,this.ee.emit(`change:${B}`,$),!0),!1)&&this.ee.emit("change",this.state)}get(b){return this.state[b]}},Hk=class{constructor(b){Fl(this,"state"),Fl(this,"get"),Fl(this,"set"),Fl(this,"clone"),this.state=new qk(b),this.set=this.state.set.bind(this.state),this.get=this.state.get.bind(this.state),this.clone=this.state.clone.bind(this.state)}};function Wk(_,b){return I=>yx(b[I],_)}let Zk=class extends Hk{constructor(b,I,z){super(b),Fl(this,"supports"),this.supports=Wk(I,z)}};const Xk=hm(_=>_ instanceof Date?_:new Date(om().parse(_)*1e3),"Date");function SS(_,b){return new qx(I=>{if(typeof I!="string"&&!(I instanceof URLSearchParams))throw Cg();const z=typeof I=="string"?new URLSearchParams(I):I;return wS(_,B=>{const $=z.get(B);return $===null?void 0:$})},!1,b)}const Yk=op({id:om(),type:cs(),title:cs(),photoUrl:{type:cs().optional(),from:"photo_url"},username:cs().optional()},"Chat").optional(),q2=op({addedToAttachmentMenu:{type:uf().optional(),from:"added_to_attachment_menu"},allowsWriteToPm:{type:uf().optional(),from:"allows_write_to_pm"},firstName:{type:cs(),from:"first_name"},id:om(),isBot:{type:uf().optional(),from:"is_bot"},isPremium:{type:uf().optional(),from:"is_premium"},languageCode:{type:cs().optional(),from:"language_code"},lastName:{type:cs().optional(),from:"last_name"},photoUrl:{type:cs().optional(),from:"photo_url"},username:cs().optional()},"User").optional();function Kk(){return SS({authDate:{type:Xk(),from:"auth_date"},canSendAfter:{type:om().optional(),from:"can_send_after"},chat:Yk,chatInstance:{type:cs().optional(),from:"chat_instance"},chatType:{type:cs().optional(),from:"chat_type"},hash:cs(),queryId:{type:cs().optional(),from:"query_id"},receiver:q2,startParam:{type:cs().optional(),from:"start_param"},user:q2},"InitData")}const Jk=hm(_=>Gk(cs().parse(_)),"rgb");function Qk(_){return _.replace(/_[a-z]/g,b=>b[1].toUpperCase())}function eD(_){return _.replace(/[A-Z]/g,b=>`_${b.toLowerCase()}`)}const tD=hm(_=>{const b=Jk().optional();return Object.entries(bS(_)).reduce((I,[z,B])=>(I[Qk(z)]=b.parse(B),I),{})},"ThemeParams");function ES(_){return SS({botInline:{type:uf().optional(),from:"tgWebAppBotInline"},initData:{type:Kk().optional(),from:"tgWebAppData"},initDataRaw:{type:cs().optional(),from:"tgWebAppData"},platform:{type:cs(),from:"tgWebAppPlatform"},showSettings:{type:uf().optional(),from:"tgWebAppShowSettings"},startParam:{type:cs().optional(),from:"tgWebAppStartParam"},themeParams:{type:tD(),from:"tgWebAppThemeParams"},version:{type:cs(),from:"tgWebAppVersion"}}).parse(_)}function IS(_){return ES(_.replace(/^[^?#]*[?#]/,"").replace(/[?#]/g,"&"))}function rD(){return IS(window.location.href)}function AS(){return performance.getEntriesByType("navigation")[0]}function nD(){const _=AS();if(!_)throw new Error("Unable to get first navigation entry.");return IS(_.name)}function CS(_){return`telegram-apps/${_.replace(/[A-Z]/g,b=>`-${b.toLowerCase()}`)}`}function MS(_,b){sessionStorage.setItem(CS(_),JSON.stringify(b))}function PS(_){const b=sessionStorage.getItem(CS(_));try{return b?JSON.parse(b):void 0}catch{}}function iD(){return ES(PS("launchParams")||"")}function sD(_){return JSON.stringify(Object.fromEntries(Object.entries(_).map(([b,I])=>[eD(b),I])))}function oD(_){const{initDataRaw:b,themeParams:I,platform:z,version:B,showSettings:$,startParam:re,botInline:s}=_,ce=new URLSearchParams;return ce.set("tgWebAppPlatform",z),ce.set("tgWebAppThemeParams",sD(I)),ce.set("tgWebAppVersion",B),b&&ce.set("tgWebAppData",b),re&&ce.set("tgWebAppStartParam",re),typeof $=="boolean"&&ce.set("tgWebAppShowSettings",$?"1":"0"),typeof s=="boolean"&&ce.set("tgWebAppBotInline",s?"1":"0"),ce.toString()}function aD(_){MS("launchParams",oD(_))}function lD(){const _=[];for(const b of[rD,nD,iD])try{const I=b();return aD(I),I}catch(I){_.push(I instanceof Error?I.message:JSON.stringify(I))}throw new Error([`Unable to retrieve launch parameters from any known source. Perhaps, you have opened your app outside Telegram?
`,"📖 Refer to docs for more information:",`https://docs.telegram-mini-apps.com/packages/telegram-apps-sdk/environment
`,"Collected errors:",_.map(b=>`— ${b}`)].join(`
`))}function cD(){const _=AS();return!!(_&&_.type==="reload")}function uD(){let _=0;return()=>(_+=1).toString()}const[hD]=yS(uD);function dD(_,b){return()=>{const I=lD(),z={...I,postEvent:Nk(I.version),createRequestId:hD()};if(typeof _=="function")return _(z);const[B,$,re]=Gx(),s=b({...z,state:cD()?PS(_):void 0,addCleanup:B}),ce=be=>(re||B(be.on("change",Se=>{MS(_,Se)})),be);return[s instanceof Promise?s.then(ce):ce(s),$]}}let fD=class extends Zk{constructor(){super(...arguments),Fl(this,"on",this.state.on.bind(this.state)),Fl(this,"off",this.state.off.bind(this.state))}},pD=class extends fD{constructor(b,I,z){super({isOpened:b},I,{close:"web_app_close_scan_qr_popup",open:"web_app_open_scan_qr_popup"}),this.postEvent=z}close(){this.postEvent("web_app_close_scan_qr_popup"),this.isOpened=!1}set isOpened(b){this.set("isOpened",b)}get isOpened(){return this.get("isOpened")}async open(b){if(this.isOpened)throw new Error("The scanner is already opened");const{text:I,capture:z}=(typeof b=="string"?{text:b}:b)||{};this.isOpened=!0;try{const B=(await Vk({method:"web_app_open_scan_qr_popup",event:["qr_text_received","scan_qr_popup_closed"],postEvent:this.postEvent,params:{text:I},capture($){return $.event==="scan_qr_popup_closed"||!z||z($.payload)}})||{}).data||null;return B&&this.close(),B}finally{this.isOpened=!1}}};const mD=dD(({version:_,postEvent:b})=>new pD(!1,_,b));var Uv;function RS(_){return{lang:_?.lang??Uv?.lang,message:_?.message,abortEarly:_?.abortEarly??Uv?.abortEarly,abortPipeEarly:_?.abortPipeEarly??Uv?.abortPipeEarly}}var gD;function _D(_){return gD?.get(_)}var yD;function vD(_){return yD?.get(_)}var xD;function wD(_,b){return xD?.get(_)?.get(b)}function bD(_){const b=typeof _;return b==="string"?`"${_}"`:b==="number"||b==="bigint"||b==="boolean"?`${_}`:b==="object"||b==="function"?(_&&Object.getPrototypeOf(_)?.constructor?.name)??"null":b}function Nl(_,b,I,z,B){const $=B&&"input"in B?B.input:I.value,re=B?.expected??_.expects??null,s=B?.received??bD($),ce={kind:_.kind,type:_.type,input:$,expected:re,received:s,message:`Invalid ${b}: ${re?`Expected ${re} but r`:"R"}eceived ${s}`,requirement:_.requirement,path:B?.path,issues:B?.issues,lang:z.lang,abortEarly:z.abortEarly,abortPipeEarly:z.abortPipeEarly},be=_.kind==="schema",Se=B?.message??_.message??wD(_.reference,ce.lang)??(be?vD(ce.lang):null)??z.message??_D(ce.lang);Se!==void 0&&(ce.message=typeof Se=="function"?Se(ce):Se),be&&(I.typed=!1),I.issues?I.issues.push(ce):I.issues=[ce]}function ll(_){return{version:1,vendor:"valibot",validate(b){return _["~run"]({value:b},RS())}}}function zS(_,b){return Object.hasOwn(_,b)&&b!=="__proto__"&&b!=="prototype"&&b!=="constructor"}function TD(_,b){const I=[...new Set(_)];return I.length>1?`(${I.join(` ${b} `)})`:I[0]??"never"}var vx=class extends Error{constructor(_){super(_[0].message),this.name="ValiError",this.issues=_}};function kS(_){return{kind:"transformation",type:"transform",reference:kS,async:!1,operation:_,"~run"(b){return b.value=this.operation(b.value),b}}}function SD(_,b,I){return typeof _.fallback=="function"?_.fallback(b,I):_.fallback}function Wx(_,b,I){return typeof _.default=="function"?_.default(b,I):_.default}function DS(_,b){return!_["~run"]({value:b},{abortEarly:!0}).issues}function LS(_,b){return{kind:"schema",type:"array",reference:LS,expects:"Array",async:!1,item:_,message:b,get"~standard"(){return ll(this)},"~run"(I,z){const B=I.value;if(Array.isArray(B)){I.typed=!0,I.value=[];for(let $=0;$<B.length;$++){const re=B[$],s=this.item["~run"]({value:re},z);if(s.issues){const ce={type:"array",origin:"value",input:B,key:$,value:re};for(const be of s.issues)be.path?be.path.unshift(ce):be.path=[ce],I.issues?.push(be);if(I.issues||(I.issues=s.issues),z.abortEarly){I.typed=!1;break}}s.typed||(I.typed=!1),I.value.push(s.value)}}else Nl(this,"type",I,z);return I}}}function xx(_){return{kind:"schema",type:"boolean",reference:xx,expects:"boolean",async:!1,message:_,get"~standard"(){return ll(this)},"~run"(b,I){return typeof b.value=="boolean"?b.typed=!0:Nl(this,"type",b,I),b}}}function OS(_){return{kind:"schema",type:"date",reference:OS,expects:"Date",async:!1,message:_,get"~standard"(){return ll(this)},"~run"(b,I){return b.value instanceof Date?isNaN(b.value)?Nl(this,"type",b,I,{received:'"Invalid Date"'}):b.typed=!0:Nl(this,"type",b,I),b}}}function Zx(_){return{kind:"schema",type:"function",reference:Zx,expects:"Function",async:!1,message:_,get"~standard"(){return ll(this)},"~run"(b,I){return typeof b.value=="function"?b.typed=!0:Nl(this,"type",b,I),b}}}function FS(_,b){return{kind:"schema",type:"instance",reference:FS,expects:_.name,async:!1,class:_,message:b,get"~standard"(){return ll(this)},"~run"(I,z){return I.value instanceof this.class?I.typed=!0:Nl(this,"type",I,z),I}}}function Tc(_,b){return{kind:"schema",type:"loose_object",reference:Tc,expects:"Object",async:!1,entries:_,message:b,get"~standard"(){return ll(this)},"~run"(I,z){const B=I.value;if(B&&typeof B=="object"){I.typed=!0,I.value={};for(const $ in this.entries){const re=this.entries[$];if($ in B||(re.type==="exact_optional"||re.type==="optional"||re.type==="nullish")&&re.default!==void 0){const s=$ in B?B[$]:Wx(re),ce=re["~run"]({value:s},z);if(ce.issues){const be={type:"object",origin:"value",input:B,key:$,value:s};for(const Se of ce.issues)Se.path?Se.path.unshift(be):Se.path=[be],I.issues?.push(Se);if(I.issues||(I.issues=ce.issues),z.abortEarly){I.typed=!1;break}}ce.typed||(I.typed=!1),I.value[$]=ce.value}else if(re.fallback!==void 0)I.value[$]=SD(re);else if(re.type!=="exact_optional"&&re.type!=="optional"&&re.type!=="nullish"&&(Nl(this,"key",I,z,{input:void 0,expected:`"${$}"`,path:[{type:"object",origin:"key",input:B,key:$,value:B[$]}]}),z.abortEarly))break}if(!I.issues||!z.abortEarly)for(const $ in B)zS(B,$)&&!($ in this.entries)&&(I.value[$]=B[$])}else Nl(this,"type",I,z);return I}}}function ug(_,b){return{kind:"schema",type:"nullish",reference:ug,expects:`(${_.expects} | null | undefined)`,async:!1,wrapped:_,default:b,get"~standard"(){return ll(this)},"~run"(I,z){return(I.value===null||I.value===void 0)&&(this.default!==void 0&&(I.value=Wx(this,I,z)),I.value===null||I.value===void 0)?(I.typed=!0,I):this.wrapped["~run"](I,z)}}}function $_(_){return{kind:"schema",type:"number",reference:$_,expects:"number",async:!1,message:_,get"~standard"(){return ll(this)},"~run"(b,I){return typeof b.value=="number"&&!isNaN(b.value)?b.typed=!0:Nl(this,"type",b,I),b}}}function G_(_,b){return{kind:"schema",type:"optional",reference:G_,expects:`(${_.expects} | undefined)`,async:!1,wrapped:_,default:b,get"~standard"(){return ll(this)},"~run"(I,z){return I.value===void 0&&(this.default!==void 0&&(I.value=Wx(this,I,z)),I.value===void 0)?(I.typed=!0,I):this.wrapped["~run"](I,z)}}}function NS(_,b,I){return{kind:"schema",type:"record",reference:NS,expects:"Object",async:!1,key:_,value:b,message:I,get"~standard"(){return ll(this)},"~run"(z,B){const $=z.value;if($&&typeof $=="object"){z.typed=!0,z.value={};for(const re in $)if(zS($,re)){const s=$[re],ce=this.key["~run"]({value:re},B);if(ce.issues){const Se={type:"object",origin:"key",input:$,key:re,value:s};for(const Me of ce.issues)Me.path=[Se],z.issues?.push(Me);if(z.issues||(z.issues=ce.issues),B.abortEarly){z.typed=!1;break}}const be=this.value["~run"]({value:s},B);if(be.issues){const Se={type:"object",origin:"value",input:$,key:re,value:s};for(const Me of be.issues)Me.path?Me.path.unshift(Se):Me.path=[Se],z.issues?.push(Me);if(z.issues||(z.issues=be.issues),B.abortEarly){z.typed=!1;break}}(!ce.typed||!be.typed)&&(z.typed=!1),ce.typed&&(z.value[ce.value]=be.value)}}else Nl(this,"type",z,B);return z}}}function Go(_){return{kind:"schema",type:"string",reference:Go,expects:"string",async:!1,message:_,get"~standard"(){return ll(this)},"~run"(b,I){return typeof b.value=="string"?b.typed=!0:Nl(this,"type",b,I),b}}}function H2(_){let b;if(_)for(const I of _)b?b.push(...I.issues):b=I.issues;return b}function BS(_,b){return{kind:"schema",type:"union",reference:BS,expects:TD(_.map(I=>I.expects),"|"),async:!1,options:_,message:b,get"~standard"(){return ll(this)},"~run"(I,z){let B,$,re;for(const s of this.options){const ce=s["~run"]({value:I.value},z);if(ce.typed)if(ce.issues)$?$.push(ce):$=[ce];else{B=ce;break}else re?re.push(ce):re=[ce]}if(B)return B;if($){if($.length===1)return $[0];Nl(this,"type",I,z,{issues:H2($)}),I.typed=!0}else{if(re?.length===1)return re[0];Nl(this,"type",I,z,{issues:H2(re)})}return I}}}function jS(){return{kind:"schema",type:"unknown",reference:jS,expects:"unknown",async:!1,get"~standard"(){return ll(this)},"~run"(_){return _.typed=!0,_}}}function am(_,b,I){const z=_["~run"]({value:b},RS(I));if(z.issues)throw new vx(z.issues);return z.value}function O_(..._){return{..._[0],pipe:_,get"~standard"(){return ll(this)},"~run"(b,I){for(const z of _)if(z.kind!=="metadata"){if(b.issues&&(z.kind==="schema"||z.kind==="transformation")){b.typed=!1;break}(!b.issues||!I.abortEarly&&!I.abortPipeEarly)&&(b=z["~run"](b,I))}return b}}}var ED=Object.defineProperty,ID=(_,b,I)=>b in _?ED(_,b,{enumerable:!0,configurable:!0,writable:!0,value:I}):_[b]=I,wx=(_,b,I)=>ID(_,typeof b!="symbol"?b+"":b,I),AD=Object.defineProperty,CD=(_,b,I)=>b in _?AD(_,b,{enumerable:!0,configurable:!0,writable:!0,value:I}):_[b]=I,MD=(_,b,I)=>CD(_,b+"",I);function PD(_,b){return I=>I instanceof _&&I.type===b}function VS(_,b){b||(b=[]);const I=Symbol(_);class z extends Error{constructor(...$){const re=typeof b=="function"?b(...$):typeof b=="string"?[b]:b||[];super(...re),MD(this,"type",I),this.name=_}}return Object.defineProperty(z,"name",{value:_}),[z,PD(z,I)]}const[RD,zD]=VS("CancelledError","Promise was canceled"),[kD,yB]=VS("TimeoutError",(_,b)=>[`Timeout reached: ${_}ms`,{cause:b}]),US=Symbol("Resolved");function W2(_){return Array.isArray(_)&&_[0]===US}function DD(_){return[US,_]}function Z2(_,b){return _.reject=b.reject,_.abort=b.abort,_}let qo=class bx extends Promise{constructor(b,I){let z,B;super(($,re)=>{let s,ce;typeof b=="function"?(s=b,ce=I):ce=b;const be=[],Se=hr=>(...Kt)=>{const Wt=hr(...Kt);return be.forEach(Cr=>Cr()),Wt},Me=new AbortController,{signal:tt}=Me;B=hr=>{!tt.aborted&&Me.abort(hr)};const wt=()=>tt.reason,Xt=hr=>{const Kt=()=>{hr(wt())};tt.addEventListener("abort",Kt,!0);const Wt=()=>{tt.removeEventListener("abort",Kt,!0)};return be.push(Wt),Wt},Be=Se(hr=>{$(hr),B(DD(hr))});z=Se(hr=>{re(hr),B(hr)}),ce||(ce={});const{abortSignal:ct,rejectOnAbort:Tt=!0}=ce;if(ct)if(ct.aborted){const{reason:hr}=ct;if(Tt)return z(hr);B(hr)}else{const hr=()=>{B(ct.reason)};ct.addEventListener("abort",hr),be.push(()=>{ct.removeEventListener("abort",hr)})}Tt&&Xt(re);const{timeout:Dt}=ce;if(Dt){const hr=setTimeout(()=>{B(new kD(Dt))},Dt);be.push(()=>{clearTimeout(hr)})}const Vt=()=>tt.aborted,jt=()=>W2(wt()),vr=()=>{const hr=wt();return W2(hr)?hr[1]:void 0};try{const hr=s&&s(Be,z,{abortReason:wt,abortSignal:tt,isAborted:Vt,isResolved:jt,onAborted:Xt,onResolved:Kt=>Xt(()=>{jt()&&Kt(vr())}),resolved:vr,throwIfAborted(){if(Vt())throw wt()}});hr instanceof Promise&&hr.catch(z)}catch(hr){z(hr)}}),wx(this,"abort"),wx(this,"reject"),this.abort=B,this.reject=z}static fn(b,I){return new bx(async(z,B,$)=>{try{z(await b($))}catch(re){B(re)}},I)}static resolve(b){return this.fn(()=>b)}static reject(b){return new bx((I,z)=>{z(b)})}cancel(){this.abort(new RD)}catch(b){return this.then(void 0,b)}finally(b){return Z2(super.finally(b),this)}then(b,I){return Z2(super.then(b,I),this)}};function X2(_,b){return _.resolve=b.resolve,_}let LD=class Tx extends qo{constructor(b,I){let z,B;typeof b=="function"?(z=b,B=I):B=b;let $;super((re,s,ce)=>{$=re,z&&z(re,s,ce)},B),wx(this,"resolve"),this.resolve=$}static fn(b,I){return new Tx((z,B,$)=>{try{Promise.resolve(b($)).then(z,B)}catch(re){B(re)}},I)}static resolve(b){return this.fn(()=>b)}static reject(b){return new Tx((I,z)=>{z(b)})}catch(b){return this.then(void 0,b)}finally(b){return X2(super.finally(b),this)}then(b,I){return X2(super.then(b,I),this)}};function $S(_){return _.replace(/[A-Z]/g,b=>`-${b.toLowerCase()}`)}function OD(_){return _.replace(/_([a-z])/g,(b,I)=>`-${I.toLowerCase()}`)}function GS(_){return`tapps/${_}`}function Sc(_,b){sessionStorage.setItem(GS(_),JSON.stringify(b))}function cl(_){const b=sessionStorage.getItem(GS(_));try{return b?JSON.parse(b):void 0}catch{}}function Xx(..._){const b=_.flat(1);return[b.push.bind(b),()=>{b.forEach(I=>{I()})}]}function FD(_,b){b||(b={});const{textColor:I,bgColor:z,shouldLog:B}=b,$=B===void 0?!0:B,re=typeof $=="boolean"?()=>$:$,s=(ce,be,...Se)=>{if(be||re()){const Me="font-weight:bold;padding:0 5px;border-radius:100px",[tt,wt,Xt]={log:["#0089c3","white","INFO"],error:["#ff0000F0","white","ERR"],warn:["#D38E15","white","WARN"]}[ce];console[ce](`%c${Xt} ${Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,timeZone:"UTC"}).format(new Date)}%c %c${_}`,`${Me};background-color:${tt};color:${wt}`,"",`${Me};${I?`color:${I};`:""}${z?`background-color:${z}`:""}`,...Se)}};return[["log","forceLog"],["warn","forceWarn"],["error","forceError"]].reduce((ce,[be,Se])=>(ce[be]=s.bind(void 0,be,!1),ce[Se]=s.bind(void 0,be,!0),ce),{})}function qS(_){return{lang:_?.lang??void 0,message:_?.message,abortEarly:_?.abortEarly??void 0,abortPipeEarly:_?.abortPipeEarly??void 0}}function ND(_,b){var I;return(I=void 0)==null?void 0:I.get(b)}function BD(_){var b,I;const z=typeof _;return z==="string"?`"${_}"`:z==="number"||z==="bigint"||z==="boolean"?`${_}`:z==="object"||z==="function"?(_&&((I=(b=Object.getPrototypeOf(_))==null?void 0:b.constructor)==null?void 0:I.name))??"null":z}function Bl(_,b,I,z,B){const $=B&&"input"in B?B.input:I.value,re=B?.expected??_.expects??null,s=B?.received??BD($),ce={kind:_.kind,type:_.type,input:$,expected:re,received:s,message:`Invalid ${b}: ${re?`Expected ${re} but r`:"R"}eceived ${s}`,requirement:_.requirement,path:B?.path,issues:B?.issues,lang:z.lang,abortEarly:z.abortEarly,abortPipeEarly:z.abortPipeEarly},be=_.kind==="schema",Se=B?.message??_.message??ND(_.reference,ce.lang)??(be?(ce.lang,void 0):null)??z.message??(ce.lang,void 0);Se&&(ce.message=typeof Se=="function"?Se(ce):Se),be&&(I.typed=!1),I.issues?I.issues.push(ce):I.issues=[ce]}function Ec(_){return{version:1,vendor:"valibot",validate(b){return _["~run"]({value:b},qS())}}}function HS(_,b){return Object.hasOwn(_,b)&&b!=="__proto__"&&b!=="prototype"&&b!=="constructor"}function jD(_,b){const I=[...new Set(_)];return I.length>1?`(${I.join(` ${b} `)})`:I[0]??"never"}var VD=class extends Error{constructor(_){super(_[0].message),this.name="ValiError",this.issues=_}};function WS(_,b){return{kind:"validation",type:"check",reference:WS,async:!1,expects:null,requirement:_,message:b,"~run"(I,z){return I.typed&&!this.requirement(I.value)&&Bl(this,"input",I,z),I}}}function ZS(_){return{kind:"validation",type:"integer",reference:ZS,async:!1,expects:null,requirement:Number.isInteger,message:_,"~run"(b,I){return b.typed&&!this.requirement(b.value)&&Bl(this,"integer",b,I),b}}}function ff(_){return{kind:"transformation",type:"transform",reference:ff,async:!1,operation:_,"~run"(b){return b.value=this.operation(b.value),b}}}function XS(_,b,I){return typeof _.default=="function"?_.default(b,I):_.default}function UD(_,b){return!_["~run"]({value:b},{abortEarly:!0}).issues}function hg(_){return{kind:"schema",type:"boolean",reference:hg,expects:"boolean",async:!1,message:_,get"~standard"(){return Ec(this)},"~run"(b,I){return typeof b.value=="boolean"?b.typed=!0:Bl(this,"type",b,I),b}}}function YS(_){return{kind:"schema",type:"date",reference:YS,expects:"Date",async:!1,message:_,get"~standard"(){return Ec(this)},"~run"(b,I){return b.value instanceof Date?isNaN(b.value)?Bl(this,"type",b,I,{received:'"Invalid Date"'}):b.typed=!0:Bl(this,"type",b,I),b}}}function KS(_,b){return{kind:"schema",type:"instance",reference:KS,expects:_.name,async:!1,class:_,message:b,get"~standard"(){return Ec(this)},"~run"(I,z){return I.value instanceof this.class?I.typed=!0:Bl(this,"type",I,z),I}}}function Yx(_){return{kind:"schema",type:"lazy",reference:Yx,expects:"unknown",async:!1,getter:_,get"~standard"(){return Ec(this)},"~run"(b,I){return this.getter(b.value)["~run"](b,I)}}}function dm(_,b){return{kind:"schema",type:"loose_object",reference:dm,expects:"Object",async:!1,entries:_,message:b,get"~standard"(){return Ec(this)},"~run"(I,z){var B;const $=I.value;if($&&typeof $=="object"){I.typed=!0,I.value={};for(const re in this.entries){const s=this.entries[re];if(re in $||(s.type==="exact_optional"||s.type==="optional"||s.type==="nullish")&&s.default!==void 0){const ce=re in $?$[re]:XS(s),be=s["~run"]({value:ce},z);if(be.issues){const Se={type:"object",origin:"value",input:$,key:re,value:ce};for(const Me of be.issues)Me.path?Me.path.unshift(Se):Me.path=[Se],(B=I.issues)==null||B.push(Me);if(I.issues||(I.issues=be.issues),z.abortEarly){I.typed=!1;break}}be.typed||(I.typed=!1),I.value[re]=be.value}else if(s.type!=="exact_optional"&&s.type!=="optional"&&s.type!=="nullish"&&(Bl(this,"key",I,z,{input:void 0,expected:`"${re}"`,path:[{type:"object",origin:"key",input:$,key:re,value:$[re]}]}),z.abortEarly))break}if(!I.issues||!z.abortEarly)for(const re in $)HS($,re)&&!(re in this.entries)&&(I.value[re]=$[re])}else Bl(this,"type",I,z);return I}}}function J_(_){return{kind:"schema",type:"number",reference:J_,expects:"number",async:!1,message:_,get"~standard"(){return Ec(this)},"~run"(b,I){return typeof b.value=="number"&&!isNaN(b.value)?b.typed=!0:Bl(this,"type",b,I),b}}}function zs(_,b){return{kind:"schema",type:"optional",reference:zs,expects:`(${_.expects} | undefined)`,async:!1,wrapped:_,default:b,get"~standard"(){return Ec(this)},"~run"(I,z){return I.value===void 0&&(this.default!==void 0&&(I.value=XS(this,I,z)),I.value===void 0)?(I.typed=!0,I):this.wrapped["~run"](I,z)}}}function JS(_,b,I){return{kind:"schema",type:"record",reference:JS,expects:"Object",async:!1,key:_,value:b,message:I,get"~standard"(){return Ec(this)},"~run"(z,B){var $,re;const s=z.value;if(s&&typeof s=="object"){z.typed=!0,z.value={};for(const ce in s)if(HS(s,ce)){const be=s[ce],Se=this.key["~run"]({value:ce},B);if(Se.issues){const tt={type:"object",origin:"key",input:s,key:ce,value:be};for(const wt of Se.issues)wt.path=[tt],($=z.issues)==null||$.push(wt);if(z.issues||(z.issues=Se.issues),B.abortEarly){z.typed=!1;break}}const Me=this.value["~run"]({value:be},B);if(Me.issues){const tt={type:"object",origin:"value",input:s,key:ce,value:be};for(const wt of Me.issues)wt.path?wt.path.unshift(tt):wt.path=[tt],(re=z.issues)==null||re.push(wt);if(z.issues||(z.issues=Me.issues),B.abortEarly){z.typed=!1;break}}(!Se.typed||!Me.typed)&&(z.typed=!1),Se.typed&&(z.value[Se.value]=Me.value)}}else Bl(this,"type",z,B);return z}}}function Yi(_){return{kind:"schema",type:"string",reference:Yi,expects:"string",async:!1,message:_,get"~standard"(){return Ec(this)},"~run"(b,I){return typeof b.value=="string"?b.typed=!0:Bl(this,"type",b,I),b}}}function Y2(_){let b;if(_)for(const I of _)b?b.push(...I.issues):b=I.issues;return b}function Kx(_,b){return{kind:"schema",type:"union",reference:Kx,expects:jD(_.map(I=>I.expects),"|"),async:!1,options:_,message:b,get"~standard"(){return Ec(this)},"~run"(I,z){let B,$,re;for(const s of this.options){const ce=s["~run"]({value:I.value},z);if(ce.typed)if(ce.issues)$?$.push(ce):$=[ce];else{B=ce;break}else re?re.push(ce):re=[ce]}if(B)return B;if($){if($.length===1)return $[0];Bl(this,"type",I,z,{issues:Y2($)}),I.typed=!0}else{if(re?.length===1)return re[0];Bl(this,"type",I,z,{issues:Y2(re)})}return I}}}function QS(){return{kind:"schema",type:"unknown",reference:QS,expects:"unknown",async:!1,get"~standard"(){return Ec(this)},"~run"(_){return _.typed=!0,_}}}function eE(_,b,I){const z=_["~run"]({value:b},qS(I));if(z.issues)throw new VD(z.issues);return z.value}function pf(..._){return{..._[0],pipe:_,get"~standard"(){return Ec(this)},"~run"(b,I){for(const z of _)if(z.kind!=="metadata"){if(b.issues&&(z.kind==="schema"||z.kind==="transformation")){b.typed=!1;break}(!b.issues||!I.abortEarly&&!I.abortPipeEarly)&&(b=z["~run"](b,I))}return b}}}function $D(_){return _.replace(/_[a-z]/g,b=>b[1].toUpperCase())}function GD(_){return Object.entries(_).reduce((b,[I,z])=>(b[$D(I)]=z,b),{})}function Sx(_){const b=GD(_);for(const I in b){const z=b[I];z&&typeof z=="object"&&!(z instanceof Date)&&(b[I]=Array.isArray(z)?z.map(Sx):Sx(z))}return b}function Jx(_){return ff(b=>_?Sx(b):b)}function tE(_){return b=>pf(_,Jx(b))}function qD(_){return(b,I)=>eE(pf(_,Jx(I)),b)}function Qx(){return ff(JSON.parse)}function e0(_){const b=tE(_);return I=>pf(Yi(),Qx(),b(I))}function rE(_){return ff(b=>{const I={};return new URLSearchParams(b).forEach((z,B)=>{const $=I[B];Array.isArray($)?$.push(z):$===void 0?I[B]=z:I[B]=[$,z]}),eE(_,I)})}function nE(_){return b=>pf(Kx([Yi(),KS(URLSearchParams)]),rE(_),Jx(b))}const K2=zs(Yx(()=>YD())),HD=dm({id:J_(),photo_url:zs(Yi()),type:Yi(),title:Yi(),username:zs(Yi())}),WD=dm({added_to_attachment_menu:zs(hg()),allows_write_to_pm:zs(hg()),first_name:Yi(),id:J_(),is_bot:zs(hg()),is_premium:zs(hg()),last_name:zs(Yi()),language_code:zs(Yi()),photo_url:zs(Yi()),username:zs(Yi())}),ZD=dm({auth_date:pf(Yi(),ff(_=>new Date(Number(_)*1e3)),YS()),can_send_after:zs(pf(Yi(),ff(Number),ZS())),chat:zs(Yx(()=>XD())),chat_type:zs(Yi()),chat_instance:zs(Yi()),hash:Yi(),query_id:zs(Yi()),receiver:K2,start_param:zs(Yi()),signature:Yi(),user:K2}),XD=e0(HD),YD=e0(WD),KD=nE(ZD);function Mg(_){return/^#[\da-f]{6}$/i.test(_)}const iE=tE(JS(Yi(),pf(Kx([Yi(),J_()]),ff(_=>typeof _=="number"?`#${(_&16777215).toString(16).padStart(6,"0")}`:_),WS(Mg)))),$v=zs(pf(Yi(),ff(_=>_==="1"))),J2=e0(iE()),JD=dm({tgWebAppBotInline:$v,tgWebAppData:zs(KD()),tgWebAppDefaultColors:zs(J2()),tgWebAppFullscreen:$v,tgWebAppPlatform:Yi(),tgWebAppShowSettings:$v,tgWebAppStartParam:zs(Yi()),tgWebAppThemeParams:J2(),tgWebAppVersion:Yi()}),sE=nE(JD),oE=qD(sE()),QD=dm({eventType:Yi(),eventData:zs(QS())});function eL(_){try{return UD(sE(),_)}catch{return!1}}function tL(_){return{all:_=_||new Map,on:function(b,I){var z=_.get(b);z?z.push(I):_.set(b,[I])},off:function(b,I){var z=_.get(b);z&&(I?z.splice(z.indexOf(I)>>>0,1):_.set(b,[]))},emit:function(b,I){var z=_.get(b);z&&z.slice().map(function(B){B(I)}),(z=_.get("*"))&&z.slice().map(function(B){B(b,I)})}}}let im;function rL(_,b){im&&im.set(_,b)||b()}function yg(_){if(im)return _();im=new Map;try{_()}finally{im.forEach(b=>b()),im=void 0}}function Pg(_,b){b||(b={});const I=b.equals||Object.is;let z=[],B=_;const $=be=>{if(!I(B,be)){const Se=B;B=be,rL(ce,()=>{[...z].forEach(([Me,tt])=>{Me(be,Se),tt&&s(Me,!0)})})}};function re(be){const Se=typeof be!="object"?{once:be}:be;return{once:Se.once||!1,signal:Se.signal||!1}}const s=(be,Se)=>{const Me=re(Se),tt=z.findIndex(([wt,Xt])=>wt===be&&Xt.once===Me.once&&Xt.signal===Me.signal);tt>=0&&z.splice(tt,1)},ce=Object.assign(function(){return nL(ce),B},{destroy(){z=[]},set:$,reset(){$(_)},sub(be,Se){return z.push([be,re(Se)]),()=>s(be,Se)},unsub:s,unsubAll(){z=z.filter(be=>be[1].signal)}});return ce}const dg=[];function nL(_){dg.length&&dg[dg.length-1].add(_)}function iL(_,b){let I=new Set,z;function B(){return z||(z=Pg(re(),b))}function $(){B().set(re())}function re(){I.forEach(be=>{be.unsub($,{signal:!0})});const s=new Set;let ce;dg.push(s);try{ce=_()}finally{dg.pop()}return s.forEach(be=>{be.sub($,{signal:!0})}),I=s,ce}return Object.assign(function(){return B()()},{destroy(){B().destroy()},sub(...s){return B().sub(...s)},unsub(...s){B().unsub(...s)},unsubAll(...s){B().unsubAll(...s)}})}var sL=Object.defineProperty,oL=(_,b,I)=>b in _?sL(_,b,{enumerable:!0,configurable:!0,writable:!0,value:I}):_[b]=I,Ex=(_,b,I)=>oL(_,typeof b!="symbol"?b+"":b,I);function aE(_,b){return I=>I instanceof _&&I.type===b}function sa(_,b){b||(b=[]);const I=Symbol(_);class z extends Error{constructor(...$){const re=typeof b=="function"?b(...$):typeof b=="string"?[b]:b||[];super(...re),Ex(this,"type",I),this.name=_}}return Object.defineProperty(z,"name",{value:_}),[z,aE(z,I)]}function aL(_,b,I){const z=Symbol(_);class B extends sa(_,I)[0]{constructor(...re){super(...re),Ex(this,"data"),Ex(this,"type",z),this.data=b(...re)}}return Object.defineProperty(B,"name",{value:_}),[B,aE(B,z)]}function lE(_){return DS(Tc({TelegramWebviewProxy:Tc({postEvent:Zx()})}),_)}function lL(){try{return window.self!==window.top}catch{return!0}}function cL(_,b){const I=new Map,z=tL(),B=($,re,s)=>{s||(s=!1);const ce=I.get($)||new Map;I.set($,ce);const be=ce.get(re)||[];ce.set(re,be);const Se=be.findIndex(Me=>Me[1]===s);if(Se>=0&&(z.off($,be[Se][0]),be.splice(Se,1),!be.length&&(ce.delete(re),!ce.size))){const Me=I.size;I.delete($),Me&&!I.size&&b()}};return[function($,re,s){!I.size&&_();const ce=()=>{B($,re,s)},be=(...tt)=>{s&&ce(),$==="*"?re(tt):re(...tt)};z.on($,be);const Se=I.get($)||new Map;I.set($,Se);const Me=Se.get(re)||[];return Se.set(re,Me),Me.push([be,s||!1]),ce},B,z.emit,function(){const $=I.size;z.all.clear(),I.clear(),$&&b()}]}function Gv(_,b){window.dispatchEvent(new MessageEvent("message",{data:JSON.stringify({eventType:_,eventData:b}),source:window.parent}))}let uL=!1;const q_=Pg(FD("Bridge",{bgColor:"#9147ff",textColor:"white",shouldLog(){return uL}}));function cE(_,b,I,z){Object.defineProperty(_,b,{enumerable:!0,configurable:!0,get:I,set:z})}function Q2(_,b){const I=_[b];cE(_,b,()=>I,z=>{Object.entries(z).forEach(([B,$])=>{I[B]=$})})}function eT(_,b,I){Object.defineProperty(_,b,{enumerable:!0,configurable:!0,writable:!0,value:I})}function qv(_,b,I){const z=_[b],B=[I];typeof z=="function"&&B.push(z);const $=(...s)=>{B.forEach(ce=>{ce(...s)})},re=Object.assign((...s)=>{$(...s)},{unwrap(){const{length:s}=B;if(s===1){delete _[b];return}if(s===2){eT(_,b,B[1]);return}B.unshift(1),eT(_,b,$)}});cE(_,b,()=>re,s=>{B.push(s)})}const hL={clipboard_text_received:Tc({req_id:Go(),data:ug(Go())}),custom_method_invoked:Tc({req_id:Go(),result:G_(jS()),error:G_(Go())}),popup_closed:ug(Tc({button_id:ug(Go(),()=>{})}),{}),viewport_changed:Tc({height:$_(),width:ug($_(),()=>window.innerWidth),is_state_stable:xx(),is_expanded:xx()}),theme_changed:Tc({theme_params:iE()})};function tT(_){if(_.source!==window.parent)return;let b;try{b=am(O_(Go(),Qx(),QD),_.data)}catch{return}const{eventType:I,eventData:z}=b,B=hL[I];let $;try{$=B?am(B,z):z}catch(re){return q_().forceError([`An error occurred processing the "${I}" event from the Telegram application.`,"Please, file an issue here:","https://github.com/Telegram-Mini-Apps/telegram-apps/issues/new/choose"].join(`
`),b,re)}dL(I,$)}const[ia,hf,dL,vB]=cL(()=>{const _=window;!_.TelegramGameProxy&&(_.TelegramGameProxy={}),qv(_.TelegramGameProxy,"receiveEvent",Gv),Q2(_,"TelegramGameProxy"),!_.Telegram&&(_.Telegram={}),!_.Telegram.WebView&&(_.Telegram.WebView={}),qv(_.Telegram.WebView,"receiveEvent",Gv),Q2(_.Telegram,"WebView"),qv(_,"TelegramGameProxy_receiveEvent",Gv),window.addEventListener("message",tT)},()=>{[["TelegramGameProxy_receiveEvent"],["TelegramGameProxy","receiveEvent"],["Telegram","WebView","receiveEvent"]].forEach(_=>{const b=window;let I=[void 0,b];for(const $ of _)if(I=[I[1],I[1][$]],!I[1])return;const[z,B]=I;"unwrap"in B&&(B.unwrap(),z&&z!==b&&!Object.keys(z).length&&delete b[_[0]])}),window.removeEventListener("message",tT)});sa("MethodUnsupportedError",(_,b)=>[`Method "${_}" is unsupported in Mini Apps version ${b}`]);sa("MethodParameterUnsupportedError",(_,b,I)=>[`Parameter "${b}" of "${_}" method is unsupported in Mini Apps version ${I}`]);const[fL,xB]=aL("LaunchParamsRetrieveError",_=>({errors:_}),_=>[["Unable to retrieve launch parameters from any known source. Perhaps, you have opened your app outside Telegram?","📖 Refer to docs for more information:","https://docs.telegram-mini-apps.com/packages/telegram-apps-bridge/environment","","Collected errors:",..._.map(([b,I])=>`Source: ${b} / ${I instanceof Error?I.message:String(I)}`)].join(`
`)]);sa("InvalidLaunchParamsError",(_,b)=>[`Invalid value for launch params: ${_}`,{cause:b}]);const[pL,wB]=sa("UnknownEnvError"),[mL,bB]=sa("InvokeCustomMethodError",_=>[`Server returned error: ${_}`]),gL=Pg((..._)=>{try{window.parent.postMessage(..._)}catch(b){b instanceof SyntaxError?q_().forceError("Unable to call window.parent.postMessage due to incorrectly configured target origin. Use the setTargetOrigin method to allow this origin to receive events",b):q_().forceError(b)}}),_L=(..._)=>gL()(..._),yL=Pg("https://web.telegram.org");function t0(_,b){q_().log("Posting event:",b?{eventType:_,eventData:b}:{eventType:_});const I=window,z=JSON.stringify({eventType:_,eventData:b});if(lL())return _L(z,yL());if(lE(I)){I.TelegramWebviewProxy.postEvent(_,JSON.stringify(b));return}if(DS(Tc({external:Tc({notify:Zx()})}),I)){I.external.notify(z);return}throw new pL}function r0(_,b,I){I||(I={});const{capture:z}=I,[B,$]=Xx();return new qo(re=>{(Array.isArray(b)?b:[b]).forEach(s=>{B(ia(s,ce=>{(!z||(Array.isArray(b)?z({event:s,payload:ce}):z(ce)))&&re(ce)}))}),(I.postEvent||t0)(_,I.params)},I).finally($)}const rT="launchParams";function nT(_){return _.replace(/^[^?#]*[?#]/,"").replace(/[?#]/g,"&")}function vL(){const _=[];for(const[b,I]of[[()=>nT(window.location.href),"window.location.href"],[()=>{const z=performance.getEntriesByType("navigation")[0];return z&&nT(z.name)},"performance navigation entries"],[()=>cl(rT),"local storage"]]){const z=b();if(!z){_.push([I,new Error("Source is empty")]);continue}if(eL(z))return Sc(rT,z),z;try{oE(z)}catch(B){_.push([I,B])}}throw new fL(_)}function xL(_){return oE(vL())}function iT(_,b){try{return xL(),!0}catch{return!1}return qo.fn(async I=>{if(lE(window))return!0;try{return await r0("web_app_request_theme","theme_changed",I),!0}catch{return!1}},{timeout:100})}function wL(_){return({req_id:b})=>b===_}function sT(_){return _.split(".").map(Number)}function bL(_,b){const I=sT(_),z=sT(b),B=Math.max(I.length,z.length);for(let $=0;$<B;$+=1){const re=I[$]||0,s=z[$]||0;if(re!==s)return re>s?1:-1}return 0}function xa(_,b){return bL(_,b)<=0}function Ix(_,b,I){if(typeof I=="string"){if(_==="web_app_open_link"){if(b==="try_instant_view")return xa("6.4",I);if(b==="try_browser")return xa("7.6",I)}if(_==="web_app_set_header_color"&&b==="color")return xa("6.9",I);if(_==="web_app_close"&&b==="return_back")return xa("7.6",I);if(_==="web_app_setup_main_button"&&b==="has_shine_effect")return xa("7.10",I)}switch(_){case"web_app_open_tg_link":case"web_app_open_invoice":case"web_app_setup_back_button":case"web_app_set_background_color":case"web_app_set_header_color":case"web_app_trigger_haptic_feedback":return xa("6.1",b);case"web_app_open_popup":return xa("6.2",b);case"web_app_close_scan_qr_popup":case"web_app_open_scan_qr_popup":case"web_app_read_text_from_clipboard":return xa("6.4",b);case"web_app_switch_inline_query":return xa("6.7",b);case"web_app_invoke_custom_method":case"web_app_request_write_access":case"web_app_request_phone":return xa("6.9",b);case"web_app_setup_settings_button":return xa("6.10",b);case"web_app_biometry_get_info":case"web_app_biometry_open_settings":case"web_app_biometry_request_access":case"web_app_biometry_request_auth":case"web_app_biometry_update_token":return xa("7.2",b);case"web_app_setup_swipe_behavior":return xa("7.7",b);case"web_app_share_to_story":return xa("7.8",b);case"web_app_setup_secondary_button":case"web_app_set_bottom_bar_color":return xa("7.10",b);case"web_app_request_safe_area":case"web_app_request_content_safe_area":case"web_app_request_fullscreen":case"web_app_exit_fullscreen":case"web_app_set_emoji_status":case"web_app_add_to_home_screen":case"web_app_check_home_screen":case"web_app_request_emoji_status_access":case"web_app_check_location":case"web_app_open_location_settings":case"web_app_request_file_download":case"web_app_request_location":case"web_app_send_prepared_message":case"web_app_start_accelerometer":case"web_app_start_device_orientation":case"web_app_start_gyroscope":case"web_app_stop_accelerometer":case"web_app_stop_device_orientation":case"web_app_stop_gyroscope":case"web_app_toggle_orientation_lock":return xa("8.0",b);default:return["iframe_ready","iframe_will_reload","web_app_close","web_app_data_send","web_app_expand","web_app_open_link","web_app_ready","web_app_request_theme","web_app_request_viewport","web_app_setup_main_button","web_app_setup_closing_behavior"].includes(_)}}function TL(_,b,I,z){return r0("web_app_invoke_custom_method","custom_method_invoked",{...z||{},params:{method:_,params:b,req_id:I},capture:wL(I)}).then(({result:B,error:$})=>{if($)throw new mL($);return B})}function SL(){return performance.getEntriesByType("navigation")[0]}function jl(){const _=SL();return!!_&&_.type==="reload"}function fm(_,b){return Pg(_,b)}function co(_,b){return iL(_,b)}function rs(_,b){const I=fm(_,b);return[I,co(I)]}const Hv=fm(0),EL=fm(t0),[TB,Q_]=rs({tgWebAppPlatform:"unknown",tgWebAppVersion:"0.0"}),nm=co(()=>Q_().tgWebAppVersion);function IL(){return Hv.set(Hv()+1),Hv().toString()}function Rg(_,b,I){return TL(_,b,IL(),{...I||{},postEvent:ns})}const oa=(_,b,I)=>(I||(I={}),I.postEvent||(I.postEvent=ns),r0(_,b,I)),ns=(_,b)=>EL()(_,b);function gp(_){return[_]}const[n0,SB]=sa("CSSVarsBoundError","CSS variables are already bound"),[uE,EB]=sa("NotAvailableError",gp);sa("InvalidEnvError",gp);const[og,IB]=sa("FunctionNotAvailableError",gp),[sd,AB]=sa("InvalidArgumentsError",(_,b)=>[_,{cause:b}]),[AL,CB]=sa("ConcurrentCallError",gp),[CL,MB]=sa("SetEmojiStatusError",_=>[`Failed to set emoji status: ${_}`]),[ML,PB]=sa("AccessDeniedError",gp),[PL,RB]=sa("FullscreenFailedError",gp);sa("ShareMessageError",gp);const[i0,zB]=sa("UnknownThemeParamsKeyError",_=>[`Unknown theme params key passed: ${_}`]);function oT(){return typeof window>"u"}function s0(_,b,I){I||(I={});const{isSupported:z,isMounted:B,isMounting:$,component:re,supports:s}=I||{},ce=`${re?`${re}.`:""}${_}()`,be=z?Array.isArray(z)||typeof z=="object"&&"any"in z?z:[z]:void 0;function Se(Dt){if(s){const Vt=s[Dt];return Ix(Vt[0],Vt[1],nm())}return!0}function Me(){if(!be)return;function Dt(vr){return typeof vr=="function"?vr():Ix(vr,nm())?void 0:`it is unsupported in Mini Apps version ${nm()}`}const Vt=Array.isArray(be)?be:be.any,jt=Vt.map(Dt).filter(Boolean);return Array.isArray(be)?jt[0]:jt.length===Vt.length?jt[jt.length-1]:void 0}function tt(...Dt){for(const Vt in s)if(s[Vt][2](...Dt)&&!Se(Vt))return`option ${Vt} is not supported in Mini Apps version ${nm()}`}let wt;if(s){wt={};for(const Dt in s)wt[Dt]=co(()=>Se(Dt))}const Xt=co(()=>!Me()),Be=co(()=>nm()!=="0.0"),ct=co(()=>!B||B()),Tt=co(()=>iT()&&!oT()&&Be()&&Xt()&&ct());return Object.assign((...Dt)=>{const Vt=`Unable to call the ${ce} ${re?"method":"function"}:`;if(oT()||!iT())throw new og(`${Vt} it can't be called outside Mini Apps`);if(!Be())throw new og(`${Vt} the SDK was not initialized. Use the SDK init() function`);const jt=Me();if(jt)throw new og(`${Vt} ${jt}`);const vr=tt(...Dt);if(vr)throw new og(`${Vt} ${vr}`);if(!ct()){const hr=$&&$()?"mounting. Wait for the mount completion":`unmounted. Use the ${re}.mount() method`;throw new og(`${Vt} the component is ${hr}`)}return b(...Dt)},b,{isAvailable:Tt,ifAvailable(...Dt){return Tt()?[!0,b(...Dt)]:[!1]}},be?{isSupported:Xt}:{},wt?{supports:wt}:{})}function ey(_,b){return b||(b={}),(I,z,B,$)=>s0(I,z,{...b,isSupported:B||b.isSupported,supports:$,component:_})}function mf(_,b,I){return ey(_,{isSupported:I,isMounted:b})}function Vl(_,b){return ey(_,{isSupported:b})}const o0="web_app_setup_back_button",hE="back_button_pressed",ty="backButton",[aT,kB]=rs(!1),[Ax,DB]=rs(!1),dE=mf(ty,Ax,o0),a0=Vl(ty,o0);dE("hide",()=>{l0(!1)});a0("mount",()=>{Ax()||(l0(jl()&&cl(ty)||!1),Ax.set(!0))});function l0(_){_!==aT()&&(ns(o0,{is_visible:_}),Sc(ty,_),aT.set(_))}a0("onClick",_=>ia(hE,_));a0("offClick",_=>{hf(hE,_)});dE("show",()=>{l0(!0)});function ul(_,b,I){I||(I={});const{promise:z,error:B}=I,[$,re]=z?[z,co(z)]:rs(),[s,ce]=B?[B,co(B)]:rs();return[Object.assign((...be)=>{if($()){const Me=new AL(b);return s.set(Me),qo.reject(Me)}yg(()=>{$.set(_(...be)),s.set(void 0)});let Se;return $().catch(Me=>{throw Se=Me,Me}).finally(()=>{yg(()=>{$.set(void 0),s.set(Se)})})},_),[$,re,co(()=>!!$())],[s,ce]]}function zg(_,b,I){const[z,...B]=ul(b,`The ${_} component is already mounting`),[$,re]=rs(!1);return[(...s)=>$()?qo.resolve():z(...s).then(ce=>{yg(()=>{$.set(!0),I(ce)})}),...B,[$,re]]}const[fE,LB]=rs({available:!1,type:"",accessGranted:!1,accessRequested:!1,deviceId:"",tokenSaved:!1}),lT="web_app_biometry_get_info",RL=s0("requestBiometry",_=>oa(lT,"biometry_info_received",_),{isSupported:lT});function pE(_){if(!zD(_))throw _}function mE(_){const b=_();b&&b.catch(pE).cancel()}const vg="biometry",c0="web_app_biometry_request_auth",gE="biometry_info_received",zL=_=>{ry(u0(_))};function _E(){throw new uE("Biometry is not available")}function u0(_){let b=!1,I=!1,z="",B=!1,$="",re=!1;return _.available&&(b=!0,I=_.token_saved,z=_.device_id,B=_.access_requested,$=_.type,re=_.access_granted),{available:b,tokenSaved:I,deviceId:z,type:$,accessGranted:re,accessRequested:B}}const[kL,DL,LL,yE]=zg(vg,_=>{const b=jl()&&cl(vg);return b?qo.resolve(b):RL({abortSignal:_}).then(u0)},_=>{ia(gE,zL),ry(_)}),vE=Vl(vg,c0),h0=mf(vg,yE[0],c0);vE("mount",kL);const[,OB,FB]=DL,[,NB]=LL,[BB,jB]=yE,[OL,FL,NL]=ul(_=>qo.fn(async b=>{const I=fE();I.available||_E();const z=await oa(c0,"biometry_auth_requested",{..._,...b,params:{reason:((_||{}).reason||"").trim()}}),{token:B}=z;return typeof B=="string"&&ry({...I,token:B}),z},_),"Biometry authentication is already in progress");h0("authenticate",OL);const[,VB,UB]=FL,[,$B]=NL;vE("openSettings",()=>{ns("web_app_biometry_open_settings")});const[BL,jL,VL]=ul(_=>qo.fn(async b=>{const I=await oa("web_app_biometry_request_access",gE,{..._,...b,params:{reason:(_||{}).reason||""}}).then(u0);return I.available||_E(),ry(I),I.accessGranted},_),"Biometry access request is already in progress");h0("requestAccess",BL);const[,GB,qB]=jL,[,HB]=VL;function ry(_){fE.set(_),Sc(vg,_)}h0("updateToken",_=>(_||(_={}),oa("web_app_biometry_update_token","biometry_token_updated",{..._,params:{token:_.token||"",reason:_.reason}}).then(b=>b.status)));function ny(_,b){return ey(_,{isMounted:b})}const gf=ey,iy="closingBehavior",[cT,WB]=rs(!1),[uT,UL]=rs(!1),xE=ny(iy,UL),$L=gf(iy);xE("disableConfirmation",()=>{d0(!1)});xE("enableConfirmation",()=>{d0(!0)});$L("mount",()=>{uT()||(d0(jl()&&cl(iy)||!1),uT.set(!0))});function d0(_){_!==cT()&&(ns("web_app_setup_closing_behavior",{need_confirmation:_}),Sc(iy,_),cT.set(_))}const GL="web_app_invoke_custom_method",kg=Vl("cloudStorage",GL),qL=kg("deleteItem",(_,b)=>{const I=Array.isArray(_)?_:[_];return I.length?Rg("deleteStorageValues",{keys:I},b).then():qo.resolve()});function HL(_,b){const I=Array.isArray(_)?_:[_];return I.length?Rg("getStorageValues",{keys:I},b).then(z=>{const B={...I.reduce(($,re)=>($[re]="",$),{}),...am(NS(Go(),Go()),z)};return typeof _=="string"?B[_]:B}):qo.resolve(Array.isArray(_)?{}:"")}kg("getItem",HL);const WL=kg("getKeys",_=>Rg("getStorageKeys",{},_).then(b=>am(LS(Go()),b)));kg("setItem",(_,b,I)=>Rg("saveStorageValue",{key:_,value:b},I).then());kg("clear",_=>WL(_).then(qL));const sy="web_app_trigger_haptic_feedback",f0=Vl("hapticFeedback",sy);f0("impactOccurred",_=>{ns(sy,{type:"impact",impact_style:_})});f0("notificationOccurred",_=>{ns(sy,{type:"notification",notification_type:_})});f0("selectionChanged",()=>{ns(sy,{type:"selection_change"})});const wE="web_app_open_invoice",ZL=Vl("invoice",wE);function XL(_,b,I){let z;if(b==="url"){const{hostname:B,pathname:$}=new URL(_,window.location.href);if(B!=="t.me")throw new sd(`Link has unexpected hostname: ${B}`);const re=$.match(/^\/(\$|invoice\/)([A-Za-z0-9\-_=]+)$/);if(!re)throw new sd('Expected to receive a link with a pathname in format "/invoice/{slug}" or "/${slug}"');[,,z]=re}else z=_,I=b;return oa(wE,"invoice_closed",{...I,params:{slug:z},capture:B=>z===B.slug}).then(B=>B.status)}const[YL,KL,JL]=ul(XL,"Invoice is already opened");ZL("open",YL);const[,ZB,XB]=KL,[,YB]=JL,fg="locationManager",bE="web_app_check_location",hT="web_app_open_location_settings",Cx=fm({available:!1,accessGranted:!1,accessRequested:!1});function QL(_){let b=!1,I,z;return _.available&&(b=!0,I=_.access_requested,z=_.access_granted),{available:b,accessGranted:z||!1,accessRequested:I||!1}}const[e3,t3,r3,TE]=zg(fg,_=>{const b=jl()&&cl(fg);return b?qo.resolve(b):oa("web_app_check_location","location_checked",_).then(QL)},_=>{Cx.set(_),Sc(fg,_)}),SE=Vl(fg,bE),n3=mf(fg,TE[0],bE);SE("mount",e3);const[,KB,JB]=t3,[,QB]=r3,[e5,t5]=TE,[i3,s3,o3]=ul(_=>oa("web_app_request_location","location_requested",_).then(b=>{if(!b.available)throw Cx.set({...Cx(),available:!1}),new uE("Location data tracking is not available");const{available:I,...z}=b;return z}),"Location request is currently in progress");n3("requestLocation",i3);const[,r5,n5]=s3,[,i5]=o3;SE("openSettings",()=>{ns(hT)},hT);function p0(_){const b={};for(const I in _){const z=_[I];z!==void 0&&(b[I]=z)}return b}const[Wv,s5]=rs(!1),[cp,oy]=rs({});function m0(_){return co(()=>cp()[_])}const EE=m0("button_color"),a3=m0("button_text_color"),l3=m0("secondary_bg_color"),pg=fm({hasShineEffect:!1,isEnabled:!0,isLoaderVisible:!1,isVisible:!1,text:"Continue"}),c3=co(()=>{const _=pg();return{..._,backgroundColor:_.backgroundColor||EE()||"#2481cc",textColor:_.textColor||a3()||"#ffffff"}}),[dT,u3]=rs(!1),h3="web_app_setup_main_button",IE="main_button_pressed",ay="mainButton",g0=gf(ay),d3=ny(ay,u3);g0("mount",()=>{if(!dT()){const _=jl()&&cl(ay);_&&pg.set(_),dT.set(!0)}});g0("onClick",_=>ia(IE,_));g0("offClick",_=>{hf(IE,_)});d3("setParams",_=>{pg.set({...pg(),...p0(_)}),Sc(ay,pg());const b=c3();b.text&&ns(h3,{color:b.backgroundColor,has_shine_effect:b.hasShineEffect,is_active:b.isEnabled,is_progress_visible:b.isLoaderVisible,is_visible:b.isVisible,text:b.text,text_color:b.textColor})});function _0(_,b){document.documentElement.style.setProperty(_,b)}function y0(_){document.documentElement.style.removeProperty(_)}const lm="themeParams",AE="theme_changed",CE=gf(lm),ME=({theme_params:_})=>{cp.set(_),Sc(lm,_)},[f3,PE,p3,RE]=zg(lm,_=>qo.resolve(jl()&&cl(lm)||Q_().tgWebAppThemeParams||{}),_=>{ia(AE,ME),cp.set(_)}),m3=ny(lm,RE[0]);m3("bindCssVars",_=>{if(Wv())throw new n0;_||(_=z=>`--tg-theme-${OD(z)}`);function b(z){Object.entries(cp()).forEach(([B,$])=>{$&&z(B,$)})}function I(){b((z,B)=>{_0(_(z),B)})}return I(),cp.sub(I),Wv.set(!0),()=>{b(y0),cp.unsub(I),Wv.set(!1)}});const g3=CE("mount",f3);PE[2];PE[1];p3[1];const[fT,o5]=RE,_3=CE("mountSync",()=>{if(!fT()){const _=jl()&&cl(lm)||Q_().tgWebAppThemeParams||{};ia(AE,ME),yg(()=>{cp.set(_),fT.set(!0)})}});function zE(_){return co(()=>ly(_()))}function ly(_){return Mg(_)?_:oy()[_]}const[xg,a5]=rs("bg_color"),y3=zE(xg),[wg,l5]=rs("bottom_bar_bg_color"),kE=co(()=>{const _=wg();return Mg(_)?_:oy()[_]||l3()}),[bg,c5]=rs("bg_color"),v3=zE(bg),[Zv,u5]=rs(!1),[cy,h5]=rs(!0),x3=co(()=>({backgroundColor:xg(),bottomBarColor:wg(),headerColor:bg(),isActive:cy()})),H_="web_app_set_background_color",W_="web_app_set_bottom_bar_color",ap="web_app_set_header_color",DE="visibility_changed",hp="miniApp",LE={any:[H_,W_,ap]},OE=_=>{cy.set(_.is_visible),hy()},FE=_=>{[[bg,ap],[xg,H_],[wg,W_]].forEach(([b,I])=>{const z=b();if(!Mg(z)&&(I!==ap||z!=="bg_color"&&z!=="secondary_bg_color")){const B=_[z];B&&ns(I,{color:B})}})},[w3,NE,b3,BE]=zg(hp,_=>g3(_).then(()=>jl()&&cl(hp)||void 0),_=>{UE.ifAvailable(_?_.backgroundColor:"bg_color"),$E.ifAvailable(_?_.bottomBarColor:"bottom_bar_bg_color"),GE.ifAvailable(_?_.headerColor:"bg_color"),cy.set(_?_.isActive:!0),ia(DE,OE),oy.sub(FE)}),jE=gf(hp),VE=Vl(hp,LE),uy=mf(hp,BE[0],LE);uy("bindCssVars",_=>{if(Zv())throw new n0;const[b,I]=Xx();function z(B,$){function re(){_0(B,$()||null)}re(),b($.sub(re),y0.bind(null,B))}return _||(_=B=>`--tg-${$S(B)}`),z(_("bgColor"),y3),z(_("bottomBarColor"),kE),z(_("headerColor"),v3),b(()=>{Zv.set(!1)}),Zv.set(!0),I});jE("close",_=>{ns("web_app_close",{return_back:_})});VE("mount",w3);NE[2];NE[1];b3[1];const[pT,d5]=BE;VE("mountSync",()=>{if(!pT()){_3();const _=jl()&&cl(hp)||void 0;UE.ifAvailable(_?_.backgroundColor:"bg_color"),$E.ifAvailable(_?_.bottomBarColor:"bottom_bar_bg_color"),GE.ifAvailable(_?_.headerColor:"bg_color"),ia(DE,OE),oy.sub(FE),yg(()=>{cy.set(_?_.isActive:!0),pT.set(!0)})}});jE("ready",()=>{ns("web_app_ready")});function hy(){Sc(hp,x3())}const UE=uy("setBackgroundColor",_=>{if(_===xg())return;const b=ly(_);if(!b)throw new i0(_);ns(H_,{color:b}),xg.set(_),hy()},H_),$E=uy("setBottomBarColor",_=>{if(_===wg())return;const b=ly(_);if(!b)throw new i0(_);ns(W_,{color:b}),wg.set(_),hy()},W_),GE=uy("setHeaderColor",_=>{if(_!==bg()){if(_==="bg_color"||_==="secondary_bg_color")ns(ap,{color_key:_});else{const b=ly(_);if(!b)throw new i0(_);ns(ap,{color:b})}bg.set(_),hy()}},ap,{rgb:[ap,"color",Mg]});function T3(_){const b=_.message.trim(),I=(_.title||"").trim(),z=_.buttons||[];if(I.length>64)throw new sd(`Invalid title: ${I}`);if(!b||b.length>256)throw new sd(`Invalid message: ${b}`);if(z.length>3)throw new sd(`Invalid buttons count: ${z.length}`);return{title:I,message:b,buttons:z.length?z.map((B,$)=>{const re=B.id||"";if(re.length>64)throw new sd(`Button with index ${$} has invalid id: ${re}`);if(!B.type||B.type==="default"||B.type==="destructive"){const s=B.text.trim();if(!s||s.length>64)throw new sd(`Button with index ${$} has invalid text: ${s}`);return{type:B.type,text:s,id:re}}return{type:B.type,id:re}}):[{type:"close",id:""}]}}const qE="web_app_open_popup",HE=Vl("popup",qE),[WE,v0,ZE]=ul(_=>oa(qE,"popup_closed",{..._,params:T3(_)}).then(({button_id:b})=>b===void 0?null:b),"A popup is already opened");HE("open",WE);v0[1];v0[2];ZE[1];HE("show",WE);const[,f5,p5]=v0,[,m5]=ZE,XE="web_app_close_scan_qr_popup",YE="web_app_open_scan_qr_popup",S3="scan_qr_popup_closed",E3="qr_text_received",KE=Vl("qrScanner",YE);KE("close",()=>{ns(XE),mE(P3)});function I3(_){_||(_={});const{onCaptured:b,text:I,capture:z}=_,[,B]=Xx(ia(S3,()=>{$.resolve()}),ia(E3,re=>{b?b(re.data):(!z||z(re.data))&&($.resolve(re.data),ns(XE))})),$=new LD(_);return(_.postEvent||ns)(YE,{text:I}),qo.resolve($).catch(pE).finally(B)}const[A3,C3,M3]=ul(I3,"The QR Scanner is already opened");KE("open",A3);const[,P3,g5]=C3,[,_5]=M3,mg=fm({hasShineEffect:!1,isEnabled:!0,isLoaderVisible:!1,isVisible:!1,position:"left",text:"Cancel"}),R3=co(()=>{const _=mg();return{..._,backgroundColor:_.backgroundColor||kE()||"#000000",textColor:_.textColor||EE()||"#2481cc"}}),[mT,z3]=rs(!1),x0="web_app_setup_secondary_button",JE="secondary_button_pressed",dy="secondaryButton",w0=Vl(dy,x0),k3=mf(dy,z3,x0);w0("mount",()=>{if(!mT()){const _=jl()&&cl(dy);_&&mg.set(_),mT.set(!0)}});w0("onClick",_=>ia(JE,_));w0("offClick",_=>{hf(JE,_)});k3("setParams",_=>{mg.set({...mg(),...p0(_)}),Sc(dy,mg());const b=R3();b.text&&ns(x0,{color:b.backgroundColor,has_shine_effect:b.hasShineEffect,is_active:b.isEnabled,is_progress_visible:b.isLoaderVisible,is_visible:b.isVisible,position:b.position,text:b.text,text_color:b.textColor})});const b0="web_app_setup_settings_button",QE="settings_button_pressed",fy="settingsButton",[gT,y5]=rs(!1),[Mx,v5]=rs(!1),T0=Vl(fy,b0),eI=mf(fy,Mx,b0);eI("hide",()=>{S0(!1)});T0("mount",()=>{Mx()||(S0(jl()&&cl(fy)||!1),Mx.set(!0))});function S0(_){_!==gT()&&(ns(b0,{is_visible:_}),Sc(fy,_),gT.set(_))}T0("onClick",_=>ia(QE,_));T0("offClick",_=>{hf(QE,_)});eI("show",()=>{S0(!0)});const E0="web_app_setup_swipe_behavior",py="swipeBehavior",[Px,x5]=rs(!1),[_T,w5]=rs(!0),D3=Vl(py,E0),tI=mf(py,Px,E0);tI("disableVertical",()=>{I0(!1)});tI("enableVertical",()=>{I0(!0)});D3("mount",()=>{Px()||(I0(jl()&&cl(py)||!1,!0),Px.set(!0))});function I0(_,b){(_!==_T()||b)&&(ns(E0,{allow_vertical_swipe:_}),Sc(py,_),_T.set(_))}const _p="viewport",A0="fullscreen_changed",C0="safe_area_changed",M0="content_safe_area_changed",P0="viewport_changed",rI=gf(_p),yT={left:0,top:0,bottom:0,right:0};function Xv(_){return Math.max(_,0)}const[Yv,nI]=rs({contentSafeAreaInsets:yT,height:0,isExpanded:!1,isFullscreen:!1,safeAreaInsets:yT,stableHeight:0,width:0});function yp(_){return co(()=>nI()[_])}const R0=yp("height"),z0=yp("stableHeight"),iI=yp("width"),L3=yp("isExpanded"),O3=co(()=>R0()===z0());function pm(_){const{height:b,stableHeight:I,width:z}=_;Yv.set({...Yv(),...p0({..._,height:b?Xv(b):void 0,width:z?Xv(z):void 0,stableHeight:I?Xv(I):void 0})}),Sc(_p,Yv())}function F3(){return cl(_p)}function my(_){return co(()=>k0()[_])}const k0=yp("contentSafeAreaInsets"),sI=my("bottom"),oI=my("left"),aI=my("right"),lI=my("top");function gy(_){return co(()=>D0()[_])}const D0=yp("safeAreaInsets"),cI=gy("bottom"),uI=gy("left"),hI=gy("right"),dI=gy("top"),fI="web_app_request_safe_area",pI=Vl(_p,fI),vT=pI("requestContentSafeAreaInsets",_=>oa("web_app_request_content_safe_area",M0,_));function N3(_){return oa("web_app_request_viewport",P0,_)}const xT=pI("requestSafeAreaInsets",_=>oa(fI,C0,_)),mI=_=>{const{height:b}=_;pm({isExpanded:_.is_expanded,height:b,width:_.width,stableHeight:_.is_state_stable?b:void 0})},gI=_=>{pm({isFullscreen:_.is_fullscreen})},_I=_=>{pm({safeAreaInsets:_})},yI=_=>{pm({contentSafeAreaInsets:_})},[B3,j3,V3,U3]=zg(_p,_=>{const b=jl()&&F3();return b?qo.resolve(b):qo.fn(async I=>{const z=await qo.all([xT.isAvailable()?xT(I):D0(),vT.isAvailable()?vT(I):k0()]),B=Q_(),$={contentSafeAreaInsets:z[1],isFullscreen:!!B.tgWebAppFullscreen,safeAreaInsets:z[0]};if(["macos","tdesktop","unigram","webk","weba","web"].includes(B.tgWebAppPlatform)){const re=window;return{...$,height:re.innerHeight,isExpanded:!0,stableHeight:re.innerHeight,width:re.innerWidth}}return N3(I).then(re=>({...$,height:re.height,isExpanded:re.is_expanded,stableHeight:re.is_state_stable?re.height:0,width:re.width}))},_)},_=>{ia(P0,mI),ia(A0,gI),ia(C0,_I),ia(M0,yI),pm(_)}),$3=rI("mount",B3),[,vI,G3]=j3,[,q3]=V3,[L0,H3]=U3;function W3(){mE(vI),hf(P0,mI),hf(A0,gI),hf(C0,_I),hf(M0,yI),L0.set(!1)}const Z3=ny(_p,L0),[Kv,X3]=rs(!1),Y3=Z3("bindCssVars",_=>{if(Kv())throw new n0;_||(_=I=>`--tg-viewport-${$S(I)}`);const b=[["height",R0],["stableHeight",z0],["width",iI],["safeAreaInsetTop",dI],["safeAreaInsetBottom",cI],["safeAreaInsetLeft",uI],["safeAreaInsetRight",hI],["contentSafeAreaInsetTop",lI],["contentSafeAreaInsetBottom",sI],["contentSafeAreaInsetLeft",oI],["contentSafeAreaInsetRight",aI]].reduce((I,[z,B])=>{const $=_(z);if($){const re=()=>{_0($,`${B()}px`)};I.push([re,B.sub(re),$])}return I},[]);return b.forEach(I=>{I[0]()}),Kv.set(!0),()=>{b.forEach(I=>{I[1](),y0(I[2])}),Kv.set(!1)}}),K3=rI("expand",()=>{ns("web_app_expand")}),xI="web_app_request_fullscreen",J3=mf(_p,L0,xI),wI=yp("isFullscreen"),[Q3,eO]=rs(),[tO,rO]=rs();function bI(_,b){return J3(_,ul(I=>oa(b?xI:"web_app_exit_fullscreen",[A0,"fullscreen_failed"],I).then(z=>{if("error"in z&&z.error!=="ALREADY_FULLSCREEN")throw new PL(z.error);const B="is_fullscreen"in z?z.is_fullscreen:!0;B!==wI()&&pm({isFullscreen:B})}),"Fullscreen mode change is already being requested",{promise:Q3,error:tO})[0])}const nO=bI("requestFullscreen",!0),iO=bI("exitFullscreen"),C_=Object.freeze(Object.defineProperty({__proto__:null,bindCssVars:Y3,changeFullscreenError:rO,changeFullscreenPromise:eO,contentSafeAreaInsetBottom:sI,contentSafeAreaInsetLeft:oI,contentSafeAreaInsetRight:aI,contentSafeAreaInsetTop:lI,contentSafeAreaInsets:k0,exitFullscreen:iO,expand:K3,height:R0,isCssVarsBound:X3,isExpanded:L3,isFullscreen:wI,isMounted:H3,isMounting:G3,isStable:O3,mount:$3,mountError:q3,mountPromise:vI,requestFullscreen:nO,safeAreaInsetBottom:cI,safeAreaInsetLeft:uI,safeAreaInsetRight:hI,safeAreaInsetTop:dI,safeAreaInsets:D0,stableHeight:z0,state:nI,unmount:W3,width:iI},Symbol.toStringTag,{value:"Module"})),sO="web_app_request_emoji_status_access",[b5,oO,aO]=ul(_=>oa(sO,"emoji_status_access_requested",_).then(b=>b.status),"Emoji status access request is already in progress"),[,T5,S5]=oO,[,E5]=aO,lO="web_app_set_emoji_status",[I5,cO,uO]=ul((_,b)=>oa(lO,["emoji_status_set","emoji_status_failed"],{params:{custom_emoji_id:_,duration:(b||{}).duration},...b}).then(I=>{if(I&&"error"in I)throw new CL(I.error)}),"Emoji status set request is currently in progress"),[,A5,C5]=cO,[,M5]=uO,hO="web_app_check_home_screen",[P5,dO,fO]=ul(_=>oa(hO,"home_screen_checked",_).then(b=>b.status||"unknown"),"Check home screen status request is currently in progress"),[,R5,z5]=dO,[,k5]=fO,pO=gf();pO("openLink",(_,b)=>{if(typeof _=="string")try{_=new URL(_)}catch(I){throw new sd(`"${_.toString()}" is invalid URL`,I)}b||(b={}),ns("web_app_open_link",{url:_.toString(),try_browser:b.tryBrowser,try_instant_view:b.tryInstantView})});const wT="web_app_open_tg_link",mO=gf(),gO=mO("openTelegramLink",_=>{const b=_.toString();if(!b.match(/^https:\/\/t.me\/.+/))throw new sd(`"${b}" is invalid URL`);if(!Ix(wT,nm())){window.location.href=b;return}_=new URL(_),ns(wT,{path_full:_.pathname+_.search})}),_O=gf();_O("shareURL",(_,b)=>{gO("https://t.me/share/url?"+new URLSearchParams({url:_,text:b||""}).toString().replace(/\+/g,"%20"))});function yO(_,b){return new qo({abortSignal:b,timeout:_}).catch(()=>{})}const TI="web_app_request_phone",[vO,xO,wO]=ul(_=>oa(TI,"phone_requested",_).then(b=>b.status),"Phone access request is currently in progress"),bO=s0("requestPhoneAccess",vO,{isSupported:TI}),[,D5,L5]=xO,[,O5]=wO;async function bT(_){const b=am(Go(),await Rg("getRequestedContact",{},{..._,timeout:(_||{}).timeout||5e3}));return{raw:b,parsed:am(O_(BS([Go(),FS(URLSearchParams)]),rE(Tc({contact:O_(Go(),Qx(),Tc({user_id:$_(),phone_number:Go(),first_name:Go(),last_name:G_(Go())})),auth_date:O_(Go(),kS(I=>new Date(Number(I)*1e3)),OS()),hash:Go()}))),b)}}const[F5,TO,SO]=ul(_=>new qo(async(b,I,z)=>{try{return b(await bT(z))}catch($){if($ instanceof vx)throw $}if(await bO(z)!=="sent")throw new ML("User denied access");let B=50;for(;!z.isAborted();){try{return b(await bT(z))}catch($){if($ instanceof vx)throw $}await yO(B),B+=50}},_),"Contact is already being requested"),[,N5,B5]=TO,[,j5]=SO,EO="web_app_request_write_access",[V5,IO,AO]=ul(_=>oa(EO,"write_access_requested",_).then(b=>b.status),"Write access request is currently in progress"),[,U5,$5]=IO,[,G5]=AO;var F_={exports:{}},CO=F_.exports,TT;function MO(){return TT||(TT=1,function(_,b){(function(I,z){_.exports=z()})(CO,function(){var I,z,B;function $(s,ce){if(!I)I=ce;else if(!z)z=ce;else{var be="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+I+")(sharedChunk); ("+z+")(sharedChunk); self.onerror = null;",Se={};I(Se),B=ce(Se),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(B.workerUrl=window.URL.createObjectURL(new Blob([be],{type:"text/javascript"})))}}$(["exports"],function(s){var ce=1e-6,be=typeof Float32Array<"u"?Float32Array:Array;function Se(n,e){var r=e[0],o=e[1],a=e[2],u=e[3],h=r*u-a*o;return h?(n[0]=u*(h=1/h),n[1]=-o*h,n[2]=-a*h,n[3]=r*h,n):null}function Me(){var n=new be(9);return be!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function tt(n,e){var r=e[0],o=e[1],a=e[2],u=e[3],h=e[4],g=e[5],v=e[6],x=e[7],E=e[8];return n[0]=h*E-g*x,n[1]=a*x-o*E,n[2]=o*g-a*h,n[3]=g*v-u*E,n[4]=r*E-a*v,n[5]=a*u-r*g,n[6]=u*x-h*v,n[7]=o*v-r*x,n[8]=r*h-o*u,n}function wt(n,e,r){var o=e[0],a=e[1],u=e[2],h=e[3],g=e[4],v=e[5],x=e[6],E=e[7],A=e[8],C=r[0],k=r[1],L=r[2],j=r[3],G=r[4],K=r[5],te=r[6],ne=r[7],U=r[8];return n[0]=C*o+k*h+L*x,n[1]=C*a+k*g+L*E,n[2]=C*u+k*v+L*A,n[3]=j*o+G*h+K*x,n[4]=j*a+G*g+K*E,n[5]=j*u+G*v+K*A,n[6]=te*o+ne*h+U*x,n[7]=te*a+ne*g+U*E,n[8]=te*u+ne*v+U*A,n}function Xt(){var n=new be(16);return be!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function Be(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function ct(n,e){var r=e[0],o=e[1],a=e[2],u=e[3],h=e[4],g=e[5],v=e[6],x=e[7],E=e[8],A=e[9],C=e[10],k=e[11],L=e[12],j=e[13],G=e[14],K=e[15],te=r*g-o*h,ne=r*v-a*h,U=r*x-u*h,ee=o*v-a*g,ie=o*x-u*g,ae=a*x-u*v,Te=E*j-A*L,ve=E*G-C*L,Ee=E*K-k*L,Re=A*G-C*j,He=A*K-k*j,ht=C*K-k*G,it=te*ht-ne*He+U*Re+ee*Ee-ie*ve+ae*Te;return it?(n[0]=(g*ht-v*He+x*Re)*(it=1/it),n[1]=(a*He-o*ht-u*Re)*it,n[2]=(j*ae-G*ie+K*ee)*it,n[3]=(C*ie-A*ae-k*ee)*it,n[4]=(v*Ee-h*ht-x*ve)*it,n[5]=(r*ht-a*Ee+u*ve)*it,n[6]=(G*U-L*ae-K*ne)*it,n[7]=(E*ae-C*U+k*ne)*it,n[8]=(h*He-g*Ee+x*Te)*it,n[9]=(o*Ee-r*He-u*Te)*it,n[10]=(L*ie-j*U+K*te)*it,n[11]=(A*U-E*ie-k*te)*it,n[12]=(g*ve-h*Re-v*Te)*it,n[13]=(r*Re-o*ve+a*Te)*it,n[14]=(j*ne-L*ee-G*te)*it,n[15]=(E*ee-A*ne+C*te)*it,n):null}function Tt(n,e,r){var o=e[0],a=e[1],u=e[2],h=e[3],g=e[4],v=e[5],x=e[6],E=e[7],A=e[8],C=e[9],k=e[10],L=e[11],j=e[12],G=e[13],K=e[14],te=e[15],ne=r[0],U=r[1],ee=r[2],ie=r[3];return n[0]=ne*o+U*g+ee*A+ie*j,n[1]=ne*a+U*v+ee*C+ie*G,n[2]=ne*u+U*x+ee*k+ie*K,n[3]=ne*h+U*E+ee*L+ie*te,n[4]=(ne=r[4])*o+(U=r[5])*g+(ee=r[6])*A+(ie=r[7])*j,n[5]=ne*a+U*v+ee*C+ie*G,n[6]=ne*u+U*x+ee*k+ie*K,n[7]=ne*h+U*E+ee*L+ie*te,n[8]=(ne=r[8])*o+(U=r[9])*g+(ee=r[10])*A+(ie=r[11])*j,n[9]=ne*a+U*v+ee*C+ie*G,n[10]=ne*u+U*x+ee*k+ie*K,n[11]=ne*h+U*E+ee*L+ie*te,n[12]=(ne=r[12])*o+(U=r[13])*g+(ee=r[14])*A+(ie=r[15])*j,n[13]=ne*a+U*v+ee*C+ie*G,n[14]=ne*u+U*x+ee*k+ie*K,n[15]=ne*h+U*E+ee*L+ie*te,n}function Dt(n,e,r){var o,a,u,h,g,v,x,E,A,C,k,L,j=r[0],G=r[1],K=r[2];return e===n?(n[12]=e[0]*j+e[4]*G+e[8]*K+e[12],n[13]=e[1]*j+e[5]*G+e[9]*K+e[13],n[14]=e[2]*j+e[6]*G+e[10]*K+e[14],n[15]=e[3]*j+e[7]*G+e[11]*K+e[15]):(a=e[1],u=e[2],h=e[3],g=e[4],v=e[5],x=e[6],E=e[7],A=e[8],C=e[9],k=e[10],L=e[11],n[0]=o=e[0],n[1]=a,n[2]=u,n[3]=h,n[4]=g,n[5]=v,n[6]=x,n[7]=E,n[8]=A,n[9]=C,n[10]=k,n[11]=L,n[12]=o*j+g*G+A*K+e[12],n[13]=a*j+v*G+C*K+e[13],n[14]=u*j+x*G+k*K+e[14],n[15]=h*j+E*G+L*K+e[15]),n}function Vt(n,e,r){var o=r[0],a=r[1],u=r[2];return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n[4]=e[4]*a,n[5]=e[5]*a,n[6]=e[6]*a,n[7]=e[7]*a,n[8]=e[8]*u,n[9]=e[9]*u,n[10]=e[10]*u,n[11]=e[11]*u,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function jt(n,e,r){var o=Math.sin(r),a=Math.cos(r),u=e[4],h=e[5],g=e[6],v=e[7],x=e[8],E=e[9],A=e[10],C=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=u*a+x*o,n[5]=h*a+E*o,n[6]=g*a+A*o,n[7]=v*a+C*o,n[8]=x*a-u*o,n[9]=E*a-h*o,n[10]=A*a-g*o,n[11]=C*a-v*o,n}function vr(n,e,r){var o=Math.sin(r),a=Math.cos(r),u=e[0],h=e[1],g=e[2],v=e[3],x=e[8],E=e[9],A=e[10],C=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=u*a-x*o,n[1]=h*a-E*o,n[2]=g*a-A*o,n[3]=v*a-C*o,n[8]=u*o+x*a,n[9]=h*o+E*a,n[10]=g*o+A*a,n[11]=v*o+C*a,n}function hr(n,e,r){var o=Math.sin(r),a=Math.cos(r),u=e[0],h=e[1],g=e[2],v=e[3],x=e[4],E=e[5],A=e[6],C=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=u*a+x*o,n[1]=h*a+E*o,n[2]=g*a+A*o,n[3]=v*a+C*o,n[4]=x*a-u*o,n[5]=E*a-h*o,n[6]=A*a-g*o,n[7]=C*a-v*o,n}function Kt(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Wt(n,e,r){var o,a,u,h=r[0],g=r[1],v=r[2],x=Math.hypot(h,g,v);return x<ce?null:(h*=x=1/x,g*=x,v*=x,o=Math.sin(e),a=Math.cos(e),n[0]=h*h*(u=1-a)+a,n[1]=g*h*u+v*o,n[2]=v*h*u-g*o,n[3]=0,n[4]=h*g*u-v*o,n[5]=g*g*u+a,n[6]=v*g*u+h*o,n[7]=0,n[8]=h*v*u+g*o,n[9]=g*v*u-h*o,n[10]=v*v*u+a,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}function Cr(n,e){var r=e[0],o=e[1],a=e[2],u=e[3],h=r+r,g=o+o,v=a+a,x=r*h,E=o*h,A=o*g,C=a*h,k=a*g,L=a*v,j=u*h,G=u*g,K=u*v;return n[0]=1-A-L,n[1]=E+K,n[2]=C-G,n[3]=0,n[4]=E-K,n[5]=1-x-L,n[6]=k+j,n[7]=0,n[8]=C+G,n[9]=k-j,n[10]=1-x-A,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var oi=Tt;function fn(){var n=new be(3);return be!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function ui(n){var e=new be(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function gr(n){return Math.hypot(n[0],n[1],n[2])}function Mr(n,e,r){var o=new be(3);return o[0]=n,o[1]=e,o[2]=r,o}function rn(n,e,r){return n[0]=e[0]+r[0],n[1]=e[1]+r[1],n[2]=e[2]+r[2],n}function nn(n,e,r){return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],n}function un(n,e,r){return n[0]=e[0]*r[0],n[1]=e[1]*r[1],n[2]=e[2]*r[2],n}function At(n,e,r){return n[0]=Math.min(e[0],r[0]),n[1]=Math.min(e[1],r[1]),n[2]=Math.min(e[2],r[2]),n}function Tr(n,e,r){return n[0]=Math.max(e[0],r[0]),n[1]=Math.max(e[1],r[1]),n[2]=Math.max(e[2],r[2]),n}function Ht(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n}function rt(n,e,r,o){return n[0]=e[0]+r[0]*o,n[1]=e[1]+r[1]*o,n[2]=e[2]+r[2]*o,n}function Ot(n,e){var r=e[0]-n[0],o=e[1]-n[1],a=e[2]-n[2];return r*r+o*o+a*a}function Pr(n){var e=n[0],r=n[1],o=n[2];return e*e+r*r+o*o}function Hr(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function br(n,e){var r=e[0],o=e[1],a=e[2],u=r*r+o*o+a*a;return u>0&&(u=1/Math.sqrt(u)),n[0]=e[0]*u,n[1]=e[1]*u,n[2]=e[2]*u,n}function Br(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Sr(n,e,r){var o=e[0],a=e[1],u=e[2],h=r[0],g=r[1],v=r[2];return n[0]=a*v-u*g,n[1]=u*h-o*v,n[2]=o*g-a*h,n}function vn(n,e,r,o){var a=e[0],u=e[1],h=e[2];return n[0]=a+o*(r[0]-a),n[1]=u+o*(r[1]-u),n[2]=h+o*(r[2]-h),n}function Ar(n,e,r){var o=e[0],a=e[1],u=e[2],h=r[3]*o+r[7]*a+r[11]*u+r[15];return n[0]=(r[0]*o+r[4]*a+r[8]*u+r[12])/(h=h||1),n[1]=(r[1]*o+r[5]*a+r[9]*u+r[13])/h,n[2]=(r[2]*o+r[6]*a+r[10]*u+r[14])/h,n}function Pi(n,e,r){var o=e[0],a=e[1],u=e[2];return n[0]=o*r[0]+a*r[3]+u*r[6],n[1]=o*r[1]+a*r[4]+u*r[7],n[2]=o*r[2]+a*r[5]+u*r[8],n}function qi(n,e,r){var o=r[0],a=r[1],u=r[2],h=e[0],g=e[1],v=e[2],x=a*v-u*g,E=u*h-o*v,A=o*g-a*h,C=a*A-u*E,k=u*x-o*A,L=o*E-a*x,j=2*r[3];return E*=j,A*=j,k*=2,L*=2,n[0]=h+(x*=j)+(C*=2),n[1]=g+E+k,n[2]=v+A+L,n}function us(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}var vi=nn,xn=un,aa=gr;function hs(){var n=new be(4);return be!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Ho(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n}function Ul(n,e){var r=e[0],o=e[1],a=e[2],u=e[3],h=r*r+o*o+a*a+u*u;return h>0&&(h=1/Math.sqrt(h)),n[0]=r*h,n[1]=o*h,n[2]=a*h,n[3]=u*h,n}function ds(n,e,r){var o=e[0],a=e[1],u=e[2],h=e[3];return n[0]=r[0]*o+r[4]*a+r[8]*u+r[12]*h,n[1]=r[1]*o+r[5]*a+r[9]*u+r[13]*h,n[2]=r[2]*o+r[6]*a+r[10]*u+r[14]*h,n[3]=r[3]*o+r[7]*a+r[11]*u+r[15]*h,n}function Oi(){var n=new be(4);return be!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Zs(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function la(n,e,r){r*=.5;var o=e[0],a=e[1],u=e[2],h=e[3],g=Math.sin(r),v=Math.cos(r);return n[0]=o*v+h*g,n[1]=a*v+u*g,n[2]=u*v-a*g,n[3]=h*v-o*g,n}function ho(n,e,r){r*=.5;var o=e[0],a=e[1],u=e[2],h=e[3],g=Math.sin(r),v=Math.cos(r);return n[0]=o*v-u*g,n[1]=a*v+h*g,n[2]=u*v+o*g,n[3]=h*v-a*g,n}fn(),hs();var xs,Oa,hl,ks,Wo,ca=Ul,Zo=(xs=fn(),Oa=Mr(1,0,0),hl=Mr(0,1,0),function(n,e,r){var o=Br(e,r);return o<-.999999?(Sr(xs,Oa,e),aa(xs)<1e-6&&Sr(xs,hl,e),br(xs,xs),function(a,u,h){h*=.5;var g=Math.sin(h);a[0]=g*u[0],a[1]=g*u[1],a[2]=g*u[2],a[3]=Math.cos(h)}(n,xs,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Sr(xs,e,r),n[0]=xs[0],n[1]=xs[1],n[2]=xs[2],n[3]=1+o,ca(n,n))});function Hi(){var n=new be(2);return be!=Float32Array&&(n[0]=0,n[1]=0),n}function Ds(n,e){var r=new be(2);return r[0]=n,r[1]=e,r}function wa(n,e,r){return n[0]=e[0]+r[0],n[1]=e[1]+r[1],n}function ba(n,e,r){return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n}function dl(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n}function ua(n){return Math.hypot(n[0],n[1])}function Fa(n,e){var r=e[0],o=e[1],a=r*r+o*o;return a>0&&(a=1/Math.sqrt(a)),n[0]=e[0]*a,n[1]=e[1]*a,n}function Un(n,e){return n[0]*e[0]+n[1]*e[1]}function Qr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}Oi(),Oi(),Me(),Hi();var Wn,In,Nn=function(){if(Wo)return ks;function n(e,r,o,a){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(a-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=o,this.p2y=a}return Wo=1,ks=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,a=0;a<8;a++){var u=this.sampleCurveX(o)-e;if(Math.abs(u)<r)return o;var h=this.sampleCurveDerivativeX(o);if(Math.abs(h)<1e-6)break;o-=u/h}var g=0,v=1;for(o=e,a=0;a<20&&(u=this.sampleCurveX(o),!(Math.abs(u-e)<r));a++)e>u?g=o:v=o,o=.5*(v-g)+g;return o},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},ks}(),Ri=Qr(Nn);function Wi(){if(In)return Wn;function n(e,r){this.x=e,this.y=r}return In=1,Wn=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,r){return this.clone()._rotateAround(e,r)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var r=e.x-this.x,o=e.y-this.y;return r*r+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,r){return Math.atan2(this.x*r-this.y*e,this.x*e+this.y*r)},_matMult:function(e){var r=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var r=Math.cos(e),o=Math.sin(e),a=o*this.x+r*this.y;return this.x=r*this.x-o*this.y,this.y=a,this},_rotateAround:function(e,r){var o=Math.cos(e),a=Math.sin(e),u=r.y+a*(this.x-r.x)+o*(this.y-r.y);return this.x=r.x+o*(this.x-r.x)-a*(this.y-r.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(e){return e instanceof n?e:Array.isArray(e)?new n(e[0],e[1]):e},Wn}var ft=Qr(Wi());function ws(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!ws(n[r],e[r]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const r in n)if(!ws(n[r],e[r]))return!1;return!0}return n===e}const Xs=Math.PI/180,fo=180/Math.PI;function en(n){return n*Xs}function Oe(n){return n*fo}const Y=[[0,0],[1,0],[1,1],[0,1]];function Q(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,r=e*n;return 4*(n<.5?r:3*(n-e)+r-.75)}function he(n,e,r,o){const a=new Ri(n,e,r,o);return function(u){return a.solve(u)}}const we=he(.25,.1,.25,1);function me(n,e,r){return Math.min(r,Math.max(e,n))}function Ae(n,e,r){return(r=me((r-n)/(e-n),0,1))*r*(3-2*r)}function Ne(n,e,r){const o=r-e,a=((n-e)%o+o)%o+e;return a===e?r:a}function Ce(n,e,r){if(!n.length)return r(null,[]);let o=n.length;const a=new Array(n.length);let u=null;n.forEach((h,g)=>{e(h,(v,x)=>{v&&(u=v),a[g]=x,--o==0&&r(u,a)})})}function je(n,...e){for(const r of e)for(const o in r)n[o]=r[o];return n}let nt=1;function Ue(){return nt++}function Et(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function $t(n,e){n.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function Yt(n,e,r){const o={};for(const a in n)o[a]=e.call(this,n[a],a,n);return o}function mr(n,e,r){const o={};for(const a in n)e.call(this,n[a],a,n)&&(o[a]=n[a]);return o}function _r(n){return Array.isArray(n)?n.map(_r):typeof n=="object"&&n?Yt(n,_r):n}function xr(n,e){for(let r=0;r<n.length;r++)if(e.indexOf(n[r])>=0)return!0;return!1}const $r={};function Rr(n){$r[n]||(typeof console<"u"&&console.warn(n),$r[n]=!0)}function jn(n,e,r){return(r.y-n.y)*(e.x-n.x)>(e.y-n.y)*(r.x-n.x)}function on(n){let e=0;for(let r,o,a=0,u=n.length,h=u-1;a<u;h=a++)r=n[a],o=n[h],e+=(o.x-r.x)*(r.y+o.y);return e}function ti([n,e,r]){const o=en(e+90),a=en(r);return{x:n*Math.cos(o)*Math.sin(a),y:n*Math.sin(o)*Math.sin(a),z:n*Math.cos(a),azimuthal:e,polar:r}}function An(n){return(typeof self<"u"||n!==void 0)&&typeof WorkerGlobalScope<"u"&&(n!==void 0?n:self)instanceof WorkerGlobalScope}function bn(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,o,a,u)=>{const h=a||u;return e[o]=!h||h.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let gi=null;function xi(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}function hi(n,e,r,o){for(;e<r;){const a=e+r>>1;n[a]<o?e=a+1:r=a}return e}function Zi(n,e,r,o){for(;e<r;){const a=e+r>>1;n[a]<=o?e=a+1:r=a}return e}function Ui(n){return n>0?1/(1.001-n):1+n}function $s(n){return n>0?1-1/(1.001-n):-n}function po(n,e,r){return(n-e.min)*(r.max-r.min)/(e.max-e.min)+r.min}const bs={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!bs.API_URL)return null;try{const n=new URL(bs.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v0.3.0.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function $l(n){return bs.API_URL_REGEX.test(n)}function ad(n){return bs.API_SPRITE_REGEX.test(n)}let Gl,ql,Hl,Ic,Ac,dh;function _u(){return Gl==null&&(Gl=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Gl}const ha={now:()=>Ic!==void 0?Ic:performance.now(),setNow(n){Ic=n},restoreNow(){Ic=void 0},frame(n){const e=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:r,height:o}=n;Ac||(Ac=document.createElement("canvas"));const a=Ac.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(r>Ac.width||o>Ac.height)&&(Ac.width=r,Ac.height=o),a.clearRect(-e,-e,r+2*e,o+2*e),a.drawImage(n,0,0,r,o),a.getImageData(-e,-e,r+2*e,o+2*e)},resolveURL:n=>(ql||(ql=document.createElement("a")),ql.href=n,ql.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Hl==null&&(Hl=window.matchMedia("(prefers-reduced-motion: reduce)")),Hl.matches)},hasCanvasFingerprintNoise(){if(dh!==void 0)return dh;if(!_u())return dh=!1,!1;const n=new OffscreenCanvas(85,1),e=n.getContext("2d",{willReadFrequently:!0});let r=0;for(let a=0;a<n.width;++a)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(a,0,1,1);const o=e.getImageData(0,0,n.width,n.height);r=0;for(let a=0;a<o.data.length;++a)if(a%4!=3&&r++!==o.data[a])return dh=!0,!0;return dh=!1,!1}};function mo(n,e){const r=n.indexOf("?");if(r<0)return`${n}?${new URLSearchParams(e).toString()}`;const o=new URLSearchParams(n.slice(r));for(const a in e)o.set(a,e[a]);return`${n.slice(0,r)}?${o.toString()}`}function Ys(n,e={persistentParams:[]}){const r=n.indexOf("?");if(r<0)return n;const o=new URLSearchParams,a=new URLSearchParams(n.slice(r));for(const h of e.persistentParams){const g=a.get(h);g&&o.set(h,g)}const u=o.toString();return`${n.slice(0,r)}${u.length>0?`?${u}`:""}`}const fl="mapbox-tiles";let Xo=500,Yn=50;const yu=["language","worldview","jobid"];let Ta,Cc;function Wl(){try{return caches}catch{}}function Mc(){const n=Wl();n&&Ta==null&&(Ta=n.open(fl))}let ld=1/0;const fh={supported:!1,testSupport:function(n){!da&&Co&&(Yo?xu(n):Ls=n)}};let Ls,Co,da=!1,Yo=!1;const vu=typeof self<"u"?self:{};function xu(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,Co),n.isContextLost())return;fh.supported=!0}catch{}n.deleteTexture(e),da=!0}vu.document&&(Co=vu.document.createElement("img"),Co.onload=function(){Ls&&xu(Ls),Ls=null,Yo=!0},Co.onerror=function(){da=!0,Ls=null},Co.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const fa={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(fa);class gn extends Error{constructor(e,r,o){r===401&&$l(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ph=An()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Na=function(n,e){if(!(/^file:/.test(r=n.url)||/^file:/.test(ph())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,a){const u=new AbortController,h=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:ph(),referrerPolicy:o.referrerPolicy,signal:u.signal});let g=!1,v=!1;const x=(E=h.url).indexOf("sku=")>0&&$l(E);var E;o.type==="json"&&h.headers.set("Accept","application/json");const A=(k,L,j)=>{if(v)return;if(k&&k.message!=="SecurityError"&&Rr(k.toString()),L&&j)return C(L);const G=Date.now();fetch(h).then(K=>{if(K.ok){const te=x?K.clone():null;return C(K,te,G)}return a(new gn(K.statusText,K.status,o.url))}).catch(K=>{K.name!=="AbortError"&&a(new Error(`${K.message} ${o.url}`))})},C=(k,L,j)=>{(o.type==="arrayBuffer"?k.arrayBuffer():o.type==="json"?k.json():k.text()).then(G=>{v||(L&&j&&function(K,te,ne){if(Mc(),Ta==null)return;const U=bn(te.headers.get("Cache-Control")||"");if(U["no-store"])return;const ee={status:te.status,statusText:te.statusText,headers:new Headers};te.headers.forEach((Te,ve)=>ee.headers.set(ve,Te)),U["max-age"]&&ee.headers.set("Expires",new Date(ne+1e3*U["max-age"]).toUTCString());const ie=ee.headers.get("Expires");if(!ie||new Date(ie).getTime()-ne<42e4)return;let ae=Ys(K.url,{persistentParams:yu});if(te.status===206){const Te=K.headers.get("Range");if(!Te)return;ee.status=200,ae=mo(ae,{range:Te})}(function(Te,ve){if(Cc===void 0)try{new Response(new ReadableStream),Cc=!0}catch{Cc=!1}Cc?ve(Te.body):Te.blob().then(ve).catch(Ee=>Rr(Ee.message))})(te,Te=>{const ve=new Response((Ee=te.status)!==200&&Ee!==404&&[101,103,204,205,304].includes(Ee)?null:Te,ee);var Ee;Mc(),Ta?.then(Re=>Re.put(ae,ve)).catch(Re=>Rr(Re.message))})}(h,L,j),g=!0,a(null,G,k.headers.get("Cache-Control"),k.headers.get("Expires")))}).catch(G=>{v||a(new Error(G.message))})};return x?function(k,L){if(Mc(),Ta==null)return L(null);Ta.then(j=>{let G=Ys(k.url,{persistentParams:yu});const K=k.headers.get("Range");K&&(G=mo(G,{range:K})),j.match(G).then(te=>{const ne=function(U){if(!U)return!1;const ee=new Date(U.headers.get("Expires")||0),ie=bn(U.headers.get("Cache-Control")||"");return Number(ee)>Date.now()&&!ie["no-cache"]}(te);j.delete(G).catch(L),ne&&j.put(G,te.clone()).catch(L),L(null,te,ne)}).catch(L)}).catch(L)}(h,A):A(null,null),{cancel:()=>{v=!0,g||u.abort()}}}(n,e);if(An(self)&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var r;return function(o,a){const u=new XMLHttpRequest;u.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const h in o.headers)u.setRequestHeader(h,o.headers[h]);return o.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=o.credentials==="include",u.onerror=()=>{a(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let h=u.response;if(o.type==="json")try{h=JSON.parse(u.response)}catch(g){return a(g)}a(null,h,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else a(new gn(u.statusText,u.status,o.url))},u.send(o.body),{cancel:()=>u.abort()}}(n,e)},mh=function(n,e){return Na(je(n,{type:"arrayBuffer"}),e)};function vp(n){const e=document.createElement("a");return e.href=n,e.protocol===location.protocol&&e.host===location.host}const Zl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Xl,Yl;Xl=[],Yl=0;const Pc=function(n,e){if(fh.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),Yl>=bs.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Xl.push(u),u}Yl++;let r=!1;const o=()=>{if(!r)for(r=!0,Yl--;Xl.length&&Yl<bs.MAX_PARALLEL_IMAGE_REQUESTS;){const u=Xl.shift(),{requestParameters:h,callback:g,cancelled:v}=u;v||(u.cancel=Pc(h,g).cancel)}},a=mh(n,(u,h,g,v)=>{o(),u?e(u):h&&(self.createImageBitmap?function(x,E){const A=new Blob([new Uint8Array(x)],{type:"image/png"});createImageBitmap(A).then(C=>{E(null,C)}).catch(C=>{E(new Error(`Could not load image because of ${C.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(h,(x,E)=>e(x,E,g,v)):function(x,E){const A=new Image;A.onload=()=>{E(null,A),URL.revokeObjectURL(A.src),A.onload=null,requestAnimationFrame(()=>{A.src=Zl})},A.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const C=new Blob([new Uint8Array(x)],{type:"image/png"});A.src=x.byteLength?URL.createObjectURL(C):Zl}(h,(x,E)=>e(x,E,g,v)))});return{cancel:()=>{a.cancel(),o()}}};var Rc,pa,gh,pl={exports:{}},cd={exports:{}},wu={exports:{}},Mo=function(){if(gh)return pl.exports;gh=1;var n=(Rc||(Rc=1,cd.exports=function(r,o){var a,u,h,g,v,x,E,A;for(u=r.length-(a=3&r.length),h=o,v=3432918353,x=461845907,A=0;A<u;)E=255&r.charCodeAt(A)|(255&r.charCodeAt(++A))<<8|(255&r.charCodeAt(++A))<<16|(255&r.charCodeAt(++A))<<24,++A,h=27492+(65535&(g=5*(65535&(h=(h^=E=(65535&(E=(E=(65535&E)*v+(((E>>>16)*v&65535)<<16)&4294967295)<<15|E>>>17))*x+(((E>>>16)*x&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(E=0,a){case 3:E^=(255&r.charCodeAt(A+2))<<16;case 2:E^=(255&r.charCodeAt(A+1))<<8;case 1:h^=E=(65535&(E=(E=(65535&(E^=255&r.charCodeAt(A)))*v+(((E>>>16)*v&65535)<<16)&4294967295)<<15|E>>>17))*x+(((E>>>16)*x&65535)<<16)&4294967295}return h^=r.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0}),cd.exports),e=(pa||(pa=1,wu.exports=function(r,o){for(var a,u=r.length,h=o^u,g=0;u>=4;)a=1540483477*(65535&(a=255&r.charCodeAt(g)|(255&r.charCodeAt(++g))<<8|(255&r.charCodeAt(++g))<<16|(255&r.charCodeAt(++g))<<24))+((1540483477*(a>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),u-=4,++g;switch(u){case 3:h^=(255&r.charCodeAt(g+2))<<16;case 2:h^=(255&r.charCodeAt(g+1))<<8;case 1:h=1540483477*(65535&(h^=255&r.charCodeAt(g)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0}),wu.exports);return pl.exports=n,pl.exports.murmur3=n,pl.exports.murmur2=e,pl.exports}(),zc=Qr(Mo);class Kl{constructor(e,...r){je(this,r[0]||{}),this.type=e}}class Sa extends Kl{constructor(e,r={}){super("error",je({error:e},r))}}function _h(n,e,r){r[n]&&r[n].indexOf(e)!==-1||(r[n]=r[n]||[],r[n].push(e))}function kc(n,e,r){if(r&&r[n]){const o=r[n].indexOf(e);o!==-1&&r[n].splice(o,1)}}class Jl{on(e,r){return this._listeners=this._listeners||{},_h(e,r,this._listeners),this}off(e,r){return kc(e,r,this._listeners),kc(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},_h(e,r,this._oneTimeListeners),this):new Promise(o=>{this.once(e,o)})}fire(e,r){const o=typeof e=="string"?new Kl(e,r):e,a=o.type;if(this.listens(a)){o.target=this;const u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const v of u)v.call(this,o);const h=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const v of h)kc(a,v,this._oneTimeListeners),v.call(this,o);const g=this._eventedParent;g&&(je(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(o))}else o instanceof Sa&&console.error(o.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}class Gs{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Gs(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[r,o]=e.split("");return new Gs({name:r,iconsetId:o})}static isEqual(e,r){return e.name===r.name&&e.iconsetId===r.iconsetId}toString(){return Gs.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var bu,Dc={},Ts=function(){if(bu)return Dc;bu=1;var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(u){return(u=Math.round(u))<0?0:u>255?255:u}function r(u){return e(u[u.length-1]==="%"?parseFloat(u)/100*255:parseInt(u))}function o(u){return(h=u[u.length-1]==="%"?parseFloat(u)/100:parseFloat(u))<0?0:h>1?1:h;var h}function a(u,h,g){return g<0?g+=1:g>1&&(g-=1),6*g<1?u+(h-u)*g*6:2*g<1?h:3*g<2?u+(h-u)*(2/3-g)*6:u}try{Dc.parseCSSColor=function(u){var h,g=u.replace(/ /g,"").toLowerCase();if(g in n)return n[g].slice();if(g[0]==="#")return g.length===4?(h=parseInt(g.substr(1),16))>=0&&h<=4095?[(3840&h)>>4|(3840&h)>>8,240&h|(240&h)>>4,15&h|(15&h)<<4,1]:null:g.length===7&&(h=parseInt(g.substr(1),16))>=0&&h<=16777215?[(16711680&h)>>16,(65280&h)>>8,255&h,1]:null;var v=g.indexOf("("),x=g.indexOf(")");if(v!==-1&&x+1===g.length){var E=g.substr(0,v),A=g.substr(v+1,x-(v+1)).split(","),C=1;switch(E){case"rgba":if(A.length!==4)return null;C=o(A.pop());case"rgb":return A.length!==3?null:[r(A[0]),r(A[1]),r(A[2]),C];case"hsla":if(A.length!==4)return null;C=o(A.pop());case"hsl":if(A.length!==3)return null;var k=(parseFloat(A[0])%360+360)%360/360,L=o(A[1]),j=o(A[2]),G=j<=.5?j*(L+1):j+L-j*L,K=2*j-G;return[e(255*a(K,G,k+1/3)),e(255*a(K,G,k)),e(255*a(K,G,k-1/3)),C];default:return null}}return null}}catch{}return Dc}();class _n{constructor(e,r,o,a=1){this.r=e,this.g=r,this.b=o,this.a=a}static parse(e){if(!e)return;if(e instanceof _n)return e;if(typeof e!="string")return;const r=Ts.parseCSSColor(e);return r?new _n(r[0]/255,r[1]/255,r[2]/255,r[3]):void 0}toString(){const[e,r,o,a]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*r)},${Math.round(255*o)},${a})`}toNonPremultipliedRenderColor(e){const{r,g:o,b:a,a:u}=this;return new yh(e,r,o,a,u)}toPremultipliedRenderColor(e){const{r,g:o,b:a,a:u}=this;return new _f(e,r*u,o*u,a*u,u)}clone(){return new _n(this.r,this.g,this.b,this.a)}}class Ko{constructor(e,r,o,a,u,h=!1){if(this.premultiplied=!1,this.premultiplied=h,e){const g=e.image.height,v=g*g;this.premultiplied?(r=u===0?0:r/u*(g-1),o=u===0?0:o/u*(g-1),a=u===0?0:a/u*(g-1)):(r*=g-1,o*=g-1,a*=g-1);const x=Math.floor(r),E=Math.floor(o),A=Math.floor(a),C=Math.ceil(r),k=Math.ceil(o),L=Math.ceil(a),j=r-x,G=o-E,K=a-A,te=e.image.data,ne=4*(x+E*v+A*g),U=4*(x+E*v+L*g),ee=4*(x+k*v+A*g),ie=4*(x+k*v+L*g),ae=4*(C+E*v+A*g),Te=4*(C+E*v+L*g),ve=4*(C+k*v+A*g),Ee=4*(C+k*v+L*g);if(ne<0||Ee>=te.length)throw new Error("out of range");this.r=lr(lr(lr(te[ne],te[U],K),lr(te[ee],te[ie],K),G),lr(lr(te[ae],te[Te],K),lr(te[ve],te[Ee],K),G),j)/255*(this.premultiplied?u:1),this.g=lr(lr(lr(te[ne+1],te[U+1],K),lr(te[ee+1],te[ie+1],K),G),lr(lr(te[ae+1],te[Te+1],K),lr(te[ve+1],te[Ee+1],K),G),j)/255*(this.premultiplied?u:1),this.b=lr(lr(lr(te[ne+2],te[U+2],K),lr(te[ee+2],te[ie+2],K),G),lr(lr(te[ae+2],te[Te+2],K),lr(te[ve+2],te[Ee+2],K),G),j)/255*(this.premultiplied?u:1),this.a=u}else this.r=r,this.g=o,this.b=a,this.a=u}toArray(){const{r:e,g:r,b:o,a}=this;return[255*e,255*r,255*o,a]}toHslaArray(){let{r:e,g:r,b:o,a}=this;if(this.premultiplied){if(a===0)return[0,0,0,0];e/=a,r/=a,o/=a}const u=Math.min(Math.max(e,0),1),h=Math.min(Math.max(r,0),1),g=Math.min(Math.max(o,0),1),v=Math.min(u,h,g),x=Math.max(u,h,g),E=(v+x)/2;if(v===x)return[0,0,100*E,a];const A=x-v,C=E>.5?A/(2-x-v):A/(x+v);let k=0;return x===u?k=(h-g)/A+(h<g?6:0):x===h?k=(g-u)/A+2:x===g&&(k=(u-h)/A+4),k*=60,[Math.min(Math.max(k,0),360),Math.min(Math.max(100*C,0),100),Math.min(Math.max(100*E,0),100),a]}toArray01(){const{r:e,g:r,b:o,a}=this;return[e,r,o,a]}toArray01Scaled(e){const{r,g:o,b:a}=this;return[r*e,o*e,a*e]}toArray01Linear(){const{r:e,g:r,b:o,a}=this;return[Math.pow(e,2.2),Math.pow(r,2.2),Math.pow(o,2.2),a]}}class yh extends Ko{constructor(e,r,o,a,u){super(e,r,o,a,u,!1)}}class _f extends Ko{constructor(e,r,o,a,u){super(e,r,o,a,u,!0)}}function lr(n,e,r){return n*(1-r)+e*r}function Tu(n,e,r){return n.map((o,a)=>lr(o,e[a],r))}_n.black=new _n(0,0,0,1),_n.white=new _n(1,1,1,1),_n.transparent=new _n(0,0,0,0),_n.red=new _n(1,0,0,1),_n.blue=new _n(0,0,1,1);var ml=Object.freeze({__proto__:null,array:Tu,color:function(n,e,r){return new _n(lr(n.r,e.r,r),lr(n.g,e.g,r),lr(n.b,e.b,r),lr(n.a,e.a,r))},number:lr});function Ba(n,...e){for(const r of e)for(const o in r)n[o]=r[o];return n}class Po extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class yf{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[o,a]of r)this.bindings[o]=a}concat(e){return new yf(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Su={kind:"null"},Qt={kind:"number"},Pn={kind:"string"},Cn={kind:"boolean"},Ro={kind:"color"},gl={kind:"object"},Rn={kind:"value"},ud={kind:"collator"},Eu={kind:"formatted"},vh={kind:"resolvedImage"};function Ks(n,e){return{kind:"array",itemType:n,N:e}}function $i(n){if(n.kind==="array"){const e=$i(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const mm=[Su,Qt,Pn,Cn,Ro,Eu,gl,Ks(Rn),vh];function Ql(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Ql(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const r of mm)if(!Ql(r,e))return null}}return`Expected ${$i(n)} but found ${$i(e)} instead.`}function ec(n,e){return e.some(r=>r.kind===n.kind)}function xh(n,e){return e.some(r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n)}function hd(n,e){return n.kind==="array"&&e.kind==="array"?n.N===e.N&&hd(n.itemType,e.itemType):n.kind===e.kind}class Iu{constructor(e,r,o){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class dd{constructor(e,r,o,a,u){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=o,this.fontStack=a,this.textColor=u}}class Js{constructor(e){this.sections=e}static fromString(e){return new Js([new dd(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Js?e:Js.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){const a=r.image.getPrimary().id.toString();e.push(["image",a]);continue}e.push(r.text);const o={};r.fontStack&&(o["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(o["font-scale"]=r.scale),r.textColor&&(o["text-color"]=["rgba"].concat(r.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(o)}return e}}class _l{constructor(e,r={}){if(this.id=Gs.from(e),this.options=Object.assign({},r),r.transform){const{a:o,b:a,c:u,d:h,e:g,f:v}=r.transform;this.options.transform=new DOMMatrix([o,a,u,h,g,v])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:r,c:o,d:a,e:u,f:h}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:r,c:o,d:a,e:u,f:h}})}static parse(e){let r,o,a,u;try{({name:r,iconsetId:o,params:a,transform:u}=JSON.parse(e)||{})}catch{return null}if(!r)return null;const{a:h,b:g,c:v,d:x,e:E,f:A}=u||{};return new _l({name:r,iconsetId:o},{params:a,transform:new DOMMatrix([h,g,v,x,E,A])})}scaleSelf(e,r){return this.options.transform.scaleSelf(e,r),this}}class go{constructor(e,r,o,a,u=!1){this.primaryId=Gs.from(e),this.primaryOptions=r,o&&(this.secondaryId=Gs.from(o)),this.secondaryOptions=a,this.available=u}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new _l(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new _l(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?go.build({name:e}):e}static build(e,r,o,a){return!e||typeof e=="object"&&!("name"in e)?null:new go(e,o,r,a)}}function Lc(n,e,r,o){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,e,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,e,r,o]:[n,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Gr(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof _n||n instanceof Iu||n instanceof Js||n instanceof go)return!0;if(Array.isArray(n)){for(const e of n)if(!Gr(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!Gr(n[e]))return!1;return!0}return!1}function Bt(n){if(n===null)return Su;if(typeof n=="string")return Pn;if(typeof n=="boolean")return Cn;if(typeof n=="number")return Qt;if(n instanceof _n)return Ro;if(n instanceof Iu)return ud;if(n instanceof Js)return Eu;if(n instanceof go)return vh;if(Array.isArray(n)){const e=n.length;let r;for(const o of n){const a=Bt(o);if(r){if(r===a)continue;r=Rn;break}r=a}return Ks(r||Rn,e)}return gl}function zo(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Js||n instanceof go||n instanceof _n?n.toString():JSON.stringify(n)}class ur{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Gr(e[1]))return r.error("invalid value");const o=e[1];let a=Bt(o);const u=r.expectedType;return a.kind!=="array"||a.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(a=u),new ur(a,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof _n?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Js?this.value.serialize():this.value}}class Fi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Au={string:Pn,number:Qt,boolean:Cn,object:gl};class ar{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let o,a=1;const u=e[0];if(u==="array"){let g,v;if(e.length>2){const x=e[1];if(typeof x!="string"||!(x in Au)||x==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);g=Au[x],a++}else g=Rn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);v=e[2],a++}o=Ks(g,v)}else o=Au[u];const h=[];for(;a<e.length;a++){const g=r.parse(e[a],a,Rn);if(!g)return null;h.push(g)}return new ar(o,h)}evaluate(e){for(let r=0;r<this.args.length;r++){const o=this.args[r].evaluate(e);if(!Ql(this.type,Bt(o)))return o;if(r===this.args.length-1)throw new Fi(`The expression ${JSON.stringify(this.args[r].serialize())} evaluated to ${$i(Bt(o))} but was expected to be of type ${$i(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){r.push(o.kind);const a=e.N;(typeof a=="number"||this.args.length>1)&&r.push(a)}}return r.concat(this.args.map(o=>o.serialize()))}}class Oc{constructor(e){this.type=Eu,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return r.error("First argument must be an image or text section.");const a=[];let u=!1;for(let h=1;h<=e.length-1;++h){const g=e[h];if(u&&typeof g=="object"&&!Array.isArray(g)){u=!1;let v=null;if(g["font-scale"]&&(v=r.parseObjectValue(g["font-scale"],h,"font-scale",Qt),!v))return null;let x=null;if(g["text-font"]&&(x=r.parseObjectValue(g["text-font"],h,"text-font",Ks(Pn)),!x))return null;let E=null;if(g["text-color"]&&(E=r.parseObjectValue(g["text-color"],h,"text-color",Ro),!E))return null;const A=a[a.length-1];A.scale=v,A.font=x,A.textColor=E}else{const v=r.parse(e[h],h,Rn);if(!v)return null;const x=v.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,a.push({content:v,scale:null,font:null,textColor:null})}}return new Oc(a)}evaluate(e){return new Js(this.sections.map(r=>{const o=r.content.evaluate(e);return hd(Bt(o),vh)?new dd("",o,null,null,null):new dd(zo(o),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const o={};r.scale&&(o["font-scale"]=r.scale.serialize()),r.font&&(o["text-font"]=r.font.serialize()),r.textColor&&(o["text-color"]=r.textColor.serialize()),e.push(o)}return e}}class Fc{constructor(e,r,o,a){this._imageWarnHistory={},this.type=vh,this.namePrimary=e,this.nameSecondary=r,o&&(this.paramsPrimary=o.params,this.iconsetIdPrimary=o.iconset?o.iconset.id:void 0),a&&(this.paramsSecondary=a.params,this.iconsetIdSecondary=a.iconset?a.iconset.id:void 0)}static parse(e,r){if(e.length<2)return r.error("Expected two or more arguments.");let o=1;const a=[];function u(){if(o<e.length){const g=r.parse(e[o],o++,Pn);return g?(a.push({image:g,options:{}}),!0):(r.error(a.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function h(){if(o<e.length){const v=e[o];if((g=v)===null||typeof g!="object"||Array.isArray(g))return!0;const x=v.params,E=v.iconset,A=r.concat(o);if(!x&&!E)return o++,!0;if(x){if(typeof x!="object"||x.constructor!==Object)return A.error('Image options "params" should be an object'),!1;const C={},k=A.concat(void 0,"params");for(const L in x){if(!L)return k.error("Image parameter name should be non-empty"),!1;const j=k.concat(void 0,L).parse(x[L],void 0,Ro,void 0,{typeAnnotation:"coerce"});if(!j)return!1;C[L]=j}a[a.length-1].options.params=C}if(E){if(typeof E!="object"||E.constructor!==Object)return A.error('Image options "iconset" should be an object'),!1;if(!E.id)return A.error('Image options "iconset" should have an "id" property'),!1;a[a.length-1].options.iconset=E}return o++,!0}var g;return!0}for(let g=0;g<2;g++)if(!u()||!h())return;return new Fc(a[0].image,a[1]?a[1].image:void 0,a[0].options,a[1]?a[1].options:void 0)}evaluateParams(e,r){const o={};if(r){for(const a in r)if(r[a])try{o[a]=r[a].evaluate(e)}catch{continue}if(Object.keys(o).length!==0)return{params:o}}}evaluate(e){const r={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},o=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,a=go.build(r,o,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(a&&e.availableImages){const u=a.getPrimary().id;if(a.available=e.availableImages.some(h=>Gs.isEqual(h,u)),a.available){const h=a.getSecondary()?a.getSecondary().id:null;h&&(a.available=e.availableImages.some(g=>Gs.isEqual(g,h)))}}return a}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const r in this.paramsPrimary)this.paramsPrimary[r]&&e(this.paramsPrimary[r]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const r in this.paramsSecondary)this.paramsSecondary[r]&&e(this.paramsSecondary[r])}outputDefined(){return!1}serializeOptions(e,r){const o={};if(r&&(o.iconset={id:r}),e){o.params={};for(const a in e)e[a]&&(o.params[a]=e[a].serialize())}return Object.keys(o).length>0?o:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const r=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);r&&e.push(r)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const r=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);r&&e.push(r)}return e}}function yl(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}const Nc={"to-boolean":Cn,"to-color":Ro,"to-number":Qt,"to-string":Pn};class ma{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[0],a=[];let u=Su;if(o==="to-array"){if(!Array.isArray(e[1]))return null;const h=e[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);u=Ks(r.expectedType.itemType,h)}else{if(!(h>0&&Gr(e[1][0])))return null;u=Ks(Bt(e[1][0]),h)}for(let g=0;g<h;g++){const v=e[1][g];let x;if(yl(v)==="array")x=r.parse(v,void 0,u.itemType);else{const E=yl(v);if(E!==u.itemType.kind)return r.error(`Expected ${u.itemType.kind} but found ${E}.`);x=r.registry.literal.parse(["literal",v===void 0?null:v],r)}if(!x)return null;a.push(x)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return r.error("Expected one argument.");u=Nc[o];for(let h=1;h<e.length;h++){const g=r.parse(e[h],h,Rn);if(!g)return null;a.push(g)}}return new ma(u,a)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,o;for(const a of this.args){if(r=a.evaluate(e),o=null,r instanceof _n)return r;if(typeof r=="string"){const u=e.parseColor(r);if(u)return u}else if(Array.isArray(r)&&(o=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Lc(r[0],r[1],r[2],r[3]),!o))return new _n(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Fi(o||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const o of this.args){if(r=o.evaluate(e),r===null)return 0;const a=Number(r);if(!isNaN(a))return a}throw new Fi(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Js.fromString(zo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?go.build(zo(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(r=>r.evaluate(e)):zo(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Oc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Fc(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const Qs=["Unknown","Point","LineString","Polygon"];class wh{constructor(e,r){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=r}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Qs[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:o,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*r-e[0])+this.featureDistanceData.bearing[1]*(a*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=_n.parse(e)),r}getConfig(e){return this.options?this.options.get(e):null}}class is{constructor(e,r,o,a,u){this.name=e,this.type=r,this._evaluate=o,this.args=a,this._overloadIndex=u}evaluate(e){if(!this._evaluate){const r=is.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const o=e[0],a=is.definitions[o];if(!a)return r.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(a)?a[0]:a.type,h=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,g=[];let v=null,x=-1;for(const[E,A]of h){if(Array.isArray(E)&&E.length!==e.length-1)continue;g.push(E),x++,v=new Ou(r.registry,r.path,null,r.scope,void 0,r._scope,r.options);const C=[];let k=!1;for(let L=1;L<e.length;L++){const j=e[L],G=Array.isArray(E)?E[L-1]:E.type,K=v.parse(j,1+C.length,G);if(!K){k=!0;break}C.push(K)}if(!k)if(Array.isArray(E)&&E.length!==C.length)v.error(`Expected ${E.length} arguments, but found ${C.length} instead.`);else{for(let L=0;L<C.length;L++){const j=Array.isArray(E)?E[L]:E.type,G=C[L];v.concat(L+1).checkSubtype(j,G.type)}if(v.errors.length===0)return new is(o,u,A,C,x)}}if(g.length===1)r.errors.push(...v.errors);else{const E=(g.length?g:h.map(([C])=>C)).map(fd).join(" | "),A=[];for(let C=1;C<e.length;C++){const k=r.parse(e[C],1+A.length);if(!k)return null;A.push($i(k.type))}r.error(`Expected arguments of type ${E}, but found (${A.join(", ")}) instead.`)}return null}static register(e,r){is.definitions=r;for(const o in r)e[o]=is}}function fd(n){return Array.isArray(n)?`(${n.map($i).join(", ")})`:`(${$i(n.type)}...)`}class ko{constructor(e,r,o){this.type=ud,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return r.error("Collator options argument must be an object.");const a=o["case-sensitive"]===void 0?r.parse(!1,1,Cn):r.parseObjectValue(o["case-sensitive"],1,"case-sensitive",Cn);if(!a)return null;const u=o["diacritic-sensitive"]===void 0?r.parse(!1,1,Cn):r.parseObjectValue(o["diacritic-sensitive"],1,"diacritic-sensitive",Cn);if(!u)return null;let h=null;return o.locale&&(h=r.parseObjectValue(o.locale,1,"locale",Pn),!h)?null:new ko(a,u,h)}evaluate(e){return new Iu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function ss(n,e,r=0,o=n.length-1,a=pd){for(;o>r;){if(o-r>600){const v=o-r+1,x=e-r+1,E=Math.log(v),A=.5*Math.exp(2*E/3),C=.5*Math.sqrt(E*A*(v-A)/v)*(x-v/2<0?-1:1);ss(n,e,Math.max(r,Math.floor(e-x*A/v+C)),Math.min(o,Math.floor(e+(v-x)*A/v+C)),a)}const u=n[e];let h=r,g=o;for(bh(n,r,e),a(n[o],u)>0&&bh(n,r,o);h<g;){for(bh(n,h,g),h++,g--;a(n[h],u)<0;)h++;for(;a(n[g],u)>0;)g--}a(n[r],u)===0?bh(n,r,g):(g++,bh(n,g,o)),g<=e&&(r=g+1),e<=g&&(o=g-1)}}function bh(n,e,r){const o=n[e];n[e]=n[r],n[r]=o}function pd(n,e){return n<e?-1:n>e?1:0}function gm(n){let e=0;for(let r,o,a=0,u=n.length,h=u-1;a<u;h=a++)r=n[a],o=n[h],e+=(o.x-r.x)*(r.y+o.y);return e}function vl(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function tc(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function xl(n,e,r){const o=n[0]-e[0],a=n[1]-e[1],u=n[0]-r[0],h=n[1]-r[1];return o*h-u*a==0&&o*u<=0&&a*h<=0}function Bc(n,e,r=!1){let o=!1;for(let g=0,v=e.length;g<v;g++){const x=e[g];for(let E=0,A=x.length,C=A-1;E<A;C=E++){const k=x[C],L=x[E];if(xl(n,k,L))return r;(u=k)[1]>(a=n)[1]!=(h=L)[1]>a[1]&&a[0]<(h[0]-u[0])*(a[1]-u[1])/(h[1]-u[1])+u[0]&&(o=!o)}}var a,u,h;return o}function vf(n,e,r,o){const a=o[0]-r[0],u=o[1]-r[1],h=(n[0]-r[0])*u-a*(n[1]-r[1]),g=(e[0]-r[0])*u-a*(e[1]-r[1]);return h>0&&g<0||h<0&&g>0}function Th(n,e,r,o){return(a=[o[0]-r[0],o[1]-r[1]])[0]*(u=[e[0]-n[0],e[1]-n[1]])[1]-a[1]*u[0]!=0&&!(!vf(n,e,r,o)||!vf(r,o,n,e));var a,u}function xf(n){const e=new ft(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=new ft(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const o of n[0])e.x>o.x&&(e.x=o.x),e.y>o.y&&(e.y=o.y),r.x<o.x&&(r.x=o.x),r.y<o.y&&(r.y=o.y);return{min:e,max:r}}const wl=8192;function _m(n,e){const r=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(r*a*wl),Math.round(o*a*wl)]}function ym(n,e){for(let r=0;r<e.length;r++)if(Bc(n,e[r]))return!0;return!1}function xp(n,e,r){for(const o of r)for(let a=0,u=o.length,h=u-1;a<u;h=a++)if(Th(n,e,o[h],o[a]))return!0;return!1}function ga(n,e){for(let r=0;r<n.length;++r)if(!Bc(n[r],e))return!1;for(let r=0;r<n.length-1;++r)if(xp(n[r],n[r+1],e))return!1;return!0}function Ea(n,e){for(let r=0;r<e.length;r++)if(ga(n,e[r]))return!0;return!1}function md(n,e,r){const o=[];for(let a=0;a<n.length;a++){const u=[];for(let h=0;h<n[a].length;h++){const g=_m(n[a][h],r);vl(e,g),u.push(g)}o.push(u)}return o}function wf(n,e,r){const o=[];for(let a=0;a<n.length;a++){const u=md(n[a],e,r);o.push(u)}return o}function Sh(n,e,r,o){if(n[0]<r[0]||n[0]>r[2]){const a=.5*o;let u=n[0]-r[0]>a?-o:r[0]-n[0]>a?o:0;u===0&&(u=n[0]-r[2]>a?-o:r[2]-n[0]>a?o:0),n[0]+=u}vl(e,n)}function gd(n,e,r,o){const a=Math.pow(2,o.z)*wl,u=[o.x*wl,o.y*wl],h=[];if(!n)return h;for(const g of n)for(const v of g){const x=[v.x+u[0],v.y+u[1]];Sh(x,e,r,a),h.push(x)}return h}function Eh(n,e,r,o){const a=Math.pow(2,o.z)*wl,u=[o.x*wl,o.y*wl],h=[];if(!n)return h;for(const v of n){const x=[];for(const E of v){const A=[E.x+u[0],E.y+u[1]];vl(e,A),x.push(A)}h.push(x)}if(e[2]-e[0]<=a/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const v of h)for(const x of v)Sh(x,e,r,a)}var g;return h}class qs{constructor(e,r){this.type=Cn,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Gr(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let a=0;a<o.features.length;++a){const u=o.features[a].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new qs(o,o.features[a].geometry)}else if(o.type==="Feature"){const a=o.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new qs(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new qs(o,o)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,o){const a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],h=r.canonicalID();if(!h)return!1;if(o.type==="Polygon"){const g=md(o.coordinates,u,h),v=gd(r.geometry(),a,u,h);if(!tc(a,u))return!1;for(const x of v)if(!Bc(x,g))return!1}if(o.type==="MultiPolygon"){const g=wf(o.coordinates,u,h),v=gd(r.geometry(),a,u,h);if(!tc(a,u))return!1;for(const x of v)if(!ym(x,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,o){const a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],h=r.canonicalID();if(!h)return!1;if(o.type==="Polygon"){const g=md(o.coordinates,u,h),v=Eh(r.geometry(),a,u,h);if(!tc(a,u))return!1;for(const x of v)if(!ga(x,g))return!1}if(o.type==="MultiPolygon"){const g=wf(o.coordinates,u,h),v=Eh(r.geometry(),a,u,h);if(!tc(a,u))return!1;for(const x of v)if(!Ea(x,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Ih={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},rc=1/298.257223563,Ah=rc*(2-rc),ja=Math.PI/180;class nc{static fromTile(e,r,o){const a=Math.PI*(1-2*(e+.5)/Math.pow(2,r)),u=Math.atan(.5*(Math.exp(a)-Math.exp(-a)))/ja;return new nc(u,o)}static get units(){return Ih}constructor(e,r){if(e===void 0)throw new Error("No latitude given.");if(r&&!Ih[r])throw new Error(`Unknown unit ${r}. Use one of: ${Object.keys(Ih).join(", ")}`);const o=6378.137*ja*(r?Ih[r]:1),a=Math.cos(e*ja),u=1/(1-Ah*(1-a*a)),h=Math.sqrt(u);this.kx=o*h*a,this.ky=o*h*u*(1-Ah)}distance(e,r){const o=Os(e[0]-r[0])*this.kx,a=(e[1]-r[1])*this.ky;return Math.sqrt(o*o+a*a)}bearing(e,r){const o=Os(r[0]-e[0])*this.kx;return Math.atan2(o,(r[1]-e[1])*this.ky)/ja}destination(e,r,o){const a=o*ja;return this.offset(e,Math.sin(a)*r,Math.cos(a)*r)}offset(e,r,o){return[e[0]+r/this.kx,e[1]+o/this.ky]}lineDistance(e){let r=0;for(let o=0;o<e.length-1;o++)r+=this.distance(e[o],e[o+1]);return r}area(e){let r=0;for(let o=0;o<e.length;o++){const a=e[o];for(let u=0,h=a.length,g=h-1;u<h;g=u++)r+=Os(a[u][0]-a[g][0])*(a[u][1]+a[g][1])*(o?-1:1)}return Math.abs(r)/2*this.kx*this.ky}along(e,r){let o=0;if(r<=0)return e[0];for(let a=0;a<e.length-1;a++){const u=e[a],h=e[a+1],g=this.distance(u,h);if(o+=g,o>r)return jc(u,h,(r-(o-g))/g)}return e[e.length-1]}pointToSegmentDistance(e,r,o){let[a,u]=r,h=Os(o[0]-a)*this.kx,g=(o[1]-u)*this.ky;if(h!==0||g!==0){const v=(Os(e[0]-a)*this.kx*h+(e[1]-u)*this.ky*g)/(h*h+g*g);v>1?(a=o[0],u=o[1]):v>0&&(a+=h/this.kx*v,u+=g/this.ky*v)}return h=Os(e[0]-a)*this.kx,g=(e[1]-u)*this.ky,Math.sqrt(h*h+g*g)}pointOnLine(e,r){let o=1/0,a=e[0][0],u=e[0][1],h=0,g=0;for(let v=0;v<e.length-1;v++){let x=e[v][0],E=e[v][1],A=Os(e[v+1][0]-x)*this.kx,C=(e[v+1][1]-E)*this.ky,k=0;A===0&&C===0||(k=(Os(r[0]-x)*this.kx*A+(r[1]-E)*this.ky*C)/(A*A+C*C),k>1?(x=e[v+1][0],E=e[v+1][1]):k>0&&(x+=A/this.kx*k,E+=C/this.ky*k)),A=Os(r[0]-x)*this.kx,C=(r[1]-E)*this.ky;const L=A*A+C*C;L<o&&(o=L,a=x,u=E,h=v,g=k)}return{point:[a,u],index:h,t:Math.max(0,Math.min(1,g))}}lineSlice(e,r,o){let a=this.pointOnLine(o,e),u=this.pointOnLine(o,r);if(a.index>u.index||a.index===u.index&&a.t>u.t){const x=a;a=u,u=x}const h=[a.point],g=a.index+1,v=u.index;!_d(o[g],h[0])&&g<=v&&h.push(o[g]);for(let x=g+1;x<=v;x++)h.push(o[x]);return _d(o[v],u.point)||h.push(u.point),h}lineSliceAlong(e,r,o){let a=0;const u=[];for(let h=0;h<o.length-1;h++){const g=o[h],v=o[h+1],x=this.distance(g,v);if(a+=x,a>e&&u.length===0&&u.push(jc(g,v,(e-(a-x))/x)),a>=r)return u.push(jc(g,v,(r-(a-x))/x)),u;a>e&&u.push(v)}return u}bufferPoint(e,r){const o=r/this.ky,a=r/this.kx;return[e[0]-a,e[1]-o,e[0]+a,e[1]+o]}bufferBBox(e,r){const o=r/this.ky,a=r/this.kx;return[e[0]-a,e[1]-o,e[2]+a,e[3]+o]}insideBBox(e,r){return Os(e[0]-r[0])>=0&&Os(e[0]-r[2])<=0&&e[1]>=r[1]&&e[1]<=r[3]}}function _d(n,e){return n[0]===e[0]&&n[1]===e[1]}function jc(n,e,r){const o=Os(e[0]-n[0]);return[n[0]+o*r,n[1]+(e[1]-n[1])*r]}function Os(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}class Cu{constructor(e=[],r=(o,a)=>o<a?-1:o>a?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:o}=this,a=r[e];for(;e>0;){const u=e-1>>1,h=r[u];if(o(a,h)>=0)break;r[e]=h,e=u}r[e]=a}_down(e){const{data:r,compare:o}=this,a=this.length>>1,u=r[e];for(;e<a;){let h=1+(e<<1);const g=h+1;if(g<this.length&&o(r[g],r[h])<0&&(h=g),o(r[h],u)>=0)break;r[e]=r[h],e=h}r[e]=u}}var Ct=8192;function Mu(n,e){return e.dist-n.dist}const Vc=100,Uc=50;function Pu(n){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==n[r])return!1;return!0}function Ru(n){return n[1]-n[0]+1}function Ia(n,e){const r=n[1]>=n[0]&&n[1]<e;return r||console.warn("Distance Expression: Index is out of range"),r}function Ch(n,e){if(n[0]>n[1])return[null,null];const r=Ru(n);if(e){if(r===2)return[n,null];const o=Math.floor(r/2);return[[n[0],n[0]+o],[n[0]+o,n[1]]]}{if(r===1)return[n,null];const o=Math.floor(r/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}}function Ss(n,e){const r=[1/0,1/0,-1/0,-1/0];if(!Ia(e,n.length))return r;for(let o=e[0];o<=e[1];++o)vl(r,n[o]);return r}function tn(n){const e=[1/0,1/0,-1/0,-1/0];for(let r=0;r<n.length;++r)for(let o=0;o<n[r].length;++o)vl(e,n[r][o]);return e}function ic(n,e,r){if(Pu(n)||Pu(e))return NaN;let o=0,a=0;return n[2]<e[0]&&(o=e[0]-n[2]),n[0]>e[2]&&(o=n[0]-e[2]),n[1]>e[3]&&(a=n[1]-e[3]),n[3]<e[1]&&(a=e[1]-n[3]),r.distance([0,0],[o,a])}function vm(n){return 360*n-180}function xm(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function sc(n,e){const r=Math.pow(2,e.z),o=(n.y/Ct+e.y)/r;return[vm((n.x/Ct+e.x)/r),xm(o)]}function wm(n,e){const r=[];for(let o=0;o<n.length;++o)r.push(sc(n[o],e));return r}function di(n,e,r){const o=r.pointOnLine(e,n).point;return r.distance(n,o)}function bf(n,e,r,o,a){const u=r.slice(o[0],o[1]+1);let h=1/0;for(let g=e[0];g<=e[1];++g)if((h=Math.min(h,di(n[g],u,a)))===0)return 0;return h}function zi(n,e,r,o,a){const u=Math.min(a.pointToSegmentDistance(n,r,o),a.pointToSegmentDistance(e,r,o)),h=Math.min(a.pointToSegmentDistance(r,n,e),a.pointToSegmentDistance(o,n,e));return Math.min(u,h)}function Tf(n,e,r,o,a){if(!Ia(e,n.length)||!Ia(o,r.length))return NaN;let u=1/0;for(let h=e[0];h<e[1];++h)for(let g=o[0];g<o[1];++g){if(Th(n[h],n[h+1],r[g],r[g+1]))return 0;u=Math.min(u,zi(n[h],n[h+1],r[g],r[g+1],a))}return u}function yd(n,e,r,o,a){if(!Ia(e,n.length)||!Ia(o,r.length))return NaN;let u=1/0;for(let h=e[0];h<=e[1];++h)for(let g=o[0];g<=o[1];++g)if((u=Math.min(u,a.distance(n[h],r[g])))===0)return u;return u}function Mh(n,e,r){if(Bc(n,e,!0))return 0;let o=1/0;for(const a of e){const u=a.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(a[0]!==a[u-1]&&(o=Math.min(o,r.pointToSegmentDistance(n,a[u-1],a[0])))===0||(o=Math.min(o,di(n,a,r)))===0)return o}return o}function wp(n,e,r,o){if(!Ia(e,n.length))return NaN;for(let u=e[0];u<=e[1];++u)if(Bc(n[u],r,!0))return 0;let a=1/0;for(let u=e[0];u<e[1];++u)for(const h of r)for(let g=0,v=h.length,x=v-1;g<v;x=g++){if(Th(n[u],n[u+1],h[x],h[g]))return 0;a=Math.min(a,zi(n[u],n[u+1],h[x],h[g],o))}return a}function vd(n,e){for(const r of n)for(let o=0;o<=r.length-1;++o)if(Bc(r[o],e,!0))return!0;return!1}function Ph(n,e,r,o=1/0){const a=tn(n),u=tn(e);if(o!==1/0&&ic(a,u,r)>=o)return o;if(tc(a,u)){if(vd(n,e))return 0}else if(vd(e,n))return 0;let h=o;for(const g of n)for(let v=0,x=g.length,E=x-1;v<x;E=v++)for(const A of e)for(let C=0,k=A.length,L=k-1;C<k;L=C++){if(Th(g[E],g[v],A[L],A[C]))return 0;h=Math.min(h,zi(g[E],g[v],A[L],A[C],r))}return h}function $c(n,e,r,o,a,u,h){if(u===null||h===null)return;const g=ic(Ss(o,u),Ss(a,h),r);g<e&&n.push({dist:g,range1:u,range2:h})}function zu(n,e,r,o,a=1/0){let u=Math.min(o.distance(n[0],r[0][0]),a);if(u===0)return u;const h=new Cu([{dist:0,range1:[0,n.length-1],range2:[0,0]}],Mu),g=e?Uc:Vc,v=tn(r);for(;h.length;){const x=h.pop();if(x.dist>=u)continue;const E=x.range1;if(Ru(E)<=g){if(!Ia(E,n.length))return NaN;if(e){const A=wp(n,E,r,o);if((u=Math.min(u,A))===0)return u}else for(let A=E[0];A<=E[1];++A){const C=Mh(n[A],r,o);if((u=Math.min(u,C))===0)return u}}else{const A=Ch(E,e);if(A[0]!==null){const C=ic(Ss(n,A[0]),v,o);C<u&&h.push({dist:C,range1:A[0],range2:[0,0]})}if(A[1]!==null){const C=ic(Ss(n,A[1]),v,o);C<u&&h.push({dist:C,range1:A[1],range2:[0,0]})}}}return u}function Sf(n,e,r,o,a,u=1/0){let h=Math.min(u,a.distance(n[0],r[0]));if(h===0)return h;const g=new Cu([{dist:0,range1:[0,n.length-1],range2:[0,r.length-1]}],Mu),v=e?Uc:Vc,x=o?Uc:Vc;for(;g.length;){const E=g.pop();if(E.dist>=h)continue;const A=E.range1,C=E.range2;if(Ru(A)<=v&&Ru(C)<=x){if(!Ia(A,n.length)||!Ia(C,r.length))return NaN;if(e&&o?h=Math.min(h,Tf(n,A,r,C,a)):e||o?e&&!o?h=Math.min(h,bf(r,C,n,A,a)):!e&&o&&(h=Math.min(h,bf(n,A,r,C,a))):h=Math.min(h,yd(n,A,r,C,a)),h===0)return h}else{const k=Ch(A,e),L=Ch(C,o);$c(g,h,a,n,r,k[0],L[0]),$c(g,h,a,n,r,k[0],L[1]),$c(g,h,a,n,r,k[1],L[0]),$c(g,h,a,n,r,k[1],L[1])}}return h}function Ef(n,e,r,o,a=1/0){let u=a;const h=Ss(n,[0,n.length-1]);for(const g of r)if(!(u!==1/0&&ic(h,Ss(g,[0,g.length-1]),o)>=u)&&(u=Math.min(u,Sf(n,e,g,!0,o,u)),u===0))return u;return u}function xd(n,e,r,o,a=1/0){let u=a;const h=Ss(n,[0,n.length-1]);for(const g of r){if(u!==1/0&&ic(h,tn(g),o)>=u)continue;const v=zu(n,e,g,o,u);if(isNaN(v))return v;if((u=Math.min(u,v))===0)return u}return u}function wd(n){return n==="Point"||n==="MultiPoint"||n==="LineString"||n==="MultiLineString"||n==="Polygon"||n==="MultiPolygon"}class Va{constructor(e,r){this.type=Qt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Gr(e[1])){const o=e[1];if(o.type==="FeatureCollection"){for(let a=0;a<o.features.length;++a)if(wd(o.features[a].geometry.type))return new Va(o,o.features[a].geometry)}else if(o.type==="Feature"){if(wd(o.geometry.type))return new Va(o,o.geometry)}else if(wd(o.type))return new Va(o,o)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const r=e.geometry(),o=e.canonicalID();if(r!=null&&o!=null){if(e.geometryType()==="Point")return function(a,u,h){const g=[];for(const x of a)for(const E of x)g.push(sc(E,u));const v=new nc(g[0][1],"meters");return h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString"?Sf(g,!1,h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",v):h.type==="MultiLineString"?Ef(g,!1,h.coordinates,v):h.type==="Polygon"||h.type==="MultiPolygon"?xd(g,!1,h.type==="Polygon"?[h.coordinates]:h.coordinates,v):null}(r,o,this.geometries);if(e.geometryType()==="LineString")return function(a,u,h){const g=[];for(const x of a){const E=[];for(const A of x)E.push(sc(A,u));g.push(E)}const v=new nc(g[0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return Ef(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",g,v);if(h.type==="MultiLineString"){let x=1/0;for(let E=0;E<h.coordinates.length;E++){const A=Ef(h.coordinates[E],!0,g,v,x);if(isNaN(A))return A;if((x=Math.min(x,A))===0)return x}return x}if(h.type==="Polygon"||h.type==="MultiPolygon"){let x=1/0;for(let E=0;E<g.length;E++){const A=xd(g[E],!0,h.type==="Polygon"?[h.coordinates]:h.coordinates,v,x);if(isNaN(A))return A;if((x=Math.min(x,A))===0)return x}return x}return null}(r,o,this.geometries);if(e.geometryType()==="Polygon")return function(a,u,h){const g=[];for(const x of function(E,A){const C=E.length;if(C<=1)return[E];const k=[];let L,j;for(let G=0;G<C;G++){const K=gm(E[G]);K!==0&&(E[G].area=Math.abs(K),j===void 0&&(j=K<0),j===K<0?(L&&k.push(L),L=[E[G]]):L.push(E[G]))}return L&&k.push(L),k}(a)){const E=[];for(let A=0;A<x.length;++A)E.push(wm(x[A],u));g.push(E)}const v=new nc(g[0][0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return xd(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",g,v);if(h.type==="MultiLineString"){let x=1/0;for(let E=0;E<h.coordinates.length;E++){const A=xd(h.coordinates[E],!0,g,v,x);if(isNaN(A))return A;if((x=Math.min(x,A))===0)return x}return x}return h.type==="Polygon"||h.type==="MultiPolygon"?function(x,E,A){let C=1/0;for(const k of x)for(const L of E){const j=Ph(k,L,A,C);if(isNaN(j))return j;if((C=Math.min(C,j))===0)return C}return C}(h.type==="Polygon"?[h.coordinates]:h.coordinates,g,v):null}(r,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function bl(n){if(n instanceof is&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof qs||n instanceof Va)return!1;if(n instanceof Lu)return n.featureConstant;let e=!0;return n.eachChild(r=>{e&&!bl(r)&&(e=!1)}),e}function ku(n){if(n instanceof is&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(r=>{e&&!ku(r)&&(e=!1)}),e}function Du(n){if(n instanceof Lu)return new Set([n.key]);let e=new Set;return n.eachChild(r=>{e=new Set([...e,...Du(r)])}),e}function oc(n,e){if(n instanceof is&&e.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(o=>{r&&!oc(o,e)&&(r=!1)}),r}function bd(n,e,r){return[n,e,r].filter(Boolean).join("")}function If(n,e){switch(n){case"string":return zo(e);case"number":return+e;case"boolean":return!!e;case"color":return _n.parse(e);case"formatted":return Js.fromString(zo(e));case"resolvedImage":return go.build(zo(e))}return e}function Af(n,e,r,o){return o!==void 0&&(n=o*Math.round(n/o)),e!==void 0&&n<e&&(n=e),r!==void 0&&n>r&&(n=r),n}class Lu{constructor(e,r,o,a=!1){this.type=e,this.key=r,this.scope=o,this.featureConstant=a}static parse(e,r){let o=r.expectedType;if(o==null&&(o=Rn),e.length<2||e.length>3)return r.error("Invalid number of arguments for 'config' expression.");const a=r.parse(e[1],1);if(!(a instanceof ur))return r.error("Key name of 'config' expression must be a string literal.");let u,h=!0;const g=zo(a.value);if(e.length>=3){const v=r.parse(e[2],2);if(!(v instanceof ur))return r.error("Scope of 'config' expression must be a string literal.");u=zo(v.value)}if(r.options){const v=bd(g,u,r._scope),x=r.options.get(v);x&&(h=bl(x.value||x.default))}return new Lu(o,g,u,h)}evaluate(e){const r=bd(this.key,this.scope,e.scope),o=e.getConfig(r);if(!o)return null;const{type:a,value:u,values:h,minValue:g,maxValue:v,stepValue:x}=o,E=o.default.evaluate(e);let A=E;if(u){const C=e.scope;e.scope=(C||"").split("").slice(1).join(""),A=u.evaluate(e),e.scope=C}return a&&(A=If(a,A)),A===void 0||g===void 0&&v===void 0&&x===void 0||(typeof A=="number"?A=Af(A,g,v,x):Array.isArray(A)&&(A=A.map(C=>typeof C=="number"?Af(C,g,v,x):C))),u!==void 0&&A!==void 0&&h&&!h.includes(A)&&(A=E,a&&(A=If(a,A))),(a&&a!==this.type||A!==void 0&&!hd(Bt(A),this.type))&&(A=If(this.type.kind,A)),A}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Td{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const o=e[1];return r.scope.has(o)?new Td(o,r.scope.get(o)):r.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ou{constructor(e,r=[],o,a=new yf,u=[],h,g){this.registry=e,this.path=r,this.key=r.map(v=>typeof v=="string"?`['${v}']`:`[${v}]`).join(""),this.scope=a,this.errors=u,this.expectedType=o,this._scope=h,this.options=g}parse(e,r,o,a,u={}){return r||o?this.concat(r,null,o,a)._parse(e,u):this._parse(e,u)}parseObjectValue(e,r,o,a,u,h={}){return this.concat(r,o,a,u)._parse(e,h)}_parse(e,r){function o(a,u,h){return h==="assert"?new ar(u,[a]):h==="coerce"?new ma(u,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(a){let u=a.parse(e,this);if(!u)return null;if(this.expectedType){const h=this.expectedType,g=u.type;if(h.kind!=="string"&&h.kind!=="number"&&h.kind!=="boolean"&&h.kind!=="object"&&h.kind!=="array"||g.kind!=="value")if(h.kind!=="color"&&h.kind!=="formatted"&&h.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string"){if(this.checkSubtype(h,g))return null}else u=o(u,h,r.typeAnnotation||"coerce");else u=o(u,h,r.typeAnnotation||"assert")}if(!(u instanceof ur)&&u.type.kind!=="resolvedImage"&&Ua(u)){const h=new wh(this._scope,this.options);try{u=new ur(u.type,u.evaluate(h))}catch(g){return this.error(g.message),null}}return u}return ma.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,o,a){let u=typeof e=="number"?this.path.concat(e):this.path;u=typeof r=="string"?u.concat(r):u;const h=a?this.scope.concat(a):this.scope;return new Ou(this.registry,u,o||null,h,this.errors,this._scope,this.options)}error(e,...r){const o=`${this.key}${r.map(a=>`[${a}]`).join("")}`;this.errors.push(new Po(o,e))}checkSubtype(e,r){const o=Ql(e,r);return o&&this.error(o),o}}function Ua(n){if(n instanceof Td)return Ua(n.boundExpression);if(n instanceof is&&n.name==="error"||n instanceof ko||n instanceof qs||n instanceof Va||n instanceof Lu)return!1;const e=n instanceof ma||n instanceof ar;let r=!0;return n.eachChild(o=>{r=e?r&&Ua(o):r&&o instanceof ur}),!!r&&bl(n)&&oc(n,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Rh(n,e){const r=n.length-1;let o,a,u=0,h=r,g=0;for(;u<=h;)if(g=Math.floor((u+h)/2),o=n[g],a=n[g+1],o<=e){if(g===r||e<a)return g;u=g+1}else{if(!(o>e))throw new Fi("Input is not a number.");h=g-1}return 0}class $a{constructor(e,r,o){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[a,u]of o)this.labels.push(a),this.outputs.push(u)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const o=r.parse(e[1],1,Qt);if(!o)return null;const a=[];let u=null;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);for(let h=1;h<e.length;h+=2){const g=h===1?-1/0:e[h],v=e[h+1],x=h,E=h+1;if(typeof g!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(a.length&&a[a.length-1][0]>=g)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);const A=r.parse(v,E,u);if(!A)return null;u=u||A.type,a.push([g,A])}return new $a(u,o,a)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const a=this.input.evaluate(e);if(a<=r[0])return o[0].evaluate(e);const u=r.length;return a>=r[u-1]?o[u-1].evaluate(e):o[Rh(r,a)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}const Aa=.95047,Fu=1.08883,Ga=4/29,qa=6/29,bp=3*qa*qa,Tp=qa*qa*qa,Gc=Math.PI/180,zh=180/Math.PI;function ac(n){return n>Tp?Math.pow(n,1/3):n/bp+Ga}function qc(n){return n>qa?n*n*n:bp*(n-Ga)}function Nu(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Jo(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Ha(n){const e=Jo(n.r),r=Jo(n.g),o=Jo(n.b),a=ac((.4124564*e+.3575761*r+.1804375*o)/Aa),u=ac((.2126729*e+.7151522*r+.072175*o)/1);return{l:116*u-16,a:500*(a-u),b:200*(u-ac((.0193339*e+.119192*r+.9503041*o)/Fu)),alpha:n.a}}function ki(n){let e=(n.l+16)/116,r=isNaN(n.a)?e:e+n.a/500,o=isNaN(n.b)?e:e-n.b/200;return e=1*qc(e),r=Aa*qc(r),o=Fu*qc(o),new _n(Nu(3.2404542*r-1.5371385*e-.4985314*o),Nu(-.969266*r+1.8760108*e+.041556*o),Nu(.0556434*r-.2040259*e+1.0572252*o),n.alpha)}function Di(n,e,r){const o=e-n;return n+r*(o>180||o<-180?o-360*Math.round(o/360):o)}const Do={forward:Ha,reverse:ki,interpolate:function(n,e,r){return{l:lr(n.l,e.l,r),a:lr(n.a,e.a,r),b:lr(n.b,e.b,r),alpha:lr(n.alpha,e.alpha,r)}}},Ki={forward:function(n){const{l:e,a:r,b:o}=Ha(n),a=Math.atan2(o,r)*zh;return{h:a<0?a+360:a,c:Math.sqrt(r*r+o*o),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Gc,r=n.c;return ki({l:n.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:n.alpha})},interpolate:function(n,e,r){return{h:Di(n.h,e.h,r),c:lr(n.c,e.c,r),l:lr(n.l,e.l,r),alpha:lr(n.alpha,e.alpha,r)}}};var _o=Object.freeze({__proto__:null,hcl:Ki,lab:Do});class Es{constructor(e,r,o,a,u){this.type=e,this.operator=r,this.interpolation=o,this.input=a,this.labels=[],this.outputs=[];for(const[h,g]of u)this.labels.push(h),this.outputs.push(g)}static interpolationFactor(e,r,o,a){let u=0;if(e.name==="exponential")u=Tl(r,e.base,o,a);else if(e.name==="linear")u=Tl(r,1,o,a);else if(e.name==="cubic-bezier"){const h=e.controlPoints;u=new Ri(h[0],h[1],h[2],h[3]).solve(Tl(r,1,o,a))}return u}static parse(e,r){let[o,a,u,...h]=e;if(!Array.isArray(a)||a.length===0)return r.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){const x=a[1];if(typeof x!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:x}}else{if(a[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const x=a.slice(1);if(x.length!==4||x.some(E=>typeof E!="number"||E<0||E>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:x}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(u=r.parse(u,2,Qt),!u)return null;const g=[];let v=null;o==="interpolate-hcl"||o==="interpolate-lab"?v=Ro:r.expectedType&&r.expectedType.kind!=="value"&&(v=r.expectedType);for(let x=0;x<h.length;x+=2){const E=h[x],A=h[x+1],C=x+3,k=x+4;if(typeof E!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(g.length&&g[g.length-1][0]>=E)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',C);const L=r.parse(A,k,v);if(!L)return null;v=v||L.type,g.push([E,L])}return v.kind==="number"||v.kind==="color"||v.kind==="array"&&v.itemType.kind==="number"&&typeof v.N=="number"?new Es(v,o,a,u,g):r.error(`Type ${$i(v)} is not interpolatable.`)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const a=this.input.evaluate(e);if(a<=r[0])return o[0].evaluate(e);const u=r.length;if(a>=r[u-1])return o[u-1].evaluate(e);const h=Rh(r,a),g=Es.interpolationFactor(this.interpolation,a,r[h],r[h+1]),v=o[h].evaluate(e),x=o[h+1].evaluate(e);return this.operator==="interpolate"?ml[this.type.kind.toLowerCase()](v,x,g):this.operator==="interpolate-hcl"?Ki.reverse(Ki.interpolate(Ki.forward(v),Ki.forward(x),g)):Do.reverse(Do.interpolate(Do.forward(v),Do.forward(x),g))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const r=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)r.push(this.labels[o],this.outputs[o].serialize());return r}}function Tl(n,e,r,o){const a=o-r,u=n-r;return a===0?0:e===1?u/a:(Math.pow(e,u)-1)/(Math.pow(e,a)-1)}class Fs{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let o=null;const a=r.expectedType;a&&a.kind!=="value"&&(o=a);const u=[];for(const g of e.slice(1)){const v=r.parse(g,1+u.length,o,void 0,{typeAnnotation:"omit"});if(!v)return null;o=o||v.type,u.push(v)}const h=a&&u.some(g=>Ql(a,g.type));return new Fs(h?Rn:o,u)}evaluate(e){let r,o=null,a=0;for(const u of this.args){if(a++,o=u.evaluate(e),o&&o instanceof go&&!o.available&&(r||(r=o),o=null,a===this.args.length))return r;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Hc{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let u=1;u<e.length-1;u+=2){const h=e[u];if(typeof h!="string")return r.error(`Expected string, but found ${typeof h} instead.`,u);if(/[^a-zA-Z0-9_]/.test(h))return r.error("Variable names must contain only alphanumeric characters or '_'.",u);const g=r.parse(e[u+1],u+1);if(!g)return null;o.push([h,g])}const a=r.parse(e[e.length-1],e.length-1,r.expectedType,o);return a?new Hc(o,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,o]of this.bindings)e.push(r,o.serialize());return e.push(this.result.serialize()),e}}class Sd{constructor(e,r,o){this.type=e,this.index=r,this.input=o}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Qt),a=r.parse(e[2],2,Ks(r.expectedType||Rn));return o&&a?new Sd(a.type.itemType,o,a):null}evaluate(e){const r=this.index.evaluate(e),o=this.input.evaluate(e);if(r<0)throw new Fi(`Array index out of bounds: ${r} < 0.`);if(r>=o.length)throw new Fi(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r!==Math.floor(r))throw new Fi(`Array index must be an integer, but found ${r} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return o[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ed{constructor(e,r,o){this.type=e,this.index=r,this.input=o}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Qt),a=r.parse(e[2],2,Ks(r.expectedType||Rn));return o&&a?new Ed(a.type.itemType,o,a):null}evaluate(e){const r=this.index.evaluate(e),o=this.input.evaluate(e);if(r<0)throw new Fi(`Array index out of bounds: ${r} < 0.`);if(r>o.length-1)throw new Fi(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r===Math.floor(r))return o[r];const a=Math.floor(r),u=Math.ceil(r),h=o[a],g=o[u];if(typeof h!="number"||typeof g!="number")throw new Fi(`Cannot interpolate between non-number values at index ${r}.`);const v=r-a;return h*(1-v)+g*v}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Wc{constructor(e,r){this.type=Cn,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Rn),a=r.parse(e[2],2,Rn);return o&&a?ec(o.type,[Cn,Pn,Qt,Su,Rn])?new Wc(o,a):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${$i(o.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!xh(r,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${$i(Bt(r))} instead.`);if(!xh(o,["string","array"]))throw new Fi(`Expected second argument to be of type array or string, but found ${$i(Bt(o))} instead.`);return o.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Bu{constructor(e,r,o){this.type=Qt,this.needle=e,this.haystack=r,this.fromIndex=o}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Rn),a=r.parse(e[2],2,Rn);if(!o||!a)return null;if(!ec(o.type,[Cn,Pn,Qt,Su,Rn]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${$i(o.type)} instead`);if(e.length===4){const u=r.parse(e[3],3,Qt);return u?new Bu(o,a,u):null}return new Bu(o,a)}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!xh(r,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${$i(Bt(r))} instead.`);if(!xh(o,["string","array"]))throw new Fi(`Expected second argument to be of type array or string, but found ${$i(Bt(o))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return o.indexOf(r,a)}return o.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Lo{constructor(e,r,o,a,u,h){this.inputType=e,this.type=r,this.input=o,this.cases=a,this.outputs=u,this.otherwise=h}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let o,a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const u={},h=[];for(let x=2;x<e.length-1;x+=2){let E=e[x];const A=e[x+1];Array.isArray(E)||(E=[E]);const C=r.concat(x);if(E.length===0)return C.error("Expected at least one branch label.");for(const L of E){if(typeof L!="number"&&typeof L!="string")return C.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return C.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return C.error("Numeric branch labels must be integer values.");if(o){if(C.checkSubtype(o,Bt(L)))return null}else o=Bt(L);if(u[String(L)]!==void 0)return C.error("Branch labels must be unique.");u[String(L)]=h.length}const k=r.parse(A,x,a);if(!k)return null;a=a||k.type,h.push(k)}const g=r.parse(e[1],1,Rn);if(!g)return null;const v=r.parse(e[e.length-1],e.length-1,a);return v?g.type.kind!=="value"&&r.concat(1).checkSubtype(o,g.type)?null:new Lo(o,a,g,u,h,v):null}evaluate(e){const r=this.input.evaluate(e);return(hd(Bt(r),this.inputType)&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),o=[],a={};for(const h of r){const g=a[this.cases[h]];g===void 0?(a[this.cases[h]]=o.length,o.push([this.cases[h],[h]])):o[g][1].push(h)}const u=h=>this.inputType.kind==="number"?Number(h):h;for(const[h,g]of o)e.push(g.length===1?u(g[0]):g.map(u)),e.push(this.outputs[h].serialize());return e.push(this.otherwise.serialize()),e}}class ju{constructor(e,r,o){this.type=e,this.branches=r,this.otherwise=o}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const a=[];for(let h=1;h<e.length-1;h+=2){const g=r.parse(e[h],h,Cn);if(!g)return null;const v=r.parse(e[h+1],h+1,o);if(!v)return null;a.push([g,v]),o=o||v.type}const u=r.parse(e[e.length-1],e.length-1,o);return u?new ju(o,a,u):null}evaluate(e){for(const[r,o]of this.branches)if(r.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,o]of this.branches)e(r),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Zc{constructor(e,r,o,a){this.type=e,this.input=r,this.beginIndex=o,this.endIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Rn),a=r.parse(e[2],2,Qt);if(!o||!a)return null;if(!ec(o.type,[Ks(Rn),Pn,Rn]))return r.error(`Expected first argument to be of type array or string, but found ${$i(o.type)} instead`);if(e.length===4){const u=r.parse(e[3],3,Qt);return u?new Zc(o.type,o,a,u):null}return new Zc(o.type,o,a)}evaluate(e){const r=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!xh(r,["string","array"]))throw new Fi(`Expected first argument to be of type array or string, but found ${$i(Bt(r))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return r.slice(o,a)}return r.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Cf(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Sp(n,e,r,o){return o.compare(e,r)===0}function Oo(n,e,r){const o=n!=="=="&&n!=="!=";return class SI{constructor(u,h,g){this.type=Cn,this.lhs=u,this.rhs=h,this.collator=g,this.hasUntypedArgument=u.type.kind==="value"||h.type.kind==="value"}static parse(u,h){if(u.length!==3&&u.length!==4)return h.error("Expected two or three arguments.");const g=u[0];let v=h.parse(u[1],1,Rn);if(!v)return null;if(!Cf(g,v.type))return h.concat(1).error(`"${g}" comparisons are not supported for type '${$i(v.type)}'.`);let x=h.parse(u[2],2,Rn);if(!x)return null;if(!Cf(g,x.type))return h.concat(2).error(`"${g}" comparisons are not supported for type '${$i(x.type)}'.`);if(v.type.kind!==x.type.kind&&v.type.kind!=="value"&&x.type.kind!=="value")return h.error(`Cannot compare types '${$i(v.type)}' and '${$i(x.type)}'.`);o&&(v.type.kind==="value"&&x.type.kind!=="value"?v=new ar(x.type,[v]):v.type.kind!=="value"&&x.type.kind==="value"&&(x=new ar(v.type,[x])));let E=null;if(u.length===4){if(v.type.kind!=="string"&&x.type.kind!=="string"&&v.type.kind!=="value"&&x.type.kind!=="value")return h.error("Cannot use collator to compare non-string types.");if(E=h.parse(u[3],3,ud),!E)return null}return new SI(v,x,E)}evaluate(u){const h=this.lhs.evaluate(u),g=this.rhs.evaluate(u);if(o&&this.hasUntypedArgument){const v=Bt(h),x=Bt(g);if(v.kind!==x.kind||v.kind!=="string"&&v.kind!=="number")throw new Fi(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${v.kind}, ${x.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const v=Bt(h),x=Bt(g);if(v.kind!=="string"||x.kind!=="string")return e(u,h,g)}return this.collator?r(u,h,g,this.collator.evaluate(u)):e(u,h,g)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[n];return this.eachChild(h=>{u.push(h.serialize())}),u}}}const Xc=Oo("==",function(n,e,r){return e===r},Sp),Vu=Oo("!=",function(n,e,r){return e!==r},function(n,e,r,o){return!Sp(0,e,r,o)}),Id=Oo("<",function(n,e,r){return e<r},function(n,e,r,o){return o.compare(e,r)<0}),Ad=Oo(">",function(n,e,r){return e>r},function(n,e,r,o){return o.compare(e,r)>0}),yo=Oo("<=",function(n,e,r){return e<=r},function(n,e,r,o){return o.compare(e,r)<=0}),_a=Oo(">=",function(n,e,r){return e>=r},function(n,e,r,o){return o.compare(e,r)>=0});class Wa{constructor(e,r,o,a,u,h){this.type=Pn,this.number=e,this.locale=r,this.currency=o,this.unit=a,this.minFractionDigits=u,this.maxFractionDigits=h}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const o=r.parse(e[1],1,Qt);if(!o)return null;const a=e[2];if(typeof a!="object"||Array.isArray(a))return r.error("NumberFormat options argument must be an object.");let u=null;if(a.locale&&(u=r.parseObjectValue(a.locale,2,"locale",Pn),!u))return null;let h=null;if(a.currency&&(h=r.parseObjectValue(a.currency,2,"currency",Pn),!h))return null;let g=null;if(a.unit&&(g=r.parseObjectValue(a.unit,2,"unit",Pn),!g))return null;let v=null;if(a["min-fraction-digits"]&&(v=r.parseObjectValue(a["min-fraction-digits"],2,"min-fraction-digits",Qt),!v))return null;let x=null;return a["max-fraction-digits"]&&(x=r.parseObjectValue(a["max-fraction-digits"],2,"max-fraction-digits",Qt),!x)?null:new Wa(o,u,h,g,v,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ca{constructor(e){this.type=Qt,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=r.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${$i(o.type)} instead.`):new Ca(o):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Fi(`Expected value to be of type string or array, but found ${$i(Bt(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}function Za(n){return function(){n=1831565813+(n|=0)|0;let e=Math.imul(n^n>>>15,1|n);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Qo={"==":Xc,"!=":Vu,">":Ad,"<":Id,">=":_a,"<=":yo,array:ar,at:Sd,"at-interpolated":Ed,boolean:ar,case:ju,coalesce:Fs,collator:ko,format:Oc,image:Fc,in:Wc,"index-of":Bu,interpolate:Es,"interpolate-hcl":Es,"interpolate-lab":Es,length:Ca,let:Hc,literal:ur,match:Lo,number:ar,"number-format":Wa,object:ar,slice:Zc,step:$a,string:ar,"to-boolean":ma,"to-color":ma,"to-number":ma,"to-string":ma,var:Td,within:qs,distance:Va,config:Lu};function Cd(n,[e,r,o,a]){e=e.evaluate(n),r=r.evaluate(n),o=o.evaluate(n);const u=a?a.evaluate(n):1,h=Lc(e,r,o,u);if(h)throw new Fi(h);return new _n(e/255,r/255,o/255,u)}function kh(n,[e,r,o,a]){e=e.evaluate(n),r=r.evaluate(n),o=o.evaluate(n);const u=a?a.evaluate(n):1,h=function(x,E,A,C){return typeof x=="number"&&x>=0&&x<=360?typeof E=="number"&&E>=0&&E<=100&&typeof A=="number"&&A>=0&&A<=100?C===void 0||typeof C=="number"&&C>=0&&C<=1?null:`Invalid hsla value [${[x,E,A,C].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof C=="number"?[x,E,A,C]:[x,E,A]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof C=="number"?[x,E,A,C]:[x,E,A]).join(", ")}]: 'h' must be between 0 and 360.`}(e,r,o,u);if(h)throw new Fi(h);const g=`hsla(${e}, ${r}%, ${o}%, ${u})`,v=_n.parse(g);if(!v)throw new Fi(`Failed to parse HSLA color: ${g}`);return v}function Md(n,e){return n in e}function fs(n,e){const r=e[n];return r===void 0?null:r}function Is(n){return{type:n}}function Ni(n){return{result:"success",value:n}}function Ns(n){return{result:"error",value:n}}function Dh(n,e){return!!n&&!!n.parameters&&n.parameters.indexOf(e)>-1}function Uu(n){return n["property-type"]==="data-driven"}function Lh(n){return Dh(n.expression,"measure-light")}function Oh(n){return Dh(n.expression,"zoom")}function $u(n){return!!n.expression&&n.expression.interpolated}function lc(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Mf(n){return n}function Yc(n,e){const r=e.type==="color",o=n.stops&&typeof n.stops[0][0]=="object",a=o||!(o||n.property!==void 0),u=n.type||($u(e)?"exponential":"interval");if(r&&((n=Ba({},n)).stops&&(n.stops=n.stops.map(x=>[x[0],_n.parse(x[1])])),n.default=_n.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!_o[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let h,g,v;if(u==="exponential")h=Gu;else if(u==="interval")h=Fh;else if(u==="categorical"){h=bm,g=Object.create(null);for(const x of n.stops)g[x[0]]=x[1];v=typeof n.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);h=Ep}if(o){const x={},E=[];for(let k=0;k<n.stops.length;k++){const L=n.stops[k],j=L[0].zoom;x[j]===void 0&&(x[j]={zoom:j,type:n.type,property:n.property,default:n.default,stops:[]},E.push(j)),x[j].stops.push([L[0].value,L[1]])}const A=[];for(const k of E)A.push([x[k].zoom,Yc(x[k],e)]);const C={name:"linear"};return{kind:"composite",interpolationType:C,interpolationFactor:Es.interpolationFactor.bind(void 0,C),zoomStops:A.map(k=>k[0]),evaluate:({zoom:k},L)=>Gu({stops:A,base:n.base},e,k).evaluate(k,L)}}if(a){const x=u==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:x,interpolationFactor:Es.interpolationFactor.bind(void 0,x),zoomStops:n.stops.map(E=>E[0]),evaluate:({zoom:E})=>h(n,e,E,g,v)}}return{kind:"source",evaluate(x,E){const A=E&&E.properties?E.properties[n.property]:void 0;return A===void 0?Fo(n.default,e.default):h(n,e,A,g,v)}}}function Fo(n,e,r){return n!==void 0?n:e!==void 0?e:r!==void 0?r:void 0}function bm(n,e,r,o,a){return Fo(typeof r===a?o[r]:void 0,n.default,e.default)}function Fh(n,e,r){if(yl(r)!=="number")return Fo(n.default,e.default);const o=n.stops.length;if(o===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[o-1][0])return n.stops[o-1][1];const a=Rh(n.stops.map(u=>u[0]),r);return n.stops[a][1]}function Gu(n,e,r){const o=n.base!==void 0?n.base:1;if(yl(r)!=="number")return Fo(n.default,e.default);const a=n.stops.length;if(a===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[a-1][0])return n.stops[a-1][1];const u=Rh(n.stops.map(E=>E[0]),r),h=function(E,A,C,k){const L=k-C,j=E-C;return L===0?0:A===1?j/L:(Math.pow(A,j)-1)/(Math.pow(A,L)-1)}(r,o,n.stops[u][0],n.stops[u+1][0]),g=n.stops[u][1],v=n.stops[u+1][1];let x=ml[e.type]||Mf;if(n.colorSpace&&n.colorSpace!=="rgb"){const E=_o[n.colorSpace];x=(A,C)=>E.reverse(E.interpolate(E.forward(A),E.forward(C),h))}return typeof g.evaluate=="function"?{evaluate(...E){const A=g.evaluate.apply(void 0,E),C=v.evaluate.apply(void 0,E);if(A!==void 0&&C!==void 0)return x(A,C,h)}}:x(g,v,h)}function Ep(n,e,r){return e.type==="color"?r=_n.parse(r):e.type==="formatted"?r=Js.fromString(r.toString()):e.type==="resolvedImage"?r=go.build(r.toString()):yl(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),Fo(r,n.default,e.default)}is.register(Qo,{error:[{kind:"error"},[Pn],(n,[e])=>{throw new Fi(e.evaluate(n))}],typeof:[Pn,[Rn],(n,[e])=>$i(Bt(e.evaluate(n)))],"to-rgba":[Ks(Qt,4),[Ro],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Ks(Qt,4),[Ro],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Ro,[Qt,Qt,Qt],Cd],rgba:[Ro,[Qt,Qt,Qt,Qt],Cd],hsl:[Ro,[Qt,Qt,Qt],kh],hsla:[Ro,[Qt,Qt,Qt,Qt],kh],has:{type:Cn,overloads:[[[Pn],(n,[e])=>Md(e.evaluate(n),n.properties())],[[Pn,gl],(n,[e,r])=>Md(e.evaluate(n),r.evaluate(n))]]},get:{type:Rn,overloads:[[[Pn],(n,[e])=>fs(e.evaluate(n),n.properties())],[[Pn,gl],(n,[e,r])=>fs(e.evaluate(n),r.evaluate(n))]]},"feature-state":[Rn,[Pn],(n,[e])=>fs(e.evaluate(n),n.featureState||{})],properties:[gl,[],n=>n.properties()],"geometry-type":[Pn,[],n=>n.geometryType()],worldview:[Pn,[],n=>n.globals.worldview||""],id:[Rn,[],n=>n.id()],zoom:[Qt,[],n=>n.globals.zoom],pitch:[Qt,[],n=>n.globals.pitch||0],"distance-from-center":[Qt,[],n=>n.distanceFromCenter()],"measure-light":[Qt,[Pn],(n,[e])=>n.measureLight(e.evaluate(n))],"heatmap-density":[Qt,[],n=>n.globals.heatmapDensity||0],"line-progress":[Qt,[],n=>n.globals.lineProgress||0],"raster-value":[Qt,[],n=>n.globals.rasterValue||0],"raster-particle-speed":[Qt,[],n=>n.globals.rasterParticleSpeed||0],"sky-radial-progress":[Qt,[],n=>n.globals.skyRadialProgress||0],accumulated:[Rn,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Qt,Is(Qt),(n,e)=>{let r=0;for(const o of e)r+=o.evaluate(n);return r}],"*":[Qt,Is(Qt),(n,e)=>{let r=1;for(const o of e)r*=o.evaluate(n);return r}],"-":{type:Qt,overloads:[[[Qt,Qt],(n,[e,r])=>e.evaluate(n)-r.evaluate(n)],[[Qt],(n,[e])=>-e.evaluate(n)]]},"/":[Qt,[Qt,Qt],(n,[e,r])=>e.evaluate(n)/r.evaluate(n)],"%":[Qt,[Qt,Qt],(n,[e,r])=>e.evaluate(n)%r.evaluate(n)],ln2:[Qt,[],()=>Math.LN2],pi:[Qt,[],()=>Math.PI],e:[Qt,[],()=>Math.E],"^":[Qt,[Qt,Qt],(n,[e,r])=>Math.pow(e.evaluate(n),r.evaluate(n))],sqrt:[Qt,[Qt],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Qt,[Qt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Qt,[Qt],(n,[e])=>Math.log(e.evaluate(n))],log2:[Qt,[Qt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Qt,[Qt],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Qt,[Qt],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Qt,[Qt],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Qt,[Qt],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Qt,[Qt],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Qt,[Qt],(n,[e])=>Math.atan(e.evaluate(n))],min:[Qt,Is(Qt),(n,e)=>Math.min(...e.map(r=>r.evaluate(n)))],max:[Qt,Is(Qt),(n,e)=>Math.max(...e.map(r=>r.evaluate(n)))],abs:[Qt,[Qt],(n,[e])=>Math.abs(e.evaluate(n))],round:[Qt,[Qt],(n,[e])=>{const r=e.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[Qt,[Qt],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Qt,[Qt],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Cn,[Pn,Rn],(n,[e,r])=>n.properties()[e.value]===r.value],"filter-id-==":[Cn,[Rn],(n,[e])=>n.id()===e.value],"filter-type-==":[Cn,[Pn],(n,[e])=>n.geometryType()===e.value],"filter-<":[Cn,[Pn,Rn],(n,[e,r])=>{const o=n.properties()[e.value],a=r.value;return typeof o==typeof a&&o<a}],"filter-id-<":[Cn,[Rn],(n,[e])=>{const r=n.id(),o=e.value;return typeof r==typeof o&&r<o}],"filter->":[Cn,[Pn,Rn],(n,[e,r])=>{const o=n.properties()[e.value],a=r.value;return typeof o==typeof a&&o>a}],"filter-id->":[Cn,[Rn],(n,[e])=>{const r=n.id(),o=e.value;return typeof r==typeof o&&r>o}],"filter-<=":[Cn,[Pn,Rn],(n,[e,r])=>{const o=n.properties()[e.value],a=r.value;return typeof o==typeof a&&o<=a}],"filter-id-<=":[Cn,[Rn],(n,[e])=>{const r=n.id(),o=e.value;return typeof r==typeof o&&r<=o}],"filter->=":[Cn,[Pn,Rn],(n,[e,r])=>{const o=n.properties()[e.value],a=r.value;return typeof o==typeof a&&o>=a}],"filter-id->=":[Cn,[Rn],(n,[e])=>{const r=n.id(),o=e.value;return typeof r==typeof o&&r>=o}],"filter-has":[Cn,[Rn],(n,[e])=>e.value in n.properties()],"filter-has-id":[Cn,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Cn,[Ks(Pn)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Cn,[Ks(Rn)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Cn,[Pn,Ks(Rn)],(n,[e,r])=>r.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Cn,[Pn,Ks(Rn)],(n,[e,r])=>function(o,a,u,h){for(;u<=h;){const g=u+h>>1;if(a[g]===o)return!0;a[g]>o?h=g-1:u=g+1}return!1}(n.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Cn,overloads:[[[Cn,Cn],(n,[e,r])=>e.evaluate(n)&&r.evaluate(n)],[Is(Cn),(n,e)=>{for(const r of e)if(!r.evaluate(n))return!1;return!0}]]},any:{type:Cn,overloads:[[[Cn,Cn],(n,[e,r])=>e.evaluate(n)||r.evaluate(n)],[Is(Cn),(n,e)=>{for(const r of e)if(r.evaluate(n))return!0;return!1}]]},"!":[Cn,[Cn],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Cn,[Pn],(n,[e])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(e.evaluate(n))}],upcase:[Pn,[Pn],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Pn,[Pn],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Pn,Is(Rn),(n,e)=>e.map(r=>zo(r.evaluate(n))).join("")],"resolved-locale":[Pn,[ud],(n,[e])=>e.evaluate(n).resolvedLocale()],random:[Qt,[Qt,Qt,Rn],(n,e)=>{const[r,o,a]=e.map(h=>h.evaluate(n));if(r>o||r===o)return r;let u;if(typeof a=="string")u=function(h){let g=0;if(h.length===0)return g;for(let v=0;v<h.length;v++)g=(g<<5)-g+h.charCodeAt(v),g|=0;return g}(a);else{if(typeof a!="number")throw new Fi(`Invalid seed input: ${a}`);u=a}return r+Za(u)()*(o-r)}]});class Kc{constructor(e,r,o,a){this.expression=e,this._warningHistory={},this._evaluator=new wh(o,a),this._defaultValue=r?function(u){return u.type==="color"&&(lc(u.default)||Array.isArray(u.default))?new _n(0,0,0,0):u.type==="color"?_n.parse(u.default)||null:u.default===void 0?null:u.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this.configDependencies=Du(e)}evaluateWithoutErrorHandling(e,r,o,a,u,h,g,v){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=o,this._evaluator.canonical=a||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=h,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=v||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,o,a,u,h,g,v){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=o||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=h||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=v||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Fi(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${x.message}`)),this._defaultValue}}}function Sl(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Qo}function Xa(n,e,r,o){const a=new Ou(Qo,[],e?function(h){const g={color:Ro,string:Pn,number:Qt,enum:Pn,boolean:Cn,formatted:Eu,resolvedImage:vh};return h.type==="array"?Ks(g[h.value]||Rn,h.length):g[h.type]}(e):void 0,void 0,void 0,r,o),u=a.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Ni(new Kc(u,e,r,o)):Ns(a.errors)}class cc{constructor(e,r,o,a){this.kind=e,this._styleExpression=r,this.isLightConstant=o,this.isLineProgressConstant=a,this.isStateDependent=e!=="constant"&&!ku(r.expression),this.configDependencies=Du(r.expression)}evaluateWithoutErrorHandling(e,r,o,a,u,h){return this._styleExpression.evaluateWithoutErrorHandling(e,r,o,a,u,h)}evaluate(e,r,o,a,u,h){return this._styleExpression.evaluate(e,r,o,a,u,h)}}class uc{constructor(e,r,o,a,u,h){this.kind=e,this.zoomStops=o,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!ku(r.expression),this.isLightConstant=u,this.isLineProgressConstant=h,this.configDependencies=Du(r.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,r,o,a,u,h){return this._styleExpression.evaluateWithoutErrorHandling(e,r,o,a,u,h)}evaluate(e,r,o,a,u,h){return this._styleExpression.evaluate(e,r,o,a,u,h)}interpolationFactor(e,r,o){return this.interpolationType?Es.interpolationFactor(this.interpolationType,e,r,o):0}}function Jc(n,e,r,o){if((n=Xa(n,e,r,o)).result==="error")return n;const a=n.value.expression,u=bl(a);if(!u&&!Uu(e))return Ns([new Po("","data expressions not supported")]);const h=oc(a,["zoom","pitch","distance-from-center"]);if(!h&&!Oh(e))return Ns([new Po("","zoom expressions not supported")]);const g=oc(a,["measure-light"]);if(!g&&!Lh(e))return Ns([new Po("","measure-light expression not supported")]);const v=oc(a,["line-progress"]);if(!v&&!function(A){return Dh(A.expression,"line-progress")}(e))return Ns([new Po("","line-progress expression not supported")]);const x=e.expression&&e.expression.relaxZoomRestriction,E=dc(a);return E||h||x?E instanceof Po?Ns([E]):E instanceof Es&&!$u(e)?Ns([new Po("",'"interpolate" expressions cannot be used with this property')]):Ni(E?new uc(u&&v?"camera":"composite",n.value,E.labels,E instanceof Es?E.interpolation:void 0,g,v):new cc(u&&v?"constant":"source",n.value,g,v)):Ns([new Po("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class hc{constructor(e,r){this._parameters=e,this._specification=r,Ba(this,Yc(this._parameters,this._specification))}static deserialize(e){return new hc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function dc(n){let e=null;if(n instanceof Hc)e=dc(n.result);else if(n instanceof Fs){for(const r of n.args)if(e=dc(r),e)break}else(n instanceof $a||n instanceof Es)&&n.input instanceof is&&n.input.name==="zoom"&&(e=n);return e instanceof Po||n.eachChild(r=>{const o=dc(r);o instanceof Po?e=o:e&&o&&e!==o&&(e=new Po("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var qu,Nh,fc=function(){if(Nh)return qu;Nh=1,qu=e;var n=3;function e(r,o,a){var u=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var h=new Int32Array(this.arrayBuffer);r=h[0],this.d=(o=h[1])+2*(a=h[2]);for(var g=0;g<this.d*this.d;g++){var v=h[n+g],x=h[n+g+1];u.push(v===x?null:h.subarray(v,x))}var E=h[n+u.length+1];this.keys=h.subarray(h[n+u.length],E),this.bboxes=h.subarray(E),this.insert=this._insertReadonly}else{this.d=o+2*a;for(var A=0;A<this.d*this.d;A++)u.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=r,this.padding=a,this.scale=o/r,this.uid=0;var C=a/o*r;this.min=-C,this.max=r+C}return e.prototype.insert=function(r,o,a,u,h){this._forEachCell(o,a,u,h,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(o),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(h)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(r,o,a,u,h,g){this.cells[h].push(g)},e.prototype.query=function(r,o,a,u,h){var g=this.min,v=this.max;if(r<=g&&o<=g&&v<=a&&v<=u&&!h)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(r,o,a,u,this._queryCell,x,{},h),x},e.prototype._queryCell=function(r,o,a,u,h,g,v,x){var E=this.cells[h];if(E!==null)for(var A=this.keys,C=this.bboxes,k=0;k<E.length;k++){var L=E[k];if(v[L]===void 0){var j=4*L;(x?x(C[j+0],C[j+1],C[j+2],C[j+3]):r<=C[j+2]&&o<=C[j+3]&&a>=C[j+0]&&u>=C[j+1])?(v[L]=!0,g.push(A[L])):v[L]=!1}}},e.prototype._forEachCell=function(r,o,a,u,h,g,v,x){for(var E=this._convertToCellCoord(r),A=this._convertToCellCoord(o),C=this._convertToCellCoord(a),k=this._convertToCellCoord(u),L=E;L<=C;L++)for(var j=A;j<=k;j++){var G=this.d*j+L;if((!x||x(this._convertFromCellCoord(L),this._convertFromCellCoord(j),this._convertFromCellCoord(L+1),this._convertFromCellCoord(j+1)))&&h.call(this,r,o,a,u,G,g,v,x))return}},e.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},e.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,o=n+this.cells.length+1+1,a=0,u=0;u<this.cells.length;u++)a+=this.cells[u].length;var h=new Int32Array(o+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var g=o,v=0;v<r.length;v++){var x=r[v];h[n+v]=g,h.set(x,g),g+=x.length}return h[n+r.length]=g,h.set(this.keys,g),h[n+r.length+1]=g+=this.keys.length,h.set(this.bboxes,g),g+=this.bboxes.length,h.buffer},qu}(),ps=Qr(fc);const vo={};function Ft(n,e,r={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writable:!1}),vo[e]={klass:n,omit:r.omit||[]}}Ft(Object,"Object"),ps.serialize=function(n,e){const r=n.toArrayBuffer();return e&&e.add(r),{buffer:r}},ps.deserialize=function(n){return new ps(n.buffer)},Object.defineProperty(ps,"name",{value:"Grid"}),Ft(ps,"Grid"),typeof DOMMatrix<"u"&&Ft(DOMMatrix,"DOMMatrix"),Ft(_n,"Color"),Ft(Error,"Error"),Ft(Js,"Formatted"),Ft(dd,"FormattedSection"),Ft(gn,"AJAXError"),Ft(go,"ResolvedImage"),Ft(hc,"StylePropertyFunction"),Ft(Kc,"StyleExpression",{omit:["_evaluator"]}),Ft(Gs,"ImageId"),Ft(_l,"ImageVariant"),Ft(uc,"ZoomDependentExpression"),Ft(cc,"ZoomConstantExpression"),Ft(is,"CompoundExpression",{omit:["_evaluate"]});for(const n in Qo)vo[Qo[n]._classRegistryKey]||Ft(Qo[n],`Expression${n}`);function Pf(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Ya(n){return self.ImageBitmap&&n instanceof ImageBitmap}function xo(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Pf(n)||Ya(n))return e&&e.add(n),n;if(ArrayBuffer.isView(n))return e&&e.add(n.buffer),n;if(n instanceof ImageData)return e&&e.add(n.data.buffer),n;if(Array.isArray(n)){const r=[];for(const o of n)r.push(xo(o,e));return r}if(n instanceof Map){const r={$name:"Map",entries:[]};for(const[o,a]of n.entries())r.entries.push(xo(o),xo(a,e));return r}if(n instanceof Set){const r={$name:"Set"};let o=0;for(const a of n.values())r[++o]=xo(a);return r}if(n instanceof DOMMatrix){const r={$name:"DOMMatrix"},o=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const a of o)r[a]=n[a];return r}if(typeof n=="bigint")return{$name:"BigInt",value:n.toString()};if(typeof n=="object"){const r=n.constructor,o=r._classRegistryKey;if(!o)throw new Error(`Can't serialize object of unregistered class "${r.name}".`);const a=r.serialize?r.serialize(n,e):{};if(!r.serialize){for(const u in n)n.hasOwnProperty(u)&&(vo[o].omit.indexOf(u)>=0||(a[u]=xo(n[u],e)));n instanceof Error&&(a.message=n.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(a.$name=o),a}throw new Error("can't serialize object of type "+typeof n)}function Ka(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Pf(n)||Ya(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(Ka);if(typeof n=="object"){const e=n.$name||"Object";if(e==="Map"){const a=n.entries||[],u=new Map;for(let h=0;h<a.length;h+=2)u.set(Ka(a[h]),Ka(a[h+1]));return u}if(e==="Set"){const a=new Set;for(const u of Object.keys(n))u!=="$name"&&a.add(Ka(n[u]));return a}if(e==="DOMMatrix"){let a;return a=n.is2D?[n.a,n.b,n.c,n.d,n.e,n.f]:[n.m11,n.m12,n.m13,n.m14,n.m21,n.m22,n.m23,n.m24,n.m31,n.m32,n.m33,n.m34,n.m41,n.m42,n.m43,n.m44],new DOMMatrix(a)}if(e==="BigInt")return BigInt(n.value);const{klass:r}=vo[e];if(!r)throw new Error(`Can't deserialize unregistered class "${e}".`);if(r.deserialize)return r.deserialize(n);const o=Object.create(r.prototype);for(const a of Object.keys(n))a!=="$name"&&(o[a]=Ka(n[a]));return o}throw new Error("can't deserialize object of type "+typeof n)}const sr={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519,Osage:n=>n>=66736&&n<=66815,"CJK Unified Ideographs Extension B":n=>n>=131072&&n<=173791};function ea(n){for(const e of n)if(Rd(e.charCodeAt(0)))return!0;return!1}function pc(n){for(const e of n)if(!Pd(e.charCodeAt(0)))return!1;return!0}function Pd(n){return!(sr.Arabic(n)||sr["Arabic Supplement"](n)||sr["Arabic Extended-A"](n)||sr["Arabic Presentation Forms-A"](n)||sr["Arabic Presentation Forms-B"](n))}function Rd(n){return!(n!==746&&n!==747&&(n<4352||!(sr["Bopomofo Extended"](n)||sr.Bopomofo(n)||sr["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||sr["CJK Compatibility Ideographs"](n)||sr["CJK Compatibility"](n)||sr["CJK Radicals Supplement"](n)||sr["CJK Strokes"](n)||!(!sr["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||sr["CJK Unified Ideographs Extension A"](n)||sr["CJK Unified Ideographs"](n)||sr["Enclosed CJK Letters and Months"](n)||sr["Hangul Compatibility Jamo"](n)||sr["Hangul Jamo Extended-A"](n)||sr["Hangul Jamo Extended-B"](n)||sr["Hangul Jamo"](n)||sr["Hangul Syllables"](n)||sr.Hiragana(n)||sr["Ideographic Description Characters"](n)||sr.Kanbun(n)||sr["Kangxi Radicals"](n)||sr["Katakana Phonetic Extensions"](n)||sr.Katakana(n)&&n!==12540||!(!sr["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!sr["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||sr["Unified Canadian Aboriginal Syllabics"](n)||sr["Unified Canadian Aboriginal Syllabics Extended"](n)||sr["Vertical Forms"](n)||sr["Yijing Hexagram Symbols"](n)||sr["Yi Syllables"](n)||sr["Yi Radicals"](n))))}function Bh(n){return!(Rd(n)||function(e){return!!(sr["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||sr["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||sr["Letterlike Symbols"](e)||sr["Number Forms"](e)||sr["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||sr["Control Pictures"](e)&&e!==9251||sr["Optical Character Recognition"](e)||sr["Enclosed Alphanumerics"](e)||sr["Geometric Shapes"](e)||sr["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||sr["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||sr["CJK Symbols and Punctuation"](e)||sr.Katakana(e)||sr["Private Use Area"](e)||sr["CJK Compatibility Forms"](e)||sr["Small Form Variants"](e)||sr["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function Ip(n){return sr.Arabic(n)||sr["Arabic Supplement"](n)||sr["Arabic Extended-A"](n)||sr["Arabic Presentation Forms-A"](n)||sr["Arabic Presentation Forms-B"](n)}function Hu(n){return n>=1424&&n<=2303||sr["Arabic Presentation Forms-A"](n)||sr["Arabic Presentation Forms-B"](n)}function Ja(n,e){return!(!e&&Hu(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||sr.Khmer(n))}function jh(n){for(const e of n)if(Hu(e.charCodeAt(0)))return!0;return!1}const Bs={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let El=null,js=Bs.unavailable,No=null;const mc=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(js=Bs.error),El&&El(n)};function Wu(){Li.fire(new Kl("pluginStateChange",{pluginStatus:js,pluginURL:No}))}const Li=new Jl,Il=function(){return js},zd=function(){if(js!==Bs.deferred||!No)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");js=Bs.loading,Wu(),No&&mh({url:No},n=>{n?mc(n):(js=Bs.loaded,Wu())})},Ma={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>js===Bs.loaded||Ma.applyArabicShaping!=null,isLoading:()=>js===Bs.loading,setState(n){js=n.pluginStatus,No=n.pluginURL},isParsing:()=>js===Bs.parsing,isParsed:()=>js===Bs.parsed,getPluginURL:()=>No};class zn{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness,this.worldview=r.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(r,o){for(const a of r)if(!Ja(a.charCodeAt(0),o))return!1;return!0}(e,Ma.isLoaded())}}class Qc{constructor(e,r,o,a){this.property=e,this.value=r,this.expression=function(u,h,g,v){if(lc(u))return new hc(u,h);if(Sl(u)||Array.isArray(u)&&u.length>0){const x=Jc(u,h,g,v);if(x.result==="error")throw new Error(x.value.map(E=>`${E.key}: ${E.message}`).join(", "));return x.value}{let x=u;return typeof u=="string"&&h.type==="color"&&(x=_n.parse(u)),{kind:"constant",configDependencies:new Set,evaluate:()=>x}}}(r===void 0?e.specification.default:r,e.specification,o,a)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,o){return this.property.possiblyEvaluate(this,e,r,o)}}class Bo{constructor(e,r,o){this.property=e,this.value=new Qc(e,void 0,r,o)}transitioned(e,r){return new ms(this.property,this.value,r,je({},e.transition,this.transition),e.now)}untransitioned(){return new ms(this.property,this.value,null,{},0)}}class Gi{constructor(e,r,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=r,this._options=o,this.configDependencies=new Set}getValue(e){return _r(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Bo(this._values[e].property,this._scope,this._options)),this._values[e].value=new Qc(this._values[e].property,r===null?void 0:_r(r),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,r){r&&(this._options=r);const o=this._properties.properties;if(e)for(const a in e){const u=e[a];if(a.endsWith("-transition")){const h=a.slice(0,-11);o[h]&&this.setTransition(h,u)}else o.hasOwnProperty(a)&&this.setValue(a,u)}}getTransition(e){return _r(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Bo(this._values[e].property)),this._values[e].transition=_r(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o);const a=this.getTransition(r);a!==void 0&&(e[`${r}-transition`]=a)}return e}transitioned(e,r){const o=new As(this._properties);for(const a of Object.keys(this._values))o._values[a]=this._values[a].transitioned(e,r._values[a]);return o}untransitioned(){const e=new As(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class ms{constructor(e,r,o,a,u){const h=a.delay||0,g=a.duration||0;u=u||0,this.property=e,this.value=r,this.begin=u+h,this.end=this.begin+g,e.specification.transition&&(a.delay||a.duration)&&(this.prior=o)}possiblyEvaluate(e,r,o){const a=e.now||0,u=this.value.possiblyEvaluate(e,r,o),h=this.prior;if(h){if(a>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(a<this.begin)return h.possiblyEvaluate(e,r,o);{const g=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(h.possiblyEvaluate(e,r,o),u,Q(g))}}return u}}class As{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,o){const a=new Pa(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].possiblyEvaluate(e,r,o);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class kd{constructor(e,r,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=r,this._options=o,this.configDependencies=new Set}getValue(e){return _r(this._values[e].value)}setValue(e,r){this._values[e]=new Qc(this._values[e].property,r===null?void 0:_r(r),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o)}return e}possiblyEvaluate(e,r,o){const a=new Pa(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].possiblyEvaluate(e,r,o);return a}}class Qa{constructor(e,r,o){this.property=e,this.value=r,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,o,a){return this.property.evaluate(this.value,this.parameters,e,r,o,a)}}class Pa{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class gt{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,o){const a=ml[this.specification.type];return a?a(e,r,o):e}}class It{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,o,a){return new Qa(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},o,a)}:e.expression,r)}interpolate(e,r,o){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Qa(this,{kind:"constant",value:void 0},e.parameters);const a=ml[this.specification.type];return a?new Qa(this,{kind:"constant",value:a(e.value.value,r.value.value,o)},e.parameters):e}evaluate(e,r,o,a,u,h){return e.kind==="constant"?e.value:e.evaluate(r,o,a,u,h)}}class Al{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,a){return!!e.expression.evaluate(r,null,{},o,a)}interpolate(){return!1}}class fi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new zn(0,{});for(const o in e){const a=e[o];a.specification.overridable&&this.overridableProperties.push(o);const u=this.defaultPropertyValues[o]=new Qc(a,void 0),h=this.defaultTransitionablePropertyValues[o]=new Bo(a);this.defaultTransitioningPropertyValues[o]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=u.possiblyEvaluate(r)}}}Ft(It,"DataDrivenProperty"),Ft(gt,"DataConstantProperty"),Ft(Al,"ColorRampProperty");var ke=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function gs(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function wo(n){if(Array.isArray(n))return n.map(wo);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const r in n)e[r]=wo(n[r]);return e}return gs(n)}function gc(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!gc(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Vh(n,e="",r=null,o="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};gc(n)||(n=Uh(n));const a=n;let u=!0;try{u=function(E){if(!eu(E))return E;let A=wo(E);return Rf(A),A=Dd(A),A}(a)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(a,null,2)}
        `)}let h=null,g=null;if(o!=="background"&&o!=="sky"&&o!=="slot"){g=ke[`filter_${o}`];const E=Xa(u,g,e,r);if(E.result==="error")throw new Error(E.value.map(A=>`${A.key}: ${A.message}`).join(", "));h=(A,C,k)=>E.value.evaluate(A,C,{},k)}let v=null,x=null;if(u!==a){const E=Xa(a,g,e,r);if(E.result==="error")throw new Error(E.value.map(A=>`${A.key}: ${A.message}`).join(", "));v=(A,C,k,L,j)=>E.value.evaluate(A,C,{},k,void 0,void 0,L,j),x=!bl(E.value.expression)}return{filter:h,dynamicFilter:v||void 0,needGeometry:zf(u),needFeature:!!x}}function Dd(n){if(!Array.isArray(n))return n;const e=function(r){if(Ap.has(r[0])){for(let o=1;o<r.length;o++)if(eu(r[o]))return!0}return r}(n);return e===!0?e:e.map(r=>Dd(r))}function Rf(n){let e=!1;const r=[];if(n[0]==="case"){for(let o=1;o<n.length-1;o+=2)e=e||eu(n[o]),r.push(n[o+1]);r.push(n[n.length-1])}else if(n[0]==="match"){e=e||eu(n[1]);for(let o=2;o<n.length-1;o+=2)r.push(n[o+1]);r.push(n[n.length-1])}else if(n[0]==="step"){e=e||eu(n[1]);for(let o=1;o<n.length-1;o+=2)r.push(n[o+1])}e&&(n.length=0,n.push("any",...r));for(let o=1;o<n.length;o++)Rf(n[o])}function eu(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<n.length;r++)if(eu(n[r]))return!0;return!1}const Ap=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Cp(n,e){return n<e?-1:n>e?1:0}function zf(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(zf(n[e]))return!0;return!1}function Uh(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?Ld(n[1],n[2],"=="):e==="!="?$h(Ld(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ld(n[1],n[2],e):e==="any"?(r=n.slice(1),["any"].concat(r.map(Uh))):e==="all"?["all"].concat(n.slice(1).map(Uh)):e==="none"?["all"].concat(n.slice(1).map(Uh).map($h)):e==="in"?Od(n[1],n.slice(2)):e==="!in"?$h(Od(n[1],n.slice(2))):e==="has"?Zu(n[1]):e!=="!has"||$h(Zu(n[1]));var r}function Ld(n,e,r){switch(n){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,n,e]}}function Od(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",n,["literal",e.sort(Cp)]]:["filter-in-small",n,["literal",e]]}}function Zu(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function $h(n){return["!",n]}const _c="";function el(n,e){return e?`${n}${_c}${e}`:n}const Fd="-transition",tl=new Set(["fill","line","background","hillshade","raster"]);class Vs extends Jl{constructor(e,r,o,a,u){if(super(),this.id=e.id,this.fqid=el(this.id,o),this.type=e.type,this.scope=o,this.lut=a,this.options=u,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const h=Xa(this.filter,ke[`filter_${e.type}`]);h.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...h.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),r.layout&&(this._unevaluatedLayout=new kd(r.layout,this.scope,u),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),r.paint){this._transitionablePaint=new Gi(r.paint,this.scope,u);for(const h in e.paint)this.setPaintProperty(h,e.paint[h]);for(const h in e.layout)this.setLayoutProperty(h,e.layout[h]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Pa(r.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&tl.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r){if(this.type==="custom"&&e==="visibility")return void(this.visibility=r);const o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Fd)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r){const o=this._transitionablePaint,a=o._properties.properties;if(e.endsWith(Fd)){const A=e.slice(0,-11);return a[A]&&o.setTransition(A,r||void 0),!1}if(!a[e])return!1;const u=o._values[e],h=u.value.isDataDriven(),g=u.value;o.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const v=o._values[e].value,x=v.isDataDriven(),E=e.endsWith("pattern")||e==="line-dasharray";return x||h||E||this._handleOverridablePaintPropertyUpdate(e,g,v)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,r,o){return null}_handleOverridablePaintPropertyUpdate(e,r,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){return mr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,r)=>!(e===void 0||r==="layout"&&!Object.keys(e).length||r==="paint"&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof Qa&&Uu(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Vh(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,r,o,a,u,h,g,v,x){}}const Mp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Xu{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Kn{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&r.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function pn(n,e=1){let r=0,o=0;return{members:n.map(a=>{const u=Mp[a.type].BYTES_PER_ELEMENT,h=r=Nd(r,Math.max(e,u)),g=a.components||1;return o=Math.max(o,u),r+=u*g,{name:a.name,type:a.type,components:g,offset:h}}),size:Nd(r,Math.max(o,e)),alignment:e}}function Nd(n,e){return Math.ceil(n/e)*e}class rl extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const a=2*e;return this.int16[a+0]=r,this.int16[a+1]=o,e}}rl.prototype.bytesPerElement=4,Ft(rl,"StructArrayLayout2i4");class Yu extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,o)}emplace(e,r,o,a){const u=3*e;return this.int16[u+0]=r,this.int16[u+1]=o,this.int16[u+2]=a,e}}Yu.prototype.bytesPerElement=6,Ft(Yu,"StructArrayLayout3i6");class Ku extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,o,a)}emplace(e,r,o,a,u){const h=4*e;return this.int16[h+0]=r,this.int16[h+1]=o,this.int16[h+2]=a,this.int16[h+3]=u,e}}Ku.prototype.bytesPerElement=8,Ft(Ku,"StructArrayLayout4i8");class Cl extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Cl.prototype.bytesPerElement=4,Ft(Cl,"StructArrayLayout1f4");class kf extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,o)}emplace(e,r,o,a){const u=4*e,h=2*e;return this.int16[u+0]=r,this.int16[u+1]=o,this.float32[h+1]=a,e}}kf.prototype.bytesPerElement=8,Ft(kf,"StructArrayLayout2i1f8");class Bd extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,o)}emplace(e,r,o,a){const u=4*e;return this.int16[u+0]=r,this.int16[u+1]=o,this.int16[u+2]=a,e}}Bd.prototype.bytesPerElement=8,Ft(Bd,"StructArrayLayout3i8");class tu extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,o,a,u)}emplace(e,r,o,a,u,h){const g=5*e;return this.int16[g+0]=r,this.int16[g+1]=o,this.int16[g+2]=a,this.int16[g+3]=u,this.int16[g+4]=h,e}}tu.prototype.bytesPerElement=10,Ft(tu,"StructArrayLayout5i10");class jd extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,u,h,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,o,a,u,h,g)}emplace(e,r,o,a,u,h,g,v){const x=6*e,E=12*e,A=3*e;return this.int16[x+0]=r,this.int16[x+1]=o,this.uint8[E+4]=a,this.uint8[E+5]=u,this.uint8[E+6]=h,this.uint8[E+7]=g,this.float32[A+2]=v,e}}jd.prototype.bytesPerElement=12,Ft(jd,"StructArrayLayout2i4ub1f12");class Ra extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,o)}emplace(e,r,o,a){const u=3*e;return this.float32[u+0]=r,this.float32[u+1]=o,this.float32[u+2]=a,e}}Ra.prototype.bytesPerElement=12,Ft(Ra,"StructArrayLayout3f12");class za extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,o,a,u)}emplace(e,r,o,a,u,h){const g=6*e,v=3*e;return this.uint16[g+0]=r,this.uint16[g+1]=o,this.uint16[g+2]=a,this.uint16[g+3]=u,this.float32[v+2]=h,e}}za.prototype.bytesPerElement=12,Ft(za,"StructArrayLayout4ui1f12");class Gh extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,o,a)}emplace(e,r,o,a,u){const h=4*e;return this.uint16[h+0]=r,this.uint16[h+1]=o,this.uint16[h+2]=a,this.uint16[h+3]=u,e}}Gh.prototype.bytesPerElement=8,Ft(Gh,"StructArrayLayout4ui8");class Vd extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,a,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,o,a,u,h)}emplace(e,r,o,a,u,h,g){const v=6*e;return this.int16[v+0]=r,this.int16[v+1]=o,this.int16[v+2]=a,this.int16[v+3]=u,this.int16[v+4]=h,this.int16[v+5]=g,e}}Vd.prototype.bytesPerElement=12,Ft(Vd,"StructArrayLayout6i12");class Ju extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,a,u,h,g,v,x,E,A,C){const k=this.length;return this.resize(k+1),this.emplace(k,e,r,o,a,u,h,g,v,x,E,A,C)}emplace(e,r,o,a,u,h,g,v,x,E,A,C,k){const L=12*e;return this.int16[L+0]=r,this.int16[L+1]=o,this.int16[L+2]=a,this.int16[L+3]=u,this.uint16[L+4]=h,this.uint16[L+5]=g,this.uint16[L+6]=v,this.uint16[L+7]=x,this.int16[L+8]=E,this.int16[L+9]=A,this.int16[L+10]=C,this.int16[L+11]=k,e}}Ju.prototype.bytesPerElement=24,Ft(Ju,"StructArrayLayout4i4ui4i24");class eo extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,o,a,u,h)}emplace(e,r,o,a,u,h,g){const v=10*e,x=5*e;return this.int16[v+0]=r,this.int16[v+1]=o,this.int16[v+2]=a,this.float32[x+2]=u,this.float32[x+3]=h,this.float32[x+4]=g,e}}eo.prototype.bytesPerElement=20,Ft(eo,"StructArrayLayout3i3f20");class os extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,o,a)}emplace(e,r,o,a,u){const h=4*e;return this.float32[h+0]=r,this.float32[h+1]=o,this.float32[h+2]=a,this.float32[h+3]=u,e}}os.prototype.bytesPerElement=16,Ft(os,"StructArrayLayout4f16");class Ml extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Ml.prototype.bytesPerElement=4,Ft(Ml,"StructArrayLayout1ul4");class Pl extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const a=2*e;return this.uint16[a+0]=r,this.uint16[a+1]=o,e}}Pl.prototype.bytesPerElement=4,Ft(Pl,"StructArrayLayout2ui4");class Ud extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,a,u,h,g,v,x,E,A,C,k){const L=this.length;return this.resize(L+1),this.emplace(L,e,r,o,a,u,h,g,v,x,E,A,C,k)}emplace(e,r,o,a,u,h,g,v,x,E,A,C,k,L){const j=20*e,G=10*e;return this.int16[j+0]=r,this.int16[j+1]=o,this.int16[j+2]=a,this.int16[j+3]=u,this.int16[j+4]=h,this.float32[G+3]=g,this.float32[G+4]=v,this.float32[G+5]=x,this.float32[G+6]=E,this.int16[j+14]=A,this.uint32[G+8]=C,this.uint16[j+18]=k,this.uint16[j+19]=L,e}}Ud.prototype.bytesPerElement=40,Ft(Ud,"StructArrayLayout5i4f1i1ul2ui40");class qh extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,a,u,h,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,o,a,u,h,g)}emplace(e,r,o,a,u,h,g,v){const x=8*e;return this.int16[x+0]=r,this.int16[x+1]=o,this.int16[x+2]=a,this.int16[x+4]=u,this.int16[x+5]=h,this.int16[x+6]=g,this.int16[x+7]=v,e}}qh.prototype.bytesPerElement=16,Ft(qh,"StructArrayLayout3i2i2i16");class Hh extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,o,a,u)}emplace(e,r,o,a,u,h){const g=4*e,v=8*e;return this.float32[g+0]=r,this.float32[g+1]=o,this.float32[g+2]=a,this.int16[v+6]=u,this.int16[v+7]=h,e}}Hh.prototype.bytesPerElement=16,Ft(Hh,"StructArrayLayout2f1f2i16");class nl extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,o,a,u,h)}emplace(e,r,o,a,u,h,g){const v=20*e,x=5*e;return this.uint8[v+0]=r,this.uint8[v+1]=o,this.float32[x+1]=a,this.float32[x+2]=u,this.float32[x+3]=h,this.float32[x+4]=g,e}}nl.prototype.bytesPerElement=20,Ft(nl,"StructArrayLayout2ub4f20");class as extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,o)}emplace(e,r,o,a){const u=3*e;return this.uint16[u+0]=r,this.uint16[u+1]=o,this.uint16[u+2]=a,e}}as.prototype.bytesPerElement=6,Ft(as,"StructArrayLayout3ui6");class ru extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,u,h,g,v,x,E,A,C,k,L,j,G,K,te,ne,U,ee){const ie=this.length;return this.resize(ie+1),this.emplace(ie,e,r,o,a,u,h,g,v,x,E,A,C,k,L,j,G,K,te,ne,U,ee)}emplace(e,r,o,a,u,h,g,v,x,E,A,C,k,L,j,G,K,te,ne,U,ee,ie){const ae=30*e,Te=15*e,ve=60*e;return this.int16[ae+0]=r,this.int16[ae+1]=o,this.int16[ae+2]=a,this.float32[Te+2]=u,this.float32[Te+3]=h,this.uint16[ae+8]=g,this.uint16[ae+9]=v,this.uint32[Te+5]=x,this.uint32[Te+6]=E,this.uint32[Te+7]=A,this.uint16[ae+16]=C,this.uint16[ae+17]=k,this.uint16[ae+18]=L,this.float32[Te+10]=j,this.float32[Te+11]=G,this.uint8[ve+48]=K,this.uint8[ve+49]=te,this.uint8[ve+50]=ne,this.uint32[Te+13]=U,this.int16[ae+28]=ee,this.uint8[ve+58]=ie,e}}ru.prototype.bytesPerElement=60,Ft(ru,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Df extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,u,h,g,v,x,E,A,C,k,L,j,G,K,te,ne,U,ee,ie,ae,Te,ve,Ee,Re,He,ht,it,ut,mt,Ze){const lt=this.length;return this.resize(lt+1),this.emplace(lt,e,r,o,a,u,h,g,v,x,E,A,C,k,L,j,G,K,te,ne,U,ee,ie,ae,Te,ve,Ee,Re,He,ht,it,ut,mt,Ze)}emplace(e,r,o,a,u,h,g,v,x,E,A,C,k,L,j,G,K,te,ne,U,ee,ie,ae,Te,ve,Ee,Re,He,ht,it,ut,mt,Ze,lt){const qe=20*e,We=40*e,xt=80*e;return this.float32[qe+0]=r,this.float32[qe+1]=o,this.int16[We+4]=a,this.int16[We+5]=u,this.int16[We+6]=h,this.int16[We+7]=g,this.int16[We+8]=v,this.int16[We+9]=x,this.int16[We+10]=E,this.int16[We+11]=A,this.int16[We+12]=C,this.uint16[We+13]=k,this.uint16[We+14]=L,this.uint16[We+15]=j,this.uint16[We+16]=G,this.uint16[We+17]=K,this.uint16[We+18]=te,this.uint16[We+19]=ne,this.uint16[We+20]=U,this.uint16[We+21]=ee,this.uint16[We+22]=ie,this.uint16[We+23]=ae,this.uint16[We+24]=Te,this.uint16[We+25]=ve,this.uint16[We+26]=Ee,this.uint16[We+27]=Re,this.uint32[qe+14]=He,this.float32[qe+15]=ht,this.float32[qe+16]=it,this.float32[qe+17]=ut,this.float32[qe+18]=mt,this.uint8[xt+76]=Ze,this.uint16[We+39]=lt,e}}Df.prototype.bytesPerElement=80,Ft(Df,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class $d extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,o,a,u,h)}emplace(e,r,o,a,u,h,g){const v=6*e;return this.float32[v+0]=r,this.float32[v+1]=o,this.float32[v+2]=a,this.float32[v+3]=u,this.float32[v+4]=h,this.float32[v+5]=g,e}}$d.prototype.bytesPerElement=24,Ft($d,"StructArrayLayout6f24");class Rl extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,o,a,u)}emplace(e,r,o,a,u,h){const g=5*e;return this.float32[g+0]=r,this.float32[g+1]=o,this.float32[g+2]=a,this.float32[g+3]=u,this.float32[g+4]=h,e}}Rl.prototype.bytesPerElement=20,Ft(Rl,"StructArrayLayout5f20");class Qu extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,u,h,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,o,a,u,h,g)}emplace(e,r,o,a,u,h,g,v){const x=7*e;return this.float32[x+0]=r,this.float32[x+1]=o,this.float32[x+2]=a,this.float32[x+3]=u,this.float32[x+4]=h,this.float32[x+5]=g,this.float32[x+6]=v,e}}Qu.prototype.bytesPerElement=28,Ft(Qu,"StructArrayLayout7f28");class Gd extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,u,h,g,v,x,E,A){const C=this.length;return this.resize(C+1),this.emplace(C,e,r,o,a,u,h,g,v,x,E,A)}emplace(e,r,o,a,u,h,g,v,x,E,A,C){const k=11*e;return this.float32[k+0]=r,this.float32[k+1]=o,this.float32[k+2]=a,this.float32[k+3]=u,this.float32[k+4]=h,this.float32[k+5]=g,this.float32[k+6]=v,this.float32[k+7]=x,this.float32[k+8]=E,this.float32[k+9]=A,this.float32[k+10]=C,e}}Gd.prototype.bytesPerElement=44,Ft(Gd,"StructArrayLayout11f44");class Wh extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,u,h,g,v,x){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,o,a,u,h,g,v,x)}emplace(e,r,o,a,u,h,g,v,x,E){const A=9*e;return this.float32[A+0]=r,this.float32[A+1]=o,this.float32[A+2]=a,this.float32[A+3]=u,this.float32[A+4]=h,this.float32[A+5]=g,this.float32[A+6]=v,this.float32[A+7]=x,this.float32[A+8]=E,e}}Wh.prototype.bytesPerElement=36,Ft(Wh,"StructArrayLayout9f36");class nu extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const a=2*e;return this.float32[a+0]=r,this.float32[a+1]=o,e}}nu.prototype.bytesPerElement=8,Ft(nu,"StructArrayLayout2f8");class to extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,o,a)}emplace(e,r,o,a,u){const h=6*e;return this.uint32[3*e+0]=r,this.uint16[h+2]=o,this.uint16[h+3]=a,this.uint16[h+4]=u,e}}to.prototype.bytesPerElement=12,Ft(to,"StructArrayLayout1ul3ui12");class Cs extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Cs.prototype.bytesPerElement=2,Ft(Cs,"StructArrayLayout1ui2");class iu extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,u,h,g,v,x,E,A,C,k,L,j,G){const K=this.length;return this.resize(K+1),this.emplace(K,e,r,o,a,u,h,g,v,x,E,A,C,k,L,j,G)}emplace(e,r,o,a,u,h,g,v,x,E,A,C,k,L,j,G,K){const te=16*e;return this.float32[te+0]=r,this.float32[te+1]=o,this.float32[te+2]=a,this.float32[te+3]=u,this.float32[te+4]=h,this.float32[te+5]=g,this.float32[te+6]=v,this.float32[te+7]=x,this.float32[te+8]=E,this.float32[te+9]=A,this.float32[te+10]=C,this.float32[te+11]=k,this.float32[te+12]=L,this.float32[te+13]=j,this.float32[te+14]=G,this.float32[te+15]=K,e}}iu.prototype.bytesPerElement=64,Ft(iu,"StructArrayLayout16f64");class eh extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,u,h,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,o,a,u,h,g)}emplace(e,r,o,a,u,h,g,v){const x=10*e,E=5*e;return this.uint16[x+0]=r,this.uint16[x+1]=o,this.uint16[x+2]=a,this.uint16[x+3]=u,this.float32[E+2]=h,this.float32[E+3]=g,this.float32[E+4]=v,e}}eh.prototype.bytesPerElement=20,Ft(eh,"StructArrayLayout4ui3f20");class qd extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.int16[1*e+0]=r,e}}qd.prototype.bytesPerElement=2,Ft(qd,"StructArrayLayout1i2");class Zh extends Kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint8[1*e+0]=r,e}}Zh.prototype.bytesPerElement=1,Ft(Zh,"StructArrayLayout1ub1");class Lf extends Xu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Lf.prototype.size=40;class th extends Ud{get(e){return new Lf(this,e)}}Ft(th,"CollisionBoxArray");class Of extends Xu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Of.prototype.size=60;class Hd extends ru{get(e){return new Of(this,e)}}Ft(Hd,"PlacedSymbolArray");class Ff extends Xu{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Ff.prototype.size=80;class Nf extends Df{get(e){return new Ff(this,e)}}Ft(Nf,"SymbolInstanceArray");class Xh extends Cl{getoffsetX(e){return this.float32[1*e+0]}}Ft(Xh,"GlyphOffsetArray");class Wd extends rl{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ft(Wd,"SymbolLineVertexArray");class Bf extends Xu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Bf.prototype.size=12;class Zd extends to{get(e){return new Bf(this,e)}}Ft(Zd,"FeatureIndexArray");class Yh extends Pl{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ft(Yh,"FillExtrusionCentroidArray");class Pp extends Xu{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Pp.prototype.size=6;class jf extends Yu{get(e){return new Pp(this,e)}}Ft(jf,"FillExtrusionWallArray");const Vf=pn([{name:"a_pos",components:2,type:"Int16"}],4),Rp=pn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),su=pn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class $n{constructor(e=[]){this.segments=e}_prepareSegment(e,r,o,a){let u=this.segments[this.segments.length-1];return e>$n.MAX_VERTEX_ARRAY_LENGTH&&Rr(`Max vertices per segment is ${$n.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>$n.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==a)&&(u={vertexOffset:r,primitiveOffset:o,vertexLength:0,primitiveLength:0},a!==void 0&&(u.sortKey=a),this.segments.push(u)),u}prepareSegment(e,r,o,a){return this._prepareSegment(e,r.length,o.length,a)}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,o,a){return new $n([{vertexOffset:e,primitiveOffset:r,vertexLength:o,primitiveLength:a,vaos:{},sortKey:0}])}}function zp(n,e){return 256*(n=me(Math.floor(n),0,255))+me(Math.floor(e),0,255)}$n.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ft($n,"SegmentVector");const Kh=pn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Jh=pn([{name:"a_pattern_b",components:4,type:"Uint16"}]),Uf=pn([{name:"a_dash",components:4,type:"Uint16"}]);class rh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,r,o,a){this.ids.push(ou(e)),this.positions.push(r,o,a)}eachPosition(e,r){const o=ou(e);let a=0,u=this.ids.length-1;for(;a<u;){const h=a+u>>1;this.ids[h]>=o?u=h:a=h+1}for(;this.ids[a]===o;)r(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2]),a++}static serialize(e,r){const o=new Float64Array(e.ids),a=new Uint32Array(e.positions);return Ms(o,a,0,o.length-1),r&&(r.add(o.buffer),r.add(a.buffer)),{ids:o,positions:a}}static deserialize(e){const r=new rh;let o;r.ids=e.ids,r.positions=e.positions;for(const a of r.ids)a!==o&&r.uniqueIds.push(a),o=a;return r.indexed=!0,r}}function ou(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:zc(String(n))}function Ms(n,e,r,o){for(;r<o;){const a=n[r+o>>1];let u=r-1,h=o+1;for(;;){do u++;while(n[u]<a);do h--;while(n[h]>a);if(u>=h)break;Qh(n,u,h),Qh(e,3*u,3*h),Qh(e,3*u+1,3*h+1),Qh(e,3*u+2,3*h+2)}h-r<o-h?(Ms(n,e,r,h),r=h+1):(Ms(n,e,h+1,o),o=h)}}function Qh(n,e,r){const o=n[e];n[e]=n[r],n[r]=o}Ft(rh,"FeaturePositionMap");class zl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}set(e,r,o){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class au extends zl{constructor(e){super(e),this.current=0}set(e,r,o){this.fetchUniformLocation(e,r)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class On extends zl{constructor(e){super(e),this.current=0}set(e,r,o){this.fetchUniformLocation(e,r)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class il extends zl{constructor(e){super(e),this.current=[0,0]}set(e,r,o){this.fetchUniformLocation(e,r)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class Er extends zl{constructor(e){super(e),this.current=[0,0,0]}set(e,r,o){this.fetchUniformLocation(e,r)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class kl extends zl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,o){this.fetchUniformLocation(e,r)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class Xd extends zl{constructor(e){super(e),this.current=_n.transparent.toPremultipliedRenderColor(null)}set(e,r,o){this.fetchUniformLocation(e,r)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const kp=new Float32Array(16);class nh extends zl{constructor(e){super(e),this.current=kp}set(e,r,o){if(this.fetchUniformLocation(e,r)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let a=1;a<16;a++)if(o[a]!==this.current[a]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}const lu=new Float32Array(9),ta=new Float32Array(4);class cu extends zl{constructor(e){super(e),this.current=ta}set(e,r,o){if(this.fetchUniformLocation(e,r)){for(let a=0;a<4;a++)if(o[a]!==this.current[a]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function Yd(n){return[zp(255*n.r,255*n.g),zp(255*n.b,255*n.a)]}class ih{constructor(e,r,o,a){this.value=e,this.uniformNames=r.map(u=>`u_${u}`),this.type=o,this.context=a}setUniform(e,r,o,a,u){const h=a.constantOr(this.value);r.set(e,u,h instanceof _n?h.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):h)}getBinding(e,r){return this.type==="color"?new Xd(e):new On(e)}}class uu{constructor(e,r){this.uniformNames=r.map(o=>`u_${o}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,r){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=r?r.tl.concat(r.br):this.pattern}setUniform(e,r,o,a,u){let h=null;u!=="u_pattern"&&u!=="u_dash"||(h=this.pattern),u==="u_pattern_b"&&(h=this.patternTransition),u==="u_pixel_ratio"&&(h=this.pixelRatio),h&&r.set(e,u,h)}getBinding(e,r){return r==="u_pattern"||r==="u_pattern_b"||r==="u_dash"?new kl(e):new On(e)}}class ka{constructor(e,r,o,a){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=r.map(u=>({name:`a_${u}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,r,o,a,u,h,g,v){const x=this.paintVertexArray.length,E=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new zn(0,{brightness:h,worldview:v}),r,{},u,a,g):this.expression.kind==="constant"&&this.expression.value,A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new zn(0,{brightness:h,worldview:v}),r,{},u,a,g):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(x,e,E,A?null:this.context.lut)}updatePaintArray(e,r,o,a,u,h,g,v){const x=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:g,worldview:v},o,a,void 0,u):this.expression.kind==="constant"&&this.expression.value,E=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new zn(0,{brightness:g,worldview:v}),o,a,void 0,u):this.lutExpression.value)==="none";this._setPaintValue(e,r,x,E?null:this.context.lut)}_setPaintValue(e,r,o,a){if(this.type==="color"){const u=Yd(o.toPremultipliedRenderColor(a));for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,u[0],u[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ra{constructor(e,r,o,a,u,h){this.expression=e,this.uniformNames=r.map(g=>`u_${g}_t`),this.type=o,this.useIntegerZoom=a,this.context=u,this.maxValue=0,this.paintVertexAttributes=r.map(g=>({name:`a_${g}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,r,o,a,u,h,g,v){const x=this.expression.evaluate(new zn(this.context.zoom,{brightness:h,worldview:v}),r,{},u,a,g),E=this.expression.evaluate(new zn(this.context.zoom+1,{brightness:h,worldview:v}),r,{},u,a,g),A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new zn(0,{brightness:h,worldview:v}),r,{},u,a,g):this.lutExpression.value)==="none",C=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(C,e,x,E,A?null:this.context.lut)}updatePaintArray(e,r,o,a,u,h,g,v){const x=this.expression.evaluate({zoom:this.context.zoom,brightness:g,worldview:v},o,a,void 0,u),E=this.expression.evaluate({zoom:this.context.zoom+1,brightness:g,worldview:v},o,a,void 0,u),A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new zn(0,{brightness:g,worldview:v}),o,a,void 0,u):this.lutExpression.value)==="none";this._setPaintValue(e,r,x,E,A?null:this.context.lut)}_setPaintValue(e,r,o,a,u){if(this.type==="color"){const h=Yd(o.toPremultipliedRenderColor(u)),g=Yd(o.toPremultipliedRenderColor(u));for(let v=e;v<r;v++)this.paintVertexArray.emplace(v,h[0],h[1],g[0],g[1])}else{for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,o,a);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,o,a,u){const h=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,g=me(this.expression.interpolationFactor(h,this.context.zoom,this.context.zoom+1),0,1);r.set(e,u,g)}getBinding(e,r){return new On(e)}}class Ai{constructor(e,r,o,a,u){this.expression=e,this.layerId=u,this.paintVertexAttributes=(o==="array"?Uf:Kh).members;for(let h=0;h<r.length;++h);this.paintVertexArray=new a,this.paintTransitionVertexArray=new Gh}populatePaintArray(e,r,o,a){const u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,r.patterns&&r.patterns[this.layerId],o)}updatePaintArray(e,r,o,a,u,h,g){this._setPaintValues(e,r,o.patterns&&o.patterns[this.layerId],h)}_setPaintValues(e,r,o,a){if(!a||!o)return;const u=a[o[0]],h=a[o[1]];if(u){if(u){const{tl:g,br:v,pixelRatio:x}=u;for(let E=e;E<r;E++)this.paintVertexArray.emplace(E,g[0],g[1],v[0],v[1],x)}if(h){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:g,br:v}=h;for(let x=e;x<r;x++)this.paintTransitionVertexArray.emplace(x,g[0],g[1],v[0],v[1])}}}upload(e){const r=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,r)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Jh.members,r))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class ro{constructor(e,r,o=()=>!0){this.binders={},this._buffers=[],this.context=r;const a=[];for(const u in e.paint._values){const h=e.paint.get(u);if(u.endsWith("-use-theme")||!o(u)||!(h instanceof Qa&&Uu(h.property.specification)))continue;const g=i(u,e.type),v=h.value,x=h.property.specification.type,E=!!h.property.useIntegerZoom,A=u==="line-dasharray"||u.endsWith("pattern"),C=e.paint.get(`${u}-use-theme`),k=u==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||C&&C.value.kind!=="constant";if(v.kind!=="constant"||k)if(v.kind==="source"||k||A){const L=m(u,x,"source");this.binders[u]=A?new Ai(v,g,x,L,e.id):new ka(v,g,x,L),a.push(`/a_${u}`)}else{const L=m(u,x,"composite");this.binders[u]=new ra(v,g,x,E,r,L),a.push(`/z_${u}`)}else this.binders[u]=A?new uu(v.value,g):new ih(v.value,g,x,r),a.push(`/u_${u}`);C&&(this.binders[u].lutExpression=C.value)}this.cacheKey=a.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof ka||r instanceof ra?r.maxValue:0}populatePaintArrays(e,r,o,a,u,h,g,v){for(const x in this.binders){const E=this.binders[x];E.context=this.context,(E instanceof ka||E instanceof ra||E instanceof Ai)&&E.populatePaintArray(e,r,o,a,u,h,g,v)}}setConstantPatternPositions(e,r){for(const o in this.binders){const a=this.binders[o];a instanceof uu&&a.setConstantPatternPositions(e,r)}}getPatternTransitionVertexBuffer(e){const r=this.binders[e];return r instanceof Ai?r.paintTransitionVertexBuffer:null}updatePaintArrays(e,r,o,a,u,h,g,v,x,E){let A=!1;const C=Object.keys(e),k=C.length!==0&&!v,L=k?C:r.uniqueIds;this.context.lut=u.lut;for(const j in this.binders){const G=this.binders[j];if(G.context=this.context,(G instanceof ka||G instanceof ra||G instanceof Ai)&&G.expression&&G.expression.kind&&G.expression.kind!=="constant"&&(G.expression.isStateDependent===!0||G.expression.isLightConstant===!1)){const K=u.paint.get(j);G.expression=K.value;for(const te of L){const ne=e[te.toString()];r.eachPosition(te,(U,ee,ie)=>{const ae=a.feature(U);G.updatePaintArray(ee,ie,ae,ne,h,g,x,E)})}if(!k)for(const te of o.uniqueIds){const ne=e[te.toString()];o.eachPosition(te,(U,ee,ie)=>{const ae=a.feature(U);G.updatePaintArray(ee,ie,ae,ne,h,g,x,E)})}A=!0}}return A}defines(){const e=[];for(const r in this.binders){const o=this.binders[r];(o instanceof ih||o instanceof uu)&&e.push(...o.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof ka||o instanceof ra||o instanceof Ai)for(let a=0;a<o.paintVertexAttributes.length;a++)e.push(o.paintVertexAttributes[a].name);if(o instanceof Ai)for(let a=0;a<Jh.members.length;a++)e.push(Jh.members[a].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof ih||o instanceof uu||o instanceof ra)for(const a of o.uniformNames)e.push(a)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const o in this.binders){const a=this.binders[o];if(a instanceof ih||a instanceof uu||a instanceof ra)for(const u of a.uniformNames)r.push({name:u,property:o,binding:a.getBinding(e,u)})}return r}setUniforms(e,r,o,a,u){for(const{name:h,property:g,binding:v}of o)this.binders[g].setUniform(e,v,u,a.get(g),h)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof ka||r instanceof ra||r instanceof Ai)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer),r instanceof Ai&&r.paintTransitionVertexBuffer&&this._buffers.push(r.paintTransitionVertexBuffer)}}upload(e){for(const r in this.binders){const o=this.binders[r];(o instanceof ka||o instanceof ra||o instanceof Ai)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof ka||r instanceof ra||r instanceof Ai)&&r.destroy()}}}class l{constructor(e,r,o=()=>!0){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new ro(a,r,o);this.needsUpload=!1,this._featureMap=new rh,this._featureMapWithoutIds=new rh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,r,o,a,u,h,g,v,x){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(e,r,a,u,h,g,v,x);r.id!==void 0?this._featureMap.add(r.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,o,a,u,h,g,v){for(const x of o)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,r,x,a,u,h,g||0,v)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const t={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function i(n,e){return t[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const c={"line-pattern":{source:za,composite:za},"fill-pattern":{source:za,composite:za},"fill-extrusion-pattern":{source:za,composite:za},"line-dasharray":{source:Gh,composite:Gh}},f={color:{source:nu,composite:os},number:{source:Cl,composite:nu}};function m(n,e,r){const o=c[n];return o&&o[r]||f[e][r]}Ft(ih,"ConstantBinder"),Ft(uu,"PatternConstantBinder"),Ft(ka,"SourceExpressionBinder"),Ft(Ai,"PatternCompositeBinder"),Ft(ra,"CompositeExpressionBinder"),Ft(ro,"ProgramConfiguration",{omit:["_buffers"]}),Ft(l,"ProgramConfigurationSet");const y=Ct/Math.PI/2,w=5,S=6,M=16383,P=64,O=[P,32,16],D=-y,F=y;function q(n,e,r,o=y){return r=en(r),[n*Math.sin(r)*o,-e*o,n*Math.cos(r)*o]}function V(n,e,r){return q(Math.cos(en(n)),Math.sin(en(n)),e,r)}const W=63710088e-1,X=2*Math.PI*W;class J{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new J(Ne(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,o=this.lat*r,a=e.lat*r,u=Math.sin(o)*Math.sin(a)+Math.cos(o)*Math.cos(a)*Math.cos((e.lng-this.lng)*r);return W*Math.acos(Math.min(u,1))}toBounds(e=0){const r=360*e/40075017,o=r/Math.cos(Math.PI/180*this.lat);return new se({lng:this.lng-o,lat:this.lat-r},{lng:this.lng+o,lat:this.lat+r})}toEcef(e){return V(this.lat,this.lng,y+e*y/W)}static convert(e){if(e instanceof J)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new J(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new J(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class se{constructor(e,r){if(e)if(r)this.setSouthWest(e).setNorthEast(r);else if(e.length===4){const o=e;this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]])}else{const o=e;this.setSouthWest(o[0]).setNorthEast(o[1])}}setNorthEast(e){return this._ne=e instanceof J?new J(e.lng,e.lat):J.convert(e),this}setSouthWest(e){return this._sw=e instanceof J?new J(e.lng,e.lat):J.convert(e),this}extend(e){const r=this._sw,o=this._ne;let a,u;if(e instanceof J)a=e,u=e;else{if(!(e instanceof se))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(se.convert(e)):this.extend(J.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(J.convert(e)):this;if(a=e._sw,u=e._ne,!a||!u)return this}return r||o?(r.lng=Math.min(a.lng,r.lng),r.lat=Math.min(a.lat,r.lat),o.lng=Math.max(u.lng,o.lng),o.lat=Math.max(u.lat,o.lat)):(this._sw=new J(a.lng,a.lat),this._ne=new J(u.lng,u.lat)),this}getCenter(){return new J((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new J(this.getWest(),this.getNorth())}getSouthEast(){return new J(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:o}=J.convert(e);let a=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&a}static convert(e){if(e)return e instanceof se?e:new se(e)}}const le=0,ge=25.5;function _e(n){return X*Math.cos(n*Math.PI/180)}function pe(n){return(180+n)/360}function ue(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function ye(n,e){return n/_e(e)}function xe(n){return 360*n-180}function Pe(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Le(n,e){return n*_e(Pe(e))}const Ye=85.051129;function Xe(n){return Math.cos(en(me(n,-85.051129,Ye)))}function ot(n,e){const r=me(e,le,ge),o=Math.pow(2,r);return Xe(n)*X/(512*o)}function ze(n){return 1/Math.cos(n*Math.PI/180)}function $e(n,e=0){const r=Math.exp(Math.PI*(1-(n.y+e/Ct)/(1<<n.z)*2));return 80150034*r/(r*r+1)/Ct/(1<<n.z)}class Ie{constructor(e,r,o=0){this.x=+e,this.y=+r,this.z=+o}static fromLngLat(e,r=0){const o=J.convert(e);return new Ie(pe(o.lng),ue(o.lat),ye(r,o.lat))}toLngLat(){return new J(xe(this.x),Pe(this.y))}toAltitude(){return Le(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/X*ze(Pe(this.y))}}function Je(n,e,r,o,a,u,h,g,v){const x=(e+o)/2,E=(r+a)/2,A=new ft(x,E);g(A),function(C,k,L,j,G,K){const te=L-G,ne=j-K;return Math.abs((j-k)*te-(L-C)*ne)/Math.hypot(te,ne)}(A.x,A.y,u.x,u.y,h.x,h.y)>=v?(Je(n,e,r,x,E,u,A,g,v),Je(n,x,E,o,a,A,h,g,v)):n.push(h)}function Ve(n,e,r){let o=n[0],a=o.x,u=o.y;e(o);const h=[o];for(let g=1;g<n.length;g++){const v=n[g],{x,y:E}=v;e(v),Je(h,a,u,x,E,o,v,e,r),a=x,u=E,o=v}return h}function st(n,e,r,o){if(o(e,r)){const a=e.add(r)._mult(.5);st(n,e,a,o),st(n,a,r,o)}else n.push(r)}function vt(n,e){let r=n[0];const o=[r];for(let a=1;a<n.length;a++){const u=n[a];st(o,r,u,e),r=u}return o}const Qe=Math.pow(2,14)-1,pt=-Qe-1;function Pt(n,e){const r=Math.round(n.x*e),o=Math.round(n.y*e);return n.x=me(r,pt,Qe),n.y=me(o,pt,Qe),(r<n.x||r>n.x+1||o<n.y||o>n.y+1)&&Rr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function Lt(n,e,r){const o=n.loadGeometry(),a=n.extent,u=Ct/a;if(e&&r&&r.projection.isReprojectedInTileSpace){const h=1<<e.z,{scale:g,x:v,y:x,projection:E}=r,A=C=>{const k=xe((e.x+C.x/a)/h),L=Pe((e.y+C.y/a)/h),j=E.project(k,L);C.x=(j.x*g-v)*a,C.y=(j.y*g-x)*a};for(let C=0;C<o.length;C++)if(n.type!==1)o[C]=Ve(o[C],A,1);else{const k=[];for(const L of o[C])L.x<0||L.x>=a||L.y<0||L.y>=a||(A(L),k.push(L));o[C]=k}}for(const h of o)for(const g of h)Pt(g,u);return o}function Mt(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Lt(n):[]}}var Nt,er,nr,dr,Dr,dn,Gn,Mn={};function wn(){if(er)return Nt;er=1;var n=Wi();function e(a,u,h,g,v){this.properties={},this.extent=h,this.type=0,this._pbf=a,this._geometry=-1,this._keys=g,this._values=v,a.readFields(r,this,u)}function r(a,u,h){a==1?u.id=h.readVarint():a==2?function(g,v){for(var x=g.readVarint()+g.pos;g.pos<x;){var E=v._keys[g.readVarint()],A=v._values[g.readVarint()];v.properties[E]=A}}(h,u):a==3?u.type=h.readVarint():a==4&&(u._geometry=h.pos)}function o(a){for(var u,h,g=0,v=0,x=a.length,E=x-1;v<x;E=v++)g+=((h=a[E]).x-(u=a[v]).x)*(u.y+h.y);return g}return Nt=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var u,h=a.readVarint()+a.pos,g=1,v=0,x=0,E=0,A=[];a.pos<h;){if(v<=0){var C=a.readVarint();g=7&C,v=C>>3}if(v--,g===1||g===2)x+=a.readSVarint(),E+=a.readSVarint(),g===1&&(u&&A.push(u),u=[]),u.push(new n(x,E));else{if(g!==7)throw new Error("unknown command "+g);u&&u.push(u[0].clone())}}return u&&A.push(u),A},e.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var u=a.readVarint()+a.pos,h=1,g=0,v=0,x=0,E=1/0,A=-1/0,C=1/0,k=-1/0;a.pos<u;){if(g<=0){var L=a.readVarint();h=7&L,g=L>>3}if(g--,h===1||h===2)(v+=a.readSVarint())<E&&(E=v),v>A&&(A=v),(x+=a.readSVarint())<C&&(C=x),x>k&&(k=x);else if(h!==7)throw new Error("unknown command "+h)}return[E,C,A,k]},e.prototype.toGeoJSON=function(a,u,h){var g,v,x=this.extent*Math.pow(2,h),E=this.extent*a,A=this.extent*u,C=this.loadGeometry(),k=e.types[this.type];function L(K){for(var te=0;te<K.length;te++){var ne=K[te];K[te]=[360*(ne.x+E)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(ne.y+A)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var j=[];for(g=0;g<C.length;g++)j[g]=C[g][0];L(C=j);break;case 2:for(g=0;g<C.length;g++)L(C[g]);break;case 3:for(C=function(K){var te=K.length;if(te<=1)return[K];for(var ne,U,ee=[],ie=0;ie<te;ie++){var ae=o(K[ie]);ae!==0&&(U===void 0&&(U=ae<0),U===ae<0?(ne&&ee.push(ne),ne=[K[ie]]):ne.push(K[ie]))}return ne&&ee.push(ne),ee}(C),g=0;g<C.length;g++)for(v=0;v<C[g].length;v++)L(C[g][v])}C.length===1?C=C[0]:k="Multi"+k;var G={type:"Feature",geometry:{type:k,coordinates:C},properties:this.properties};return"id"in this&&(G.id=this.id),G},Nt}function wi(){if(dr)return nr;dr=1;var n=wn();function e(o,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(r,this,a),this.length=this._features.length}function r(o,a,u){o===15?a.version=u.readVarint():o===1?a.name=u.readString():o===5?a.extent=u.readVarint():o===2?a._features.push(u.pos):o===3?a._keys.push(u.readString()):o===4&&a._values.push(function(h){for(var g=null,v=h.readVarint()+h.pos;h.pos<v;){var x=h.readVarint()>>3;g=x===1?h.readString():x===2?h.readFloat():x===3?h.readDouble():x===4?h.readVarint64():x===5?h.readVarint():x===6?h.readSVarint():x===7?h.readBoolean():null}return g}(u))}return nr=e,e.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var a=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,a,this.extent,this._keys,this._values)},nr}function yr(){return Gn||(Gn=1,Mn.VectorTile=function(){if(dn)return Dr;dn=1;var n=wi();function e(r,o,a){if(r===3){var u=new n(a,a.readVarint()+a.pos);u.length&&(o[u.name]=u)}}return Dr=function(r,o){this.layers=r.readFields(e,{},o)},Dr}(),Mn.VectorTileFeature=wn(),Mn.VectorTileLayer=wi()),Mn}var Lr=yr();const Wr="3d_elevation_id",qn="level";class Ci{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,r){return this._valid&&e(r(this._geometry)),this}require(e,r,o){return this.get(e,!0,r,o)}optional(e,r,o){return this.get(e,!1,r,o)}success(){return this._valid}get(e,r,o,a){const u=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&u!==void 0&&!Number.isNaN(u)?o(a?a(u):u):r&&(this._valid=!1),this}}class Zn{constructor(e,r){this.featureFunc=e,this.vertexFunc=r}parseFeature(e,r,o){return this.featureFunc(e,r,o)}parseVertex(e,r,o){return this.vertexFunc(e,r,o)}}const Sn=new Zn((n,e,r)=>n.reset(e).require(Wr,o=>{r.id=o}).optional("fixed_height_relative",o=>{r.constantHeight=o},hn.decodeRelativeHeight).geometry(o=>{r.bounds=o},xf).success(),(n,e,r)=>n.reset(e).require(Wr,o=>{r.id=o}).require("elevation_idx",o=>{r.idx=o}).require("extent",o=>{r.extent=o}).require("height_relative",o=>{r.height=o},hn.decodeRelativeHeight).geometry(o=>{r.position=o},hn.getPoint).success()),_i=new Zn((n,e,r)=>n.reset(e).require(Wr,o=>{r.id=o}).optional("fixed_height",o=>{r.constantHeight=o},hn.decodeMetricHeight).geometry(o=>{r.bounds=o},xf).success(),(n,e,r)=>n.reset(e).require(Wr,o=>{r.id=o}).require("elevation_idx",o=>{r.idx=o}).require("extent",o=>{r.extent=o}).require("height",o=>{r.height=o},hn.decodeMetricHeight).geometry(o=>{r.position=o},hn.getPoint).success());class hn{static getPoint(e){return Ds(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const r=[],o=[],a=e.length,u=new Ci;for(let g=0;g<a;g++){const v=e.feature(g),x=v.properties.hasOwnProperty("version")?String(v.properties.version):void 0,E=(h=x)?h==="1.0.1"?_i:void 0:Sn;if(E===void 0){Rr(`Unknown elevation feature version number ${x||"(unknown)"}`);continue}const A=v.properties.hasOwnProperty("type")?v.properties.type:void 0;if(A){if(Lr.VectorTileFeature.types[v.type]==="Point"&&A==="curve_point"){const C={};E.parseVertex(u,v,C)&&r.push(C)}else if(Lr.VectorTileFeature.types[v.type]==="Polygon"&&A==="curve_meta"){const C={};E.parseFeature(u,v,C)&&o.push(C)}}}var h;return{vertices:r,features:o}}}class yi{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,o){const a=Un(r,this.dir);if(Math.abs(a)<1e-6)return!1;const u=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1])/a;return o[0]=this.pos[0]+this.dir[0]*u,o[1]=this.pos[1]+this.dir[1]*u,!0}}class Jn{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,o){const a=Br(r,this.dir);if(Math.abs(a)<1e-6)return!1;const u=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/a;return o[0]=this.pos[0]+this.dir[0]*u,o[1]=this.pos[1]+this.dir[1]*u,o[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,r,o){if(function(k,L){var j=k[0],G=k[1],K=k[2],te=L[0],ne=L[1],U=L[2];return Math.abs(j-te)<=ce*Math.max(1,Math.abs(j),Math.abs(te))&&Math.abs(G-ne)<=ce*Math.max(1,Math.abs(G),Math.abs(ne))&&Math.abs(K-U)<=ce*Math.max(1,Math.abs(K),Math.abs(U))}(this.pos,e)||r===0)return o[0]=o[1]=o[2]=0,!1;const[a,u,h]=this.dir,g=this.pos[0]-e[0],v=this.pos[1]-e[1],x=this.pos[2]-e[2],E=a*a+u*u+h*h,A=2*(g*a+v*u+x*h),C=A*A-4*E*(g*g+v*v+x*x-r*r);if(C<0){const k=Math.max(-A/2,0),L=g+a*k,j=v+u*k,G=x+h*k,K=Math.hypot(L,j,G);return o[0]=L*r/K,o[1]=j*r/K,o[2]=G*r/K,!1}{const k=(-A-Math.sqrt(C))/(2*E);if(k<0){const L=Math.hypot(g,v,x);return o[0]=g*r/L,o[1]=v*r/L,o[2]=x*r/L,!1}return o[0]=g+a*k,o[1]=v+u*k,o[2]=x+h*k,!0}}}class kn{constructor(e,r,o,a,u){this.TL=e,this.TR=r,this.BR=o,this.BL=a,this.horizon=u}static fromInvProjectionMatrix(e,r,o){const a=[-1,1,1],u=[1,1,1],h=[1,-1,1],g=[-1,-1,1],v=Ar(a,a,e),x=Ar(u,u,e),E=Ar(h,h,e),A=Ar(g,g,e);return new kn(v,x,E,A,r/o)}}function Xn(n,e,r){let o=1/0,a=-1/0;const u=[];for(const h of n){vi(u,h,e);const g=Br(u,r);o=Math.min(o,g),a=Math.max(a,g)}return[o,a]}function zr(n,e){let r=!0;for(let o=0;o<n.planes.length;o++){const a=n.planes[o];let u=0;for(let h=0;h<e.length;h++)u+=Br(a,e[h])+a[3]>=0;if(u===0)return 0;u!==e.length&&(r=!1)}return r?2:1}function bi(n,e){for(const r of n.projections){const o=Xn(e,n.points[0],r.axis);if(r.projection[1]<o[0]||r.projection[0]>o[1])return 0}return 1}function _s(n,e){let r=0;const o=[0,0,0,0];for(let h=0;h<n.length;h++)o[0]=n[h][0],o[1]=n[h][1],o[2]=n[h][2],o[3]=1,(a=o)[0]*(u=e)[0]+a[1]*u[1]+a[2]*u[2]+a[3]*u[3]>=0&&r++;var a,u;return r}class ri{constructor(e,r){this.points=e||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=Tn.fromPoints(this.points),this.projections=[],this.frustumEdges=[vi([],this.points[2],this.points[3]),vi([],this.points[0],this.points[3]),vi([],this.points[4],this.points[0]),vi([],this.points[5],this.points[1]),vi([],this.points[6],this.points[2]),vi([],this.points[7],this.points[3])];for(const o of this.frustumEdges){const a=[0,-o[2],o[1]],u=[o[2],0,-o[0]];this.projections.push({axis:a,projection:Xn(this.points,this.points[0],a)}),this.projections.push({axis:u,projection:Xn(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(e,r,o,a){const u=Math.pow(2,o),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const E=ds([],x,e),A=1/E[3]/r*u;return(C=E)[0]=(k=E)[0]*(L=[A,A,a?1/E[3]:A,A])[0],C[1]=k[1]*L[1],C[2]=k[2]*L[2],C[3]=k[3]*L[3],C;var C,k,L}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const E=br([],Sr([],vi([],h[x[0]],h[x[1]]),vi([],h[x[2]],h[x[1]]))),A=-Br(E,h[x[1]]);return E.concat(A)}),v=[];for(let x=0;x<h.length;x++)v.push([h[x][0],h[x][1],h[x][2]]);return new ri(v,g)}intersectsPrecise(e,r,o){for(let a=0;a<r.length;a++)if(!_s(e,r[a]))return 0;for(let a=0;a<this.planes.length;a++)if(!_s(e,this.planes[a]))return 0;for(const a of o)for(const u of this.frustumEdges){const h=Sr([],a,u),g=gr(h);if(g===0)continue;Ht(h,h,1/g);const v=Xn(this.points,this.points[0],h),x=Xn(e,this.points[0],h);if(v[0]>x[1]||x[0]>v[1])return 0}return 1}containsPoint(e){for(const r of this.planes){const o=r[3];if(Br([r[0],r[1],r[2]],e)+o<0)return!1}return!0}}class Tn{static fromPoints(e){const r=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(const a of e)At(r,r,a),Tr(o,o,a);return new Tn(r,o)}static fromTileIdAndHeight(e,r,o){const a=1<<e.canonical.z,u=e.canonical.x,h=e.canonical.y;return new Tn([u/a,h/a,r],[(u+1)/a,(h+1)/a,o])}static applyTransform(e,r){const o=e.getCorners();for(let a=0;a<o.length;++a)Ar(o[a],o[a],r);return Tn.fromPoints(o)}static applyTransformFast(e,r){const o=[r[12],r[13],r[14]],a=[...o];for(let u=0;u<3;u++)for(let h=0;h<3;h++){const g=r[4*h+u],v=g*e.min[h],x=g*e.max[h];o[u]+=Math.min(v,x),a[u]+=Math.max(v,x)}return new Tn(o,a)}static projectAabbCorners(e,r){const o=e.getCorners();for(let a=0;a<o.length;++a)Ar(o[a],o[a],r);return o}constructor(e,r){this.min=e,this.max=r,this.center=Ht([],rn([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],o=ui(this.min),a=ui(this.max);for(let u=0;u<r.length;u++)o[u]=r[u]?this.min[u]:this.center[u],a[u]=r[u]?this.center[u]:this.max[u];return a[2]=this.max[2],new Tn(o,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?zr(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?zr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,r){return r||this.intersects(e)?bi(e,this.getCorners()):0}intersectsPreciseFlat(e,r){return r||this.intersectsFlat(e)?bi(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let r=0;r<3;++r)if(this.min[r]>e.max[r]||e.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e.min[r]),this.max[r]=Math.max(this.max[r],e.max[r])}encapsulatePoint(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e[r]),this.max[r]=Math.max(this.max[r],e[r])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Ft(Tn,"Aabb");class bo{constructor(e,r){this.feature=e,this.metersToTile=r,this.index=0}get(){const e=this.feature.vertices[this.index],r=this.feature.vertexProps[this.index].dir,o=r[1],a=-r[0],u=(e.extent+1)*this.metersToTile;return[new ft(Math.trunc(e.position[0]+o*u),Math.trunc(e.position[1]+a*u)),new ft(Math.trunc(e.position[0]-o*u),Math.trunc(e.position[1]-a*u))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class no{constructor(e,r,o,a,u,h){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:o,max:o},this.safeArea=r,this.constantHeight=o,this.constantHeight==null&&(this.constantHeight!=null||a.length!==0)){this.vertices=a,this.edges=u,this.edges=this.edges.filter(g=>{return g.a<this.vertices.length&&g.b<this.vertices.length&&!((v=this.vertices[g.a].position)[0]===(x=this.vertices[g.b].position)[0]&&v[1]===x[1]);var v,x}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const g of this.vertices)this.vertexProps.push({dir:Ds(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,g.height),this.heightRange.max=Math.max(this.heightRange.max,g.height);for(const g of this.edges){const v=this.vertices[g.a].position,x=this.vertices[g.b].position,E=ba(Hi(),x,v),A=ua(E),C=dl(Hi(),E,1/A);this.edgeProps.push({vec:E,dir:C,len:A});const k=this.vertexProps[g.a].dir,L=this.vertexProps[g.b].dir;wa(k,k,C),wa(L,L,C)}for(const g of this.vertexProps)g.dir[0]===0&&g.dir[1]===0||Fa(g.dir,g.dir);this.tessellate(h)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const r=this.getClosestEdge(e);if(r==null)return 0;const[o,a]=r;return lr(this.vertices[this.edges[o].a].height,this.vertices[this.edges[o].b].height,a)}computeSlopeNormal(e,r){const o=this.getClosestEdge(e);if(!o)return Mr(0,0,1);const a=o[0],u=this.edges[a],h=this.edgeProps[a].vec,g=Mr(h[0],h[1],(this.vertices[u.b].height-this.vertices[u.a].height)*r),v=Mr(g[1],-g[0],0);Sr(v,v,g);const x=gr(v);return x>0?Ht(v,v,1/x):Mr(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let r=0,o=Number.POSITIVE_INFINITY,a=0;const u=Ds(e.x,e.y);for(let h=0;h<this.edges.length;h++){const g=this.edges[h],v=this.edgeProps[h].dir,x=new yi(u,this.edgeProps[h].dir),E=this.vertices[g.a].position,A=this.vertices[g.b].position,C=Hi(),k=Hi(),L=x.intersectsPlane(E,this.vertexProps[g.a].dir,C),j=x.intersectsPlane(A,this.vertexProps[g.b].dir,k);if(!L||!j)continue;const G=ba(Hi(),k,C),K=ba(Hi(),u,C),te=Un(G,G),ne=te>0?Un(K,G)/te:0,U=me(ne,0,1),ee=Math.abs((ne-U)*this.edgeProps[h].len),ie=ba(Hi(),u,E),ae=ee+Math.abs(Un(ie,Ds(v[1],-v[0])));ae<o&&(r=h,o=ae,a=U)}return[r,a]}tessellate(e){for(let r=this.edges.length-1;r>=0;--r){const o=this.edges[r].a,a=this.edges[r].b,{position:u,height:h,extent:g}=this.vertices[o],{position:v,height:x,extent:E}=this.vertices[a],A=this.vertexProps[o].dir,C=this.vertexProps[a].dir,k=Mr(u[0]/e,u[1]/e,h),L=Mr(v[0]/e,v[1]/e,x),j=Mr(A[1],-A[0],0);Ht(j,j,g);const G=Mr(C[1],-C[0],0);if(Ht(G,G,E),this.distSqLines(Mr(k[0]+.5*j[0],k[1]+.5*j[1],k[2]+.5*j[2]),Mr(L[0]-.5*G[0],L[1]-.5*G[1],L[2]-.5*G[2]),Mr(k[0]-.5*j[0],k[1]-.5*j[1],k[2]-.5*j[2]),Mr(L[0]+.5*G[0],L[1]+.5*G[1],L[2]+.5*G[2]))<=.0025000000000000005)continue;const K=this.vertices.length,te=wa(Hi(),u,v);this.vertices.push({position:dl(te,te,.5),height:.5*(h+x),extent:.5*(g+E)});const ne=wa(Hi(),A,C);this.vertexProps.push({dir:Fa(ne,ne)}),this.edges.splice(r,1),this.edgeProps.splice(r,1),this.edges.push({a:o,b:K}),this.edges.push({a:K,b:a});const U=ba(Hi(),this.vertices[K].position,u),ee=ua(U),ie={vec:U,dir:dl(Hi(),U,1/ee),len:ee};this.edgeProps.push(ie),this.edgeProps.push(ie)}}distSqLines(e,r,o,a){const u=nn(fn(),r,e),h=nn(fn(),a,o),g=nn(fn(),e,o),v=Br(u,u),x=Br(u,h),E=Br(u,g),A=Br(h,h),C=Br(h,g),k=v*A-x*x;if(k===0){const G=Br(g,h)/Br(h,h);return Ot(vn(fn(),o,a,G),e)}const L=(x*C-E*A)/k,j=(v*C-x*E)/k;return Ot(vn(fn(),e,r,L),vn(fn(),o,a,j))}}class na{static parseFrom(e,r){const o=hn.parse(e);if(!o)return[];let{vertices:a,features:u}=o;const h=1/$e(r);u.sort((E,A)=>E.id-A.id),a.sort((E,A)=>E.id-A.id||E.idx-A.idx),a=a.filter((E,A,C)=>A===C.findIndex(k=>k.id===E.id&&k.idx===E.idx));const g=new Array;let v=0;const x=a.length;for(const E of u){if(E.constantHeight){g.push(new no(E.id,E.bounds,E.constantHeight));continue}for(;v!==x&&a[v].id<E.id;)v++;if(v===x||a[v].id!==E.id)continue;const A=new Array,C=new Array,k=v;for(;v!==x&&a[v].id===E.id;){const L=a[v];if(A.push({position:L.position,height:L.height,extent:L.extent}),v!==k&&a[v-1].idx===L.idx-1){const j=v-k;C.push({a:j-1,b:j})}v++}g.push(new no(E.id,E.bounds,void 0,A,C,h))}return g}static getElevationFeature(e,r){if(!r)return;const o=+e.properties[Wr];return Number.isNaN(o)?void 0:r.find(a=>a.id===o)}}class Ji{constructor(e,r){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(r)||(this.zScale=Math.pow(2,r.z-e.z),this.xOffset=(e.x*this.zScale-r.x)*Ct,this.yOffset=(e.y*this.zScale-r.y)*Ct)}constantElevation(e,r){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,r)}pointElevation(e,r,o){const a=this.constantElevation(r,o);return a??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(r.pointElevation(e),o))}computeBiasedHeight(e,r){return r<=0?e:e+r*Ae(0,r,e>=0?e:Math.abs(.5*e))}}Ft(no,"ElevationFeature");class jo{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new rl,this.indexArray=new as,this.segments=new $n,this.programConfigurations=new l(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Cl),this.worldview=e.worldview}updateFootprints(e,r){}populate(e,r,o,a){const u=this.layers[0],h=[];let g=null;u.type==="circle"&&(g=u.layout.get("circle-sort-key"));for(const{feature:x,id:E,index:A,sourceLayerIndex:C}of e){const k=this.layers[0]._featureFilter.needGeometry,L=Mt(x,k);if(!this.layers[0]._featureFilter.filter(new zn(this.zoom,{worldview:this.worldview}),L,o))continue;const j=g?g.evaluate(L,{},o):void 0,G={id:E,properties:x.properties,type:x.type,sourceLayerIndex:C,index:A,geometry:k?L.geometry:Lt(x,o,a),patterns:{},sortKey:j};h.push(G)}g&&h.sort((x,E)=>x.sortKey-E.sortKey);let v=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new Vd,v=a.projection);for(const x of h){const{geometry:E,index:A,sourceLayerIndex:C}=x,k=e[A].feature;this.addFeature(x,E,A,r.availableImages,o,v,r.brightness,r.elevationFeatures),r.featureIndex.insert(k,E,A,C,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,r,o,a,u,h,g){this.programConfigurations.updatePaintArrays(e,r,u,o,a,h,g,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,su.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Rp.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,r,o,a,u,h,g,v){let x;this.elevationMode!=="none"&&(x=na.getElevationFeature(e,v));for(const E of r)for(const A of E){const C=A.x,k=A.y;if(C<0||C>=Ct||k<0||k>=Ct)continue;if(h){const G=h.projectTilePoint(C,k,u),K=h.upVector(u,C,k);this.addGlobeExtVertex(G,K),this.addGlobeExtVertex(G,K),this.addGlobeExtVertex(G,K),this.addGlobeExtVertex(G,K)}const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),j=L.vertexLength;if(this.addCircleVertex(C,k,-1,-1),this.addCircleVertex(C,k,1,-1),this.addCircleVertex(C,k,1,1),this.addCircleVertex(C,k,-1,1),this.elevationMode!=="none"){const G=x?x.pointElevation(new ft(C,k)):0;this.hasElevation=this.hasElevation||G!==0;for(let K=0;K<4;K++)this.elevatedLayoutVertexArray.emplaceBack(G)}this.indexArray.emplaceBack(j,j+1,j+2),this.indexArray.emplaceBack(j,j+2,j+3),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},a,u,g,void 0,this.worldview)}addCircleVertex(e,r,o,a){this.layoutVertexArray.emplaceBack(2*e+(o+1)/2,2*r+(a+1)/2)}addGlobeExtVertex(e,r){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}}function To(n,e){for(let r=0;r<n.length;r++)if(Da(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(Da(n,e[r]))return!0;return!!yc(n,e)}function So(n,e,r){return!!Da(n,e)||!!hu(e,n,r)}function Vo(n,e){if(n.length===1)return td(e,n[0]);for(let r=0;r<e.length;r++){const o=e[r];for(let a=0;a<o.length;a++)if(Da(n,o[a]))return!0}for(let r=0;r<n.length;r++)if(td(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(yc(n,e[r]))return!0;return!1}function Uo(n,e,r){if(n.length>1){if(yc(n,e))return!0;for(let o=0;o<e.length;o++)if(hu(e[o],n,r))return!0}for(let o=0;o<n.length;o++)if(hu(n[o],e,r))return!0;return!1}function yc(n,e){if(n.length===0||e.length===0)return!1;for(let r=0;r<n.length-1;r++){const o=n[r],a=n[r+1];for(let u=0;u<e.length-1;u++)if(ed(o,a,e[u],e[u+1]))return!0}return!1}function ed(n,e,r,o){return jn(n,r,o)!==jn(e,r,o)&&jn(n,e,r)!==jn(n,e,o)}function vc(n,e,r){return(n.x-r.x)*(e.y-r.y)-(n.y-r.y)*(e.x-r.x)}function $f(n,e,r,o){const a=vc(n,e,o),u=vc(n,e,r);if(Math.sign(a)===Math.sign(u))return;const h=vc(r,o,n),g=h+u-a;return Math.sign(h)!==Math.sign(g)?[h/(h-g),u/(u-a)]:void 0}function hu(n,e,r){const o=r*r;if(e.length===1)return n.distSqr(e[0])<o;for(let a=1;a<e.length;a++)if(Kd(n,e[a-1],e[a])<o)return!0;return!1}function Kd(n,e,r){const o=e.distSqr(r);if(o===0)return n.distSqr(e);const a=((n.x-e.x)*(r.x-e.x)+(n.y-e.y)*(r.y-e.y))/o;return n.distSqr(a<0?e:a>1?r:r.sub(e)._mult(a)._add(e))}function td(n,e){let r,o,a,u=!1;for(let h=0;h<n.length;h++){r=n[h];for(let g=0,v=r.length-1;g<r.length;v=g++)o=r[g],a=r[v],o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(u=!u)}return u}function Da(n,e){let r=!1;for(let o=0,a=n.length-1;o<n.length;a=o++){const u=n[o],h=n[a];u.y>e.y!=h.y>e.y&&e.x<(h.x-u.x)*(e.y-u.y)/(h.y-u.y)+u.x&&(r=!r)}return r}function Dl(n,e,r,o,a){for(const h of n)if(e<=h.x&&r<=h.y&&o>=h.x&&a>=h.y)return!0;const u=[new ft(e,r),new ft(e,a),new ft(o,a),new ft(o,r)];if(n.length>2){for(const h of u)if(Da(n,h))return!0}for(let h=0;h<n.length-1;h++)if(sl(n[h],n[h+1],u))return!0;return!1}function sl(n,e,r){const o=r[0],a=r[2];if(n.x<o.x&&e.x<o.x||n.x>a.x&&e.x>a.x||n.y<o.y&&e.y<o.y||n.y>a.y&&e.y>a.y)return!1;const u=jn(n,e,r[0]);return u!==jn(n,e,r[1])||u!==jn(n,e,r[2])||u!==jn(n,e,r[3])}function Ll(n,e,r,o,a,u){let h=e.y-n.y,g=n.x-e.x;if(u=u||0){const v=h*h+g*g;if(v===0)return!0;const x=Math.sqrt(v);h/=x,g/=x}return!((r.x-n.x)*h+(r.y-n.y)*g-u<0||(o.x-n.x)*h+(o.y-n.y)*g-u<0||(a.x-n.x)*h+(a.y-n.y)*g-u<0)}function Gf(n,e,r,o,a,u,h){return!(Ll(n,e,o,a,u,h)||Ll(e,r,o,a,u,h)||Ll(r,n,o,a,u,h)||Ll(o,a,n,e,r,h)||Ll(a,u,n,e,r,h)||Ll(u,o,n,e,r,h))}function Jd(n,e,r){const o=e.paint.get(n).value;return o.kind==="constant"?o.value:r.programConfigurations.get(e.id).getMaxValue(n)}function qf(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Dp(n,e,r,o,a){if(!e[0]&&!e[1])return n;const u=ft.convert(e)._mult(a);r==="viewport"&&u._rotate(-o);const h=[];for(let g=0;g<n.length;g++)h.push(n[g].sub(u));return h}function Hf(n,e,r,o){const a=ft.convert(n)._mult(o);return e==="viewport"&&a._rotate(-r),a}let Lp,Wf;function Tm(n,e,r){var o=2*Math.PI*6378137/256/Math.pow(2,r);return[n*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}Ft(jo,"CircleBucket",{omit:["layers"]});class rd{constructor(e,r,o){this.z=e,this.x=r,this.y=o,this.key=xc(0,e,e,r,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const o=function(u,h,g){var v=Tm(256*u,256*(h=Math.pow(2,g)-h-1),g),x=Tm(256*(u+1),256*(h+1),g);return v[0]+","+v[1]+","+x[0]+","+x[1]}(this.x,this.y,this.z),a=function(u,h,g){let v,x="";for(let E=u;E>0;E--)v=1<<E-1,x+=(h&v?1:0)+(g&v?2:0);return x}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Zf{constructor(e,r){this.wrap=e,this.canonical=r,this.key=xc(e,r.z,r.z,r.x,r.y)}}class io{constructor(e,r,o,a,u){this.overscaledZ=e,this.wrap=r,this.canonical=new rd(o,+a,+u),this.key=r===0&&e===o?this.canonical.key:xc(r,e,o,a,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new io(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new io(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return xc(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return xc(this.wrap*+r,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new io(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,o=2*this.canonical.x,a=2*this.canonical.y;return[new io(r,this.wrap,r,o,a),new io(r,this.wrap,r,o+1,a),new io(r,this.wrap,r,o,a+1),new io(r,this.wrap,r,o+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new io(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new io(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Zf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function xc(n,e,r,o,a){const u=1<<Math.min(r,22);let h=u*(a%u)+o%u;return n&&r<22&&(h+=u*u*((n<0?-2*n-1:2*n)%(1<<2*(22-r)))),16*(32*h+r)+(e-r)}const xy=[n=>{let e=n.canonical.x-1,r=n.wrap;return e<0&&(e=(1<<n.canonical.z)-1,r--),new io(n.overscaledZ,r,n.canonical.z,e,n.canonical.y)},n=>{let e=n.canonical.x+1,r=n.wrap;return e===1<<n.canonical.z&&(e=0,r++),new io(n.overscaledZ,r,n.canonical.z,e,n.canonical.y)},n=>new io(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(n.canonical.y===0?1<<n.canonical.z:n.canonical.y)-1),n=>new io(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];Ft(rd,"CanonicalTileID"),Ft(io,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Op=pn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:d}=Op,p=pn([{name:"a_pos_3",components:3,type:"Int16"}]);var T=pn([{name:"a_pos",type:"Int16",components:2}]);function R(n){return n*y/W}const N=[new Tn([D,D,D],[F,F,F]),new Tn([D,D,D],[0,0,F]),new Tn([0,D,D],[F,0,F]),new Tn([D,0,D],[0,F,F]),new Tn([0,0,D],[F,F,F])];function Z(n,e,r,o=!0){const a=Ht([],n._camera.position,n.worldSize),u=[e,r,1,1];ds(u,u,n.pixelMatrixInverse),Ho(u,u,1/u[3]);const h=br([],vi([],u,a)),g=n.globeMatrix,v=[g[12],g[13],g[14]],x=vi([],v,a),E=gr(x),A=br([],x),C=n.worldSize/(2*Math.PI),k=Br(A,h),L=Math.asin(C/E);if(L<Math.acos(k)){if(!o)return null;const Ee=[],Re=[];Ht(Ee,h,E/k),br(Re,vi(Re,Ee,x)),br(h,rn(h,x,Ht(h,Re,Math.tan(L)*E)))}const j=[];new Jn(a,h).closestPointOnSphere(v,C,j);const G=br([],xi(g,0)),K=br([],xi(g,1)),te=br([],xi(g,2)),ne=Br(G,j),U=Br(K,j),ee=Br(te,j),ie=Oe(Math.asin(-U/C));let ae=Oe(Math.atan2(ne,ee));ae=n.center.lng+function(Ee,Re){const He=(Re-Ee+180)%360-180;return He<-180?He+360:He}(n.center.lng,ae);const Te=pe(ae),ve=me(ue(ie),0,1);return new Ie(Te,ve)}class de{constructor(e,r,o){this.a=vi([],e,o),this.b=vi([],r,o),this.center=o;const a=br([],this.a),u=br([],this.b);this.angle=Math.acos(Br(a,u))}}function De(n,e){if(n.angle===0)return null;let r;return r=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),r<0||r>1?null:function(o,a,u,h){const g=Math.sin(u);return o*(Math.sin((1-h)*u)/g)+a*(Math.sin(h*u)/g)}(n.a[e],n.b[e],n.angle,me(r,0,1))+n.center[e]}function Ge(n){if(n.z<=1)return N[n.z+2*n.y+n.x];const e=Ir(Jt(n));return Tn.fromPoints(e)}function _t(n,e,r){return Ht(n,n,1-r),rt(n,n,e,r)}function tr(n,e,r){for(const o of n)Ar(o,o,e),Ht(o,o,r)}function rr(n,e,r,o){const a=e/n.worldSize,u=n.globeMatrix;if(r.z<=1){const ve=Ge(r).getCorners();return tr(ve,u,a),Tn.fromPoints(ve)}const h=Jt(r,o),g=Ir(h,y+R(n._tileCoverLift));tr(g,u,a);const v=Number.MAX_VALUE,x=[-v,-v,-v],E=[v,v,v];if(h.contains(n.center)){for(const Re of g)At(E,E,Re),Tr(x,x,Re);x[2]=0;const ve=n.point,Ee=[ve.x*a,ve.y*a,0];return At(E,E,Ee),Tr(x,x,Ee),new Tn(E,x)}if(n._tileCoverLift>0){for(const ve of g)At(E,E,ve),Tr(x,x,ve);return new Tn(E,x)}const A=[u[12]*a,u[13]*a,u[14]*a],C=h.getCenter(),k=me(n.center.lat,-85.051129,Ye),L=me(C.lat,-85.051129,Ye),j=pe(n.center.lng),G=ue(k);let K=j-pe(C.lng);const te=G-ue(L);K>.5?K-=1:K<-.5&&(K+=1);let ne=0;Math.abs(K)>Math.abs(te)?ne=K>=0?1:3:(ne=te>=0?0:2,rt(A,A,[u[4]*a,u[5]*a,u[6]*a],-Math.sin(en(te>=0?h.getSouth():h.getNorth()))*y));const U=g[ne],ee=g[(ne+1)%4],ie=new de(U,ee,A),ae=[De(ie,0)||U[0],De(ie,1)||U[1],De(ie,2)||U[2]],Te=sn(n.zoom);if(Te>0){const ve=function({x:Re,y:He,z:ht},it,ut,mt,Ze){const lt=1/(1<<ht);let qe=Re*lt,We=qe+lt,xt=He*lt,bt=xt+lt,ir=0;const qt=(qe+We)/2-mt;return qt>.5?ir=-1:qt<-.5&&(ir=1),qe=((qe+ir)*it-(mt*=it))*ut+mt,We=((We+ir)*it-mt)*ut+mt,xt=(xt*it-(Ze*=it))*ut+Ze,bt=(bt*it-Ze)*ut+Ze,[[qe,bt,0],[We,bt,0],[We,xt,0],[qe,xt,0]]}(r,e,n._pixelsPerMercatorPixel,j,G);for(let Re=0;Re<g.length;Re++)_t(g[Re],ve[Re],Te);const Ee=rn([],ve[ne],ve[(ne+1)%4]);Ht(Ee,Ee,.5),_t(ae,Ee,Te)}for(const ve of g)At(E,E,ve),Tr(x,x,ve);return E[2]=Math.min(U[2],ee[2]),At(E,E,ae),Tr(x,x,ae),new Tn(E,x)}function Jt({x:n,y:e,z:r},o=!1){const a=1/(1<<r),u=new J(xe(n*a),e===(1<<r)-1&&o?-90:Pe((e+1)*a)),h=new J(xe((n+1)*a),e===0&&o?90:Pe(e*a));return new se(u,h)}function Ir(n,e=y){const r=en(n.getNorth()),o=en(n.getSouth()),a=Math.cos(r),u=Math.cos(o),h=Math.sin(r),g=Math.sin(o),v=n.getWest(),x=n.getEast();return[q(u,g,v,e),q(u,g,x,e),q(a,h,x,e),q(a,h,v,e)]}function Or(n,e,r,o){const a=1<<r.z,u=(n/Ct+r.x)/a;return V(Pe((e/Ct+r.y)/a),xe(u),o)}function Ur({min:n,max:e}){return M/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const ys=new Float64Array(16);function at(n){const e=Ur(n),r=Kt(ys,[e,e,e]);return Dt(r,r,Hr([],n.min))}function et(n){const e=(o=n.min,(r=ys)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=o[0],r[13]=o[1],r[14]=o[2],r[15]=1,r);var r,o;const a=1/Ur(n);return Vt(e,e,[a,a,a])}function dt(n){const e=Ct/(2*Math.PI);return n/(2*Math.PI)/e}function or(n,e){return Ct/(512*Math.pow(2,n))*Ur(Ge(e))}function Jr(n,e,r,o,a){const u=dt(r),h=[n,e,-r/(2*Math.PI)],g=Be(new Float64Array(16));return Dt(g,g,h),Vt(g,g,[u,u,u]),jt(g,g,en(-a)),vr(g,g,en(-o)),g}function sn(n){return Ae(w,S,n)}function mn(n,e){const r=V(e.lat,e.lng),o=function(L){const j=V(L._center.lat,L._center.lng);let G=Sr([],Mr(0,1,0),j);const K=Wt([],-L.angle,j);G=Ar(G,G,K),Wt(K,-L._pitch,G);const te=br([],j);return Ht(te,te,R(L.cameraToCenterDistance/L.pixelsPerMeter)),Ar(te,te,K),rn([],j,te)}(n);return h=(a=nn([],o,r))[0],g=a[1],v=a[2],x=(u=r)[0],E=u[1],A=u[2],k=(C=Math.sqrt(h*h+g*g+v*v)*Math.sqrt(x*x+E*E+A*A))&&Br(a,u)/C,Math.acos(Math.min(Math.max(k,-1),1));var a,u,h,g,v,x,E,A,C,k}function En(n,e){return mn(n,e)>Math.PI/2*1.01}const Hs=en(85),Ei=Math.cos(Hs),sh=Math.sin(Hs),wy=Xt(),j0=n=>{const e=[];return n.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),n.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function V0(n,e,r,o,a,u,h,g,v){if(u&&n.queryGeometry.isAboveHorizon)return!1;u&&(v*=n.pixelToTileUnitsFactor);const x=n.tileID.canonical,E=r.projection.upVectorScale(x,r.center.lat,r.worldSize).metersToTile;for(const A of e)for(const C of A){const k=C.add(g),L=a&&r.elevation?r.elevation.exaggeration()*a.getElevationAt(k.x,k.y,!0):0,j=r.projection.projectTilePoint(k.x,k.y,x);if(L>0){const ne=r.projection.upVector(x,k.x,k.y);j.x+=ne[0]*E*L,j.y+=ne[1]*E*L,j.z+=ne[2]*E*L}const G=u?k:fA(j.x,j.y,j.z,o),K=u?n.tilespaceRays.map(ne=>mA(ne,L)):n.queryGeometry.screenGeometry,te=ds([],[j.x,j.y,j.z,1],o);if(!h&&u?v*=te[3]/r.cameraToCenterDistance:h&&!u&&(v*=r.cameraToCenterDistance/te[3]),u){const ne=Pe((C.y/Ct+x.y)/(1<<x.z));v/=r.projection.pixelsPerMeter(ne,1)/ye(1,ne)}if(So(K,G,v))return!0}return!1}function fA(n,e,r,o){const a=ds([],[n,e,r,1],o);return new ft(a[0]/a[3],a[1]/a[3])}const U0=Mr(0,0,0),pA=Mr(0,0,1);function mA(n,e){const r=fn();return U0[2]=e,n.intersectsPlane(U0,pA,r),new ft(r[0],r[1])}class $0 extends jo{}let G0,q0,H0,W0;function Z0(n,{width:e,height:r},o,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*r*o)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*r*o);return n.width=e,n.height=r,n.data=a,n}function X0(n,e,r){const{width:o,height:a}=e;o===n.width&&a===n.height||(by(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,o),height:Math.min(n.height,a)},r,null),n.width=o,n.height=a,n.data=e.data)}function by(n,e,r,o,a,u,h,g){if(a.width===0||a.height===0)return e;if(a.width>n.width||a.height>n.height||r.x>n.width-a.width||r.y>n.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||o.x>e.width-a.width||o.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const v=n.data,x=e.data,E=u===4&&g;for(let A=0;A<a.height;A++){const C=((r.y+A)*n.width+r.x)*u,k=((o.y+A)*e.width+o.x)*u;if(E)for(let L=0;L<a.width;L++){const j=C+L*u+3,G=k+L*u;x[G+0]=255,x[G+1]=255,x[G+2]=255,x[G+3]=v[j]}else if(h)for(let L=0;L<a.width;L++){const j=C+L*u,G=k+L*u,K=new _n(v[j+0]/255,v[j+1]/255,v[j+2]/255,v[j+3]).toNonPremultipliedRenderColor(h).toArray();x[G+0]=K[0],x[G+1]=K[1],x[G+2]=K[2],x[G+3]=K[3]}else for(let L=0;L<a.width*u;L++)x[k+L]=v[C+L]}return e}Ft($0,"HeatmapBucket",{omit:["layers"]});class Qd{constructor(e,r){Z0(this,e,1,r)}resize(e){X0(this,new Qd(e),1)}clone(){return new Qd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,a,u){by(e,r,o,a,u,1,null)}}class so{constructor(e,r){Z0(this,e,4,r)}resize(e){X0(this,new so(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new so({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,a,u,h,g){by(e,r,o,a,u,4,h,g)}}class Y0{constructor(e,r){this.width=e.width,this.height=e.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}function Sm(n){const e={},r=n.resolution||256,o=n.clips?n.clips.length:1,a=n.image||new so({width:r,height:o}),u=(h,g,v)=>{e[n.evaluationKey]=v;const x=n.expression.evaluate(e),E=x?x.toNonPremultipliedRenderColor(null):null;E&&(a.data[h+g+0]=Math.floor(255*E.r),a.data[h+g+1]=Math.floor(255*E.g),a.data[h+g+2]=Math.floor(255*E.b),a.data[h+g+3]=Math.floor(255*E.a))};if(n.clips)for(let h=0,g=0;h<o;++h,g+=4*r)for(let v=0,x=0;v<r;v++,x+=4){const E=v/(r-1),{start:A,end:C}=n.clips[h];u(g,x,A*(1-E)+C*E)}else for(let h=0,g=0;h<r;h++,g+=4)u(0,g,h/(r-1));return a}Ft(Qd,"AlphaImage"),Ft(so,"RGBAImage");const gA=pn([{name:"a_pos",components:2,type:"Int16"}],4),_A=pn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),yA=pn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),vA=pn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Em(n,e,r=2){const o=e&&e.length,a=o?e[0]*r:n.length;let u=K0(n,0,a,r,!0);const h=[];if(!u||u.next===u.prev)return h;let g,v,x;if(o&&(u=function(E,A,C,k){const L=[];for(let j=0,G=A.length;j<G;j++){const K=K0(E,A[j]*k,j<G-1?A[j+1]*k:E.length,k,!1);K===K.next&&(K.steiner=!0),L.push(AA(K))}L.sort(SA);for(let j=0;j<L.length;j++)C=EA(L[j],C);return C}(n,e,u,r)),n.length>80*r){g=1/0,v=1/0;let E=-1/0,A=-1/0;for(let C=r;C<a;C+=r){const k=n[C],L=n[C+1];k<g&&(g=k),L<v&&(v=L),k>E&&(E=k),L>A&&(A=L)}x=Math.max(E-g,A-v),x=x!==0?32767/x:0}return Im(u,h,r,g,v,x,0),h}function K0(n,e,r,o,a){let u;if(a===function(h,g,v,x){let E=0;for(let A=g,C=v-x;A<v;A+=x)E+=(h[C]-h[A])*(h[A+1]+h[C+1]),C=A;return E}(n,e,r,o)>0)for(let h=e;h<r;h+=o)u=t1(h/o|0,n[h],n[h+1],u);else for(let h=r-o;h>=e;h-=o)u=t1(h/o|0,n[h],n[h+1],u);return u&&Fp(u,u.next)&&(Mm(u),u=u.next),u}function Xf(n,e){if(!n)return n;e||(e=n);let r,o=n;do if(r=!1,o.steiner||!Fp(o,o.next)&&Ps(o.prev,o,o.next)!==0)o=o.next;else{if(Mm(o),o=e=o.prev,o===o.next)break;r=!0}while(r||o!==e);return e}function Im(n,e,r,o,a,u,h){if(!n)return;!h&&u&&function(v,x,E,A){let C=v;do C.z===0&&(C.z=Ty(C.x,C.y,x,E,A)),C.prevZ=C.prev,C.nextZ=C.next,C=C.next;while(C!==v);C.prevZ.nextZ=null,C.prevZ=null,function(k){let L,j=1;do{let G,K=k;k=null;let te=null;for(L=0;K;){L++;let ne=K,U=0;for(let ie=0;ie<j&&(U++,ne=ne.nextZ,ne);ie++);let ee=j;for(;U>0||ee>0&&ne;)U!==0&&(ee===0||!ne||K.z<=ne.z)?(G=K,K=K.nextZ,U--):(G=ne,ne=ne.nextZ,ee--),te?te.nextZ=G:k=G,G.prevZ=te,te=G;K=ne}te.nextZ=null,j*=2}while(L>1)}(C)}(n,o,a,u);let g=n;for(;n.prev!==n.next;){const v=n.prev,x=n.next;if(u?wA(n,o,a,u):xA(n))e.push(v.i,n.i,x.i),Mm(n),n=x.next,g=x.next;else if((n=x)===g){h?h===1?Im(n=bA(Xf(n),e),e,r,o,a,u,2):h===2&&TA(n,e,r,o,a,u):Im(Xf(n),e,r,o,a,u,1);break}}}function xA(n){const e=n.prev,r=n,o=n.next;if(Ps(e,r,o)>=0)return!1;const a=e.x,u=r.x,h=o.x,g=e.y,v=r.y,x=o.y,E=Math.min(a,u,h),A=Math.min(g,v,x),C=Math.max(a,u,h),k=Math.max(g,v,x);let L=o.next;for(;L!==e;){if(L.x>=E&&L.x<=C&&L.y>=A&&L.y<=k&&Am(a,g,u,v,h,x,L.x,L.y)&&Ps(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function wA(n,e,r,o){const a=n.prev,u=n,h=n.next;if(Ps(a,u,h)>=0)return!1;const g=a.x,v=u.x,x=h.x,E=a.y,A=u.y,C=h.y,k=Math.min(g,v,x),L=Math.min(E,A,C),j=Math.max(g,v,x),G=Math.max(E,A,C),K=Ty(k,L,e,r,o),te=Ty(j,G,e,r,o);let ne=n.prevZ,U=n.nextZ;for(;ne&&ne.z>=K&&U&&U.z<=te;){if(ne.x>=k&&ne.x<=j&&ne.y>=L&&ne.y<=G&&ne!==a&&ne!==h&&Am(g,E,v,A,x,C,ne.x,ne.y)&&Ps(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,U.x>=k&&U.x<=j&&U.y>=L&&U.y<=G&&U!==a&&U!==h&&Am(g,E,v,A,x,C,U.x,U.y)&&Ps(U.prev,U,U.next)>=0))return!1;U=U.nextZ}for(;ne&&ne.z>=K;){if(ne.x>=k&&ne.x<=j&&ne.y>=L&&ne.y<=G&&ne!==a&&ne!==h&&Am(g,E,v,A,x,C,ne.x,ne.y)&&Ps(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;U&&U.z<=te;){if(U.x>=k&&U.x<=j&&U.y>=L&&U.y<=G&&U!==a&&U!==h&&Am(g,E,v,A,x,C,U.x,U.y)&&Ps(U.prev,U,U.next)>=0)return!1;U=U.nextZ}return!0}function bA(n,e){let r=n;do{const o=r.prev,a=r.next.next;!Fp(o,a)&&Q0(o,r,r.next,a)&&Cm(o,a)&&Cm(a,o)&&(e.push(o.i,r.i,a.i),Mm(r),Mm(r.next),r=n=a),r=r.next}while(r!==n);return Xf(r)}function TA(n,e,r,o,a,u){let h=n;do{let g=h.next.next;for(;g!==h.prev;){if(h.i!==g.i&&CA(h,g)){let v=e1(h,g);return h=Xf(h,h.next),v=Xf(v,v.next),Im(h,e,r,o,a,u,0),void Im(v,e,r,o,a,u,0)}g=g.next}h=h.next}while(h!==n)}function SA(n,e){let r=n.x-e.x;return r===0&&(r=n.y-e.y,r===0)&&(r=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),r}function EA(n,e){const r=function(a,u){let h=u;const g=a.x,v=a.y;let x,E=-1/0;if(Fp(a,h))return h;do{if(Fp(a,h.next))return h.next;if(v<=h.y&&v>=h.next.y&&h.next.y!==h.y){const j=h.x+(v-h.y)*(h.next.x-h.x)/(h.next.y-h.y);if(j<=g&&j>E&&(E=j,x=h.x<h.next.x?h:h.next,j===g))return x}h=h.next}while(h!==u);if(!x)return null;const A=x,C=x.x,k=x.y;let L=1/0;h=x;do{if(g>=h.x&&h.x>=C&&g!==h.x&&J0(v<k?g:E,v,C,k,v<k?E:g,v,h.x,h.y)){const j=Math.abs(v-h.y)/(g-h.x);Cm(h,a)&&(j<L||j===L&&(h.x>x.x||h.x===x.x&&IA(x,h)))&&(x=h,L=j)}h=h.next}while(h!==A);return x}(n,e);if(!r)return e;const o=e1(r,n);return Xf(o,o.next),Xf(r,r.next)}function IA(n,e){return Ps(n.prev,n,e.prev)<0&&Ps(e.next,n,n.next)<0}function Ty(n,e,r,o,a){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*a|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function AA(n){let e=n,r=n;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==n);return r}function J0(n,e,r,o,a,u,h,g){return(a-h)*(e-g)>=(n-h)*(u-g)&&(n-h)*(o-g)>=(r-h)*(e-g)&&(r-h)*(u-g)>=(a-h)*(o-g)}function Am(n,e,r,o,a,u,h,g){return!(n===h&&e===g)&&J0(n,e,r,o,a,u,h,g)}function CA(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(r,o){let a=r;do{if(a.i!==r.i&&a.next.i!==r.i&&a.i!==o.i&&a.next.i!==o.i&&Q0(a,a.next,r,o))return!0;a=a.next}while(a!==r);return!1}(n,e)&&(Cm(n,e)&&Cm(e,n)&&function(r,o){let a=r,u=!1;const h=(r.x+o.x)/2,g=(r.y+o.y)/2;do a.y>g!=a.next.y>g&&a.next.y!==a.y&&h<(a.next.x-a.x)*(g-a.y)/(a.next.y-a.y)+a.x&&(u=!u),a=a.next;while(a!==r);return u}(n,e)&&(Ps(n.prev,n,e.prev)||Ps(n,e.prev,e))||Fp(n,e)&&Ps(n.prev,n,n.next)>0&&Ps(e.prev,e,e.next)>0)}function Ps(n,e,r){return(e.y-n.y)*(r.x-e.x)-(e.x-n.x)*(r.y-e.y)}function Fp(n,e){return n.x===e.x&&n.y===e.y}function Q0(n,e,r,o){const a=Og(Ps(n,e,r)),u=Og(Ps(n,e,o)),h=Og(Ps(r,o,n)),g=Og(Ps(r,o,e));return a!==u&&h!==g||!(a!==0||!Lg(n,r,e))||!(u!==0||!Lg(n,o,e))||!(h!==0||!Lg(r,n,o))||!(g!==0||!Lg(r,e,o))}function Lg(n,e,r){return e.x<=Math.max(n.x,r.x)&&e.x>=Math.min(n.x,r.x)&&e.y<=Math.max(n.y,r.y)&&e.y>=Math.min(n.y,r.y)}function Og(n){return n>0?1:n<0?-1:0}function Cm(n,e){return Ps(n.prev,n,n.next)<0?Ps(n,e,n.next)>=0&&Ps(n,n.prev,e)>=0:Ps(n,e,n.prev)<0||Ps(n,n.next,e)<0}function e1(n,e){const r=Sy(n.i,n.x,n.y),o=Sy(e.i,e.x,e.y),a=n.next,u=e.prev;return n.next=e,e.prev=n,r.next=a,a.prev=r,o.next=r,r.prev=o,u.next=o,o.prev=u,o}function t1(n,e,r,o){const a=Sy(n,e,r);return o?(a.next=o.next,a.prev=o,o.next.prev=a,o.next=a):(a.prev=a,a.next=a),a}function Mm(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Sy(n,e,r){return{i:n,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Fg(n,e){const r=n.length;if(r<=1)return[n];const o=[];let a,u;for(let h=0;h<r;h++){const g=on(n[h]);g!==0&&(n[h].area=Math.abs(g),u===void 0&&(u=g<0),u===g<0?(a&&o.push(a),a=[n[h]]):a.push(n[h]))}if(a&&o.push(a),e>1)for(let h=0;h<o.length;h++)o[h].length<=e||(ss(o[h],e,1,o[h].length-1,MA),o[h]=o[h].slice(0,e));return o}function MA(n,e){return e.area-n.area}function r1(n,e,r=1){if(!n)return null;const o=typeof n=="string"?go.from(n).getPrimary():n.getPrimary(),a=typeof n=="string"?null:n.getSecondary();for(const u of[o,a]){if(!u)continue;const h=u.id.toString();e.has(h)||e.set(h,[]),u.scaleSelf(r),e.get(h).push(u)}return{primary:o.toString(),secondary:a?a.toString():null}}function Ey(n,e,r,o){const a=o.patternDependencies;let u=!1;for(const h of e){const g=h.paint.get(`${n}-pattern`);g.isConstant()||(u=!0),r1(g.constantOr(null),a,r)&&(u=!0)}return u}function Iy(n,e,r,o,a,u){const h=u.patternDependencies;for(const g of e){const v=g.paint.get(`${n}-pattern`).value;if(v.kind!=="constant"){let x=v.evaluate({zoom:o},r,{},u.availableImages);x=x&&x.name?x.name:x;const E=r1(x,h,a);if(!E)continue;const{primary:A,secondary:C}=E;A&&(r.patterns[g.id]=[A,C].filter(Boolean))}}return r}class n1{constructor(){this.polygons=new Map}add(e,...r){this.polygons.has(e)?this.polygons.get(e).push(...r):this.polygons.set(e,r)}merge(e){for(const[r,o]of e.polygons)this.add(r,...o)}}class Yf{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new Yf;let r=[];for(const x of e)r.push(...x.portals);if(r.length===0)return new Yf;const o=(x,E)=>x<=0&&E<=0||x>=Ct&&E>=Ct;for(const x of r){const E=x.va,A=x.vb;(o(E.x,A.x)||o(E.y,A.y))&&(x.type="border")}const a=r.filter(x=>x.type!=="unevaluated"),u=r.filter(x=>x.type==="unevaluated");if(u.length===0)return new Yf;u.sort((x,E)=>x.hash===E.hash?x.isTunnel===E.isTunnel?0:x.isTunnel?-1:1:x.hash<E.hash?1:-1),r=a.concat(u);let h=a.length,g=h,v=h;do if(g++,g===r.length||r[h].hash!==r[g].hash){if(g-h==2){v<h&&(r[v]=r[h],r[h]=null);const x=r[v],E=r[g-1];x.type=x.isTunnel!==E.isTunnel?"tunnel":"polygon",x.connection={a:x.connection.a,b:E.connection.a},v++}h=g}while(h!==r.length);return r.splice(v),r.sort((x,E)=>x.hash<E.hash?1:-1),{portals:r}}}Ft(Yf,"ElevationPortalGraph"),Ft(n1,"ElevationPolygons");class PA{constructor(e,r,o){this.outPositions=e,this.outNormals=r,this.outIndices=o,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,r,o){let a=e[2];o!=null&&(a*=o);const u=this.getVec3Bits(e)<<96n|this.getVec3Bits(r),h=this.vertexLookup.get(u);if(h!=null)return h;const g=this.outPositions.length;this.vertexLookup.set(u,g);const v=Math.trunc(16384*r[0]),x=Math.trunc(16384*r[1]),E=Math.trunc(16384*r[2]);return this.outPositions.emplaceBack(e[0],e[1],a),this.outNormals.emplaceBack(v,x,E),g}addVertices(e,r,...o){const a=[];for(const u of o){const h=this.addVertex(u,e,r);a.push(h)}return a}addTriangles(e,r,o){if(r&&o){const a=o.length===1,u=Mr(0,0,0);for(let h=0;h<e.length;h+=3){const g=r[e[h+0]],v=r[e[h+1]],x=r[e[h+2]],E=a?o[0]:o[e[h+1]],A=a?o[0]:o[e[h+2]],C=this.addVertex(Mr(g.x,g.y,a?o[0]:o[e[h+0]]),u),k=this.addVertex(Mr(v.x,v.y,E),u),L=this.addVertex(Mr(x.x,x.y,A),u);this.outIndices.emplaceBack(C,k,L)}}else for(let a=0;a<e.length;a+=3)this.outIndices.emplaceBack(e[a+0],e[a+1],e[a+2])}addQuad(e,r){const o=this.addVertices(r,void 0,...e.map(v=>Mr(v.coord.x,v.coord.y,v.height))),[a,u,h,g]=o;this.addTriangles([a,u,h,h,g,a])}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class ol{constructor(e,r,o,a){this.unevaluatedPortals=new Yf,this.portalPolygons=new n1,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new kf,this.vertexNormals=new Bd,this.indexArray=new as,this.tileToMeters=$e(e),this.bridgeProgramConfigurations=new l(r,{zoom:o,lut:a},u=>u!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new l(r,{zoom:o,lut:a},u=>u!=="fill-bridge-guard-rail-color")}addVertices(e,r){const o=this.unevalVertices.length;for(let a=0;a<e.length;a++)this.unevalVertices.push(e[a]),this.unevalHeights.push(r[a]);return o}addTriangles(e,r,o){const a=o?this.unevalTunnelTriangles:this.unevalTriangles;for(const u of e)a.push(u+r)}addRenderableRing(e,r,o,a,u,h){const g=[new ft(u.min.x,u.min.y),new ft(u.max.x,u.min.y),new ft(u.max.x,u.max.y),new ft(u.min.x,u.max.y)];for(let v=0;v<o-1;v++){const x=r+v,E=x+1,A=this.unevalVertices[x],C=this.unevalVertices[E];if(!(A.x>=u.min.x&&A.x<=u.max.x&&A.y>=u.min.y&&A.y<=u.max.y||C.x>=u.min.x&&C.x<=u.max.x&&C.y>=u.min.y&&C.y<=u.max.y||sl(A,C,g))||this.isOnBorder(A.x,C.x)||this.isOnBorder(A.y,C.y))continue;const k=ol.computeEdgeHash(this.unevalVertices[x],this.unevalVertices[E]);let L,j=this.vertexHashLookup.get(ol.computePosHash(A));j!=null?L=j.next:(j=this.vertexHashLookup.get(ol.computePosHash(C)),L=j!=null?j.prev:k),this.unevalEdges.push({polygonIdx:e,a:x,b:E,hash:k,portalHash:L,isTunnel:a,type:"unevaluated",featureInfo:h})}}addPortalCandidates(e,r,o,a,u){if(r.length===0)return;this.portalPolygons.add(e,{geometry:r,zLevel:u});const h=r[0];this.vertexHashLookup.clear();let g=ol.computeEdgeHash(h[h.length-2],h[h.length-1]);for(let v=0;v<h.length-1;v++){const x=h[v+0],E=h[v+1],A=Ds(E.x-x.x,E.y-x.y),C=ua(A);if(C===0)continue;let k="unevaluated";const L=a.pointElevation(x),j=a.pointElevation(E);Math.abs(L)<.01&&Math.abs(j)<.01?k="entrance":(this.isOnBorder(x.x,E.x)||this.isOnBorder(x.y,E.y))&&(k="border");const G=ol.computeEdgeHash(x,E);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:x,vb:E,vab:A,length:C,hash:G,isTunnel:o,type:k});const K=ol.computePosHash(x);this.vertexHashLookup.set(K,{prev:g,next:G}),g=G}}construct(e){if(this.unevalVertices.length===0)return;const r=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),o=C=>{C.primitiveLength=this.indexArray.length-C.primitiveOffset},a=new PA(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const u=r(),h=r(),g=r(),v=(C,k)=>{C.sort((j,G)=>j.type===k&&G.type!==k?-1:j.type!==k&&G.type===k?1:0);const L=C.findIndex(j=>j.type!==k);return L>=0?L:C.length};let x=0;this.unevalEdges.length>0&&(x=v(this.unevalEdges,"none"),this.constructBridgeStructures(a,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:x},this.tileToMeters)),o(g);const E=r(),A=r();if(this.unevalEdges.length>0){const C=this.unevalEdges.splice(x),k=v(C,"tunnel")+x;this.unevalEdges.push(...C),this.constructTunnelStructures(a,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:x},{min:x,max:k})}o(E),a.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),o(A),a.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),o(h),a.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),o(u),this.maskSegments=$n.simpleSegment(0,A.primitiveOffset,0,A.primitiveLength),this.depthSegments=$n.simpleSegment(0,h.primitiveOffset,0,h.primitiveLength),this.renderableBridgeSegments=$n.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.renderableTunnelSegments=$n.simpleSegment(0,E.primitiveOffset,0,E.primitiveLength),this.shadowCasterSegments=$n.simpleSegment(0,u.primitiveOffset,0,u.primitiveLength)}update(e,r,o,a,u,h,g,v){this.bridgeProgramConfigurations.updatePaintArrays(e,r,u,o,a,h,g,v),this.tunnelProgramConfigurations.updatePaintArrays(e,r,u,o,a,h,g,v)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,yA.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,vA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,r,o,a,u){const h=(g,v)=>{for(let x=0;x<v.length-1;x++){const E=v[x].featureIndex,A=v[x+1].vertexStart,C=e.feature(E);g.populatePaintArrays(A,C,E,{},o,r,a,void 0,u)}};h(this.bridgeProgramConfigurations,this.bridgeFeatureSections),h(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,r,o,a,u){const h=new Map;for(let g=a;g<u;g++){const v=o[g],x=v.a,E=v.b,A=ol.computePosHash(e[x]),C=ol.computePosHash(e[E]);h.has(A)||h.set(A,{}),h.has(C)||h.set(C,{});const k=h.get(A),L=h.get(C);r[x]<=0&&r[E]<=0||(k.to=E,L.from=x)}return h}constructBridgeStructures(e,r,o,a,u,h){e.clearVertexLookup();const g=this.computeVertexConnections(r,o,a,u.min,u.max),v=1/h,x=.5*v,E=k=>Mr(r[k].x,r[k].y,o[k]*v),A=k=>{const L=g.get(ol.computePosHash(r[k])),j=L.from,G=L.to;if(!j||!G)return;const K=E(j),te=E(k),ne=E(G),U=Mr(0,0,0);if(!us(K,te)){const ie=vi(fn(),te,K);rn(U,U,br(ie,ie))}if(!us(ne,te)){const ie=vi(fn(),ne,te);rn(U,U,br(ie,ie))}const ee=aa(U);return ee>0?Ht(U,U,1/ee):void 0};let C=Number.POSITIVE_INFINITY;this.sortSubarray(a,u.min,u.max,(k,L)=>k.featureInfo.featureIndex-L.featureInfo.featureIndex);for(let k=u.min;k<u.max;k++){const L=a[k];if(!L.featureInfo.guardRailEnabled)continue;const j=this.prepareEdgePoints(r,o,L,(wr,Gt)=>wr>Gt);if(j==null)continue;const G=j[0],K=j[1],te=Mr(G.coord.x,G.coord.y,v*G.height),ne=Mr(K.coord.x,K.coord.y,v*K.height);if(us(te,ne))continue;const U=vi(fn(),ne,te);br(U,U);const ee=wr=>br(wr,wr),ie=A(L.a)||U,ae=A(L.b)||U,Te=ee(Mr(ie[1],-ie[0],0)),ve=ee(Mr(ae[1],-ae[0],0)),Ee=ee(Sr(fn(),Te,ie)),Re=ee(Sr(fn(),ve,ae)),He=fn(),ht=[rn(fn(),te,Ht(He,vi(He,Te,Ee),x)),rn(fn(),te,Ht(He,rn(He,Te,Ee),x)),rn(fn(),te,Ht(He,Ee,x)),te],it=[rn(fn(),ne,Ht(He,vi(He,ve,Re),x)),rn(fn(),ne,Ht(He,rn(He,ve,Re),x)),rn(fn(),ne,Ht(He,Re,x)),ne];C=this.addFeatureSection(L.featureInfo.featureIndex,C,this.bridgeFeatureSections,e);const[ut,mt]=e.addVertices(Te,h,ht[0],ht[1]),[Ze,lt]=e.addVertices(ve,h,it[0],it[1]);e.addTriangles([ut,mt,Ze,mt,lt,Ze]);const[qe,We]=e.addVertices(Ee,h,ht[1],ht[2]),[xt,bt]=e.addVertices(Re,h,it[1],it[2]);e.addTriangles([qe,We,xt,We,bt,xt]);const[ir,qt]=e.addVertices(Hr(Te,Te),h,ht[2],ht[3]),[zt,yt]=e.addVertices(Hr(ve,ve),h,it[2],it[3]);e.addTriangles([ir,qt,zt,qt,yt,zt])}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,r,o,a,u,h){e.clearVertexLookup();let g=Number.POSITIVE_INFINITY;const v=(E,A)=>E.featureInfo.featureIndex-A.featureInfo.featureIndex;this.sortSubarray(a,u.min,u.max,v),this.sortSubarray(a,h.min,h.max,v);const x=E=>br(E,E);for(let E=u.min;E<u.max;E++){const A=this.prepareEdgePoints(r,o,a[E],(j,G)=>j<G);if(A==null)continue;const[C,k]=A,L=x(Mr(-(k.coord.y-C.coord.y),k.coord.x-C.coord.x,0));g=this.addFeatureSection(a[E].featureInfo.featureIndex,g,this.tunnelFeatureSections,e),e.addQuad([C,k,{coord:k.coord,height:a[E].isTunnel?-.1:0},{coord:C.coord,height:a[E].isTunnel?-.1:0}],L)}for(let E=h.min;E<h.max;E++){const A=a[E];A.isTunnel&&([A.a,A.b]=[A.b,A.a]);const C=r[A.a],k=r[A.b],L=x(Mr(-(k.y-C.y),k.x-C.x,0));g=this.addFeatureSection(A.featureInfo.featureIndex,g,this.tunnelFeatureSections,e),e.addQuad([{coord:k,height:0},{coord:C,height:0},{coord:C,height:o[A.a]+4},{coord:k,height:o[A.b]+4}],L),e.addQuad([{coord:C,height:0},{coord:k,height:0},{coord:k,height:o[A.b]+4},{coord:C,height:o[A.a]+4}],L)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}prepareEdgePoints(e,r,o,a){let u=r[o.a],h=r[o.b];const g=a(u,0),v=a(h,0);if(g&&v)return[{coord:e[o.a],height:u},{coord:e[o.b],height:h}];if(!g&&!v)return;const x=e[o.a].clone(),E=e[o.b].clone();if(g){if(!v){const A=h/(h-u);E.x=lr(E.x,x.x,A),E.y=lr(E.y,x.y,A),h=lr(h,u,A)}}else{const A=u/(u-h);x.x=lr(x.x,E.x,A),x.y=lr(x.y,E.y,A),u=lr(u,h,A)}return[{coord:x,height:u},{coord:E,height:h}]}prepareEdges(e,r){if(r.length===0)return;r.sort((g,v)=>g.hash===v.hash?v.polygonIdx-g.polygonIdx:v.hash>g.hash?1:-1);let o=0,a=0,u=0,h=r[o].polygonIdx;do a++,(a===r.length||r[o].hash!==r[a].hash)&&((a-o==1||r[a-1].polygonIdx!==h)&&(u<o&&(r[u]=r[o],r[o]=null),r[u].type="none",u++),o=a,o!==r.length&&(h=r[o].polygonIdx));while(o!==r.length);if(r.splice(u),r.length!==0&&e.length!==0){r.sort((x,E)=>x.portalHash<E.portalHash?1:-1);let g=0,v=0;for(;g!==r.length&&v!==e.length;){const x=r[g],E=e[v];x.portalHash>E.hash?g++:E.hash>x.portalHash?v++:(x.type=E.type,g++)}}}isOnBorder(e,r){return e<=0&&r<=0||e>=Ct&&r>=Ct}addFeatureSection(e,r,o,a){return e!==r&&(r=e,o.push({featureIndex:e,vertexStart:a.getVertexCount()}),a.clearVertexLookup()),r}sortSubarray(e,r,o,a){const u=e.slice(r,o);u.sort(a),e.splice(r,u.length,...u)}static computeEdgeHash(e,r){return(e.y===r.y&&e.x>r.x||e.y>r.y)&&([e,r]=[r,e]),BigInt(ol.computePosHash(e))<<32n|BigInt(ol.computePosHash(r))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var i1,s1={exports:{}},o1=(i1||(i1=1,function(n,e){(function(r){function o(oe,fe){return oe>fe?1:oe<fe?-1:0}var a=function(oe,fe){oe===void 0&&(oe=o),fe===void 0&&(fe=!1),this._compare=oe,this._root=null,this._size=0,this._noDuplicates=!!fe},u={size:{configurable:!0}};function h(oe,fe,Ke,St,kt){var Rt=kt-St;if(Rt>0){var Ut=St+Math.floor(Rt/2),fr={key:fe[Ut],data:Ke[Ut],parent:oe};return fr.left=h(fr,fe,Ke,St,Ut),fr.right=h(fr,fe,Ke,Ut+1,kt),fr}return null}function g(oe,fe,Ke,St,kt){if(!(Ke>=St)){for(var Rt=oe[Ke+St>>1],Ut=Ke-1,fr=St+1;;){do Ut++;while(kt(oe[Ut],Rt)<0);do fr--;while(kt(oe[fr],Rt)>0);if(Ut>=fr)break;var an=oe[Ut];oe[Ut]=oe[fr],oe[fr]=an,an=fe[Ut],fe[Ut]=fe[fr],fe[fr]=an}g(oe,fe,Ke,fr,kt),g(oe,fe,fr+1,St,kt)}}a.prototype.rotateLeft=function(oe){var fe=oe.right;fe&&(oe.right=fe.left,fe.left&&(fe.left.parent=oe),fe.parent=oe.parent),oe.parent?oe===oe.parent.left?oe.parent.left=fe:oe.parent.right=fe:this._root=fe,fe&&(fe.left=oe),oe.parent=fe},a.prototype.rotateRight=function(oe){var fe=oe.left;fe&&(oe.left=fe.right,fe.right&&(fe.right.parent=oe),fe.parent=oe.parent),oe.parent?oe===oe.parent.left?oe.parent.left=fe:oe.parent.right=fe:this._root=fe,fe&&(fe.right=oe),oe.parent=fe},a.prototype._splay=function(oe){for(;oe.parent;){var fe=oe.parent;fe.parent?fe.left===oe&&fe.parent.left===fe?(this.rotateRight(fe.parent),this.rotateRight(fe)):fe.right===oe&&fe.parent.right===fe?(this.rotateLeft(fe.parent),this.rotateLeft(fe)):fe.left===oe&&fe.parent.right===fe?(this.rotateRight(fe),this.rotateLeft(fe)):(this.rotateLeft(fe),this.rotateRight(fe)):fe.left===oe?this.rotateRight(fe):this.rotateLeft(fe)}},a.prototype.splay=function(oe){for(var fe,Ke,St,kt,Rt;oe.parent;)(Ke=(fe=oe.parent).parent)&&Ke.parent?((St=Ke.parent).left===Ke?St.left=oe:St.right=oe,oe.parent=St):(oe.parent=null,this._root=oe),kt=oe.left,Rt=oe.right,oe===fe.left?(Ke&&(Ke.left===fe?(fe.right?(Ke.left=fe.right,Ke.left.parent=Ke):Ke.left=null,fe.right=Ke,Ke.parent=fe):(kt?(Ke.right=kt,kt.parent=Ke):Ke.right=null,oe.left=Ke,Ke.parent=oe)),Rt?(fe.left=Rt,Rt.parent=fe):fe.left=null,oe.right=fe,fe.parent=oe):(Ke&&(Ke.right===fe?(fe.left?(Ke.right=fe.left,Ke.right.parent=Ke):Ke.right=null,fe.left=Ke,Ke.parent=fe):(Rt?(Ke.left=Rt,Rt.parent=Ke):Ke.left=null,oe.right=Ke,Ke.parent=oe)),kt?(fe.right=kt,kt.parent=fe):fe.right=null,oe.left=fe,fe.parent=oe)},a.prototype.replace=function(oe,fe){oe.parent?oe===oe.parent.left?oe.parent.left=fe:oe.parent.right=fe:this._root=fe,fe&&(fe.parent=oe.parent)},a.prototype.minNode=function(oe){if(oe===void 0&&(oe=this._root),oe)for(;oe.left;)oe=oe.left;return oe},a.prototype.maxNode=function(oe){if(oe===void 0&&(oe=this._root),oe)for(;oe.right;)oe=oe.right;return oe},a.prototype.insert=function(oe,fe){var Ke=this._root,St=null,kt=this._compare;if(this._noDuplicates)for(;Ke;){if(St=Ke,kt(Ke.key,oe)===0)return;Ke=kt(Ke.key,oe)<0?Ke.right:Ke.left}else for(;Ke;)St=Ke,Ke=kt(Ke.key,oe)<0?Ke.right:Ke.left;return Ke={key:oe,data:fe,left:null,right:null,parent:St},St?kt(St.key,Ke.key)<0?St.right=Ke:St.left=Ke:this._root=Ke,this.splay(Ke),this._size++,Ke},a.prototype.find=function(oe){for(var fe=this._root,Ke=this._compare;fe;){var St=Ke(fe.key,oe);if(St<0)fe=fe.right;else{if(!(St>0))return fe;fe=fe.left}}return null},a.prototype.contains=function(oe){for(var fe=this._root,Ke=this._compare;fe;){var St=Ke(oe,fe.key);if(St===0)return!0;fe=St<0?fe.left:fe.right}return!1},a.prototype.remove=function(oe){var fe=this.find(oe);if(!fe)return!1;if(this.splay(fe),fe.left)if(fe.right){var Ke=this.minNode(fe.right);Ke.parent!==fe&&(this.replace(Ke,Ke.right),Ke.right=fe.right,Ke.right.parent=Ke),this.replace(fe,Ke),Ke.left=fe.left,Ke.left.parent=Ke}else this.replace(fe,fe.left);else this.replace(fe,fe.right);return this._size--,!0},a.prototype.removeNode=function(oe){if(!oe)return!1;if(this.splay(oe),oe.left)if(oe.right){var fe=this.minNode(oe.right);fe.parent!==oe&&(this.replace(fe,fe.right),fe.right=oe.right,fe.right.parent=fe),this.replace(oe,fe),fe.left=oe.left,fe.left.parent=fe}else this.replace(oe,oe.left);else this.replace(oe,oe.right);return this._size--,!0},a.prototype.erase=function(oe){var fe=this.find(oe);if(fe){this.splay(fe);var Ke=fe.left,St=fe.right,kt=null;Ke&&(Ke.parent=null,kt=this.maxNode(Ke),this.splay(kt),this._root=kt),St&&(Ke?kt.right=St:this._root=St,St.parent=kt),this._size--}},a.prototype.pop=function(){var oe=this._root,fe=null;if(oe){for(;oe.left;)oe=oe.left;fe={key:oe.key,data:oe.data},this.remove(oe.key)}return fe},a.prototype.next=function(oe){var fe=oe;if(fe)if(fe.right)for(fe=fe.right;fe&&fe.left;)fe=fe.left;else for(fe=oe.parent;fe&&fe.right===oe;)oe=fe,fe=fe.parent;return fe},a.prototype.prev=function(oe){var fe=oe;if(fe)if(fe.left)for(fe=fe.left;fe&&fe.right;)fe=fe.right;else for(fe=oe.parent;fe&&fe.left===oe;)oe=fe,fe=fe.parent;return fe},a.prototype.forEach=function(oe){for(var fe=this._root,Ke=[],St=!1,kt=0;!St;)fe?(Ke.push(fe),fe=fe.left):Ke.length>0?(oe(fe=Ke.pop(),kt++),fe=fe.right):St=!0;return this},a.prototype.range=function(oe,fe,Ke,St){for(var kt=[],Rt=this._compare,Ut=this._root;kt.length!==0||Ut;)if(Ut)kt.push(Ut),Ut=Ut.left;else{if(Rt((Ut=kt.pop()).key,fe)>0)break;if(Rt(Ut.key,oe)>=0&&Ke.call(St,Ut))return this;Ut=Ut.right}return this},a.prototype.keys=function(){for(var oe=this._root,fe=[],Ke=[],St=!1;!St;)oe?(fe.push(oe),oe=oe.left):fe.length>0?(oe=fe.pop(),Ke.push(oe.key),oe=oe.right):St=!0;return Ke},a.prototype.values=function(){for(var oe=this._root,fe=[],Ke=[],St=!1;!St;)oe?(fe.push(oe),oe=oe.left):fe.length>0?(oe=fe.pop(),Ke.push(oe.data),oe=oe.right):St=!0;return Ke},a.prototype.at=function(oe){for(var fe=this._root,Ke=[],St=!1,kt=0;!St;)if(fe)Ke.push(fe),fe=fe.left;else if(Ke.length>0){if(fe=Ke.pop(),kt===oe)return fe;kt++,fe=fe.right}else St=!0;return null},a.prototype.load=function(oe,fe,Ke){if(oe===void 0&&(oe=[]),fe===void 0&&(fe=[]),Ke===void 0&&(Ke=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var St=oe.length;return Ke&&g(oe,fe,0,St-1,this._compare),this._root=h(null,oe,fe,0,St),this._size=St,this},a.prototype.min=function(){var oe=this.minNode(this._root);return oe?oe.key:null},a.prototype.max=function(){var oe=this.maxNode(this._root);return oe?oe.key:null},a.prototype.isEmpty=function(){return this._root===null},u.size.get=function(){return this._size},a.createTree=function(oe,fe,Ke,St,kt){return new a(Ke,kt).load(oe,fe,St)},Object.defineProperties(a.prototype,u);var v=0,x=1,E=2,A=3,C=0,k=1,L=2,j=3;function G(oe,fe,Ke){fe===null?(oe.inOut=!1,oe.otherInOut=!0):(oe.isSubject===fe.isSubject?(oe.inOut=!fe.inOut,oe.otherInOut=fe.otherInOut):(oe.inOut=!fe.otherInOut,oe.otherInOut=fe.isVertical()?!fe.inOut:fe.inOut),fe&&(oe.prevInResult=!K(fe,Ke)||fe.isVertical()?fe.prevInResult:fe));var St=K(oe,Ke);oe.resultTransition=St?function(kt,Rt){var Ut,fr=!kt.inOut,an=!kt.otherInOut;switch(Rt){case C:Ut=fr&&an;break;case k:Ut=fr||an;break;case j:Ut=fr^an;break;case L:Ut=kt.isSubject?fr&&!an:an&&!fr}return Ut?1:-1}(oe,Ke):0}function K(oe,fe){switch(oe.type){case v:switch(fe){case C:return!oe.otherInOut;case k:return oe.otherInOut;case L:return oe.isSubject&&oe.otherInOut||!oe.isSubject&&!oe.otherInOut;case j:return!0}break;case E:return fe===C||fe===k;case A:return fe===L;case x:return!1}return!1}var te=function(oe,fe,Ke,St,kt){this.left=fe,this.point=oe,this.otherEvent=Ke,this.isSubject=St,this.type=kt||v,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ne={inResult:{configurable:!0}};function U(oe,fe){return oe[0]===fe[0]&&oe[1]===fe[1]}te.prototype.isBelow=function(oe){var fe=this.point,Ke=this.otherEvent.point;return this.left?(fe[0]-oe[0])*(Ke[1]-oe[1])-(Ke[0]-oe[0])*(fe[1]-oe[1])>0:(Ke[0]-oe[0])*(fe[1]-oe[1])-(fe[0]-oe[0])*(Ke[1]-oe[1])>0},te.prototype.isAbove=function(oe){return!this.isBelow(oe)},te.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ne.inResult.get=function(){return this.resultTransition!==0},te.prototype.clone=function(){var oe=new te(this.point,this.left,this.otherEvent,this.isSubject,this.type);return oe.contourId=this.contourId,oe.resultTransition=this.resultTransition,oe.prevInResult=this.prevInResult,oe.isExteriorRing=this.isExteriorRing,oe.inOut=this.inOut,oe.otherInOut=this.otherInOut,oe},Object.defineProperties(te.prototype,ne);var ee=11102230246251565e-32,ie=134217729,ae=(3+8*ee)*ee;function Te(oe,fe,Ke,St,kt){var Rt,Ut,fr,an,ln=fe[0],Vr=St[0],Fn=0,Qn=0;Vr>ln==Vr>-ln?(Rt=ln,ln=fe[++Fn]):(Rt=Vr,Vr=St[++Qn]);var cn=0;if(Fn<oe&&Qn<Ke)for(Vr>ln==Vr>-ln?(fr=Rt-((Ut=ln+Rt)-ln),ln=fe[++Fn]):(fr=Rt-((Ut=Vr+Rt)-Vr),Vr=St[++Qn]),Rt=Ut,fr!==0&&(kt[cn++]=fr);Fn<oe&&Qn<Ke;)Vr>ln==Vr>-ln?(fr=Rt-((Ut=Rt+ln)-(an=Ut-Rt))+(ln-an),ln=fe[++Fn]):(fr=Rt-((Ut=Rt+Vr)-(an=Ut-Rt))+(Vr-an),Vr=St[++Qn]),Rt=Ut,fr!==0&&(kt[cn++]=fr);for(;Fn<oe;)fr=Rt-((Ut=Rt+ln)-(an=Ut-Rt))+(ln-an),ln=fe[++Fn],Rt=Ut,fr!==0&&(kt[cn++]=fr);for(;Qn<Ke;)fr=Rt-((Ut=Rt+Vr)-(an=Ut-Rt))+(Vr-an),Vr=St[++Qn],Rt=Ut,fr!==0&&(kt[cn++]=fr);return Rt===0&&cn!==0||(kt[cn++]=Rt),cn}function ve(oe){return new Float64Array(oe)}var Ee=33306690738754716e-32,Re=22204460492503146e-32,He=11093356479670487e-47,ht=ve(4),it=ve(8),ut=ve(12),mt=ve(16),Ze=ve(4);function lt(oe,fe,Ke){var St=function(kt,Rt,Ut,fr,an,ln){var Vr=(Rt-ln)*(Ut-an),Fn=(kt-an)*(fr-ln),Qn=Vr-Fn;if(Vr===0||Fn===0||Vr>0!=Fn>0)return Qn;var cn=Math.abs(Vr+Fn);return Math.abs(Qn)>=Ee*cn?Qn:-function(Ti,ii,Ln,Mi,ai,ei,si){var Bn,qr,Vn,Si,cr,yn,li,Ii,pi,Qi,Hn,Xi,ya,oo,Ws,va,lh,es,vs=Ti-ai,ao=Ln-ai,$o=ii-ei,Eo=Mi-ei;ht[0]=(Ws=(Ii=vs-(li=(yn=ie*vs)-(yn-vs)))*(Qi=Eo-(pi=(yn=ie*Eo)-(yn-Eo)))-((oo=vs*Eo)-li*pi-Ii*pi-li*Qi))-((Hn=Ws-(lh=(Ii=$o-(li=(yn=ie*$o)-(yn-$o)))*(Qi=ao-(pi=(yn=ie*ao)-(yn-ao)))-((va=$o*ao)-li*pi-Ii*pi-li*Qi)))+(cr=Ws-Hn))+(cr-lh),ht[1]=(ya=oo-((Xi=oo+Hn)-(cr=Xi-oo))+(Hn-cr))-((Hn=ya-va)+(cr=ya-Hn))+(cr-va),ht[2]=Xi-((es=Xi+Hn)-(cr=es-Xi))+(Hn-cr),ht[3]=es;var of=function(lB,m2){for(var g2=m2[0],Rv=1;Rv<4;Rv++)g2+=m2[Rv];return g2}(0,ht),ng=Re*si;if(of>=ng||-of>=ng||(Bn=Ti-(vs+(cr=Ti-vs))+(cr-ai),Vn=Ln-(ao+(cr=Ln-ao))+(cr-ai),qr=ii-($o+(cr=ii-$o))+(cr-ei),Si=Mi-(Eo+(cr=Mi-Eo))+(cr-ei),Bn===0&&qr===0&&Vn===0&&Si===0)||(ng=He*si+ae*Math.abs(of),(of+=vs*Si+Eo*Bn-($o*Vn+ao*qr))>=ng||-of>=ng))return of;Ze[0]=(Ws=(Ii=Bn-(li=(yn=ie*Bn)-(yn-Bn)))*(Qi=Eo-(pi=(yn=ie*Eo)-(yn-Eo)))-((oo=Bn*Eo)-li*pi-Ii*pi-li*Qi))-((Hn=Ws-(lh=(Ii=qr-(li=(yn=ie*qr)-(yn-qr)))*(Qi=ao-(pi=(yn=ie*ao)-(yn-ao)))-((va=qr*ao)-li*pi-Ii*pi-li*Qi)))+(cr=Ws-Hn))+(cr-lh),Ze[1]=(ya=oo-((Xi=oo+Hn)-(cr=Xi-oo))+(Hn-cr))-((Hn=ya-va)+(cr=ya-Hn))+(cr-va),Ze[2]=Xi-((es=Xi+Hn)-(cr=es-Xi))+(Hn-cr),Ze[3]=es;var yP=Te(4,ht,4,Ze,it);Ze[0]=(Ws=(Ii=vs-(li=(yn=ie*vs)-(yn-vs)))*(Qi=Si-(pi=(yn=ie*Si)-(yn-Si)))-((oo=vs*Si)-li*pi-Ii*pi-li*Qi))-((Hn=Ws-(lh=(Ii=$o-(li=(yn=ie*$o)-(yn-$o)))*(Qi=Vn-(pi=(yn=ie*Vn)-(yn-Vn)))-((va=$o*Vn)-li*pi-Ii*pi-li*Qi)))+(cr=Ws-Hn))+(cr-lh),Ze[1]=(ya=oo-((Xi=oo+Hn)-(cr=Xi-oo))+(Hn-cr))-((Hn=ya-va)+(cr=ya-Hn))+(cr-va),Ze[2]=Xi-((es=Xi+Hn)-(cr=es-Xi))+(Hn-cr),Ze[3]=es;var vP=Te(yP,it,4,Ze,ut);Ze[0]=(Ws=(Ii=Bn-(li=(yn=ie*Bn)-(yn-Bn)))*(Qi=Si-(pi=(yn=ie*Si)-(yn-Si)))-((oo=Bn*Si)-li*pi-Ii*pi-li*Qi))-((Hn=Ws-(lh=(Ii=qr-(li=(yn=ie*qr)-(yn-qr)))*(Qi=Vn-(pi=(yn=ie*Vn)-(yn-Vn)))-((va=qr*Vn)-li*pi-Ii*pi-li*Qi)))+(cr=Ws-Hn))+(cr-lh),Ze[1]=(ya=oo-((Xi=oo+Hn)-(cr=Xi-oo))+(Hn-cr))-((Hn=ya-va)+(cr=ya-Hn))+(cr-va),Ze[2]=Xi-((es=Xi+Hn)-(cr=es-Xi))+(Hn-cr),Ze[3]=es;var xP=Te(vP,ut,4,Ze,mt);return mt[xP-1]}(kt,Rt,Ut,fr,an,ln,cn)}(oe[0],oe[1],fe[0],fe[1],Ke[0],Ke[1]);return St>0?-1:St<0?1:0}function qe(oe,fe){var Ke=oe.point,St=fe.point;return Ke[0]>St[0]?1:Ke[0]<St[0]?-1:Ke[1]!==St[1]?Ke[1]>St[1]?1:-1:function(kt,Rt,Ut,fr){return kt.left!==Rt.left?kt.left?1:-1:lt(Ut,kt.otherEvent.point,Rt.otherEvent.point)!==0?kt.isBelow(Rt.otherEvent.point)?-1:1:!kt.isSubject&&Rt.isSubject?1:-1}(oe,fe,Ke)}function We(oe,fe,Ke){var St=new te(fe,!1,oe,oe.isSubject),kt=new te(fe,!0,oe.otherEvent,oe.isSubject);return U(oe.point,oe.otherEvent.point)&&console.warn("what is that, a collapsed segment?",oe),St.contourId=kt.contourId=oe.contourId,qe(kt,oe.otherEvent)>0&&(oe.otherEvent.left=!0,kt.left=!1),oe.otherEvent.otherEvent=kt,oe.otherEvent=St,Ke.push(kt),Ke.push(St),Ke}function xt(oe,fe){return oe[0]*fe[1]-oe[1]*fe[0]}function bt(oe,fe){return oe[0]*fe[0]+oe[1]*fe[1]}function ir(oe,fe,Ke){var St=function(an,ln,Vr,Fn,Qn){var cn=[ln[0]-an[0],ln[1]-an[1]],Ti=[Fn[0]-Vr[0],Fn[1]-Vr[1]];function ii(yn,li,Ii){return[yn[0]+li*Ii[0],yn[1]+li*Ii[1]]}var Ln=[Vr[0]-an[0],Vr[1]-an[1]],Mi=xt(cn,Ti),ai=Mi*Mi,ei=bt(cn,cn);if(ai>0){var si=xt(Ln,Ti)/Mi;if(si<0||si>1)return null;var Bn=xt(Ln,cn)/Mi;return Bn<0||Bn>1?null:si===0||si===1?[ii(an,si,cn)]:Bn===0||Bn===1?[ii(Vr,Bn,Ti)]:[ii(an,si,cn)]}if((ai=(Mi=xt(Ln,cn))*Mi)>0)return null;var qr=bt(cn,Ln)/ei,Vn=qr+bt(cn,Ti)/ei,Si=Math.min(qr,Vn),cr=Math.max(qr,Vn);return Si<=1&&cr>=0?Si===1?[ii(an,Si>0?Si:0,cn)]:cr===0?[ii(an,cr<1?cr:1,cn)]:[ii(an,Si>0?Si:0,cn),ii(an,cr<1?cr:1,cn)]:null}(oe.point,oe.otherEvent.point,fe.point,fe.otherEvent.point),kt=St?St.length:0;if(kt===0||kt===1&&(U(oe.point,fe.point)||U(oe.otherEvent.point,fe.otherEvent.point))||kt===2&&oe.isSubject===fe.isSubject)return 0;if(kt===1)return U(oe.point,St[0])||U(oe.otherEvent.point,St[0])||We(oe,St[0],Ke),U(fe.point,St[0])||U(fe.otherEvent.point,St[0])||We(fe,St[0],Ke),1;var Rt=[],Ut=!1,fr=!1;return U(oe.point,fe.point)?Ut=!0:qe(oe,fe)===1?Rt.push(fe,oe):Rt.push(oe,fe),U(oe.otherEvent.point,fe.otherEvent.point)?fr=!0:qe(oe.otherEvent,fe.otherEvent)===1?Rt.push(fe.otherEvent,oe.otherEvent):Rt.push(oe.otherEvent,fe.otherEvent),Ut&&fr||Ut?(fe.type=x,oe.type=fe.inOut===oe.inOut?E:A,Ut&&!fr&&We(Rt[1].otherEvent,Rt[0].point,Ke),2):fr?(We(Rt[0],Rt[1].point,Ke),3):Rt[0]!==Rt[3].otherEvent?(We(Rt[0],Rt[1].point,Ke),We(Rt[1],Rt[2].point,Ke),3):(We(Rt[0],Rt[1].point,Ke),We(Rt[3].otherEvent,Rt[2].point,Ke),3)}function qt(oe,fe){if(oe===fe)return 0;if(lt(oe.point,oe.otherEvent.point,fe.point)!==0||lt(oe.point,oe.otherEvent.point,fe.otherEvent.point)!==0)return U(oe.point,fe.point)?oe.isBelow(fe.otherEvent.point)?-1:1:oe.point[0]===fe.point[0]?oe.point[1]<fe.point[1]?-1:1:qe(oe,fe)===1?fe.isAbove(oe.point)?-1:1:oe.isBelow(fe.point)?-1:1;if(oe.isSubject!==fe.isSubject)return oe.isSubject?-1:1;var Ke=oe.point,St=fe.point;return Ke[0]===St[0]&&Ke[1]===St[1]?(Ke=oe.otherEvent.point)[0]===(St=fe.otherEvent.point)[0]&&Ke[1]===St[1]?0:oe.contourId>fe.contourId?1:-1:qe(oe,fe)===1?1:-1}var zt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function yt(oe,fe,Ke,St){var kt,Rt=oe+1,Ut=fe[oe].point,fr=fe.length;for(Rt<fr&&(kt=fe[Rt].point);Rt<fr&&kt[0]===Ut[0]&&kt[1]===Ut[1];){if(!Ke[Rt])return Rt;++Rt<fr&&(kt=fe[Rt].point)}for(Rt=oe-1;Ke[Rt]&&Rt>St;)Rt--;return Rt}zt.prototype.isExterior=function(){return this.holeOf==null};var wr=Zt,Gt=Zt;function Zt(oe,fe){if(!(this instanceof Zt))return new Zt(oe,fe);if(this.data=oe||[],this.length=this.data.length,this.compare=fe||pr,this.length>0)for(var Ke=(this.length>>1)-1;Ke>=0;Ke--)this._down(Ke)}function pr(oe,fe){return oe<fe?-1:oe>fe?1:0}Zt.prototype={push:function(oe){this.data.push(oe),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var oe=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),oe}},peek:function(){return this.data[0]},_up:function(oe){for(var fe=this.data,Ke=this.compare,St=fe[oe];oe>0;){var kt=oe-1>>1,Rt=fe[kt];if(Ke(St,Rt)>=0)break;fe[oe]=Rt,oe=kt}fe[oe]=St},_down:function(oe){for(var fe=this.data,Ke=this.compare,St=this.length>>1,kt=fe[oe];oe<St;){var Rt=1+(oe<<1),Ut=Rt+1,fr=fe[Rt];if(Ut<this.length&&Ke(fe[Ut],fr)<0&&(Rt=Ut,fr=fe[Ut]),Ke(fr,kt)>=0)break;fe[oe]=fr,oe=Rt}fe[oe]=kt}},wr.default=Gt;var Fr=Math.max,kr=Math.min,Zr=0;function jr(oe,fe,Ke,St,kt,Rt){var Ut,fr,an,ln,Vr,Fn;for(Ut=0,fr=oe.length-1;Ut<fr;Ut++)if(ln=oe[Ut+1],Vr=new te(an=oe[Ut],!1,void 0,fe),Fn=new te(ln,!1,Vr,fe),Vr.otherEvent=Fn,an[0]!==ln[0]||an[1]!==ln[1]){Vr.contourId=Fn.contourId=Ke,Rt||(Vr.isExteriorRing=!1,Fn.isExteriorRing=!1),qe(Vr,Fn)>0?Fn.left=!0:Vr.left=!0;var Qn=an[0],cn=an[1];kt[0]=kr(kt[0],Qn),kt[1]=kr(kt[1],cn),kt[2]=Fr(kt[2],Qn),kt[3]=Fr(kt[3],cn),St.push(Vr),St.push(Fn)}}var Xr=[];function Dn(oe,fe,Ke){typeof oe[0][0][0]=="number"&&(oe=[oe]),typeof fe[0][0][0]=="number"&&(fe=[fe]);var St=function(cn,Ti,ii){var Ln=null;return cn.length*Ti.length==0&&(ii===C?Ln=Xr:ii===L?Ln=cn:ii!==k&&ii!==j||(Ln=cn.length===0?Ti:cn)),Ln}(oe,fe,Ke);if(St)return St===Xr?null:St;var kt=[1/0,1/0,-1/0,-1/0],Rt=[1/0,1/0,-1/0,-1/0],Ut=function(cn,Ti,ii,Ln,Mi){var ai,ei,si,Bn,qr,Vn,Si=new wr(null,qe);for(si=0,Bn=cn.length;si<Bn;si++)for(qr=0,Vn=(ai=cn[si]).length;qr<Vn;qr++)(ei=qr===0)&&Zr++,jr(ai[qr],!0,Zr,Si,ii,ei);for(si=0,Bn=Ti.length;si<Bn;si++)for(qr=0,Vn=(ai=Ti[si]).length;qr<Vn;qr++)ei=qr===0,Mi===L&&(ei=!1),ei&&Zr++,jr(ai[qr],!1,Zr,Si,Ln,ei);return Si}(oe,fe,kt,Rt,Ke);if(St=function(cn,Ti,ii,Ln,Mi){var ai=null;return(ii[0]>Ln[2]||Ln[0]>ii[2]||ii[1]>Ln[3]||Ln[1]>ii[3])&&(Mi===C?ai=Xr:Mi===L?ai=cn:Mi!==k&&Mi!==j||(ai=cn.concat(Ti))),ai}(oe,fe,kt,Rt,Ke))return St===Xr?null:St;for(var fr=function(cn){var Ti,ii,Ln=function(si){var Bn,qr,Vn,Si,cr=[];for(qr=0,Vn=si.length;qr<Vn;qr++)((Bn=si[qr]).left&&Bn.inResult||!Bn.left&&Bn.otherEvent.inResult)&&cr.push(Bn);for(var yn=!1;!yn;)for(yn=!0,qr=0,Vn=cr.length;qr<Vn;qr++)qr+1<Vn&&qe(cr[qr],cr[qr+1])===1&&(Si=cr[qr],cr[qr]=cr[qr+1],cr[qr+1]=Si,yn=!1);for(qr=0,Vn=cr.length;qr<Vn;qr++)(Bn=cr[qr]).otherPos=qr;for(qr=0,Vn=cr.length;qr<Vn;qr++)(Bn=cr[qr]).left||(Si=Bn.otherPos,Bn.otherPos=Bn.otherEvent.otherPos,Bn.otherEvent.otherPos=Si);return cr}(cn),Mi={},ai=[],ei=function(){if(!Mi[Ti]){var si=ai.length,Bn=function(cr,yn,li){var Ii=new zt;if(cr.prevInResult!=null){var pi=cr.prevInResult,Qi=pi.outputContourId;if(pi.resultTransition>0){var Hn=yn[Qi];if(Hn.holeOf!=null){var Xi=Hn.holeOf;yn[Xi].holeIds.push(li),Ii.holeOf=Xi,Ii.depth=yn[Qi].depth}else yn[Qi].holeIds.push(li),Ii.holeOf=Qi,Ii.depth=yn[Qi].depth+1}else Ii.holeOf=null,Ii.depth=yn[Qi].depth}else Ii.holeOf=null,Ii.depth=0;return Ii}(Ln[Ti],ai,si),qr=function(cr){Mi[cr]=!0,cr<Ln.length&&Ln[cr]&&(Ln[cr].outputContourId=si)},Vn=Ti,Si=Ti;for(Bn.points.push(Ln[Ti].point);qr(Vn),qr(Vn=Ln[Vn].otherPos),Bn.points.push(Ln[Vn].point),!((Vn=yt(Vn,Ln,Mi,Si))==Si||Vn>=Ln.length)&&Ln[Vn];);ai.push(Bn)}};for(Ti=0,ii=Ln.length;Ti<ii;Ti++)ei();return ai}(function(cn,Ti,ii,Ln,Mi,ai){for(var ei,si,Bn,qr=new a(qt),Vn=[],Si=Math.min(Ln[2],Mi[2]);cn.length!==0;){var cr=cn.pop();if(Vn.push(cr),ai===C&&cr.point[0]>Si||ai===L&&cr.point[0]>Ln[2])break;if(cr.left){si=ei=qr.insert(cr),ei=ei!==(Bn=qr.minNode())?qr.prev(ei):null,si=qr.next(si);var yn=ei?ei.key:null;if(G(cr,yn,ai),si&&ir(cr,si.key,cn)===2&&(G(cr,yn,ai),G(si.key,cr,ai)),ei&&ir(ei.key,cr,cn)===2){var li=ei;G(yn,(li=li!==Bn?qr.prev(li):null)?li.key:null,ai),G(cr,yn,ai)}}else si=ei=qr.find(cr=cr.otherEvent),ei&&si&&(ei=ei!==Bn?qr.prev(ei):null,si=qr.next(si),qr.remove(cr),si&&ei&&ir(ei.key,si.key,cn))}return Vn}(Ut,0,0,kt,Rt,Ke)),an=[],ln=0;ln<fr.length;ln++){var Vr=fr[ln];if(Vr.isExterior()){for(var Fn=[Vr.points],Qn=0;Qn<Vr.holeIds.length;Qn++)Fn.push(fr[Vr.holeIds[Qn]].points);an.push(Fn)}}return an}var ni={UNION:k,DIFFERENCE:L,INTERSECTION:C,XOR:j};r.diff=function(oe,fe){return Dn(oe,fe,L)},r.intersection=function(oe,fe){return Dn(oe,fe,C)},r.operations=ni,r.union=function(oe,fe){return Dn(oe,fe,k)},r.xor=function(oe,fe){return Dn(oe,fe,j)},Object.defineProperty(r,"__esModule",{value:!0})})(e)}(0,s1.exports)),s1.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Ng(n,e,r,o){const a=[],u=o===0?(h,g,v,x,E,A)=>{h.push(new ft(A,v+(A-g)/(x-g)*(E-v)))}:(h,g,v,x,E,A)=>{h.push(new ft(g+(A-v)/(E-v)*(x-g),A))};for(const h of n){const g=[];for(const v of h){if(v.length<=2)continue;const x=[];for(let C=0;C<v.length-1;C++){const k=v[C].x,L=v[C].y,j=v[C+1].x,G=v[C+1].y,K=o===0?k:L,te=o===0?j:G;K<e?te>e&&u(x,k,L,j,G,e):K>r?te<r&&u(x,k,L,j,G,r):x.push(v[C]),te<e&&K>=e&&u(x,k,L,j,G,e),te>r&&K<=r&&u(x,k,L,j,G,r)}let E=v[v.length-1];const A=o===0?E.x:E.y;A>=e&&A<=r&&x.push(E),x.length&&(E=x[x.length-1],x[0].x===E.x&&x[0].y===E.y||x.push(x[0]),g.push(x))}g.length&&a.push(g)}return a}function RA(n,e){const r=Ay(n),o=Ay([e]),a=o1.intersection(r,o);return a==null?[]:a1(a)}function zA(n,e){let o=Ay(n,65536);for(;e.valid();e.next()){const[a,u]=e.get(),h=a.x*65536,g=a.y*65536,v=u.x*65536,x=u.y*65536,E=v-h,A=x-g,C=Math.hypot(E,A),k=Math.trunc(A/C*3),L=-Math.trunc(E/C*3);o=o1.diff(o,[[[h,g],[v,x],[v+k,x+L],[h+k,g+L],[h,g]]])}return a1(o,1/65536)}function Ay(n,e=1){return[n.map(r=>r.map(o=>[o.x*e,o.y*e]))]}function a1(n,e=1){return n.map(r=>r.map((o,a)=>{const u=o.map(h=>new ft(h[0]*e,h[1]*e).round());return a>0&&u.reverse(),u}))}class Cy{constructor(e,r){this.layoutVertexArray=new rl,this.indexArray=new as,this.lineIndexArray=new Pl,this.triangleSegments=new $n,this.lineSegments=new $n,this.programConfigurations=new l(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,r&&(this.elevatedLayoutVertexArray=new Cl)}update(e,r,o,a,u,h,g,v){this.programConfigurations.updatePaintArrays(e,r,u,o,a,h,g,v)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,_A.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,r,o,a,u,h,g){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,o,a,u,h,void 0,g)}}class My{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new Cy(e,!1),this.elevationBufferData=new Cy(e,!0),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,r){}populate(e,r,o,a){this.hasPattern=Ey("fill",this.layers,this.pixelRatio,r);const u=this.layers[0].layout.get("fill-sort-key"),h=[];for(const{feature:g,id:v,index:x,sourceLayerIndex:E}of e){const A=this.layers[0]._featureFilter.needGeometry,C=Mt(g,A);if(!this.layers[0]._featureFilter.filter(new zn(this.zoom,{worldview:this.worldview}),C,o))continue;const k=u?u.evaluate(C,{},o,r.availableImages):void 0,L={id:v,properties:g.properties,type:g.type,sourceLayerIndex:E,index:x,geometry:A?C.geometry:Lt(g,o,a),patterns:{},sortKey:k};h.push(L)}u&&h.sort((g,v)=>g.sortKey-v.sortKey);for(const g of h){const{geometry:v,index:x,sourceLayerIndex:E}=g;if(this.hasPattern){const A=Iy("fill",this.layers,g,this.zoom,this.pixelRatio,r);this.patternFeatures.push(A)}else this.addFeature(g,v,x,o,{},r.availableImages,r.brightness,r.elevationFeatures);r.featureIndex.insert(e[x].feature,v,x,E,this.index)}}update(e,r,o,a,u,h,g){this.bufferData.update(e,r,o,a,u,h,g,this.worldview),this.elevationBufferData.update(e,r,o,a,u,h,g,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,r,o,a,u,h,g,this.worldview)}addFeatures(e,r,o,a,u,h){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,r,o,a,h,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,r,o,a,u,h=[],g,v){const x=Fg(r,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,x,a,o,v):this.addGeometry(x,this.bufferData),this.bufferData.populatePaintArrays(e,o,u,h,a,g,this.worldview),this.elevationBufferData.populatePaintArrays(e,o,u,h,a,g,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,r,o,a,u){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(r,o,a,u,this.worldview))}addElevatedRoadFeature(e,r,o,a,u){const h=new Array,g=na.getElevationFeature(e,u);if(!g)return void this.addGeometry(r,this.bufferData);{const x=this.clipPolygonsToTile(r,1);x.length>0&&h.push({polygons:x,elevationFeature:g,elevationTileID:o})}const v={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},o),featureIndex:a};for(const x of h)if(x.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new ol(x.elevationTileID,this.layers,this.zoom,this.lut));const A=x.elevationFeature.isTunnel();let C=0;e.properties.hasOwnProperty(qn)&&(C=+e.properties[qn]);for(const k of x.polygons)this.elevatedStructures.addPortalCandidates(x.elevationFeature.id,k,A,x.elevationFeature,C)}x.elevationFeature.constantHeight==null&&(x.polygons=this.prepareElevatedPolygons(x.polygons,x.elevationFeature,x.elevationTileID));const E=new Ji(o,x.elevationTileID);this.addElevatedGeometry(x.polygons,E,x.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,a,v)}}addElevatedGeometry(e,r,o,a,u,h){const g={elevation:o,elevationSampler:r,bias:a,index:u,featureInfo:h},[v,x]=this.addGeometry(e,this.elevationBufferData,g);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:v,max:x}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,v),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,x))}addGeometry(e,r,o){let a=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,h=null;o&&(h=o.elevationSampler.constantElevation(o.elevation,o.bias),h!=null&&(a=h,u=h));const g=(v,x,E)=>{if(o!=null)if(x.push(v),h!=null)r.elevatedLayoutVertexArray.emplaceBack(h),E.push(h);else{const A=o.elevationSampler.pointElevation(v,o.elevation,o.bias);r.elevatedLayoutVertexArray.emplaceBack(A),E.push(A),a=Math.min(a,A),u=Math.max(u,A)}};for(const v of e){let x=0;for(const ne of v)x+=ne.length;const E=r.triangleSegments.prepareSegment(x,r.layoutVertexArray,r.indexArray),A=E.vertexLength,C=[],k=[],L=[],j=[],G=[],K=r.layoutVertexArray.length;for(const ne of v){if(ne.length===0)continue;ne!==v[0]&&k.push(C.length/2);const U=r.lineSegments.prepareSegment(ne.length,r.layoutVertexArray,r.lineIndexArray),ee=U.vertexLength;o&&G.push(r.layoutVertexArray.length-K),g(ne[0],L,j),r.layoutVertexArray.emplaceBack(ne[0].x,ne[0].y),r.lineIndexArray.emplaceBack(ee+ne.length-1,ee),C.push(ne[0].x),C.push(ne[0].y);for(let ie=1;ie<ne.length;ie++)g(ne[ie],L,j),r.layoutVertexArray.emplaceBack(ne[ie].x,ne[ie].y),r.lineIndexArray.emplaceBack(ee+ie-1,ee+ie),C.push(ne[ie].x),C.push(ne[ie].y);U.vertexLength+=ne.length,U.primitiveLength+=ne.length}const te=Em(C,k);for(let ne=0;ne<te.length;ne+=3)r.indexArray.emplaceBack(A+te[ne],A+te[ne+1],A+te[ne+2]);if(te.length>0&&o&&this.elevationMode==="hd-road-base"){const ne=o.elevation.isTunnel(),U=o.elevation.safeArea,ee=this.elevatedStructures.addVertices(L,j);this.elevatedStructures.addTriangles(te,ee,ne);const ie=G.length;if(ie>0){for(let ae=0;ae<ie-1;ae++)this.elevatedStructures.addRenderableRing(o.index,G[ae]+ee,G[ae+1]-G[ae],ne,U,o.featureInfo);this.elevatedStructures.addRenderableRing(o.index,G[ie-1]+ee,L.length-G[ie-1],ne,U,o.featureInfo)}}E.vertexLength+=x,E.primitiveLength+=te.length/3}return[a,u]}prepareElevatedPolygons(e,r,o){const a=1/$e(o),u=[];for(const h of e){const g=zA(h,new bo(r,a));u.push(...g)}return u}clipPolygonsToTile(e,r){const o=-r,a=-r,u=Ct+r,h=Ct+r;let g=0;const v=[],x=[];for(;g<e.length;g++){const C=e[g],k=xf(C);(k.min.x>=o&&k.max.x<=u&&k.min.y>=a&&k.max.y<=h?v:x).push(C)}if(v.length===e.length)return e;const E=[new ft(o,a),new ft(u,a),new ft(u,h),new ft(o,h),new ft(o,a)],A=v;for(const C of x)A.push(...RA(C,E));return A}}let l1,c1,u1,h1;Ft(My,"FillBucket",{omit:["layers","patternFeatures"]}),Ft(Cy,"FillBufferData"),Ft(ol,"ElevatedStructures");class Py{constructor(e,r,o,a){if(this.triangleCount=r.length/3,this.min=new ft(0,0),this.max=new ft(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[u,h]=[e[0].clone(),e[0].clone()];for(let A=1;A<e.length;++A){const C=e[A];u.x=Math.min(u.x,C.x),u.y=Math.min(u.y,C.y),h.x=Math.max(h.x,C.x),h.y=Math.max(h.y,C.y)}if(a){const A=Math.ceil(Math.max(h.x-u.x,h.y-u.y)/a);o=Math.max(o,A)}if(o===0)return;this.min=u,this.max=h;const g=this.max.sub(this.min);g.x=Math.max(g.x,1),g.y=Math.max(g.y,1);const v=Math.max(g.x,g.y)/o;this.cellsX=Math.max(1,Math.ceil(g.x/v)),this.cellsY=Math.max(1,Math.ceil(g.y/v)),this.xScale=1/v,this.yScale=1/v;const x=[];for(let A=0;A<this.triangleCount;A++){const C=e[r[3*A+0]].sub(this.min),k=e[r[3*A+1]].sub(this.min),L=e[r[3*A+2]].sub(this.min),j=oh(Math.floor(Math.min(C.x,k.x,L.x)),this.xScale,this.cellsX),G=oh(Math.floor(Math.max(C.x,k.x,L.x)),this.xScale,this.cellsX),K=oh(Math.floor(Math.min(C.y,k.y,L.y)),this.yScale,this.cellsY),te=oh(Math.floor(Math.max(C.y,k.y,L.y)),this.yScale,this.cellsY),ne=new ft(0,0),U=new ft(0,0),ee=new ft(0,0),ie=new ft(0,0);for(let ae=K;ae<=te;++ae){ne.y=U.y=ae*v,ee.y=ie.y=(ae+1)*v;for(let Te=j;Te<=G;++Te)ne.x=ee.x=Te*v,U.x=ie.x=(Te+1)*v,(Gf(C,k,L,ne,U,ie)||Gf(C,k,L,ne,ie,ee))&&x.push({cellIdx:ae*this.cellsX+Te,triIdx:A})}}if(x.length===0)return;x.sort((A,C)=>A.cellIdx-C.cellIdx||A.triIdx-C.triIdx);let E=0;for(;E<x.length;){const A=x[E].cellIdx,C={start:this.payload.length,len:0};for(;E<x.length&&x[E].cellIdx===A;)++C.len,this.payload.push(x[E++].triIdx);this.cells[A]=C}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,r){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const o=oh(e.x-this.min.x,this.xScale,this.cellsX),a=oh(e.y-this.min.y,this.yScale,this.cellsY),u=this.cells[a*this.cellsX+o];if(u){this._lazyInitLookup();for(let h=0;h<u.len;h++){const g=this.payload[u.start+h],v=Math.floor(g/8),x=1<<g%8;if(!(this.lookup[v]&x)&&(this.lookup[v]|=x,r.push(g),r.length===this.triangleCount))return}}}query(e,r,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>r.x||e.y>this.max.y||this.min.y>r.y)return;this._lazyInitLookup();const a=oh(e.x-this.min.x,this.xScale,this.cellsX),u=oh(r.x-this.min.x,this.xScale,this.cellsX),h=oh(e.y-this.min.y,this.yScale,this.cellsY),g=oh(r.y-this.min.y,this.yScale,this.cellsY);for(let v=h;v<=g;v++)for(let x=a;x<=u;x++){const E=this.cells[v*this.cellsX+x];if(E)for(let A=0;A<E.len;A++){const C=this.payload[E.start+A],k=Math.floor(C/8),L=1<<C%8;if(!(this.lookup[k]&L)&&(this.lookup[k]|=L,o.push(C),o.length===this.triangleCount))return}}}}function oh(n,e,r){return Math.max(0,Math.min(r-1,Math.floor(n*e)))}Ft(Py,"TriangleGridIndex");class d1{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,r){for(const o of this.footprints)r.push({footprint:o,id:e})}populate(e,r,o,a){const u=[];for(const{feature:h,id:g,index:v,sourceLayerIndex:x}of e){const E=this.layers[0]._featureFilter.needGeometry,A=Mt(h,E);if(!this.layers[0]._featureFilter.filter(new zn(this.zoom,{worldview:this.worldview}),A,o))continue;const C={id:g,properties:h.properties,type:h.type,sourceLayerIndex:x,index:v,geometry:E?A.geometry:Lt(h,o,a),patterns:{}};u.push(C)}for(const h of u){const{geometry:g,index:v,sourceLayerIndex:x}=h;this.addFeature(h,g,v,o,{},r.availableImages,r.brightness),r.featureIndex.insert(e[v].feature,g,v,x,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,r,o,a,u,h,g){}destroy(){}addFeature(e,r,o,a,u,h=[],g){for(const v of Fg(r,2)){const x=[],E=[],A=[],C=new ft(1/0,1/0),k=new ft(-1/0,-1/0);for(const G of v)if(G.length!==0){G!==v[0]&&A.push(E.length/2);for(let K=0;K<G.length;K++)E.push(G[K].x),E.push(G[K].y),x.push(G[K]),C.x=Math.min(C.x,G[K].x),C.y=Math.min(C.y,G[K].y),k.x=Math.max(k.x,G[K].x),k.y=Math.max(k.y,G[K].y)}const L=Em(E,A),j=new Py(x,L,8,256);this.footprints.push({vertices:x,indices:L,grid:j,min:C,max:k})}}}Ft(d1,"ClipBucket",{omit:["layers"]});const kA=pn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),DA=pn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),LA=pn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),OA=pn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),FA=pn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),NA=pn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:BA}=kA,Bg=Number.MAX_SAFE_INTEGER;function f1(n,e,r,o){return n.order<e||n.order===Bg||!(n.clipMask&r)||function(a,u){return u.length!==0&&u.find(h=>h===a)===void 0}(o,n.clipScope)}function jg(n,e){return n.x-e.x||n.y-e.y}function p1(n,e){return jg(n.min,e.min)===0&&jg(n.max,e.max)===0}function Ry(n,e){return!(n.min.x>e.max.x||n.max.x<e.min.x||n.min.y>e.max.y||n.max.y<e.min.y)}function zy(n,e){if(n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(n[r].sourceId!==e[r].sourceId||!p1(n[r],e[r])||n[r].order!==e[r].order||n[r].clipMask!==e[r].clipMask||!ws(n[r].clipScope,e[r].clipScope))return!1;return!0}function m1(n,e,r){const o=1/Ct,a=1/(1<<r.canonical.z),u=(e.x*o+r.canonical.x)*a+r.wrap,h=(e.y*o+r.canonical.y)*a;return{min:new ft((n.x*o+r.canonical.x)*a+r.wrap,(n.y*o+r.canonical.y)*a),max:new ft(u,h)}}function jA(n,e,r){const o=1<<r.canonical.z,a=((e.x-r.wrap)*o-r.canonical.x)*Ct,u=(e.y*o-r.canonical.y)*Ct;return{min:new ft(((n.x-r.wrap)*o-r.canonical.x)*Ct,(n.y*o-r.canonical.y)*Ct),max:new ft(a,u)}}function g1(n,e,r,o,a,u,h){const g=n.indices,v=n.vertices,x=[];for(let E=o;E<o+a;E+=3){const A=e[r[E+0]+u],C=e[r[E+1]+u],k=e[r[E+2]+u],L=Math.min(A.x,C.x,k.x),j=Math.max(A.x,C.x,k.x),G=Math.min(A.y,C.y,k.y),K=Math.max(A.y,C.y,k.y);x.length=0,n.grid.query(new ft(L,G),new ft(j,K),x);for(let te=0;te<x.length;te++){const ne=x[te];if(Gf(v[g[3*ne+0]],v[g[3*ne+1]],v[g[3*ne+2]],A,C,k,h))return!0}}return!1}function _1(n,e,r,o){if(!n||!r)return!1;let a=n.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(r.vertices.length<n.vertices.length)return _1(r,o,n,e);const u=e.canonical,h=o.canonical,g=Math.pow(2,h.z-u.z);a=n.vertices.map(v=>new ft((v.x+u.x*Ct)*g-h.x*Ct,(v.y+u.y*Ct)*g-h.y*Ct))}return g1(r,a,n.indices,0,n.indices.length,0,0)}function y1(n,e,r,o){const a=Math.pow(2,o.z-r.z);return new ft((n+r.x*Ct)*a-o.x*Ct,(e+r.y*Ct)*a-o.y*Ct)}function v1(n,e){const r=[];e.grid.queryPoint(n,r);const o=e.indices,a=e.vertices;for(let u=0;u<r.length;u++){const h=r[u];if(Da([a[o[3*h+0]],a[o[3*h+1]],a[o[3*h+2]]],n))return!0}return!1}const ky=[new ft(0,0),new ft(Ct,0),new ft(Ct,Ct),new ft(0,Ct)];function x1(n,e){const r=[];let o=[];if(!e||n.length<2)return[n];if(n.length===2)return sl(n[0],n[1],ky)?[n]:[];for(let a=0;a<n.length+2;a++){const u=n[a%n.length],h=n[(a+1)%n.length],g=sl(a===0?n[n.length-1]:n[(a-1)%n.length],u,ky),v=sl(u,h,ky),x=g||v;x&&o.push(u),x&&v||o.length>0&&(o.length>1&&r.push(o),o=[])}return o.length>1&&r.push(o),r}const Dy=Lr.VectorTileFeature.types,VA=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],UA=["fill-extrusion-flood-light-ground-radius"],$A=Math.pow(2,13),GA=Math.pow(2,15)-1,w1=new ft(0,1),ef=2147483648;function Pm(n,e,r,o,a,u,h,g){n.emplaceBack((e<<1)+h,(r<<1)+u,(Math.floor(o*$A)<<1)+a,Math.round(g))}function Rm(n,e,r){n.emplaceBack(e.x*Ct,e.y*Ct,r?1:0)}function Vg(n,e,r,o,a,u){n.emplaceBack(e.x,e.y,(r.x<<1)+o,(r.y<<1)+a,u)}function zm(n,e,r){n.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class b1{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class T1{constructor(){this.centroidXY=new ft(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ft(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ft(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new ft(this.max.x-this.min.x,this.max.y-this.min.y)}}class S1{constructor(){this.acc=new ft(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,r){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=r.x,e.min.y=e.max.y=r.y)}appendEdge(e,r,o){this.accCount++,this.acc._add(r);let a=!!this.borders;r.x<e.min.x?(e.min.x=r.x,a=!0):r.x>e.max.x&&(e.max.x=r.x,a=!0),r.y<e.min.y?(e.min.y=r.y,a=!0):r.y>e.max.y&&(e.max.y=r.y,a=!0),((r.x===0||r.x===Ct)&&r.x===o.x)!=((r.y===0||r.y===Ct)&&r.y===o.y)&&this.processBorderOverlap(r,o),a&&this.checkBorderIntersection(r,o)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,lr(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>Ct!=e.x>Ct&&this.addBorderIntersection(1,lr(r.y,e.y,(Ct-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,lr(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>Ct!=e.y>Ct&&this.addBorderIntersection(3,lr(r.x,e.x,(Ct-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];r<o[0]&&(o[0]=r),r>o[1]&&(o[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,r.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,r.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new ft(0,0):new ft(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0):0}}function E1(n,e){const r=n.add(e)._unit(),o=me(n.x*r.x+n.y*r.y,-1,1);var a,u,h;return a=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(a)))/4*GA*((u=n).x*(h=e).y-u.y*h.x<0?-1:1)}const qA=[n=>n.x<0,n=>n.x>Ct,n=>n.y<0,n=>n.y>Ct];function HA(n,e,r,o){const a=[4];if(o===0)return a;r._mult(o);const u=n.sub(r),h=e.sub(r),g=[n,e,u,h];for(let v=0;v<4;v++)for(const x of g)if(qA[v](x)){a.push(v);break}return a}class I1{constructor(e){this.vertexArray=new tu,this.indexArray=new as,this.programConfigurations=new l(e.layers,{zoom:e.zoom,lut:e.lut},r=>UA.includes(r)),this._segments=new $n,this.hiddenByLandmarkVertexArray=new Zh,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new $n}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,r,o,a=!1){const u=e.length;if(u>2){let h=Math.max(0,this._segments.get().length-1);const g=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[h].length);let v;h!==this._segments.get().length-1&&(h++,this._segmentToGroundQuads[h]=[],this._segmentToRegionTriCounts[h]=[0,0,0,0,0]);{const x=e[0],E=e[1];v=E1(x.sub(e[u-1])._perp()._unit(),E.sub(x)._perp()._unit())}for(let x=0;x<u;x++){const E=x===u-1?0:x+1,A=e[x],C=e[E],k=e[E===u-1?0:E+1],L=C.sub(A)._perp()._unit(),j=E1(L,k.sub(C)._perp()._unit()),G=v,K=j;if(Ly(A,C,r)||a&&M1(A,r)&&M1(C,r)){v=j;continue}const te=g.vertexLength;Vg(this.vertexArray,A,C,1,1,G),Vg(this.vertexArray,A,C,1,0,G),Vg(this.vertexArray,A,C,0,1,K),Vg(this.vertexArray,A,C,0,0,K),g.vertexLength+=4;const ne=HA(A,C,L,o);for(const U of ne)this._segmentToGroundQuads[h].push({id:te,region:U}),this._segmentToRegionTriCounts[h][U]+=2,g.primitiveLength+=2;v=j}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),r=e.length;for(let o=0;o<r;o++)this._segmentToGroundQuads[o].sort((a,u)=>a.region-u.region);for(let o=0;o<r;o++){const a=this._segmentToGroundQuads[o],u=e[o],h=this._segmentToRegionTriCounts[o];h.reduce((v,x)=>v+x,0);let g=0;for(let v=0;v<=4;v++){const x=h[v];if(x!==0){let E=this.regionSegments[v];E||(E=this.regionSegments[v]=new $n);const A={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+g,vertexLength:u.vertexLength,primitiveLength:x};E.get().push(A)}g+=x}for(let v=0;v<a.length;v++){const x=a[v].id;this.indexArray.emplaceBack(x,x+1,x+3),this.indexArray.emplaceBack(x,x+3,x+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,r,o,a,u,h,g){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,r,o,a,u,h,void 0,g)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,DA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,r,o,a,u,h,g,v){this.hasData()&&this.programConfigurations.updatePaintArrays(e,r,o,a,u,h,g,v)}updateHiddenByLandmark(e){if(!this.hasData())return;const r=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const o=e.flags&ef?1:0;for(let a=e.groundVertexArrayOffset;a<r;++a)this.hiddenByLandmarkVertexArray.emplace(a,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,FA.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const r=this.regionSegments[e];r&&r.destroy()}}}}class Ug{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new as,this.footprintVertices=new rl,this.footprintSegments=[],this.layoutVertexArray=new Ku,this.centroidVertexArray=new Yh,this.wallVertexArray=new jf,this.indexArray=new as,this.programConfigurations=new l(e.layers,{zoom:e.zoom,lut:e.lut},r=>VA.includes(r)),this.segments=new $n,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new I1(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,r){}populate(e,r,o,a){this.features=[],this.hasPattern=Ey("fill-extrusion",this.layers,this.pixelRatio,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=$e(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:u,id:h,index:g,sourceLayerIndex:v}of e){const x=this.layers[0]._featureFilter.needGeometry,E=Mt(u,x);if(!this.layers[0]._featureFilter.filter(new zn(this.zoom,{worldview:this.worldview}),E,o))continue;const A={id:h,sourceLayerIndex:v,index:g,geometry:x?E.geometry:Lt(u,o,a),properties:u.properties,type:u.type,patterns:{}},C=this.layoutVertexArray.length,k=Dy[A.type]==="Polygon";if(this.hasPattern)this.features.push(Iy("fill-extrusion",this.layers,A,this.zoom,this.pixelRatio,r));else if(this.wallMode)for(const L of A.geometry)for(const j of x1(L,k))this.addFeature(A,[j],g,o,{},r.availableImages,a,r.brightness);else this.addFeature(A,A.geometry,g,o,{},r.availableImages,a,r.brightness);r.featureIndex.insert(u,A.geometry,g,v,this.index,C)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,r,o,a,u,h){for(const g of this.features){const v=Dy[g.type]==="Polygon",{geometry:x}=g;if(this.wallMode)for(const E of x)for(const A of x1(E,v))this.addFeature(g,[A],g.index,r,o,a,u,h);else this.addFeature(g,x,g.index,r,o,a,u,h)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,r,o,a,u,h,g){this.programConfigurations.updatePaintArrays(e,r,u,o,a,h,g,this.worldview),this.groundEffect.update(e,r,u,o,a,h,g,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,BA),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,OA.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,NA.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,LA.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,o,a,u,h,g,v){const x=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,E=[new ft(0,0),new ft(Ct,Ct)],A=g.projection,C=A.name==="globe",k=this.wallMode||Dy[e.type]==="Polygon",L=new S1;L.centroidDataIndex=this.centroidData.length;const j=new T1,G=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},a)<=0,K=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},a);let te;if(j.height=K,j.vertexArrayOffset=this.layoutVertexArray.length,j.groundVertexArrayOffset=this.groundEffect.vertexArray.length,C&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Vd),this.wallMode){if(C)return void Rr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(r.length!==1)return;te=function(Ee){const Re=Ee[0].x===Ee[Ee.length-1].x&&Ee[0].y===Ee[Ee.length-1].y;(function(zt){let yt=0;const wr=zt.length;for(let Gt=0;Gt<wr;Gt++)yt+=(zt[(Gt+1)%wr].x-zt[Gt].x)*(zt[(Gt+1)%wr].y+zt[Gt].y);return yt>=0})(Ee)||(Ee=Ee.reverse());const ht={geometry:[],joinNormals:[],indices:[]},it=[],ut=[],mt=[];let Ze=Ee.length;for(;Ze>=2&&Ee[Ze-1].equals(Ee[Ze-2]);)Ze--;if(Ze<(Re?3:2))return ht;let lt,qe,We,xt,bt,ir=0;for(;ir<Ze-1&&Ee[ir].equals(Ee[ir+1]);)ir++;Re&&(lt=Ee[Ze-2],bt=Ee[ir].sub(lt)._unit()._perp());for(let zt=ir;zt<Ze;zt++){if(We=zt===Ze-1?Re?Ee[ir+1]:void 0:Ee[zt+1],We&&Ee[zt].equals(We))continue;bt&&(xt=bt),lt&&(qe=lt),lt=Ee[zt],bt=We?We.sub(lt)._unit()._perp():xt,xt=xt||bt;let yt=xt.add(bt);yt.x===0&&yt.y===0||yt._unit();const wr=yt.x*bt.x+yt.y*bt.y,Gt=wr!==0?1/wr:1/0,Zt=xt.x*bt.y-xt.y*bt.x>0;let pr="miter";const Fr=2;pr==="miter"&&Gt>Fr&&(pr="bevel"),pr==="bevel"&&(Gt>100&&(pr="flipbevel"),Gt<Fr&&(pr="miter"));const kr=(Zr,jr,Xr,Dn)=>{const ni=new ft(Zr.x,Zr.y),oe=new ft(Zr.x,Zr.y);ni.x+=jr.x*Dn,ni.y+=jr.y*Dn,oe.x-=jr.x*Math.max(Xr,1),oe.y-=jr.y*Math.max(Xr,1),mt.push(jr),it.push(ni),ut.push(oe)};if(pr==="miter")yt._mult(Gt),kr(lt,yt,0,0);else if(pr==="flipbevel")yt=bt.mult(-1),kr(lt,yt,0,0),kr(lt,yt.mult(-1),0,0);else{const Zr=-Math.sqrt(Gt*Gt-1),jr=Zt?Zr:0,Xr=Zt?0:Zr;qe&&kr(lt,xt,jr,Xr),We&&kr(lt,bt,jr,Xr)}}ht.geometry=[...it,...ut.reverse(),it[0]],ht.joinNormals=[...mt,...mt.reverse(),mt[mt.length-1]];const qt=ht.geometry.length-1;for(let zt=0;zt<qt/2;zt++)if(zt+1<qt/2){let yt=zt,wr=zt+1,Gt=qt-1-zt,Zt=qt-2-zt;yt=yt===0?qt-1:yt-1,wr=wr===0?qt-1:wr-1,Gt=Gt===0?qt-1:Gt-1,Zt=Zt===0?qt-1:Zt-1,ht.indices.push(Gt),ht.indices.push(wr),ht.indices.push(yt),ht.indices.push(Gt),ht.indices.push(Zt),ht.indices.push(wr)}return ht}(r[0]),r=[te.geometry]}const ne=(Ee,Re)=>Ee<(Re.length-1)/2||Ee===Re.length-1,U=this.wallMode?[r]:Fg(r,500);for(let Ee=U.length-1;Ee>=0;Ee--){const Re=U[Ee];(Re.length===0||(ee=Re[0]).every(He=>He.x<=0)||ee.every(He=>He.x>=Ct)||ee.every(He=>He.y<=0)||ee.every(He=>He.y>=Ct))&&U.splice(Ee,1)}var ee;let ie;if(C)ie=k1(U,E,a);else{ie=[];for(const Ee of U)ie.push({polygon:Ee,bounds:E})}const ae=k?this.edgeRadius:0,Te=ae>0&&this.zoom<17,ve=(Ee,Re)=>{if(Ee.length===0)return!1;const He=Ee[Ee.length-1];return Re.x===He.x&&Re.y===He.y};for(const{polygon:Ee,bounds:Re}of ie){let He=0,ht=0;for(const Ze of Ee)k&&!Ze[0].equals(Ze[Ze.length-1])&&Ze.push(Ze[0]),ht+=k?Ze.length-1:Ze.length;const it=this.segments.prepareSegment((k?5:4)*ht,this.layoutVertexArray,this.indexArray);j.footprintSegIdx<0&&(j.footprintSegIdx=this.footprintSegments.length),j.polygonSegIdx<0&&(j.polygonSegIdx=this.polygonSegments.length);const ut={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},mt=new b1;if(mt.vertexOffset=this.footprintVertices.length,mt.indexOffset=3*this.footprintIndices.length,mt.ringIndices=[],k){const Ze=[],lt=[];He=it.vertexLength;for(let We=0;We<Ee.length;We++){const xt=Ee[We];xt.length&&We!==0&&lt.push(Ze.length/2);const bt=[];let ir,qt;ir=xt[1].sub(xt[0])._perp()._unit(),mt.ringIndices.push(xt.length-1);for(let zt=1;zt<xt.length;zt++){const yt=xt[zt],wr=xt[zt===xt.length-1?1:zt+1],Gt=yt.clone();if(ae){qt=wr.sub(yt)._perp()._unit();const Zt=ir.add(qt)._unit(),pr=ae*Math.min(4,1/(ir.x*Zt.x+ir.y*Zt.y));Gt.x+=pr*Zt.x,Gt.y+=pr*Zt.y,Gt.x=Math.round(Gt.x),Gt.y=Math.round(Gt.y),ir=qt}if(!G||ae!==0&&!Te||ve(bt,Gt)||bt.push(Gt),Pm(this.layoutVertexArray,Gt.x,Gt.y,0,0,1,1,0),this.wallMode){const Zt=ne(zt,xt);Rm(this.wallVertexArray,te.joinNormals[zt],!Zt)}it.vertexLength++,this.footprintVertices.emplaceBack(yt.x,yt.y),Ze.push(yt.x,yt.y),C&&zm(this.layoutVertexExtArray,A.projectTilePoint(Gt.x,Gt.y,a),A.upVector(a,Gt.x,Gt.y))}G&&(ae===0||Te)&&(bt.length!==0&&ve(bt,bt[0])&&bt.pop(),this.groundEffect.addData(bt,Re,x))}const qe=this.wallMode?te.indices:Em(Ze,lt);for(let We=0;We<qe.length;We+=3)this.footprintIndices.emplaceBack(mt.vertexOffset+qe[We+0],mt.vertexOffset+qe[We+1],mt.vertexOffset+qe[We+2]),this.indexArray.emplaceBack(He+qe[We],He+qe[We+2],He+qe[We+1]),it.primitiveLength++;mt.indexCount+=qe.length,mt.vertexCount+=this.footprintVertices.length-mt.vertexOffset}for(let Ze=0;Ze<Ee.length;Ze++){const lt=Ee[Ze];L.startRing(j,lt[0]);let qe=lt.length>4&&P1(lt[lt.length-2],lt[0],lt[1]),We=ae?WA(lt[lt.length-2],lt[0],lt[1],ae):0;const xt=[];let bt,ir,qt;ir=lt[1].sub(lt[0])._perp()._unit();let zt=!0;for(let yt=1,wr=0;yt<lt.length;yt++){let Gt=lt[yt-1],Zt=lt[yt];const pr=lt[yt===lt.length-1?1:yt+1];if(L.appendEdge(j,Zt,Gt),Ly(Zt,Gt,Re)){ae&&(ir=pr.sub(Zt)._perp()._unit(),zt=!zt);continue}const Fr=Zt.sub(Gt)._perp(),kr=Fr.x/(Math.abs(Fr.x)+Math.abs(Fr.y)),Zr=Fr.y>0?1:0,jr=Gt.dist(Zt);if(wr+jr>32768&&(wr=0),ae){qt=pr.sub(Zt)._perp()._unit();let oe=C1(Gt,Zt,pr,A1(ir,qt),ae);isNaN(oe)&&(oe=0);const fe=Zt.sub(Gt)._unit();Gt=Gt.add(fe.mult(We))._round(),Zt=Zt.add(fe.mult(-oe))._round(),We=oe,ir=qt,G&&this.zoom>=17&&(ve(xt,Gt)||xt.push(Gt),ve(xt,Zt)||xt.push(Zt))}const Xr=it.vertexLength,Dn=lt.length>4&&P1(Gt,Zt,pr);let ni=R1(wr,qe,zt);if(Pm(this.layoutVertexArray,Gt.x,Gt.y,kr,Zr,0,0,ni),Pm(this.layoutVertexArray,Gt.x,Gt.y,kr,Zr,0,1,ni),this.wallMode){const oe=ne(yt-1,lt),fe=te.joinNormals[yt-1];Rm(this.wallVertexArray,fe,oe),Rm(this.wallVertexArray,fe,oe)}if(wr+=jr,ni=R1(wr,Dn,!zt),qe=Dn,Pm(this.layoutVertexArray,Zt.x,Zt.y,kr,Zr,0,0,ni),Pm(this.layoutVertexArray,Zt.x,Zt.y,kr,Zr,0,1,ni),this.wallMode){const oe=ne(yt,lt),fe=te.joinNormals[yt];Rm(this.wallVertexArray,fe,oe),Rm(this.wallVertexArray,fe,oe)}if(it.vertexLength+=4,this.indexArray.emplaceBack(Xr+0,Xr+1,Xr+2),this.indexArray.emplaceBack(Xr+1,Xr+3,Xr+2),it.primitiveLength+=2,ae){const oe=He+(yt===1?lt.length-2:yt-2),fe=yt===1?He:oe+1;if(this.indexArray.emplaceBack(Xr+1,oe,Xr+3),this.indexArray.emplaceBack(oe,fe,Xr+3),it.primitiveLength+=2,bt===void 0&&(bt=Xr),!Ly(pr,lt[yt],Re)){const Ke=yt===lt.length-1?bt:it.vertexLength;this.indexArray.emplaceBack(Xr+2,Xr+3,Ke),this.indexArray.emplaceBack(Xr+3,Ke+1,Ke),this.indexArray.emplaceBack(Xr+3,fe,Ke+1),it.primitiveLength+=3}zt=!zt}if(C){const oe=this.layoutVertexExtArray,fe=A.projectTilePoint(Gt.x,Gt.y,a),Ke=A.projectTilePoint(Zt.x,Zt.y,a),St=A.upVector(a,Gt.x,Gt.y),kt=A.upVector(a,Zt.x,Zt.y);zm(oe,fe,St),zm(oe,fe,St),zm(oe,Ke,kt),zm(oe,Ke,kt)}}k&&(He+=lt.length-1),G&&ae&&this.zoom>=17&&(xt.length!==0&&ve(xt,xt[0])&&xt.pop(),this.groundEffect.addData(xt,Re,x,ae>0))}this.footprintSegments.push(mt),ut.triangleCount=this.indexArray.length-ut.triangleArrayOffset,this.polygonSegments.push(ut),++j.footprintSegLen,++j.polygonSegLen}if(j.vertexCount=this.layoutVertexArray.length-j.vertexArrayOffset,j.groundVertexCount=this.groundEffect.vertexArray.length-j.groundVertexArrayOffset,j.vertexCount!==0){if(j.centroidXY=L.borders?w1:this.encodeCentroid(L,j),this.centroidData.push(j),L.borders){this.featuresOnBorder.push(L);const Ee=this.featuresOnBorder.length-1;for(let Re=0;Re<L.borders.length;Re++)L.borders[Re][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Re].push(Ee)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,h,a,v,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(e,o,u,h,a,v,this.worldview),this.maxHeight=Math.max(this.maxHeight,K)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((r,o)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){const e=[];for(let g=0;g<this.centroidData.length;g++){const v=this.centroidData[g],x=+(v.min.y+v.max.y>Ct),E=2*x+(+(v.min.x+v.max.x>Ct)^x);for(let A=0;A<v.polygonSegLen;A++){const C=v.polygonSegIdx+A;e.push({centroidIdx:g,subtile:E,polygonSegmentIdx:C,triangleSegmentIdx:this.polygonSegments[C].triangleSegIdx})}}const r=new as;e.sort((g,v)=>g.triangleSegmentIdx===v.triangleSegmentIdx?g.subtile-v.subtile:g.triangleSegmentIdx-v.triangleSegmentIdx);let o=0,a=0,u=0;for(const g of e){if(g.triangleSegmentIdx!==o)break;u++}const h=e.length;for(;a!==e.length;){o=e[a].triangleSegmentIdx;let g=0,v=a,x=a;for(let E=v;E<u&&e[E].subtile===g;E++)x++;for(;v!==u;){const E=e[v];g=E.subtile;const A=this.centroidData[E.centroidIdx].min.clone(),C=this.centroidData[E.centroidIdx].max.clone(),k={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let L=v;L<x;L++){const j=e[L],G=this.polygonSegments[j.polygonSegmentIdx],K=this.centroidData[j.centroidIdx].min,te=this.centroidData[j.centroidIdx].max,ne=this.indexArray.uint16;for(let U=G.triangleArrayOffset;U<G.triangleArrayOffset+G.triangleCount;U++)r.emplaceBack(ne[3*U],ne[3*U+1],ne[3*U+2]);k.primitiveLength+=G.triangleCount,A.x=Math.min(A.x,K.x),A.y=Math.min(A.y,K.y),C.x=Math.max(C.x,te.x),C.y=Math.max(C.y,te.y)}k.primitiveLength>0&&this.triangleSubSegments.push({segment:k,min:A,max:C}),v=x;for(let L=v;L<u&&e[L].subtile===e[v].subtile;L++)x++}a=u;for(let E=a;E<h&&e[E].triangleSegmentIdx===e[a].triangleSegmentIdx;E++)u++}r._trim(),this.indexArray=r}getVisibleSegments(e,r,o){const a=new $n;if(this.wallMode){for(const j of this.triangleSubSegments)a.segments.push(j.segment);return a}let u=0,h=0;const g=1<<e.canonical.z;if(r){const j=r.getMinMaxForTile(e);j&&(u=j.min,h=j.max)}h+=this.maxHeight;const v=e.toUnwrapped();let x;const E=[v.canonical.x/g+v.wrap,v.canonical.y/g],A=[(v.canonical.x+1)/g+v.wrap,(v.canonical.y+1)/g],C=(j,G,K)=>[j[0]*(1-K[0])+G[0]*K[0],j[1]*(1-K[1])+G[1]*K[1]],k=[],L=[];for(const j of this.triangleSubSegments){k[0]=j.min.x/Ct,k[1]=j.min.y/Ct,L[0]=j.max.x/Ct,L[1]=j.max.y/Ct;const G=C(E,A,k),K=C(E,A,L);if(new Tn([G[0],G[1],u],[K[0],K[1],h]).intersectsPrecise(o)===0){x&&(a.segments.push(x),x=void 0);continue}const te=j.segment;x&&x.vertexOffset!==te.vertexOffset&&(a.segments.push(x),x=void 0),x?(x.vertexLength+=te.vertexLength,x.primitiveLength+=te.primitiveLength):x={vertexOffset:te.vertexOffset,primitiveLength:te.primitiveLength,vertexLength:te.vertexLength,primitiveOffset:te.primitiveOffset,sortKey:void 0,vaos:{}}}return x&&a.segments.push(x),a}encodeCentroid(e,r){const o=e.centroid(),a=r.span(),u=Math.min(7,Math.round(a.x*this.tileToMeter/10)),h=Math.min(7,Math.round(a.y*this.tileToMeter/10));return new ft(me(o.x,1,Ct-1)<<3|u,me(o.y,1,Ct-1)<<3|h)}encodeBorderCentroid(e){if(!e.borders)return new ft(0,0);const r=e.borders,o=Number.MAX_VALUE;if(r[0][0]!==o||r[1][0]!==o){const a=r[0][0]!==o?0:1;return new ft(6|(r[0][0]!==o?0:65528),(r[a][0]+r[a][1])/2<<3|6)}{const a=r[2][0]!==o?2:3;return new ft((r[a][0]+r[a][1])/2<<3|6,6|(r[2][0]!==o?0:65528))}}showCentroid(e){const r=this.centroidData[e.centroidDataIndex];r.flags&=ef,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const r=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,a=e.flags&ef?w1:e.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==a.y||u!==a.x){for(let h=r;h<o;++h)this.centroidVertexArray.emplace(h,a.x,a.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,r,o){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const a=r.getReplacementRegionsForTile(e.toUnwrapped());if(zy(this.activeReplacements,a))return;if(this.activeReplacements=a,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const h of this.centroidData)h.flags&=2147483647;const u=[];for(const h of this.activeReplacements){if(h.order<o)continue;const g=Math.max(1,Math.pow(2,h.footprintTileId.canonical.z-e.canonical.z));for(const v of this.centroidData)if(!(v.flags&ef||h.min.x>v.max.x||v.min.x>h.max.x||h.min.y>v.max.y||v.min.y>h.max.y))for(let x=0;x<v.footprintSegLen;x++){const E=this.footprintSegments[v.footprintSegIdx+x];if(u.length=0,ZA(this.footprintVertices,E.vertexOffset,E.vertexCount,h.footprintTileId.canonical,e.canonical,u),g1(h.footprint,u,this.footprintIndices.uint16,E.indexOffset,E.indexCount,-E.vertexOffset,-g)){v.flags|=ef;break}}}for(const h of this.centroidData)this.writeCentroidToBuffer(h);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,r,o){let a=!1;for(let u=0;u<o.footprintSegLen;u++){const h=this.footprintSegments[o.footprintSegIdx+u];let g=0;for(const v of h.ringIndices){for(let x=g,E=v+g-1;x<v+g;E=x++){const A=this.footprintVertices.int16[2*(x+h.vertexOffset)+0],C=this.footprintVertices.int16[2*(x+h.vertexOffset)+1],k=this.footprintVertices.int16[2*(E+h.vertexOffset)+1];C>r!=k>r&&e<(this.footprintVertices.int16[2*(E+h.vertexOffset)+0]-A)*(r-C)/(k-C)+A&&(a=!a)}g=v}}return a}getHeightAtTileCoord(e,r){let o=Number.NEGATIVE_INFINITY,a=!0;const u=4*(e+Ct)*Ct+(r+Ct);if(this.partLookup.hasOwnProperty(u)){const h=this.partLookup[u];return h?{height:h.height,hidden:!!(h.flags&ef)}:void 0}for(const h of this.centroidData)e>h.max.x||h.min.x>e||r>h.max.y||h.min.y>r||this.footprintContainsPoint(e,r,h)&&h&&h.height>o&&(o=h.height,this.partLookup[u]=h,a=!!(h.flags&ef));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:a};this.partLookup[u]=void 0}}function A1(n,e){const r=n.add(e)._unit();return n.x*r.x+n.y*r.y}function WA(n,e,r,o){const a=e.sub(n)._perp()._unit(),u=r.sub(e)._perp()._unit();return C1(n,e,r,A1(a,u),o)}function C1(n,e,r,o,a){const u=Math.sqrt(1-o*o);return Math.min(n.dist(e)/3,e.dist(r)/3,a*u/o)}function Ly(n,e,r){return n.x<r[0].x&&e.x<r[0].x||n.x>r[1].x&&e.x>r[1].x||n.y<r[0].y&&e.y<r[0].y||n.y>r[1].y&&e.y>r[1].y}function M1(n,e){return n.x<e[0].x||n.x>e[1].x||n.y<e[0].y||n.y>e[1].y}function P1(n,e,r){if(n.x<0||n.x>=Ct||e.x<0||e.x>=Ct||r.x<0||r.x>=Ct)return!1;const o=r.sub(e),a=o.perp(),u=n.sub(e);return(o.x*u.x+o.y*u.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(u.x*u.x+u.y*u.y))>-.866&&a.x*u.x+a.y*u.y<0}function R1(n,e,r){const o=e?2|n:-3&n;return r?1|o:-2&o}function z1(){const n=Math.PI/32,e=Math.tan(n),r=W;return r*Math.sqrt(1+2*e*e)-r}function k1(n,e,r){const o=1<<r.z,a=xe(r.x/o),u=xe((r.x+1)/o),h=Pe(r.y/o),g=Pe((r.y+1)/o);return function(v,x,E,A,C=0,k){const L=[];if(!v.length||!E||!A)return L;const j=(ie,ae)=>{for(const Te of ie)L.push({polygon:Te,bounds:ae})},G=Math.ceil(Math.log2(E)),K=Math.ceil(Math.log2(A)),te=G-K,ne=[];for(let ie=0;ie<Math.abs(te);ie++)ne.push(te>0?0:1);for(let ie=0;ie<Math.min(G,K);ie++)ne.push(0),ne.push(1);let U=v;if(U=Ng(U,x[0].y-C,x[1].y+C,1),U=Ng(U,x[0].x-C,x[1].x+C,0),!U.length)return L;const ee=[];for(ne.length?ee.push({polygons:U,bounds:x,depth:0}):j(U,x);ee.length;){const ie=ee.pop(),ae=ie.depth,Te=ne[ae],ve=ie.bounds[0],Ee=ie.bounds[1],Re=Te===0?ve.x:ve.y,He=Te===0?Ee.x:Ee.y,ht=k?k(Te,Re,He):.5*(Re+He),it=Ng(ie.polygons,Re-C,ht+C,Te),ut=Ng(ie.polygons,ht-C,He+C,Te);if(it.length){const mt=[ve,new ft(Te===0?ht:Ee.x,Te===1?ht:Ee.y)];ne.length>ae+1?ee.push({polygons:it,bounds:mt,depth:ae+1}):j(it,mt)}if(ut.length){const mt=[new ft(Te===0?ht:ve.x,Te===1?ht:ve.y),Ee];ne.length>ae+1?ee.push({polygons:ut,bounds:mt,depth:ae+1}):j(ut,mt)}}return L}(n,e,Math.ceil((u-a)/11.25),Math.ceil((h-g)/11.25),1,(v,x,E)=>{if(v===0)return .5*(x+E);{const A=Pe((r.y+x/Ct)/o);return(ue(.5*(Pe((r.y+E/Ct)/o)+A))*o-r.y)*Ct}})}function ZA(n,e,r,o,a,u){const h=Math.pow(2,o.z-a.z);for(let g=0;g<r;g++){let v=n.int16[2*(g+e)+0],x=n.int16[2*(g+e)+1];v=(v+a.x*Ct)*h-o.x*Ct,x=(x+a.y*Ct)*h-o.y*Ct,u.push(new ft(v,x))}}let D1,L1;Ft(Ug,"FillExtrusionBucket",{omit:["layers","features"]}),Ft(T1,"PartData"),Ft(b1,"FootprintSegment"),Ft(S1,"BorderCentroidData"),Ft(I1,"GroundEffect");class Kf extends ft{constructor(e,r,o){super(e,r),this.z=o}}class O1 extends Kf{constructor(e,r,o,a){super(e,r,o),this.w=a}}function F1(n,e,r,o){const a=r==="x"?"y":"x",u=(o-n[r])/(e[r]-n[r]);n[a]=Math.round(n[a]+(e[a]-n[a])*u),n[r]=o,n.hasOwnProperty("z")&&(n.z=lr(n.z,e.z,u)),n.hasOwnProperty("w")&&(n.w=lr(n.w,e.w,u))}function N1(n,e,r,o){const a=r,u=o;for(const h of["x","y"]){let g=n,v=e;g[h]>=v[h]&&(g=e,v=n),g[h]<a&&v[h]>a&&F1(g,v,h,a),g[h]<u&&v[h]>u&&F1(v,g,h,u)}}function $g(n,e,r,o,a,u){const h=[];for(let g=0;g<n.length;g++){const v=n[g];let x;const E=h.length;let A=0;for(let C=0;C<v.length-1;C++){let k=v[C],L=v[C+1],j=0;const G=A;let K,te;u&&(j=Math.hypot(L.x-k.x,L.y-k.y),A+=j,K=k,te=L),k.x<e&&L.x<e||(k.x<e?k=new ft(e,k.y+(e-k.x)/(L.x-k.x)*(L.y-k.y))._round():L.x<e&&(L=new ft(e,k.y+(e-k.x)/(L.x-k.x)*(L.y-k.y))._round()),k.y<r&&L.y<r||(k.y<r?k=new ft(k.x+(r-k.y)/(L.y-k.y)*(L.x-k.x),r)._round():L.y<r&&(L=new ft(k.x+(r-k.y)/(L.y-k.y)*(L.x-k.x),r)._round()),k.x>=o&&L.x>=o||(k.x>=o?k=new ft(o,k.y+(o-k.x)/(L.x-k.x)*(L.y-k.y))._round():L.x>=o&&(L=new ft(o,k.y+(o-k.x)/(L.x-k.x)*(L.y-k.y))._round()),k.y>=a&&L.y>=a||(k.y>=a?k=new ft(k.x+(a-k.y)/(L.y-k.y)*(L.x-k.x),a)._round():L.y>=a&&(L=new ft(k.x+(a-k.y)/(L.y-k.y)*(L.x-k.x),a)._round()),x&&k.equals(x[x.length-1])||(x=[k],h.push(x),u&&u.push({progress:{min:G+B1(K,te,k)*j,max:1},parentIndex:g,prevPoint:K,nextPoint:te})),x.push(L),u&&(u[u.length-1].progress.max=G+B1(K,te,L)*j,u[u.length-1].nextPoint=te)))))}if(u&&A>0)for(let C=E;C<h.length;C++)u[C].progress.min/=A,u[C].progress.max/=A}return h}function XA(n,e,r,o,a){if(n.length<2)return void o.push(n);const u=[];for(;e.valid();){const[x,E]=e.get();for(let A=0;A<n.length-1;A++){const C=n[A],k=n[A+1],L=$f(C,k,x,E);if(L){const[j]=L,G=new ft(lr(C.x,k.x,j),lr(C.y,k.y,j));u.push({t:A+j,distance:0,point:G})}}e.next()}if(u.length===0)return void o.push(n);u.sort((x,E)=>x.t-E.t);let h=0,g=0,v=[];for(o.push(v);h!==n.length;){if(g===u.length){for(;h!==n.length;)v.length!==0&&v[v.length-1].equals(n[h])||v.push(n[h]),h++;break}u[g].t<=h?(v.length!==0&&v[v.length-1].equals(u[g].point)||v.push(u[g].point),Math.trunc(u[g].t),g++):(v.length!==0&&v[v.length-1].equals(n[h])||v.push(n[h]),h++)}}function B1(n,e,r){return n.x!==e.x?(r.x-n.x)/(e.x-n.x):n.y!==e.y?(r.y-n.y)/(e.y-n.y):0}function km(n,e){return n.x*e.x+n.y*e.y}function j1(n,e){if(n.length===1){let r=0;const o=e[r++];let a;for(;!a||o.equals(a);)if(a=e[r++],!a)return 1/0;for(;r<e.length;r++){const u=e[r],h=n[0],g=a.sub(o),v=u.sub(o),x=h.sub(o),E=km(g,g),A=km(g,v),C=km(v,v),k=km(x,g),L=km(x,v),j=E*C-A*A,G=(C*k-A*L)/j,K=(E*L-A*k)/j,te=o.z*(1-G-K)+a.z*G+u.z*K;if(isFinite(te))return te}return 1/0}{let r=1/0;for(const o of e)r=Math.min(r,o.z);return r}}function V1(n,e,r,o,a,u,h,g){const v=h*a.getElevationAt(n,e,!0,!0),x=u[0]!==0,E=x?u[1]===0?h*(u[0]/7-450):h*function(A,C,k){const L=Math.floor(C[0]/8),j=Math.floor(C[1]/8),G=10*(C[0]-8*L),K=10*(C[1]-8*j),te=A.getElevationAt(L,j,!0,!0),ne=A.getMeterToDEM(k),U=Math.floor(.5*(G*ne-1)),ee=Math.floor(.5*(K*ne-1)),ie=A.tileCoordToPixel(L,j),ae=2*U+1,Te=2*ee+1,ve=function(ut,mt,Ze,lt,qe){return[ut.getElevationAtPixel(mt,Ze,!0),ut.getElevationAtPixel(mt+qe,Ze,!0),ut.getElevationAtPixel(mt,Ze+qe,!0),ut.getElevationAtPixel(mt+lt,Ze+qe,!0)]}(A,ie.x-U,ie.y-ee,ae,Te),Ee=Math.abs(ve[0]-ve[1]),Re=Math.abs(ve[2]-ve[3]),He=Math.abs(ve[0]-ve[2])+Math.abs(ve[1]-ve[3]),ht=Math.min(.25,.5*ne*(Ee+Re)/ae),it=Math.min(.25,.5*ne*He/Te);return te+Math.max(ht*G,it*K)}(a,u,g):v;return{base:v+(r===0?-1:r),top:x?Math.max(E+o,v+r+2):v+o}}class YA{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class KA{constructor(){this.tasks={},this.taskQueue=[],$t(["process"],this),this.invoker=new YA(this.process),this.nextId=0}add(e,r){const o=this.nextId++,a=function({type:u,isSymbolTile:h,zoom:g}){return g=g||0,u==="message"?0:u!=="maybePrepare"||h?u!=="parseTile"||h?u==="parseTile"&&h?300-g:u==="maybePrepare"&&h?400-g:500:200-g:100-g}(r);if(a===0){try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:r,priority:a,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let a=0;a<this.taskQueue.length;a++){const u=this.tasks[this.taskQueue[a]];u.priority<r&&(r=u.priority,e=a)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class U1{constructor(e,r,o){this.target=e,this.parent=r,this.mapId=o,this.callbacks={},this.cancelCallbacks={},$t(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new KA}send(e,r,o,a,u=!1,h){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=h,this.callbacks[g]=o);const v=new Set;return this.target.postMessage({id:g,type:e,hasCallback:!!o,targetMapId:a,mustQueue:u,sourceMapId:this.mapId,data:xo(r,v)},v),{cancel:()=>{o&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(e){const r=e.data;if(!r)return;const o=r.id;if(o&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const a=this.cancelCallbacks[o];delete this.cancelCallbacks[o],a&&a.cancel()}else if(r.mustQueue||An(self)){const a=this.callbacks[o],u=this.scheduler.add(()=>this.processTask(o,r),a&&a.metadata||{type:"message"});u&&(this.cancelCallbacks[o]=u)}else this.processTask(o,r)}processTask(e,r){if(delete this.cancelCallbacks[e],r.type==="<response>"){const o=this.callbacks[e];delete this.callbacks[e],o&&(r.error?o(Ka(r.error)):o(null,Ka(r.data)))}else{const o=new Set,a=r.hasCallback?(h,g)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:h?xo(h):null,data:xo(g,o)},o)}:()=>{},u=Ka(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,u,a);else if(this.parent.getWorkerSource){const h=r.type.split("."),{source:g,scope:v}=u;this.parent.getWorkerSource(r.sourceMapId,h[0],g,v)[h[1]](u,a)}else a(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Dm={workerUrl:"",workerClass:null,workerParams:void 0};const Oy="mapboxgl_preloaded_worker_pool";class Jf{constructor(){this.active={}}acquire(e,r=Jf.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<r;)this.workers.push(Dm.workerClass!=null?new Dm.workerClass:new self.Worker(Dm.workerUrl,Dm.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Oy]}numActive(){return Object.keys(this.active).length}}Jf.workerCount=2;class Np{constructor(e,r,o="Worker",a=Jf.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Ue();const u=this.workerPool.acquire(this.id,a);for(let h=0;h<u.length;h++){const g=new Np.Actor(u[h],r,this.id);g.name=`${o} ${h}`,this.actors.push(g)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,r,o){Ce(this.actors,(a,u)=>{a.send(e,r,u)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Lm,Fy;function Gg(){return Lm||(Lm=new Jf),Lm}Np.Actor=U1;class JA{constructor(e){this.module=e}createIntArray(e){const r=new Int32Array(e),o=this.module.malloc(r.length*r.BYTES_PER_ELEMENT);return this.module.heap32.set(r,o/r.BYTES_PER_ELEMENT),o}createFloatArray(e){const r=new Float32Array(e),o=this.module.malloc(r.length*r.BYTES_PER_ELEMENT);return this.module.heapF32.set(r,o/r.BYTES_PER_ELEMENT),o}createStringBuffer(e){const r=this.module.malloc(e.length+1);for(let o=0;o<e.length;++o)this.module.heapU8[r+o]=e.charCodeAt(o);return this.module.heapU8[r+e.length]=0,r}readStringBuffer(e){let r="";for(;this.module.heapU8[e]!==0;)r+=String.fromCharCode(this.module.heapU8[e]),++e;return r}setStyle(e){const r=e.entranceColorRgb,o=e.facadeGlazingColorRgb,a=e.roofColorRgb,u=e.wallColorRgb,h=e.normalScale;this.module.setStyle(r[0],r[1],r[2],o[0],o[1],o[2],a[0],a[1],a[2],u[0],u[1],u[2],h[0],h[1],h[2],e.tileToMeters)}setAOOptions(e,r){this.module.setAOOptions(e?1:0,r)}setMetricOptions(e,r){this.module.setMetricOptions(e?1:0,r)}setFacadeOptions(e,r,o){this.module.setFacadeOptions(e,r,o)}generateMesh(e,r){for(const g of e){const v=this.createStringBuffer(g.roofType),x=[0],E=[];for(const k of g.coordinates)if(Array.isArray(k)){for(const L of k)E.push(L.x),E.push(L.y);x.push(E.length)}const A=this.createIntArray(x),C=this.createFloatArray(E);this.module.addFeature(g.id,g.sourceId,g.minHeight,g.height,v,g.roofType.length,C,A,x.length-1),this.module.free(v),this.module.free(A),this.module.free(C)}for(const g of r){let v;v=g.entrances?JSON.parse(g.entrances):[];const x=this.createFloatArray(v),E=[];for(const C of g.coordinates)E.push(C.x),E.push(C.y);const A=this.createFloatArray(E);this.module.addFacade(g.sourceId,g.crossPerc,g.distanceToRoad,x,v.length,A,E.length),this.module.free(x),this.module.free(A)}if(!this.module.generateMesh()){const g=this.module.getLastError();return this.readStringBuffer(g)}const o=this.module.getMeshCount(),a=new Array(o);for(let g=0;g<o;g++){const v=this.module.getPositionsPtr(g),x=this.module.getPositionsLength(g),E=new Float32Array(this.module.heapF32.buffer,v,x),A=this.module.getNormalsPtr(g),C=this.module.getNormalsLength(g),k=new Float32Array(this.module.heapF32.buffer,A,C),L=this.module.getColorsPtr(g),j=this.module.getColorsLength(g),G=new Uint8Array(this.module.heapU8.buffer,L,j),K=this.module.getAOPtr(g),te=this.module.getAOLength(g),ne=new Float32Array(this.module.heapF32.buffer,K,te),U=this.module.getIndicesPtr(g),ee=this.module.getIndicesLength(g),ie=new Int32Array(this.module.heap32.buffer,U,ee),ae=this.module.getBuildingPart(g),Te=this.readStringBuffer(ae);a[g]={positions:E,normals:k,colors:G,ao:ne,indices:ie,buildingPart:Te}}const u=this.module.getRingCount(),h=[];for(let g=0;g<u;g++){const v=this.module.getRingPtr(g),x=this.module.getRingLength(g),E=new Float32Array(this.module.heapF32.buffer,v,x);h.push(E)}return{meshes:a,modifiedPolygonRings:h}}}let Om,Ny,du,Bp,By,jp=null,Vp=null,$1=null,jy=null;function G1(){return An(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Ny||bs.DRACO_URL}function q1(){if(An(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Bp)return Bp;const n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Bp=WebAssembly.validate(n)?bs.MESHOPT_SIMD_URL:bs.MESHOPT_URL,Bp}const qg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},QA={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Fm={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function H1(n,e,r){const o=r.json.bufferViews.length,a=r.buffers.length;e.bufferView=o,r.json.bufferViews[o]={buffer:a,byteLength:n.byteLength},r.buffers[a]=n}const Vy="KHR_draco_mesh_compression";function eC(n,e){const r=n.extensions&&n.extensions[Vy];if(!r)return;const o=new du.Decoder,a=Y1(e,r.bufferView),u=new du.Mesh;if(!o.DecodeArrayToMesh(a,a.byteLength,u))throw new Error("Failed to decode Draco mesh");const h=e.json.accessors[n.indices],g=qg[h.componentType],v=h.count*g.BYTES_PER_ELEMENT,x=du._malloc(v);g===Uint16Array?o.GetTrianglesUInt16Array(u,v,x):o.GetTrianglesUInt32Array(u,v,x),H1(du.memory.buffer.slice(x,x+v),h,e),du._free(x);for(const E of Object.keys(r.attributes)){const A=o.GetAttributeByUniqueId(u,r.attributes[E]),C=e.json.accessors[n.attributes[E]],k=QA[C.componentType],L=C.count*Fm[C.type]*qg[C.componentType].BYTES_PER_ELEMENT,j=du._malloc(L);o.GetAttributeDataArrayForAllPoints(u,A,du[k],L,j),H1(du.memory.buffer.slice(j,j+L),C,e),du._free(j)}o.destroy(),u.destroy(),delete n.extensions[Vy]}const Hg="EXT_meshopt_compression";function tC(n,e){if(!n.extensions||!n.extensions[Hg])return;const r=n.extensions[Hg],o=new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),a=new Uint8Array(r.count*r.byteStride);By.decodeGltfBuffer(a,r.count,r.byteStride,o,r.mode,r.filter),n.buffer=e.buffers.length,n.byteOffset=0,e.buffers[n.buffer]=a.buffer,delete n.extensions[Hg]}const W1=1179937895,Z1=new TextDecoder("utf8");function X1(n,e){return new URL(n,e).href}function rC(n,e,r,o){return fetch(X1(n.uri,o)).then(a=>a.arrayBuffer()).then(a=>{e.buffers[r]=a})}function Y1(n,e){const r=n.json.bufferViews[e];return new Uint8Array(n.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function nC(n,e,r,o){if(n.uri){const a=X1(n.uri,o);return fetch(a).then(u=>u.blob()).then(u=>createImageBitmap(u)).then(u=>{e.images[r]=u})}if(n.bufferView!==void 0){const a=Y1(e,n.bufferView),u=new Blob([a],{type:n.mimeType});return createImageBitmap(u).then(h=>{e.images[r]=h})}}function K1(n,e=0,r){const o={json:null,images:[],buffers:[]};if(new Uint32Array(n,e,1)[0]===W1){const E=new Uint32Array(n,e);let A=2;const C=(E[A++]>>2)-3,k=E[A++]>>2;if(A++,o.json=JSON.parse(Z1.decode(E.subarray(A,A+k))),A+=k,A<C){const L=E[A++];A++;const j=e+(A<<2);o.buffers[0]=n.slice(j,j+L)}}else o.json=JSON.parse(Z1.decode(new Uint8Array(n,e)));const{buffers:a,images:u,meshes:h,extensionsUsed:g,bufferViews:v}=o.json;let x=Promise.resolve();if(a){const E=[];for(let A=0;A<a.length;A++){const C=a[A];C.uri?E.push(rC(C,o,A,r)):o.buffers[A]||(o.buffers[A]=null)}x=Promise.all(E)}return x.then(()=>{const E=[],A=g&&g.includes(Vy),C=g&&g.includes(Hg);if(A&&E.push(function(){if(!du)return Om??(Om=function(k){let L,j=null;function G(){L=new Uint8Array(j.buffer)}function K(){throw new Error("Unexpected Draco error.")}const te={a:{a:K,d:function(ne,U,ee){return L.copyWithin(ne,U,U+ee)},c:function(ne){const U=L.length,ee=Math.max(ne>>>0,Math.ceil(1.2*U)),ie=Math.ceil((ee-U)/65536);try{return j.grow(ie),G(),!0}catch{return!1}},b:K}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(k,te):k.then(ne=>ne.arrayBuffer()).then(ne=>WebAssembly.instantiate(ne,te))).then(ne=>{const{Rb:U,Qb:ee,P:ie,T:ae,X:Te,Ja:ve,La:Ee,Qa:Re,Va:He,Wa:ht,eb:it,jb:ut,f:mt,e:Ze,yb:lt,zb:qe,Ab:We,Bb:xt,Db:bt,Gb:ir}=ne.instance.exports;j=Ze;const qt=(()=>{let zt=0,yt=0,wr=0,Gt=0;return Zt=>{wr&&(U(Gt),U(zt),yt+=wr,wr=zt=0),zt||(yt+=128,zt=ee(yt));const pr=Zt.length+7&-8;let Fr=zt;pr>=yt&&(wr=pr,Fr=Gt=ee(pr));for(let kr=0;kr<Zt.length;kr++)L[Fr+kr]=Zt[kr];return Fr}})();return G(),mt(),{memory:Ze,_free:U,_malloc:ee,Mesh:class{constructor(){this.ptr=ie()}destroy(){ae(this.ptr)}},Decoder:class{constructor(){this.ptr=ve()}destroy(){ut(this.ptr)}DecodeArrayToMesh(zt,yt,wr){const Gt=qt(zt),Zt=Ee(this.ptr,Gt,yt,wr.ptr);return!!Te(Zt)}GetAttributeByUniqueId(zt,yt){return{ptr:Re(this.ptr,zt.ptr,yt)}}GetTrianglesUInt16Array(zt,yt,wr){He(this.ptr,zt.ptr,yt,wr)}GetTrianglesUInt32Array(zt,yt,wr){ht(this.ptr,zt.ptr,yt,wr)}GetAttributeDataArrayForAllPoints(zt,yt,wr,Gt,Zt){it(this.ptr,zt.ptr,yt.ptr,wr,Gt,Zt)}},DT_INT8:lt(),DT_UINT8:qe(),DT_INT16:We(),DT_UINT16:xt(),DT_UINT32:bt(),DT_FLOAT32:ir()}})}(fetch(G1())),Om.then(k=>{du=k,Om=void 0}))}()),C&&E.push(function(){if(By)return;const k=function(L){let j;const G=WebAssembly.instantiateStreaming(L,{}).then(ne=>{j=ne.instance,j.exports.__wasm_call_ctors()}),K={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},te={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:G,supported:!0,decodeGltfBuffer(ne,U,ee,ie,ae,Te){(function(ve,Ee,Re,He,ht,it,ut){const mt=ve.exports.sbrk,Ze=He+3&-4,lt=mt(Ze*ht),qe=mt(it.length),We=new Uint8Array(ve.exports.memory.buffer);We.set(it,qe);const xt=Ee(lt,He,ht,qe,it.length);if(xt===0&&ut&&ut(lt,Ze,ht),Re.set(We.subarray(lt,lt+He*ht)),mt(lt-mt(0)),xt!==0)throw new Error(`Malformed buffer data: ${xt}`)})(j,j.exports[te[ae]],ne,U,ee,ie,j.exports[K[Te]])}}}(fetch(q1()));return k.ready.then(()=>{By=k})}()),u)for(let k=0;k<u.length;k++)E.push(nC(u[k],o,k,r));return(E.length?Promise.all(E):Promise.resolve()).then(()=>{if(A&&h)for(const{primitives:k}of h)for(const L of k)eC(L,o);if(C&&h&&v)for(const k of v)tC(k,o);return o})})}class J1{constructor(e){this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.hasPattern=!1,this.worldview=e.worldview}updateFootprints(e,r){}prepare(){return function(){if(jy!=null||$1!=null)return null;if(Vp!=null)return Vp;const e=fetch(bs.BUILDING_GEN_URL);return Vp=function(r){let o,a,u,h;function g(){o=new Uint8Array(h.buffer),a=new Int32Array(h.buffer),u=new Float32Array(h.buffer)}function v(){throw new Error("Unexpected BuildingGen error.")}const x=()=>{},E={a:{a:v,f:function(A){const C=o.length,k=Math.max(A>>>0,Math.ceil(1.2*C)),L=Math.ceil((k-C)/65536);try{return h.grow(L),g(),!0}catch{return!1}},g:v,b:x,c:x,d:x,e:x}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(r,E):r.then(A=>A.arrayBuffer()).then(A=>WebAssembly.instantiate(A,E))).then(A=>{const C=A.instance.exports;return(0,C.g)(),h=C.f,g(),new JA({setStyle:C.h,setAOOptions:C.i,setMetricOptions:C.j,setFacadeOptions:C.k,addFeature:C.l,addFacade:C.m,generateMesh:C.n,getLastError:C.o,getMeshCount:C.p,getPositionsPtr:C.q,getPositionsLength:C.r,getNormalsPtr:C.s,getNormalsLength:C.t,getColorsPtr:C.u,getColorsLength:C.v,getAOPtr:C.w,getAOLength:C.x,getIndicesPtr:C.y,getIndicesLength:C.z,getBuildingPart:C.A,getRingCount:C.B,getRingPtr:C.C,getRingLength:C.D,free:C.E,malloc:C.F,heapU8:o,heap32:a,heapF32:u})})}(e).then(r=>(Vp=null,jy=r,jy)).catch(r=>{Rr("Could not load building-gen"),Vp=null,$1=r}),Vp}()}populate(e,r,o,a){}update(e,r,o,a,u,h,g){}isEmpty(){return!1}uploadPending(){return!1}upload(e){}destroy(){}getHeightAtTileCoord(e,r){return{height:Number.NEGATIVE_INFINITY,hidden:!0}}}let Q1,ew;Ft(J1,"BuildingBucket",{omit:["layers"]});const iC=pn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),sC=pn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:oC}=iC,aC=pn([{name:"a_packed",components:3,type:"Float32"}]),{members:lC}=aC,cC=pn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:uC}=cC;class tw{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new Qd({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const o=this.getKey(e,r);return this.positions[o]}trim(){const e=this.width,r=this.height=Et(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,o){const a=[];let u=e.length%2==1?-e[e.length-1]*o:0,h=e[0]*o,g=!0;a.push({left:u,right:h,isDash:g,zeroLength:e[0]===0});let v=e[0];for(let x=1;x<e.length;x++){g=!g;const E=e[x];u=v*o,v+=E,h=v*o,a.push({left:u,right:h,isDash:g,zeroLength:E===0})}return a}addRoundDash(e,r,o){const a=r/2;for(let u=-o;u<=o;u++){const h=this.width*(this.nextRow+o+u);let g=0,v=e[g];for(let x=0;x<this.width;x++){x/v.right>1&&(v=e[++g]);const E=Math.abs(x-v.left),A=Math.abs(x-v.right),C=Math.min(E,A);let k;const L=u/o*(a+1);if(v.isDash){const j=a-Math.abs(L);k=Math.sqrt(C*C+j*j)}else k=a-Math.sqrt(C*C+L*L);this.image.data[h+x]=Math.max(0,Math.min(255,k+128))}}}addRegularDash(e,r){for(let v=e.length-1;v>=0;--v){const x=e[v],E=e[v+1];x.zeroLength?e.splice(v,1):E&&E.isDash===x.isDash&&(E.left=x.left,e.splice(v,1))}const o=e[0],a=e[e.length-1];o.isDash===a.isDash&&(o.left=a.left-this.width,a.right=o.right+this.width);const u=this.width*this.nextRow;let h=0,g=e[h];for(let v=0;v<this.width;v++){v/g.right>1&&(g=e[++h]);const x=Math.abs(v-g.left),E=Math.abs(v-g.right),A=Math.min(x,E);this.image.data[u+v]=Math.max(0,Math.min(255,(g.isDash?A:-A)+r+128))}}addDash(e,r){const o=this.getKey(e,r);if(this.positions[o])return this.positions[o];const a=r==="round",u=a?7:0,h=2*u+1;if(this.nextRow+h>this.height)return Rr("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let E=0;E<e.length;E++)e[E]<0&&(Rr("Negative value is found in line dasharray, replacing values with 0"),e[E]=0),g+=e[E];if(g!==0){const E=this.width/g,A=this.getDashRanges(e,this.width,E);a?this.addRoundDash(A,E,u):this.addRegularDash(A,r==="square"?.5*E:0)}const v=this.nextRow+u;this.nextRow+=h;const x={tl:[v,u],br:[g,0]};return this.positions[o]=x,x}}Ft(tw,"LineAtlas");const hC=Lr.VectorTileFeature.types,dC=Math.cos(Math.PI/180*37.5),fC=Math.cos(Math.PI/180*5);class Uy{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new jd,this.layoutVertexArray2=new Ra,this.patternVertexArray=new Ra,this.indexArray=new as,this.programConfigurations=new l(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new $n,this.maxLineLength=0,this.zOffsetVertexArray=new Ra,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Ct/64,this.worldview=e.worldview}updateFootprints(e,r){}populate(e,r,o,a){this.hasPattern=Ey("line",this.layers,this.pixelRatio,r);const u=this.layers[0].layout.get("line-sort-key");this.tileToMeter=$e(o);const h=this.layers[0].layout.get("line-elevation-reference");if(h==="hd-road-markup")this.elevationType="road";else{const C=this.layers[0].layout.get("line-z-offset"),k=C.isConstant()&&!C.constantOr(0);this.elevationType=h!=="sea"&&h!=="ground"&&k?"none":"offset",this.elevationType==="offset"&&h==="none"&&Rr(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const g=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&g!==void 0;const v=[];for(const{feature:C,id:k,index:L,sourceLayerIndex:j}of e){const G=this.layers[0]._featureFilter.needGeometry,K=Mt(C,G);if(!this.layers[0]._featureFilter.filter(new zn(this.zoom,{worldview:this.worldview}),K,o))continue;const te=u?u.evaluate(K,{},o):void 0,ne={id:k,properties:C.properties,type:C.type,sourceLayerIndex:j,index:L,geometry:G?K.geometry:Lt(C,o,a),patterns:{},sortKey:te};v.push(ne)}u&&v.sort((C,k)=>C.sortKey-k.sortKey);const{lineAtlas:x,featureIndex:E}=r,A=this.addConstantDashes(x);for(const C of v){const{geometry:k,index:L,sourceLayerIndex:j}=C;if(A&&this.addFeatureDashes(C,x),this.hasPattern){const G=Iy("line",this.layers,C,this.zoom,this.pixelRatio,r);this.patternFeatures.push(G)}else this.addFeature(C,k,L,o,x.positions,r.availableImages,r.brightness,r.elevationFeatures);E.insert(e[L].feature,k,L,j,this.index)}}addConstantDashes(e){let r=!1;for(const o of this.layers){const a=o.paint.get("line-dasharray").value,u=o.layout.get("line-cap").value;if(a.kind!=="constant"||u.kind!=="constant")r=!0;else{const h=u.value,g=a.value;if(!g)continue;e.addDash(g,h)}}return r}addFeatureDashes(e,r){const o=this.zoom;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,h=a.layout.get("line-cap").value;if(u.kind==="constant"&&h.kind==="constant")continue;let g,v;if(u.kind==="constant"){if(g=u.value,!g)continue}else g=u.evaluate({zoom:o},e);v=h.kind==="constant"?h.value:h.evaluate({zoom:o},e),r.addDash(g,v),e.patterns[a.id]=[r.getKey(g,v)]}}update(e,r,o,a,u,h,g,v){this.programConfigurations.updatePaintArrays(e,r,u,o,a,h,g,v)}addFeatures(e,r,o,a,u,h){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,r,o,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,lC)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,uC)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,sC.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,oC),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,o,a,u,h,g,v){const x=this.layers[0].layout,E=x.get("line-join").evaluate(e,{}),A=x.get("line-cap").evaluate(e,{}),C=x.get("line-miter-limit"),k=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=x.get("line-z-offset").value;const L=this.layers[0].paint.get("line-width").value;if(L.kind!=="constant"&&L.isLineProgressConstant===!1&&(this.variableWidthValue=L),this.elevationType==="road"){const j=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,r,a,v,E,A,C,k)){const[G,K]=this.clipRuntimeLinesToTile(r,1);for(let te=0;te<G.length;te++){const ne=G[te],U=K[te],ee={progress:{min:U.progress.min,max:U.progress.max},nextDir:this.computeSegNextDir(U,ne),prevDir:this.computeSegPrevDir(U,ne)};this.addLine(ne,e,a,E,A,C,k,ee)}this.fillNonElevatedRoadSegment(j)}}else for(const j of r)this.addLine(j,e,a,E,A,C,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,h,a,g,void 0,this.worldview)}computeSegNextDir(e,r){return e.nextPoint.sub(r.at(-2)).unit()}computeSegPrevDir(e,r){return r[1].sub(e.prevPoint).unit()}clipLinesToTile(e,r){return $g(e,-r,-r,Ct+r,Ct+r)}clipRuntimeLinesToTile(e,r){const o=[];return[$g(e,-r,-r,Ct+r,Ct+r,o),o]}addElevatedRoadFeature(e,r,o,a,u,h,g,v){const x=[],E=na.getElevationFeature(e,a);if(E){const A=this.clipLinesToTile(r,1),C=this.prepareElevatedLines(A,E,o);for(const k of C)x.push({geometry:k,elevation:E,elevationTileID:o,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(x.length===0)return!1;for(const A of x){const C=this.layoutVertexArray.length;this.addLine(A.geometry,e,o,u,h,g,v);const k=new Ji(o,A.elevationTileID);if(A.elevation)for(let L=C;L<this.layoutVertexArray.length;L++){const j=new ft(this.layoutVertexArray.int16[6*L]>>1,this.layoutVertexArray.int16[6*L+1]>>1),G=k.pointElevation(j,A.elevation,.05);this.updateHeightRange(G),this.zOffsetVertexArray.emplaceBack(G,0,0)}else this.fillNonElevatedRoadSegment(C)}return!0}prepareElevatedLines(e,r,o){if(r.constantHeight!=null)return e;const a=[],u=1/$e(o);for(const h of e)XA(h,new bo(r,u),0,a);return a}fillNonElevatedRoadSegment(e){for(let r=e;r<this.layoutVertexArray.length;r++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,r,o,a,u,h,g,v){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const x=a==="none";this.patternJoinNone=this.hasPattern&&x,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const E=v&&v.progress.min>0,A=v&&v.progress.max<1;if(this.lineClips){let Te={min:this.lineClips.start,max:this.lineClips.end},ve=1;if(v){const He=this.lineClips.end-this.lineClips.start;Te=function(ht,it,ut){return{min:po(ht.min,it,ut),max:po(ht.max,it,ut)}}(v.progress,{min:0,max:1},Te),He>0&&(ve=(Te.max-Te.min)/He)}const Ee=+r.properties.mapbox_clip_feature_len,Re=+r.properties.mapbox_clip_seg_len;if(Number.isNaN(Ee)||Number.isNaN(Re)){for(let ht=0;ht<e.length-1;ht++)this.totalDistance+=e[ht].dist(e[ht+1]);const He=this.totalDistance/(Te.max-Te.min);this.totalFeatureLength=Number.isFinite(He)?He:0,this.lineClips.start=Te.min,this.lineClips.end=Te.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ee,this.distance=Re*ve,this.lineClips.start=Te.min,this.lineClips.end=Te.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const C=hC[r.type]==="Polygon";let k=e.length;for(;k>=2&&e[k-1].equals(e[k-2]);)k--;let L=0;for(;L<k-1&&e[L].equals(e[L+1]);)L++;if(k<(C?3:2))return;a==="bevel"&&(h=1.05);const j=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let G,K,te,ne,U,ee,ie,ae;v&&v.prevDir&&(ee=v.prevDir.perp()),v&&v.nextDir&&(ie=v.nextDir.perp()),this.e1=this.e2=-1,C&&(G=e[k-2],U=e[L].sub(G)._unit()._perp());for(let Te=L;Te<k;Te++){if(te=Te===k-1?C?e[L+1]:void 0:e[Te+1],te&&e[Te].equals(te))continue;U&&(ne=U),G&&(K=G),G=e[Te],ae=this.evaluateLineProgressFeatures(K?K.dist(G):0),U=te?te.sub(G)._unit()._perp():ne,ne=ne||U;const ve=K&&te;let Ee=ve?a:C||x?"butt":u;const Re=ne.x*U.x+ne.y*U.y;if(x){const qe=function(We){if(We.patternJoinNone){const xt=We.segmentPoints.length/2,bt=We.lineSoFar-We.segmentStart;for(let ir=0;ir<xt;++ir){const qt=We.segmentPoints[2*ir+1],zt=Math.round(We.segmentPoints[2*ir])+.5+.25*qt;We.patternVertexArray.emplaceBack(zt,bt,We.segmentStart),We.patternVertexArray.emplaceBack(zt,bt,We.segmentStart)}We.segmentPoints.length=0}We.e1=We.e2=-1};if(ve&&Re<fC){this.updateDistance(K,G),this.addCurrentVertex(G,ne,1,1,j,ae),qe(this),this.addCurrentVertex(G,U,-1,-1,j,ae);continue}if(K){if(!te){this.updateDistance(K,G),this.addCurrentVertex(G,ne,1,1,j,ae),qe(this);continue}Ee="miter"}}let He=ne.add(U);He.x===0&&He.y===0||He._unit();const ht=He.x*U.x+He.y*U.y,it=ht!==0?1/ht:1/0,ut=2*Math.sqrt(2-2*ht),mt=ht<dC&&K&&te,Ze=ne.x*U.y-ne.y*U.x>0,lt=this.overscaling<=16?15*Ct/(512*this.overscaling):0;if(ve&&Ee==="round"){if(it<g)Ee="miter";else if(it<=2){const qe=$y(G,-10,Ct+10);Ee=this.elevationType==="offset"&&(qe||this.hasCrossSlope)?"miter":"fakeround"}}if(Ee==="miter"&&it>h&&(Ee="bevel"),Ee==="bevel"&&(it>2&&(Ee="flipbevel"),it<h&&(Ee="miter")),K&&!(Ee==="miter"&&mt)&&this.updateDistance(K,G),Ee==="miter")if(mt){const qe=G.dist(K);if(qe>2*lt){const xt=G.sub(G.sub(K)._mult(lt/qe)._round());this.updateDistance(K,xt),this.addCurrentVertex(xt,ne,0,0,j,ae),K=xt}this.updateDistance(K,G),He._mult(it),this.addCurrentVertex(G,He,0,0,j,ae);const We=G.dist(te);if(We>2*lt){const xt=G.add(te.sub(G)._mult(lt/We)._round());this.updateDistance(G,xt),this.addCurrentVertex(xt,U,0,0,j,ae),G=xt}}else He._mult(it),this.addCurrentVertex(G,He,0,0,j,ae);else if(Ee==="flipbevel"){if(it>100)He=U.mult(-1);else{const qe=it*ne.add(U).mag()/ne.sub(U).mag();He._perp()._mult(qe*(Ze?-1:1))}this.addCurrentVertex(G,He,0,0,j,ae),this.addCurrentVertex(G,He.mult(-1),0,0,j,ae)}else if(Ee==="bevel"||Ee==="fakeround"){ae!=null&&K&&this.addCurrentVertex(G,ie||ne,-1,-1,j,ae);const qe=G.dist(K)<=2*lt&&Ee!=="bevel",We=He.mult(Ze?1:-1);We._mult(it);const xt=U.mult(Ze?-1:1),bt=ne.mult(Ze?-1:1),ir=this.evaluateLineProgressFeatures(this.distance);if(ae==null&&(this.addHalfVertex(G,We.x,We.y,!1,!Ze,0,j,ir),qe||this.addHalfVertex(G,We.x+2*bt.x,We.y+2*bt.y,!1,Ze,0,j,ir)),Ee==="fakeround"){const qt=Math.round(180*ut/Math.PI/20);this.addHalfVertex(G,bt.x,bt.y,!1,Ze,0,j,ir);for(let zt=0;zt<qt;zt++){let yt=zt/qt;if(yt!==.5){const Gt=yt-.5;yt+=yt*Gt*(yt-1)*((1.0904+Re*(Re*(3.55645-1.43519*Re)-3.2452))*Gt*Gt+(.848013+Re*(.215638*Re-1.06021)))}const wr=xt.sub(bt)._mult(yt)._add(bt)._unit();this.addHalfVertex(G,wr.x,wr.y,!1,Ze,0,j,ir)}this.addHalfVertex(G,xt.x,xt.y,!1,Ze,0,j,ir)}qe||ae!=null||this.addHalfVertex(G,We.x+2*xt.x,We.y+2*xt.y,!1,Ze,0,j,ir),ae!=null&&te&&this.addCurrentVertex(G,ee||U,1,1,j,ae)}else if(Ee==="butt")this.addCurrentVertex(G,He,0,0,j,ae);else if(Ee==="square"){if(!K){const qe=E?0:-1;this.addCurrentVertex(G,He,qe,qe,j,ae)}if(this.addCurrentVertex(G,He,0,0,j,ae),K){const qe=A?0:1;this.addCurrentVertex(G,He,qe,qe,j,ae)}}else if(Ee==="round"){if(K){const qe=!ve&&ie?ie:ne;this.addCurrentVertex(G,qe,0,0,j,ae),!ve&&A||this.addCurrentVertex(G,qe,1,1,j,ae,!0)}if(te){const qe=!ve&&ee?ee:U;!ve&&E||this.addCurrentVertex(G,qe,-1,-1,j,ae,!0),this.addCurrentVertex(G,qe,0,0,j,ae)}}}}addVerticesTo(e,r,o,a,u,h,g,v,x,E){const A=(r.w-e.w)/this.tessellationStep|0;let C=0;const k=this.scaledDistance;if(A>1){this.lineSoFar=e.w;const j=(r.x-e.x)/A,G=(r.y-e.y)/A,K=(r.z-e.z)/A,te=(r.w-e.w)/A;for(let ne=1;ne<A;++ne){e.x+=j,e.y+=G,e.z+=K,this.lineSoFar+=te,C+=te;const U=this.evaluateLineProgressFeatures(this.prevDistance+C);this.scaledDistance=(this.prevDistance+C)/this.totalDistance,this.addHalfVertex(e,o,a,E,!1,g,x,U),this.addHalfVertex(e,u,h,E,!0,-v,x,U)}}this.lineSoFar=r.w,this.scaledDistance=k;const L=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(r,o,a,E,!1,g,x,L),this.addHalfVertex(r,u,h,E,!0,-v,x,L)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Rr(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let r=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(r=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:r}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:r}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:r}}addCurrentVertex(e,r,o,a,u,h,g=!1){const v=r.x+r.y*o,x=r.y-r.x*o,E=r.y*a-r.x,A=-r.y-r.x*a;if(h!=null){const C=this.elevationType==="offset",k=-10,L=Ct+10,j=h.zOffset,G=new O1(e.x,e.y,j,this.lineSoFar),K=!!C&&$y(e,k,L),te=this.lineSoFar,ne=this.distance;if(this.currentVertex)if(K){const U=this.currentVertexIsOutside,ee=this.currentVertex,ie=new O1(e.x,e.y,j,this.lineSoFar);if(N1(ee,ie,k,L),!$y(ie,k,L)){if(U){this.e1=this.e2=-1,this.distance-=ee.dist(G),this.lineSoFar=ee.w;const ae=this.evaluateLineProgressFeatures(ee.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ee,v,x,g,!1,o,u,ae),this.addHalfVertex(ee,E,A,g,!0,-a,u,ae),this.prevDistance=this.distance}this.distance=this.prevDistance+ee.dist(ie),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(ee,ie,v,x,E,A,o,a,u,g),this.distance=ne,this.scaledDistance=this.distance/this.totalDistance}}else{const U=this.currentVertex;if(this.currentVertexIsOutside){N1(U,G,k,L),this.e1=this.e2=-1,this.distance-=U.dist(G),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=U.w;const ee=this.evaluateLineProgressFeatures(U.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(U,v,x,g,!1,o,u,ee),this.addHalfVertex(U,E,A,g,!0,-a,u,ee),this.prevDistance=this.distance,this.distance=ne,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(U,G,v,x,E,A,o,a,u,g)}else K||(this.addHalfVertex(e,v,x,g,!1,o,u,h),this.addHalfVertex(e,E,A,g,!0,-a,u,h));this.currentVertex=G,this.currentVertexIsOutside=K,this.lineSoFar=te}else this.addHalfVertex(e,v,x,g,!1,o,u,h),this.addHalfVertex(e,E,A,g,!0,-a,u,h)}addHalfVertex({x:e,y:r},o,a,u,h,g,v,x){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),h||this.segmentPoints.push(this.lineSoFar-this.segmentStart,g)),this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(r<<1)+(h?1:0),Math.round(63*o)+128,Math.round(63*a)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const A=lr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,A)}const E=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),v.primitiveLength++),h?this.e2=E:this.e1=E,x!=null&&this.zOffsetVertexArray.emplaceBack(x.zOffset,x.variableWidth,x.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,r){this.prevDistance=this.distance,this.distance+=e.dist(r),this.updateScaledDistance()}}function $y(n,e,r){return n.x<e||n.x>r||n.y<e||n.y>r}let rw,nw;function iw(n,e,r){return e*(Ct/(n.tileSize*Math.pow(2,r-n.tileID.overscaledZ)))}Ft(Uy,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const sw=(n,e,r)=>(1-r)*n+r*e;function ow(n,e){return 1/iw(n,1,e.tileZoom)}function aw(n,e,r,o){return n.translatePosMatrix(o||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const lw=n=>{const e=[];cw(n)&&e.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const r=n.paint.get("line-trim-offset");r[0]===0&&r[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),n.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const o=n.layout.get("line-join").constantOr("miter")==="none",a=!!n.paint.get("line-pattern").constantOr(1);return o&&a&&e.push("LINE_JOIN_NONE"),e};function cw(n){const e=n.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let Gy;const uw=()=>Gy||(Gy={layout:rw||(rw=new fi({"line-cap":new It(ke.layout_line["line-cap"]),"line-join":new It(ke.layout_line["line-join"]),"line-miter-limit":new gt(ke.layout_line["line-miter-limit"]),"line-round-limit":new gt(ke.layout_line["line-round-limit"]),"line-sort-key":new It(ke.layout_line["line-sort-key"]),"line-z-offset":new It(ke.layout_line["line-z-offset"]),"line-elevation-reference":new gt(ke.layout_line["line-elevation-reference"]),"line-cross-slope":new gt(ke.layout_line["line-cross-slope"]),visibility:new gt(ke.layout_line.visibility),"line-width-unit":new gt(ke.layout_line["line-width-unit"])})),paint:nw||(nw=new fi({"line-opacity":new It(ke.paint_line["line-opacity"]),"line-color":new It(ke.paint_line["line-color"]),"line-translate":new gt(ke.paint_line["line-translate"]),"line-translate-anchor":new gt(ke.paint_line["line-translate-anchor"]),"line-width":new It(ke.paint_line["line-width"]),"line-gap-width":new It(ke.paint_line["line-gap-width"]),"line-offset":new It(ke.paint_line["line-offset"]),"line-blur":new It(ke.paint_line["line-blur"]),"line-dasharray":new It(ke.paint_line["line-dasharray"]),"line-pattern":new It(ke.paint_line["line-pattern"]),"line-pattern-cross-fade":new gt(ke.paint_line["line-pattern-cross-fade"]),"line-gradient":new Al(ke.paint_line["line-gradient"]),"line-trim-offset":new gt(ke.paint_line["line-trim-offset"]),"line-trim-fade-range":new gt(ke.paint_line["line-trim-fade-range"]),"line-trim-color":new gt(ke.paint_line["line-trim-color"]),"line-emissive-strength":new gt(ke.paint_line["line-emissive-strength"]),"line-border-width":new It(ke.paint_line["line-border-width"]),"line-border-color":new It(ke.paint_line["line-border-color"]),"line-occlusion-opacity":new gt(ke.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},Gy);class pC extends It{possiblyEvaluate(e,r){return r=new zn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition,worldview:r.worldview}),super.possiblyEvaluate(e,r)}evaluate(e,r,o,a){return r=je({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,o,a)}}let Nm;function hw(n,e){return e>0?e+2*n:n}const mC=pn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),gC=pn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),_C=pn([{name:"a_projected_pos",components:4,type:"Float32"}],4);pn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const yC=pn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),vC=pn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),xC=pn([{name:"a_texb",components:2,type:"Uint16"}]),wC=pn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),bC=pn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);pn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const dw=pn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),TC=pn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);pn([{name:"triangle",components:3,type:"Uint16"}]),pn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),pn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),pn([{type:"Float32",name:"offsetX"}]),pn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Us=24;function SC(n,e,r){return n.sections.forEach(o=>{o.text=function(a,u,h){const g=u.layout.get("text-transform").evaluate(h,{});return g==="uppercase"?a=a.toLocaleUpperCase():g==="lowercase"&&(a=a.toLocaleLowerCase()),Ma.applyArabicShaping&&(a=Ma.applyArabicShaping(a)),a}(o.text,e,r)}),n}const Bm={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function EC(n){return n==="︶"||n==="﹈"||n==="︸"||n==="﹄"||n==="﹂"||n==="︾"||n==="︼"||n==="︺"||n==="︘"||n==="﹀"||n==="︐"||n==="︓"||n==="︔"||n==="｀"||n==="￣"||n==="︑"||n==="︒"}function IC(n){return n==="︵"||n==="﹇"||n==="︷"||n==="﹃"||n==="﹁"||n==="︽"||n==="︻"||n==="︹"||n==="︗"||n==="︿"}var fw,qy,pw,Hy={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function AC(){return fw||(fw=1,Hy.read=function(n,e,r,o,a){var u,h,g=8*a-o-1,v=(1<<g)-1,x=v>>1,E=-7,A=r?a-1:0,C=r?-1:1,k=n[e+A];for(A+=C,u=k&(1<<-E)-1,k>>=-E,E+=g;E>0;u=256*u+n[e+A],A+=C,E-=8);for(h=u&(1<<-E)-1,u>>=-E,E+=o;E>0;h=256*h+n[e+A],A+=C,E-=8);if(u===0)u=1-x;else{if(u===v)return h?NaN:1/0*(k?-1:1);h+=Math.pow(2,o),u-=x}return(k?-1:1)*h*Math.pow(2,u-o)},Hy.write=function(n,e,r,o,a,u){var h,g,v,x=8*u-a-1,E=(1<<x)-1,A=E>>1,C=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,k=o?0:u-1,L=o?1:-1,j=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,h=E):(h=Math.floor(Math.log(e)/Math.LN2),e*(v=Math.pow(2,-h))<1&&(h--,v*=2),(e+=h+A>=1?C/v:C*Math.pow(2,1-A))*v>=2&&(h++,v/=2),h+A>=E?(g=0,h=E):h+A>=1?(g=(e*v-1)*Math.pow(2,a),h+=A):(g=e*Math.pow(2,A-1)*Math.pow(2,a),h=0));a>=8;n[r+k]=255&g,k+=L,g/=256,a-=8);for(h=h<<a|g,x+=a;x>0;n[r+k]=255&h,k+=L,h/=256,x-=8);n[r+k-L]|=128*j}),Hy}function mw(){if(pw)return qy;pw=1,qy=e;var n=AC();function e(U){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(U)?U:new Uint8Array(U||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var r=4294967296,o=1/r,a=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function u(U){return U.type===e.Bytes?U.readVarint()+U.pos:U.pos+1}function h(U,ee,ie){return ie?4294967296*ee+(U>>>0):4294967296*(ee>>>0)+(U>>>0)}function g(U,ee,ie){var ae=ee<=16383?1:ee<=2097151?2:ee<=268435455?3:Math.floor(Math.log(ee)/(7*Math.LN2));ie.realloc(ae);for(var Te=ie.pos-1;Te>=U;Te--)ie.buf[Te+ae]=ie.buf[Te]}function v(U,ee){for(var ie=0;ie<U.length;ie++)ee.writeVarint(U[ie])}function x(U,ee){for(var ie=0;ie<U.length;ie++)ee.writeSVarint(U[ie])}function E(U,ee){for(var ie=0;ie<U.length;ie++)ee.writeFloat(U[ie])}function A(U,ee){for(var ie=0;ie<U.length;ie++)ee.writeDouble(U[ie])}function C(U,ee){for(var ie=0;ie<U.length;ie++)ee.writeBoolean(U[ie])}function k(U,ee){for(var ie=0;ie<U.length;ie++)ee.writeFixed32(U[ie])}function L(U,ee){for(var ie=0;ie<U.length;ie++)ee.writeSFixed32(U[ie])}function j(U,ee){for(var ie=0;ie<U.length;ie++)ee.writeFixed64(U[ie])}function G(U,ee){for(var ie=0;ie<U.length;ie++)ee.writeSFixed64(U[ie])}function K(U,ee){return(U[ee]|U[ee+1]<<8|U[ee+2]<<16)+16777216*U[ee+3]}function te(U,ee,ie){U[ie]=ee,U[ie+1]=ee>>>8,U[ie+2]=ee>>>16,U[ie+3]=ee>>>24}function ne(U,ee){return(U[ee]|U[ee+1]<<8|U[ee+2]<<16)+(U[ee+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(U,ee,ie){for(ie=ie||this.length;this.pos<ie;){var ae=this.readVarint(),Te=ae>>3,ve=this.pos;this.type=7&ae,U(Te,ee,this),this.pos===ve&&this.skip(ae)}return ee},readMessage:function(U,ee){return this.readFields(U,ee,this.readVarint()+this.pos)},readFixed32:function(){var U=K(this.buf,this.pos);return this.pos+=4,U},readSFixed32:function(){var U=ne(this.buf,this.pos);return this.pos+=4,U},readFixed64:function(){var U=K(this.buf,this.pos)+K(this.buf,this.pos+4)*r;return this.pos+=8,U},readSFixed64:function(){var U=K(this.buf,this.pos)+ne(this.buf,this.pos+4)*r;return this.pos+=8,U},readFloat:function(){var U=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,U},readDouble:function(){var U=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,U},readVarint:function(U){var ee,ie,ae=this.buf;return ee=127&(ie=ae[this.pos++]),ie<128?ee:(ee|=(127&(ie=ae[this.pos++]))<<7,ie<128?ee:(ee|=(127&(ie=ae[this.pos++]))<<14,ie<128?ee:(ee|=(127&(ie=ae[this.pos++]))<<21,ie<128?ee:function(Te,ve,Ee){var Re,He,ht=Ee.buf;if(Re=(112&(He=ht[Ee.pos++]))>>4,He<128||(Re|=(127&(He=ht[Ee.pos++]))<<3,He<128)||(Re|=(127&(He=ht[Ee.pos++]))<<10,He<128)||(Re|=(127&(He=ht[Ee.pos++]))<<17,He<128)||(Re|=(127&(He=ht[Ee.pos++]))<<24,He<128)||(Re|=(1&(He=ht[Ee.pos++]))<<31,He<128))return h(Te,Re,ve);throw new Error("Expected varint not more than 10 bytes")}(ee|=(15&(ie=ae[this.pos]))<<28,U,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var U=this.readVarint();return U%2==1?(U+1)/-2:U/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var U=this.readVarint()+this.pos,ee=this.pos;return this.pos=U,U-ee>=12&&a?function(ie,ae,Te){return a.decode(ie.subarray(ae,Te))}(this.buf,ee,U):function(ie,ae,Te){for(var ve="",Ee=ae;Ee<Te;){var Re,He,ht,it=ie[Ee],ut=null,mt=it>239?4:it>223?3:it>191?2:1;if(Ee+mt>Te)break;mt===1?it<128&&(ut=it):mt===2?(192&(Re=ie[Ee+1]))==128&&(ut=(31&it)<<6|63&Re)<=127&&(ut=null):mt===3?(He=ie[Ee+2],(192&(Re=ie[Ee+1]))==128&&(192&He)==128&&((ut=(15&it)<<12|(63&Re)<<6|63&He)<=2047||ut>=55296&&ut<=57343)&&(ut=null)):mt===4&&(He=ie[Ee+2],ht=ie[Ee+3],(192&(Re=ie[Ee+1]))==128&&(192&He)==128&&(192&ht)==128&&((ut=(15&it)<<18|(63&Re)<<12|(63&He)<<6|63&ht)<=65535||ut>=1114112)&&(ut=null)),ut===null?(ut=65533,mt=1):ut>65535&&(ut-=65536,ve+=String.fromCharCode(ut>>>10&1023|55296),ut=56320|1023&ut),ve+=String.fromCharCode(ut),Ee+=mt}return ve}(this.buf,ee,U)},readBytes:function(){var U=this.readVarint()+this.pos,ee=this.buf.subarray(this.pos,U);return this.pos=U,ee},readPackedVarint:function(U,ee){if(this.type!==e.Bytes)return U.push(this.readVarint(ee));var ie=u(this);for(U=U||[];this.pos<ie;)U.push(this.readVarint(ee));return U},readPackedSVarint:function(U){if(this.type!==e.Bytes)return U.push(this.readSVarint());var ee=u(this);for(U=U||[];this.pos<ee;)U.push(this.readSVarint());return U},readPackedBoolean:function(U){if(this.type!==e.Bytes)return U.push(this.readBoolean());var ee=u(this);for(U=U||[];this.pos<ee;)U.push(this.readBoolean());return U},readPackedFloat:function(U){if(this.type!==e.Bytes)return U.push(this.readFloat());var ee=u(this);for(U=U||[];this.pos<ee;)U.push(this.readFloat());return U},readPackedDouble:function(U){if(this.type!==e.Bytes)return U.push(this.readDouble());var ee=u(this);for(U=U||[];this.pos<ee;)U.push(this.readDouble());return U},readPackedFixed32:function(U){if(this.type!==e.Bytes)return U.push(this.readFixed32());var ee=u(this);for(U=U||[];this.pos<ee;)U.push(this.readFixed32());return U},readPackedSFixed32:function(U){if(this.type!==e.Bytes)return U.push(this.readSFixed32());var ee=u(this);for(U=U||[];this.pos<ee;)U.push(this.readSFixed32());return U},readPackedFixed64:function(U){if(this.type!==e.Bytes)return U.push(this.readFixed64());var ee=u(this);for(U=U||[];this.pos<ee;)U.push(this.readFixed64());return U},readPackedSFixed64:function(U){if(this.type!==e.Bytes)return U.push(this.readSFixed64());var ee=u(this);for(U=U||[];this.pos<ee;)U.push(this.readSFixed64());return U},skip:function(U){var ee=7&U;if(ee===e.Varint)for(;this.buf[this.pos++]>127;);else if(ee===e.Bytes)this.pos=this.readVarint()+this.pos;else if(ee===e.Fixed32)this.pos+=4;else{if(ee!==e.Fixed64)throw new Error("Unimplemented type: "+ee);this.pos+=8}},writeTag:function(U,ee){this.writeVarint(U<<3|ee)},realloc:function(U){for(var ee=this.length||16;ee<this.pos+U;)ee*=2;if(ee!==this.length){var ie=new Uint8Array(ee);ie.set(this.buf),this.buf=ie,this.length=ee}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(U){this.realloc(4),te(this.buf,U,this.pos),this.pos+=4},writeSFixed32:function(U){this.realloc(4),te(this.buf,U,this.pos),this.pos+=4},writeFixed64:function(U){this.realloc(8),te(this.buf,-1&U,this.pos),te(this.buf,Math.floor(U*o),this.pos+4),this.pos+=8},writeSFixed64:function(U){this.realloc(8),te(this.buf,-1&U,this.pos),te(this.buf,Math.floor(U*o),this.pos+4),this.pos+=8},writeVarint:function(U){(U=+U||0)>268435455||U<0?function(ee,ie){var ae,Te;if(ee>=0?(ae=ee%4294967296|0,Te=ee/4294967296|0):(Te=~(-ee/4294967296),4294967295^(ae=~(-ee%4294967296))?ae=ae+1|0:(ae=0,Te=Te+1|0)),ee>=18446744073709552e3||ee<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ie.realloc(10),function(ve,Ee,Re){Re.buf[Re.pos++]=127&ve|128,ve>>>=7,Re.buf[Re.pos++]=127&ve|128,ve>>>=7,Re.buf[Re.pos++]=127&ve|128,ve>>>=7,Re.buf[Re.pos++]=127&ve|128,Re.buf[Re.pos]=127&(ve>>>=7)}(ae,0,ie),function(ve,Ee){var Re=(7&ve)<<4;Ee.buf[Ee.pos++]|=Re|((ve>>>=3)?128:0),ve&&(Ee.buf[Ee.pos++]=127&ve|((ve>>>=7)?128:0),ve&&(Ee.buf[Ee.pos++]=127&ve|((ve>>>=7)?128:0),ve&&(Ee.buf[Ee.pos++]=127&ve|((ve>>>=7)?128:0),ve&&(Ee.buf[Ee.pos++]=127&ve|((ve>>>=7)?128:0),ve&&(Ee.buf[Ee.pos++]=127&ve)))))}(Te,ie)}(U,this):(this.realloc(4),this.buf[this.pos++]=127&U|(U>127?128:0),U<=127||(this.buf[this.pos++]=127&(U>>>=7)|(U>127?128:0),U<=127||(this.buf[this.pos++]=127&(U>>>=7)|(U>127?128:0),U<=127||(this.buf[this.pos++]=U>>>7&127))))},writeSVarint:function(U){this.writeVarint(U<0?2*-U-1:2*U)},writeBoolean:function(U){this.writeVarint(!!U)},writeString:function(U){U=String(U),this.realloc(4*U.length),this.pos++;var ee=this.pos;this.pos=function(ae,Te,ve){for(var Ee,Re,He=0;He<Te.length;He++){if((Ee=Te.charCodeAt(He))>55295&&Ee<57344){if(!Re){Ee>56319||He+1===Te.length?(ae[ve++]=239,ae[ve++]=191,ae[ve++]=189):Re=Ee;continue}if(Ee<56320){ae[ve++]=239,ae[ve++]=191,ae[ve++]=189,Re=Ee;continue}Ee=Re-55296<<10|Ee-56320|65536,Re=null}else Re&&(ae[ve++]=239,ae[ve++]=191,ae[ve++]=189,Re=null);Ee<128?ae[ve++]=Ee:(Ee<2048?ae[ve++]=Ee>>6|192:(Ee<65536?ae[ve++]=Ee>>12|224:(ae[ve++]=Ee>>18|240,ae[ve++]=Ee>>12&63|128),ae[ve++]=Ee>>6&63|128),ae[ve++]=63&Ee|128)}return ve}(this.buf,U,this.pos);var ie=this.pos-ee;ie>=128&&g(ee,ie,this),this.pos=ee-1,this.writeVarint(ie),this.pos+=ie},writeFloat:function(U){this.realloc(4),n.write(this.buf,U,this.pos,!0,23,4),this.pos+=4},writeDouble:function(U){this.realloc(8),n.write(this.buf,U,this.pos,!0,52,8),this.pos+=8},writeBytes:function(U){var ee=U.length;this.writeVarint(ee),this.realloc(ee);for(var ie=0;ie<ee;ie++)this.buf[this.pos++]=U[ie]},writeRawMessage:function(U,ee){this.pos++;var ie=this.pos;U(ee,this);var ae=this.pos-ie;ae>=128&&g(ie,ae,this),this.pos=ie-1,this.writeVarint(ae),this.pos+=ae},writeMessage:function(U,ee,ie){this.writeTag(U,e.Bytes),this.writeRawMessage(ee,ie)},writePackedVarint:function(U,ee){ee.length&&this.writeMessage(U,v,ee)},writePackedSVarint:function(U,ee){ee.length&&this.writeMessage(U,x,ee)},writePackedBoolean:function(U,ee){ee.length&&this.writeMessage(U,C,ee)},writePackedFloat:function(U,ee){ee.length&&this.writeMessage(U,E,ee)},writePackedDouble:function(U,ee){ee.length&&this.writeMessage(U,A,ee)},writePackedFixed32:function(U,ee){ee.length&&this.writeMessage(U,k,ee)},writePackedSFixed32:function(U,ee){ee.length&&this.writeMessage(U,L,ee)},writePackedFixed64:function(U,ee){ee.length&&this.writeMessage(U,j,ee)},writePackedSFixed64:function(U,ee){ee.length&&this.writeMessage(U,G,ee)},writeBytesField:function(U,ee){this.writeTag(U,e.Bytes),this.writeBytes(ee)},writeFixed32Field:function(U,ee){this.writeTag(U,e.Fixed32),this.writeFixed32(ee)},writeSFixed32Field:function(U,ee){this.writeTag(U,e.Fixed32),this.writeSFixed32(ee)},writeFixed64Field:function(U,ee){this.writeTag(U,e.Fixed64),this.writeFixed64(ee)},writeSFixed64Field:function(U,ee){this.writeTag(U,e.Fixed64),this.writeSFixed64(ee)},writeVarintField:function(U,ee){this.writeTag(U,e.Varint),this.writeVarint(ee)},writeSVarintField:function(U,ee){this.writeTag(U,e.Varint),this.writeSVarint(ee)},writeStringField:function(U,ee){this.writeTag(U,e.Bytes),this.writeString(ee)},writeFloatField:function(U,ee){this.writeTag(U,e.Fixed32),this.writeFloat(ee)},writeDoubleField:function(U,ee){this.writeTag(U,e.Fixed64),this.writeDouble(ee)},writeBooleanField:function(U,ee){this.writeVarintField(U,!!ee)}},qy}var Wg=Qr(mw());const Wy=3;function CC(n,e,r){e.glyphs=[],n===1&&r.readMessage(MC,e)}function MC(n,e,r){if(n===3){const{id:o,bitmap:a,width:u,height:h,left:g,top:v,advance:x}=r.readMessage(PC,{});e.glyphs.push({id:o,bitmap:new Qd({width:u+2*Wy,height:h+2*Wy},a),metrics:{width:u,height:h,left:g,top:v,advance:x}})}else n===4?e.ascender=r.readSVarint():n===5&&(e.descender=r.readSVarint())}function PC(n,e,r){n===1?e.id=r.readVarint():n===2?e.bitmap=r.readBytes():n===3?e.width=r.readVarint():n===4?e.height=r.readVarint():n===5?e.left=r.readSVarint():n===6?e.top=r.readSVarint():n===7&&(e.advance=r.readVarint())}const RC=Wy,La={horizontal:1,vertical:2,horizontalOnly:3};class jm{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,r){const o=new jm;return o.scale=e||1,o.fontStack=r,o}static forImage(e){const r=new jm;return r.image=e,r}}class Up{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r,o){const a=new Up;for(let u=0;u<e.sections.length;u++){const h=e.sections[u];h.image?a.addImageSection(h,o):a.addTextSection(h,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(r,o){let a="";for(let u=0;u<r.length;u++){const h=r.charCodeAt(u+1)||null,g=r.charCodeAt(u-1)||null;a+=!o&&(h&&Bh(h)&&!Bm[r[u+1]]||g&&Bh(g)&&!Bm[r[u-1]])||!Bm[r[u]]?r[u]:Bm[r[u]]}return a}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&Zg[this.text.charCodeAt(o)];o++)e++;let r=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&Zg[this.text.charCodeAt(o)];o--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const o=new Up;return o.text=this.text.substring(e,r),o.sectionIndex=this.sectionIndex.slice(e,r),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(jm.forText(e.scale,e.fontStack||r));const o=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(o)}addImageSection(e,r){const o=e.image?e.image.getPrimary():null;if(!o)return void Rr("Can't add FormattedSection with an empty image.");o.scaleSelf(r);const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(jm.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Rr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zy(n,e,r,o,a,u,h,g,v,x,E,A,C,k,L,j=1){const G=Up.fromFeature(n,a,j);A===La.vertical&&G.verticalizePunctuation(C);let K=[];const te=function(ae,Te,ve,Ee,Re,He){if(!ae)return[];const ht=[],it=function(lt,qe,We,xt,bt,ir){let qt=0;for(let zt=0;zt<lt.length();zt++){const yt=lt.getSection(zt);qt+=gw(lt.getCodePoint(zt),yt,xt,bt,qe,ir)}return qt/Math.max(1,Math.ceil(qt/We))}(ae,Te,ve,Ee,Re,He),ut=ae.text.indexOf("​")>=0;let mt=0;for(let lt=0;lt<ae.length();lt++){const qe=ae.getSection(lt),We=ae.getCodePoint(lt);if(Zg[We]||(mt+=gw(We,qe,Ee,Re,Te,He)),lt<ae.length()-1){const xt=!((Ze=We)<11904||!(sr["Bopomofo Extended"](Ze)||sr.Bopomofo(Ze)||sr["CJK Compatibility Forms"](Ze)||sr["CJK Compatibility Ideographs"](Ze)||sr["CJK Compatibility"](Ze)||sr["CJK Radicals Supplement"](Ze)||sr["CJK Strokes"](Ze)||sr["CJK Symbols and Punctuation"](Ze)||sr["CJK Unified Ideographs Extension A"](Ze)||sr["CJK Unified Ideographs"](Ze)||sr["Enclosed CJK Letters and Months"](Ze)||sr["Halfwidth and Fullwidth Forms"](Ze)||sr.Hiragana(Ze)||sr["Ideographic Description Characters"](Ze)||sr["Kangxi Radicals"](Ze)||sr["Katakana Phonetic Extensions"](Ze)||sr.Katakana(Ze)||sr["Vertical Forms"](Ze)||sr["Yi Radicals"](Ze)||sr["Yi Syllables"](Ze)));(zC[We]||xt||qe.image)&&ht.push(yw(lt+1,mt,it,ht,kC(We,ae.getCodePoint(lt+1),xt&&ut),!1))}}var Ze;return vw(yw(ae.length(),mt,it,ht,0,!0))}(G,x,u,e,o,k),{processBidirectionalText:ne,processStyledBidirectionalText:U}=Ma;if(ne&&G.sections.length===1){const ae=ne(G.toString(),te);for(const Te of ae){const ve=new Up;ve.text=Te,ve.sections=G.sections;for(let Ee=0;Ee<Te.length;Ee++)ve.sectionIndex.push(0);K.push(ve)}}else if(U){const ae=U(G.text,G.sectionIndex,te);for(const Te of ae){const ve=new Up;ve.text=Te[0],ve.sectionIndex=Te[1],ve.sections=G.sections,K.push(ve)}}else K=function(ae,Te){const ve=[],Ee=ae.text;let Re=0;for(const He of Te)ve.push(ae.substring(Re,He)),Re=He;return Re<Ee.length&&ve.push(ae.substring(Re,Ee.length)),ve}(G,te);const ee=[],ie={positionedLines:ee,text:G.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(ae,Te,ve,Ee,Re,He,ht,it,ut,mt,Ze,lt){let qe=0,We=0,xt=0;const bt=it==="right"?1:it==="left"?0:.5;let ir=!1;for(const Zt of Re){const pr=Zt.getSections();for(const Fr of pr){if(Fr.image)continue;const kr=Te[Fr.fontStack];if(kr&&(ir=kr.ascender!==void 0&&kr.descender!==void 0,!ir))break}if(!ir)break}let qt=0;for(const Zt of Re){Zt.trim();const pr=Zt.getMaxScale(),Fr=(pr-1)*Us,kr={positionedGlyphs:[],lineOffset:0};ae.positionedLines[qt]=kr;const Zr=kr.positionedGlyphs;let jr=0;if(!Zt.length()){We+=He,++qt;continue}let Xr=0,Dn=0;for(let oe=0;oe<Zt.length();oe++){const fe=Zt.getSection(oe),Ke=Zt.getSectionIndex(oe),St=Zt.getCodePoint(oe);let kt=fe.scale,Rt=null,Ut=null,fr=null,an=Us,ln=0;ut===La.vertical&&((zt=St)===12312||zt===12313||zt===12316||zt===12540||zt===12448)&&(ut=La.horizontal);const Vr=!(ut===La.horizontal||!Ze&&!Rd(St)||Ze&&(Zg[St]||Ip(St)));if(fe.image){const Fn=Ee.get(fe.image.toString());if(!Fn)continue;fr=fe.image,ae.iconsInText=ae.iconsInText||!0,Ut=Fn.paddedRect;const Qn=Fn.displaySize;kt=kt*Us/lt,Rt={width:Qn[0],height:Qn[1],left:0,top:-3,advance:Vr?Qn[1]:Qn[0],localGlyph:!1},ln=ir?-Rt.height*kt:pr*Us-17-Qn[1]*kt,an=Rt.advance;const cn=(Vr?Qn[0]:Qn[1])*kt-Us*pr;cn>0&&cn>jr&&(jr=cn)}else{const Fn=ve[fe.fontStack];if(!Fn)continue;Fn[St]&&(Ut=Fn[St]);const Qn=Te[fe.fontStack];if(!Qn)continue;const cn=Qn.glyphs[St];if(!cn)continue;if(Rt=cn.metrics,an=St!==8203?Us:0,ir){const Ti=Qn.ascender!==void 0?Math.abs(Qn.ascender):0,ii=Qn.descender!==void 0?Math.abs(Qn.descender):0,Ln=(Ti+ii)*kt;Xr<Ln&&(Xr=Ln,Dn=(Ti-ii)/2*kt),ln=-Ti*kt}else ln=(pr-kt)*Us-17}Vr?(ae.verticalizable=!0,Zr.push({glyph:St,image:fr,x:qe,y:We+ln,vertical:Vr,scale:kt,localGlyph:Rt.localGlyph,fontStack:fe.fontStack,sectionIndex:Ke,metrics:Rt,rect:Ut}),qe+=an*kt+mt):(Zr.push({glyph:St,image:fr,x:qe,y:We+ln,vertical:Vr,scale:kt,localGlyph:Rt.localGlyph,fontStack:fe.fontStack,sectionIndex:Ke,metrics:Rt,rect:Ut}),qe+=Rt.advance*kt+mt)}Zr.length!==0&&(xt=Math.max(qe-mt,xt),ir?xw(Zr,bt,jr,Dn,He*pr/2):xw(Zr,bt,jr,0,He/2)),qe=0;const ni=He*pr+jr;kr.lineOffset=Math.max(jr,Fr),We+=ni,++qt}var zt;const yt=We,{horizontalAlign:wr,verticalAlign:Gt}=Xy(ht);(function(Zt,pr,Fr,kr,Zr,jr){const Xr=(pr-Fr)*Zr,Dn=-jr*kr;for(const ni of Zt)for(const oe of ni.positionedGlyphs)oe.x+=Xr,oe.y+=Dn})(ae.positionedLines,bt,wr,Gt,xt,yt),ae.top+=-Gt*yt,ae.bottom=ae.top+yt,ae.left+=-wr*xt,ae.right=ae.left+xt,ae.hasBaseline=ir}(ie,e,r,o,K,h,g,v,A,x,C,L),!function(ae){for(const Te of ae)if(Te.positionedGlyphs.length!==0)return!1;return!0}(ee))return ie}const Zg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},zC={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function gw(n,e,r,o,a,u){if(e.image){const h=o.get(e.image.toString());return h?h.displaySize[0]*e.scale*Us/u+a:0}{const h=r[e.fontStack],g=h&&h.glyphs[n];return g?g.metrics.advance*e.scale+a:0}}function _w(n,e,r,o){const a=Math.pow(n-e,2);return o?n<e?a/2:2*a:a+Math.abs(r)*r}function kC(n,e,r){let o=0;return n===10&&(o-=1e4),r&&(o+=150),n!==40&&n!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function yw(n,e,r,o,a,u){let h=null,g=_w(e,r,a,u);for(const v of o){const x=_w(e-v.x,r,a,u)+v.badness;x<=g&&(h=v,g=x)}return{index:n,x:e,priorBreak:h,badness:g}}function vw(n){return n?vw(n.priorBreak).concat(n.index):[]}function Xy(n){let e=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function xw(n,e,r,o,a){if(!(e||r||o||a))return;const u=n.length-1,h=n[u],g=(h.x+h.metrics.advance*h.scale)*e;for(let v=0;v<=u;v++)n[v].x-=g,n[v].y+=r+o+a}function ww(n){return n.imagePrimary!==void 0&&n.top!==void 0&&n.bottom!==void 0&&n.left!==void 0&&n.right!==void 0}function DC(n,e,r,o){const{horizontalAlign:a,verticalAlign:u}=Xy(o),h=r[0]-n.displaySize[0]*a,g=r[1]-n.displaySize[1]*u;return{imagePrimary:n,imageSecondary:e,top:g,bottom:g+n.displaySize[1],left:h,right:h+n.displaySize[0]}}function bw(n,e,r,o,a,u){const h=n.imagePrimary;let g;if(h.content){const G=h.content,K=h.pixelRatio||1;g=[G[0]/K,G[1]/K,h.displaySize[0]-G[2]/K,h.displaySize[1]-G[3]/K]}const v=e.left*u,x=e.right*u;let E,A,C,k;r==="width"||r==="both"?(k=a[0]+v-o[3],A=a[0]+x+o[1]):(k=a[0]+(v+x-h.displaySize[0])/2,A=k+h.displaySize[0]);const L=e.top*u,j=e.bottom*u;return r==="height"||r==="both"?(E=a[1]+L-o[0],C=a[1]+j+o[2]):(E=a[1]+(L+j-h.displaySize[1])/2,C=E+h.displaySize[1]),{imagePrimary:h,imageSecondary:void 0,top:E,right:A,bottom:C,left:k,collisionPadding:g}}function Tw(n){return!n.imagePrimary.stretchX}function Sw(n){return!n.imagePrimary.stretchY}function Ew(n){return{width:n.right-n.left,height:n.bottom-n.top}}const ah=128;function Iw(n,e,r){const{expression:o}=e;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new zn(n+1,{worldview:r}))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:u}=o;let h=0;for(;h<a.length&&a[h]<=n;)h++;h=Math.max(0,h-1);let g=h;for(;g<a.length&&a[g]<n+1;)g++;g=Math.min(a.length-1,g);const v=a[h],x=a[g];return o.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:v,maxZoom:x,minSize:o.evaluate(new zn(v,{worldview:r})),maxSize:o.evaluate(new zn(x,{worldview:r})),interpolationType:u}}}function Yy(n,{uSize:e,uSizeT:r},{lowerSize:o,upperSize:a}){return n.kind==="source"?o/ah:n.kind==="composite"?lr(o/ah,a/ah,r):e}function Vm(n,e,r=1){let o=0,a=0;if(n.kind==="constant")a=n.layoutSize*r;else if(n.kind!=="source"){const{interpolationType:u,minZoom:h,maxZoom:g}=n,v=u?me(Es.interpolationFactor(u,e,h,g),0,1):0;n.kind==="camera"?a=lr(n.minSize,n.maxSize,v)*r:o=v*r}return{uSizeT:o,uSize:a}}class nd extends ft{constructor(e,r,o,a,u){super(e,r),this.angle=a,this.z=o,u!==void 0&&(this.segment=u)}clone(){return new nd(this.x,this.y,this.z,this.angle,this.segment)}}function Aw(n,e,r,o,a){if(e.segment===void 0)return!0;let u=e,h=e.segment+1,g=0;for(;g>-r/2;){if(h--,h<0)return!1;g-=n[h].dist(u),u=n[h]}g+=n[h].dist(n[h+1]),h++;const v=[];let x=0;for(;g<r/2;){const E=n[h],A=n[h+1];if(!A)return!1;let C=n[h-1].angleTo(E)-E.angleTo(A);for(C=Math.abs((C+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:g,angleDelta:C}),x+=C;g-v[0].distance>o;)x-=v.shift().angleDelta;if(x>a)return!1;h++,g+=E.dist(A)}return!0}function Cw(n){let e=0;for(let r=0;r<n.length-1;r++)e+=n[r].dist(n[r+1]);return e}function Mw(n,e,r){return n?.6*e*r:0}function Pw(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function LC(n,e,r,o,a,u){const h=Mw(r,a,u),g=Pw(r,o)*u;let v=0;const x=Cw(n)/2;for(let E=0;E<n.length-1;E++){const A=n[E],C=n[E+1],k=A.dist(C);if(v+k>x){const L=(x-v)/k,j=lr(A.x,C.x,L),G=lr(A.y,C.y,L),K=new nd(j,G,0,C.angleTo(A),E);return!h||Aw(n,K,g,h,e)?K:void 0}v+=k}}function OC(n,e,r,o,a,u,h,g,v){const x=Mw(o,u,h),E=Pw(o,a),A=E*h,C=n[0].x===0||n[0].x===v||n[0].y===0||n[0].y===v;return e-A<e/4&&(e=A+e/4),Rw(n,C?e/2*g%e:(E/2+2*u)*h*g%e,e,x,r,A,C,!1,v)}function Rw(n,e,r,o,a,u,h,g,v){const x=u/2,E=Cw(n);let A=0,C=e-r,k=[];for(let L=0;L<n.length-1;L++){const j=n[L],G=n[L+1],K=j.dist(G),te=G.angleTo(j);for(;C+r<A+K;){C+=r;const ne=(C-A)/K,U=lr(j.x,G.x,ne),ee=lr(j.y,G.y,ne);if(U>=0&&U<v&&ee>=0&&ee<v&&C-x>=0&&C+x<=E){const ie=new nd(U,ee,0,te,L);o&&!Aw(n,ie,u,o,a)||k.push(ie)}}A+=K}return g||k.length||h||(k=Rw(n,A/2,r,o,a,u,h,!0,v)),k}function zw(n){let e=0,r=0;for(const h of n)e+=h.w*h.h,r=Math.max(r,h.w);n.sort((h,g)=>g.h-h.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let a=0,u=0;for(const h of n)for(let g=o.length-1;g>=0;g--){const v=o[g];if(!(h.w>v.w||h.h>v.h)){if(h.x=v.x,h.y=v.y,u=Math.max(u,h.y+h.h),a=Math.max(a,h.x+h.w),h.w===v.w&&h.h===v.h){const x=o.pop();g<o.length&&(o[g]=x)}else h.h===v.h?(v.x+=h.w,v.w-=h.w):h.w===v.w?(v.y+=h.h,v.h-=h.h):(o.push({x:v.x+h.w,y:v.y,w:v.w-h.w,h:h.h}),v.y+=h.h,v.h-=h.h);break}}return{w:a,h:u,fill:e/(a*u)||0}}Ft(nd,"Anchor");const Qf=1;class Um{static getImagePositionScale(e,r,o){if(r&&e&&e.options&&e.options.transform){const a=e.options.transform;return{x:a.a,y:a.d}}return{x:o,y:o}}constructor(e,r,o,a){this.paddedRect=e;const{pixelRatio:u,version:h,stretchX:g,stretchY:v,content:x,sdf:E,usvg:A}=r;this.pixelRatio=u,this.stretchX=g,this.stretchY=v,this.content=x,this.version=h,this.padding=o,this.sdf=E,this.usvg=A,this.scale=Um.getImagePositionScale(a,A,u)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Ky(n,e,r){const o=_l.parse(n),a=function(u,h,g=[1,1]){return{x:0,y:0,w:(u.data?u.data.width:u.width*g[0])+2*h,h:(u.data?u.data.height:u.height*g[1])+2*h}}(e,r,[o.options.transform.a,o.options.transform.d]);return{bin:a,imagePosition:new Um(a,e,r,o),imageVariant:o}}class kw{constructor(e,r,o){const a=new Map,u=new Map;this.haveRenderCallbacks=[];const h=[];this.addImages(e,a,Qf,h),this.addImages(r,u,2,h);const{w:g,h:v}=zw(h),x=new so({width:g||1,height:v||1});for(const[E,A]of e.entries()){const C=a.get(E).paddedRect;so.copy(A.data,x,{x:0,y:0},{x:C.x+Qf,y:C.y+Qf},A.data,o,A.sdf)}for(const[E,A]of r.entries()){const C=u.get(E),k=C.paddedRect;let L=C.padding;const j=k.x+L,G=k.y+L,K=A.data.width,te=A.data.height;L=L>1?L-1:L,so.copy(A.data,x,{x:0,y:0},{x:j,y:G},A.data,o),so.copy(A.data,x,{x:0,y:te-L},{x:j,y:G-L},{width:K,height:L},o),so.copy(A.data,x,{x:0,y:0},{x:j,y:G+te},{width:K,height:L},o),so.copy(A.data,x,{x:K-L,y:0},{x:j-L,y:G},{width:L,height:te},o),so.copy(A.data,x,{x:0,y:0},{x:j+K,y:G},{width:L,height:te},o),so.copy(A.data,x,{x:K-L,y:te-L},{x:j-L,y:G-L},{width:L,height:L},o),so.copy(A.data,x,{x:0,y:te-L},{x:j+K,y:G-L},{width:L,height:L},o),so.copy(A.data,x,{x:0,y:0},{x:j+K,y:G+te},{width:L,height:L},o),so.copy(A.data,x,{x:K-L,y:0},{x:j-L,y:G+te},{width:L,height:L},o)}this.lut=o,this.image=x,this.iconPositions=a,this.patternPositions=u}addImages(e,r,o,a){for(const[u,h]of e.entries()){const{bin:g,imagePosition:v,imageVariant:x}=Ky(u,h,o);r.set(u,v),a.push(g),h.hasRenderCallback&&this.haveRenderCallbacks.push(x.id)}}patchUpdatedImages(e,r,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(const a of e.getUpdatedImages(o)){for(const u of this.iconPositions.keys()){const h=_l.parse(u);if(Gs.isEqual(h.id,a)){const g=e.getImage(a,o);this.patchUpdatedImage(this.iconPositions.get(u),g,r)}}for(const u of this.patternPositions.keys()){const h=_l.parse(u);if(Gs.isEqual(h.id,a)){const g=e.getImage(a,o);this.patchUpdatedImage(this.patternPositions.get(u),g,r)}}}}patchUpdatedImage(e,r,o){if(!e||!r||e.version===r.version)return;e.version=r.version;const[a,u]=e.tl,h=e.sdf;if(this.lut||h){const g={width:r.data.width,height:r.data.height},v=new so(g);so.copy(r.data,v,{x:0,y:0},{x:0,y:0},g,this.lut,h),o.update(v,{position:{x:a,y:u}})}else o.update(r.data,{position:{x:a,y:u}})}}Ft(Um,"ImagePosition"),Ft(kw,"ImageAtlas");const Xg=1e20;function Dw(n,e,r,o,a,u,h,g,v){for(let x=e;x<e+o;x++)Lw(n,r*u+x,u,a,h,g,v);for(let x=r;x<r+a;x++)Lw(n,x*u+e,1,o,h,g,v)}function Lw(n,e,r,o,a,u,h){u[0]=0,h[0]=-1e20,h[1]=Xg,a[0]=n[e];for(let g=1,v=0,x=0;g<o;g++){a[g]=n[e+g*r];const E=g*g;do{const A=u[v];x=(a[g]-a[A]+E-A*A)/(g-A)/2}while(x<=h[v]&&--v>-1);v++,u[v]=g,h[v]=x,h[v+1]=Xg}for(let g=0,v=0;g<o;g++){for(;h[v+1]<g;)v++;const x=u[v],E=g-x;n[e+g*r]=a[x]+E*E}}const fu=2,Jy={none:0,ideographs:1,all:2};class $p{constructor(e,r,o){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,r){this.urls[r]=e}getGlyphs(e,r,o){const a=[],u=this.urls[r]||bs.GLYPHS_URL;for(const h in e)for(const g of e[h])a.push({stack:h,id:g});Ce(a,({stack:h,id:g},v)=>{let x=this.entries[h];x||(x=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=x.glyphs[g];if(E!==void 0)return void v(null,{stack:h,id:g,glyph:E});if(E=this._tinySDF(x,h,g),E)return x.glyphs[g]=E,void v(null,{stack:h,id:g,glyph:E});const A=Math.floor(g/256);if(256*A>65535)return Rr("glyphs > 65535 not supported"),void v(null,{stack:h,id:g,glyph:E});if(x.ranges[A])return void v(null,{stack:h,id:g,glyph:E});let C=x.requests[A];C||(C=x.requests[A]=[],$p.loadGlyphRange(h,A,u,this.requestManager,(k,L)=>{if(L){x.ascender=L.ascender,x.descender=L.descender;for(const j in L.glyphs)this._doesCharSupportLocalGlyph(+j)||(x.glyphs[+j]=L.glyphs[+j]);x.ranges[A]=!0}for(const j of C)j(k,L);delete x.requests[A]})),C.push((k,L)=>{k?v(k):L&&v(null,{stack:h,id:g,glyph:L.glyphs[g]||null})})},(h,g)=>{if(h)o(h);else if(g){const v={};for(const{stack:x,id:E,glyph:A}of g)v[x]===void 0&&(v[x]={}),v[x].glyphs===void 0&&(v[x].glyphs={}),v[x].glyphs[E]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},v[x].ascender=this.entries[x].ascender,v[x].descender=this.entries[x].descender;o(null,v)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Jy.none&&(this.localGlyphMode===Jy.all?!!this.localFontFamily:!!this.localFontFamily&&(sr["CJK Unified Ideographs"](e)||sr["Hangul Syllables"](e)||sr.Hiragana(e)||sr.Katakana(e)||sr["CJK Symbols and Punctuation"](e)||sr["CJK Unified Ideographs Extension A"](e)||sr["CJK Unified Ideographs Extension B"](e)||sr.Osage(e)))}_tinySDF(e,r,o){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(o))return;let u=e.tinySDF;if(!u){let j="400";/bold/i.test(r)?j="900":/medium/i.test(r)?j="500":/light/i.test(r)&&(j="200"),u=e.tinySDF=new $p.TinySDF({fontFamily:a,fontWeight:j,fontSize:24*fu,buffer:3*fu,radius:8*fu}),u.fontWeight=j}if(this.localGlyphs[u.fontWeight][o])return this.localGlyphs[u.fontWeight][o];const h=String.fromCodePoint(o),{data:g,width:v,height:x,glyphWidth:E,glyphHeight:A,glyphLeft:C,glyphTop:k,glyphAdvance:L}=u.draw(h);return this.localGlyphs[u.fontWeight][o]={id:o,bitmap:new Qd({width:v,height:x},g),metrics:{width:E/fu,height:A/fu,left:C/fu,top:k/fu-27,advance:L/fu,localGlyph:!0}}}}$p.loadGlyphRange=function(n,e,r,o,a){const u=256*e,h=u+255,g=o.transformRequest(o.normalizeGlyphsURL(r).replace("{fontstack}",n).replace("{range}",`${u}-${h}`),fa.Glyphs);mh(g,(v,x)=>{if(v)a(v);else if(x){const E={},A=function(C){return new Wg(C).readFields(CC,{})}(x);for(const C of A.glyphs)E[C.id]=C;a(null,{glyphs:E,ascender:A.ascender,descender:A.descender})}})},$p.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:r=8,cutoff:o=.25,fontFamily:a="sans-serif",fontWeight:u="normal",fontStyle:h="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=r;const g=this.size=n+4*e,v=this._createCanvas(g),x=this.ctx=v.getContext("2d",{willReadFrequently:!0});x.font=`${h} ${u} ${n}px ${a}`,x.textBaseline="alphabetic",x.textAlign="left",x.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:o,actualBoundingBoxLeft:a,actualBoundingBoxRight:u}=this.ctx.measureText(n),h=Math.ceil(r),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-a))),v=Math.min(this.size-this.buffer,h+Math.ceil(o)),x=g+2*this.buffer,E=v+2*this.buffer,A=Math.max(x*E,0),C=new Uint8ClampedArray(A),k={data:C,width:x,height:E,glyphWidth:g,glyphHeight:v,glyphTop:h,glyphLeft:0,glyphAdvance:e};if(g===0||v===0)return k;const{ctx:L,buffer:j,gridInner:G,gridOuter:K}=this;L.clearRect(j,j,g,v),L.fillText(n,j,j+h);const te=L.getImageData(j,j,g,v);K.fill(Xg,0,A),G.fill(0,0,A);for(let ne=0;ne<v;ne++)for(let U=0;U<g;U++){const ee=te.data[4*(ne*g+U)+3]/255;if(ee===0)continue;const ie=(ne+j)*x+U+j;if(ee===1)K[ie]=0,G[ie]=Xg;else{const ae=.5-ee;K[ie]=ae>0?ae*ae:0,G[ie]=ae<0?ae*ae:0}}Dw(K,0,0,x,E,x,this.f,this.v,this.z),Dw(G,j,j,g,v,x,this.f,this.v,this.z);for(let ne=0;ne<A;ne++){const U=Math.sqrt(K[ne])-Math.sqrt(G[ne]);C[ne]=Math.round(255-255*(U/this.radius+this.cutoff))}return k}};const ep=Qf;function Ow(n,e){return n+e[1]-e[0]}function Fw(n,e,r,o,a=1){const u=[],h=n.imagePrimary,g=h.pixelRatio,v=h.paddedRect.w-2*ep,x=h.paddedRect.h-2*ep,E=(n.right-n.left)*a,A=(n.bottom-n.top)*a,C=h.stretchX||[[0,v]],k=h.stretchY||[[0,x]],L=C.reduce(Ow,0),j=k.reduce(Ow,0),G=v-L,K=x-j;let te=0,ne=L,U=0,ee=j,ie=0,ae=G,Te=0,ve=K;if(h.content&&o){const Re=h.content;te=Yg(C,0,Re[0]),U=Yg(k,0,Re[1]),ne=Yg(C,Re[0],Re[2]),ee=Yg(k,Re[1],Re[3]),ie=Re[0]-te,Te=Re[1]-U,ae=Re[2]-Re[0]-ne,ve=Re[3]-Re[1]-ee}const Ee=(Re,He,ht,it)=>{const ut=Kg(Re.stretch-te,ne,E,n.left*a),mt=Jg(Re.fixed-ie,ae,Re.stretch,L),Ze=Kg(He.stretch-U,ee,A,n.top*a),lt=Jg(He.fixed-Te,ve,He.stretch,j),qe=Kg(ht.stretch-te,ne,E,n.left*a),We=Jg(ht.fixed-ie,ae,ht.stretch,L),xt=Kg(it.stretch-U,ee,A,n.top*a),bt=Jg(it.fixed-Te,ve,it.stretch,j),ir=new ft(ut,Ze),qt=new ft(qe,Ze),zt=new ft(qe,xt),yt=new ft(ut,xt),wr=new ft(mt/g,lt/g),Gt=new ft(We/g,bt/g),Zt=e*Math.PI/180;if(Zt){const Xr=Math.sin(Zt),Dn=Math.cos(Zt),ni=[Dn,-Xr,Xr,Dn];ir._matMult(ni),qt._matMult(ni),yt._matMult(ni),zt._matMult(ni)}const pr=Re.stretch+Re.fixed,Fr=ht.stretch+ht.fixed,kr=He.stretch+He.fixed,Zr=it.stretch+it.fixed,jr=n.imageSecondary;return{tl:ir,tr:qt,bl:yt,br:zt,texPrimary:{x:h.paddedRect.x+ep+pr,y:h.paddedRect.y+ep+kr,w:Fr-pr,h:Zr-kr},texSecondary:jr?{x:jr.paddedRect.x+ep+pr,y:jr.paddedRect.y+ep+kr,w:Fr-pr,h:Zr-kr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:wr,pixelOffsetBR:Gt,minFontScaleX:ae/g/E,minFontScaleY:ve/g/A,isSDF:r}};if(o&&(h.stretchX||h.stretchY)){const Re=Nw(C,G,L),He=Nw(k,K,j);for(let ht=0;ht<Re.length-1;ht++){const it=Re[ht],ut=Re[ht+1];for(let mt=0;mt<He.length-1;mt++)u.push(Ee(it,He[mt],ut,He[mt+1]))}}else u.push(Ee({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:x+1}));return u}function Yg(n,e,r){let o=0;for(const a of n)o+=Math.max(e,Math.min(r,a[1]))-Math.max(e,Math.min(r,a[0]));return o}function Nw(n,e,r){const o=[{fixed:-1,stretch:0}];for(const[a,u]of n){const h=o[o.length-1];o.push({fixed:a-h.stretch,stretch:h.stretch}),o.push({fixed:a-h.stretch,stretch:h.stretch+(u-a)})}return o.push({fixed:e+ep,stretch:r}),o}function Kg(n,e,r,o){return n/e*r+o}function Jg(n,e,r,o){return n-e*r/o}function FC(n,e,r,o){const a=e+n.positionedLines[o].lineOffset;return o===0?r+a/2:r+(a+(e+n.positionedLines[o-1].lineOffset))/2}function NC(n,e=1,r=!1){let o=1/0,a=1/0,u=-1/0,h=-1/0;const g=n[0];for(let k=0;k<g.length;k++){const L=g[k];(!k||L.x<o)&&(o=L.x),(!k||L.y<a)&&(a=L.y),(!k||L.x>u)&&(u=L.x),(!k||L.y>h)&&(h=L.y)}const v=Math.min(u-o,h-a);let x=v/2;const E=new Cu([],BC);if(v===0)return new ft(o,a);for(let k=o;k<u;k+=v)for(let L=a;L<h;L+=v)E.push(new Gp(k+x,L+x,x,n));let A=function(k){let L=0,j=0,G=0;const K=k[0];for(let te=0,ne=K.length,U=ne-1;te<ne;U=te++){const ee=K[te],ie=K[U],ae=ee.x*ie.y-ie.x*ee.y;j+=(ee.x+ie.x)*ae,G+=(ee.y+ie.y)*ae,L+=3*ae}return new Gp(j/L,G/L,0,k)}(n),C=E.length;for(;E.length;){const k=E.pop();(k.d>A.d||!A.d)&&(A=k,r&&console.log("found best %d after %d probes",Math.round(1e4*k.d)/1e4,C)),k.max-A.d<=e||(x=k.h/2,E.push(new Gp(k.p.x-x,k.p.y-x,x,n)),E.push(new Gp(k.p.x+x,k.p.y-x,x,n)),E.push(new Gp(k.p.x-x,k.p.y+x,x,n)),E.push(new Gp(k.p.x+x,k.p.y+x,x,n)),C+=4)}return r&&(console.log(`num probes: ${C}`),console.log(`best distance: ${A.d}`)),A.p}function BC(n,e){return e.max-n.max}class Gp{constructor(e,r,o,a){this.p=new ft(e,r),this.h=o,this.d=function(u,h){let g=!1,v=1/0;for(let x=0;x<h.length;x++){const E=h[x];for(let A=0,C=E.length,k=C-1;A<C;k=A++){const L=E[A],j=E[k];L.y>u.y!=j.y>u.y&&u.x<(j.x-L.x)*(u.y-L.y)/(j.y-L.y)+L.x&&(g=!g),v=Math.min(v,Kd(u,L,j))}}return(g?1:-1)*Math.sqrt(v)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}}const jC=Object.keys,Qy=Number.POSITIVE_INFINITY,VC=Math.sqrt(2);function Bw(n,[e,r]){let o=0,a=0;if(r===Qy){e<0&&(e=0);const u=e/VC;switch(n){case"top-right":case"top-left":a=u-7;break;case"bottom-right":case"bottom-left":a=7-u;break;case"bottom":a=7-e;break;case"top":a=e-7}switch(n){case"top-right":case"bottom-right":o=-u;break;case"top-left":case"bottom-left":o=u;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),n){case"top-right":case"top-left":case"top":a=r-7;break;case"bottom-right":case"bottom-left":case"bottom":a=7-r}switch(n){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,a]}function Qg(n,e,r,o,a,u,h,g,v){if(!e||!e.usvg)return;const x=Ew(o),E=Ew(a),A=u!=="both"&&u!=="width"||!Tw(o)?1:E.width/x.width,C=u!=="both"&&u!=="height"||!Sw(o)?1:E.height/x.height;r.scaleSelf(A,C);const k=r.toString();h.set(k,r),g.set(k,e);const{imagePosition:L}=Ky(k,e,Qf);v.set(k,L)}function jw(n,e,r,o,a,u,h,g,v){if(!n)return;const x=function(E,A,C,k,L,j){if(E.kind==="camera")return E.maxSize;if(E.kind==="composite"){const G=A.possiblyEvaluate(new zn(E.maxZoom,{worldview:j}),C).evaluate(L,{},C),K=A.possiblyEvaluate(new zn(E.minZoom,{worldview:j}),C).evaluate(L,{},C);return Math.max(G,K)}return A.possiblyEvaluate(new zn(k,{worldview:j})).evaluate(L,{},C)}(e,r,o,a,u,v);return n.scaleSelf(x*g*h)}function Vw(n,e,r,o,a,u,h,g,v){return{iconPrimary:jw(n.getPrimary(),e,r,o,a,u,h,g,v),iconSecondary:jw(n.getSecondary(),e,r,o,a,u,h,g,v)}}function UC(n,e,r){if(!e)return;const o=r.get(n.toString()),a=r.get(e.toString());a&&(o.paddedRect.w===a.paddedRect.w&&o.paddedRect.h===a.paddedRect.h||Rr(`Mismatch in icon variant sizes: ${n.toString()} and ${e.toString()}`),o.usvg!==a.usvg&&Rr(`Mismatch in icon variant image types: ${n.id} and ${e.id}`))}function Uw(n,e,r,o){if(!n)return;const a=e.get(r.toString());if(n.imagePrimary=a,o){const u=e.get(o.toString());n.imageSecondary=u}}function $C(n,e){for(const r in n.horizontal)$w(n.horizontal[r],e);$w(n.vertical,e)}function $w(n,e){if(n){for(const r of n.positionedLines)for(const o of r.positionedGlyphs)if(o.image!==null){const a=o.image.toString();o.rect=e.get(a).paddedRect}}}function ev(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function GC(n,e,r,o,a,u,h,g,v){const x=tv(u.horizontal)||u.vertical,E=r.get("icon-text-fit-padding").evaluate(o,{},a);let A,C=e;return e&&v!=="none"&&(n.allowVerticalPlacement&&u.vertical&&(A=bw(e,u.vertical,v,E,g,h)),x&&(C=bw(e,x,v,E,g,h))),{defaultShapedIcon:C,verticallyShapedIcon:A}}function qC(n,e,r,o,a,u,h,g,v,x,E,A,C,k,L,j,G,K,te,ne){let U=h.textMaxSize.evaluate(e,{},C);U===void 0?U=g*h.textScaleFactor:U*=h.textScaleFactor;const ee=n.layers[0].layout,ie=tv(r.horizontal)||r.vertical,ae=k.name==="globe",Te=Us,ve=n.tilePixelRatio*U/Te,Ee=(mt=n.overscaling,n.zoom>18&&mt>2&&(mt>>=1),Math.max(Ct/(512*mt),1)*ee.get("symbol-spacing")),Re=ee.get("text-padding")*n.tilePixelRatio,He=ee.get("icon-padding")*n.tilePixelRatio,ht=en(ee.get("text-max-angle")),it=ee.get("icon-rotation-alignment")==="map"&&ne!=="point",ut=Ee/2;var mt;n.hasAnyIconTextFit===!1&&G!=="none"&&(n.hasAnyIconTextFit=!0);const Ze=e.properties?+e.properties[Wr]:null,lt=Ze&&n.elevationFeatureIdToIndex?n.elevationFeatureIdToIndex.get(Ze):65535,qe=(We,xt,bt)=>{if(xt.x<0||xt.x>=Ct||xt.y<0||xt.y>=Ct)return;let ir=null;if(ae){const{x:qt,y:zt,z:yt}=k.projectTilePoint(xt.x,xt.y,bt);ir={anchor:new nd(qt,zt,yt,0,void 0),up:k.upVector(bt,xt.x,xt.y)}}(function(qt,zt,yt,wr,Gt,Zt,pr,Fr,kr,Zr,jr,Xr,Dn,ni,oe,fe,Ke,St,kt,Rt,Ut,fr,an,ln,Vr,Fn,Qn,cn,Ti){const ii=qt.addToLineVertexArray(zt,wr);let Ln,Mi,ai,ei,si,Bn,qr,Vn=0,Si=0,cr=0,yn=0,li=-1,Ii=-1;const pi={};let Qi=zc("");const Hn=yt?yt.anchor:zt,Xi=cn!=="none";let ya=0,oo=0;if(kr._unevaluatedLayout.getValue("text-radial-offset")===void 0){const es=kr.layout.get("text-offset").evaluate(Ut,{},Vr);ya=es[0]*Us,oo=es[1]*Us}else ya=kr.layout.get("text-radial-offset").evaluate(Ut,{},Vr)*Us,oo=Qy;if(qt.allowVerticalPlacement&&Gt.vertical){const es=Gt.vertical;if(oe)Bn=rv(es),Fr&&(qr=rv(Fr));else{const vs=kr.layout.get("text-rotate").evaluate(Ut,{},Vr)+90;ai=e_(Zr,Hn,zt,jr,Xr,Dn,es,ni,vs,fe),Fr&&(ei=e_(Zr,Hn,zt,jr,Xr,Dn,Fr,St,vs))}}if(Zt){const es=qt.iconSizeData,vs=kr.layout.get("icon-rotate").evaluate(Ut,{},Vr),ao=Fw(Zt,vs,an,Xi,fr.iconScaleFactor),$o=Fr?Fw(Fr,vs,an,Xi,fr.iconScaleFactor):void 0;Mi=e_(Zr,Hn,zt,jr,Xr,Dn,Zt,St,vs,null),Vn=4*ao.length;let Eo=null;es.kind==="source"?(Eo=[ah*kr.layout.get("icon-size").evaluate(Ut,{},Vr)*fr.iconScaleFactor],Eo[0]>tf&&Rr(`${qt.layerIds[0]}: Value for "icon-size" is >= ${$m}. Reduce your "icon-size".`)):es.kind==="composite"&&(Eo=[ah*fr.compositeIconSizes[0].evaluate(Ut,{},Vr)*fr.iconScaleFactor,ah*fr.compositeIconSizes[1].evaluate(Ut,{},Vr)*fr.iconScaleFactor],(Eo[0]>tf||Eo[1]>tf)&&Rr(`${qt.layerIds[0]}: Value for "icon-size" is >= ${$m}. Reduce your "icon-size".`)),qt.addSymbols(qt.icon,ao,Eo,Rt,kt,Ut,void 0,yt,zt,ii.lineStartIndex,ii.lineLength,-1,ln,Vr,Fn,Qn),li=qt.icon.placedSymbolArray.length-1,$o&&(Si=4*$o.length,qt.addSymbols(qt.icon,$o,Eo,Rt,kt,Ut,La.vertical,yt,zt,ii.lineStartIndex,ii.lineLength,-1,ln,Vr,Fn,Qn),Ii=qt.icon.placedSymbolArray.length-1)}for(const es in Gt.horizontal){const vs=es,ao=Gt.horizontal[vs];Ln||(Qi=zc(ao.text),oe?si=rv(ao):Ln=e_(Zr,Hn,zt,jr,Xr,Dn,ao,ni,kr.layout.get("text-rotate").evaluate(Ut,{},Vr),fe));const $o=ao.positionedLines.length===1;if(cr+=Gw(qt,yt,zt,ao,pr,kr,oe,Ut,fe,ii,Gt.vertical?La.horizontal:La.horizontalOnly,$o?jC(Gt.horizontal):[vs],pi,li,fr,ln,Vr,Fn),$o)break}Gt.vertical&&(yn+=Gw(qt,yt,zt,Gt.vertical,pr,kr,oe,Ut,fe,ii,La.vertical,["vertical"],pi,Ii,fr,ln,Vr,Fn));let Ws=-1;const va=(es,vs)=>es?Math.max(es,vs):vs;Ws=va(si,Ws),Ws=va(Bn,Ws),Ws=va(qr,Ws);const lh=Ws>-1?1:0;qt.glyphOffsetArray.length>=65535&&Rr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ut.sortKey!==void 0&&qt.addToSortKeyRanges(qt.symbolInstances.length,Ut.sortKey),qt.symbolInstances.emplaceBack(zt.x,zt.y,Hn.x,Hn.y,Hn.z,pi.right>=0?pi.right:-1,pi.center>=0?pi.center:-1,pi.left>=0?pi.left:-1,pi.vertical>=0?pi.vertical:-1,li,Ii,Qi,Ln!==void 0?Ln:qt.collisionBoxArray.length,Ln!==void 0?Ln+1:qt.collisionBoxArray.length,ai!==void 0?ai:qt.collisionBoxArray.length,ai!==void 0?ai+1:qt.collisionBoxArray.length,Mi!==void 0?Mi:qt.collisionBoxArray.length,Mi!==void 0?Mi+1:qt.collisionBoxArray.length,ei||qt.collisionBoxArray.length,ei?ei+1:qt.collisionBoxArray.length,jr,cr,yn,Vn,Si,lh,0,ya,oo,Ws,0,Xi?1:0,Ti)})(n,xt,ir,We,r,o,u,a,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,Re,te,x,0,He,it,K,e,h,E,A,C,L,j,G,lt)};if(ne==="line")for(const We of $g(e.geometry,0,0,Ct,Ct)){const xt=OC(We,Ee,ht,r.vertical||ie,o,Te,ve,n.overscaling,Ct);for(const bt of xt)ie&&HC(n,ie.text,ut,bt)||qe(We,bt,C)}else if(ne==="line-center"){for(const We of e.geometry)if(We.length>1){const xt=LC(We,ht,r.vertical||ie,o,Te,ve);xt&&qe(We,xt,C)}}else if(e.type==="Polygon")for(const We of Fg(e.geometry,0)){const xt=NC(We,16);qe(We[0],new nd(xt.x,xt.y,0,0,void 0),C)}else if(e.type==="LineString")for(const We of e.geometry)qe(We,new nd(We[0].x,We[0].y,0,0,void 0),C);else if(e.type==="Point")for(const We of e.geometry)for(const xt of We)qe([xt],new nd(xt.x,xt.y,0,0,void 0),C)}const $m=255,tf=$m*ah;function Gw(n,e,r,o,a,u,h,g,v,x,E,A,C,k,L,j,G,K){const te=function(ee,ie,ae,Te,ve,Ee,Re,He){const ht=[];if(ie.positionedLines.length===0)return ht;const it=Te.layout.get("text-rotate").evaluate(Ee,{})*Math.PI/180,ut=function(We){const xt=We[0],bt=We[1],ir=xt*bt;return ir>0?[xt,-bt]:ir<0?[-xt,bt]:xt===0?[bt,xt]:[bt,-xt]}(ae);let mt=Math.abs(ie.top-ie.bottom);for(const We of ie.positionedLines)mt-=We.lineOffset;const Ze=ie.positionedLines.length,lt=mt/Ze;let qe=ie.top-ae[1];for(let We=0;We<Ze;++We){const xt=ie.positionedLines[We];qe=FC(ie,lt,qe,We);for(const bt of xt.positionedGlyphs){if(!bt.rect)continue;const ir=bt.rect||{};let qt=RC+1,zt=!0,yt=1,wr=0;if(bt.image){const Ut=Re.get(bt.image.toString());if(!Ut)continue;if(Ut.sdf){Rr("SDF images are not supported in formatted text and will be ignored.");continue}zt=!1,yt=Ut.pixelRatio,qt=Qf/yt}const Gt=(ve||He)&&bt.vertical,Zt=bt.metrics.advance*bt.scale/2,pr=bt.metrics,Fr=bt.rect;if(Fr===null)continue;He&&ie.verticalizable&&(wr=bt.image?Zt-bt.metrics.width*bt.scale/2:0);const kr=ve?[bt.x+Zt,bt.y]:[0,0];let Zr=[0,0],jr=[0,0],Xr=!1;ve||(Gt?(jr=[bt.x+Zt+ut[0],bt.y+ut[1]-wr],Xr=!0):Zr=[bt.x+Zt+ae[0],bt.y+ae[1]-wr]);const Dn=Fr.w*bt.scale/(yt*(bt.localGlyph?fu:1)),ni=Fr.h*bt.scale/(yt*(bt.localGlyph?fu:1));let oe,fe,Ke,St;if(Gt){const Ut=bt.y-qe,fr=new ft(-Zt,Zt-Ut),an=-Math.PI/2,ln=new ft(...jr);oe=new ft(-Zt+Zr[0],Zr[1]),oe._rotateAround(an,fr)._add(ln),oe.x+=-Ut+Zt,oe.y-=(pr.left-qt)*bt.scale;const Vr=bt.image?pr.advance*bt.scale:Us*bt.scale,Fn=String.fromCodePoint(bt.glyph);EC(Fn)?oe.x+=(1-qt)*bt.scale:IC(Fn)?oe.x+=Vr-pr.height*bt.scale+(-qt-1)*bt.scale:oe.x+=bt.image||pr.width+2*qt===Fr.w&&pr.height+2*qt===Fr.h?(Vr-ni)/2:(Vr-(pr.height+2*qt)*bt.scale)/2,fe=new ft(oe.x,oe.y-Dn),Ke=new ft(oe.x+ni,oe.y),St=new ft(oe.x+ni,oe.y-Dn)}else{const Ut=(pr.left-qt)*bt.scale-Zt+Zr[0],fr=(-pr.top-qt)*bt.scale+Zr[1],an=Ut+Dn,ln=fr+ni;oe=new ft(Ut,fr),fe=new ft(an,fr),Ke=new ft(Ut,ln),St=new ft(an,ln)}if(it){let Ut;Ut=ve?new ft(0,0):Xr?new ft(ut[0],ut[1]):new ft(ae[0],ae[1]),oe._rotateAround(it,Ut),fe._rotateAround(it,Ut),Ke._rotateAround(it,Ut),St._rotateAround(it,Ut)}const kt=new ft(0,0),Rt=new ft(0,0);ht.push({tl:oe,tr:fe,bl:Ke,br:St,texPrimary:ir,texSecondary:void 0,writingMode:ie.writingMode,glyphOffset:kr,sectionIndex:bt.sectionIndex,isSDF:zt,pixelOffsetTL:kt,pixelOffsetBR:Rt,minFontScaleX:0,minFontScaleY:0})}}return ht}(0,o,v,u,h,g,a,n.allowVerticalPlacement),ne=n.textSizeData;let U=null;ne.kind==="source"?(U=[ah*u.layout.get("text-size").evaluate(g,{},G)*L.textScaleFactor],U[0]>tf&&Rr(`${n.layerIds[0]}: Value for "text-size" is >= ${$m}. Reduce your "text-size".`)):ne.kind==="composite"&&(U=[ah*L.compositeTextSizes[0].evaluate(g,{},G)*L.textScaleFactor,ah*L.compositeTextSizes[1].evaluate(g,{},G)*L.textScaleFactor],(U[0]>tf||U[1]>tf)&&Rr(`${n.layerIds[0]}: Value for "text-size" is >= ${$m}. Reduce your "text-size".`)),n.addSymbols(n.text,te,U,v,h,g,E,e,r,x.lineStartIndex,x.lineLength,k,j,G,K,!1);for(const ee of A)C[ee]=n.text.placedSymbolArray.length-1;return 4*te.length}function tv(n){for(const e in n)return n[e];return null}function e_(n,e,r,o,a,u,h,g,v,x){let E=h.top,A=h.bottom,C=h.left,k=h.right;if(ww(h)&&h.collisionPadding){const L=h.collisionPadding;C-=L[0],E-=L[1],k+=L[2],A+=L[3]}if(v){const L=new ft(C,E),j=new ft(k,E),G=new ft(C,A),K=new ft(k,A),te=en(v);let ne=new ft(0,0);x&&(ne=new ft(x[0],x[1])),L._rotateAround(te,ne),j._rotateAround(te,ne),G._rotateAround(te,ne),K._rotateAround(te,ne),C=Math.min(L.x,j.x,G.x,K.x),k=Math.max(L.x,j.x,G.x,K.x),E=Math.min(L.y,j.y,G.y,K.y),A=Math.max(L.y,j.y,G.y,K.y)}return n.emplaceBack(e.x,e.y,e.z,r.x,r.y,C,E,k,A,g,o,a,u),n.length-1}function rv(n){ww(n)&&n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function HC(n,e,r,o){const a=n.compareText;if(e in a){const u=a[e];for(let h=u.length-1;h>=0;h--)if(o.dist(u[h])<r)return!0}else a[e]=[];return a[e].push(o),!1}function qw(n,e){const r=n.fovAboveCenter,o=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,a=(n._camera.position[2]*n.worldSize-o)/Math.cos(n._pitch),u=Math.sin(r)*a/Math.sin(Math.max(Math.PI/2-n._pitch-r,.01));let h=Math.sin(n._pitch)*u+a;const g=a*(1/n._horizonShift);if(!n.elevation||n.elevation.exaggeration()===0){let v=Math.max(n.zoom-17,0);n.isOrthographic&&(v/=10),h*=1+v}return Math.min(1.01*h,g)}function Gm(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const r=Math.pow(2,-n.z),o=n.x*r,a=(n.x+1)*r,u=n.y*r,h=(n.y+1)*r,g=xe(o),v=xe(a),x=Pe(u),E=Pe(h),A=e.project(g,x),C=e.project(v,x),k=e.project(v,E),L=e.project(g,E);let j=Math.min(A.x,C.x,k.x,L.x),G=Math.min(A.y,C.y,k.y,L.y),K=Math.max(A.x,C.x,k.x,L.x),te=Math.max(A.y,C.y,k.y,L.y);const ne=r/16;function U(ie,ae,Te,ve,Ee,Re){const He=(Te+Ee)/2,ht=(ve+Re)/2,it=e.project(xe(He),Pe(ht)),ut=Math.max(0,j-it.x,G-it.y,it.x-K,it.y-te);j=Math.min(j,it.x),K=Math.max(K,it.x),G=Math.min(G,it.y),te=Math.max(te,it.y),ut>ne&&(U(ie,it,Te,ve,He,ht),U(it,ae,He,ht,Ee,Re))}U(A,C,o,u,a,u),U(C,k,a,u,a,h),U(k,L,a,h,o,h),U(L,A,o,h,o,u),j-=ne,G-=ne,K+=ne,te+=ne;const ee=1/Math.max(K-j,te-G);return{scale:ee,x:j*ee,y:G*ee,x2:K*ee,y2:te*ee,projection:e}}function Hw(n,{x:e,y:r},o=0){return new ft(((e-o)*n.scale-n.x)*Ct,(r*n.scale-n.y)*Ct)}const WC=Be(new Float32Array(16));class rf{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new J(0,0)}projectTilePoint(e,r,o){return{x:e,y:r,z:0}}locationPoint(e,r,o,a=!0){return e._coordinatePoint(e.locationCoordinate(r,o),a)}pixelsPerMeter(e,r){return ye(1,e)*r}pixelSpaceConversion(e,r,o){return 1}farthestPixelDistance(e){return qw(e,e.pixelsPerMeter)}pointCoordinate(e,r,o,a){const u=e.horizonLineFromTop(!1),h=new ft(r,Math.max(u,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(h,a))}pointCoordinate3D(e,r,o){const a=new ft(r,o);if(e.elevation)return e.elevation.pointCoordinate(a);{const u=this.pointCoordinate(e,a.x,a.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,r){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,r.x,r.y);const o=e.horizonLineFromTop();return r.y<o}createInversionMatrix(e,r){return WC}createTileMatrix(e,r,o){let a,u,h;const g=o.canonical,v=Be(new Float64Array(16));if(this.isReprojectedInTileSpace){const x=Gm(g,this);a=1,u=x.x+o.wrap*x.scale,h=x.y,Vt(v,v,[a/x.scale,a/x.scale,e.pixelsPerMeter/r])}else a=r/e.zoomScale(g.z),u=(g.x+Math.pow(2,g.z)*o.wrap)*a,h=g.y*a;return Dt(v,v,[u,h,0]),Vt(v,v,[a/Ct,a/Ct,1]),v}upVector(e,r,o){return[0,0,1]}upVectorScale(e,r,o){return{metersToTile:1}}}class ZC extends rf{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,o]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(en(r));this.n=(a+Math.sin(en(o)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:o,c:a,r0:u}=this,h=en(e-this.center[0]),g=en(r),v=Math.sqrt(a-2*o*Math.sin(g))/o;return{x:v*Math.sin(h*o),y:v*Math.cos(h*o)-u,z:0}}unproject(e,r){const{n:o,c:a,r0:u}=this,h=u+r;let g=Math.atan2(e,Math.abs(h))*Math.sign(h);h*o<0&&(g-=Math.PI*Math.sign(e)*Math.sign(h));const v=en(this.center[0])*o;g=Ne(g,-Math.PI-v,Math.PI-v);const x=me(Oe(g/o)+this.center[0],-180,180),E=Math.asin(me((a-(e*e+h*h)*o*o)/(2*o),-1,1)),A=me(Oe(E),-85.051129,Ye);return new J(x,A)}}const qm=1.340264,Hm=-.081106,Wm=893e-6,Zm=.003796,t_=Math.sqrt(3)/2;class XC extends rf{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(t_*Math.sin(r)),a=o*o,u=a*a*a;return{x:.5*(e*Math.cos(o)/(t_*(qm+3*Hm*a+u*(7*Wm+9*Zm*a)))/Math.PI+.5),y:1-.5*(o*(qm+Hm*a+u*(Wm+Zm*a))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let o=r=(2*(1-r)-1)*Math.PI,a=o*o,u=a*a*a;for(let E,A,C,k=0;k<12&&(A=o*(qm+Hm*a+u*(Wm+Zm*a))-r,C=qm+3*Hm*a+u*(7*Wm+9*Zm*a),E=A/C,o=me(o-E,-Math.PI/3,Math.PI/3),a=o*o,u=a*a*a,!(Math.abs(E)<1e-12));++k);const h=t_*e*(qm+3*Hm*a+u*(7*Wm+9*Zm*a))/Math.cos(o),g=Math.asin(Math.sin(o)/t_),v=me(180*h/Math.PI,-180,180),x=me(180*g/Math.PI,-85.051129,Ye);return new J(v,x)}}class YC extends rf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const o=360*(e-.5),a=me(360*(.5-r),-85.051129,Ye);return new J(o,a)}}const qp=Math.PI/2;function r_(n){return Math.tan((qp+n)/2)}class KC extends rf{constructor(e){super(e),this.center=e.center||[0,30];const[r,o]=this.parallels=e.parallels||[30,30];let a=en(r),u=en(o);this.southernCenter=a+u<0,this.southernCenter&&(a=-a,u=-u);const h=Math.cos(a),g=r_(a);this.n=a===u?Math.sin(a):Math.log(h/Math.cos(u))/Math.log(r_(u)/g),this.f=h*Math.pow(r_(a),this.n)/this.n}project(e,r){r=en(r),this.southernCenter&&(r=-r),e=en(e-this.center[0]);const o=1e-6,{n:a,f:u}=this;u>0?r<-qp+o&&(r=-qp+o):r>qp-o&&(r=qp-o);const h=u/Math.pow(r_(r),a);let g=h*Math.sin(a*e),v=u-h*Math.cos(a*e);return g=.5*(g/Math.PI+.5),v=.5*(v/Math.PI+.5),{x:g,y:this.southernCenter?v:1-v,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:o,f:a}=this,u=a-r,h=Math.sign(u),g=Math.sign(o)*Math.sqrt(e*e+u*u);let v=Math.atan2(e,Math.abs(u))*h;u*o<0&&(v-=Math.PI*Math.sign(e)*h);const x=me(Oe(v/o)+this.center[0],-180,180),E=me(Oe(2*Math.atan(Math.pow(a/g,1/o))-qp),-85.051129,Ye);return new J(x,this.southernCenter?-E:E)}}class Ww extends rf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:pe(e),y:ue(r),z:0}}unproject(e,r){const o=xe(e),a=Pe(r);return new J(o,a)}}const Zw=en(Ye);class JC extends rf{project(e,r){const o=(r=en(r))*r,a=o*o;return{x:.5*((e=en(e))*(.8707-.131979*o+a*(a*(.003971*o-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+o*(.015085+a*(.028874*o-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let o=r=(2*(1-r)-1)*Math.PI,a=25,u=0,h=o*o;do{h=o*o;const x=h*h;u=(o*(1.007226+h*(.015085+x*(.028874*h-.044475-.005916*x)))-r)/(1.007226+h*(.045255+x*(.259866*h-.311325-.005916*11*x))),o=me(o-u,-Zw,Zw)}while(Math.abs(u)>1e-6&&--a>0);h=o*o;const g=me(Oe(e/(.8707+h*(h*(h*h*h*(.003971-.001529*h)-.013791)-.131979))),-180,180),v=Oe(o);return new J(g,v)}}const Xw=en(Ye);class QC extends rf{project(e,r){r=en(r),e=en(e);const o=Math.cos(r),a=2/Math.PI,u=Math.acos(o*Math.cos(e/2)),h=Math.sin(u)/u,g=.5*(e*a+2*o*Math.sin(e/2)/h)||0,v=.5*(r+Math.sin(r)/h)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(v/Math.PI+1),z:0}}unproject(e,r){let o=e=(2*e-.5)*Math.PI,a=r=(2*(1-r)-1)*Math.PI,u=25;const h=1e-6;let g=0,v=0;do{const x=Math.cos(a),E=Math.sin(a),A=2*E*x,C=E*E,k=x*x,L=Math.cos(o/2),j=Math.sin(o/2),G=2*L*j,K=j*j,te=1-k*L*L,ne=te?1/te:0,U=te?Math.acos(x*L)*Math.sqrt(1/te):0,ee=.5*(2*U*x*j+2*o/Math.PI)-e,ie=.5*(U*E+a)-r,ae=.5*ne*(k*K+U*x*L*C)+1/Math.PI,Te=ne*(G*A/4-U*E*j),ve=.125*ne*(A*j-U*E*k*G),Ee=.5*ne*(C*L+U*K*x)+.5,Re=Te*ve-Ee*ae;g=(ie*Te-ee*Ee)/Re,v=(ee*ve-ie*ae)/Re,o=me(o-g,-Math.PI,Math.PI),a=me(a-v,-Xw,Xw)}while((Math.abs(g)>h||Math.abs(v)>h)&&--u>0);return new J(Oe(o),Oe(a))}}class Yw extends rf{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(en(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:o,cosPhi:a}=this;return{x:en(e)*a*o+.5,y:-Math.sin(en(r))/a*o+.5,z:0}}unproject(e,r){const{scale:o,cosPhi:a}=this,u=-(r-.5)/o,h=me(Oe((e-.5)/o)/a,-180,180),g=Math.asin(me(u*a,-1,1)),v=me(Oe(g),-85.051129,Ye);return new J(h,v)}}class eM extends Ww{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,o){const a=Or(e,r,o);return Ar(a,a,at(Ge(o))),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,r,o){const a=V(r.lat,r.lng),u=br([],a),h=o?e._centerAltitude+o:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude;rt(a,a,u,ye(1,0)*Ct*h);const g=Be(new Float64Array(16));return Tt(g,e.pixelMatrix,e.globeMatrix),Ar(a,a,g),new ft(a[0],a[1])}pixelsPerMeter(e,r){return ye(1,0)*r}pixelSpaceConversion(e,r,o){const a=ye(1,e)*r,u=lr(ye(1,45)*r,a,o);return this.pixelsPerMeter(e,r)/u}createTileMatrix(e,r,o){const a=et(Ge(o.canonical));return Tt(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,r){const{center:o}=e,a=at(Ge(r));return vr(a,a,en(o.lng)),jt(a,a,en(o.lat)),Vt(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,r,o,a){return Z(e,r,o,!0)||new Ie(0,0)}pointCoordinate3D(e,r,o){const a=this.pointCoordinate(e,r,o,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,r){return!Z(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(a,u){const h=a.cameraToCenterDistance,g=a._centerAltitude*u,v=a._camera,x=a._camera.forward(),E=rn([],Ht([],x,-h),[0,0,g]),A=a.worldSize/(2*Math.PI),C=[0,0,-A],k=a.width/a.height,L=Math.tan(a.fovAboveCenter),j=Ht([],v.up(),L),G=Ht([],v.right(),L*k),K=br([],rn([],rn([],x,j),G)),te=[];let ne;if(new Jn(E,K).closestPointOnSphere(C,A,te)){const U=rn([],te,C),ee=vi([],U,E);ne=Math.cos(a.fovAboveCenter)*gr(ee)}else{const U=vi([],E,C),ee=vi([],C,E);br(ee,ee);const ie=gr(U)-A;ne=Math.sqrt(ie*(ie+2*A));const ae=Math.acos(ne/(A+ie))-Math.acos(Br(x,ee));ne*=Math.cos(ae)}return 1.01*ne}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=sn(e.zoom);if(o>0){const a=qw(e,ye(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),h=Math.max(e.width,e.height)/e.worldSize*Math.PI;return lr(r,a+u*(1-Math.cos(h)),Math.pow(o,10))}return r}upVector(e,r,o){return Or(r,o,e,1)}upVectorScale(e){return{metersToTile:R(Ur(Ge(e)))}}}function Kw(n){const e=n.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new Ww(n);case"equirectangular":return new YC(n);case"naturalEarth":return new JC(n);case"equalEarth":return new XC(n);case"winkelTripel":return new QC(n);case"albers":return r?new Yw(n):new ZC(n);case"lambertConformalConic":return r?new Yw(n):new KC(n);case"globe":return new eM(n)}throw new Error(`Invalid projection name: ${n.name}`)}const tM=Lr.VectorTileFeature.types,rM=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function n_(n,e,r,o,a,u,h,g,v,x,E,A,C){const k=g?Math.min(tf,Math.round(g[0])):0,L=g?Math.min(tf,Math.round(g[1])):0;n.emplaceBack(e,r,Math.round(32*o),Math.round(32*a),u,h,(k<<1)+(v?1:0),L,16*x,16*E,256*A,256*C)}function i_(n,e,r){n.emplaceBack(e,r)}function s_(n,e,r,o,a,u,h){n.emplaceBack(e,r,o,a,u,h)}const o_=(n,e,r,o)=>{for(let a=0;a<e;a++)n.emplaceBack(r[0],r[1],r[2],o[0],o[1],o[2])};function a_(n,e,r,o,a){n.emplaceBack(e,r,o,a),n.emplaceBack(e,r,o,a),n.emplaceBack(e,r,o,a),n.emplaceBack(e,r,o,a)}function nM(n){for(const e of n.sections)if(jh(e.text))return!0;return!1}class nv{constructor(e){this.layoutVertexArray=new Ju,this.indexArray=new as,this.programConfigurations=e,this.segments=new $n,this.dynamicLayoutVertexArray=new os,this.opacityVertexArray=new Ml,this.placedSymbolArray=new Hd,this.iconTransitioningVertexArray=new Pl,this.globeExtVertexArray=new eo,this.zOffsetVertexArray=new Cl,this.orientationVertexArray=new $d}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,r,o,a,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mC.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,_C.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,rM,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,xC.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,gC.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,yC.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,vC.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Ft(nv,"SymbolBuffers");class iv{constructor(e,r,o){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new o,this.segments=new $n,this.collisionVertexArray=new nl,this.collisionVertexArrayExt=new os}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,wC.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,bC.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ft(iv,"CollisionBuffers");class l_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Be([]),this.placementViewportMatrix=Be([]);const r=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=Iw(this.zoom,r["text-size"],this.worldview),this.iconSizeData=Iw(this.zoom,r["icon-size"],this.worldview);const o=this.layers[0].layout,a=o.get("symbol-sort-key"),u=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(h=>La[h]),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new nv(new l(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new nv(new l(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Xh,this.lineVertexArray=new Wd,this.symbolInstances=new Nf}calculateGlyphDependencies(e,r,o,a,u){for(const h of e){const g=h.codePointAt(0);if(g===void 0)break;if(r[g]=!0,a&&u&&g<=65535){const v=Bm[h];v&&(r[v.charCodeAt(0)]=!0)}}}updateFootprints(e,r){}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const o=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!zy(this.activeReplacements,o)&&(this.activeReplacements=o,!0)}populate(e,r,o,a){const u=this.layers[0],h=u.layout,g=this.projection.name==="globe",v=h.get("text-font"),x=h.get("text-field"),E=h.get("icon-image"),[A,C]=h.get("icon-size-scale-range"),k=me(r.scaleFactor||1,A,C),L=(x.value.kind!=="constant"||x.value.value instanceof Js&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),j=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,G=h.get("symbol-sort-key");if(this.features=[],!L&&!j)return;const K=r.iconDependencies,te=r.glyphDependencies,ne=r.availableImages,U=new zn(this.zoom,{worldview:this.worldview});for(const{feature:ee,id:ie,index:ae,sourceLayerIndex:Te}of e){const ve=u._featureFilter.needGeometry,Ee=Mt(ee,ve);if(!u._featureFilter.filter(U,Ee,o))continue;if(ve||(Ee.geometry=Lt(ee,o,a)),g&&ee.type!==1&&o.z<=5){const ut=Ee.geometry,mt=.98078528056,Ze=(lt,qe)=>Br(Or(lt.x,lt.y,o,1),Or(qe.x,qe.y,o,1))<mt;for(let lt=0;lt<ut.length;lt++)ut[lt]=vt(ut[lt],Ze)}let Re,He;if(L){const ut=u.getValueAndResolveTokens("text-field",Ee,o,ne),mt=Js.factory(ut);nM(mt)&&(this.hasRTLText=!0),(!this.hasRTLText||Il()==="unavailable"||this.hasRTLText&&Ma.isParsed())&&(Re=SC(mt,u,Ee))}if(j){const ut=u.getValueAndResolveTokens("icon-image",Ee,o,ne);He=typeof ut=="string"?go.build(ut):ut}if(!Re&&!He)continue;const ht=this.sortFeaturesByKey?G.evaluate(Ee,{},o):void 0,it={id:ie,text:Re,icon:He,index:ae,sourceLayerIndex:Te,geometry:Ee.geometry,properties:ee.properties,type:tM[ee.type],sortKey:ht};if(this.features.push(it),He){const ut=this.layers[0]._unevaluatedLayout._values,{iconPrimary:mt,iconSecondary:Ze}=Vw(He,this.iconSizeData,ut["icon-size"],o,this.zoom,it,this.pixelRatio,k,this.worldview),lt=mt.id.toString();if(K.has(lt)?K.get(lt).push(mt):K.set(lt,[mt]),Ze){const qe=Ze.id.toString();K.has(qe)?K.get(qe).push(Ze):K.set(qe,[Ze])}}if(Re){const ut=v.evaluate(Ee,{},o).join(","),mt=h.get("text-rotation-alignment")==="map"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(La.vertical)>=0;for(const Ze of Re.sections)if(Ze.image){const lt=Ze.image.getPrimary().scaleSelf(this.pixelRatio),qe=lt.id.toString(),We=K.get(qe)||[];We.push(lt),K.set(qe,We)}else{const lt=ea(Re.toString()),qe=Ze.fontStack||ut,We=te[qe]=te[qe]||{};this.calculateGlyphDependencies(Ze.text,We,mt,this.allowVerticalPlacement,lt)}}}if(h.get("symbol-placement")==="line"&&(this.features=function(ee){const ie={},ae={},Te=[];let ve=0;function Ee(it){Te.push(ee[it]),ve++}function Re(it,ut,mt){const Ze=ae[it];return delete ae[it],ae[ut]=Ze,Te[Ze].geometry[0].pop(),Te[Ze].geometry[0]=Te[Ze].geometry[0].concat(mt[0]),Ze}function He(it,ut,mt){const Ze=ie[ut];return delete ie[ut],ie[it]=Ze,Te[Ze].geometry[0].shift(),Te[Ze].geometry[0]=mt[0].concat(Te[Ze].geometry[0]),Ze}function ht(it,ut,mt){const Ze=mt?ut[0][ut[0].length-1]:ut[0][0];return`${it}:${Ze.x}:${Ze.y}`}for(let it=0;it<ee.length;it++){const ut=ee[it],mt=ut.geometry,Ze=ut.text?ut.text.toString():null;if(!Ze){Ee(it);continue}const lt=ht(Ze,mt),qe=ht(Ze,mt,!0);if(lt in ae&&qe in ie&&ae[lt]!==ie[qe]){const We=He(lt,qe,mt),xt=Re(lt,qe,Te[We].geometry);delete ie[lt],delete ae[qe],ae[ht(Ze,Te[xt].geometry,!0)]=xt,Te[We].geometry=null}else lt in ae?Re(lt,qe,mt):qe in ie?He(lt,qe,mt):(Ee(it),ie[lt]=ve-1,ae[qe]=ve-1)}return Te.filter(it=>it.geometry)}(this.features)),h.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",r.elevationFeatures){!this.elevationFeatures&&r.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const ee of r.elevationFeatures)this.elevationFeatureIdToIndex.set(ee.id,this.elevationFeatures.length),this.elevationFeatures.push(ee)}}else h.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((ee,ie)=>ee.sortKey-ie.sortKey)}update(e,r,o,a,u,h,g){this.text.programConfigurations.updatePaintArrays(e,r,u,o,a,h,g,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,r,u,o,a,h,g,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let r=!1;const o=$e(e),a=1/o;let u=!1,h=!1;for(let g=0;g<this.symbolInstances.length;g++){const v=this.symbolInstances.get(g),x=Mr(1,0,0),E=Mr(0,1,0),{numHorizontalGlyphVertices:A,numVerticalGlyphVertices:C,numIconVertices:k,numVerticalIconVertices:L}=v,j=A>0||C>0,G=k>0,K=this.elevationFeatures[v.elevationFeatureIndex];if(K){const te=new ft(v.tileAnchorX,v.tileAnchorY),ne=.075+K.pointElevation(te);v.zOffset!==ne&&(r=!0,v.zOffset=ne);const U=K.computeSlopeNormal(te,a),ee=Zo(Oi(),Mr(0,0,1),U);qi(x,x,ee),qi(E,E,ee),x[2]*=o,E[2]*=o,x[0]===1&&x[1]===0&&x[2]===0&&E[0]===0&&E[1]===1&&E[2]===0||(u=u||j,h=h||G)}if(j&&(o_(this.text.orientationVertexArray,A,x,E),o_(this.text.orientationVertexArray,C,x,E)),G){const{placedIconSymbolIndex:te,verticalPlacedIconSymbolIndex:ne}=v;te>=0&&o_(this.icon.orientationVertexArray,k,x,E),ne>=0&&o_(this.icon.orientationVertexArray,L,x,E)}}u||(this.text.orientationVertexArray=void 0),h||(this.icon.orientationVertexArray=void 0),r&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(u,h,g)=>{o+=h,o>u.length&&u.resize(o);for(let v=-h;v<0;v++)u.emplace(v+o,g)},r=(u,h,g)=>{a+=h,a>u.length&&u.resize(a);for(let v=-h;v<0;v++)u.emplace(v+a,g)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,a=0;for(let u=0;u<this.symbolInstances.length;u++){const h=this.symbolInstances.get(u),{numHorizontalGlyphVertices:g,numVerticalGlyphVertices:v,numIconVertices:x}=h,E=h.zOffset,A=x>0;if((g>0||v>0)&&(e(this.text.zOffsetVertexArray,g,E),e(this.text.zOffsetVertexArray,v,E)),A){const{placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:k}=h;C>=0&&r(this.icon.zOffsetVertexArray,x,E),k>=0&&r(this.icon.zOffsetVertexArray,h.numVerticalIconVertices,E)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Kw(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const o=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:a,y:u}of r)this.lineVertexArray.emplaceBack(a,u);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,r,o,a,u,h,g,v,x,E,A,C,k,L,j,G){const K=e.indexArray,te=e.layoutVertexArray,ne=e.globeExtVertexArray,U=e.segments.prepareSegment(4*r.length,te,K,this.canOverlap?h.sortKey:void 0),ee=this.glyphOffsetArray.length,ie=U.vertexLength,ae=this.allowVerticalPlacement&&g===La.vertical?Math.PI/2:0,Te=h.text&&h.text.sections;for(let Ee=0;Ee<r.length;Ee++){const{tl:Re,tr:He,bl:ht,br:it,texPrimary:ut,texSecondary:mt,pixelOffsetTL:Ze,pixelOffsetBR:lt,minFontScaleX:qe,minFontScaleY:We,glyphOffset:xt,isSDF:bt,sectionIndex:ir}=r[Ee],qt=U.vertexLength,zt=xt[1];if(n_(te,x.x,x.y,Re.x,zt+Re.y,ut.x,ut.y,o,bt,Ze.x,Ze.y,qe,We),n_(te,x.x,x.y,He.x,zt+He.y,ut.x+ut.w,ut.y,o,bt,lt.x,Ze.y,qe,We),n_(te,x.x,x.y,ht.x,zt+ht.y,ut.x,ut.y+ut.h,o,bt,Ze.x,lt.y,qe,We),n_(te,x.x,x.y,it.x,zt+it.y,ut.x+ut.w,ut.y+ut.h,o,bt,lt.x,lt.y,qe,We),v){const{x:yt,y:wr,z:Gt}=v.anchor,[Zt,pr,Fr]=v.up;s_(ne,yt,wr,Gt,Zt,pr,Fr),s_(ne,yt,wr,Gt,Zt,pr,Fr),s_(ne,yt,wr,Gt,Zt,pr,Fr),s_(ne,yt,wr,Gt,Zt,pr,Fr),a_(e.dynamicLayoutVertexArray,yt,wr,Gt,ae)}else a_(e.dynamicLayoutVertexArray,x.x,x.y,x.z,ae);if(G){const yt=mt||ut;i_(e.iconTransitioningVertexArray,yt.x,yt.y),i_(e.iconTransitioningVertexArray,yt.x+yt.w,yt.y),i_(e.iconTransitioningVertexArray,yt.x,yt.y+yt.h),i_(e.iconTransitioningVertexArray,yt.x+yt.w,yt.y+yt.h)}K.emplaceBack(qt,qt+1,qt+2),K.emplaceBack(qt+1,qt+2,qt+3),U.vertexLength+=4,U.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(xt[0]),Ee!==r.length-1&&ir===r[Ee+1].sectionIndex||e.programConfigurations.populatePaintArrays(te.length,h,h.index,{},k,L,j,Te&&Te[ir],this.worldview)}const ve=v?v.anchor:x;e.placedSymbolArray.emplaceBack(ve.x,ve.y,ve.z,x.x,x.y,ee,this.glyphOffsetArray.length-ee,ie,E,A,x.segment,o?o[0]:0,o?o[1]:0,a[0],a[1],g,0,0,0,C,0)}_commitLayoutVertex(e,r,o,a,u,h,g){e.emplaceBack(r,o,a,u,h,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,r,o,a,u,h,g){const v=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),x=v.vertexLength,E=g.tileAnchorX,A=g.tileAnchorY;for(let k=0;k<4;k++)o.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,r,e.padding,g.zOffset),this._commitLayoutVertex(o.layoutVertexArray,a,u,h,E,A,new ft(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,a,u,h,E,A,new ft(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,a,u,h,E,A,new ft(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,a,u,h,E,A,new ft(e.x1,e.y2)),v.vertexLength+=4;const C=o.indexArray;C.emplaceBack(x,x+1),C.emplaceBack(x+1,x+2),C.emplaceBack(x+2,x+3),C.emplaceBack(x+3,x),v.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,o,a,u,h){for(let g=a;g<u;g++){const v=o.get(g),x=this.getSymbolInstanceTextSize(e,h,r,g);this._addCollisionDebugVertices(v,x,this.textCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,h)}}_addIconDebugCollisionBoxes(e,r,o,a,u,h){for(let g=a;g<u;g++){const v=o.get(g),x=this.getSymbolInstanceIconSize(e,r,h.placedIconSymbolIndex);this._addCollisionDebugVertices(v,x,this.iconCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,h)}}generateCollisionDebugBuffers(e,r,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new iv(qh,dw.members,Pl),this.iconCollisionBox=new iv(qh,dw.members,Pl);const a=Vm(this.iconSizeData,e),u=Vm(this.textSizeData,e,o);for(let h=0;h<this.symbolInstances.length;h++){const g=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(u,e,r,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(u,e,r,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(a,e,r,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(a,e,r,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,r,o,a){const u=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:a),h=Yy(this.textSizeData,e,u)/Us;return this.tilePixelRatio*h}getSymbolInstanceIconSize(e,r,o){const a=this.icon.placedSymbolArray.get(o),u=Yy(this.iconSizeData,e,a);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,r,o,a){e.emplaceBack(r,-o,-o,a),e.emplaceBack(r,o,-o,a),e.emplaceBack(r,o,o,a),e.emplaceBack(r,-o,o,a)}_updateTextDebugCollisionBoxes(e,r,o,a,u,h,g){for(let v=a;v<u;v++){const x=o.get(v),E=this.getSymbolInstanceTextSize(e,h,r,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,x.padding,h.zOffset)}}_updateIconDebugCollisionBoxes(e,r,o,a,u,h,g){for(let v=a;v<u;v++){const x=o.get(v),E=this.getSymbolInstanceIconSize(e,r,h.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,x.padding,h.zOffset)}}updateCollisionDebugBuffers(e,r,o,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=Vm(this.iconSizeData,e,a),h=Vm(this.textSizeData,e,o);for(let g=0;g<this.symbolInstances.length;g++){const v=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(h,e,r,v.textBoxStartIndex,v.textBoxEndIndex,v,o),this._updateTextDebugCollisionBoxes(h,e,r,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v,o),this._updateIconDebugCollisionBoxes(u,e,r,v.iconBoxStartIndex,v.iconBoxEndIndex,v,a),this._updateIconDebugCollisionBoxes(u,e,r,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v,a)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,o,a,u,h,g,v,x){const E={};if(r<o){const{x1:A,y1:C,x2:k,y2:L,padding:j,projectedAnchorX:G,projectedAnchorY:K,projectedAnchorZ:te,tileAnchorX:ne,tileAnchorY:U,featureIndex:ee}=e.get(r);E.textBox={x1:A,y1:C,x2:k,y2:L,padding:j,projectedAnchorX:G,projectedAnchorY:K,projectedAnchorZ:te,tileAnchorX:ne,tileAnchorY:U},E.textFeatureIndex=ee}if(a<u){const{x1:A,y1:C,x2:k,y2:L,padding:j,projectedAnchorX:G,projectedAnchorY:K,projectedAnchorZ:te,tileAnchorX:ne,tileAnchorY:U,featureIndex:ee}=e.get(a);E.verticalTextBox={x1:A,y1:C,x2:k,y2:L,padding:j,projectedAnchorX:G,projectedAnchorY:K,projectedAnchorZ:te,tileAnchorX:ne,tileAnchorY:U},E.verticalTextFeatureIndex=ee}if(h<g){const{x1:A,y1:C,x2:k,y2:L,padding:j,projectedAnchorX:G,projectedAnchorY:K,projectedAnchorZ:te,tileAnchorX:ne,tileAnchorY:U,featureIndex:ee}=e.get(h);E.iconBox={x1:A,y1:C,x2:k,y2:L,padding:j,projectedAnchorX:G,projectedAnchorY:K,projectedAnchorZ:te,tileAnchorX:ne,tileAnchorY:U},E.iconFeatureIndex=ee}if(v<x){const{x1:A,y1:C,x2:k,y2:L,padding:j,projectedAnchorX:G,projectedAnchorY:K,projectedAnchorZ:te,tileAnchorX:ne,tileAnchorY:U,featureIndex:ee}=e.get(v);E.verticalIconBox={x1:A,y1:C,x2:k,y2:L,padding:j,projectedAnchorX:G,projectedAnchorY:K,projectedAnchorZ:te,tileAnchorX:ne,tileAnchorY:U},E.verticalIconFeatureIndex=ee}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,r){const o=e.placedSymbolArray.get(r),a=o.vertexStartIndex+4*o.numGlyphs;for(let u=o.vertexStartIndex;u<a;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),o=Math.cos(e),a=[],u=[],h=[];for(let g=0;g<this.symbolInstances.length;++g){h.push(g);const v=this.symbolInstances.get(g);a.push(0|Math.round(r*v.tileAnchorX+o*v.tileAnchorY)),u.push(v.featureIndex)}return h.sort((g,v)=>a[g]-a[v]||u[v]-u[g]),h}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,r){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===r?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const o=this.symbolInstances.get(r);this.featureSortOrder.push(o.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:g,placedIconSymbolIndex:v,verticalPlacedIconSymbolIndex:x}=o;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),u>=0&&u!==a&&this.addIndicesForPlacedSymbol(this.text,u),h>=0&&h!==u&&h!==a&&this.addIndicesForPlacedSymbol(this.text,h),g>=0&&this.addIndicesForPlacedSymbol(this.text,g),v>=0&&this.addIndicesForPlacedSymbol(this.icon,v),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Jw,Qw,sv;Ft(l_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),l_.addDynamicAttributes=a_;class eb{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Su,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ft(eb,"FormatSectionOverride",{omit:["defaultValue"]});const ov=()=>sv||(sv={layout:Jw||(Jw=new fi({"symbol-placement":new gt(ke.layout_symbol["symbol-placement"]),"symbol-spacing":new gt(ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new gt(ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new It(ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new gt(ke.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new gt(ke.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new gt(ke.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new gt(ke.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new gt(ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new gt(ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new gt(ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new It(ke.layout_symbol["icon-size"]),"icon-size-scale-range":new gt(ke.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new It(ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new It(ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new It(ke.layout_symbol["icon-image"]),"icon-rotate":new It(ke.layout_symbol["icon-rotate"]),"icon-padding":new gt(ke.layout_symbol["icon-padding"]),"icon-keep-upright":new gt(ke.layout_symbol["icon-keep-upright"]),"icon-offset":new It(ke.layout_symbol["icon-offset"]),"icon-anchor":new It(ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new gt(ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new gt(ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new gt(ke.layout_symbol["text-rotation-alignment"]),"text-field":new It(ke.layout_symbol["text-field"]),"text-font":new It(ke.layout_symbol["text-font"]),"text-size":new It(ke.layout_symbol["text-size"]),"text-size-scale-range":new gt(ke.layout_symbol["text-size-scale-range"]),"text-max-width":new It(ke.layout_symbol["text-max-width"]),"text-line-height":new It(ke.layout_symbol["text-line-height"]),"text-letter-spacing":new It(ke.layout_symbol["text-letter-spacing"]),"text-justify":new It(ke.layout_symbol["text-justify"]),"text-radial-offset":new It(ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new gt(ke.layout_symbol["text-variable-anchor"]),"text-anchor":new It(ke.layout_symbol["text-anchor"]),"text-max-angle":new gt(ke.layout_symbol["text-max-angle"]),"text-writing-mode":new gt(ke.layout_symbol["text-writing-mode"]),"text-rotate":new It(ke.layout_symbol["text-rotate"]),"text-padding":new gt(ke.layout_symbol["text-padding"]),"text-keep-upright":new gt(ke.layout_symbol["text-keep-upright"]),"text-transform":new It(ke.layout_symbol["text-transform"]),"text-offset":new It(ke.layout_symbol["text-offset"]),"text-allow-overlap":new gt(ke.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new gt(ke.layout_symbol["text-ignore-placement"]),"text-optional":new gt(ke.layout_symbol["text-optional"]),visibility:new gt(ke.layout_symbol.visibility)})),paint:Qw||(Qw=new fi({"icon-opacity":new It(ke.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new It(ke.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new It(ke.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new It(ke.paint_symbol["text-emissive-strength"]),"icon-color":new It(ke.paint_symbol["icon-color"]),"icon-halo-color":new It(ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new It(ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new It(ke.paint_symbol["icon-halo-blur"]),"icon-translate":new gt(ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new gt(ke.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new gt(ke.paint_symbol["icon-image-cross-fade"]),"text-opacity":new It(ke.paint_symbol["text-opacity"]),"text-occlusion-opacity":new It(ke.paint_symbol["text-occlusion-opacity"]),"text-color":new It(ke.paint_symbol["text-color"],{runtimeType:Ro,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new It(ke.paint_symbol["text-halo-color"]),"text-halo-width":new It(ke.paint_symbol["text-halo-width"]),"text-halo-blur":new It(ke.paint_symbol["text-halo-blur"]),"text-translate":new gt(ke.paint_symbol["text-translate"]),"text-translate-anchor":new gt(ke.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new gt(ke.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new gt(ke.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new gt(ke.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new gt(ke.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new It(ke.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},sv);class c_ extends Vs{constructor(e,r,o,a){super(e,ov(),r,o,a),this._colorAdjustmentMatrix=Be([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const a=[];for(const u of o)a.indexOf(u)<0&&a.push(u);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,r,o,a){return this._saturation===e&&this._contrast===r&&this._brightnessMin===o&&this._brightnessMax===a||(this._colorAdjustmentMatrix=function(u,h,g,v){u=$s(u),h=Ui(h);const x=Xt(),E=u/3,A=1-2*E,C=[A,E,E,0,E,A,E,0,E,E,A,0,0,0,0,1],k=.5-.5*h,L=v-g;return Tt(x,[L,0,0,0,0,L,0,0,0,0,L,0,g,g,g,1],[h,0,0,0,0,h,0,0,0,0,h,0,k,k,k,1]),Tt(x,x,C),x}(e,r,o,a),this._saturation=e,this._contrast=r,this._brightnessMin=o,this._brightnessMax=a),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,r,o,a){const u=this.layout.get(e).evaluate(r,{},o,a),h=this._unevaluatedLayout._values[e];return h.isDataDriven()||Sl(h.value)||!u?u:function(g,v){return v.replace(/{([^{}]+)}/g,(x,E)=>E in g?String(g[E]):"")}(r.properties,u)}createBucket(e){return new l_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of ov().paint.overridableProperties){if(!c_.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),o=new eb(r),a=new Kc(o,r.property.specification,this.scope,this.options);let u=null;u=r.value.kind==="constant"||r.value.kind==="source"?new cc("source",a):new uc("composite",a,r.value.zoomStops,r.value.interpolationType),this.paint._values[e]=new Qa(r.property,u,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven())&&c_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const o=e.get("text-field"),a=ov().paint.properties[r];let u=!1;const h=g=>{for(const v of g)if(a.overrides&&a.overrides.hasOverride(v))return void(u=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Js)h(o.value.value.sections);else if(o.value.kind==="source"){const g=x=>{u||(x instanceof ur&&Bt(x.value)===Eu?h(x.value.sections):x instanceof Oc?h(x.sections):x.eachChild(g))},v=o.value;v._styleExpression&&g(v._styleExpression.expression)}return u}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,r,o){return{config:new ro(this,{zoom:r,lut:o}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let tb,rb,nb,ib;var av=pn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function lv(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function cv(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class uv{constructor(e,r,o,a){this.context=e,this.format=o,this.useMipmap=a&&a.useMipmap,this.texture=e.gl.createTexture(),this.update(r,{premultiply:a&&a.premultiply})}update(e,r){const o=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,a=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:u}=this,{gl:h}=u,{x:g,y:v}=r&&r.position?r.position:{x:0,y:0},x=g+o,E=v+a;!this.size||this.size[0]===x&&this.size[1]===E||(h.bindTexture(h.TEXTURE_2D,null),h.deleteTexture(this.texture),this.texture=h.createTexture(),this.size=null),h.bindTexture(h.TEXTURE_2D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(this.format===h.RGBA8&&(!r||r.premultiply!==!1));const A=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&x>0&&E>0){const C=this.useMipmap?Math.floor(Math.log2(Math.max(x,E)))+1:1;h.texStorage2D(h.TEXTURE_2D,C,this.format,x,E),this.size=[x,E]}if(this.size)if(A)h.texSubImage2D(h.TEXTURE_2D,0,g,v,lv(this.format),cv(this.format),e);else{const C=e.data;C&&h.texSubImage2D(h.TEXTURE_2D,0,g,v,o,a,lv(this.format),cv(this.format),C)}this.useMipmap&&h.generateMipmap(h.TEXTURE_2D)}bind(e,r,o=!1){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(e,r,o,a,u){const{context:h}=this,{gl:g}=h;g.bindTexture(g.TEXTURE_2D,this.texture),r!==this.magFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,r),this.magFilter=r),e!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap?e===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,o),this.wrapS=o),a!==this.wrapT&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,a),this.wrapT=a),u!==this.compareMode&&(u?(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_COMPARE_MODE,g.COMPARE_REF_TO_TEXTURE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_COMPARE_FUNC,u)):g.texParameteri(g.TEXTURE_2D,g.TEXTURE_COMPARE_MODE,g.NONE),this.compareMode=u)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class u_{constructor(e,r){this.context=e,this.texture=r}bind(e,r){const{context:o}=this,{gl:a}=o;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e),this.minFilter=e),r!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,r),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,r),this.wrapS=r)}}function h_(n,e,r,o,a,u,h,g){const v=[n,e,1,r,o,1,a,u,1],x=[h,g,1],E=tt([],v),[A,C,k]=Pi(x,x,E);return wt(v,v,[A,0,0,0,C,0,0,0,k])}function sb(n,e,r,o,a,u,h,g){const v=function(x,E,A,C,k,L,j,G){const K=h_(0,0,1,0,1,1,0,1),te=h_(x,E,A,C,k,L,j,G);return wt(te,te,tt([],K))}(n,e,r,o,a,u,h,g);return[v[2]/v[8]/Ct,v[5]/v[8]/Ct]}function d_(n){return[n[0],Math.min(Math.max(n[1],-85.051129),Ye)]}class ob extends Jl{constructor(e,r,o,a){super(),this.id=e,this.dispatcher=o,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(a),this.options=r,this._dirty=!1}load(e,r){if(this._loaded=r||!1,this.fire(new Kl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Pc(this.map._requestManager.transformRequest(this.url,fa.Image),(o,a)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new Sa(o)):a&&(this.image=a instanceof HTMLImageElement?ha.getImageData(a):a,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new u_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Kl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof u_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=e[0][1],o=e[0][1];for(const u of e)u[1]>o&&(o=u[1]),u[1]<r&&(r=u[1]);const a=(o+r)/2;if(a>Ye?this.onNorthPole=!0:a<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const u=e.map(Ie.fromLngLat);this.tileID=function(h){let g=1/0,v=1/0,x=-1/0,E=-1/0;for(const j of h)g=Math.min(g,j.x),v=Math.min(v,j.y),x=Math.max(x,j.x),E=Math.max(E,j.y);const A=Math.max(x-g,E-v),C=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),k=Math.pow(2,C);let L=Math.floor((g+x)/2*k);return L>1&&(L-=1),new rd(C,L,Math.floor((v+E)/2*k))}(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Kl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const K in this.tiles){const te=this.tiles[K];te.state!=="loaded"&&(te.state="loaded",te.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=Gm(new rd(0,0,0),this.map.transform.projection),o=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(K){const te=K[1].x-K[0].x,ne=K[1].y-K[0].y,U=K[2].x-K[1].x,ee=K[2].y-K[1].y,ie=K[3].x-K[2].x,ae=K[3].y-K[2].y,Te=K[0].x-K[3].x,ve=K[0].y-K[3].y,Ee=te*ee-U*ne,Re=U*ae-ie*ee,He=ie*ve-Te*ae,ht=Te*ne-te*ve;return Ee>0&&Re>0&&He>0&&ht>0||Ee<0&&Re<0&&He<0&&ht<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const a=Gm(this.tileID,this.map.transform.projection),[u,h,g,v]=this.coordinates.map(K=>{const te=a.projection.project(K[0],K[1]);return Hw(a,te)._round()});this.perspectiveTransform=sb(u.x,u.y,h.x,h.y,g.x,g.y,v.x,v.y);const x=this._boundsArray=new Ku;x.emplaceBack(u.x,u.y,0,0),x.emplaceBack(h.x,h.y,Ct,0),x.emplaceBack(v.x,v.y,0,Ct),x.emplaceBack(g.x,g.y,Ct,Ct),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(x,av.members),this.boundsSegments=$n.simpleSegment(0,0,4,2);const E=[],A=[d_((C=this.coordinates)[0]),d_(C[1]),d_(C[2]),d_(C[3])];var C;const[k,L,j,G]=function(K){let te=K[0][0],ne=te,U=K[0][1],ee=U;for(let ie=1;ie<K.length;ie++)K[ie][0]<te?te=K[ie][0]:K[ie][0]>ne&&(ne=K[ie][0]),K[ie][1]<U?U=K[ie][1]:K[ie][1]>ee&&(ee=K[ie][1]);return[te,U,ne-te,ee-U]}(A);{const K=new Ku,[te,ne,U,ee]=function(Ze){let lt=Ze[0].x,qe=lt,We=Ze[0].y,xt=We;for(let bt=1;bt<Ze.length;bt++)Ze[bt].x<lt?lt=Ze[bt].x:Ze[bt].x>qe&&(qe=Ze[bt].x),Ze[bt].y<We?We=Ze[bt].y:Ze[bt].y>xt&&(xt=Ze[bt].y);return[lt,We,qe-lt,xt-We]}(o),ie=Ze=>[(Ze.x-te)/U,(Ze.y-ne)/ee],[ae,Te,ve,Ee]=o.map(ie),Re=function(Ze,lt,qe,We,xt,bt,ir,qt){const zt=h_(0,0,1,0,1,1,0,1);return wt(zt,zt,tt([],h_(Ze,lt,qe,We,xt,bt,ir,qt)))}(ae[0],ae[1],Te[0],Te[1],ve[0],ve[1],Ee[0],Ee[1]);this.elevatedGlobePerspectiveTransform=sb(ae[0],ae[1],Te[0],Te[1],ve[0],ve[1],Ee[0],Ee[1]);const He=(Ze,lt)=>{E.push(Ze.lng);const qe=Math.round((Ze.lng-k)/j*Ct),We=Math.round((Ze.lat-L)/G*Ct),xt=ie(lt),bt=Pi([],[xt[0],xt[1],1],Re),ir=Math.round(bt[0]/bt[2]*Ct),qt=Math.round(bt[1]/bt[2]*Ct);K.emplaceBack(qe,We,ir,qt)},ht=o[3].x-o[0].x,it=o[3].y-o[0].y,ut=o[2].x-o[1].x,mt=o[2].y-o[1].y;for(let Ze=0;Ze<65;Ze++){const lt=Ze/64,qe=[o[0].x+lt*ht,o[0].y+lt*it],We=[o[1].x+lt*ut,o[1].y+lt*mt],xt=We[0]-qe[0],bt=We[1]-qe[1];for(let ir=0;ir<65;ir++){const qt=ir/64,zt={x:qe[0]+xt*qt,y:qe[1]+bt*qt};He(r.projection.unproject(zt.x,zt.y),zt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(K,av.members)}{this.maxLongitudeTriangleSize=0;let K=[],te=new as;const ne=(U,ee,ie)=>{te.emplaceBack(U,ee,ie);const ae=E[U],Te=E[ee],ve=E[ie],Ee=Math.min(Math.min(ae,Te),ve),Re=Math.max(Math.max(ae,Te),ve)-Ee;Re>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Re),K.push(Ee+Re/2)};for(let U=0;U<64;U++)for(let ee=0;ee<64;ee++){const ie=65*U+ee,ae=ie+1,Te=ie+65,ve=Te+1;ne(ie,Te,ae),ne(ae,Te,ve)}[K,te]=function(U,ee){const ie=Array.from({length:U.length},(ve,Ee)=>Ee);ie.sort((ve,Ee)=>U[ve]-U[Ee]);const ae=[],Te=new as;for(let ve=0;ve<ie.length;ve++){const Ee=ie[ve];ae.push(U[Ee]);const Re=3*Ee,He=Re+1;Te.emplaceBack(ee.uint16[Re],ee.uint16[He],ee.uint16[He+1])}return[ae,Te]}(K,te),this.elevatedGlobeTrianglesCenterLongitudes=K,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(te)}this.elevatedGlobeSegments=$n.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,j/Ct,0,G/Ct,0,0,L,k,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const r=this.map.painter.context,o=r.gl;!this._dirty||this.texture instanceof u_||(this.texture?this.texture.update(this.image):(this.texture=new uv(r,this.image,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(r)}loadTile(e,r){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},r(null)):(e.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;const o=this.elevatedGlobeTrianglesCenterLongitudes;let a=(u=e+180)+360*Math.round((o[0]-u)/360);var u;const h=new $n,g=(A,C)=>{h.segments.push({vertexOffset:0,primitiveOffset:A,vertexLength:r.segments[0].vertexLength,primitiveLength:C,sortKey:void 0,vaos:{}})},v=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-a)<=v){const A=Zi(o,0,o.length,a+v);return A===o.length||g(A,hi(o,A+1,o.length,a+360-v)-A),h}a<o[0]&&(a+=360);const x=hi(o,0,o.length,a-v);if(x===o.length)return g(0,o.length),h;g(0,x-0);const E=Zi(o,x+1,o.length,a+v);return E!==o.length&&g(E,o.length-E),h}}const iM=(Math.pow(256,2)-1)/16907520;class ab extends Vs{constructor(e,r,o,a){super(e,{layout:nb||(nb=new fi({visibility:new gt(ke.layout_raster.visibility)})),paint:ib||(ib=new fi({"raster-opacity":new gt(ke.paint_raster["raster-opacity"]),"raster-color":new Al(ke.paint_raster["raster-color"]),"raster-color-mix":new gt(ke.paint_raster["raster-color-mix"]),"raster-color-range":new gt(ke.paint_raster["raster-color-range"]),"raster-hue-rotate":new gt(ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new gt(ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new gt(ke.paint_raster["raster-brightness-max"]),"raster-saturation":new gt(ke.paint_raster["raster-saturation"]),"raster-contrast":new gt(ke.paint_raster["raster-contrast"]),"raster-resampling":new gt(ke.paint_raster["raster-resampling"]),"raster-fade-duration":new gt(ke.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new gt(ke.paint_raster["raster-emissive-strength"]),"raster-array-band":new gt(ke.paint_raster["raster-array-band"]),"raster-elevation":new gt(ke.paint_raster["raster-elevation"]),"raster-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},r,o,a),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof ob&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const r=this._transitionablePaint._values["raster-color"].value.expression,[o,a]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(a)||o===this._curRampRange[0]&&a===this._curRampRange[1]||(this.colorRamp=Sm({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:a}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,a])}}let lb,cb,ub,hb,db;class fb extends Vs{constructor(e,r,o,a){super(e,{layout:lb||(lb=new fi({visibility:new gt(ke["layout_raster-particle"].visibility)})),paint:cb||(cb=new fi({"raster-particle-array-band":new gt(ke["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new gt(ke["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Al(ke["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new gt(ke["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new gt(ke["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new gt(ke["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new gt(ke["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new gt(ke["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},r,o,a),this._updateColorRamp(),this.lastInvalidatedAt=ha.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Sm({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ha.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class sM extends Vs{constructor(e,r){super(e,{},r,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function hv(n,e,r){const o=[0,0,1],a=Zs([]);return ho(a,a,r?-en(n)+Math.PI:en(n)),la(a,a,-en(e)),qi(o,o,a),br(o,o)}function pb(n,e){const r=f_(n.projection,n.zoom,n.width,n.height),o=function(u,h,g,v,x){const E=new J(g.lng-180*nf,g.lat),A=new J(g.lng+180*nf,g.lat),C=u.project(E.lng,E.lat),k=u.project(A.lng,A.lat),L=-Math.atan2(k.y-C.y,k.x-C.x),j=Ie.fromLngLat(g);j.y=me(j.y,-1+nf,1-nf);const G=j.toLngLat(),K=u.project(G.lng,G.lat),te=Ie.fromLngLat(G);te.x+=nf;const ne=te.toLngLat(),U=u.project(ne.lng,ne.lat),ee=gb(U.x-K.x,U.y-K.y,L),ie=Ie.fromLngLat(G);ie.y+=nf;const ae=ie.toLngLat(),Te=u.project(ae.lng,ae.lat),ve=gb(Te.x-K.x,Te.y-K.y,L),Ee=Math.abs(ee.x)/Math.abs(ve.y),Re=Be([]);hr(Re,Re,-L*(1-(x?0:v)));const He=Be([]);return Vt(He,He,[1,1-(1-Ee)*v,1]),He[4]=-ve.x/ve.y*v,hr(He,He,L),Tt(He,Re,He),He}(n.projection,0,n.center,r,e),a=mb(n);return Vt(o,o,[a,a,1]),o}function mb(n){const e=n.projection,r=f_(n.projection,n.zoom,n.width,n.height),o=dv(e,n.center),a=dv(e,J.convert(e.center));return Math.pow(2,o*r+(1-r)*a)}function f_(n,e,r,o,a=1/0){const u=n.range;if(!u)return 0;const h=Math.min(a,Math.max(r,o)),g=Math.log(h/1024)/Math.LN2;return Ae(u[0]+g,u[1]+g,e)}const nf=1/4e4;function dv(n,e){const r=me(e.lat,-85.051129,Ye),o=new J(e.lng-180*nf,r),a=new J(e.lng+180*nf,r),u=n.project(o.lng,r),h=n.project(a.lng,r),g=Ie.fromLngLat(o),v=Ie.fromLngLat(a),x=h.x-u.x,E=h.y-u.y,A=v.x-g.x,C=v.y-g.y,k=Math.sqrt((A*A+C*C)/(x*x+E*E));return Math.log(k)/Math.LN2}function gb(n,e,r){const o=Math.cos(r),a=Math.sin(r);return{x:n*o-e*a,y:n*a+e*o}}function _b(n,e,r){Be(n),hr(n,n,en(e[2])),jt(n,n,en(e[0])),vr(n,n,en(e[1])),Vt(n,n,r),Tt(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function p_(n,e,r,o,a,u,h,g){const v=[r[0]-e[0],r[1]-e[1],0],x=[o[0]-e[0],o[1]-e[1],0];if(gr(v)<1e-12||gr(x)<1e-12)return Zs(n);const E=Sr([],v,x);br(E,E),nn(x,o,e),v[2]=(u-a)*g,x[2]=(h-a)*g;const A=v;return Sr(A,v,x),br(A,A),Zo(n,E,A)}function fv(n,e,r=!1){const o=sn(e.zoom),a=function(u,h,g){const v=h.worldSize,x=[u[12],u[13],u[14]],E=Pe(x[1]/v),A=xe(x[0]/v),C=Be([]),k=ye(1,E)*v,L=ye(1,0)*v*ot(E,h.zoom),j=1/dt(v);let G=L*j;if(g){const U=f_(h.projection,h.zoom,h.width,h.height,1024);G=j*h.projection.pixelSpaceConversion(h.center.lat,v,U)}const K=V(E,A);rn(K,K,Ht([],br([],K),k*G*x[2]));const te=function(U){const ee=[U[0],U[1],U[2]];let ie=[0,1,0];const ae=Sr([],ie,ee);return Sr(ie,ee,ae),Pr(ie)===0&&(ie=[0,1,0],Sr(ae,ee,ie)),br(ae,ae),br(ie,ie),br(ee,ee),[ae[0],ae[1],ae[2],0,ie[0],ie[1],ie[2],0,ee[0],ee[1],ee[2],0,U[0],U[1],U[2],1]}(K);Vt(C,C,[G,G,G*k]),Dt(C,C,[-x[0],-x[1],-x[2]]);const ne=Tt([],h.globeMatrix,te);return Tt(ne,ne,C),Tt(ne,ne,u),ne}(n,e,r);if(o>0){const u=function(h,g){const v=g.worldSize,x=ye(1,0)*v*ot(g.center.lat,g.zoom)/dt(v),E=ye(1,g.center.lat)*v,A=Be([]);return vr(A,A,en(g.center.lng)),jt(A,A,en(g.center.lat)),Dt(A,A,[0,0,y]),Vt(A,A,[x,x,x*E]),Dt(A,A,[g.point.x-.5*v,g.point.y-.5*v,0]),Tt(A,A,h),Tt(A,g.globeMatrix,A)}(n,e);return function(h,g,v){const x=(L,j,G)=>{const K=gr(L),te=gr(j),ne=_t(L,j,G);return Ht(ne,ne,1/gr(ne)*lr(K,te,G))},E=x([h[0],h[1],h[2]],[g[0],g[1],g[2]],v),A=x([h[4],h[5],h[6]],[g[4],g[5],g[6]],v),C=x([h[8],h[9],h[10]],[g[8],g[9],g[10]],v),k=_t([h[12],h[13],h[14]],[g[12],g[13],g[14]],v);return[E[0],E[1],E[2],0,A[0],A[1],A[2],0,C[0],C[1],C[2],0,k[0],k[1],k[2],1]}(a,u,o)}return a}function yb(n,e,r,o){const a=Tn.projectAabbCorners(o,r);let u=Number.MAX_VALUE,h=-1;for(let x=0;x<a.length;++x){const E=a[x];E[0]=(.5*E[0]+.5)*e.width,E[1]=(.5-.5*E[1])*e.height,E[2]<u&&(h=x,u=E[2])}const g=x=>new ft(a[x][0],a[x][1]);let v;switch(h){case 0:case 6:v=[g(1),g(5),g(4),g(7),g(3),g(2),g(1)];break;case 1:case 7:v=[g(0),g(4),g(5),g(6),g(2),g(3),g(0)];break;case 3:case 5:v=[g(1),g(0),g(4),g(7),g(6),g(2),g(1)];break;default:v=[g(1),g(5),g(6),g(7),g(3),g(0),g(1)]}if(To(n,v))return u}const oM=pn([{name:"a_pos_3f",components:3,type:"Float32"}]),aM=pn([{name:"a_color_3f",components:3,type:"Float32"}]),lM=pn([{name:"a_color_4f",components:4,type:"Float32"}]),cM=pn([{name:"a_uv_2f",components:2,type:"Float32"}]),uM=pn([{name:"a_normal_3f",components:3,type:"Float32"}]),hM=pn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),dM=pn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),vb={None:0,Model:1,Symbol:2,FillExtrusion:4};class m_{constructor(e,r,o,a){this.message=(e?`${e}: `:"")+o,a&&(this.identifier=a),r!=null&&r.__line__&&(this.line=r.__line__)}}function pv(n,e){const r=n.indexOf("://")===-1;try{return new URL(n,r&&e?"http://example.com":void 0),!0}catch{return!1}}class xb{constructor(e,r){this.feature=e,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class wb{constructor(){this.instancedDataArray=new iu,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class mv{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,r){}populate(e,r,o,a){this.tileToMeter=$e(o);const u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:h,id:g,index:v,sourceLayerIndex:x}of e){const E=g??(h.properties&&h.properties.hasOwnProperty("id")?h.properties.id:void 0),A=Mt(h,u);if(!this.layers[0]._featureFilter.filter(new zn(this.zoom,{worldview:this.worldview}),A,o))continue;const C={id:E,sourceLayerIndex:x,index:v,geometry:u?A.geometry:Lt(h,o,a),properties:h.properties,type:h.type,patterns:{}},k=this.addFeature(C,C.geometry,A);k&&r.featureIndex.insert(h,C.geometry,v,x,this.index,this.instancesPerModel[k].instancedDataArray.length,Ct/32)}this.lookup=null}update(e,r,o,a){for(const u in this.instancesPerModel){const h=this.instancesPerModel[u];for(const g in e)h.idToFeaturesIndex.hasOwnProperty(g)&&(this.evaluate(h.features[h.idToFeaturesIndex[g]],e[g],h,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const r in this.instancesPerModel){const o=this.instancesPerModel[r];for(const a of o.features){const u=this.layers[0],h=a.feature,g=this.canonical,v=u.paint.get("model-rotation").evaluate(h,{},g),x=u.paint.get("model-scale").evaluate(h,{},g),E=u.paint.get("model-translation").evaluate(h,{},g);us(a.rotation,v)&&us(a.scale,x)&&us(a.translation,E)||(this.evaluate(a,a.featureStates,o,!0),e=!0)}}return e}updateReplacement(e,r,o,a){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const u=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(zy(this.activeReplacements,u))return!1;this.activeReplacements=u;let h=!1;for(const g in this.instancesPerModel){const v=this.instancesPerModel[g],x=v.instancedDataArray;for(const E of v.features){const A=E.instancedDataOffset,C=E.instancedDataCount;for(let k=0;k<C;k++){const L=16*(k+A);let j=x.float32[L+0];const G=j>Ct;j=G?j-Ct:j;const K=Math.floor(j),te=x.float32[L+1];let ne=!1;for(const U of this.activeReplacements)if(!f1(U,o,vb.Model,a)&&!(U.min.x>K||K>U.max.x||U.min.y>te||te>U.max.y)&&(ne=v1(y1(K,te,e.canonical,U.footprintTileId.canonical),U.footprint),ne))break;x.float32[L]=ne?j+Ct:j,h=h||ne!==G}}}return h}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const r in this.instancesPerModel){const o=this.instancesPerModel[r];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,hM.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const r in this.instancesPerModel){const o=this.instancesPerModel[r];o.instancedDataArray.length!==0&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const r of this.modelUris)e.removeModel(r,"",!0)}addFeature(e,r,o){const a=this.layers[0],u=a.layout.get("model-id").evaluate(o,{},this.canonical);if(!u)return Rr(`modelId is not evaluated for layer ${a.id} and it is not going to get rendered.`),u;(pv(u,!1)||this.styleDefinedModelURLs[u]!==void 0)&&(this.modelUris.includes(u)||this.modelUris.push(u)),this.instancesPerModel[u]||(this.instancesPerModel[u]=new wb);const h=this.instancesPerModel[u],g=h.instancedDataArray,v=new xb(o,g.length);for(const x of r)for(const E of x){if(E.x<0||E.x>=Ct||E.y<0||E.y>=Ct)continue;const A=(this.lookupDim-1)/Ct,C=this.lookupDim*(E.y*A|0)+E.x*A|0;if(this.lookup){if(this.lookup[C]!==0)continue;this.lookup[C]=1}this.instanceCount++;const k=g.length;g.resize(k+1),h.instancesEvaluatedElevation.push(0),g.float32[16*k]=E.x,g.float32[16*k+1]=E.y}return v.instancedDataCount=h.instancedDataArray.length-v.instancedDataOffset,v.instancedDataCount>0&&(e.id&&(h.idToFeaturesIndex[e.id]=h.features.length),h.features.push(v),this.evaluate(v,{},h,!1)),u}getModelUris(){return this.modelUris}evaluate(e,r,o,a){const u=this.layers[0],h=e.feature,g=this.canonical,v=e.rotation=u.paint.get("model-rotation").evaluate(h,r,g),x=e.scale=u.paint.get("model-scale").evaluate(h,r,g),E=e.translation=u.paint.get("model-translation").evaluate(h,r,g),A=u.paint.get("model-color").evaluate(h,r,g);A.a=u.paint.get("model-color-mix-intensity").evaluate(h,r,g);const C=[];this.maxVerticalOffset<E[2]&&(this.maxVerticalOffset=E[2]),this.maxScale=Math.max(Math.max(this.maxScale,x[0]),Math.max(x[1],x[2])),_b(C,v,x);const k=Math.round(100*A.a)+A.b/1.05;for(let L=0;L<e.instancedDataCount;++L){const j=e.instancedDataOffset+L,G=16*j,K=o.instancedDataArray.float32;let te=0;a&&(te=K[G+6]-o.instancesEvaluatedElevation[j]);const ne=0|K[G+1];K[G]=(0|K[G])+A.r/1.05,K[G+1]=ne+A.g/1.05,K[G+2]=k,K[G+3]=1/(g.z>10?this.tileToMeter:$e(g,ne)),K[G+4]=E[0],K[G+5]=E[1],K[G+6]=E[2]+te,K[G+7]=C[0],K[G+8]=C[1],K[G+9]=C[2],K[G+10]=C[4],K[G+11]=C[5],K[G+12]=C[6],K[G+13]=C[8],K[G+14]=C[9],K[G+15]=C[10],o.instancesEvaluatedElevation[j]=E[2]}}}let bb,Tb;Ft(mv,"ModelBucket",{omit:["layers"]}),Ft(wb,"PerModelAttributes"),Ft(xb,"ModelFeature");const tp=64,Hp={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Sb(n,e,r,o,a,u,h,g,v,x=!1){const E=r.zoom,A=r.project(o),C=ot(o.lat,E),k=1/C;Be(n),Dt(n,n,[A.x+h[0]*k,A.y+h[1]*k,h[2]]);let L=1,j=1;const G=r.worldSize;if(x){if(r.projection.name==="mercator"){let U=0;r.elevation&&(U=r.elevation.getAtPointOrZero(new Ie(A.x/G,A.y/G),0));const ee=ds([],[A.x,A.y,U,1],r.projMatrix)[3]/r.cameraToCenterDistance;L=ee,j=ee*ot(r.center.lat,E)}else if(r.projection.name==="globe"){const U=fv(n,r),ee=[0,0,0,1];ds(ee,ee,Tt([],r.projMatrix,U));const ie=ee[3]/r.cameraToCenterDistance,ae=sn(E),Te=r.projection.pixelsPerMeter(o.lat,G)*ot(o.lat,E),ve=r.projection.pixelsPerMeter(r.center.lat,G)*ot(r.center.lat,E);L=ie/lr(Te,Xe(r.center.lat),ae),j=ie*C/Te,L*=ve,j*=ve}}else L=k;Vt(n,n,[L,L,j]);const K=[...n],te=e.orientation,ne=[];if(_b(ne,[te[0]+a[0],te[1]+a[1],te[2]+a[2]],u),Tt(n,K,ne),g&&r.elevation){let U=0;const ee=[];if(v&&r.elevation){U=function(ae,Te,ve,Ee,Re){const He=Te.elevation;if(!He)return 0;const ht=Tn.projectAabbCorners(ve,Ee),it=ye(1,Re.lat)*Te.worldSize,ut=function(yt,wr){const Gt=[0,0,1],Zt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const pr of Zt){const Fr=yt[pr.corners[0]],kr=yt[pr.corners[1]],Zr=yt[pr.corners[2]],jr=[kr[0]-Fr[0],kr[1]-Fr[1],wr*(kr[2]-Fr[2])],Xr=Sr(jr,jr,[Zr[0]-Fr[0],Zr[1]-Fr[1],wr*(Zr[2]-Fr[2])]);br(Xr,Xr),pr.dotProductWithUp=Br(Xr,Gt)}return Zt.sort((pr,Fr)=>pr.dotProductWithUp-Fr.dotProductWithUp),Zt[0].corners}(ht,it),mt=ht[ut[0]],Ze=ht[ut[1]],lt=ht[ut[2]],qe=ht[ut[3]],We=He.getAtPointOrZero(new Ie(mt[0]/Te.worldSize,mt[1]/Te.worldSize),0),xt=He.getAtPointOrZero(new Ie(Ze[0]/Te.worldSize,Ze[1]/Te.worldSize),0),bt=He.getAtPointOrZero(new Ie(lt[0]/Te.worldSize,lt[1]/Te.worldSize),0),ir=He.getAtPointOrZero(new Ie(qe[0]/Te.worldSize,qe[1]/Te.worldSize),0),qt=(We+ir)/2,zt=(xt+bt)/2;return qt>zt?xt<bt?p_(ae,Ze,qe,mt,xt,ir,We,it):p_(ae,lt,mt,qe,bt,We,ir,it):We<ir?p_(ae,mt,Ze,lt,We,xt,bt,it):p_(ae,qe,lt,Ze,ir,bt,xt,it),Math.max(qt,zt)}(ee,r,e.aabb,n,o);const ie=Tt([],Cr([],ee),ne);Tt(n,K,ie)}else U=r.elevation.getAtPointOrZero(new Ie(A.x/G,A.y/G),0);U!==0&&(n[14]+=U)}}function Xm(n,e,r=!1){n.uploaded||(n.gfxTexture=new uv(e,n.image,r?e.gl.R8:e.gl.RGBA8,{useMipmap:n.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function fM(n,e,r){n.indexBuffer=e.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=e.createVertexBuffer(n.vertexArray,oM.members,!1,!0),n.normalArray&&(n.normalBuffer=e.createVertexBuffer(n.normalArray,uM.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=e.createVertexBuffer(n.texcoordArray,cM.members,!1,!0)),n.colorArray&&(n.colorBuffer=e.createVertexBuffer(n.colorArray,(n.colorArray.bytesPerElement===12?aM:lM).members,!1,!0)),n.featureArray&&(n.pbrBuffer=e.createVertexBuffer(n.featureArray,dM.members,!0)),n.segments=$n.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const o=n.material;o.pbrMetallicRoughness.baseColorTexture&&Xm(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&Xm(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&Xm(o.normalTexture,e),o.occlusionTexture&&Xm(o.occlusionTexture,e,r),o.emissionTexture&&Xm(o.emissionTexture,e)}function gv(n,e,r){if(n.meshes)for(const o of n.meshes)fM(o,e,r);if(n.children)for(const o of n.children)gv(o,e,r)}function g_(n){if(n.meshes)for(const e of n.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(n.children)for(const e of n.children)g_(e)}function _v(n){if(n.meshes)for(const r of n.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((e=r.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(n.children)for(const r of n.children)_v(r)}class Wp{constructor(e,r,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=o}static create(e,r,o){const a=o||e.findDEMTileFor(r);if(!a||!a.dem)return;const u=a.dem,h=a.tileID,g=1<<r.canonical.z-h.canonical.z;return new Wp(a,u.dim/Ct/g,[(r.canonical.x/g-h.canonical.x)*u.dim,(r.canonical.y/g-h.canonical.y)*u.dim])}tileCoordToPixel(e,r){const o=r*this._scale+this._offset[1],a=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(o);return new ft(a,u)}getElevationAt(e,r,o,a){const u=e*this._scale+this._offset[0],h=r*this._scale+this._offset[1],g=Math.floor(u),v=Math.floor(h),x=this._dem;return a=!!a,o?lr(lr(x.get(g,v,a),x.get(g,v+1,a),h-v),lr(x.get(g+1,v,a),x.get(g+1,v+1,a),h-v),u-g):x.get(g,v,a)}getElevationAtPixel(e,r,o){return this._dem.get(e,r,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ye(1,e)*this._dem.stride}}const yv=new Float32Array(262144),rp=new Uint8Array(262144);function Eb(n){let e=0;if(n.meshes)for(const r of n.meshes)e=Math.max(e,r.aabb.max[2]);if(n.children)for(const r of n.children)e=Math.max(e,Eb(r));return e}function Ib(n,e,r){if(n.meshes)for(const o of n.meshes){if(o.aabb.min[0]===1/0)continue;const a=Tn.applyTransform(o.aabb,n.matrix);r.insert(e,a.min[0],a.min[1],a.max[0],a.max[1])}if(n.children)for(const o of n.children)Ib(o,e,r)}const Ab=["","wall","door","roof","window","lamp","logo"];class Cb{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Eb(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Tn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const r=new Tn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const o of this.node.meshes)this.node.lightMeshIndex!==e&&(o.transformedAabb=Tn.applyTransformFast(o.aabb,this.node.matrix),r.encapsulate(o.transformedAabb)),e++;this.aabb=r}return this.aabb}}class __{constructor(e,r,o,a,u,h,g,v){this.id=o,this.layers=e,this.layerIds=this.layers.map(x=>x.fqid),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.modelTraits|=Hp.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=Hp.HasMapboxMeshFeatures),u&&(this.modelTraits|=Hp.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=h,this.worldview=v,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const x of r)this.nodesInfo.push(new Cb(x)),Ib(x,g.featureIndexArray.length,g.grid),g.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,g.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,r){for(const o of this.getNodesInfo()){const a=o.node;a.footprint&&r.push({footprint:a.footprint,id:e})}}update(e){const r=Object.keys(e).length!==0;if(r&&!this.stateDependentLayers.length)return;const o=r?this.stateDependentLayers:this.layers;if(!ws(e,this.states))for(const a of o)this.evaluate(a,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const o of r){const a=o.node;this.uploaded?this.updatePbrBuffer(a):gv(a,e,!0)}for(const o of r)g_(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let r=!1;if(!e.meshes)return r;for(const o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),r=!0);return r}needsReEvaluation(e,r,o){const a=e.transform.projectionOptions,u=e.style.getBrightness(),h=this.brightness!==u;if(!this.uploaded||this.dirty||a.name!==this.projection.name||Ym(o.paint.get("model-color").value,h)||Ym(o.paint.get("model-color-mix-intensity").value,h)||Ym(o.paint.get("model-roughness").value,h)||Ym(o.paint.get("model-emissive-strength").value,h)||Ym(o.paint.get("model-height-based-emissive-strength-multiplier").value,h)){this.projection=a,this.brightness=u;const g=this.getNodesInfo();for(const v of g)v.state=null;return!0}return!1}evaluateTransform(e,r){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const o=this.getNodesInfo(),a=this.id.canonical;for(const u of o){const h=u.feature;u.evaluatedTranslation=r.paint.get("model-translation").evaluate(h,{},a),u.evaluatedScale=r.paint.get("model-scale").evaluate(h,{},a)}}evaluate(e,r){const o=this.getNodesInfo();for(const a of o){if(!a.node.meshes)continue;const u=a.feature,h=r&&r[u.id];if(ws(h,a.state))continue;a.state=structuredClone(h);const g=a.node.meshes&&a.node.meshes[0].featureData,v=a.evaluatedColor[2],x=a.evaluatedRMEA[2],E=this.id.canonical;if(a.hasTranslucentParts=!1,g){for(let A=0;A<Ab.length;A++){const C=Ab[A];C.length&&(u.properties.part=C);const k=e.paint.get("model-color").evaluate(u,h,E).toPremultipliedRenderColor(null),L=e.paint.get("model-color-mix-intensity").evaluate(u,h,E);a.evaluatedColor[A]=[k.r,k.g,k.b,L],a.evaluatedRMEA[A][0]=e.paint.get("model-roughness").evaluate(u,h,E),a.evaluatedRMEA[A][2]=e.paint.get("model-emissive-strength").evaluate(u,h,E),a.evaluatedRMEA[A][3]=k.a,a.emissionHeightBasedParams[A]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,h,E),!a.hasTranslucentParts&&k.a<1&&(a.hasTranslucentParts=!0)}delete u.properties.part,mM(a,v!==a.evaluatedColor[2]||x!==a.evaluatedRMEA[2],this.modelTraits)}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(u,h,E);a.evaluatedTranslation=e.paint.get("model-translation").evaluate(u,h,E),a.evaluatedScale=e.paint.get("model-scale").evaluate(u,h,E),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,r,o,a){const u=e.findDEMTileFor(o);if(u&&(u.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;const h=Wp.create(e,o,u);if(!h)return;this.modelTraits&Hp.HasMapboxMeshFeatures&&this.updateDEM(e,h,o,a);for(const g of this.getNodesInfo()){const v=g.node;if(!v.footprint||!v.footprint.vertices||!v.footprint.vertices.length)continue;const x=v.footprint.vertices;let E=h.getElevationAt(x[0].x,x[0].y,!0,!0);for(let A=1;A<x.length;A++)E=Math.min(E,h.getElevationAt(x[A].x,x[A].y,!0,!0));v.elevation=E}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=r}}updateDEM(e,r,o,a){let u=r._dem._modifiedForSources[a];if(u===void 0&&(r._dem._modifiedForSources[a]=[],u=r._dem._modifiedForSources[a]),u.includes(o.canonical))return;const h=r._dem.dim;u.push(o.canonical);let g=!1;for(const v of this.getNodesInfo()){const x=v.node;if(!x.footprint||!x.footprint.grid)continue;const E=x.footprint.grid,A=r.tileCoordToPixel(E.min.x,E.min.y),C=r.tileCoordToPixel(E.max.x,E.max.y),k=Math.min(Math.min(h-C.y,A.x),Math.min(A.y,h-C.x));if(k<0)continue;const L=me(k,2,5);let j=Math.max(0,A.x-L),G=Math.max(0,A.y-L),K=Math.min(C.x+L,h-1),te=Math.min(C.y+L,h-1);for(let ie=G;ie<=te;++ie)for(let ae=j;ae<=K;++ae)rp[ie*h+ae]=255;let ne=0,U=0;for(let ie=0;ie<E.cellsY;++ie)for(let ae=0;ae<E.cellsX;++ae){if(!E.cells[ie*E.cellsX+ae])continue;const Te=r.tileCoordToPixel(E.min.x+ae/E.xScale,E.min.y+ie/E.yScale),ve=r.tileCoordToPixel(E.min.x+(ae+1)/E.xScale,E.min.y+(ie+1)/E.yScale);for(let Ee=Te.y;Ee<=Math.min(ve.y+1,h-1);++Ee)for(let Re=Te.x;Re<=Math.min(ve.x+1,h-1);++Re)rp[Ee*h+Re]===255&&(rp[Ee*h+Re]=0,ne+=r.getElevationAtPixel(Re,Ee),U++)}const ee=ne/U;j=Math.max(1,A.x-L),G=Math.max(1,A.y-L),K=Math.min(C.x+L,h-2),te=Math.min(C.y+L,h-2),g=!0;for(let ie=G;ie<=te;++ie)for(let ae=j;ae<=K;++ae)rp[ie*h+ae]===0&&(yv[ie*h+ae]=r._dem.set(ae,ie,ee));for(let ie=1;ie<L;++ie){j=Math.max(1,A.x-ie),G=Math.max(1,A.y-ie),K=Math.min(C.x+ie,h-2),te=Math.min(C.y+ie,h-2);for(let ae=G;ae<=te;++ae)for(let Te=j;Te<=K;++Te){const ve=ae*h+Te;if(rp[ve]===255){let Ee=0,Re=0,He=-1,ht=-1;for(let it=-1;it<=1;++it)for(let ut=-1;ut<=1;++ut){const mt=(ae+it)*h+Te+ut;if(rp[mt]>=ie)continue;const Ze=yv[mt],lt=Math.abs(Ze);lt>Re&&(Ee=Ze,Re=lt,He=ut,ht=it)}if(Re>.1){const it=1-(ie+.5*Math.abs(He*ht))/L;let ut=r._dem.get(Te,ae)+Ee*it;const mt=r._dem.get(Te+He,ae+ht),Ze=r._dem.get(Te-He,ae-ht,!0);(ut-mt)*(ut-Ze)>0&&(ut=(mt+Ze)/2),yv[ve]=r._dem.set(Te,ae,ut),rp[ve]=ie}}}}}g&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=ha.now())}setFilter(e){this.filter=e?Vh(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new zn(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const r of e)g_(r.node),_v(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const o=r.getReplacementRegionsForTile(e.toUnwrapped());for(const a of this.getNodesInfo()){const u=a.node.footprint;a.hiddenByReplacement=!!u&&!o.find(h=>h.footprint===u)}}getHeightAtTileCoord(e,r){const o=[],a=[0,0,0],u=Be([]);for(const h of this.getNodesInfo()){const g=h.node.meshes[0],v=g.transformedAabb;if(e<v.min[0]||r<v.min[1]||e>v.max[0]||r>v.max[1])continue;if(h.node.hidden===!0)return{height:1/0,maxHeight:h.feature.properties.height,hidden:!1,verticalScale:h.evaluatedScale[2]};ct(u,h.node.matrix),a[0]=e,a[1]=r,Ar(a,a,u);const x=(a[0]-g.aabb.min[0])/(g.aabb.max[0]-g.aabb.min[0])*tp|0,E=Math.min(63,(a[1]-g.aabb.min[1])/(g.aabb.max[1]-g.aabb.min[1])*tp|0)*tp+Math.min(63,x),A=g.heightmap[E];if(!(A<0&&h.node.footprint))return h.hiddenByReplacement?void 0:{height:A,maxHeight:h.feature.properties.height,hidden:!1,verticalScale:h.evaluatedScale[2]};if(h.node.footprint.grid.query(new ft(e,r),new ft(e,r),o),o.length>0)return{height:void 0,maxHeight:h.feature.properties.height,hidden:h.hiddenByReplacement,verticalScale:h.evaluatedScale[2]}}}}function Ym(n,e){return n instanceof cc&&!n.isLightConstant&&e}function pM(n,e,r,o,a,u,h,g){let v=(61440&e|(61440&e)>>4)>>8,x=(3840&e|(3840&e)>>4)>>4,E=240&e|(240&e)>>4;r[3]>0&&(v=lr(v,255*r[0],r[3]),x=lr(x,255*r[1],r[3]),E=lr(E,255*r[2],r[3]));const A=v<<8|x,C=E<<8|Math.floor(255*o[3]),k=function(ie){const ae=me(ie,0,2);return Math.min(Math.round(.5*ae*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],L=me(a[0],0,1),j=me(a[1],0,1),G=me(a[2],0,1),K=me(a[3],0,1);let te,ne,U,ee;if(L!==j&&h!==u&&j!==L){const ie=h-u;ne=1/(ie*(j-L)),U=-(u+ie*L)/(ie*(j-L));const ae=me(a[4],-1,1);ee=Math.pow(10,ae),te=255*G<<8|255*K}else te=65535,ne=0,U=1,ee=1;if(n.emplaceBack(A,C,k,te,ne,U,ee),g){const ie=g.length;g.clear();for(let ae=0;ae<ie;ae++)g.emplaceBack(A,C,k,te,ne,U,ee)}}function mM(n,e,r){const o=n.node;let a=0;const u=r&Hp.HasMeshoptCompression;for(const h of o.meshes){if(o.lights&&o.lightMeshIndex===a||!h.featureData)continue;h.featureArray=new eh,h.featureArray.reserve(h.featureData.length);let g=e;for(const v of h.featureData){const x=u?65535&v:v>>16&65535,E=u?v>>16&65535:65535&v,A=(15&E)<8?15&E:0,C=n.evaluatedRMEA[A],k=n.evaluatedColor[A],L=n.emissionHeightBasedParams[A];let j;if(g&&A===2&&o.lights&&(j=new eh,j.resize(10*o.lights.length)),pM(h.featureArray,x,k,C,L,h.aabb.min[2],h.aabb.max[2],j),j&&g){g=!1;const G=o.meshes[o.lightMeshIndex];G.featureArray=j,G.featureArray._trim()}}h.featureArray._trim(),a++}}function Mb(n,e,r,o){const a=1<<n.z;e.lat=Pe((o/Ct+n.y)/a),e.lng=xe((r/Ct+n.x)/a)}function gM(n,e,r,o){const a=n.getNodesInfo()[e];if(!a||a.hiddenByReplacement||!a.node.meshes)return;let u=Number.MAX_VALUE;const h=a.node,g=r.tile,v=o.calculatePosMatrix(g.tileID.toUnwrapped(),o.worldSize),x=a.evaluatedScale;let E=0;o.elevation&&h.elevation&&(E=h.elevation*o.elevation.exaggeration()),Dt(v,v,[(h.anchor?h.anchor[0]:0)*(x[0]-1),(h.anchor?h.anchor[1]:0)*(x[1]-1),E]),Vt(v,v,x);const A=r.queryGeometry,C=A.isPointQuery()?A.screenBounds:A.screenGeometry,k=function(j){const G=Tt([],v,j.matrix);Tt(G,o.expandedFarZProjMatrix,G);for(let K=0;K<j.meshes.length;++K){const te=j.meshes[K];if(K===j.lightMeshIndex)continue;const ne=yb(C,o,G,te.aabb);ne!=null&&(u=Math.min(ne,u))}if(j.children)for(const K of j.children)k(K)};if(k(h),u===Number.MAX_VALUE)return;const L=new J(0,0);return Mb(g.tileID.canonical,L,a.node.anchor[0],a.node.anchor[1]),{intersectionZ:u,position:L,feature:a.feature}}Ft(__,"Tiled3dModelBucket",{omit:["layers"]}),Ft(Cb,"Tiled3dModelFeature");const _M={circle:class extends Vs{constructor(n,e,r,o){super(n,{layout:Lp||(Lp=new fi({"circle-sort-key":new It(ke.layout_circle["circle-sort-key"]),"circle-elevation-reference":new gt(ke.layout_circle["circle-elevation-reference"]),visibility:new gt(ke.layout_circle.visibility)})),paint:Wf||(Wf=new fi({"circle-radius":new It(ke.paint_circle["circle-radius"]),"circle-color":new It(ke.paint_circle["circle-color"]),"circle-blur":new It(ke.paint_circle["circle-blur"]),"circle-opacity":new It(ke.paint_circle["circle-opacity"]),"circle-translate":new gt(ke.paint_circle["circle-translate"]),"circle-translate-anchor":new gt(ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new gt(ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new gt(ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new It(ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new It(ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new It(ke.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new gt(ke.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,r,o)}createBucket(n){return new jo(n)}queryRadius(n){const e=n;return Jd("circle-radius",this,e)+Jd("circle-stroke-width",this,e)+qf(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,r,o,a,u,h,g){const v=Hf(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,n.pixelToTileUnitsFactor),x=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return V0(n,o,u,h,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",v,x)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,e,r){const o=j0(this);return{config:new ro(this,{zoom:e,lut:r}),defines:o,overrideFog:!1}}is3D(n){return!n&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Vs{createBucket(n){return new $0(n)}constructor(n,e,r,o){super(n,{layout:G0||(G0=new fi({visibility:new gt(ke.layout_heatmap.visibility)})),paint:q0||(q0=new fi({"heatmap-radius":new It(ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new It(ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new gt(ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Al(ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new gt(ke.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,r,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Sm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return Jd("heatmap-radius",this,n)}queryIntersectsFeature(n,e,r,o,a,u,h,g){const v=this.paint.get("heatmap-radius").evaluate(e,r);return V0(n,o,u,h,g,!0,!0,new ft(0,0),v)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,e,r){return n==="heatmap"?{config:new ro(this,{zoom:e,lut:r}),overrideFog:!1}:{}}},hillshade:class extends Vs{constructor(n,e,r,o){super(n,{layout:H0||(H0=new fi({visibility:new gt(ke.layout_hillshade.visibility)})),paint:W0||(W0=new fi({"hillshade-illumination-direction":new gt(ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new gt(ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new gt(ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new gt(ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new gt(ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new gt(ke.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new gt(ke.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,r,o)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,e,r){return{overrideFog:!1}}},fill:class extends Vs{constructor(n,e,r,o){super(n,{layout:l1||(l1=new fi({"fill-sort-key":new It(ke.layout_fill["fill-sort-key"]),visibility:new gt(ke.layout_fill.visibility),"fill-elevation-reference":new gt(ke.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new It(ke.layout_fill["fill-construct-bridge-guard-rail"])})),paint:c1||(c1=new fi({"fill-antialias":new gt(ke.paint_fill["fill-antialias"]),"fill-opacity":new It(ke.paint_fill["fill-opacity"]),"fill-color":new It(ke.paint_fill["fill-color"]),"fill-outline-color":new It(ke.paint_fill["fill-outline-color"]),"fill-translate":new gt(ke.paint_fill["fill-translate"]),"fill-translate-anchor":new gt(ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new It(ke.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new gt(ke.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new gt(ke.paint_fill["fill-emissive-strength"]),"fill-z-offset":new It(ke.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new It(ke.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new It(ke.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,r,o)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(n,e,r){return{config:new ro(this,{zoom:e,lut:r}),overrideFog:!1}}recalculate(n,e){super.recalculate(n,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new My(n)}queryRadius(){return qf(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,r,o,a,u){return!n.queryGeometry.isAboveHorizon&&Vo(Dp(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,n.pixelToTileUnitsFactor),o)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(n){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return n!=null?e&&!n:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Vs{constructor(n,e,r,o){super(n,{layout:D1||(D1=new fi({visibility:new gt(ke["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new gt(ke["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:L1||(L1=new fi({"fill-extrusion-opacity":new gt(ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new It(ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new gt(ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new gt(ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new It(ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new gt(ke["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new It(ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new It(ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new gt(ke["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new gt(ke["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new gt(ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new gt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new gt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new gt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new gt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new gt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new gt(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new gt(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new It(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new It(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new gt(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new gt(ke["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new gt(ke["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new gt(ke["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new It(ke["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new It(ke["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new gt(ke["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,r,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new Ug(n)}queryRadius(){return qf(this.paint.get("fill-extrusion-translate"))}is3D(n){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,e,r,o,a,u,h,g,v){const x=Hf(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,n.pixelToTileUnitsFactor),E=this.paint.get("fill-extrusion-height").evaluate(e,r),A=this.paint.get("fill-extrusion-base").evaluate(e,r),C=[0,0],k=g&&u.elevation,L=u.elevation?u.elevation.exaggeration():1,j=n.tile.getBucket(this);if(k&&j instanceof Ug){const U=j.centroidVertexArray,ee=v+1;ee<U.length&&(C[0]=U.geta_centroid_pos0(ee),C[1]=U.geta_centroid_pos1(ee))}if(C[0]===0&&C[1]===1)return!1;u.projection.name==="globe"&&(o=k1([o],[new ft(0,0),new ft(Ct,Ct)],n.tileID.canonical).map(U=>U.polygon).flat());const G=k?g:null,[K,te]=function(U,ee,ie,ae,Te,ve,Ee,Re,He,ht,it){return U.projection.name==="globe"?function(ut,mt,Ze,lt,qe,We,xt,bt,ir,qt,zt){const yt=[],wr=[],Gt=ut.projection.upVectorScale(zt,ut.center.lat,ut.worldSize).metersToTile,Zt=[0,0,0,1],pr=[0,0,0,1],Fr=(Zr,jr,Xr,Dn)=>{Zr[0]=jr,Zr[1]=Xr,Zr[2]=Dn,Zr[3]=1},kr=z1();Ze>0&&(Ze+=kr),lt+=kr;for(const Zr of mt){const jr=[],Xr=[];for(const Dn of Zr){const ni=Dn.x+qe.x,oe=Dn.y+qe.y,fe=ut.projection.projectTilePoint(ni,oe,zt),Ke=ut.projection.upVector(zt,Dn.x,Dn.y);let St=Ze,kt=lt;if(xt){const Rt=V1(ni,oe,Ze,lt,xt,bt,ir,qt);St+=Rt.base,kt+=Rt.top}Ze!==0?Fr(Zt,fe.x+Ke[0]*Gt*St,fe.y+Ke[1]*Gt*St,fe.z+Ke[2]*Gt*St):Fr(Zt,fe.x,fe.y,fe.z),Fr(pr,fe.x+Ke[0]*Gt*kt,fe.y+Ke[1]*Gt*kt,fe.z+Ke[2]*Gt*kt),Ar(Zt,Zt,We),Ar(pr,pr,We),jr.push(new Kf(Zt[0],Zt[1],Zt[2])),Xr.push(new Kf(pr[0],pr[1],pr[2]))}yt.push(jr),wr.push(Xr)}return[yt,wr]}(U,ee,ie,ae,Te,ve,Ee,Re,He,ht,it):Ee?function(ut,mt,Ze,lt,qe,We,xt,bt,ir){const qt=[],zt=[],yt=[0,0,0,1];for(const wr of ut){const Gt=[],Zt=[];for(const pr of wr){const Fr=pr.x+lt.x,kr=pr.y+lt.y,Zr=V1(Fr,kr,mt,Ze,We,xt,bt,ir);yt[0]=Fr,yt[1]=kr,yt[2]=Zr.base,yt[3]=1,ds(yt,yt,qe),yt[3]=Math.max(yt[3],1e-5);const jr=new Kf(yt[0]/yt[3],yt[1]/yt[3],yt[2]/yt[3]);yt[0]=Fr,yt[1]=kr,yt[2]=Zr.top,yt[3]=1,ds(yt,yt,qe),yt[3]=Math.max(yt[3],1e-5);const Xr=new Kf(yt[0]/yt[3],yt[1]/yt[3],yt[2]/yt[3]);Gt.push(jr),Zt.push(Xr)}qt.push(Gt),zt.push(Zt)}return[qt,zt]}(ee,ie,ae,Te,ve,Ee,Re,He,ht):function(ut,mt,Ze,lt,qe){const We=[],xt=[],bt=qe[8]*mt,ir=qe[9]*mt,qt=qe[10]*mt,zt=qe[11]*mt,yt=qe[8]*Ze,wr=qe[9]*Ze,Gt=qe[10]*Ze,Zt=qe[11]*Ze;for(const pr of ut){const Fr=[],kr=[];for(const Zr of pr){const jr=Zr.x+lt.x,Xr=Zr.y+lt.y,Dn=qe[0]*jr+qe[4]*Xr+qe[12],ni=qe[1]*jr+qe[5]*Xr+qe[13],oe=qe[2]*jr+qe[6]*Xr+qe[14],fe=qe[3]*jr+qe[7]*Xr+qe[15],Ke=Dn+bt,St=ni+ir,kt=oe+qt,Rt=Math.max(fe+zt,1e-5),Ut=Dn+yt,fr=ni+wr,an=oe+Gt,ln=Math.max(fe+Zt,1e-5);Fr.push(new Kf(Ke/Rt,St/Rt,kt/Rt)),kr.push(new Kf(Ut/ln,fr/ln,an/ln))}We.push(Fr),xt.push(kr)}return[We,xt]}(ee,ie,ae,Te,ve)}(u,o,A,E,x,h,G,C,L,u.center.lat,n.tileID.canonical),ne=n.queryGeometry;return function(U,ee,ie){let ae=1/0;Vo(ie,ee)&&(ae=j1(ie,ee[0]));for(let Te=0;Te<ee.length;Te++){const ve=ee[Te],Ee=U[Te];for(let Re=0;Re<ve.length-1;Re++){const He=ve[Re],ht=[He,ve[Re+1],Ee[Re+1],Ee[Re],He];To(ie,ht)&&(ae=Math.min(ae,j1(ie,ht)))}}return ae!==1/0&&ae}(K,te,ne.isPointQuery()?ne.screenBounds:ne.screenGeometry)}},building:class extends Vs{constructor(n,e,r,o){super(n,{layout:Q1||(Q1=new fi({visibility:new gt(ke.layout_building.visibility),"building-roof-shape":new It(ke.layout_building["building-roof-shape"]),"building-height":new It(ke.layout_building["building-height"]),"building-base":new It(ke.layout_building["building-base"])})),paint:ew||(ew=new fi({"building-opacity":new gt(ke.paint_building["building-opacity"]),"building-ambient-occlusion-wall-intensity":new gt(ke.paint_building["building-ambient-occlusion-wall-intensity"]),"building-ambient-occlusion-ground-intensity":new gt(ke.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new gt(ke.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new gt(ke.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new gt(ke.paint_building["building-vertical-scale"]),"building-cast-shadows":new gt(ke.paint_building["building-cast-shadows"]),"building-color":new It(ke.paint_building["building-color"]),"building-emissive-strength":new It(ke.paint_building["building-emissive-strength"]),"building-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,r,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new J1(n)}},line:class extends Vs{constructor(n,e,r,o){const a=uw();super(n,a,e,r,o),a.layout&&(this.layout=new Pa(a.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof $a,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=(()=>{if(Nm)return Nm;const r=uw();return Nm=new pC(r.paint.properties["line-width"].specification),Nm.useIntegerZoom=!0,Nm})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new Uy(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,e,r){const o=lw(this);return{config:new ro(this,{zoom:e,lut:r}),defines:o,overrideFog:!1}}queryRadius(n){const e=n,r=hw(Jd("line-width",this,e),Jd("line-gap-width",this,e)),o=Jd("line-offset",this,e);return r/2+Math.abs(o)+qf(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,r,o,a,u){if(n.queryGeometry.isAboveHorizon)return!1;const h=Dp(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,n.pixelToTileUnitsFactor),g=n.pixelToTileUnitsFactor/2*hw(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),v=this.paint.get("line-offset").evaluate(e,r);return v&&(o=function(x,E){const A=[],C=new ft(0,0);for(let k=0;k<x.length;k++){const L=x[k],j=[];for(let G=0;G<L.length;G++){const K=L[G],te=L[G+1],ne=G===0?C:K.sub(L[G-1])._unit()._perp(),U=G===L.length-1?C:te.sub(K)._unit()._perp(),ee=ne._add(U)._unit();ee._mult(1/(ee.x*U.x+ee.y*U.y)),j.push(ee._mult(E)._add(K))}A.push(j)}return A}(o,v*n.pixelToTileUnitsFactor)),function(x,E,A){for(let C=0;C<E.length;C++){const k=E[C];if(x.length>=3){for(let L=0;L<k.length;L++)if(Da(x,k[L]))return!0}if(Uo(x,k,A))return!0}return!1}(h,o,g)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(n){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:c_,background:class extends Vs{constructor(n,e,r,o){super(n,{layout:tb||(tb=new fi({visibility:new gt(ke.layout_background.visibility)})),paint:rb||(rb=new fi({"background-pitch-alignment":new gt(ke.paint_background["background-pitch-alignment"]),"background-color":new gt(ke.paint_background["background-color"]),"background-pattern":new gt(ke.paint_background["background-pattern"]),"background-opacity":new gt(ke.paint_background["background-opacity"]),"background-emissive-strength":new gt(ke.paint_background["background-emissive-strength"]),"background-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,r,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,e,r){return{overrideFog:!1}}is3D(n){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:ab,"raster-particle":fb,sky:class extends Vs{constructor(n,e,r,o){super(n,{layout:ub||(ub=new fi({visibility:new gt(ke.layout_sky.visibility)})),paint:hb||(hb=new fi({"sky-type":new gt(ke.paint_sky["sky-type"]),"sky-atmosphere-sun":new gt(ke.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new gt(ke.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new gt(ke.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new gt(ke.paint_sky["sky-gradient-radius"]),"sky-gradient":new Al(ke.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new gt(ke.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new gt(ke.paint_sky["sky-atmosphere-color"]),"sky-opacity":new gt(ke.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,r,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Sm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),a=!o,u=n.style.light,h=u.properties.get("position");return a&&u.properties.get("anchor")==="viewport"&&Rr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?hv(h.azimuthal,90-h.polar,e):hv(o[0],90-o[1],e)}const r=this.paint.get("sky-gradient-center");return hv(r[0],90-r[1],e)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}},slot:class extends Vs{constructor(n,e,r,o){super(n,{paint:db||(db=new fi({}))},e,null)}},model:class extends Vs{constructor(n,e,r,o){super(n,{layout:bb||(bb=new fi({visibility:new gt(ke.layout_model.visibility),"model-id":new It(ke.layout_model["model-id"])})),paint:Tb||(Tb=new fi({"model-opacity":new It(ke.paint_model["model-opacity"]),"model-rotation":new It(ke.paint_model["model-rotation"]),"model-scale":new It(ke.paint_model["model-scale"]),"model-translation":new It(ke.paint_model["model-translation"]),"model-color":new It(ke.paint_model["model-color"]),"model-color-mix-intensity":new It(ke.paint_model["model-color-mix-intensity"]),"model-type":new gt(ke.paint_model["model-type"]),"model-cast-shadows":new gt(ke.paint_model["model-cast-shadows"]),"model-receive-shadows":new gt(ke.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new gt(ke.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new It(ke.paint_model["model-emissive-strength"]),"model-roughness":new It(ke.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new It(ke.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new gt(ke.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new gt(ke.paint_model["model-front-cutoff"]),"model-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,r,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new mv(n)}getProgramIds(){return["model"]}is3D(n){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(n){return n instanceof __?Ct-1:0}queryIntersectsFeature(n,e,r,o,a,u){if(!this.modelManager)return!1;const h=this.modelManager,g=n.tile.getBucket(this);if(!(g&&g instanceof mv))return!1;for(const v in g.instancesPerModel){const x=g.instancesPerModel[v],E=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(x.idToFeaturesIndex.hasOwnProperty(E)){const A=x.features[x.idToFeaturesIndex[E]],C=h.getModel(v,this.scope);if(!C)return!1;let k=Xt();const L=new J(0,0),j=g.canonical;let G=Number.MAX_VALUE;for(let K=0;K<A.instancedDataCount;++K){const te=16*(A.instancedDataOffset+K),ne=x.instancedDataArray.float32,U=[ne[te+4],ne[te+5],ne[te+6]];Mb(j,L,ne[te],0|ne[te+1]),Sb(k,C,u,L,A.rotation,A.scale,U,!1,!1,!1),u.projection.name==="globe"&&(k=fv(k,u));const ee=Tt([],u.projMatrix,k),ie=n.queryGeometry,ae=yb(ie.isPointQuery()?ie.screenBounds:ie.screenGeometry,u,ee,C.aabb);ae!=null&&(G=Math.min(ae,G))}return G!==Number.MAX_VALUE&&G}}return!1}_handleOverridablePaintPropertyUpdate(n,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven()||n!=="model-color"&&n!=="model-color-mix-intensity"&&n!=="model-rotation"&&n!=="model-scale"&&n!=="model-translation"&&n!=="model-emissive-strength")}_isPropertyZoomDependent(n){const e=this._transitionablePaint._values[n];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof uc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Vs{constructor(n,e,r,o){super(n,{layout:u1||(u1=new fi({"clip-layer-types":new gt(ke.layout_clip["clip-layer-types"]),"clip-layer-scope":new gt(ke.layout_clip["clip-layer-scope"])})),paint:h1||(h1=new fi({}))},e,r,o)}recalculate(n,e){super.recalculate(n,e)}createBucket(n){return new d1(n)}is3D(n){return!0}}},vv=new _n(0,0,0),xv={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},wv={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},y_={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},yM={PAINT_ORDER_FILL_AND_STROKE:1},Km={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},Pb={MASK_TYPE_LUMINANCE:1};function vM(n,e,r){n===1&&e.icons.push(function(o,a){return function(u){if(u.usvg_tree.height||(u.usvg_tree.height=u.usvg_tree.width),!u.metadata)return u;const{metadata:h}=u;if(h.content_area){const{content_area:g}=h;g.top==null&&(g.top=g.left),g.width==null&&(g.width=u.usvg_tree.width),g.height==null&&(g.height=g.width)}return h.stretch_x&&h.stretch_x.length&&Rb(h,"x"),h.stretch_y&&h.stretch_y.length&&Rb(h,"y"),u}(o.readFields(xM,{name:void 0},a))}(r,r.readVarint()+r.pos))}function Rb(n,e){const r=[],o=n[`stretch_${e}`];let a=null;for(let u=0;u<o.length;u++)a===null?a=r.length===0?o[0]:r[r.length-1][1]+o[u]:(r.push([a,a+o[u]]),a=null);n[`stretch_${e}_areas`]=r}function xM(n,e,r){n===1?e.name=r.readString():n===2?e.metadata=function(o,a){return o.readFields(wM,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},a)}(r,r.readVarint()+r.pos):n===3&&(e.usvg_tree=function(o,a){return o.readFields(SM,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},a)}(r,r.readVarint()+r.pos),e.data="usvg_tree")}function wM(n,e,r){n===1?e.stretch_x=r.readPackedVarint():n===2?e.stretch_y=r.readPackedVarint():n===3?e.content_area=function(o,a){return o.readFields(bM,{left:0},a)}(r,r.readVarint()+r.pos):n===4&&e.variables.push(function(o,a){return o.readFields(TM,{name:void 0},a)}(r,r.readVarint()+r.pos))}function bM(n,e,r){n===1?e.left=r.readVarint():n===2?e.width=r.readVarint():n===3?e.top=r.readVarint():n===4&&(e.height=r.readVarint())}function TM(n,e,r){n===1?e.name=r.readString():n===2&&(e.rgb_color=w_(r.readVarint()),e.value="rgb_color")}function SM(n,e,r){n===1?e.width=e.height=r.readVarint():n===2?e.height=r.readVarint():n===3?e.children.push(v_(r,r.readVarint()+r.pos)):n===4?e.linear_gradients.push(function(o,a){return o.readFields(RM,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},a)}(r,r.readVarint()+r.pos)):n===5?e.radial_gradients.push(function(o,a){return o.readFields(kM,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},a)}(r,r.readVarint()+r.pos)):n===7?e.clip_paths.push(function(o,a){return o.readFields(DM,{children:[]},a)}(r,r.readVarint()+r.pos)):n===8&&e.masks.push(function(o,a){const u=o.readFields(LM,{left:0,width:20,mask_type:Pb.MASK_TYPE_LUMINANCE,children:[]},a);return u.height==null&&(u.height=u.width),u.top==null&&(u.top=u.left),u}(r,r.readVarint()+r.pos))}function v_(n,e){return n.readFields(EM,{},e)}function EM(n,e,r){n===1?(e.group=function(o,a){return o.readFields(IM,{opacity:255,children:[]},a)}(r,r.readVarint()+r.pos),e.node="group"):n===2&&(e.path=function(o,a){return o.readFields(CM,{paint_order:1,commands:[],step:1,diffs:[],rule:xv.PATH_RULE_NON_ZERO},a)}(r,r.readVarint()+r.pos),e.node="path")}function IM(n,e,r){n===1?e.transform=x_(r,r.readVarint()+r.pos):n===2?e.opacity=r.readVarint():n===5?e.clip_path_idx=r.readVarint():n===6?e.mask_idx=r.readVarint():n===7&&e.children.push(v_(r,r.readVarint()+r.pos))}function x_(n,e){return n.readFields(AM,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function AM(n,e,r){n===1?e.sx=r.readFloat():n===2?e.ky=r.readFloat():n===3?e.kx=r.readFloat():n===4?e.sy=r.readFloat():n===5?e.tx=r.readFloat():n===6&&(e.ty=r.readFloat())}function CM(n,e,r){n===1?e.fill=function(o,a){return o.readFields(MM,{rgb_color:vv,paint:"rgb_color",opacity:255},a)}(r,r.readVarint()+r.pos):n===2?e.stroke=function(o,a){return o.readFields(PM,{rgb_color:vv,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},a)}(r,r.readVarint()+r.pos):n===3?e.paint_order=r.readVarint():n===5?r.readPackedVarint(e.commands):n===6?e.step=r.readFloat():n===7?r.readPackedSVarint(e.diffs):n===8&&(e.rule=r.readVarint())}function MM(n,e,r){n===1?(e.rgb_color=w_(r.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):n===5&&(e.opacity=r.readVarint())}function w_(n){return new _n((n>>16&255)/255,(n>>8&255)/255,(255&n)/255,1)}function PM(n,e,r){n===1?(e.rgb_color=w_(r.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):n===5?r.readPackedFloat(e.dasharray):n===6?e.dashoffset=r.readFloat():n===7?e.miterlimit=r.readFloat():n===8?e.opacity=r.readVarint():n===9?e.width=r.readFloat():n===10?e.linecap=r.readVarint():n===11&&(e.linejoin=r.readVarint())}function RM(n,e,r){n===1?e.transform=x_(r,r.readVarint()+r.pos):n===2?e.spread_method=r.readVarint():n===3?e.stops.push(zb(r,r.readVarint()+r.pos)):n===4?e.x1=r.readFloat():n===5?e.y1=r.readFloat():n===6?e.x2=r.readFloat():n===7&&(e.y2=r.readFloat())}function zb(n,e){return n.readFields(zM,{offset:0,opacity:255,rgb_color:vv},e)}function zM(n,e,r){n===1?e.offset=r.readFloat():n===2?e.opacity=r.readVarint():n===3&&(e.rgb_color=w_(r.readVarint()))}function kM(n,e,r){n===1?e.transform=x_(r,r.readVarint()+r.pos):n===2?e.spread_method=r.readVarint():n===3?e.stops.push(zb(r,r.readVarint()+r.pos)):n===4?e.cx=r.readFloat():n===5?e.cy=r.readFloat():n===6?e.r=r.readFloat():n===7?e.fx=r.readFloat():n===8?e.fy=r.readFloat():n===9&&(e.fr=r.readFloat())}function DM(n,e,r){n===1?e.transform=x_(r,r.readVarint()+r.pos):n===2?e.clip_path_idx=r.readVarint():n===3&&e.children.push(v_(r,r.readVarint()+r.pos))}function LM(n,e,r){n===1?e.left=e.top=r.readFloat():n===2?e.width=e.height=r.readFloat():n===3?e.top=r.readFloat():n===4?e.height=r.readFloat():n===5?e.mask_type=r.readVarint():n===6?e.mask_idx=r.readVarint():n===7&&e.children.push(v_(r,r.readVarint()+r.pos))}class OM{static calculate(e={},r=[]){const o=new Map,a=new Map;if(Object.keys(e).length===0)return o;r.forEach(u=>{a.set(u.name,u.rgb_color||new _n(0,0,0))});for(const[u,h]of Object.entries(e))a.has(u)?o.set(a.get(u).toString(),h):console.warn(`Ignoring unknown image variable "${u}"`);return o}}function Zp(n,e=255,r){const o=e/255,a=n.toString(),u=r.has(a)?r.get(a).clone():n.clone();return u.a*=o,u.toString()}function Jm(n,e){if(!_u()){const r=document.createElement("canvas");return r.width=n,r.height=e,r}return new OffscreenCanvas(n,e)}function FM(n,e){const r=OM.calculate(e.params,n.metadata?n.metadata.variables:[]),o=n.usvg_tree,a=o.width,u=o.height,h=e.transform?e.transform:new DOMMatrix,g=Math.max(1,Math.round(a*h.a)),v=Math.max(1,Math.round(u*h.d)),x=new DOMMatrix([g/a,0,0,v/u,0,0]),E=Jm(g,v).getContext("2d");return bv(E,x,o,o,r),E.getImageData(0,0,g,v)}function bv(n,e,r,o,a){for(const u of o.children)kb(n,e,r,u,a)}function kb(n,e,r,o,a){o.group?(n.save(),function(u,h,g,v,x){const E=v.mask_idx!=null?g.masks[v.mask_idx]:null,A=v.clip_path_idx!=null?g.clip_paths[v.clip_path_idx]:null;if(v.transform&&(h=Xp(v.transform).preMultiplySelf(h)),!function(L,j,G){return L.opacity!==255||j||G}(v,A!=null,E!=null))return void bv(u,h,g,v,x);const C=Jm(u.canvas.width,u.canvas.height),k=C.getContext("2d");bv(k,h,g,v,x),A&&jb(k,h,g,A),E&&Vb(k,h,g,E,x),u.globalAlpha=v.opacity/255,u.drawImage(C,0,0)}(n,e,r,o.group,a),n.restore()):o.path&&(n.save(),function(u,h,g,v,x){u.setTransform(h),v.paint_order===yM.PAINT_ORDER_FILL_AND_STROKE?(Db(u,g,v,x),Ob(u,g,v,x)):(Ob(u,g,v,x),Db(u,g,v,x))}(n,e,r,o.path,a),n.restore())}function Db(n,e,r,o){const a=r.fill;if(!a)return;const u=a.opacity/255;switch(n.save(),n.beginPath(),Ub(r,n),a.paint){case"rgb_color":n.fillStyle=Zp(a.rgb_color,a.opacity,o);break;case"linear_gradient_idx":{const h=e.linear_gradients[a.linear_gradient_idx];h.transform&&n.setTransform(Xp(h.transform).preMultiplySelf(n.getTransform())),n.fillStyle=Fb(n,h,u,o);break}case"radial_gradient_idx":{const h=e.radial_gradients[a.radial_gradient_idx];h.transform&&n.setTransform(Xp(h.transform).preMultiplySelf(n.getTransform())),n.fillStyle=Nb(n,h,u,o)}}n.fill(Lb(r)),n.restore()}function Lb(n){return n.rule===xv.PATH_RULE_NON_ZERO?"nonzero":n.rule===xv.PATH_RULE_EVEN_ODD?"evenodd":void 0}function Ob(n,e,r,o){const a=r.stroke;if(!a)return;const u=$b(r);n.lineWidth=a.width,n.miterLimit=a.miterlimit,n.setLineDash(a.dasharray),n.lineDashOffset=a.dashoffset;const h=a.opacity/255;switch(a.paint){case"rgb_color":n.strokeStyle=Zp(a.rgb_color,a.opacity,o);break;case"linear_gradient_idx":n.strokeStyle=Fb(n,e.linear_gradients[a.linear_gradient_idx],h,o,!0);break;case"radial_gradient_idx":n.strokeStyle=Nb(n,e.radial_gradients[a.radial_gradient_idx],h,o,!0)}switch(a.linejoin){case y_.LINE_JOIN_MITER_CLIP:case y_.LINE_JOIN_MITER:n.lineJoin="miter";break;case y_.LINE_JOIN_ROUND:n.lineJoin="round";break;case y_.LINE_JOIN_BEVEL:n.lineJoin="bevel"}switch(a.linecap){case wv.LINE_CAP_BUTT:n.lineCap="butt";break;case wv.LINE_CAP_ROUND:n.lineCap="round";break;case wv.LINE_CAP_SQUARE:n.lineCap="square"}n.stroke(u)}function Fb(n,e,r,o,a=!1){if(e.stops.length===1){const C=e.stops[0];return Zp(C.rgb_color,C.opacity*r,o)}const{x1:u,y1:h,x2:g,y2:v}=e;let x=new DOMPoint(u,h),E=new DOMPoint(g,v);if(a){const C=Xp(e.transform);x=C.transformPoint(x),E=C.transformPoint(E)}const A=n.createLinearGradient(x.x,x.y,E.x,E.y);for(const C of e.stops)A.addColorStop(C.offset,Zp(C.rgb_color,C.opacity*r,o));return A}function Nb(n,e,r,o,a=!1){if(e.stops.length===1){const K=e.stops[0];return Zp(K.rgb_color,K.opacity*r,o)}const u=Xp(e.transform),{fx:h,fy:g,fr:v,cx:x,cy:E,r:A}=e;let C=new DOMPoint(h,g),k=new DOMPoint(x,E),L=v,j=A;if(a){C=u.transformPoint(C),k=u.transformPoint(k);const K=(u.a+u.d)/2;L=v*K,j=e.r*K}const G=n.createRadialGradient(C.x,C.y,L,k.x,k.y,j);for(const K of e.stops)G.addColorStop(K.offset,Zp(K.rgb_color,K.opacity*r,o));return G}function Bb(n,e,r,o){const a=o.transform?Xp(o.transform).preMultiplySelf(e):e,u=Jm(n.canvas.width,n.canvas.height),h=u.getContext("2d");for(const v of o.children)if(v.group)Bb(h,a,r,v.group);else if(v.path){const x=v.path,E=new Path2D;E.addPath($b(x),a),h.fill(E,Lb(x))}const g=o.clip_path_idx!=null?r.clip_paths[o.clip_path_idx]:null;g&&jb(h,a,r,g),n.globalCompositeOperation="source-over",n.drawImage(u,0,0)}function jb(n,e,r,o){const a=Jm(n.canvas.width,n.canvas.height);Bb(a.getContext("2d"),e,r,o),n.globalCompositeOperation="destination-in",n.drawImage(a,0,0)}function Vb(n,e,r,o,a){if(o.children.length===0)return;const u=o.mask_idx!=null?r.masks[o.mask_idx]:null;u&&Vb(n,e,r,u,a);const h=n.canvas.width,g=n.canvas.height,v=Jm(h,g),x=v.getContext("2d"),E=o.width,A=o.height,C=o.left,k=o.top,L=new Path2D,j=new Path2D;j.rect(C,k,E,A),L.addPath(j,e),x.clip(L);for(const te of o.children)kb(x,e,r,te,a);const G=x.getImageData(0,0,h,g),K=G.data;if(o.mask_type===Pb.MASK_TYPE_LUMINANCE)for(let te=0;te<K.length;te+=4)K[te+3]=K[te+3]/255*(.2126*K[te]+.7152*K[te+1]+.0722*K[te+2]);x.putImageData(G,0,0),n.globalCompositeOperation="destination-in",n.drawImage(v,0,0)}function Xp(n){return n?new DOMMatrix([n.sx,n.ky,n.kx,n.sy,n.tx,n.ty]):new DOMMatrix}function Ub(n,e){const r=n.step;let o=n.diffs[0]*r,a=n.diffs[1]*r;e.moveTo(o,a);for(let u=0,h=2;u<n.commands.length;u++)switch(n.commands[u]){case Km.PATH_COMMAND_MOVE:o+=n.diffs[h++]*r,a+=n.diffs[h++]*r,e.moveTo(o,a);break;case Km.PATH_COMMAND_LINE:o+=n.diffs[h++]*r,a+=n.diffs[h++]*r,e.lineTo(o,a);break;case Km.PATH_COMMAND_QUAD:{const g=o+n.diffs[h++]*r,v=a+n.diffs[h++]*r;o=g+n.diffs[h++]*r,a=v+n.diffs[h++]*r,e.quadraticCurveTo(g,v,o,a);break}case Km.PATH_COMMAND_CUBIC:{const g=o+n.diffs[h++]*r,v=a+n.diffs[h++]*r,x=g+n.diffs[h++]*r,E=v+n.diffs[h++]*r;o=x+n.diffs[h++]*r,a=E+n.diffs[h++]*r,e.bezierCurveTo(g,v,x,E,o,a);break}case Km.PATH_COMMAND_CLOSE:e.closePath()}return e}function $b(n){return Ub(n,new Path2D)}class b_{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const r=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,r),r}put(e,r){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,r)}delete(e){this.cache.delete(e)}}Ft(b_,"LRUCache");class Tv{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new so(e,e.data)}getFromCache(e,r,o){return this.cacheMap.has(o)||this.cacheMap.set(o,new b_(150)),this.cacheMap.get(o).get(el(e.toString(),r))}setInCache(e,r,o,a){this.cacheDependenciesMap.has(a)||this.cacheDependenciesMap.set(a,new Map),this.cacheMap.has(a)||this.cacheMap.set(a,new b_(150));const u=this.cacheDependenciesMap.get(a),h=el(e.id.toString(),o);u.get(h)||u.set(h,new Set);const g=this.cacheMap.get(a),v=e.toString();u.get(h).add(v),g.put(el(e.toString(),o),r)}removeImagesFromCacheByIds(e,r,o=0){if(!this.cacheMap.has(o)||!this.cacheDependenciesMap.has(o))return;const a=this.cacheMap.get(o),u=this.cacheDependenciesMap.get(o);for(const h of e){const g=el(h.toString(),r);if(u.has(g)){for(const v of u.get(g))a.delete(v);u.delete(g)}}}rasterize(e,r,o,a,u=FM){const h=this.getFromCache(e,o,a);if(h)return h.clone();const g=u(r.icon,e.options),v=Tv._getImage(g);return this.setInCache(e,v,o,a),v.clone()}}class Gb{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const o=this.toIdx(e,r);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function qb(n,e,r,o){let a=0,u=Number.MAX_VALUE;for(let h=0;h<3;h++)if(Math.abs(o[h])<1e-15){if(r[h]<n[h]||r[h]>e[h])return null}else{const g=1/o[h];let v=(n[h]-r[h])*g,x=(e[h]-r[h])*g;if(v>x){const E=v;v=x,x=E}if(v>a&&(a=v),x<u&&(u=x),a>u)return null}return a}function Hb(n,e,r,o,a,u,h,g,v,x,E){const A=o-n,C=a-e,k=u-r,L=h-n,j=g-e,G=v-r,K=E[1]*G-E[2]*j,te=E[2]*L-E[0]*G,ne=E[0]*j-E[1]*L,U=A*K+C*te+k*ne;if(Math.abs(U)<1e-15)return null;const ee=1/U,ie=x[0]-n,ae=x[1]-e,Te=x[2]-r,ve=(ie*K+ae*te+Te*ne)*ee;if(ve<0||ve>1)return null;const Ee=ae*k-Te*C,Re=Te*A-ie*k,He=ie*C-ae*A,ht=(E[0]*Ee+E[1]*Re+E[2]*He)*ee;return ht<0||ve+ht>1?null:(L*Ee+j*Re+G*He)*ee}function Wb(n,e,r){return(n-e)/(r-e)}function Zb(n,e,r,o,a,u,h,g,v){const x=1<<r,E=u-o,A=h-a,C=(n+1)/x*E+o,k=(e+0)/x*A+a,L=(e+1)/x*A+a;g[0]=(n+0)/x*E+o,g[1]=k,v[0]=C,v[1]=L}class Xb{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(u){const h=Math.ceil(Math.log2(u.dim/8)),g=[];let v=Math.ceil(Math.pow(2,h));const x=1/v,E=(k,L,j,G,K)=>{const te=G?1:0,ne=(k+1)*j-te,U=L*j,ee=(L+1)*j-te;K[0]=k*j,K[1]=U,K[2]=ne,K[3]=ee};let A=new Gb(v);const C=[];for(let k=0;k<v*v;k++){E(k%v,Math.floor(k/v),x,!1,C);const L=sf(C[0],C[1],u),j=sf(C[2],C[1],u),G=sf(C[2],C[3],u),K=sf(C[0],C[3],u);A.minimums.push(Math.min(L,j,G,K)),A.maximums.push(Math.max(L,j,G,K)),A.leaves.push(1)}for(g.push(A),v/=2;v>=1;v/=2){const k=g[g.length-1];A=new Gb(v);for(let L=0;L<v*v;L++){E(L%v,Math.floor(L/v),2,!0,C);const j=k.getElevation(C[0],C[1]),G=k.getElevation(C[2],C[1]),K=k.getElevation(C[2],C[3]),te=k.getElevation(C[0],C[3]),ne=k.isLeaf(C[0],C[1]),U=k.isLeaf(C[2],C[1]),ee=k.isLeaf(C[2],C[3]),ie=k.isLeaf(C[0],C[3]),ae=Math.min(j.min,G.min,K.min,te.min),Te=Math.max(j.max,G.max,K.max,te.max),ve=ne&&U&&ee&&ie;A.maximums.push(Te),A.minimums.push(ae),A.leaves.push(Te-ae<=5&&ve?1:0)}g.push(A)}return g}(this.dem),o=r.length-1,a=r[o];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(r,0,0,o,0)}raycastRoot(e,r,o,a,u,h,g=1){return qb([e,r,-100],[o,a,this.maximums[0]*g],u,h)}raycast(e,r,o,a,u,h,g=1){if(!this.nodeCount)return null;const v=this.raycastRoot(e,r,o,a,u,h,g);if(v==null)return null;const x=[],E=[],A=[],C=[],k=[{idx:0,t:v,nodex:0,nodey:0,depth:0}];for(;k.length>0;){const{idx:L,t:j,nodex:G,nodey:K,depth:te}=k.pop();if(this.leaves[L]){Zb(G,K,te,e,r,o,a,A,C);const U=1<<te,ee=(G+0)/U,ie=(G+1)/U,ae=(K+0)/U,Te=(K+1)/U,ve=sf(ee,ae,this.dem)*g,Ee=sf(ie,ae,this.dem)*g,Re=sf(ie,Te,this.dem)*g,He=sf(ee,Te,this.dem)*g,ht=Hb(A[0],A[1],ve,C[0],A[1],Ee,C[0],C[1],Re,u,h),it=Hb(C[0],C[1],Re,A[0],C[1],He,A[0],A[1],ve,u,h),ut=Math.min(ht!==null?ht:Number.MAX_VALUE,it!==null?it:Number.MAX_VALUE);if(ut!==Number.MAX_VALUE)return ut;{const mt=rt([],u,h,j);if(Yb(ve,Ee,He,Re,Wb(mt[0],A[0],C[0]),Wb(mt[1],A[1],C[1]))>=mt[2])return j}continue}let ne=0;for(let U=0;U<this._siblingOffset.length;U++){Zb((G<<1)+this._siblingOffset[U][0],(K<<1)+this._siblingOffset[U][1],te+1,e,r,o,a,A,C),A[2]=-100,C[2]=this.maximums[this.childOffsets[L]+U]*g;const ee=qb(A,C,u,h);if(ee!=null){const ie=ee;x[U]=ie;let ae=!1;for(let Te=0;Te<ne&&!ae;Te++)ie>=x[E[Te]]&&(E.splice(Te,0,U),ae=!0);ae||(E[ne]=U),ne++}}for(let U=0;U<ne;U++){const ee=E[U];k.push({idx:this.childOffsets[L]+ee,t:x[ee],nodex:(G<<1)+this._siblingOffset[ee][0],nodey:(K<<1)+this._siblingOffset[ee][1],depth:te+1})}}return null}_addNode(e,r,o){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,o,a,u){if(e[a].isLeaf(r,o)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const h=a-1,g=e[h];let v=0,x=0;for(let E=0;E<this._siblingOffset.length;E++){const A=2*r+this._siblingOffset[E][0],C=2*o+this._siblingOffset[E][1],k=g.getElevation(A,C),L=g.isLeaf(A,C),j=this._addNode(k.min,k.max,L);L&&(v|=1<<E),x||(x=j)}for(let E=0;E<this._siblingOffset.length;E++)v&1<<E||this._construct(e,2*r+this._siblingOffset[E][0],2*o+this._siblingOffset[E][1],h,x+E)}}function Yb(n,e,r,o,a,u){return lr(lr(n,r,u),lr(e,o,u),a)}function sf(n,e,r){const o=r.dim,a=me(n*o-.5,0,o-1),u=me(e*o-.5,0,o-1),h=Math.floor(a),g=Math.floor(u),v=Math.min(h+1,o-1),x=Math.min(g+1,o-1);return Yb(r.get(h,g),r.get(v,g),r.get(h,x),r.get(v,x),a-h,u-g)}const NM={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function BM(n,e,r){return(256*n*256+256*e+r)/10-1e4}function jM(n,e,r){return 256*n+e+r/256-32768}class T_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,o,a=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void Rr(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const u=this.dim=r.height-2,h=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=a,this._modifiedForSources={},!a){for(let v=0;v<u;v++)h[this._idx(-1,v)]=h[this._idx(0,v)],h[this._idx(u,v)]=h[this._idx(u-1,v)],h[this._idx(v,-1)]=h[this._idx(v,0)],h[this._idx(v,u)]=h[this._idx(v,u-1)];h[this._idx(-1,-1)]=h[this._idx(0,0)],h[this._idx(u,-1)]=h[this._idx(u-1,0)],h[this._idx(-1,u)]=h[this._idx(0,u-1)],h[this._idx(u,u)]=h[this._idx(u-1,u-1)]}const g=o==="terrarium"?jM:BM;for(let v=0;v<h.length;++v){const x=4*v;this.floatView[v]=g(this.pixels[x],this.pixels[x+1],this.pixels[x+2])}this._timestamp=ha.now()}_buildQuadTree(){this._tree=new Xb(this)}get(e,r,o=!1){o&&(e=me(e,-1,this.dim),r=me(r,-1,this.dim));const a=this._idx(e,r);return this.floatView[a]}set(e,r,o){const a=this._idx(e,r),u=this.floatView[a];return this.floatView[a]=o,o-u}static getUnpackVector(e){return NM[e]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const o=[0,0,0,0],a=T_.getUnpackVector(r);let u=Math.floor((e+a[3])/a[2]);return o[2]=u%256,u=Math.floor(u/256),o[1]=u%256,u=Math.floor(u/256),o[0]=u,o}getPixels(){return new Y0({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=r*this.dim,u=r*this.dim+this.dim,h=o*this.dim,g=o*this.dim+this.dim;switch(r){case-1:a=u-1;break;case 1:u=a+1}switch(o){case-1:h=g-1;break;case 1:g=h+1}const v=-r*this.dim,x=-o*this.dim;for(let E=h;E<g;E++)for(let A=a;A<u;A++){const C=4*this._idx(A,E),k=4*this._idx(A+v,E+x);this.pixels[C+0]=e.pixels[k+0],this.pixels[C+1]=e.pixels[k+1],this.pixels[C+2]=e.pixels[k+2],this.pixels[C+3]=e.pixels[k+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function VM(n,e,r){n===1?e.headerLength=r.readFixed32():n===2?e.x=r.readVarint():n===3?e.y=r.readVarint():n===4?e.z=r.readVarint():n===5&&e.layers.push(function(o,a){return o.readFields(HM,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},a)}(r,r.readVarint()+r.pos))}function UM(n,e,r){n===1?(e.delta_filter=function(o,a){return o.readFields($M,{blockSize:0},a)}(r,r.readVarint()+r.pos),e.filter="delta_filter"):n===2?(r.readVarint(),e.filter="zigzag_filter"):n===3?(r.readVarint(),e.filter="bitshuffle_filter"):n===4&&(r.readVarint(),e.filter="byteshuffle_filter")}function $M(n,e,r){n===1&&(e.blockSize=r.readVarint())}function GM(n,e,r){n===1?(r.readVarint(),e.codec="gzip_data"):n===2?(r.readVarint(),e.codec="jpeg_image"):n===3?(r.readVarint(),e.codec="webp_image"):n===4&&(r.readVarint(),e.codec="png_image")}function qM(n,e,r){let o=0,a=0;n===1?e.firstByte=r.readFixed64():n===2?e.lastByte=r.readFixed64():n===3?e.filters.push(function(u,h){return u.readFields(UM,{},h)}(r,r.readVarint()+r.pos)):n===4?e.codec=function(u,h){return u.readFields(GM,{},h)}(r,r.readVarint()+r.pos):n===5?a=r.readFloat():n===6?o=r.readFloat():n===7?e.bands.push(r.readString()):n===8?e.offset=r.readDouble():n===9&&(e.scale=r.readDouble()),e.offset===0&&(e.offset=a),e.scale===0&&(e.scale=o)}function HM(n,e,r){n===1?e.version=r.readVarint():n===2?e.name=r.readString():n===3?e.units=r.readString():n===4?e.tileSize=r.readVarint():n===5?e.buffer=r.readVarint():n===6?e.pixelFormat=r.readVarint():n===7&&e.dataIndex.push(function(o,a){return o.readFields(qM,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},a)}(r,r.readVarint()+r.pos))}function WM(n,e,r){if(n===2)(function(o,a,u){o.readFields(ZM,u,a)})(r,r.readVarint()+r.pos,e);else if(n===3)throw new Error("Not implemented")}function ZM(n,e,r){if(n===1){let o=0;const a=r.readVarint()+r.pos;for(;r.pos<a;)e[o++]=r.readVarint()}}function XM(n,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let r=e[3];for(let o=2;o>=1;o--){const a=o===1?1:0,u=o===2?1:0;for(let h=0;h<e[0];h++){const g=e[1]*h;for(let v=a;v<e[1];v++){const x=e[2]*(v+g);for(let E=u;E<e[2];E++){const A=e[3]*(E+x);for(let C=0;C<e[3];C++){const k=A+C;n[k]+=n[k-r]}}}}r*=e[o]}return n}function YM(n){for(let e=0,r=n.length;e<r;e++)n[e]=n[e]>>>1^-(1&n[e]);return n}function KM(n,e){switch(e){case"uint32":return n;case"uint16":for(let r=0;r<n.length;r+=2){const o=n[r],a=n[r+1];n[r]=(240&o)>>4|(61440&o)>>8|(240&a)<<4|61440&a,n[r+1]=15&o|(3840&o)>>4|(15&a)<<8|(3840&a)<<4}return n;case"uint8":for(let r=0;r<n.length;r+=4){const o=n[r],a=n[r+1],u=n[r+2],h=n[r+3];n[r+0]=(192&o)>>6|(192&a)>>4|(192&u)>>2|192&h,n[r+1]=(48&o)>>4|(48&a)>>2|48&u|(48&h)<<2,n[r+2]=(12&o)>>2|12&a|(12&u)<<2|(12&h)<<4,n[r+3]=3&o|(3&a)<<2|(3&u)<<4|(3&h)<<6}return n;default:throw new Error(`Invalid pixel format, "${e}"`)}}Ft(T_,"DEMData"),Ft(Xb,"DemMinMaxQuadTree",{omit:["dem"]});var Ol=Uint8Array,Qm=Uint16Array,JM=Int32Array,Kb=new Ol([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Jb=new Ol([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),QM=new Ol([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Qb=function(n,e){for(var r=new Qm(31),o=0;o<31;++o)r[o]=e+=1<<n[o-1];var a=new JM(r[30]);for(o=1;o<30;++o)for(var u=r[o];u<r[o+1];++u)a[u]=u-r[o]<<5|o;return{b:r,r:a}},e2=Qb(Kb,2),t2=e2.b,eP=e2.r;t2[28]=258,eP[258]=28;for(var tP=Qb(Jb,0).b,r2=new Qm(32768),ls=0;ls<32768;++ls){var Yp=(43690&ls)>>1|(21845&ls)<<1;r2[ls]=((65280&(Yp=(61680&(Yp=(52428&Yp)>>2|(13107&Yp)<<2))>>4|(3855&Yp)<<4))>>8|(255&Yp)<<8)>>1}var eg=function(n,e,r){for(var o=n.length,a=0,u=new Qm(e);a<o;++a)n[a]&&++u[n[a]-1];var h,g=new Qm(e);for(a=1;a<e;++a)g[a]=g[a-1]+u[a-1]<<1;h=new Qm(1<<e);var v=15-e;for(a=0;a<o;++a)if(n[a])for(var x=a<<4|n[a],E=e-n[a],A=g[n[a]-1]++<<E,C=A|(1<<E)-1;A<=C;++A)h[r2[A]>>v]=x;return h},tg=new Ol(288);for(ls=0;ls<144;++ls)tg[ls]=8;for(ls=144;ls<256;++ls)tg[ls]=9;for(ls=256;ls<280;++ls)tg[ls]=7;for(ls=280;ls<288;++ls)tg[ls]=8;var n2=new Ol(32);for(ls=0;ls<32;++ls)n2[ls]=5;var rP=eg(tg,9),nP=eg(n2,5),Sv=function(n){for(var e=n[0],r=1;r<n.length;++r)n[r]>e&&(e=n[r]);return e},pu=function(n,e,r){var o=e/8|0;return(n[o]|n[o+1]<<8)>>(7&e)&r},Ev=function(n,e){var r=e/8|0;return(n[r]|n[r+1]<<8|n[r+2]<<16)>>(7&e)},iP=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],mu=function(n,e,r){var o=new Error(e||iP[n]);if(o.code=n,Error.captureStackTrace&&Error.captureStackTrace(o,mu),!r)throw o;return o},sP=new Ol(0),oP=typeof TextDecoder<"u"&&new TextDecoder;try{oP.decode(sP,{stream:!0})}catch{}const aP={gzip_data:"gzip"};class wc extends Error{constructor(e){super(e),this.name="MRTError"}}const lP={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},i2={uint32:1,uint16:2,uint8:4},cP={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Iv;class S_{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const r=this.layers[e];if(!r)throw new wc(`Layer '${e}' not found`);return r}getHeaderLength(e){const r=new Uint8Array(e),o=new DataView(e);if(r[0]!==13)throw new wc("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){const r=new Uint8Array(e),o=this.getHeaderLength(e);if(r.length<o)throw new wc(`Expected header with length >= ${o} but got buffer of length ${r.length}`);const a=function(u,h){return u.readFields(VM,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new Iv(r.subarray(0,o)));if(!isNaN(this.x)&&(this.x!==a.x||this.y!==a.y||this.z!==a.z))throw new wc(`Invalid attempt to parse header ${a.z}/${a.x}/${a.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=a.x,this.y=a.y,this.z=a.z;for(const u of a.layers)this.layers[u.name]=new s2(u,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const r=[],o=this.getLayer(e.layerName);for(let a of e.blockIndices){const u=o.dataIndex[a],h=u.firstByte-e.firstByte,g=u.lastByte-e.firstByte;if(o._blocksInProgress.has(a))continue;const v={layerName:o.name,firstByte:h,lastByte:g,pixelFormat:o.pixelFormat,blockIndex:a,blockShape:[u.bands.length].concat(o.bandShape),buffer:o.buffer,codec:u.codec.codec,filters:u.filters.map(x=>x.filter)};o._blocksInProgress.add(a),r.push(v)}return new o2(r,()=>{r.forEach(a=>o._blocksInProgress.delete(a.blockIndex))},(a,u)=>{if(r.forEach(h=>o._blocksInProgress.delete(h.blockIndex)),a)throw a;u.forEach(h=>{this.getLayer(h.layerName).processDecodedData(h)})})}}class s2{constructor({version:e,name:r,units:o,tileSize:a,pixelFormat:u,buffer:h,dataIndex:g},v){if(this.version=e,this.version!==1)throw new wc(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=r,this.units=o,this.tileSize=a,this.buffer=h,this.pixelFormat=lP[u],this.dataIndex=g,this.bandShape=[a+2*h,a+2*h,i2[this.pixelFormat]],this._decodedBlocks=new b_(v?v.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return i2[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const r=e.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.put(r,e.data)}getBlockForBand(e){let r=0;switch(typeof e){case"string":for(const[o,a]of this.dataIndex.entries()){for(const[u,h]of a.bands.entries())if(h===e)return{bandIndex:r+u,blockIndex:o,blockBandIndex:u};r+=a.bands.length}break;case"number":for(const[o,a]of this.dataIndex.entries()){if(e>=r&&e<r+a.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-r};r+=a.bands.length}break;default:throw new wc(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let r=1/0,o=-1/0;const a=[],u=new Set;for(const h of e){const{blockIndex:g}=this.getBlockForBand(h);if(g<0)throw new wc(`Invalid band: ${JSON.stringify(h)}`);const v=this.dataIndex[g];a.includes(g)||a.push(g),u.add(g),r=Math.min(r,v.firstByte),o=Math.max(o,v.lastByte)}if(u.size>this.cacheSize)throw new wc(`Number of blocks to decode (${u.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:r,lastByte:o,blockIndices:a}}hasBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0}hasDataForBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(e){const{blockIndex:r,blockBandIndex:o}=this.getBlockForBand(e);if(r<0)throw new wc(`Band not found: ${JSON.stringify(e)}`);const a=this._decodedBlocks.get(r.toString());if(!a)throw new wc(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const u=this.dataIndex[r],h=this.bandShape.reduce((x,E)=>x*E,1),g=o*h,v=a.subarray(g,g+h);return{data:v,bytes:new Uint8Array(v.buffer).subarray(v.byteOffset,v.byteOffset+v.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:u.offset,scale:u.scale}}}S_.setPbf=function(n){Iv=n};class o2{constructor(e,r,o){this.tasks=e,this._onCancel=r,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,r){this._finalized||(this._onComplete(e,r),this._finalized=!0)}}function np(n,e){const r=n.json.bufferViews[e.bufferView],o=qg[e.componentType];return new o(n.buffers[r.buffer],(e.byteOffset||0)+(r.byteOffset||0),e.count*(r.byteStride&&r.byteStride!==Fm[e.type]*o.BYTES_PER_ELEMENT?r.byteStride/o.BYTES_PER_ELEMENT:Fm[e.type]))}function Av(n,e,r,o){const a=qg[e.componentType],u=function(E){switch(E){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(a),h=n.json.bufferViews[e.bufferView],g=h.byteStride?h.byteStride/a.BYTES_PER_ELEMENT:Fm[e.type],v=r.float32,x=v.length/r.capacity;for(let E=0,A=0;E<e.count*g;E+=g,A+=x)for(let C=0;C<x;C++)v[A+C]=o[E+C]*u;r._trim()}function uP(n,e,r){const o=n.indices,a=n.attributes,u={};u.indexArray=new as;const h=e.json.accessors[o],g=h.count/3;u.indexArray.reserve(g);const v=np(e,h);for(let C=0;C<g;C++)u.indexArray.emplaceBack(v[3*C],v[3*C+1],v[3*C+2]);u.indexArray._trim(),u.vertexArray=new Ra;const x=e.json.accessors[a.POSITION];u.vertexArray.reserve(x.count);const E=np(e,x);for(let C=0;C<x.count;C++)u.vertexArray.emplaceBack(E[3*C],E[3*C+1],E[3*C+2]);if(u.vertexArray._trim(),u.aabb=new Tn(x.min,x.max),u.centroid=function(C,k){const L=[0,0,0],j=C.length;if(j>0){for(let G=0;G<j;G++){const K=3*C[G];L[0]+=k[K],L[1]+=k[K+1],L[2]+=k[K+2]}L[0]/=j,L[1]/=j,L[2]/=j}return L}(v,E),a.COLOR_0!==void 0){const C=e.json.accessors[a.COLOR_0],k=Fm[C.type],L=np(e,C);u.colorArray=k===3?new Ra:new os,u.colorArray.resize(C.count),Av(e,C,u.colorArray,L)}if(a.NORMAL!==void 0){u.normalArray=new Ra;const C=e.json.accessors[a.NORMAL];u.normalArray.resize(C.count);const k=np(e,C);Av(e,C,u.normalArray,k)}if(a.TEXCOORD_0!==void 0&&r.length>0){u.texcoordArray=new nu;const C=e.json.accessors[a.TEXCOORD_0];u.texcoordArray.resize(C.count);const k=np(e,C);Av(e,C,u.texcoordArray,k)}if(a._FEATURE_ID_RGBA4444!==void 0){const C=e.json.accessors[a._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(u.featureData=np(e,C))}a._FEATURE_RGBA4444!==void 0&&(u.featureData=new Uint32Array(np(e,e.json.accessors[a._FEATURE_RGBA4444]).buffer));const A=n.material;return u.material=function(C,k){const{emissiveFactor:L=[0,0,0],alphaMode:j="OPAQUE",alphaCutoff:G=.5,normalTexture:K,occlusionTexture:te,emissiveTexture:ne,doubleSided:U}=C,{baseColorFactor:ee=[1,1,1,1],metallicFactor:ie=1,roughnessFactor:ae=1,baseColorTexture:Te,metallicRoughnessTexture:ve}=C.pbrMetallicRoughness||{},Ee=te?k[te.index]:void 0;if(te&&te.extensions&&te.extensions.KHR_texture_transform&&Ee){const Re=te.extensions.KHR_texture_transform;Ee.offsetScale=[Re.offset[0],Re.offset[1],Re.scale[0],Re.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new _n(...ee),metallicFactor:ie,roughnessFactor:ae,baseColorTexture:Te?k[Te.index]:void 0,metallicRoughnessTexture:ve?k[ve.index]:void 0},doubleSided:U,emissiveFactor:new _n(...L),alphaMode:j,alphaCutoff:G,normalTexture:K?k[K.index]:void 0,occlusionTexture:Ee,emissionTexture:ne?k[ne.index]:void 0,defined:C.defined===void 0}}(A!==void 0?e.json.materials[A]:{defined:!1},r),u}function a2(n,e,r){const{matrix:o,rotation:a,translation:u,scale:h,mesh:g,extras:v,children:x}=n,E={};if(E.matrix=o||function(A,C,k,L){var j=C[0],G=C[1],K=C[2],te=C[3],ne=j+j,U=G+G,ee=K+K,ie=j*ne,ae=j*U,Te=j*ee,ve=G*U,Ee=G*ee,Re=K*ee,He=te*ne,ht=te*U,it=te*ee,ut=L[0],mt=L[1],Ze=L[2];return A[0]=(1-(ve+Re))*ut,A[1]=(ae+it)*ut,A[2]=(Te-ht)*ut,A[3]=0,A[4]=(ae-it)*mt,A[5]=(1-(ie+Re))*mt,A[6]=(Ee+He)*mt,A[7]=0,A[8]=(Te+ht)*Ze,A[9]=(Ee-He)*Ze,A[10]=(1-(ie+ve))*Ze,A[11]=0,A[12]=k[0],A[13]=k[1],A[14]=k[2],A[15]=1,A}([],a||[0,0,0,1],u||[0,0,0],h||[1,1,1]),g!==void 0){E.meshes=r[g];const A=E.anchor=[0,0];for(const C of E.meshes){const{min:k,max:L}=C.aabb;A[0]+=k[0]+L[0],A[1]+=k[1]+L[1]}A[0]=Math.floor(A[0]/E.meshes.length/2),A[1]=Math.floor(A[1]/E.meshes.length/2)}if(v&&(v.id&&(E.id=v.id),v.lights&&(E.lights=function(A){if(!A.length)return[];const C=function(K){const te=atob(K),ne=new Uint8Array(te.length);for(let U=0;U<te.length;U++)ne[U]=te.codePointAt(U);return ne}(A),k=[],L=C.length/24,j=new Uint16Array(C.buffer),G=new Float32Array(C.buffer);for(let K=0;K<L;K++){const te=j[2*K*6]/30,ne=j[2*K*6+1]/30,U=j[2*K*6+10]/100,ee=G[6*K+1],ie=G[6*K+2],ae=G[6*K+3],Te=G[6*K+4],ve=ae-ee,Ee=Te-ie,Re=Math.hypot(ve,Ee);k.push({pos:[ee+.5*ve,ie+.5*Ee,ne],normal:[Ee/Re,-ve/Re,0],width:Re,height:te,depth:U,points:[ee,ie,ae,Te]})}return k}(v.lights))),x){const A=[];for(const C of x)A.push(a2(e.json.nodes[C],e,r));E.children=A}return E}function hP(n){if(n.vertices.length===0||n.indices.length===0)return null;const e=new Py(n.vertices,n.indices,8,256),[r,o]=[e.min.clone(),e.max.clone()];return{vertices:n.vertices,indices:n.indices,grid:e,min:r,max:o}}function dP(n){if(!n.extras||!n.extras.ground)return null;const e=n.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const r=e[0];if(!r||!Array.isArray(r)||r.length===0)return null;const o=[];for(const h of r){if(!Array.isArray(h)||h.length!==2)continue;const g=h[0],v=h[1];typeof g=="number"&&typeof v=="number"&&o.push(new ft(g,v))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let a=0;for(let h=0;h<o.length;h++){const g=o[h],v=o[(h+1)%o.length],x=o[(h+2)%o.length];a+=(g.x-v.x)*(x.y-v.y)-(x.x-v.x)*(g.y-v.y)}a>0&&o.reverse();const u=Em(o.flatMap(h=>[h.x,h.y]),[]);return u.length===0?null:{vertices:o,indices:u}}function fP(n,e){const r=[],o=[];let a=0;const u=[];for(const h of n){a=r.length;const g=h.vertexArray.float32,v=h.indexArray.uint16;for(let x=0;x<h.vertexArray.length;x++)u[0]=g[3*x+0],u[1]=g[3*x+1],u[2]=g[3*x+2],Ar(u,u,e),r.push(new ft(u[0],u[1]));for(let x=0;x<3*h.indexArray.length;x++)o.push(v[x]+a)}if(o.length%3!=0)return null;for(let h=0;h<o.length;h+=3){const g=r[o[h+0]],v=r[o[h+1]],x=r[o[h+2]];(g.x-v.x)*(x.y-v.y)-(x.x-v.x)*(g.y-v.y)>0&&([o[h+1],o[h+2]]=[o[h+2],o[h+1]])}return{vertices:r,indices:o}}function l2(n){const e=function(v,x){const E=[],A=WebGL2RenderingContext;if(v.json.textures)for(const C of v.json.textures){const k={magFilter:A.LINEAR,minFilter:A.NEAREST,wrapS:A.REPEAT,wrapT:A.REPEAT};C.sampler!==void 0&&Object.assign(k,v.json.samplers[C.sampler]),E.push({image:x[C.source],sampler:k,uploaded:!1})}return E}(n,n.images),r=function(v,x){const E=[];for(const A of v.json.meshes){const C=[];for(const k of A.primitives)C.push(uP(k,v,x));E.push(C)}return E}(n,e),{scenes:o,scene:a,nodes:u}=n.json,h=o?o[a||0].nodes:u,g=[];for(const v of h)g.push(a2(u[v],n,r));return function(v,x,E){const A={},C=new Set;for(let k=0;k<v.length;k++){const L=E[x[k]];if(!L.extras)continue;const j=L.extras["mapbox:footprint:version"],G=L.extras["mapbox:footprint:id"];(j||G)&&C.add(k),j==="1.0.0"&&G&&(A[G]=k)}for(let k=0;k<v.length;k++){if(C.has(k))continue;const L=v[k],j=E[x[k]];if(!j.extras)continue;let G=null;L.id in A&&(G=fP(v[A[L.id]].meshes,L.matrix)),G||(G=dP(j)),G&&(L.footprint=hP(G))}if(C.size>0){const k=Array.from(C.values()).sort((L,j)=>L-j);for(let L=k.length-1;L>=0;L--)v.splice(k[L],1)}}(g,h,n.json.nodes),g}function pP(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const e=n.vertexArray.float32,r=n.aabb.min[0]-1,o=n.aabb.min[1]-1,a=tp/(n.aabb.max[0]-r+2),u=tp/(n.aabb.max[1]-o+2);for(let h=0;h<e.length;h+=3){const g=e[h+2],v=(e[h+0]-r)*a|0,x=(e[h+1]-o)*u|0;g>n.heightmap[x*tp+v]&&(n.heightmap[x*tp+v]=g)}}function mP(n,e){const r={};r.indexArray=new as,r.indexArray.reserve(4*n.length),r.vertexArray=new Ra,r.vertexArray.reserve(10*n.length),r.colorArray=new os,r.vertexArray.reserve(10*n.length);let o=0;for(const h of n){const g=Math.min(10,Math.max(4,1.3*h.height))*e,v=[-h.normal[1],h.normal[0],0],x=Math.min(.29,.1*h.width/h.depth),E=h.width-2*h.depth*e*(x+.01),A=rt([],h.pos,v,E/2),C=rt([],h.pos,v,-E/2),k=[A[0],A[1],A[2]+h.height],L=[C[0],C[1],C[2]+h.height],j=rt([],h.normal,v,x);Ht(j,j,g);const G=rt([],h.normal,v,-x);Ht(G,G,g),rn(j,A,j),rn(G,C,G),A[2]+=.1,C[2]+=.1,r.vertexArray.emplaceBack(j[0],j[1],j[2]),r.vertexArray.emplaceBack(G[0],G[1],G[2]),r.vertexArray.emplaceBack(A[0],A[1],A[2]),r.vertexArray.emplaceBack(C[0],C[1],C[2]),r.vertexArray.emplaceBack(k[0],k[1],k[2]),r.vertexArray.emplaceBack(L[0],L[1],L[2]),r.vertexArray.emplaceBack(A[0],A[1],A[2]),r.vertexArray.emplaceBack(C[0],C[1],C[2]),r.vertexArray.emplaceBack(j[0],j[1],j[2]),r.vertexArray.emplaceBack(G[0],G[1],G[2]);const K=E/g/2;r.colorArray.emplaceBack(-K-x,-1,K,.8),r.colorArray.emplaceBack(K+x,-1,K,.8),r.colorArray.emplaceBack(-K,0,K,1.3),r.colorArray.emplaceBack(K,0,K,1.3),r.colorArray.emplaceBack(K+x,-.8,K,.7),r.colorArray.emplaceBack(K+x,-.8,K,.7),r.colorArray.emplaceBack(0,0,K,1.3),r.colorArray.emplaceBack(0,0,K,1.3),r.colorArray.emplaceBack(K+x,-1.2,K,.8),r.colorArray.emplaceBack(K+x,-1.2,K,.8),r.indexArray.emplaceBack(6+o,4+o,8+o),r.indexArray.emplaceBack(7+o,9+o,5+o),r.indexArray.emplaceBack(0+o,1+o,2+o),r.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}const a={defined:!0};a.emissiveFactor=_n.black;const u={};return u.baseColorFactor=_n.white,a.pbrMetallicRoughness=u,r.material=a,r.aabb=new Tn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}S_.performDecoding=function(n,e){const r=new Uint8Array(n);return Promise.all(e.tasks.map(o=>{const{layerName:a,firstByte:u,lastByte:h,pixelFormat:g,blockShape:v,blockIndex:x,filters:E,codec:A}=o,C=r.subarray(u,h+1),k=new Uint32Array(v[0]*v[1]*v[2]);let L;if(A!=="gzip_data")throw new wc(`Unhandled codec: ${A}`);return L=function(j,G){if(!globalThis.DecompressionStream&&G==="gzip_data")return Promise.resolve(((U=function(ae){ae[0]==31&&ae[1]==139&&ae[2]==8||mu(6,"invalid gzip data");var Te=ae[3],ve=10;4&Te&&(ve+=2+(ae[10]|ae[11]<<8));for(var Ee=(Te>>3&1)+(Te>>4&1);Ee>0;Ee-=!ae[ve++]);return ve+(2&Te)}(ne=j))+8>ne.length&&mu(6,"invalid gzip data"),function(ae,Te,ve,Ee){var Re=ae.length;if(!Re||Te.f&&!Te.l)return ve||new Ol(0);var He=!ve,ht=He||Te.i!=2,it=Te.i;He&&(ve=new Ol(3*Re));var ut,mt,Ze=function(Mi){var ai=ve.length;if(Mi>ai){var ei=new Ol(Math.max(2*ai,Mi));ei.set(ve),ve=ei}},lt=Te.f||0,qe=Te.p||0,We=Te.b||0,xt=Te.l,bt=Te.d,ir=Te.m,qt=Te.n,zt=8*Re;do{if(!xt){lt=pu(ae,qe,1);var yt=pu(ae,qe+1,3);if(qe+=3,!yt){var wr=ae[(oe=4+((qe+7)/8|0))-4]|ae[oe-3]<<8,Gt=oe+wr;if(Gt>Re){it&&mu(0);break}ht&&Ze(We+wr),ve.set(ae.subarray(oe,Gt),We),Te.b=We+=wr,Te.p=qe=8*Gt,Te.f=lt;continue}if(yt==1)xt=rP,bt=nP,ir=9,qt=5;else if(yt==2){var Zt=pu(ae,qe,31)+257,pr=pu(ae,qe+10,15)+4,Fr=Zt+pu(ae,qe+5,31)+1;qe+=14;for(var kr=new Ol(Fr),Zr=new Ol(19),jr=0;jr<pr;++jr)Zr[QM[jr]]=pu(ae,qe+3*jr,7);qe+=3*pr;var Xr=Sv(Zr),Dn=(1<<Xr)-1,ni=eg(Zr,Xr);for(jr=0;jr<Fr;){var oe,fe=ni[pu(ae,qe,Dn)];if(qe+=15&fe,(oe=fe>>4)<16)kr[jr++]=oe;else{var Ke=0,St=0;for(oe==16?(St=3+pu(ae,qe,3),qe+=2,Ke=kr[jr-1]):oe==17?(St=3+pu(ae,qe,7),qe+=3):oe==18&&(St=11+pu(ae,qe,127),qe+=7);St--;)kr[jr++]=Ke}}var kt=kr.subarray(0,Zt),Rt=kr.subarray(Zt);ir=Sv(kt),qt=Sv(Rt),xt=eg(kt,ir),bt=eg(Rt,qt)}else mu(1);if(qe>zt){it&&mu(0);break}}ht&&Ze(We+131072);for(var Ut=(1<<ir)-1,fr=(1<<qt)-1,an=qe;;an=qe){var ln=(Ke=xt[Ev(ae,qe)&Ut])>>4;if((qe+=15&Ke)>zt){it&&mu(0);break}if(Ke||mu(2),ln<256)ve[We++]=ln;else{if(ln==256){an=qe,xt=null;break}var Vr=ln-254;ln>264&&(Vr=pu(ae,qe,(1<<(cn=Kb[jr=ln-257]))-1)+t2[jr],qe+=cn);var Fn=bt[Ev(ae,qe)&fr],Qn=Fn>>4;if(Fn||mu(3),qe+=15&Fn,Rt=tP[Qn],Qn>3){var cn=Jb[Qn];Rt+=Ev(ae,qe)&(1<<cn)-1,qe+=cn}if(qe>zt){it&&mu(0);break}ht&&Ze(We+131072);var Ti=We+Vr;if(We<Rt){var ii=0-Rt,Ln=Math.min(Rt,Ti);for(ii+We<0&&mu(3);We<Ln;++We)ve[We]=(void 0)[ii+We]}for(;We<Ti;++We)ve[We]=ve[We-Rt]}}Te.l=xt,Te.p=an,Te.b=We,Te.f=lt,xt&&(lt=1,Te.m=ir,Te.d=bt,Te.n=qt)}while(!lt);return We!=ve.length&&He?(ut=ve,((mt=We)==null||mt>ut.length)&&(mt=ut.length),new Ol(ut.subarray(0,mt))):ve.subarray(0,We)}(ne.subarray(U,-8),{i:2},new Ol(((K=ne)[(te=K.length)-4]|K[te-3]<<8|K[te-2]<<16|K[te-1]<<24)>>>0))));var K,te,ne,U;const ee=aP[G];if(!ee)throw new Error(`Unhandled codec: ${G}`);const ie=new globalThis.DecompressionStream(ee);return new Response(new Blob([j]).stream().pipeThrough(ie)).arrayBuffer().then(ae=>new Uint8Array(ae))}(C,A).then(j=>(function(G,K){G.readFields(WM,K)}(new Iv(j),k),new cP[g](k.buffer))),L.then(j=>{for(let G=E.length-1;G>=0;G--)switch(E[G]){case"delta_filter":XM(j,v);break;case"zigzag_filter":YM(j);break;case"bitshuffle_filter":KM(j,g);break;default:throw new wc(`Unhandled filter "${E[G]}"`)}return{layerName:a,blockIndex:x,data:j}}).catch(j=>{throw j})}))},Ft(o2,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Ft(S_,"MapboxRasterTile"),Ft(s2,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class c2{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const o=e[r];this._stringToNumber[o]=r,this._numberToString[r]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const gP=["id","tile","layer","source","sourceLayer","state"];class Kp{constructor(e,r,o,a,u){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=o,this._y=a,this.properties=e.properties,this.id=u}clone(){const e=new Kp(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const r of gP)this[r]!==void 0&&(e[r]=this[r]);return e}}class u2{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ps(Ct,16,0),this.featureIndexArray=new Zd,this.promoteId=r,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,r,o,a,u,h=0,g=0){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,a,u,h);const x=this.grid;for(let E=0;E<r.length;E++){const A=r[E],C=[1/0,1/0,-1/0,-1/0];for(let k=0;k<A.length;k++){const L=A[k];C[0]=Math.min(C[0],L.x),C[1]=Math.min(C[1],L.y),C[2]=Math.max(C[2],L.x),C[3]=Math.max(C[3],L.y)}g!==0&&(C[0]-=g,C[1]-=g,C[2]+=g,C[3]+=g),C[0]<Ct&&C[1]<Ct&&C[2]>=0&&C[3]>=0&&x.insert(v,C[0],C[1],C[2],C[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Lr.VectorTile(new Wg(this.rawTileData)).layers,this.sourceLayerCoder=new c2(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r){const{tilespaceGeometry:o,transform:a,tileTransform:u,pixelPosMatrix:h,availableImages:g,worldview:v}=r;this.loadVTLayers(),this.serializedLayersCache.clear();const x=o.bufferedTilespaceBounds,E=this.grid.query(x.min.x,x.min.y,x.max.x,x.max.y,(L,j,G,K)=>Dl(o.bufferedTilespaceGeometry,L,j,G,K));E.sort(_P);let A=null;a.elevation&&E.length>0&&(A=Wp.create(a.elevation,this.tileID));const C={};let k;for(let L=0;L<E.length;L++){const j=E[L];if(j===k)continue;k=j;const G=this.featureIndexArray.get(j);let K=null;this.is3DTile?this.loadMatchingModelFeature(C,G,e,o,a,v):this.loadMatchingFeature(C,G,e,g,v,(te,ne,U,ee=0)=>(K||(K=Lt(te,this.tileID.canonical,u)),ne.queryIntersectsFeature(o,te,U,K,this.z,a,h,A,ee)))}return C}loadMatchingFeature(e,r,o,a,u,h){const{featureIndex:g,bucketIndex:v,sourceLayerIndex:x,layoutVertexArrayOffset:E}=r,A=this.bucketLayerIDs[v],C=o.layers,k=Object.keys(C);if(k.length&&!xr(k,A))return;const L=o.sourceCache,j=this.sourceLayerCoder.decode(x),G=this.vtLayers[j].feature(g),K=this.getId(G,j);for(let te=0;te<A.length;te++){const ne=A[te];if(!C[ne])continue;const{styleLayer:U,targets:ee}=C[ne];let ie={};K!==void 0&&(ie=L.getFeatureState(U.sourceLayer,K));const ae=!h||h(G,U,ie,E);if(!ae)continue;const Te=new Kp(G,this.z,this.x,this.y,K);Te.tile=this.tileID.canonical,Te.state=ie;let ve=this.serializedLayersCache.get(ne);ve||(ve=U.serialize(),ve.id=ne,this.serializedLayersCache.set(ne,ve)),Te.source=ve.source,Te.sourceLayer=ve["source-layer"],Te.layer=je({},ve),Te.layer.paint=h2(ve.paint,U.paint,G,ie,a),Te.layer.layout=h2(ve.layout,U.layout,G,ie,a);let Ee=!1;for(const Re of ee){this.updateFeatureProperties(Te,Re);const{filter:He}=Re;if(He){if(G.properties=Te.properties,He.needGeometry){const ht=Mt(G,!0);if(!He.filter(new zn(this.tileID.overscaledZ,{worldview:u}),ht,this.tileID.canonical))continue}else if(!He.filter(new zn(this.tileID.overscaledZ,{worldview:u}),G))continue}Ee=!0,Re.targetId&&this.addFeatureVariant(Te,Re)}Ee&&this.appendToResult(e,ne,g,Te,ae)}}loadMatchingModelFeature(e,r,o,a,u,h){const{featureIndex:g,bucketIndex:v}=r,x=this.bucketLayerIDs[v],E=o.layers,A=Object.keys(E);if(!A.length||xr(A,x))for(let C=0;C<x.length;C++){const k=x[C],{styleLayer:L,targets:j}=E[k];if(L.type!=="model")continue;const G=a.tile,K=G.getBucket(L);if(!(K&&K instanceof __))continue;const te=gM(K,g,a,u);if(!te)continue;const{z:ne,x:U,y:ee}=G.tileID.canonical,{feature:ie,intersectionZ:ae,position:Te}=te;let ve={};ie.id!==void 0&&(ve=o.sourceCache.getFeatureState(L.sourceLayer,ie.id));const Ee=new Kp({},ne,U,ee,ie.id);Ee.tile=this.tileID.canonical,Ee.state=ve,Ee.properties=ie.properties,Ee.geometry={type:"Point",coordinates:[Te.lng,Te.lat]};let Re=this.serializedLayersCache.get(k);Re||(Re=L.serialize(),Re.id=k,this.serializedLayersCache.set(k,Re)),Ee.source=Re.source,Ee.sourceLayer=Re["source-layer"],Ee.layer=je({},Re);let He=!1;for(const ht of j){this.updateFeatureProperties(Ee,ht);const{filter:it}=ht;if(it){if(ie.properties=Ee.properties,it.needGeometry){if(!it.filter(new zn(this.tileID.overscaledZ,{worldview:h}),ie,this.tileID.canonical))continue}else if(!it.filter(new zn(this.tileID.overscaledZ,{worldview:h}),ie))continue}He=!0,ht.targetId&&this.addFeatureVariant(Ee,ht)}He&&this.appendToResult(e,k,g,Ee,ae)}}updateFeatureProperties(e,r,o){if(r.properties){const a={};for(const u in r.properties){const h=r.properties[u].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,o);h!=null&&(a[u]=h)}e.properties=a}}addFeatureVariant(e,r,o){const a={target:r.target,namespace:r.namespace,uniqueFeatureID:r.uniqueFeatureID};r.properties&&(a.properties=e.properties),e.variants=e.variants||{},e.variants[r.targetId]=e.variants[r.targetId]||[],e.variants[r.targetId].push(a)}appendToResult(e,r,o,a,u){let h=e[r];h===void 0&&(h=e[r]=[]),h.push({featureIndex:o,feature:a,intersectionZ:u})}lookupSymbolFeatures(e,r,o,a,u,h){const g={};this.loadVTLayers();for(const v of e)this.loadMatchingFeature(g,{bucketIndex:r,sourceLayerIndex:o,featureIndex:v,layoutVertexArrayOffset:0},a,u,h);return g}loadFeature(e){const{featureIndex:r,sourceLayerIndex:o}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(o),u=this.vtFeatures[a];if(u[r])return u[r];const h=this.vtLayers[a].feature(r);return u[r]=h,h}hasLayer(e){for(const r of this.bucketLayerIDs)for(const o of r)if(e===o)return!0;return!1}getId(e,r){let o=e.id;if(this.promoteId){const a=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[r];if(a!=null)if(Array.isArray(a)){if(!this.promoteIdExpression){const u=Xa(a);if(u.result!=="success"){const h=u.value.map(g=>`${g.key}: ${g.message}`).join(", ");return void Rr(`Failed to create expression for promoteId: ${h}`)}this.promoteIdExpression=u.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new wh),o=this.promoteIdExpression.evaluate({zoom:0},e)}else o=e.properties[a];typeof o=="boolean"&&(o=Number(o))}return o}}function h2(n,e,r,o,a){return Yt(n,(u,h)=>{const g=e instanceof Pa?e.get(h):null;return g&&g.evaluate?g.evaluate(r,o,void 0,a):g})}function _P(n,e){return e-n}Ft(u2,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const d2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Cv{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,o]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const a=o>>4;if(a!==1)throw new Error(`Got v${a} data when expected v1.`);const u=d2[15&o];if(!u)throw new Error("Unrecognized array type.");const[h]=new Uint16Array(e,2,1),[g]=new Uint32Array(e,4,1);return new Cv(g,h,u,e)}constructor(e,r=64,o=Float64Array,a){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const u=d2.indexOf(this.ArrayType),h=2*e*this.ArrayType.BYTES_PER_ELEMENT,g=e*this.IndexArrayType.BYTES_PER_ELEMENT,v=(8-g%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${o}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+v,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+h+g+v),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+v,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=r,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Mv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,o,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:h,nodeSize:g}=this,v=[0,u.length-1,0],x=[];for(;v.length;){const E=v.pop()||0,A=v.pop()||0,C=v.pop()||0;if(A-C<=g){for(let G=C;G<=A;G++){const K=h[2*G],te=h[2*G+1];K>=e&&K<=o&&te>=r&&te<=a&&x.push(u[G])}continue}const k=C+A>>1,L=h[2*k],j=h[2*k+1];L>=e&&L<=o&&j>=r&&j<=a&&x.push(u[k]),(E===0?e<=L:r<=j)&&(v.push(C),v.push(k-1),v.push(1-E)),(E===0?o>=L:a>=j)&&(v.push(k+1),v.push(A),v.push(1-E))}return x}within(e,r,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:u,nodeSize:h}=this,g=[0,a.length-1,0],v=[],x=o*o;for(;g.length;){const E=g.pop()||0,A=g.pop()||0,C=g.pop()||0;if(A-C<=h){for(let G=C;G<=A;G++)p2(u[2*G],u[2*G+1],e,r)<=x&&v.push(a[G]);continue}const k=C+A>>1,L=u[2*k],j=u[2*k+1];p2(L,j,e,r)<=x&&v.push(a[k]),(E===0?e-o<=L:r-o<=j)&&(g.push(C),g.push(k-1),g.push(1-E)),(E===0?e+o>=L:r+o>=j)&&(g.push(k+1),g.push(A),g.push(1-E))}return v}}function Mv(n,e,r,o,a,u){if(a-o<=r)return;const h=o+a>>1;f2(n,e,h,o,a,u),Mv(n,e,r,o,h-1,1-u),Mv(n,e,r,h+1,a,1-u)}function f2(n,e,r,o,a,u){for(;a>o;){if(a-o>600){const x=a-o+1,E=r-o+1,A=Math.log(x),C=.5*Math.exp(2*A/3),k=.5*Math.sqrt(A*C*(x-C)/x)*(E-x/2<0?-1:1);f2(n,e,r,Math.max(o,Math.floor(r-E*C/x+k)),Math.min(a,Math.floor(r+(x-E)*C/x+k)),u)}const h=e[2*r+u];let g=o,v=a;for(rg(n,e,o,r),e[2*a+u]>h&&rg(n,e,o,a);g<v;){for(rg(n,e,g,v),g++,v--;e[2*g+u]<h;)g++;for(;e[2*v+u]>h;)v--}e[2*o+u]===h?rg(n,e,o,v):(v++,rg(n,e,v,a)),v<=r&&(o=v+1),r<=v&&(a=v-1)}}function rg(n,e,r,o){Pv(n,r,o),Pv(e,2*r,2*o),Pv(e,2*r+1,2*o+1)}function Pv(n,e,r){const o=n[e];n[e]=n[r],n[r]=o}function p2(n,e,r,o){const a=n-r,u=e-o;return a*a+u*u}s.$=is,s.A=Kl,s.B=_l,s.C=el,s.D=Np,s.E=Jl,s.F=2,s.G=Um,s.H=zw,s.I=Gs,s.J=yl,s.K=class extends m_{},s.L=Ba,s.M=gs,s.N=$u,s.O=Uu,s.P=ft,s.Q=Oh,s.R=fa,s.S=Sl,s.T=uv,s.U=wo,s.V=m_,s.W=Jc,s.X=Xa,s.Y=ku,s.Z=oc,s._=bl,s.a=function(n){return bs.API_CDN_URL_REGEX.test(n)},s.a$=Ue,s.a0=Ts,s.a1=gc,s.a2=lc,s.a3=Lh,s.a4=function(n){const e=n.value;let r=[];if(!e)return r;const o=yl(e);return o!=="string"?(r=r.concat([new m_(n.key,e,`string expected, "${o}" found`)]),r):(pv(e,!0)||(r=r.concat([new m_(n.key,e,`invalid url "${e}"`)])),r)},s.a5=ke,s.a6=Gi,s.a7=fi,s.a8=gt,s.a9=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return ti(n.expression.evaluate(e))}interpolate(n,e,r){return{x:lr(n.x,e.x,r),y:lr(n.y,e.y,r),z:lr(n.z,e.z,r),azimuthal:lr(n.azimuthal,e.azimuthal,r),polar:lr(n.polar,e.polar,r)}}},s.aA=ds,s.aB=y,s.aC=Da,s.aD=pe,s.aE=Ve,s.aF=function(n,e){const r={};for(let o=0;o<e.length;o++){const a=e[o];a in n&&(r[a]=n[a])}return r},s.aG=se,s.aH=ue,s.aI=class{constructor(n){this.entries={},this.scheduler=n}request(n,e,r,o){const a=this.entries[n]=this.entries[n]||{callbacks:[]};if(a.result){const[u,h]=a.result;return this.scheduler?this.scheduler.add(()=>{o(u,h)},e):o(u,h),()=>{}}return a.callbacks.push(o),a.cancel||(a.cancel=r((u,h)=>{a.result=[u,h];for(const g of a.callbacks)this.scheduler?this.scheduler.add(()=>{g(u,h)},e):g(u,h);setTimeout(()=>delete this.entries[n],3e3)})),()=>{a.result||(a.callbacks=a.callbacks.filter(u=>u!==o),a.callbacks.length||(a.cancel(),delete this.entries[n]))}}},s.aJ=function(n,e,r){const o=JSON.stringify(n.request);return n.data&&(this.deduped.entries[o]={result:[null,n.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},a=>{const u=mh(n.request,(h,g,v,x)=>{h?a(h):g&&a(null,{vectorTile:r?void 0:new Lr.VectorTile(new Wg(g)),rawData:g,cacheControl:v,expires:x})});return()=>{u.cancel(),a()}},e)},s.aK=function(n){ld++,ld>Yn&&(n.getActor().send("enforceCacheSizeLimit",Xo),ld=0)},s.aL=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},s.aM=io,s.aN=ab,s.aO=fb,s.aP=ob,s.aQ=function(n,e){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let o=0;o<n.length;o++){const a=document.createElement("source");vp(n[o])||(r.crossOrigin="Anonymous"),a.src=n[o],r.appendChild(a)}return{cancel:()=>{}}},s.aR=u_,s.aS=function(n){return fetch(n).then(e=>e.arrayBuffer()).then(e=>K1(e,0,n))},s.aT=l2,s.aU=class{constructor(n,e,r,o){this.id=n,this.position=e!=null?new J(e[0],e[1]):new J(0,0),this.orientation=r??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new Tn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(n,e){if(Tt(n.matrix,e,n.matrix),n.meshes)for(const r of n.meshes){const o=Tn.applyTransformFast(r.aabb,n.matrix);this.aabb.encapsulate(o)}if(n.children)for(const r of n.children)this._applyTransformations(r,n.matrix)}computeBoundsAndApplyParent(){const n=Be([]);for(const e of this.nodes)this._applyTransformations(e,n)}computeModelMatrix(n,e,r,o,a,u,h=!1){Sb(this.matrix,this,n.transform,this.position,e,r,o,a,u,h)}upload(n){if(!this.uploaded){for(const e of this.nodes)gv(e,n);for(const e of this.nodes)g_(e);this.uploaded=!0}}destroy(){for(const n of this.nodes)_v(n)}},s.aV=$t,s.aW=Gm,s.aX=xe,s.aY=Pe,s.aZ=Ku,s.a_=as,s.aa=zn,s.ab=uc,s.ac=Ie,s.ad=Ar,s.ae=gr,s.af=Ae,s.ag=Pa,s.ah=sn,s.ai=lr,s.aj=Ct,s.ak=Tu,s.al=en,s.am=_n,s.an=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return function([r,o]){const a=ti([1,r,o]);return{x:a.x,y:a.y,z:a.z}}(n.expression.evaluate(e))}interpolate(n,e,r){return{x:lr(n.x,e.x,r),y:lr(n.y,e.y,r),z:lr(n.z,e.z,r)}}},s.ao=function(n,e,r=0,o=!0){const a=new ft(r,r),u=n.sub(a),h=e.add(a),g=[u,new ft(h.x,u.y),h,new ft(u.x,h.y)];return o&&g.push(u.clone()),g},s.ap=function(n,e){const r=[];for(let o=0;o<n.length;o++){const a=Ne(o-1,-1,n.length-1),u=Ne(o+1,-1,n.length-1),h=n[o],g=n[u],v=n[a].sub(h).unit(),x=g.sub(h).unit(),E=x.angleWithSep(v.x,v.y),A=v.add(x).unit().mult(-1*e/Math.sin(E/2));r.push(h.add(A))}return r},s.aq=Hw,s.ar=Dl,s.as=function(n,e,r=0){return Mr(((e.x-r)*n.scale-n.x)*Ct,(e.y*n.scale-n.y)*Ct,Le(e.z,e.y))},s.at=vi,s.au=br,s.av=Jn,s.aw=iw,s.ax=function(n){let e=1/0,r=1/0,o=-1/0,a=-1/0;for(const u of n)e=Math.min(e,u.x),r=Math.min(r,u.y),o=Math.max(o,u.x),a=Math.max(a,u.y);return{min:new ft(e,r),max:new ft(o,a)}},s.ay=me,s.az=Tt,s.b=function(n){return bs.API_FONTS_REGEX.test(n)},s.b$=function(n,e,r){r*=.5;var o=e[0],a=e[1],u=e[2],h=e[3],g=Math.sin(r),v=Math.cos(r);return n[0]=o*v+a*g,n[1]=a*v-o*g,n[2]=u*v+h*g,n[3]=h*v-u*g,n},s.b0=th,s.b1=l_,s.b2=function(){Ma.isLoading()||Ma.isLoaded()||Il()!=="deferred"||zd()},s.b3=Vh,s.b4=Mt,s.b5=Kp,s.b6=bn,s.b7=Uy,s.b8=My,s.b9=Lt,s.bA=function(n,e){const{x:r,y:o}=n.point,a=Jr(r,o,n.worldSize/n._pixelsPerMercatorPixel,0,0);return Tt(a,a,et(Ge(e)))},s.bB=Se,s.bC=function(n){return n[0]=0,n[1]=0,n[2]=0,n},s.bD=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},s.bE=rt,s.bF=Sr,s.bG=Br,s.bH=Vm,s.bI=La,s.bJ=Yy,s.bK=function(n,e,r,o,a){const u=5*e+2;n.float32[u+0]=r,n.float32[u+1]=o,n.float32[u+2]=a},s.bL=a_,s.bM=$g,s.bN=To,s.bO=Us,s.bP=f1,s.bQ=vb,s.bR=y1,s.bS=v1,s.bT=Xy,s.bU=Bw,s.bV=ev,s.bW=Cv,s.bX=Ne,s.bY=Ht,s.bZ=aa,s.b_=Zs,s.ba=rl,s.bb=Cs,s.bc=T,s.bd=$n,s.be=Em,s.bf=av,s.bg=function(n,e){const r=sn(e.zoom);if(r===0)return Ge(n);const o=Jt(n),a=Ir(o),u=pe(o.getWest())*e.worldSize,h=pe(o.getEast())*e.worldSize,g=ue(o.getNorth())*e.worldSize,v=ue(o.getSouth())*e.worldSize,x=[u,g,0],E=[h,g,0],A=[u,v,0],C=[h,v,0],k=ct([],e.globeMatrix);return Ar(x,x,k),Ar(E,E,k),Ar(A,A,k),Ar(C,C,k),a[0]=_t(a[0],A,r),a[1]=_t(a[1],C,r),a[2]=_t(a[2],E,r),a[3]=_t(a[3],x,r),Tn.fromPoints(a)},s.bh=at,s.bi=ct,s.bj=Or,s.bk=_t,s.bl=Yu,s.bm=p,s.bn=Kt,s.bo=Dt,s.bp=S_,s.bq=Wg,s.br=mh,s.bs=function(n,e){const r=[];for(const o in n)o in e||r.push(o);return r},s.bt=Ce,s.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.bv=ws,s.bw=function(n){var e=new be(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},s.bx=Be,s.by=hr,s.bz=Xt,s.c=ad,s.c$=Gg,s.c0=la,s.c1=xi,s.c2=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},s.c3=Cr,s.c4=function(n,e,r,o,a){var u,h=1/Math.tan(e/2);return n[0]=h/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=h,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,a!=null&&a!==1/0?(n[10]=(a+o)*(u=1/(o-a)),n[14]=2*a*o*u):(n[10]=-1,n[14]=-2*o),n},s.c5=function(n,e,r,o,a,u,h){var g=1/(e-r),v=1/(o-a),x=1/(u-h);return n[0]=-2*g,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*v,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*x,n[11]=0,n[12]=(e+r)*g,n[13]=(a+o)*v,n[14]=(h+u)*x,n[15]=1,n},s.c6=ye,s.c7=function(n,e,r){n[4*e+0]=r[0],n[4*e+1]=r[1],n[4*e+2]=r[2],n[4*e+3]=r[3]},s.c8=au,s.c9=Er,s.cA=f_,s.cB=oi,s.cC=pb,s.cD=function(n){const e=pb(n,!0);return Se([],[e[0],e[1],e[4],e[5]])},s.cE=Vt,s.cF=kn,s.cG=jt,s.cH=function(n){const{x:e,y:r}=n.point,{lng:o,lat:a}=n._center;return Jr(e,r,n.worldSize,o,a)},s.cI=un,s.cJ=Oe,s.cK=xc,s.cL=w,s.cM=function(n,e,r){let o=0;for(let a=0;a<2;++a)n[a]>0&&(o+=(n[a]-0)*(n[a]-0)),e[a]<0&&(o+=(0-e[a])*(0-e[a]));return o},s.cN=function(n){return n*n*n*n*n},s.cO=_e,s.cP=45,s.cQ=kl,s.cR=function(n,e,r){const o=Math.sqrt(n*n+e*e+r*r),a=o>0?Math.acos(r/o)*fo:0;let u=n!==0||e!==0?Math.atan2(-e,-n)*fo+90:0;return u<0&&(u+=360),[o,u,a]},s.cS=Mr,s.cT=ti,s.cU=$e,s.cV=rn,s.cW=Tn,s.cX=nn,s.cY=function(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]},s.cZ=pv,s.c_=function(n,e){return n.readFields(vM,{icons:[]},e)},s.ca=On,s.cb=il,s.cc=nh,s.cd=J,s.ce=Kw,s.cf=function(){var n=new be(4);return be!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},s.cg=function(n,e,r){var o=e[0],a=e[1],u=e[2],h=e[3],g=Math.sin(r),v=Math.cos(r);return n[0]=o*v+u*g,n[1]=a*v+h*g,n[2]=o*-g+u*v,n[3]=a*-g+h*v,n},s.ch=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},s.ci=us,s.cj=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},s.ck=ca,s.cl=qi,s.cm=Zf,s.cn=ri,s.co=mb,s.cp=rd,s.cq=rr,s.cr=function(n,e,r,o,a,u,h,g,v){if(v.name==="globe")return rr(n,e,new rd(r,o,a),!1);const x=Gm({z:r,x:o,y:a},v);return new Tn([(u+x.x/x.scale)*e,e*(x.y/x.scale),h],[(u+x.x2/x.scale)*e,e*(x.y2/x.scale),g])},s.cs=function(n,e,r){return n[0]=Math.min(e[0],r[0]),n[1]=Math.min(e[1],r[1]),n[2]=Math.min(e[2],r[2]),n[3]=Math.min(e[3],r[3]),n},s.ct=function(n,e,r){return n[0]=Math.max(e[0],r[0]),n[1]=Math.max(e[1],r[1]),n[2]=Math.max(e[2],r[2]),n[3]=Math.max(e[3],r[3]),n},s.cu=function(n){const e=Math.round((n+45+360)%360/90)%4;return Y[e]},s.cv=Ye,s.cw=Ho,s.cx=S,s.cy=function(n){const e=Be(new Float64Array(16));Tt(e,n.pixelMatrix,n.globeMatrix);const r=[0,D,0],o=[0,F,0];return Ar(r,r,e),Ar(o,o,e),[r[0]>0&&r[0]<=n.width&&r[1]>0&&r[1]<=n.height&&!En(n,new J(n.center.lat,90)),o[0]>0&&o[0]<=n.width&&o[1]>0&&o[1]<=n.height&&!En(n,new J(n.center.lat,-90))]},s.cz=function(n,e){const{scale:r}=n.tileTransform,o=r*Ct/(n.tileSize*Math.pow(2,e.zoom-n.tileID.overscaledZ+n.tileID.canonical.z));return function(a,u,h){var g=u[1],v=u[2],x=u[3],E=h[0],A=h[1];return a[0]=u[0]*E,a[1]=g*E,a[2]=v*A,a[3]=x*A,a}(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},s.d=function(n){return bs.API_TILEJSON_REGEX.test(n)},s.d$=qd,s.d0=$p,s.d1=Jy,s.d2=ph,s.d3=mc,s.d4=Ys,s.d5=zc,s.d6=_r,s.d7=function(n){const e=n.indexOf(_c);return e>=0?n.slice(0,e):n},s.d8=function(n){return n.indexOf(_c)>=0},s.d9=function(n){const e=n.lastIndexOf(_c);return e>=0?n.slice(e+1):""},s.dA=or,s.dB=Ui,s.dC=$s,s.dD=256,s.dE=function(n,e){const r=[0,0,0];return Ar(r,r,at(Ge(e.canonical))),Ar(r,r,n),r},s.dF=n=>({u_matrix:new nh(n),u_texsize:new il(n),u_pixels_to_tile_units:new cu(n),u_device_pixel_ratio:new On(n),u_width_scale:new On(n),u_floor_width_scale:new On(n),u_image:new au(n),u_units_to_pixels:new il(n),u_tile_units_to_pixels:new On(n),u_alpha_discard_threshold:new On(n),u_trim_offset:new il(n),u_trim_fade_range:new il(n),u_trim_color:new kl(n),u_emissive_strength:new On(n),u_zbias_factor:new On(n),u_tile_to_meter:new On(n),u_ground_shadow_factor:new Er(n),u_pattern_transition:new On(n)}),s.dG=n=>({u_matrix:new nh(n),u_pixels_to_tile_units:new cu(n),u_device_pixel_ratio:new On(n),u_width_scale:new On(n),u_floor_width_scale:new On(n),u_units_to_pixels:new il(n),u_dash_image:new au(n),u_gradient_image:new au(n),u_image_height:new On(n),u_texsize:new il(n),u_tile_units_to_pixels:new On(n),u_alpha_discard_threshold:new On(n),u_trim_offset:new il(n),u_trim_fade_range:new il(n),u_trim_color:new kl(n),u_emissive_strength:new On(n),u_zbias_factor:new On(n),u_tile_to_meter:new On(n),u_ground_shadow_factor:new Er(n)}),s.dH=n=>({u_camera_to_center_distance:new On(n),u_extrude_scale:new cu(n),u_device_pixel_ratio:new On(n),u_matrix:new nh(n),u_inv_rot_matrix:new nh(n),u_merc_center:new il(n),u_tile_id:new Er(n),u_zoom_transition:new On(n),u_up_dir:new Er(n),u_emissive_strength:new On(n)}),s.dI=Hh,s.dJ=TC,s.dK=j0,s.dL=(n,e,r,o,a,u)=>{const h=n.transform,g=h.projection.name==="globe";let v;if(u.paint.get("circle-pitch-alignment")==="map")if(g){const E=or(h.zoom,e.canonical)*h._pixelsPerMercatorPixel;v=Float32Array.from([E,0,0,E])}else v=h.calculatePixelsToTileUnitsMatrix(r);else v=new Float32Array([h.pixelsToGLUnits[0],0,0,h.pixelsToGLUnits[1]]);const x={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(h.projection),u_matrix:n.translatePosMatrix(e.projMatrix,r,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ha.devicePixelRatio,u_extrude_scale:v,u_inv_rot_matrix:wy,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(g){x.u_inv_rot_matrix=o,x.u_merc_center=a,x.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],x.u_zoom_transition=sn(h.zoom);const E=a[0]*Ct,A=a[1]*Ct;x.u_up_dir=h.projection.upVector(new rd(0,0,0),E,A)}return x},s.dM=lw,s.dN=go,s.dO=(n,e,r,o,a,u,h,g,v,x)=>{const E=n.transform,A=E.pitch<15?sw(.07,.7,me((14-E.zoom)/5,0,1)):.07,C=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:aw(n,e,r,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:E.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:a,u_width_scale:u,u_floor_width_scale:h,u_image:0,u_tile_units_to_pixels:ow(e,E),u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:g,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toPremultipliedRenderColor(C?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:A,u_tile_to_meter:$e(e.tileID.canonical,0),u_ground_shadow_factor:v,u_pattern_transition:x}},s.dP=(n,e,r,o,a,u,h,g,v,x)=>{const E=n.transform,A=E.calculatePixelsToTileUnitsMatrix(e),C=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none",k=E.pitch<15?sw(.07,.7,me((14-E.zoom)/5,0,1)):.07;return{u_matrix:aw(n,e,r,o),u_pixels_to_tile_units:A,u_device_pixel_ratio:u,u_width_scale:h,u_floor_width_scale:g,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:cw(r)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ow(e,n.transform),u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toPremultipliedRenderColor(C?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:k,u_tile_to_meter:$e(e.tileID.canonical,0),u_ground_shadow_factor:x}},s.dQ=Et,s.dR=Sm,s.dS=Le,s.dT=xy,s.dU=Ug,s.dV=z1,s.dW=ef,s.dX=450,s.dY=7,s.dZ=iM,s.d_=pn,s.da=function(n){const e=[],r=n.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},s.db=function(n,e,r,o){return n.type==="custom"?new sM(n,e):new _M[n.type](n,e,r,o)},s.dc=mr,s.dd=function(n){const e=n.indexOf(_c);return e>=0?n.slice(e+1):""},s.de=class extends Kp{constructor(n,e){super(n._vectorTileFeature,n._z,n._x,n._y,n.id),n.state&&(this.state=Object.assign({},n.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=n.source,this.sourceLayer=n.sourceLayer,this.layer=n.layer)}toJSON(){const n=super.toJSON();return n.target=this.target,n.namespace=this.namespace,n}},s.df=Li,s.dg=Na,s.dh=function(n){return n({pluginStatus:js,pluginURL:No}),Li.on("pluginStateChange",n),n},s.di=Xd,s.dj=class extends zl{constructor(n){super(n),this.current=lu}set(n,e,r){if(this.fetchUniformLocation(n,e)){for(let o=0;o<9;o++)if(r[o]!==this.current[o]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},s.dk=Q,s.dl=function(n,e,r){const o=sn(r.zoom),a=n.style.map._antialias,u=n.terrain&&n.terrain.exaggeration()>0;return o===0&&!a&&!u},s.dm=function(n){const e=n.pixelsPerMeter,r=e/ye(1,n.center.lat),o=Be(new Float64Array(16));return Dt(o,o,[n.point.x,n.point.y,0]),Vt(o,o,[r,r,e]),Float32Array.from(o)},s.dn=Jt,s.dp=function(n){const e=Ye-5;n=me(n,-80.051129,e)/e*90;const r=Math.pow(Math.abs(Math.sin(en(n))),3);return Math.round(r*(O.length-1))},s.dq=function(n,e,r,o){const a=e.getNorth(),u=e.getSouth(),h=e.getWest(),g=e.getEast(),v=1<<n.z,x=g-h,E=a-u,A=x/P,C=-E/O[r],k=[0,A,0,C,0,0,a,h,0];if(n.z>0){const L=180/o;wt(k,k,[L/x+1,0,0,0,L/E+1,0,-.5*L/A,.5*L/C,1])}return k[2]=v,k[5]=n.x,k[8]=n.y,k},s.dr=Ge,s.ds=function(n,e,r){const o=Be(new Float64Array(16)),a=(e/(1<<n)-.5)*Math.PI*2;return vr(o,r.globeMatrix,a),Float32Array.from(o)},s.dt=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const r=e.getSource().maxzoom,o=1<<r,a=Math.floor(n.x),u=Math.floor((n.x-a)*o),h=Math.floor(n.y*o),g=this.findDEMTileFor(new io(r,a,r,u,h));return!(!g||!g.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const o=this._source();if(!o||n.y<0||n.y>1)return e;const a=o.getSource().maxzoom,u=1<<a,h=Math.floor(n.x),g=n.x-h,v=new io(a,h,a,Math.floor(g*u),Math.floor(n.y*u)),x=this.findDEMTileFor(v);if(!x||!x.dem)return e;const E=x.dem,A=1<<x.tileID.canonical.z,C=(g*A-x.tileID.canonical.x)*E.dim,k=(n.y*A-x.tileID.canonical.y)*E.dim,L=Math.floor(C),j=Math.floor(k);return(r?this.exaggeration():1)*lr(lr(E.get(L,j),E.get(L,j+1),k-j),lr(E.get(L+1,j),E.get(L+1,j+1),k-j),C-L)}getAtTileOffset(n,e,r){const o=1<<n.canonical.z;return this.getAtPointOrZero(new Ie(n.wrap+(n.canonical.x+e/Ct)/o,(n.canonical.y+r/Ct)/o))}getAtTileOffsetFunc(n,e,r,o){return a=>{const u=this.getAtTileOffset(n,a.x,a.y),h=o.upVector(n.canonical,a.x,a.y);return Ht(h,h,u*o.upVectorScale(n.canonical,e,r).metersToTile),h}}getForTilePoints(n,e,r,o){if(this.isUsingMockSource())return!1;const a=Wp.create(this,n,o);return!!a&&(e.forEach(u=>{u[2]=this.exaggeration()*a.getElevationAt(u[0],u[1],r)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const r=e.dem.tree,o=e.tileID,a=1<<n.canonical.z-o.canonical.z;let u=n.canonical.x/a-o.canonical.x,h=n.canonical.y/a-o.canonical.y,g=0;for(let v=0;v<n.canonical.z-o.canonical.z&&!r.leaves[g];v++){u*=2,h*=2;const x=2*Math.floor(h)+Math.floor(u);g=r.childOffsets[g]+x,u%=1,h%=1}return{min:this.exaggeration()*r.minimums[g],max:this.exaggeration()*r.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const n=this.visibleDemTiles;if(n.length===0)return null;let e=!1,r=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const a of n){const u=this.getMinMaxForTile(a.tileID);u&&(r=Math.min(r,u.min),o=Math.max(o,u.max),e=!0)}return e?{min:r,max:o}:null}},s.du=Y0,s.dv=R,s.dw=function(n,e){return[Math.pow(n[0],2.2)*e,Math.pow(n[1],2.2)*e,Math.pow(n[2],2.2)*e]},s.dx=Me,s.dy=function(n,e){var r=Math.sin(e),o=Math.cos(e);return n[0]=o,n[1]=r,n[2]=0,n[3]=-r,n[4]=o,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},s.dz=Pi,s.e=bs,s.e$=c2,s.e0=256,s.e1=et,s.e2=Ra,s.e3=vr,s.e4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},s.e5=Rl,s.e6=Qu,s.e7=Za,s.e8=function(n,e,r,o,a){return me((n-e)/(r-e)*(a-o)+o,o,a)},s.e9=ho,s.eA=function(n,e,r){return n[0]=e[0]/r[0],n[1]=e[1]/r[1],n[2]=e[2]/r[2],n},s.eB=xn,s.eC=V,s.eD=Pr,s.eE=function(n,e,r,o){return n[0]=e,n[1]=r,n[2]=o,n},s.eF=function([n,e,r]){const o=Math.hypot(n,e,r),a=Math.atan2(n,r),u=.5*Math.PI-Math.acos(-e/o);return new J(Oe(a),Oe(u))},s.eG=Ul,s.eH=dv,s.eI=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!function(r){if(gi==null){const o=r.navigator?r.navigator.userAgent:null;gi=!!r.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return gi}(n)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.eJ=function(n,e){Xo=n,Yn=e},s.eK=En,s.eL=mn,s.eM=function(n){const e=[0,0,0],r=Be(new Float64Array(16));return Tt(r,n.pixelMatrix,n.globeMatrix),Ar(e,e,r),new ft(e[0],e[1])},s.eN=function(){const n=Lm;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(Oy),Lm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.eO=function(){Gg().acquire(Oy)},s.eP=Il,s.eQ=function(n,e,r=!1){if(js===Bs.deferred||js===Bs.loading||js===Bs.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");No=ha.resolveURL(n),js=Bs.deferred,El=e,Wu(),r||zd()},s.eR=function(n){Bp=ha.resolveURL(n),jp||(jp=new Np(Gg(),new Jl)),jp.broadcast("setMeshoptUrl",Bp)},s.eS=q1,s.eT=function(n){Ny=ha.resolveURL(n),jp||(jp=new Np(Gg(),new Jl)),jp.broadcast("setDracoUrl",Ny)},s.eU=G1,s.eV=Dm,s.eW=function(n){const e=Wl();if(!e)return;const r=e.delete(fl);n&&r.then(()=>n()).catch(n)},s.eX=Jf,s.eY=Ft,s.eZ=Qd,s.e_=fu,s.ea=function(n,e){var r=e[0],o=e[1],a=e[2],u=e[3],h=e[4],g=e[5],v=e[6],x=e[7],E=e[8],A=E*h-g*x,C=-E*u+g*v,k=x*u-h*v,L=r*A+o*C+a*k;return L?(n[0]=A*(L=1/L),n[1]=(-E*o+a*x)*L,n[2]=(g*o-a*h)*L,n[3]=C*L,n[4]=(E*r-a*v)*L,n[5]=(-g*r+a*u)*L,n[6]=k*L,n[7]=(-x*r+o*v)*L,n[8]=(h*r-o*u)*L,n):null},s.eb=Hr,s.ec=ot,s.ed=fv,s.ee=function(n,e){if(n===e){var r=e[1],o=e[2],a=e[3],u=e[6],h=e[7],g=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=r,n[6]=e[9],n[7]=e[13],n[8]=o,n[9]=u,n[11]=e[14],n[12]=a,n[13]=h,n[14]=g}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n},s.ef=fn,s.eg=[1,1,1],s.eh=class{constructor(n,e,r,o){this.context=n,this.format=o,this.size=r,this.texture=n.gl.createTexture();const[a,u,h]=this.size,{gl:g}=n;g.bindTexture(g.TEXTURE_3D,this.texture),n.pixelStoreUnpackFlipY.set(!1),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(!1),g.texImage3D(g.TEXTURE_3D,0,this.format,a,u,h,0,lv(this.format),cv(this.format),e.data)}bind(n,e){const{context:r}=this,{gl:o}=r;o.bindTexture(o.TEXTURE_3D,this.texture),n!==this.minFilter&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,n),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,n),this.minFilter=n),e!==this.wrapS&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}},s.ei=Wp,s.ej=function(n,e,r,o){var a=new be(4);return a[0]=n,a[1]=e,a[2]=r,a[3]=o,a},s.ek=hs,s.el=function(n,e,r,o){var a=e[0],u=e[1],h=e[2],g=e[3];return n[0]=a+o*(r[0]-a),n[1]=u+o*(r[1]-u),n[2]=h+o*(r[2]-h),n[3]=g+o*(r[3]-g),n},s.em=Hp,s.en=Pl,s.eo=nu,s.ep=function(n,e,r,o,a,u,h,g,v,x,E,A,C,k,L,j){var G=new be(16);return G[0]=n,G[1]=e,G[2]=r,G[3]=o,G[4]=a,G[5]=u,G[6]=h,G[7]=g,G[8]=v,G[9]=x,G[10]=E,G[11]=A,G[12]=C,G[13]=k,G[14]=L,G[15]=j,G},s.eq=W,s.er=Wh,s.es=Gd,s.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new ft(1/0,1/0),max:new ft(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(n,e=!1){const r=m1(new ft(0,0),new ft(Ct,Ct),n),o=[];if(e&&!Ry(r,this._globalClipBounds))return o;for(const a of this._activeRegions){if(a.hiddenByOverlap||!Ry(r,a))continue;const u=jA(a.min,a.max,n);o.push({min:u.min,max:u.max,sourceId:this._sourceIds[a.priority],footprint:a.footprint,footprintTileId:a.tileId,order:a.order,clipMask:a.clipMask,clipScope:a.clipScope})}return o}setSources(n){this._setSources(n.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const r=[];for(const o of e.cache.getVisibleCoordinates()){const a=e.cache.getTile(o).buckets[e.layer];a&&a.updateFootprints(o.toUnwrapped(),r)}return r},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(n){const e=n.getFootprints();if(e.length===0)return;const r=n.getOrder(),o=n.getClipMask(),a=n.getClipScope();for(const u of e){if(!u.footprint)continue;const h=m1(u.footprint.min,u.footprint.max,u.id);this._activeRegions.push({min:h.min,max:h.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:u.id,footprint:u.footprint,order:r,clipMask:o,clipScope:a})}this._sourceIds.push(n.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,r)=>e.priority-r.priority||jg(e.min,r.min)||jg(e.max,r.max)||e.order-r.order||e.clipMask-r.clipMask||function(o,a){const u=(h,g)=>h+g;return o.length-a.length||o.reduce(u,"").localeCompare(a.reduce(u,""))}(e.clipScope,r.clipScope));let n=this._activeRegions.length!==this._prevRegions.length;if(!n){let e=0;for(;!n&&e!==this._activeRegions.length;){const r=this._activeRegions[e],o=this._prevRegions[e];n=r.priority!==o.priority||!p1(r,o)||r.order!==o.order||r.clipMask!==o.clipMask||!ws(r.clipScope,o.clipScope),++e}}if(n){++this._updateTime;for(const r of this._activeRegions)r.order!==Bg&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,r.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,r.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,r.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,r.max.y));const e=r=>{const o=this._activeRegions;if(r>=o.length)return r;const a=o[r].priority;for(;r<o.length&&o[r].priority===a;)++r;return r};if(this._sourceIds.length>1){let r=0,o=e(r);for(;r!==o;){let a=r;const u=r;for(;a!==o;){const h=this._activeRegions[a];h.hiddenByOverlap=!1;for(let g=0;g<u;g++){const v=this._activeRegions[g];if(!v.hiddenByOverlap&&h.order===Bg&&Ry(h,v)&&(h.hiddenByOverlap=_1(h.footprint,h.tileId,v.footprint,v.tileId),h.hiddenByOverlap))break}++a}r=o,o=e(r)}}}}_setSources(n){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=n.length-1;e>=0;e--)this._addSource(n[e]);this._computeReplacement()}},s.eu=Bg,s.ev=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy()}_fillGridMeshWithLods(n,e){const r=new rl,o=new as,a=[],u=n+1+2,h=e[0]+1,g=e[0]+1+(1+e.length),v=(x,E,A)=>{let C=x===u-1?x-2:x===0?x:x-1;return C+=A?24575:0,[C,E]};for(let x=0;x<u;++x)r.emplaceBack(...v(x,0,!0));for(let x=0;x<h;++x)for(let E=0;E<u;++E)r.emplaceBack(...v(E,x,(E===0||E===u-1)&&!0));for(let x=0;x<e.length;++x){const E=e[x];for(let A=0;A<u;++A)r.emplaceBack(...v(A,E,!0))}for(let x=0;x<e.length;++x){const E=o.length,A=e[x]+1+2,C=new as;for(let j=0;j<A-1;j++){const G=j===A-2,K=G?u*(g-e.length+x-j):u;for(let te=0;te<u-1;te++){const ne=j*u+te;j===0||G||te===0||te===u-2?(C.emplaceBack(ne+1,ne,ne+K),C.emplaceBack(ne+K,ne+K+1,ne+1)):(o.emplaceBack(ne+1,ne,ne+K),o.emplaceBack(ne+K,ne+K+1,ne+1))}}const k=$n.simpleSegment(0,E,r.length,o.length-E);for(let j=0;j<C.uint16.length;j+=3)o.emplaceBack(C.uint16[j],C.uint16[j+1],C.uint16[j+2]);const L=$n.simpleSegment(0,E,r.length,o.length-E);a.push({withoutSkirts:k,withSkirts:L})}return{vertices:r,indices:o,segments:a}}_createGrid(n){const e=this._fillGridMeshWithLods(P,O);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,T.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new as;for(let h=0;h<=P;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const r=new Rl,o=new Rl,a=new Rl,u=new Rl;this._poleSegments=[];for(let h=0,g=0;h<w;h++){const v=360/(1<<h);r.emplaceBack(0,-y,0,.5,0),o.emplaceBack(0,-y,0,.5,1),a.emplaceBack(0,-y,0,.5,.5),u.emplaceBack(0,-y,0,.5,.5);for(let x=0;x<=P;x++){let E=x/P,A=0;const C=lr(0,v,E),[k,L,j]=q(Ei,sh,C,y);r.emplaceBack(k,L,j,E,A),o.emplaceBack(k,L,j,E,1-A);const G=en(C);E=.5+.5*Math.sin(G),A=.5+.5*Math.cos(G),a.emplaceBack(k,L,j,E,A),u.emplaceBack(k,L,j,E,1-A)}this._poleSegments.push($n.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(r,d,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(o,d,!1),this._texturedPoleNorthVertexBuffer=n.createVertexBuffer(a,d,!1),this._texturedPoleSouthVertexBuffer=n.createVertexBuffer(u,d,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}},s.ew=he,s.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.ey=we,s.ez=ze,s.f=function(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(e,r)=>String.fromCharCode(+("0x"+r))))},s.f0=u2,s.f1=tw,s.f2=Wr,s.f3="hd_road_elevation",s.f4=na,s.f5=Yt,s.f6=Yf,s.f7=Ky,s.f8=Qf,s.f9=function(n,e,r,o,a,u,h,g=1,v,x,E){n.createArrays(),n.tilePixelRatio=Ct/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const A=n.layers[0].layout,C=n.layers[0]._unevaluatedLayout._values,k={};k.scaleFactor=g,k.textSizeScaleRange=A.get("text-size-scale-range"),k.iconSizeScaleRange=A.get("icon-size-scale-range");const[L,j]=k.textSizeScaleRange,[G,K]=k.iconSizeScaleRange;k.textScaleFactor=me(k.scaleFactor,L,j),k.iconScaleFactor=me(k.scaleFactor,G,K);const te=C["text-size"],ne=C["icon-size"];if(n.textSizeData.kind==="composite"){const{minZoom:ve,maxZoom:Ee}=n.textSizeData;k.compositeTextSizes=[te.possiblyEvaluate(new zn(ve,{worldview:E}),u),te.possiblyEvaluate(new zn(Ee,{worldview:E}),u)]}if(n.iconSizeData.kind==="composite"){const{minZoom:ve,maxZoom:Ee}=n.iconSizeData;k.compositeIconSizes=[ne.possiblyEvaluate(new zn(ve,{worldview:E}),u),ne.possiblyEvaluate(new zn(Ee,{worldview:E}),u)]}k.layoutTextSize=te.possiblyEvaluate(new zn(h+1,{worldview:E}),u),k.layoutIconSize=ne.possiblyEvaluate(new zn(h+1,{worldview:E}),u),k.textMaxSize=te.possiblyEvaluate(new zn(18,{worldview:E}),u);const U=A.get("symbol-placement"),ee=A.get("text-rotation-alignment")==="map"&&U!=="point",ie=A.get("text-size");let ae=!1;const Te=[];for(const ve of n.features){const Ee=A.get("text-font").evaluate(ve,{},u).join(","),Re=ie.evaluate(ve,{},u)*k.textScaleFactor,He=k.layoutTextSize.evaluate(ve,{},u)*k.textScaleFactor,ht=k.layoutIconSize.evaluate(ve,{},u)*k.iconScaleFactor,it={horizontal:{},vertical:void 0},ut=ve.text;let mt,Ze=[0,0];if(ut){const pr=ut.toString(),Fr=A.get("text-letter-spacing").evaluate(ve,{},u)*Us,kr=A.get("text-line-height").evaluate(ve,{},u)*Us,Zr=pc(pr)?Fr:0,jr=A.get("text-anchor").evaluate(ve,{},u),Xr=A.get("text-variable-anchor");if(!Xr){const Ke=A.get("text-radial-offset").evaluate(ve,{},u);if(Ke)Ze=Bw(jr,[Ke*Us,Qy]);else{const St=A.get("text-offset").evaluate(ve,{},u);Ze=[St[0]*Us,St[1]*Us]}}let Dn=ee?"center":A.get("text-justify").evaluate(ve,{},u);const ni=U==="point",oe=ni?A.get("text-max-width").evaluate(ve,{},u)*Us:1/0,fe=Ke=>{n.allowVerticalPlacement&&ea(pr)&&(it.vertical=Zy(ut,e,r,a,Ee,oe,kr,jr,Ke,Zr,Ze,La.vertical,!0,He,Re,v))};if(!ee&&Xr){const Ke=Dn==="auto"?Xr.map(kt=>ev(kt)):[Dn];let St=!1;for(let kt=0;kt<Ke.length;kt++){const Rt=Ke[kt];if(!it.horizontal[Rt])if(St)it.horizontal[Rt]=it.horizontal[0];else{const Ut=Zy(ut,e,r,a,Ee,oe,kr,"center",Rt,Zr,Ze,La.horizontal,!1,He,Re,v);Ut&&(it.horizontal[Rt]=Ut,St=Ut.positionedLines.length===1)}}fe("left")}else{if(Dn==="auto"&&(Dn=ev(jr)),ni||A.get("text-writing-mode").indexOf("horizontal")>=0||!ea(pr)){const Ke=Zy(ut,e,r,a,Ee,oe,kr,jr,Dn,Zr,Ze,La.horizontal,!1,He,Re,v);Ke&&(it.horizontal[Dn]=Ke)}fe(ni?"left":Dn)}}let lt,qe,We,xt,bt,ir,qt=!1;const zt=A.get("icon-text-fit").evaluate(ve,{},u);if(ve.icon&&ve.icon.hasPrimary()){const pr=Vw(ve.icon,n.iconSizeData,C["icon-size"],u,n.zoom,ve,v,k.iconScaleFactor,E);lt=pr.iconPrimary,We=pr.iconSecondary;const Fr=lt.toString();if(qe=o.get(Fr),qe&&(bt=A.get("icon-offset").evaluate(ve,{},u),ir=A.get("icon-anchor").evaluate(ve,{},u),mt=DC(a.get(Fr),We?a.get(We.toString()):void 0,bt,ir),qt=qe.sdf,n.sdfIcons===void 0?n.sdfIcons=qe.sdf:n.sdfIcons!==qe.sdf&&Rr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(qe.pixelRatio!==n.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0)),We){const kr=We.toString();xt=o.get(kr)}}ae=ae||!(!ve.icon||!ve.icon.hasSecondary());const yt=tv(it.horizontal)||it.vertical;n.iconsInText||(n.iconsInText=!!yt&&yt.iconsInText);const wr=He*k.textScaleFactor/Us,{defaultShapedIcon:Gt,verticallyShapedIcon:Zt}=GC(n,mt,A,ve,u,it,wr,bt,zt);zt!=="none"&&mt&&(Tw(mt)||Sw(mt))&&(Qg(0,qe,lt,mt,Gt,zt,x,o,a),Qg(0,xt,We,mt,Gt,zt,x,o,a),Zt&&(Qg(0,qe,lt,mt,Zt,zt,x,o,a),Qg(0,xt,We,mt,Zt,zt,x,o,a))),mt=Gt,Te.push({feature:ve,shapedTextOrientations:it,shapedText:yt,shapedIcon:mt,iconPrimary:lt,iconSecondary:We,iconOffset:bt,iconAnchor:ir,verticallyShapedIcon:Zt,layoutTextSize:He,layoutIconSize:ht,textOffset:Ze,isSDFIcon:qt,iconTextFit:zt})}return{featureData:Te,sizes:k,hasAnySecondaryIcon:ae,textAlongLine:ee,symbolPlacement:U}},s.fa=kw,s.fb=function(n,e,r,o,a,u,h,g,v,x){const{featureData:E,hasAnySecondaryIcon:A,sizes:C,textAlongLine:k,symbolPlacement:L}=e;for(const j of E){const{shapedIcon:G,verticallyShapedIcon:K,feature:te,shapedTextOrientations:ne,shapedText:U,layoutTextSize:ee,textOffset:ie,isSDFIcon:ae,iconPrimary:Te,iconSecondary:ve,iconTextFit:Ee,iconOffset:Re}=j;Uw(G,x.iconPositions,Te,ve),Uw(K,x.iconPositions,Te,ve),$C(ne,x.iconPositions),UC(Te,ve,x.iconPositions),(U||G)&&qC(n,te,ne,G,K,v,C,ee,0,ie,ae,o,a,h,g,A,Ee,Re,k,L)}r&&n.generateCollisionDebugBuffers(u,n.collisionBoxArray,C.textScaleFactor)},s.fc=Lr,s.fd=T_,s.fe=Wi,s.ff=yr,s.fg=mw,s.fh=Qr,s.fi=function(n){let e=0;if(new Uint32Array(n,0,1)[0]!==W1){const r=new Uint32Array(n,0,7),[,,o,a,u,h]=r;e=r.byteLength+a+u+h+u,(o!==n.byteLength||e>=n.byteLength)&&Rr("Invalid b3dm header information.")}return K1(n,e)},s.fj=function(n,e){const r=l2(n);for(const o of r){for(const a of o.meshes)pP(a);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(mP(o.lights,e)))}return r},s.fk=__,s.fl=An,s.fm=U1,s.fn=Ma,s.fo=Bs,s.fp=function(n){Mc(),Ta?.then(e=>{e.keys().then(r=>{for(let o=0;o<r.length-n;o++)e.delete(r[o]).catch(a=>Rr(a.message))}).catch(r=>Rr(r.message))}).catch(e=>Rr(e.message))},s.g=function(n,e){return Na(je(n,{method:"GET"}),e)},s.h=je,s.i=function(n){return bs.API_STYLE_REGEX.test(n)&&!ad(n)},s.j=function(n){return n.indexOf("mapbox:")===0},s.k=$l,s.l=fh,s.m=function(n){return decodeURIComponent(atob(n).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.n=function(n,e){return Na(je(n,{type:"json"}),e)},s.o=Pc,s.p=function(n,e){return Na(je(n,{method:"POST"}),e)},s.q=ha,s.r=so,s.s=function(n){try{const e=self[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=_u,s.u=function(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()},s.v=function(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)},s.w=Rr,s.x=function(){return Fy||(Fy=new Jf),Fy},s.y=Tv,s.z=Sa}),$(["./shared"],function(s){function ce(Oe){const Y=Oe?Oe.url.toString():void 0;return Y?performance.getEntriesByName(Y):[]}function be(Oe){if(typeof Oe=="number"||typeof Oe=="boolean"||typeof Oe=="string"||Oe==null)return JSON.stringify(Oe);if(Array.isArray(Oe)){let Q="[";for(const he of Oe)Q+=`${be(he)},`;return`${Q}]`}let Y="{";for(const Q of Object.keys(Oe).sort())Y+=`${Q}:${be(Oe[Q])},`;return`${Y}}`}function Se(Oe){let Y="";for(const Q of s.bu)Y+=`/${be(Oe[Q])}`;return Y}class Me{constructor(Y){this.keyCache={},this._layers={},this._layerConfigs={},Y&&this.replace(Y)}replace(Y,Q){this._layerConfigs={},this._layers={},this.update(Y,[],Q)}update(Y,Q,he){this._options=he;for(const me of Y)this._layerConfigs[me.id]=me,(this._layers[me.id]=s.db(me,this.scope,null,this._options)).compileFilter(he),this.keyCache[me.id]&&delete this.keyCache[me.id];for(const me of Q)delete this.keyCache[me],delete this._layerConfigs[me],delete this._layers[me];this.familiesBySource={};const we=function(me,Ae){const Ne={};for(let je=0;je<me.length;je++){const nt=me[je];let Ue=Ae&&Ae[nt.id];Ue||(nt.type==="symbol"?Ue=nt.id:(Ue=Se(nt),nt.type==="line"&&nt.paint&&function $t(Yt){return typeof Yt=="string"&&Yt==="line-progress"||(Array.isArray(Yt)?Yt.some($t):!(!Yt||typeof Yt!="object")&&Object.values(Yt).some($t))}(nt.paint["line-width"])&&(Ue+=`/${be(nt.paint["line-width"])}`))),Ae&&(Ae[nt.id]=Ue);let Et=Ne[Ue];Et||(Et=Ne[Ue]=[]),Et.push(nt)}const Ce=[];for(const je in Ne)Ce.push(Ne[je]);return Ce}(Object.values(this._layerConfigs),this.keyCache);for(const me of we){const Ae=me.map(Et=>this._layers[Et.id]),Ne=Ae[0];if(Ne.visibility==="none")continue;const Ce=Ne.source||"";let je=this.familiesBySource[Ce];je||(je=this.familiesBySource[Ce]={});const nt=Ne.sourceLayer||"_geojsonTileLayer";let Ue=je[nt];Ue||(Ue=je[nt]=[]),Ue.push(Ae)}}}const tt=1*s.e_;class wt{constructor(Y){const Q={},he=[];for(const Ne in Y){const Ce=Y[Ne],je=Q[Ne]={};for(const nt in Ce.glyphs){const Ue=Ce.glyphs[+nt];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const Et=Ue.metrics.localGlyph?tt:1,$t={x:0,y:0,w:Ue.bitmap.width+2*Et,h:Ue.bitmap.height+2*Et};he.push($t),je[nt]=$t}}const{w:we,h:me}=s.H(he),Ae=new s.eZ({width:we||1,height:me||1});for(const Ne in Y){const Ce=Y[Ne];for(const je in Ce.glyphs){const nt=Ce.glyphs[+je];if(!nt||nt.bitmap.width===0||nt.bitmap.height===0)continue;const Ue=Q[Ne][je],Et=nt.metrics.localGlyph?tt:1;s.eZ.copy(nt.bitmap,Ae,{x:0,y:0},{x:Ue.x+Et,y:Ue.y+Et},nt.bitmap)}}this.image=Ae,this.positions=Q}}s.eY(wt,"GlyphAtlas");class Xt{constructor(Y){this.tileID=new s.aM(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.lut=Y.lut,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.scope=Y.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.request&&Y.request.collectResourceTiming,this.promoteId=Y.promoteId,this.isSymbolTile=Y.isSymbolTile,this.tileTransform=s.aW(Y.tileID.canonical,Y.projection),this.projection=Y.projection,this.worldview=Y.worldview,this.localizableLayerIds=Y.localizableLayerIds,this.brightness=Y.brightness,this.extraShadowCaster=!!Y.extraShadowCaster,this.tessellationStep=Y.tessellationStep,this.scaleFactor=Y.scaleFactor,this.worldview=Y.worldview}parse(Y,Q,he,we,me,Ae){this.status="parsing",this.data=Y,this.collisionBoxArray=new s.b0;const Ne=new s.e$(Object.keys(Y.layers).sort()),Ce=new s.f0(this.tileID,this.promoteId);Ce.bucketLayerIDs=[];const je={},nt=new s.f1(256,256),Ue={featureIndex:Ce,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:nt,availableImages:he,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Et=[],$t=Q.familiesBySource[this.source];for(const mr in $t){const _r=Y.layers[mr];if(!_r)continue;let xr=!1,$r=!1,Rr=!1;for(const An of $t[mr])An[0].type==="symbol"?xr=!0:$r=!0,An[0].is3D()&&An[0].type!=="model"&&(Rr=!0);if(this.extraShadowCaster&&!Rr||this.isSymbolTile===!0&&!xr||this.isSymbolTile===!1&&!$r)continue;_r.version===1&&s.w(`Vector tile source "${this.source}" layer "${mr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const jn=Ne.encode(mr),on=[];let ti=!1;for(let An=0,bn=0;An<_r.length;An++){const gi=_r.feature(An),xi=Ce.getId(gi,mr);if(this.localizableLayerIds&&this.localizableLayerIds.has(mr)){const hi=gi.properties?gi.properties.worldview:null;if(this.worldview&&typeof hi=="string")if(hi==="all")gi.properties.$localized=!0;else{if(!hi.split(",").includes(this.worldview))continue;gi.properties.$localized=!0,gi.properties.worldview=this.worldview}}!ti&&gi.properties&&gi.properties.hasOwnProperty(s.f2)&&(ti=!0),on.push({feature:gi,id:xi,index:bn,sourceLayerIndex:jn}),bn++}ti&&!Ue.elevationFeatures&&Y.layers.hasOwnProperty(s.f3)&&(Ue.elevationFeatures=s.f4.parseFrom(Y.layers[s.f3],this.canonical));for(const An of $t[mr]){const bn=An[0];if(this.extraShadowCaster&&(!bn.is3D()||bn.type==="model")||this.isSymbolTile!==void 0&&bn.type==="symbol"!==this.isSymbolTile||bn.minzoom&&this.zoom<Math.floor(bn.minzoom)||bn.maxzoom&&this.zoom>=bn.maxzoom||bn.visibility==="none")continue;Be(An,this.zoom,Ue.brightness,he,this.worldview);const gi=je[bn.id]=bn.createBucket({index:Ce.bucketLayerIDs.length,layers:An,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:jn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:we,worldview:this.worldview});Ce.bucketLayerIDs.push(An.map(hi=>s.C(hi.id,hi.scope)));let xi=gi.prepare?gi.prepare():null;xi!=null?(xi=xi.then(()=>gi.populate(on,Ue,this.tileID.canonical,this.tileTransform)),Et.push(xi)):gi.populate(on,Ue,this.tileID.canonical,this.tileTransform)}}const Yt=()=>{let mr,_r,xr,$r,Rr,jn;nt.trim();const on={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ti=()=>{if(mr)return this.status="done",Ae(mr);if(this.extraShadowCaster)this.status="done",Ae(null,{buckets:Object.values(je).filter(bn=>!bn.isEmpty()),featureIndex:Ce,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ue.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(_r&&xr&&$r){const bn=new wt(_r),gi=new Map;for(const[Zi,Ui]of xr.entries()){const{imagePosition:$s}=s.f7(Zi,Ui,s.f8);gi.set(Zi,$s)}const xi={};for(const Zi in je){const Ui=je[Zi];Ui instanceof s.b1&&(Be(Ui.layers,this.zoom,Ue.brightness,he,this.worldview),xi[Zi]=s.f9(Ui,_r,bn.positions,xr,gi,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Rr,this.worldview))}const hi={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(me,xr,Rr,()=>{hi.iconsPending=!1,An(xi,bn,hi)}),this.rasterizeIfNeeded(me,$r,jn,()=>{hi.patternsPending=!1,An(xi,bn,hi)})}},An=(bn,gi,xi,hi)=>{if(xi.iconsPending||xi.patternsPending)return;const Zi=new s.fa(xr,$r,this.lut);for(const Ui in je){const $s=je[Ui];if(Ui in bn)s.fb($s,bn[Ui],this.showCollisionBoxes,he,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,xr,Zi);else if($s.hasPattern&&($s instanceof s.b7||$s instanceof s.b8||$s instanceof s.dU)){Be($s.layers,this.zoom,Ue.brightness,he,this.worldview);const po=Object.fromEntries(Zi.patternPositions);$s.addFeatures(Ue,this.tileID.canonical,po,he,this.tileTransform,this.brightness)}}this.status="done",Ae(null,{buckets:Object.values(je).filter(Ui=>!Ui.isEmpty()),featureIndex:Ce,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:gi.image,lineAtlas:nt,imageAtlas:Zi,brightness:Ue.brightness})};if(!this.extraShadowCaster){const bn=s.f5(Ue.glyphDependencies,hi=>Object.keys(hi).map(Number));Object.keys(bn).length?me.send("getGlyphs",{uid:this.uid,stacks:bn,scope:this.scope},(hi,Zi)=>{mr||(mr=hi,_r=Zi,ti())},void 0,!1,on):_r={};const gi=Array.from(Ue.iconDependencies.keys()).map(hi=>s.I.parse(hi));gi.length?me.send("getImages",{images:gi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(hi,Zi)=>{mr||(mr=hi,xr=new Map,Rr=this.updateImageMapAndGetImageTaskQueue(xr,Zi,Ue.iconDependencies),ti())},void 0,!1,on):(xr=new Map,Rr=new Map);const xi=Array.from(Ue.patternDependencies.keys()).map(hi=>s.I.parse(hi));xi.length?me.send("getImages",{images:xi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(hi,Zi)=>{mr||(mr=hi,$r=new Map,jn=this.updateImageMapAndGetImageTaskQueue($r,Zi,Ue.patternDependencies),ti())},void 0,!1,on):($r=new Map,jn=new Map)}if(Ue.elevationFeatures&&Ue.elevationFeatures.length>0){const bn=[];for(const xi of Object.values(je))if(xi instanceof s.b8){const hi=xi.getUnevaluatedPortalGraph();hi&&bn.push(hi)}const gi=s.f6.evaluate(bn);for(const xi of Object.values(je))if(xi instanceof s.b8){const hi=Y.layers[Ne.decode(xi.sourceLayerIndex)];xi.setEvaluatedPortalGraph(gi,hi,this.tileID.canonical,Ue.availableImages,Ue.brightness)}}ti()};Et.length>0?Promise.allSettled(Et).then(Yt).catch(Ae):Yt()}rasterizeIfNeeded(Y,Q,he,we){Array.from(Q.values()).some(me=>me.usvg)?this.rasterize(Y,Q,he,we):we()}updateImageMapAndGetImageTaskQueue(Y,Q,he){const we=new Map;for(const me of Q.keys()){const Ae=he.get(me)||[];for(const Ne of Ae){const Ce=Ne.toString(),je=Q.get(Ne.id.toString());je.usvg?we.has(Ce)||(we.set(Ce,Ne),Y.set(Ce,Object.assign({},je))):Y.set(Ce,je)}}return we}rasterize(Y,Q,he,we){this.rasterizeTask=Y.send("rasterizeImages",{scope:this.scope,tasks:he},(me,Ae)=>{if(!me)for(const[Ne,Ce]of Ae.entries()){const je=Object.assign(Q.get(Ne),{data:Ce});Q.set(Ne,je)}we()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Be(Oe,Y,Q,he,we){const me=new s.aa(Y,{brightness:Q,worldview:we});for(const Ae of Oe)Ae.recalculate(me,he)}class ct extends s.E{constructor(Y,Q,he,we,me,Ae,Ne){super(),this.actor=Y,this.layerIndex=Q,this.availableImages=he,this.availableModels=we,this.loadVectorData=Ae||s.aJ,this.loading={},this.loaded={},this.deduped=new s.aI(Y.scheduler),this.isSpriteLoaded=me,this.scheduler=Y.scheduler,this.brightness=Ne}loadTile(Y,Q){const he=Y.uid,we=Y&&Y.request,me=we&&we.collectResourceTiming,Ae=this.loading[he]=new Xt(Y);Ae.abort=this.loadVectorData(Y,(Ne,Ce)=>{const je=!this.loading[he];if(delete this.loading[he],Ae.cancelRasterize(),je||Ne||!Ce)return Ae.status="done",je||(this.loaded[he]=Ae),Q(Ne);const nt=Ce.rawData,Ue={};Ce.expires&&(Ue.expires=Ce.expires),Ce.cacheControl&&(Ue.cacheControl=Ce.cacheControl),Ae.vectorTile=Ce.vectorTile||new s.fc.VectorTile(new s.bq(nt));const Et=()=>{Ae.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,($t,Yt)=>{if($t||!Yt)return Q($t);const mr={};if(me){const _r=ce(we);_r.length>0&&(mr.resourceTiming=JSON.parse(JSON.stringify(_r)))}Q(null,s.h({rawTileData:nt.slice(0)},Yt,Ue,mr))})};this.isSpriteLoaded?Et():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Et,{type:"parseTile",isSymbolTile:Y.isSymbolTile,zoom:Y.tileZoom}):Et()}),this.loaded=this.loaded||{},this.loaded[he]=Ae})}reloadTile(Y,Q){const he=this.loaded,we=Y.uid;if(he&&he[we]){const me=he[we];me.scaleFactor=Y.scaleFactor,me.showCollisionBoxes=Y.showCollisionBoxes,me.projection=Y.projection,me.brightness=Y.brightness,me.tileTransform=s.aW(Y.tileID.canonical,Y.projection),me.extraShadowCaster=Y.extraShadowCaster,me.lut=Y.lut,me.worldview=Y.worldview;const Ae=(Ne,Ce)=>{const je=me.reloadCallback;je&&(delete me.reloadCallback,me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,je)),Q(Ne,Ce)};me.status==="parsing"?me.reloadCallback=Ae:me.status==="done"&&(me.vectorTile?me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ae):Ae())}else Q(null,void 0)}abortTile(Y,Q){const he=Y.uid,we=this.loading[he];we&&(we.abort&&we.abort(),delete this.loading[he]),Q()}removeTile(Y,Q){const he=this.loaded,we=Y.uid;he&&he[we]&&delete he[we],Q()}}class Tt{loadTile(Y,Q){const{uid:he,encoding:we,rawImageData:me,padding:Ae}=Y,Ne=ImageBitmap&&me instanceof ImageBitmap?this.getImageData(me,Ae):me;Q(null,new s.fd(he,Ne,we,Ae<1))}reloadTile(Y,Q){Q(null,null)}abortTile(Y,Q){Q()}removeTile(Y,Q){Q()}getImageData(Y,Q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);const he=this.offscreenCanvasContext.getImageData(-Q,-Q,Y.width+2*Q,Y.height+2*Q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),he}}s.bp.setPbf(s.bq);class Dt{constructor(Y){this._mrt=new s.bp(Y.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Y.uid,this.tileID=Y.tileID,this.source=Y.source}parse(Y,Q){const he=this._mrt;this.status="parsing",this._entireBuffer=Y;try{he.parseHeader(Y),this._isHeaderLoaded=!0;const we=[];for(const me in he.layers){const Ae=he.getLayer(me),Ne=Ae.getDataRange(Ae.getBandList()),Ce=he.createDecodingTask(Ne),je=Y.slice(Ne.firstByte,Ne.lastByte+1),nt=s.bp.performDecoding(je,Ce).then(Ue=>Ce.complete(null,Ue)).catch(Ue=>Ce.complete(Ue,null));we.push(nt)}Promise.allSettled(we).then(()=>Q(null,he)).catch(me=>Q(me))}catch(we){Q(we)}}}class Vt{constructor(Y){this.actor=Y,this.loading={},this.loaded={}}loadTile(Y,Q){const he=Y.uid,we=Y.request,me=this.loading[he]=new Dt(Y),{cancel:Ae}=s.br(we,(Ne,Ce,je,nt)=>{const Ue=!this.loading[he];if(delete this.loading[he],Ue||Ne||!Ce)return me.status="done",Ue||(this.loaded[he]=me),Q(Ne);me.parse(Ce,(Et,$t)=>{if(Et||!$t)return Q(Et);Q(null,$t,je,nt)}),this.loaded[he]=me});me.abort=Ae}reloadTile(Y,Q){Q(null,void 0)}abortTile(Y,Q){const he=Y.uid,we=this.loading[he];we&&(we.abort&&we.abort(),delete this.loading[he]),Q()}removeTile(Y,Q){const he=Y.uid;this.loaded[he]&&delete this.loaded[he],Q()}decodeRasterArray(Y,Q){s.bp.performDecoding(Y.buffer,Y.task).then(he=>Q(null,he)).catch(he=>Q(he))}}const jt=s.fc.VectorTileFeature.prototype.toGeoJSON;class vr{constructor(Y){this._feature=Y,this.extent=s.aj,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))}loadGeometry(){if(this._feature.type===1){const Y=[];for(const Q of this._feature.geometry)Y.push([new s.P(Q[0],Q[1])]);return Y}{const Y=[];for(const Q of this._feature.geometry){const he=[];for(const we of Q)he.push(new s.P(we[0],we[1]));Y.push(he)}return Y}}toGeoJSON(Y,Q,he){return jt.call(this,Y,Q,he)}}class hr{constructor(Y){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.aj,this.length=Y.length,this._features=Y}feature(Y){return new vr(this._features[Y])}}class Kt{constructor(Y,Q){this.name=Y,this.extent=s.aj,this.length=Q.length,this._features=Q}feature(Y){return new vr(this._features[Y])}}class Wt extends hr{constructor(Y){super([]),this.layers={};for(const Q in Y)this.layers[Q]=new Kt(Q,Y[Q])}}const Cr=64/4096,oi=128;class fn{constructor(){this.features=new Map}clear(){this.features.clear()}load(Y=[],Q){for(const he of Y){const we=he.id;if(we==null)continue;let me=this.features.get(we);me&&this.updateCache(me,Q),he.geometry?(me=gr(he),this.updateCache(me,Q),this.features.set(we,me)):this.features.delete(we),this.updateCache(me,Q)}}updateCache(Y,Q){for(const{canonical:he,uid:we}of Object.values(Q)){const{z:me,x:Ae,y:Ne}=he;ui(Y,Math.pow(2,me),Ae,Ne)&&delete Q[we]}}getTile(Y,Q,he){const we=Math.pow(2,Y),me=[];for(const Ae of this.features.values())ui(Ae,we,Q,he)&&me.push(un(Ae,we,Q,he));return{features:me}}getFeatures(){return[...this.features.values()]}}function ui({minX:Oe,minY:Y,maxX:Q,maxY:he},we,me,Ae){return Oe<(me+1+Cr)/we&&Y<(Ae+1+Cr)/we&&Q>(me-Cr)/we&&he>(Ae-Cr)/we}function gr(Oe){const{id:Y,geometry:Q,properties:he}=Oe;if(!Q)return;if(Q.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:we,coordinates:me}=Q,Ae={id:Y,type:1,geometry:[],tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ne=Ae.geometry;if(we==="Point")Mr(me,Ne,Ae);else if(we==="MultiPoint")for(const Ce of me)Mr(Ce,Ne,Ae);else if(we==="LineString")Ae.type=2,rn(me,Ne,Ae);else if(we==="MultiLineString")Ae.type=2,nn(me,Ne,Ae);else if(we==="Polygon")Ae.type=3,nn(me,Ne,Ae,!0);else{if(we!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ae.type=3;for(const Ce of me)nn(Ce,Ne,Ae,!0)}return Ae}function Mr([Oe,Y],Q,he){const we=s.aD(Oe);let me=s.aH(Y);me=me<0?0:me>1?1:me,Q.push(we,me),he.minX=Math.min(he.minX,we),he.minY=Math.min(he.minY,me),he.maxX=Math.max(he.maxX,we),he.maxY=Math.max(he.maxY,me)}function rn(Oe,Y,Q,he=!1,we=!1){const me=[];for(const Ae of Oe)Mr(Ae,me,Q);Y.push(me),he&&function(Ae,Ne){let Ce=0;for(let je=0,nt=Ae.length,Ue=nt-2;je<nt;Ue=je,je+=2)Ce+=(Ae[je]-Ae[Ue])*(Ae[je+1]+Ae[Ue+1]);if(Ce>0===Ne)for(let je=0,nt=Ae.length;je<nt/2;je+=2){const Ue=Ae[je],Et=Ae[je+1];Ae[je]=Ae[nt-2-je],Ae[je+1]=Ae[nt-1-je],Ae[nt-2-je]=Ue,Ae[nt-1-je]=Et}}(me,we)}function nn(Oe,Y,Q,he=!1){for(let we=0;we<Oe.length;we++)rn(Oe[we],Y,Q,he,we===0)}function un(Oe,Y,Q,he){const{id:we,type:me,geometry:Ae,tags:Ne}=Oe,Ce=[];if(me===1)(function(je,nt,Ue,Et,$t){for(let Yt=0;Yt<je.length;Yt+=2){const mr=Math.round(s.aj*(je[Yt+0]*nt-Ue)),_r=Math.round(s.aj*(je[Yt+1]*nt-Et));$t.push([mr,_r])}})(Ae,Y,Q,he,Ce);else for(const je of Ae)At(je,Y,Q,he,Ce);return{id:we,type:me,geometry:Ce,tags:Ne}}function At(Oe,Y,Q,he,we){const Ae=s.aj+oi;let Ne;for(let Ce=0;Ce<Oe.length-2;Ce+=2){let je=Math.round(s.aj*(Oe[Ce+0]*Y-Q)),nt=Math.round(s.aj*(Oe[Ce+1]*Y-he)),Ue=Math.round(s.aj*(Oe[Ce+2]*Y-Q)),Et=Math.round(s.aj*(Oe[Ce+3]*Y-he));const $t=Ue-je,Yt=Et-nt;je<-128&&Ue<-128||(je<-128?(nt+=Math.round(Yt*((-128-je)/$t)),je=-128):Ue<-128&&(Et=nt+Math.round(Yt*((-128-je)/$t)),Ue=-128),nt<-128&&Et<-128||(nt<-128?(je+=Math.round($t*((-128-nt)/Yt)),nt=-128):Et<-128&&(Ue=je+Math.round($t*((-128-nt)/Yt)),Et=-128),je>=Ae&&Ue>=Ae||(je>=Ae?(nt+=Math.round(Yt*((Ae-je)/$t)),je=Ae):Ue>=Ae&&(Et=nt+Math.round(Yt*((Ae-je)/$t)),Ue=Ae),nt>=Ae&&Et>=Ae||(nt>=Ae?(je+=Math.round($t*((Ae-nt)/Yt)),nt=Ae):Et>=Ae&&(Ue=je+Math.round($t*((Ae-nt)/Yt)),Et=Ae),Ne&&je===Ne[Ne.length-1][0]&&nt===Ne[Ne.length-1][1]||(Ne=[[je,nt]],we.push(Ne)),Ne.push([Ue,Et])))))}}var Tr,Ht,rt,Ot={exports:{}},Pr=function(){if(rt)return Ot.exports;rt=1;var Oe=s.fg(),Y=function(){if(Ht)return Tr;Ht=1;var nt=s.fe(),Ue=s.ff().VectorTileFeature;function Et(Yt,mr){this.options=mr||{},this.features=Yt,this.length=Yt.length}function $t(Yt,mr){this.id=typeof Yt.id=="number"?Yt.id:void 0,this.type=Yt.type,this.rawGeometry=Yt.type===1?[Yt.geometry]:Yt.geometry,this.properties=Yt.tags,this.extent=mr||4096}return Tr=Et,Et.prototype.feature=function(Yt){return new $t(this.features[Yt],this.options.extent)},$t.prototype.loadGeometry=function(){var Yt=this.rawGeometry;this.geometry=[];for(var mr=0;mr<Yt.length;mr++){for(var _r=Yt[mr],xr=[],$r=0;$r<_r.length;$r++)xr.push(new nt(_r[$r][0],_r[$r][1]));this.geometry.push(xr)}return this.geometry},$t.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Yt=this.geometry,mr=1/0,_r=-1/0,xr=1/0,$r=-1/0,Rr=0;Rr<Yt.length;Rr++)for(var jn=Yt[Rr],on=0;on<jn.length;on++){var ti=jn[on];mr=Math.min(mr,ti.x),_r=Math.max(_r,ti.x),xr=Math.min(xr,ti.y),$r=Math.max($r,ti.y)}return[mr,xr,_r,$r]},$t.prototype.toGeoJSON=Ue.prototype.toGeoJSON,Tr}();function Q(nt){var Ue=new Oe;return function(Et,$t){for(var Yt in Et.layers)$t.writeMessage(3,he,Et.layers[Yt])}(nt,Ue),Ue.finish()}function he(nt,Ue){var Et;Ue.writeVarintField(15,nt.version||1),Ue.writeStringField(1,nt.name||""),Ue.writeVarintField(5,nt.extent||4096);var $t={keys:[],values:[],keycache:{},valuecache:{}};for(Et=0;Et<nt.length;Et++)$t.feature=nt.feature(Et),Ue.writeMessage(2,we,$t);var Yt=$t.keys;for(Et=0;Et<Yt.length;Et++)Ue.writeStringField(3,Yt[Et]);var mr=$t.values;for(Et=0;Et<mr.length;Et++)Ue.writeMessage(4,je,mr[Et])}function we(nt,Ue){var Et=nt.feature;Et.id!==void 0&&Ue.writeVarintField(1,Et.id),Ue.writeMessage(2,me,nt),Ue.writeVarintField(3,Et.type),Ue.writeMessage(4,Ce,Et)}function me(nt,Ue){var Et=nt.feature,$t=nt.keys,Yt=nt.values,mr=nt.keycache,_r=nt.valuecache;for(var xr in Et.properties){var $r=Et.properties[xr],Rr=mr[xr];if($r!==null){Rr===void 0&&($t.push(xr),mr[xr]=Rr=$t.length-1),Ue.writeVarint(Rr);var jn=typeof $r;jn!=="string"&&jn!=="boolean"&&jn!=="number"&&($r=JSON.stringify($r));var on=jn+":"+$r,ti=_r[on];ti===void 0&&(Yt.push($r),_r[on]=ti=Yt.length-1),Ue.writeVarint(ti)}}}function Ae(nt,Ue){return(Ue<<3)+(7&nt)}function Ne(nt){return nt<<1^nt>>31}function Ce(nt,Ue){for(var Et=nt.loadGeometry(),$t=nt.type,Yt=0,mr=0,_r=Et.length,xr=0;xr<_r;xr++){var $r=Et[xr],Rr=1;$t===1&&(Rr=$r.length),Ue.writeVarint(Ae(1,Rr));for(var jn=$t===3?$r.length-1:$r.length,on=0;on<jn;on++){on===1&&$t!==1&&Ue.writeVarint(Ae(2,jn-1));var ti=$r[on].x-Yt,An=$r[on].y-mr;Ue.writeVarint(Ne(ti)),Ue.writeVarint(Ne(An)),Yt+=ti,mr+=An}$t===3&&Ue.writeVarint(Ae(7,1))}}function je(nt,Ue){var Et=typeof nt;Et==="string"?Ue.writeStringField(1,nt):Et==="boolean"?Ue.writeBooleanField(7,nt):Et==="number"&&(nt%1!=0?Ue.writeDoubleField(3,nt):nt<0?Ue.writeSVarintField(6,nt):Ue.writeVarintField(5,nt))}return Ot.exports=Q,Ot.exports.fromVectorTileJs=Q,Ot.exports.fromGeojsonVt=function(nt,Ue){Ue=Ue||{};var Et={};for(var $t in nt)Et[$t]=new Y(nt[$t].features,Ue),Et[$t].name=$t,Et[$t].version=Ue.version,Et[$t].extent=Ue.extent;return Q({layers:Et})},Ot.exports.GeoJSONWrapper=Y,Ot.exports}(),Hr=s.fh(Pr);const br={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Oe=>Oe},Br=Math.fround||(Sr=new Float32Array(1),Oe=>(Sr[0]=+Oe,Sr[0]));var Sr;const vn=3,Ar=5,Pi=6;class qi{constructor(Y){this.options=Object.assign(Object.create(br),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){const{log:Q,minZoom:he,maxZoom:we}=this.options;Q&&console.time("total time");const me=`prepare ${Y.length} points`;Q&&console.time(me),this.points=Y;const Ae=[];for(let Ce=0;Ce<Y.length;Ce++){const je=Y[Ce];if(!je.geometry)continue;const[nt,Ue]=je.geometry.coordinates,Et=Br(xn(nt)),$t=Br(aa(Ue));Ae.push(Et,$t,1/0,Ce,-1,1),this.options.reduce&&Ae.push(0)}let Ne=this.trees[we+1]=this._createTree(Ae);Q&&console.timeEnd(me);for(let Ce=we;Ce>=he;Ce--){const je=+Date.now();Ne=this.trees[Ce]=this._createTree(this._cluster(Ne,Ce)),Q&&console.log("z%d: %d clusters in %dms",Ce,Ne.numItems,+Date.now()-je)}return Q&&console.timeEnd("total time"),this}getClusters(Y,Q){let he=((Y[0]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,Y[1]));let me=Y[2]===180?180:((Y[2]+180)%360+360)%360-180;const Ae=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)he=-180,me=180;else if(he>me){const Ue=this.getClusters([he,we,180,Ae],Q),Et=this.getClusters([-180,we,me,Ae],Q);return Ue.concat(Et)}const Ne=this.trees[this._limitZoom(Q)],Ce=Ne.range(xn(he),aa(Ae),xn(me),aa(we)),je=Ne.data,nt=[];for(const Ue of Ce){const Et=this.stride*Ue;nt.push(je[Et+Ar]>1?us(je,Et,this.clusterProps):this.points[je[Et+vn]])}return nt}getChildren(Y){const Q=this._getOriginId(Y),he=this._getOriginZoom(Y),we="No cluster with the specified id.",me=this.trees[he];if(!me)throw new Error(we);const Ae=me.data;if(Q*this.stride>=Ae.length)throw new Error(we);const Ne=this.options.radius/(this.options.extent*Math.pow(2,he-1)),Ce=me.within(Ae[Q*this.stride],Ae[Q*this.stride+1],Ne),je=[];for(const nt of Ce){const Ue=nt*this.stride;Ae[Ue+4]===Y&&je.push(Ae[Ue+Ar]>1?us(Ae,Ue,this.clusterProps):this.points[Ae[Ue+vn]])}if(je.length===0)throw new Error(we);return je}getLeaves(Y,Q,he){const we=[];return this._appendLeaves(we,Y,Q=Q||10,he=he||0,0),we}getTile(Y,Q,he){const we=this.trees[this._limitZoom(Y)],me=Math.pow(2,Y),{extent:Ae,radius:Ne}=this.options,Ce=Ne/Ae,je=(he-Ce)/me,nt=(he+1+Ce)/me,Ue={features:[]};return this._addTileFeatures(we.range((Q-Ce)/me,je,(Q+1+Ce)/me,nt),we.data,Q,he,me,Ue),Q===0&&this._addTileFeatures(we.range(1-Ce/me,je,1,nt),we.data,me,he,me,Ue),Q===me-1&&this._addTileFeatures(we.range(0,je,Ce/me,nt),we.data,-1,he,me,Ue),Ue.features.length?Ue:null}getClusterExpansionZoom(Y){let Q=this._getOriginZoom(Y)-1;for(;Q<=this.options.maxZoom;){const he=this.getChildren(Y);if(Q++,he.length!==1)break;Y=he[0].properties.cluster_id}return Q}_appendLeaves(Y,Q,he,we,me){const Ae=this.getChildren(Q);for(const Ne of Ae){const Ce=Ne.properties;if(Ce&&Ce.cluster?me+Ce.point_count<=we?me+=Ce.point_count:me=this._appendLeaves(Y,Ce.cluster_id,he,we,me):me<we?me++:Y.push(Ne),Y.length===he)break}return me}_createTree(Y){const Q=new s.bW(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let he=0;he<Y.length;he+=this.stride)Q.add(Y[he],Y[he+1]);return Q.finish(),Q.data=Y,Q}_addTileFeatures(Y,Q,he,we,me,Ae){for(const Ne of Y){const Ce=Ne*this.stride,je=Q[Ce+Ar]>1;let nt,Ue,Et;if(je)nt=vi(Q,Ce,this.clusterProps),Ue=Q[Ce],Et=Q[Ce+1];else{const mr=this.points[Q[Ce+vn]];nt=mr.properties;const[_r,xr]=mr.geometry.coordinates;Ue=xn(_r),Et=aa(xr)}const $t={type:1,geometry:[[Math.round(this.options.extent*(Ue*me-he)),Math.round(this.options.extent*(Et*me-we))]],tags:nt};let Yt;Yt=je||this.options.generateId?Q[Ce+vn]:this.points[Q[Ce+vn]].id,Yt!==void 0&&($t.id=Yt),Ae.features.push($t)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,Q){const{radius:he,extent:we,reduce:me,minPoints:Ae}=this.options,Ne=he/(we*Math.pow(2,Q)),Ce=Y.data,je=[],nt=this.stride;for(let Ue=0;Ue<Ce.length;Ue+=nt){if(Ce[Ue+2]<=Q)continue;Ce[Ue+2]=Q;const Et=Ce[Ue],$t=Ce[Ue+1],Yt=Y.within(Ce[Ue],Ce[Ue+1],Ne),mr=Ce[Ue+Ar];let _r=mr;for(const xr of Yt){const $r=xr*nt;Ce[$r+2]>Q&&(_r+=Ce[$r+Ar])}if(_r>mr&&_r>=Ae){let xr,$r=Et*mr,Rr=$t*mr,jn=-1;const on=(Ue/nt<<5)+(Q+1)+this.points.length;for(const ti of Yt){const An=ti*nt;if(Ce[An+2]<=Q)continue;Ce[An+2]=Q;const bn=Ce[An+Ar];$r+=Ce[An]*bn,Rr+=Ce[An+1]*bn,Ce[An+4]=on,me&&(xr||(xr=this._map(Ce,Ue,!0),jn=this.clusterProps.length,this.clusterProps.push(xr)),me(xr,this._map(Ce,An)))}Ce[Ue+4]=on,je.push($r/_r,Rr/_r,1/0,on,-1,_r),me&&je.push(jn)}else{for(let xr=0;xr<nt;xr++)je.push(Ce[Ue+xr]);if(_r>1)for(const xr of Yt){const $r=xr*nt;if(!(Ce[$r+2]<=Q)){Ce[$r+2]=Q;for(let Rr=0;Rr<nt;Rr++)je.push(Ce[$r+Rr])}}}}return je}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,Q,he){if(Y[Q+Ar]>1){const Ae=this.clusterProps[Y[Q+Pi]];return he?Object.assign({},Ae):Ae}const we=this.points[Y[Q+vn]].properties,me=this.options.map(we);return he&&me===we?Object.assign({},me):me}}function us(Oe,Y,Q){return{type:"Feature",id:Oe[Y+vn],properties:vi(Oe,Y,Q),geometry:{type:"Point",coordinates:[(he=Oe[Y],360*(he-.5)),hs(Oe[Y+1])]}};var he}function vi(Oe,Y,Q){const he=Oe[Y+Ar],we=he>=1e4?`${Math.round(he/1e3)}k`:he>=1e3?Math.round(he/100)/10+"k":he,me=Oe[Y+Pi],Ae=me===-1?{}:Object.assign({},Q[me]);return Object.assign(Ae,{cluster:!0,cluster_id:Oe[Y+vn],point_count:he,point_count_abbreviated:we})}function xn(Oe){return Oe/360+.5}function aa(Oe){const Y=Math.sin(Oe*Math.PI/180),Q=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return Q<0?0:Q>1?1:Q}function hs(Oe){const Y=(180-360*Oe)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function Ho(Oe,Y,Q,he){let we=he;const me=Y+(Q-Y>>1);let Ae,Ne=Q-Y;const Ce=Oe[Y],je=Oe[Y+1],nt=Oe[Q],Ue=Oe[Q+1];for(let Et=Y+3;Et<Q;Et+=3){const $t=Ul(Oe[Et],Oe[Et+1],Ce,je,nt,Ue);if($t>we)Ae=Et,we=$t;else if($t===we){const Yt=Math.abs(Et-me);Yt<Ne&&(Ae=Et,Ne=Yt)}}we>he&&(Ae-Y>3&&Ho(Oe,Y,Ae,he),Oe[Ae+2]=we,Q-Ae>3&&Ho(Oe,Ae,Q,he))}function Ul(Oe,Y,Q,he,we,me){let Ae=we-Q,Ne=me-he;if(Ae!==0||Ne!==0){const Ce=((Oe-Q)*Ae+(Y-he)*Ne)/(Ae*Ae+Ne*Ne);Ce>1?(Q=we,he=me):Ce>0&&(Q+=Ae*Ce,he+=Ne*Ce)}return Ae=Oe-Q,Ne=Y-he,Ae*Ae+Ne*Ne}function ds(Oe,Y,Q,he){const we={id:Oe??null,type:Y,geometry:Q,tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")Oi(we,Q);else if(Y==="Polygon")Oi(we,Q[0]);else if(Y==="MultiLineString")for(const me of Q)Oi(we,me);else if(Y==="MultiPolygon")for(const me of Q)Oi(we,me[0]);return we}function Oi(Oe,Y){for(let Q=0;Q<Y.length;Q+=3)Oe.minX=Math.min(Oe.minX,Y[Q]),Oe.minY=Math.min(Oe.minY,Y[Q+1]),Oe.maxX=Math.max(Oe.maxX,Y[Q]),Oe.maxY=Math.max(Oe.maxY,Y[Q+1])}function Zs(Oe,Y,Q,he){if(!Y.geometry)return;const we=Y.geometry.coordinates;if(we&&we.length===0)return;const me=Y.geometry.type,Ae=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2);let Ne=[],Ce=Y.id;if(Q.promoteId?Ce=Y.properties[Q.promoteId]:Q.generateId&&(Ce=he||0),me==="Point")la(we,Ne);else if(me==="MultiPoint")for(const je of we)la(je,Ne);else if(me==="LineString")ho(we,Ne,Ae,!1);else if(me==="MultiLineString"){if(Q.lineMetrics){for(const je of we)Ne=[],ho(je,Ne,Ae,!1),Oe.push(ds(Ce,"LineString",Ne,Y.properties));return}xs(we,Ne,Ae,!1)}else if(me==="Polygon")xs(we,Ne,Ae,!0);else{if(me!=="MultiPolygon"){if(me==="GeometryCollection"){for(const je of Y.geometry.geometries)Zs(Oe,{id:Ce,geometry:je,properties:Y.properties},Q,he);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const je of we){const nt=[];xs(je,nt,Ae,!0),Ne.push(nt)}}Oe.push(ds(Ce,me,Ne,Y.properties))}function la(Oe,Y){Y.push(Oa(Oe[0]),hl(Oe[1]),0)}function ho(Oe,Y,Q,he){let we,me,Ae=0;for(let Ce=0;Ce<Oe.length;Ce++){const je=Oa(Oe[Ce][0]),nt=hl(Oe[Ce][1]);Y.push(je,nt,0),Ce>0&&(Ae+=he?(we*nt-je*me)/2:Math.sqrt(Math.pow(je-we,2)+Math.pow(nt-me,2))),we=je,me=nt}const Ne=Y.length-3;Y[2]=1,Ho(Y,0,Ne,Q),Y[Ne+2]=1,Y.size=Math.abs(Ae),Y.start=0,Y.end=Y.size}function xs(Oe,Y,Q,he){for(let we=0;we<Oe.length;we++){const me=[];ho(Oe[we],me,Q,he),Y.push(me)}}function Oa(Oe){return Oe/360+.5}function hl(Oe){const Y=Math.sin(Oe*Math.PI/180),Q=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return Q<0?0:Q>1?1:Q}function ks(Oe,Y,Q,he,we,me,Ae,Ne){if(he/=Y,me>=(Q/=Y)&&Ae<he)return Oe;if(Ae<Q||me>=he)return null;const Ce=[];for(const je of Oe){const nt=je.geometry;let Ue=je.type;const Et=we===0?je.minX:je.minY,$t=we===0?je.maxX:je.maxY;if(Et>=Q&&$t<he){Ce.push(je);continue}if($t<Q||Et>=he)continue;let Yt=[];if(Ue==="Point"||Ue==="MultiPoint")Wo(nt,Yt,Q,he,we);else if(Ue==="LineString")ca(nt,Yt,Q,he,we,!1,Ne.lineMetrics);else if(Ue==="MultiLineString")Hi(nt,Yt,Q,he,we,!1);else if(Ue==="Polygon")Hi(nt,Yt,Q,he,we,!0);else if(Ue==="MultiPolygon")for(const mr of nt){const _r=[];Hi(mr,_r,Q,he,we,!0),_r.length&&Yt.push(_r)}if(Yt.length){if(Ne.lineMetrics&&Ue==="LineString"){for(const mr of Yt)Ce.push(ds(je.id,Ue,mr,je.tags));continue}Ue!=="LineString"&&Ue!=="MultiLineString"||(Yt.length===1?(Ue="LineString",Yt=Yt[0]):Ue="MultiLineString"),Ue!=="Point"&&Ue!=="MultiPoint"||(Ue=Yt.length===3?"Point":"MultiPoint"),Ce.push(ds(je.id,Ue,Yt,je.tags))}}return Ce.length?Ce:null}function Wo(Oe,Y,Q,he,we){for(let me=0;me<Oe.length;me+=3){const Ae=Oe[me+we];Ae>=Q&&Ae<=he&&Ds(Y,Oe[me],Oe[me+1],Oe[me+2])}}function ca(Oe,Y,Q,he,we,me,Ae){let Ne=Zo(Oe);const Ce=we===0?wa:ba;let je,nt,Ue=Oe.start;for(let _r=0;_r<Oe.length-3;_r+=3){const xr=Oe[_r],$r=Oe[_r+1],Rr=Oe[_r+2],jn=Oe[_r+3],on=Oe[_r+4],ti=we===0?xr:$r,An=we===0?jn:on;let bn=!1;Ae&&(je=Math.sqrt(Math.pow(xr-jn,2)+Math.pow($r-on,2))),ti<Q?An>Q&&(nt=Ce(Ne,xr,$r,jn,on,Q),Ae&&(Ne.start=Ue+je*nt)):ti>he?An<he&&(nt=Ce(Ne,xr,$r,jn,on,he),Ae&&(Ne.start=Ue+je*nt)):Ds(Ne,xr,$r,Rr),An<Q&&ti>=Q&&(nt=Ce(Ne,xr,$r,jn,on,Q),bn=!0),An>he&&ti<=he&&(nt=Ce(Ne,xr,$r,jn,on,he),bn=!0),!me&&bn&&(Ae&&(Ne.end=Ue+je*nt),Y.push(Ne),Ne=Zo(Oe)),Ae&&(Ue+=je)}let Et=Oe.length-3;const $t=Oe[Et],Yt=Oe[Et+1],mr=we===0?$t:Yt;mr>=Q&&mr<=he&&Ds(Ne,$t,Yt,Oe[Et+2]),Et=Ne.length-3,me&&Et>=3&&(Ne[Et]!==Ne[0]||Ne[Et+1]!==Ne[1])&&Ds(Ne,Ne[0],Ne[1],Ne[2]),Ne.length&&Y.push(Ne)}function Zo(Oe){const Y=[];return Y.size=Oe.size,Y.start=Oe.start,Y.end=Oe.end,Y}function Hi(Oe,Y,Q,he,we,me){for(const Ae of Oe)ca(Ae,Y,Q,he,we,me,!1)}function Ds(Oe,Y,Q,he){Oe.push(Y,Q,he)}function wa(Oe,Y,Q,he,we,me){const Ae=(me-Y)/(he-Y);return Ds(Oe,me,Q+(we-Q)*Ae,1),Ae}function ba(Oe,Y,Q,he,we,me){const Ae=(me-Q)/(we-Q);return Ds(Oe,Y+(he-Y)*Ae,me,1),Ae}function dl(Oe,Y){const Q=[];for(let he=0;he<Oe.length;he++){const we=Oe[he],me=we.type;let Ae;if(me==="Point"||me==="MultiPoint"||me==="LineString")Ae=ua(we.geometry,Y);else if(me==="MultiLineString"||me==="Polygon"){Ae=[];for(const Ne of we.geometry)Ae.push(ua(Ne,Y))}else if(me==="MultiPolygon"){Ae=[];for(const Ne of we.geometry){const Ce=[];for(const je of Ne)Ce.push(ua(je,Y));Ae.push(Ce)}}Q.push(ds(we.id,me,Ae,we.tags))}return Q}function ua(Oe,Y){const Q=[];Q.size=Oe.size,Oe.start!==void 0&&(Q.start=Oe.start,Q.end=Oe.end);for(let he=0;he<Oe.length;he+=3)Q.push(Oe[he]+Y,Oe[he+1],Oe[he+2]);return Q}function Fa(Oe,Y){if(Oe.transformed)return Oe;const Q=1<<Oe.z,he=Oe.x,we=Oe.y;for(const me of Oe.features){const Ae=me.geometry,Ne=me.type;if(me.geometry=[],Ne===1)for(let Ce=0;Ce<Ae.length;Ce+=2)me.geometry.push(Un(Ae[Ce],Ae[Ce+1],Y,Q,he,we));else for(let Ce=0;Ce<Ae.length;Ce++){const je=[];for(let nt=0;nt<Ae[Ce].length;nt+=2)je.push(Un(Ae[Ce][nt],Ae[Ce][nt+1],Y,Q,he,we));me.geometry.push(je)}}return Oe.transformed=!0,Oe}function Un(Oe,Y,Q,he,we,me){return[Math.round(Q*(Oe*he-we)),Math.round(Q*(Y*he-me))]}function Qr(Oe,Y,Q,he,we){const me=Y===we.maxZoom?0:we.tolerance/((1<<Y)*we.extent),Ae={features:[],numPoints:0,numSimplified:0,numFeatures:Oe.length,source:null,x:Q,y:he,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ne of Oe)Wn(Ae,Ne,me,we);return Ae}function Wn(Oe,Y,Q,he){const we=Y.geometry,me=Y.type,Ae=[];if(Oe.minX=Math.min(Oe.minX,Y.minX),Oe.minY=Math.min(Oe.minY,Y.minY),Oe.maxX=Math.max(Oe.maxX,Y.maxX),Oe.maxY=Math.max(Oe.maxY,Y.maxY),me==="Point"||me==="MultiPoint")for(let Ne=0;Ne<we.length;Ne+=3)Ae.push(we[Ne],we[Ne+1]),Oe.numPoints++,Oe.numSimplified++;else if(me==="LineString")In(Ae,we,Oe,Q,!1,!1);else if(me==="MultiLineString"||me==="Polygon")for(let Ne=0;Ne<we.length;Ne++)In(Ae,we[Ne],Oe,Q,me==="Polygon",Ne===0);else if(me==="MultiPolygon")for(let Ne=0;Ne<we.length;Ne++){const Ce=we[Ne];for(let je=0;je<Ce.length;je++)In(Ae,Ce[je],Oe,Q,!0,je===0)}if(Ae.length){let Ne=Y.tags||null;if(me==="LineString"&&he.lineMetrics){Ne={};for(const je in Y.tags)Ne[je]=Y.tags[je];Ne.mapbox_clip_start=we.start/we.size,Ne.mapbox_clip_end=we.end/we.size}const Ce={geometry:Ae,type:me==="Polygon"||me==="MultiPolygon"?3:me==="LineString"||me==="MultiLineString"?2:1,tags:Ne};Y.id!==null&&(Ce.id=Y.id),Oe.features.push(Ce)}}function In(Oe,Y,Q,he,we,me){const Ae=he*he;if(he>0&&Y.size<(we?Ae:he))return void(Q.numPoints+=Y.length/3);const Ne=[];for(let Ce=0;Ce<Y.length;Ce+=3)(he===0||Y[Ce+2]>Ae)&&(Q.numSimplified++,Ne.push(Y[Ce],Y[Ce+1])),Q.numPoints++;we&&function(Ce,je){let nt=0;for(let Ue=0,Et=Ce.length,$t=Et-2;Ue<Et;$t=Ue,Ue+=2)nt+=(Ce[Ue]-Ce[$t])*(Ce[Ue+1]+Ce[$t+1]);if(nt>0===je)for(let Ue=0,Et=Ce.length;Ue<Et/2;Ue+=2){const $t=Ce[Ue],Yt=Ce[Ue+1];Ce[Ue]=Ce[Et-2-Ue],Ce[Ue+1]=Ce[Et-1-Ue],Ce[Et-2-Ue]=$t,Ce[Et-1-Ue]=Yt}}(Ne,me),Oe.push(Ne)}const Nn={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ri{constructor(Y,Q){const he=(Q=this.options=function(me,Ae){for(const Ne in Ae)me[Ne]=Ae[Ne];return me}(Object.create(Nn),Q)).debug;if(he&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");let we=function(me,Ae){const Ne=[];if(me.type==="FeatureCollection")for(let Ce=0;Ce<me.features.length;Ce++)Zs(Ne,me.features[Ce],Ae,Ce);else Zs(Ne,me.type==="Feature"?me:{geometry:me},Ae);return Ne}(Y,Q);this.tiles={},this.tileCoords=[],he&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),we=function(me,Ae){const Ne=Ae.buffer/Ae.extent;let Ce=me;const je=ks(me,1,-1-Ne,Ne,0,-1,2,Ae),nt=ks(me,1,1-Ne,2+Ne,0,-1,2,Ae);return(je||nt)&&(Ce=ks(me,1,-Ne,1+Ne,0,-1,2,Ae)||[],je&&(Ce=dl(je,1).concat(Ce)),nt&&(Ce=Ce.concat(dl(nt,-1)))),Ce}(we,Q),we.length&&this.splitTile(we,0,0,0),he&&(we.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Y,Q,he,we,me,Ae,Ne){const Ce=[Y,Q,he,we],je=this.options,nt=je.debug;for(;Ce.length;){we=Ce.pop(),he=Ce.pop(),Q=Ce.pop(),Y=Ce.pop();const Ue=1<<Q,Et=Wi(Q,he,we);let $t=this.tiles[Et];if(!$t&&(nt>1&&console.time("creation"),$t=this.tiles[Et]=Qr(Y,Q,he,we,je),this.tileCoords.push({z:Q,x:he,y:we}),nt)){nt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,he,we,$t.numFeatures,$t.numPoints,$t.numSimplified),console.timeEnd("creation"));const bn=`z${Q}`;this.stats[bn]=(this.stats[bn]||0)+1,this.total++}if($t.source=Y,me==null){if(Q===je.indexMaxZoom||$t.numPoints<=je.indexMaxPoints)continue}else{if(Q===je.maxZoom||Q===me)continue;if(me!=null){const bn=me-Q;if(he!==Ae>>bn||we!==Ne>>bn)continue}}if($t.source=null,Y.length===0)continue;nt>1&&console.time("clipping");const Yt=.5*je.buffer/je.extent,mr=.5-Yt,_r=.5+Yt,xr=1+Yt;let $r=null,Rr=null,jn=null,on=null,ti=ks(Y,Ue,he-Yt,he+_r,0,$t.minX,$t.maxX,je),An=ks(Y,Ue,he+mr,he+xr,0,$t.minX,$t.maxX,je);Y=null,ti&&($r=ks(ti,Ue,we-Yt,we+_r,1,$t.minY,$t.maxY,je),Rr=ks(ti,Ue,we+mr,we+xr,1,$t.minY,$t.maxY,je),ti=null),An&&(jn=ks(An,Ue,we-Yt,we+_r,1,$t.minY,$t.maxY,je),on=ks(An,Ue,we+mr,we+xr,1,$t.minY,$t.maxY,je),An=null),nt>1&&console.timeEnd("clipping"),Ce.push($r||[],Q+1,2*he,2*we),Ce.push(Rr||[],Q+1,2*he,2*we+1),Ce.push(jn||[],Q+1,2*he+1,2*we),Ce.push(on||[],Q+1,2*he+1,2*we+1)}}getTile(Y,Q,he){Y=+Y,Q=+Q,he=+he;const we=this.options,{extent:me,debug:Ae}=we;if(Y<0||Y>24)return null;const Ne=1<<Y,Ce=Wi(Y,Q=Q+Ne&Ne-1,he);if(this.tiles[Ce])return Fa(this.tiles[Ce],me);Ae>1&&console.log("drilling down to z%d-%d-%d",Y,Q,he);let je,nt=Y,Ue=Q,Et=he;for(;!je&&nt>0;)nt--,Ue>>=1,Et>>=1,je=this.tiles[Wi(nt,Ue,Et)];return je&&je.source?(Ae>1&&(console.log("found parent tile z%d-%d-%d",nt,Ue,Et),console.time("drilling down")),this.splitTile(je.source,nt,Ue,Et,Y,Q,he),Ae>1&&console.timeEnd("drilling down"),this.tiles[Ce]?Fa(this.tiles[Ce],me):null):null}}function Wi(Oe,Y,Q){return 32*((1<<Oe)*Q+Y)+Oe}function ft(Oe,Y){const Q=Oe.tileID.canonical;if(!this._geoJSONIndex)return void Y(null,null);const he=this._geoJSONIndex.getTile(Q.z,Q.x,Q.y);if(!he)return void Y(null,null);const we=Ce=>Ce.tags&&"3d_elevation_id"in Ce.tags&&"source"in Ce.tags&&Ce.tags.source==="elevation",me=he.features.filter(Ce=>we(Ce));let Ae;if(me.length>0){const Ce=he.features.filter(je=>!we(je));Ae=new Wt({_geojsonTileLayer:Ce,hd_road_elevation:me})}else Ae=new hr(he.features);let Ne=Hr(Ae);Ne.byteOffset===0&&Ne.byteLength===Ne.buffer.byteLength||(Ne=new Uint8Array(Ne)),Y(null,{vectorTile:Ae,rawData:Ne.buffer})}class ws extends ct{constructor(Y,Q,he,we,me,Ae,Ne){super(Y,Q,he,we,me,ft,Ne),Ae&&(this.loadGeoJSON=Ae),this._dynamicIndex=new fn}loadData(Y,Q){const he=Y&&Y.request,we=he&&he.collectResourceTiming;this.loadGeoJSON(Y,(me,Ae)=>{if(me||!Ae)return Q(me);if(typeof Ae!="object")return Q(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));{try{if(Y.filter){const Ce=s.X(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ce.result==="error")throw new Error(Ce.value.map(je=>`${je.key}: ${je.message}`).join(", "));Ae.features=Ae.features.filter(je=>Ce.value.evaluate({zoom:0},je))}Y.dynamic?(Ae.type==="Feature"&&(Ae={type:"FeatureCollection",features:[Ae]}),Y.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ae.features,this.loaded),Y.cluster&&(Ae.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Y.cluster?new qi(function({superclusterOptions:Ce,clusterProperties:je}){if(!je||!Ce)return Ce;const nt={},Ue={},Et={accumulated:null,zoom:0},$t={properties:null},Yt=Object.keys(je);for(const mr of Yt){const[_r,xr]=je[mr],$r=s.X(xr),Rr=s.X(typeof _r=="string"?[_r,["accumulated"],["get",mr]]:_r);nt[mr]=$r.value,Ue[mr]=Rr.value}return Ce.map=mr=>{$t.properties=mr;const _r={};for(const xr of Yt)_r[xr]=nt[xr].evaluate(Et,$t);return _r},Ce.reduce=(mr,_r)=>{$t.properties=_r;for(const xr of Yt)Et.accumulated=mr[xr],mr[xr]=Ue[xr].evaluate(Et,$t)},Ce}(Y)).load(Ae.features):Y.dynamic?this._dynamicIndex:function(Ce,je){return new Ri(Ce,je)}(Ae,Y.geojsonVtOptions)}catch(Ce){return Q(Ce)}const Ne={};if(we){const Ce=ce(he);Ce&&(Ne.resourceTiming={},Ne.resourceTiming[Y.source]=JSON.parse(JSON.stringify(Ce)))}Q(null,Ne)}})}reloadTile(Y,Q){const he=this.loaded;return he&&he[Y.uid]?Y.partial?Q(null,void 0):super.reloadTile(Y,Q):this.loadTile(Y,Q)}loadGeoJSON(Y,Q){if(Y.request)s.n(Y.request,Q);else{if(typeof Y.data!="string")return Q(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));try{return Q(null,JSON.parse(Y.data))}catch{return Q(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Y,Q){try{Q(null,this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId))}catch(he){Q(he)}}getClusterChildren(Y,Q){try{Q(null,this._geoJSONIndex.getChildren(Y.clusterId))}catch(he){Q(he)}}getClusterLeaves(Y,Q){try{Q(null,this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset))}catch(he){Q(he)}}}class Xs{constructor(Y,Q,he){this.tileID=new s.aM(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Y.projection,this.brightness=Q,this.worldview=he}parse(Y,Q,he,we){this.status="parsing";const me=new s.aM(he.tileID.overscaledZ,he.tileID.wrap,he.tileID.canonical.z,he.tileID.canonical.x,he.tileID.canonical.y),Ae=[],Ne=Q.familiesBySource[he.source],Ce=new s.f0(me,he.promoteId);Ce.bucketLayerIDs=[],Ce.is3DTile=!0,s.fi(Y).then(je=>{if(!je)return we(new Error("Could not parse tile"));const nt=je.json.extensionsUsed&&je.json.extensionsUsed.includes("MAPBOX_mesh_features")||je.json.asset.extras&&je.json.asset.extras.MAPBOX_mesh_features,Ue=je.json.extensionsUsed&&je.json.extensionsUsed.includes("EXT_meshopt_compression"),Et=new s.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const $t in Ne)for(const Yt of Ne[$t]){const mr=Yt[0];Ce.bucketLayerIDs.push(Yt.map($r=>s.C($r.id,$r.scope))),mr.recalculate(Et,[]);const _r=s.fj(je,1/s.cU(he.tileID.canonical)),xr=new s.fk(Yt,_r,me,nt,Ue,this.brightness,Ce,this.worldview);nt||(xr.needsUpload=!0),Ae.push(xr),xr.evaluate(mr)}this.status="done",we(null,{buckets:Ae,featureIndex:Ce,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(je=>we(new Error(je.message)))}}class fo{constructor(Y,Q,he,we,me,Ae,Ne,Ce){this.actor=Y,this.layerIndex=Q,this.availableImages=he,this.availableModels=we,this.brightness=Ne,this.loading={},this.loaded={},this.worldview=Ce}loadTile(Y,Q){const he=Y.uid,we=this.loading[he]=new Xs(Y,this.brightness,this.worldview);s.br(Y.request,(me,Ae)=>{const Ne=!this.loading[he];return delete this.loading[he],Ne||me?(we.status="done",Ne||(this.loaded[he]=we),Q(me)):Ae&&Ae.byteLength!==0?void we.parse(Ae,this.layerIndex,Y,(Ce,je)=>{we.status="done",this.loaded=this.loaded||{},this.loaded[he]=we,Ce||!je?Q(Ce):Q(null,je)}):(we.status="done",this.loaded[he]=we,Q())})}reloadTile(Y,Q){const he=this.loaded,we=Y.uid;if(he&&he[we]){const me=he[we];me.projection=Y.projection,me.brightness=Y.brightness;const Ae=(Ne,Ce)=>{me.reloadCallback&&(delete me.reloadCallback,this.loadTile(Y,Q)),Q(Ne,Ce)};me.status==="parsing"?me.reloadCallback=Ae:me.status==="done"&&this.loadTile(Y,Q)}}abortTile(Y,Q){const he=Y.uid;this.loading[he]&&delete this.loading[he],Q()}removeTile(Y,Q){const he=this.loaded,we=Y.uid;he&&he[we]&&delete he[we],Q()}}class en{constructor(Y){this.self=Y,this.actor=new s.fm(Y,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=s.ce({name:"mercator"}),this.workerSourceTypes={vector:ct,geojson:ws,"raster-dem":Tt,"raster-array":Vt,"batched-model":fo},this.workerSources={},this.self.registerWorkerSource=(Q,he)=>{if(this.workerSourceTypes[Q])throw new Error(`Worker source with name "${Q}" already registered.`);this.workerSourceTypes[Q]=he},this.self.registerRTLTextPlugin=Q=>{if(s.fn.isParsed())throw new Error("RTL text plugin already registered.");s.fn.setState({pluginStatus:s.fo.parsed,pluginURL:s.fn.getPluginURL()}),s.fn.applyArabicShaping=Q.applyArabicShaping,s.fn.processBidirectionalText=Q.processBidirectionalText,s.fn.processStyledBidirectionalText=Q.processStyledBidirectionalText;for(const he of this.rtlPluginParsingListeners)he(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(Y,Q,he){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.availableModels[Y],delete this.workerSources[Y],he()}checkIfReady(Y,Q,he){he()}setReferrer(Y,Q){this.referrer=Q}spriteLoaded(Y,Q){this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={});const{scope:he,isLoaded:we}=Q;if(this.isSpriteLoaded[Y][he]=we,this.workerSources[Y]&&this.workerSources[Y][he])for(const me in this.workerSources[Y][he]){const Ae=this.workerSources[Y][he][me];for(const Ne in Ae){const Ce=Ae[Ne];Ce instanceof ct&&(Ce.isSpriteLoaded=we,Ce.fire(new s.A("isSpriteLoaded")))}}}setImages(Y,Q,he){this.availableImages[Y]||(this.availableImages[Y]={});const{scope:we,images:me}=Q;if(this.availableImages[Y][we]=me,this.workerSources[Y]&&this.workerSources[Y][we]){for(const Ae in this.workerSources[Y][we]){const Ne=this.workerSources[Y][we][Ae];for(const Ce in Ne)Ne[Ce].availableImages=me}he()}else he()}setModels(Y,{scope:Q,models:he},we){if(this.availableModels[Y]||(this.availableModels[Y]={}),this.availableModels[Y][Q]=he,this.workerSources[Y]&&this.workerSources[Y][Q]){for(const me in this.workerSources[Y][Q]){const Ae=this.workerSources[Y][Q][me];for(const Ne in Ae)Ae[Ne].availableModels=he}we()}else we()}setProjection(Y,Q){this.projections[Y]=s.ce(Q)}setBrightness(Y,Q,he){this.brightness=Q,he()}setWorldview(Y,Q,he){this.worldview=Q,he()}setLayers(Y,Q,he){this.getLayerIndex(Y,Q.scope).replace(Q.layers,Q.options),he()}updateLayers(Y,Q,he){this.getLayerIndex(Y,Q.scope).update(Q.layers,Q.removedIds,Q.options),he()}loadTile(Y,Q,he){Q.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,Q.type,Q.source,Q.scope).loadTile(Q,he)}decodeRasterArray(Y,Q,he){this.getWorkerSource(Y,Q.type,Q.source,Q.scope).decodeRasterArray(Q,he)}reloadTile(Y,Q,he){Q.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,Q.type,Q.source,Q.scope).reloadTile(Q,he)}abortTile(Y,Q,he){this.getWorkerSource(Y,Q.type,Q.source,Q.scope).abortTile(Q,he)}removeTile(Y,Q,he){this.getWorkerSource(Y,Q.type,Q.source,Q.scope).removeTile(Q,he)}removeSource(Y,Q,he){if(!(this.workerSources[Y]&&this.workerSources[Y][Q.scope]&&this.workerSources[Y][Q.scope][Q.type]&&this.workerSources[Y][Q.scope][Q.type][Q.source]))return;const we=this.workerSources[Y][Q.scope][Q.type][Q.source];delete this.workerSources[Y][Q.scope][Q.type][Q.source],we.removeSource!==void 0?we.removeSource(Q,he):he()}loadWorkerSource(Y,Q,he){try{this.self.importScripts(Q.url),he()}catch(we){he(we.toString())}}syncRTLPluginState(Y,Q,he){if(s.fn.isParsed())he(null,!0);else if(s.fn.isParsing())this.rtlPluginParsingListeners.push(he);else try{s.fn.setState(Q);const we=s.fn.getPluginURL();!s.fn.isLoaded()||s.fn.isParsed()||s.fn.isParsing()||we==null||(s.fn.setState({pluginStatus:s.fo.parsing,pluginURL:s.fn.getPluginURL()}),this.self.importScripts(we),s.fn.isParsed()?he(null,!0):this.rtlPluginParsingListeners.push(he))}catch(we){he(we.toString())}}setDracoUrl(Y,Q){this.dracoUrl=Q}getAvailableImages(Y,Q){this.availableImages[Y]||(this.availableImages[Y]={});let he=this.availableImages[Y][Q];return he||(he=[]),he}getAvailableModels(Y,Q){this.availableModels[Y]||(this.availableModels[Y]={});let he=this.availableModels[Y][Q];return he||(he={}),he}getLayerIndex(Y,Q){this.layerIndexes[Y]||(this.layerIndexes[Y]={});let he=this.layerIndexes[Y][Q];return he||(he=this.layerIndexes[Y][Q]=new Me,he.scope=Q),he}getWorkerSource(Y,Q,he,we){const me=this.workerSources;return me[Y]||(me[Y]={}),me[Y][we]||(me[Y][we]={}),me[Y][we][Q]||(me[Y][we][Q]={}),this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),me[Y][we][Q][he]||(me[Y][we][Q][he]=new this.workerSourceTypes[Q]({send:(Ae,Ne,Ce,je,nt,Ue)=>this.actor.send(Ae,Ne,Ce,Y,nt,Ue),scheduler:this.actor.scheduler},this.getLayerIndex(Y,we),this.getAvailableImages(Y,we),this.getAvailableModels(Y,we),this.isSpriteLoaded[Y][we],void 0,this.brightness,this.worldview)),me[Y][we][Q][he]}rasterizeImagesWorker(Y,Q,he){const we=new Map;for(const[me,{image:Ae,imageVariant:Ne}]of Q.tasks.entries()){const Ce=this.imageRasterizer.rasterize(Ne,Ae,Q.scope,Y);we.set(me,Ce)}he(void 0,we)}removeRasterizedImages(Y,Q,he){this.imageRasterizer.removeImagesFromCacheByIds(Q.imageIds,Q.scope,Y),he()}enforceCacheSizeLimit(Y,Q){s.fp(Q)}getWorkerPerformanceMetrics(Y,Q,he){he(void 0,void 0)}}return s.fl(self)&&(self.worker=new en(self)),en}),$(["./shared"],function(s){var ce="3.13.0";const be={create:"create",load:"load",fullLoad:"fullLoad"},Se={mark(l){performance.mark(l)},measure(l,t,i){performance.measure(l,t,i)}};function Me(l){const t=l.name.split("?")[0];return s.a(t)&&t.includes("mapbox-gl.js")?"javascript":s.a(t)&&t.includes("mapbox-gl.css")?"css":s.b(t)?"fontRange":s.c(t)?"sprite":s.i(t)?"style":s.d(t)?"tilejson":"other"}var tt,wt={},Xt=function(){if(tt)return wt;function l(c){return!t(c)}function t(c){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,y,w=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(w);try{y=new Worker(S),m=!0}catch{m=!1}return y&&y.terminate(),URL.revokeObjectURL(S),m}()?function(){var m=document.createElement("canvas");m.width=m.height=1;var y=m.getContext("2d");if(!y)return!1;var w=y.getImageData(0,0,1,1);return w&&w.width===m.width}()?(i[f=c&&c.failIfMajorPerformanceCaveat]===void 0&&(i[f]=function(m){var y,w=function(S){var M=document.createElement("canvas"),P=Object.create(l.webGLContextAttributes);return P.failIfMajorPerformanceCaveat=S,M.getContext("webgl2",P)}(m);if(!w)return!1;try{y=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!y||w.isContextLost())&&(w.shaderSource(y,"void main() {}"),w.compileShader(y),w.getShaderParameter(y,w.COMPILE_STATUS)===!0)}(f)),i[f]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var f}tt=1,wt.supported=l,wt.notSupportedReason=t;var i={};return l.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},wt}();function Be(l,t,i){const c=document.createElement(l);return t!=null&&(c.className=t),i&&i.appendChild(c),c}function ct(l,t,i){const c=document.createElementNS("http://www.w3.org/2000/svg",l);for(const f of Object.keys(t))c.setAttributeNS(null,f,String(t[f]));return i&&i.appendChild(c),c}const Tt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Dt=Tt&&Tt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Vt;function jt(){Tt&&Dt&&(Vt=Tt[Dt],Tt[Dt]="none")}function vr(){Tt&&Dt&&(Tt[Dt]=Vt)}function hr(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",hr,!0)}function Kt(){window.addEventListener("click",hr,!0),window.setTimeout(()=>{window.removeEventListener("click",hr,!0)},0)}function Wt(l,t){const i=l.getBoundingClientRect();return fn(l,i,t)}function Cr(l,t){const i=l.getBoundingClientRect(),c=[];for(let f=0;f<t.length;f++)c.push(fn(l,i,t[f]));return c}function oi(l){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&l.button===2&&l.ctrlKey?0:l.button}function fn(l,t,i){const c=l.offsetWidth===t.width?1:l.offsetWidth/t.width;return new s.P((i.clientX-t.left)*c,(i.clientY-t.top)*c)}const ui="01",gr="NO_ACCESS_TOKEN";class Mr{constructor(t,i,c){this._transformRequestFn=t,this._customAccessToken=i,this._silenceAuthErrors=!!c,this._createSkuToken()}_createSkuToken(){const t=function(){let i="";for(let c=0;c<10;c++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ui,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,i){return this._transformRequestFn&&this._transformRequestFn(t,i)||{url:t}}normalizeStyleURL(t,i){if(!s.j(t))return t;const c=nn(t);return c.params.push(`sdk=js-${ce}`),c.path=`/styles/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||i)}normalizeGlyphsURL(t,i){if(!s.j(t))return t;const c=nn(t);return c.path=`/fonts/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||i)}normalizeModelURL(t,i){if(!s.j(t))return t;const c=nn(t);return c.path=`/models/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||i)}normalizeSourceURL(t,i,c,f){if(!s.j(t))return t;const m=nn(t);return m.path=`/v4/${m.authority}.json`,m.params.push("secure"),c&&m.params.push(`language=${c}`),f&&m.params.push(`worldview=${f}`),this._makeAPIURL(m,this._customAccessToken||i)}normalizeIconsetURL(t,i){const c=nn(t);return s.j(t)?(c.path=`/styles/v1${c.path}/iconset.pbf`,this._makeAPIURL(c,this._customAccessToken||i)):un(c)}normalizeSpriteURL(t,i,c,f){const m=nn(t);return s.j(t)?(m.path=`/styles/v1${m.path}/sprite${i}${c}`,this._makeAPIURL(m,this._customAccessToken||f)):(m.path+=`${i}${c}`,un(m))}normalizeTileURL(t,i,c){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!s.j(t))return t;const f=nn(t);f.path=f.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||c&&f.authority!=="raster"&&c===512?"@2x":""}${s.l.supported?".webp":"$1"}`),f.authority==="raster"?f.path=`/${s.e.RASTER_URL_PREFIX}${f.path}`:f.authority==="rasterarrays"?f.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${f.path}`:f.authority==="3dtiles"?f.path=`/${s.e.TILES3D_URL_PREFIX}${f.path}`:(f.path=f.path.replace(/^.+\/v4\//,"/"),f.path=`/${s.e.TILE_URL_VERSION}${f.path}`);const m=this._customAccessToken||function(y){for(const w of y){const S=w.match(/^access_token=(.*)$/);if(S)return S[1]}return null}(f.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&f.params.push(`sku=${this._skuToken}`),this._makeAPIURL(f,m)}canonicalizeTileURL(t,i){const c=nn(t);if(!c.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!c.path.match(/\.[\w]+$/))return t;let f="mapbox://";c.path.match(/^\/raster\/v1\//)?f+=`raster/${c.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:c.path.match(/^\/rasterarrays\/v1\//)?f+=`rasterarrays/${c.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:f+=`tiles/${c.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let m=c.params;return i&&(m=m.filter(y=>!y.match(/^access_token=/))),m.length&&(f+=`?${m.join("&")}`),f}canonicalizeTileset(t,i){const c=!!i&&s.j(i),f=[];for(const m of t.tiles||[])s.k(m)?f.push(this.canonicalizeTileURL(m,c)):f.push(m);return f}_makeAPIURL(t,i){const c="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",f=nn(s.e.API_URL);if(t.protocol=f.protocol,t.authority=f.authority,t.protocol==="http"){const m=t.params.indexOf("secure");m>=0&&t.params.splice(m,1)}if(f.path!=="/"&&(t.path=`${f.path}${t.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return un(t);if(i=i||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${c}`);if(i[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${c}`)}return t.params=t.params.filter(m=>m.indexOf("access_token")===-1),t.params.push(`access_token=${i||""}`),un(t)}}const rn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function nn(l){const t=l.match(rn);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function un(l){const t=l.params.length?`?${l.params.join("&")}`:"";return`${l.protocol}://${l.authority}${l.path}${t}`}const At="mapbox.eventData";function Tr(l){if(!l)return null;const t=l.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(s.m(t[1]))}catch{return null}}class Ht{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const i=Tr(s.e.ACCESS_TOKEN);let c="";return c=i&&i.u?s.f(i.u):s.e.ACCESS_TOKEN||"",t?`${At}.${t}:${c}`:`${At}:${c}`}fetchEventData(){const t=s.s("localStorage"),i=this.getStorageKey(),c=this.getStorageKey("uuid");if(t)try{const f=localStorage.getItem(i);f&&(this.eventData=JSON.parse(f));const m=localStorage.getItem(c);m&&(this.anonId=m)}catch{s.w("Unable to read from LocalStorage")}}saveEventData(){const t=s.s("localStorage"),i=this.getStorageKey(),c=this.getStorageKey("uuid"),f=this.anonId;if(t&&f)try{localStorage.setItem(c,f),Object.keys(this.eventData).length>=1&&localStorage.setItem(i,JSON.stringify(this.eventData))}catch{s.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,i,c,f){if(!s.e.EVENTS_URL)return;const m=nn(s.e.EVENTS_URL);m.params.push(`access_token=${f||s.e.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(t).toISOString()},w=i?s.h(y,i):y,S={url:un(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};this.pendingRequest=s.p(S,M=>{this.pendingRequest=null,c(M),this.saveEventData(),this.processRequests(f)})}queueRequest(t,i){this.queue.push(t),this.processRequests(i)}}const rt=new class extends Ht{constructor(l){super("appUserTurnstile"),this._customAccessToken=l}postTurnstileEvent(l,t){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(l)&&l.some(i=>s.j(i)||s.k(i))&&this.queueRequest(Date.now(),t)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Tr(s.e.ACCESS_TOKEN),i=t?t.u:s.e.ACCESS_TOKEN;let c=i!==this.eventData.tokenU;s.v(this.anonId)||(this.anonId=s.u(),c=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),y=new Date(f),w=(f-this.eventData.lastSuccess)/864e5;c=c||w>=1||w<-1||m.getDate()!==y.getDate()}else c=!0;c?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ce,skuId:ui,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=f,this.eventData.tokenU=i)},l):this.processRequests()}},Ot=rt.postTurnstileEvent.bind(rt),Pr=new class extends Ht{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(l,t,i,c){this.skuToken=t,this.errorCb=c,s.e.EVENTS_URL&&(i||s.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},i):this.errorCb(new Error(gr)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),s.v(this.anonId)||(this.anonId=s.u()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ce,skuId:ui,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):t&&(this.success[t]=!0)},l))}remove(){this.errorCb=null}},Hr=Pr.postMapLoadEvent.bind(Pr),br=new class extends Ht{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(l){let t=this.mapInstanceIdMap.get(l);return t||(t=s.u(),this.mapInstanceIdMap.set(l,t)),t}getEventId(l){const t=this.eventIdPerMapInstanceMap.get(l)||0;return this.eventIdPerMapInstanceMap.set(l,t+1),t}postStyleLoadEvent(l,t){const{map:i,style:c,importedStyles:f}=t;if(!s.e.EVENTS_URL||!l&&!s.e.ACCESS_TOKEN)return;const m=this.getMapInstanceId(i),y={mapInstanceId:m,eventId:this.getEventId(m),style:c};f.length&&(y.importedStyles=f),this.queueRequest({timestamp:Date.now(),payload:y},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:i}=this.queue.shift();this.postEvent(t,i,()=>{},l)}},Br=br.postStyleLoadEvent.bind(br),Sr=new class extends Ht{constructor(){super("gljs.performance")}postPerformanceEvent(l,t){s.e.EVENTS_URL&&(l||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:i}=this.queue.shift(),c=function(f){const m=performance.getEntriesByType("resource"),y=performance.getEntriesByType("mark"),w=function(F){const q={};if(F){for(const V in F)if(V!=="other")for(const W of F[V]){const X=`${V}ResolveRangeMin`,J=`${V}ResolveRangeMax`,se=`${V}RequestCount`,le=`${V}RequestCachedCount`;q[X]=Math.min(q[X]||1/0,W.startTime),q[J]=Math.max(q[J]||-1/0,W.responseEnd);const ge=_e=>{q[_e]===void 0&&(q[_e]=0),++q[_e]};W.transferSize!==void 0&&W.transferSize===0&&ge(le),ge(se)}}return q}(function(F,q){const V={};if(F)for(const W of F){const X=q(W);V[X]===void 0&&(V[X]=[]),V[X].push(W)}return V}(m,Me)),S=window.devicePixelRatio,M=navigator.connection||navigator.mozConnection||navigator.webkitConnection,P=M?M.effectiveType:void 0,O={counters:[],metadata:[],attributes:[]},D=(F,q,V)=>{V!=null&&F.push({name:q,value:V.toString()})};for(const F in w)D(O.counters,F,w[F]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(D(O.counters,"interactionRangeMin",f.interactionRange[0]),D(O.counters,"interactionRangeMax",f.interactionRange[1])),y)for(const F of Object.keys(be)){const q=be[F],V=y.find(W=>W.name===q);V&&D(O.counters,q,V.startTime)}return D(O.counters,"visibilityHidden",f.visibilityHidden),D(O.attributes,"style",function(F){if(F)for(const q of F){const V=q.name.split("?")[0];if(s.i(V)){const W=V.split("/").slice(-2);if(W.length===2)return`mapbox://styles/${W[0]}/${W[1]}`}}}(m)),D(O.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),D(O.attributes,"fogEnabled",f.fogEnabled?"true":"false"),D(O.attributes,"projection",f.projection),D(O.attributes,"zoom",f.zoom),D(O.metadata,"devicePixelRatio",S),D(O.metadata,"connectionEffectiveType",P),D(O.metadata,"navigatorUserAgent",navigator.userAgent),D(O.metadata,"screenWidth",window.screen.width),D(O.metadata,"screenHeight",window.screen.height),D(O.metadata,"windowWidth",window.innerWidth),D(O.metadata,"windowHeight",window.innerHeight),D(O.metadata,"mapWidth",f.width/S),D(O.metadata,"mapHeight",f.height/S),D(O.metadata,"webglRenderer",f.renderer),D(O.metadata,"webglVendor",f.vendor),D(O.metadata,"sdkVersion",ce),D(O.metadata,"sdkIdentifier","mapbox-gl-js"),O}(i);for(const f of c.metadata);for(const f of c.counters);for(const f of c.attributes);this.postEvent(t,c,()=>{},l)}},vn=Sr.postPerformanceEvent.bind(Sr),Ar=new class extends Ht{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(l,t,i,c){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const f=nn(s.e.API_URL+s.e.SESSION_PATH);f.params.push(`sku=${t||""}`),f.params.push(`access_token=${c||s.e.ACCESS_TOKEN||""}`);const m={url:un(f),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(m,y=>{this.pendingRequest=null,i(y),this.saveEventData(),this.processRequests(c)})}getSessionAPI(l,t,i,c){this.skuToken=t,this.errorCb=c,s.e.SESSION_PATH&&s.e.API_URL&&(i||s.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},i):this.errorCb(new Error(gr)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,c=>{c?this.errorCb(c):t&&(this.success[t]=!0)},l)}remove(){this.errorCb=null}},Pi=Ar.getSessionAPI.bind(Ar),qi=new Set;function us(l,t){t?qi.add(l):qi.delete(l)}class vi{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,i){this._updatedSourceCaches[t]=i,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const i=t.scope;this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._updatedLayers[i].add(t.id),this.setDirty()}removeLayer(t){const i=t.scope;this._removedLayers[i]=this._removedLayers[i]||{},this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._removedLayers[i][t.id]=t,this._updatedLayers[i].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const i in this._updatedLayers)t[i]=t[i]||{},t[i].updatedIds=Array.from(this._updatedLayers[i].values());for(const i in this._removedLayers)t[i]=t[i]||{},t[i].removedIds=Object.keys(this._removedLayers[i]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,i){this._updatedImages[i]=this._updatedImages[i]||new Set,this._updatedImages[i].add(s.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function xn(l){const{userImage:t}=l;return!!(t&&t.render&&t.render())&&(l.data.replace(new Uint8Array(t.data.buffer)),!0)}class aa extends s.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&s.t()&&(this.imageRasterizerDispatcher=new s.D(s.x(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new s.r({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const i=this.atlasTexture.get(t);i&&(i.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,i){this.imageProviders.has(i)||this.imageProviders.set(i,new Map),this.imageProviders.get(i).set(t.id,t)}removeImageProvider(t,i){this.imageProviders.has(i)&&this.imageProviders.get(i).delete(t)}getPendingImageProviders(){const t=[];for(const i of this.imageProviders.values())for(const c of i.values())c.hasPendingRequests()&&t.push(c);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.y),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,i){if(this.loaded.get(i)!==t&&(this.loaded.set(i,t),t)){for(const{ids:c,callback:f}of this.requestors)this._notify(c,i,f);this.requestors=[]}}hasImage(t,i){return!!this.getImage(t,i)}getImage(t,i){return this.images.get(i).get(t.toString())}addImage(t,i,c){this._validate(t,c)&&this.images.get(i).set(t.toString(),c)}_validate(t,i){let c=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new s.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),c=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new s.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),c=!1),this._validateContent(i.content,i)||(this.fire(new s.z(new Error(`Image "${t.name}" has invalid "content" value`))),c=!1),c}_validateStretch(t,i){if(!t)return!0;let c=0;for(const f of t){if(f[0]<c||f[1]<f[0]||i<f[1])return!1;c=f[1]}return!0}_validateContent(t,i){return t?t.length!==4||!i.usvg&&(t[0]<0||i.data.width<t[0]||t[1]<0||i.data.height<t[1]||t[2]<0||i.data.width<t[2]||t[3]<0||i.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,i,c){const f=this.images.get(i).get(t.toString());c.version=f.version+1,this.images.get(i).set(t.toString(),c),this.updatedImages.get(i).add(t),this.removeFromImageRasterizerCache(t,i)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,i){this.spriteFormat!=="raster"&&(s.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:i}):this.imageRasterizer.removeImagesFromCacheByIds([t],i))}removeImage(t,i){const c=this.images.get(i),f=c.get(t.toString());c.delete(t.toString()),this.patterns.get(i).delete(t.toString()),this.removeFromImageRasterizerCache(t,i),f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(i=>s.I.from(i))}getImages(t,i,c){const f=[],m=[],y=this.imageProviders.get(i);for(const P of t){if(!P.iconsetId){f.push(P);continue}const O=y.get(P.iconsetId);O&&(this.getImage(P,i)?m.push(P):O.addPendingRequest(P))}if(f.length===0)return void this._notify(m,i,c);let w=!0;const S=!!this.loaded.get(i),M=this.images.get(i);if(!S)for(const P of f)M.has(P.toString())||(w=!1);S||w?this._notify(f,i,c):this.requestors.push({ids:f,scope:i,callback:c})}rasterizeImages(t,i){const c=new Map,{tasks:f,scope:m}=t;for(const[y,w]of f.entries()){const S=this.getImage(w.id,m);S&&c.set(y,{image:S,imageVariant:w})}this._rasterizeImages(m,c,i)}_rasterizeImages(t,i,c){if(s.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:i,scope:t},c);else{const f=new Map;for(const[m,{image:y,imageVariant:w}]of i.entries())f.set(m,this.imageRasterizer.rasterize(w,y,t,0));c(void 0,f)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,i,c){const f=this.images.get(i),m=new Map;for(const y of t){if(!f.get(y.toString())){if(y.iconsetId)continue;this.fire(new s.A("styleimagemissing",{id:y.name}))}const w=f.get(y.toString());if(!w){s.w(`Image "${y.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const S={data:w.usvg?null:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,usvg:w.usvg,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!!(w.userImage&&w.userImage.render)};w.usvg&&Object.assign(S,{width:w.icon.usvg_tree.width,height:w.icon.usvg_tree.height}),m.set(s.I.toString(y),S)}c(null,m)}getPixelSize(t){const{width:i,height:c}=this.atlasImage.get(t);return{width:i,height:c}}getPattern(t,i,c){const f=t.toString(),m=this.patterns.get(i),y=m.get(f),w=this.getImage(t,i);if(!w)return null;if(y){if(y.position.version===w.version)return y.position;y.position.version=w.version}else{if(w.usvg&&!w.data){const S=this.getPatternInFlightId(f,i);if(this.patternsInFlight.has(S))return null;this.patternsInFlight.add(S);const M=new s.B(t).scaleSelf(s.q.devicePixelRatio),P=new Map([[M.toString(),{image:w,imageVariant:M}]]);return this._rasterizeImages(i,P,(O,D)=>this.storePatternImage(M,i,w,c,D)),null}this.storePattern(t,i,w)}return this._updatePatternAtlas(i,c),m.get(f).position}getPatternInFlightId(t,i){return s.C(t,i)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,i,c,f,m){const y=t.toString(),w=m?m.get(y):void 0;w&&(c.data=w,this.storePattern(t.id,i,c),this._updatePatternAtlas(i,f),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),i)))}storePattern(t,i,c){const f={w:c.data.width+2*s.F,h:c.data.height+2*s.F,x:0,y:0},m=new s.G(f,c,s.F);this.patterns.get(i).set(t.toString(),{bin:f,position:m})}bind(t,i){const c=t.gl;let f=this.atlasTexture.get(i);f?this.dirty&&(f.update(this.atlasImage.get(i)),this.dirty=!1):(f=new s.T(t,this.atlasImage.get(i),c.RGBA8),this.atlasTexture.set(i,f)),f.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(t,i){const c=this.patterns.get(t),f=Array.from(c.values()).map(({bin:M})=>M),{w:m,h:y}=s.H(f),w=this.atlasImage.get(t);w.resize({width:m||1,height:y||1});const S=this.images.get(t);for(const[M,{bin:P,position:O}]of c.entries()){let D=O.padding;const F=P.x+D,q=P.y+D,V=S.get(M).data,W=V.width,X=V.height;D=D>1?D-1:D,s.r.copy(V,w,{x:0,y:0},{x:F,y:q},{width:W,height:X},i),s.r.copy(V,w,{x:0,y:X-D},{x:F,y:q-D},{width:W,height:D},i),s.r.copy(V,w,{x:0,y:0},{x:F,y:q+X},{width:W,height:D},i),s.r.copy(V,w,{x:W-D,y:0},{x:F-D,y:q},{width:D,height:X},i),s.r.copy(V,w,{x:0,y:0},{x:F+W,y:q},{width:D,height:X},i),s.r.copy(V,w,{x:W-D,y:X-D},{x:F-D,y:q-D},{width:D,height:D},i),s.r.copy(V,w,{x:0,y:X-D},{x:F+W,y:q-D},{width:D,height:D},i),s.r.copy(V,w,{x:0,y:0},{x:F+W,y:q+X},{width:D,height:D},i),s.r.copy(V,w,{x:W-D,y:0},{x:F-D,y:q+X},{width:D,height:D},i)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,i){const c=this.images.get(i);for(const f of t){if(this.callbackDispatchedThisFrame.get(i).has(f.toString()))continue;this.callbackDispatchedThisFrame.get(i).add(f.toString());const m=c.get(f.toString());xn(m)&&this.updateImage(f,i,m)}}}function hs(l){const t=l.key,i=l.value,c=l.valueSpec||{},f=l.objectElementValidators||{},m=l.style,y=l.styleSpec;let w=[];const S=s.J(i);if(S!=="object")return[new s.V(t,i,`object expected, ${S} found`)];for(const M in i){const P=M.split(".")[0];let O;f[P]?O=f[P]:c[P]?O=Un:f["*"]?O=f["*"]:c["*"]&&(O=Un),O?w=w.concat(O({key:(t&&`${t}.`)+M,value:i[M],valueSpec:c[P]||c["*"],style:m,styleSpec:y,object:i,objectKey:M},i)):w.push(new s.K(t,i[M],`unknown property "${M}"`))}for(const M in c)f[M]||c[M].required&&c[M].default===void 0&&i[M]===void 0&&w.push(new s.V(t,i,`missing required property "${M}"`));return w}function Ho(l){const t=l.value,i=l.valueSpec,c=l.style,f=l.styleSpec,m=l.key,y=l.arrayElementValidator||Un;if(s.J(t)!=="array")return[new s.V(m,t,`array expected, ${s.J(t)} found`)];if(i.length&&t.length!==i.length)return[new s.V(m,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new s.V(m,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let w={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};f.$version<7&&(w.function=i.function),s.J(i.value)==="object"&&(w=i.value);let S=[];for(let M=0;M<t.length;M++)S=S.concat(y({array:t,arrayIndex:M,value:t[M],valueSpec:w,style:c,styleSpec:f,key:`${m}[${M}]`},!0));return S}function Ul(l){const t=l.key,i=l.value,c=l.valueSpec;let f=s.J(i);if(f==="number"&&i!=i&&(f="NaN"),f!=="number")return[new s.V(t,i,`number expected, ${f} found`)];if("minimum"in c){let m=c.minimum;if(s.J(c.minimum)==="array"&&(m=c.minimum[l.arrayIndex]),i<m)return[new s.V(t,i,`${i} is less than the minimum value ${m}`)]}if("maximum"in c){let m=c.maximum;if(s.J(c.maximum)==="array"&&(m=c.maximum[l.arrayIndex]),i>m)return[new s.V(t,i,`${i} is greater than the maximum value ${m}`)]}return[]}function ds(l){const t=l.valueSpec,i=s.M(l.value.type);let c,f,m,y={};const w=i!=="categorical"&&l.value.property===void 0,S=!w,M=s.J(l.value.stops)==="array"&&s.J(l.value.stops[0])==="array"&&s.J(l.value.stops[0][0])==="object",P=hs({key:l.key,value:l.value,valueSpec:l.styleSpec.function,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(F){if(i==="identity")return[new s.V(F.key,F.value,'identity function may not have a "stops" property')];let q=[];const V=F.value;return q=q.concat(Ho({key:F.key,value:V,valueSpec:F.valueSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:O})),s.J(V)==="array"&&V.length===0&&q.push(new s.V(F.key,V,"array must have at least one stop")),q},default:function(F){return Un({key:F.key,value:F.value,valueSpec:t,style:F.style,styleSpec:F.styleSpec})}}});return i==="identity"&&w&&P.push(new s.V(l.key,l.value,'missing required property "property"')),i==="identity"||l.value.stops||P.push(new s.V(l.key,l.value,'missing required property "stops"')),i==="exponential"&&l.valueSpec.expression&&!s.N(l.valueSpec)&&P.push(new s.V(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(S&&!s.O(l.valueSpec)?P.push(new s.V(l.key,l.value,"property functions not supported")):w&&!s.Q(l.valueSpec)&&P.push(new s.V(l.key,l.value,"zoom functions not supported"))),i!=="categorical"&&!M||l.value.property!==void 0||P.push(new s.V(l.key,l.value,'"property" property is required')),P;function O(F){let q=[];const V=F.value,W=F.key;if(s.J(V)!=="array")return[new s.V(W,V,`array expected, ${s.J(V)} found`)];if(V.length!==2)return[new s.V(W,V,`array length 2 expected, length ${V.length} found`)];if(M){if(s.J(V[0])!=="object")return[new s.V(W,V,`object expected, ${s.J(V[0])} found`)];if(V[0].zoom===void 0)return[new s.V(W,V,"object stop key must have zoom")];if(V[0].value===void 0)return[new s.V(W,V,"object stop key must have value")];const X=s.M(V[0].zoom);if(typeof X!="number")return[new s.V(W,V[0].zoom,"stop zoom values must be numbers")];if(m&&m>X)return[new s.V(W,V[0].zoom,"stop zoom values must appear in ascending order")];X!==m&&(m=X,f=void 0,y={}),q=q.concat(hs({key:`${W}[0]`,value:V[0],valueSpec:{zoom:{}},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:Ul,value:D}}))}else q=q.concat(D({key:`${W}[0]`,value:V[0],style:F.style,styleSpec:F.styleSpec},V));return s.S(s.U(V[1]))?q.concat([new s.V(`${W}[1]`,V[1],"expressions are not allowed in function stops.")]):q.concat(Un({key:`${W}[1]`,value:V[1],valueSpec:t,style:F.style,styleSpec:F.styleSpec}))}function D(F,q){const V=s.J(F.value),W=s.M(F.value),X=F.value!==null?F.value:q;if(c){if(V!==c)return[new s.V(F.key,X,`${V} stop domain type must match previous stop domain type ${c}`)]}else c=V;if(V!=="number"&&V!=="string"&&V!=="boolean"&&typeof W!="number"&&typeof W!="string"&&typeof W!="boolean")return[new s.V(F.key,X,"stop domain value must be a number, string, or boolean")];if(V!=="number"&&i!=="categorical"){let J=`number expected, ${V} found`;return s.O(t)&&i===void 0&&(J+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(F.key,X,J)]}return i!=="categorical"||V!=="number"||typeof W=="number"&&isFinite(W)&&Math.floor(W)===W?i!=="categorical"&&V==="number"&&typeof W=="number"&&typeof f=="number"&&f!==void 0&&W<f?[new s.V(F.key,X,"stop domain values must appear in ascending order")]:(f=W,i==="categorical"&&W in y?[new s.V(F.key,X,"stop domain values must be unique")]:(y[W]=!0,[])):[new s.V(F.key,X,`integer expected, found ${String(W)}`)]}}function Oi(l){const t=(l.expressionContext==="property"?s.W:s.X)(s.U(l.value),l.valueSpec);if(t.result==="error")return t.value.map(c=>new s.V(`${l.key}${c.key}`,l.value,c.message));const i=t.value.expression||t.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!i.outputDefined())return[new s.V(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!s.Y(i))return[new s.V(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter")return Zs(i,l);if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!s.Z(i,["zoom","feature-state"]))return[new s.V(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!s._(i))return[new s.V(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Zs(l,t){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const f of t.valueSpec.expression.parameters)i.delete(f);if(i.size===0)return[];const c=[];return l instanceof s.$&&i.has(l.name)?[new s.V(t.key,t.value,`["${l.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(l.eachChild(f=>{c.push(...Zs(f,t))}),c)}function la(l){const t=l.key,i=l.value,c=l.valueSpec,f=[];return Array.isArray(c.values)?c.values.indexOf(s.M(i))===-1&&f.push(new s.V(t,i,`expected one of [${c.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(c.values).indexOf(s.M(i))===-1&&f.push(new s.V(t,i,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(i)} found`)),f}function ho(l){return s.a1(s.U(l.value))?Oi(s.L({},l,{expressionContext:"filter",valueSpec:l.styleSpec[`filter_${l.layerType||"fill"}`]})):xs(l)}function xs(l){const t=l.value,i=l.key;if(s.J(t)!=="array")return[new s.V(i,t,`array expected, ${s.J(t)} found`)];const c=l.styleSpec;let f,m=[];if(t.length<1)return[new s.V(i,t,"filter array must have at least 1 element")];switch(m=m.concat(la({key:`${i}[0]`,value:t[0],valueSpec:c.filter_operator,style:l.style,styleSpec:l.styleSpec})),s.M(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&s.M(t[1])==="$type"&&m.push(new s.V(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&m.push(new s.V(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(f=s.J(t[1]),f!=="string"&&m.push(new s.V(`${i}[1]`,t[1],`string expected, ${f} found`)));for(let y=2;y<t.length;y++)f=s.J(t[y]),s.M(t[1])==="$type"?m=m.concat(la({key:`${i}[${y}]`,value:t[y],valueSpec:c.geometry_type,style:l.style,styleSpec:l.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&m.push(new s.V(`${i}[${y}]`,t[y],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let y=1;y<t.length;y++)m=m.concat(xs({key:`${i}[${y}]`,value:t[y],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":f=s.J(t[1]),t.length!==2?m.push(new s.V(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):f!=="string"&&m.push(new s.V(`${i}[1]`,t[1],`string expected, ${f} found`))}return m}function Oa(l,t){const i=l.key,c=l.style,f=l.layer,m=l.styleSpec,y=l.value,w=l.objectKey,S=m[`${t}_${l.layerType}`];if(!S)return[];const M=w.match(/^(.*)-use-theme$/);if(t==="paint"&&M&&S[M[1]])return s.S(y)?[].concat(Un({key:l.key,value:y,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:c,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:w})):Un({key:i,value:y,valueSpec:{type:"string"},style:c,styleSpec:m});const P=w.match(/^(.*)-transition$/);if(t==="paint"&&P&&S[P[1]]&&S[P[1]].transition)return Un({key:i,value:y,valueSpec:m.transition,style:c,styleSpec:m});const O=l.valueSpec||S[w];if(!O)return[new s.K(i,y,`unknown property "${w}"`)];let D;if(s.J(y)==="string"&&s.O(O)&&!O.tokens&&(D=/^{([^}]+)}$/.exec(y))){const q=`\`{ "type": "identity", "property": ${D?JSON.stringify(D[1]):'"_"'} }\``;return[new s.V(i,y,`"${w}" does not support interpolation syntax
Use an identity property function instead: ${q}.`)]}const F=[];if(l.layerType==="symbol")w!=="text-field"||!c||c.glyphs||c.imports||F.push(new s.V(i,y,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&s.a2(s.U(y))&&s.M(y.type)==="identity"&&F.push(new s.V(i,y,'"text-font" does not support identity functions'));else if(l.layerType==="model"&&t==="paint"&&f&&f.layout&&f.layout.hasOwnProperty("model-id")&&s.O(O)&&(s.a3(O)||s.Q(O))){const q=s.W(s.U(y),O),V=q.value.expression||q.value._styleExpression.expression;V&&!s.Z(V,["measure-light"])&&(w==="model-emissive-strength"&&s._(V)&&s.Y(V)||F.push(new s.V(i,y,`${w} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return F.concat(Un({key:l.key,value:y,valueSpec:O,style:c,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:w}))}function hl(l){return Oa(l,"paint")}function ks(l){return Oa(l,"layout")}function Wo(l){let t=[];const i=l.value,c=l.key,f=l.style,m=l.styleSpec;i.type||i.ref||t.push(new s.V(c,i,'either "type" or "ref" is required'));let y=s.M(i.type);const w=s.M(i.ref);if(i.id){const S=s.M(i.id);for(let M=0;M<l.arrayIndex;M++){const P=f.layers[M];s.M(P.id)===S&&t.push(new s.V(c,i.id,`duplicate layer id "${i.id}", previously used at line ${P.id.__line__}`))}}if("ref"in i){let S;["type","source","source-layer","filter","layout"].forEach(M=>{M in i&&t.push(new s.V(c,i[M],`"${M}" is prohibited for ref layers`))}),f.layers.forEach(M=>{s.M(M.id)===w&&(S=M)}),S?S.ref?t.push(new s.V(c,i.ref,"ref cannot reference another ref layer")):y=s.M(S.type):typeof w=="string"&&t.push(new s.V(c,i.ref,`ref layer "${w}" not found`))}else if(y!=="background"&&y!=="sky"&&y!=="slot")if(i.source){const S=f.sources&&f.sources[i.source],M=S&&s.M(S.type);S?M==="vector"&&y==="raster"?t.push(new s.V(c,i.source,`layer "${i.id}" requires a raster source`)):M==="raster"&&y!=="raster"?t.push(new s.V(c,i.source,`layer "${i.id}" requires a vector source`)):M!=="vector"||i["source-layer"]?M==="raster-dem"&&y!=="hillshade"?t.push(new s.V(c,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="raster-array"||["raster","raster-particle"].includes(y)?y==="line"&&i.paint&&(i.paint["line-gradient"]||i.paint["line-trim-offset"])&&M==="geojson"&&!S.lineMetrics?t.push(new s.V(c,i,`layer "${i.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):y==="raster-particle"&&M!=="raster-array"&&t.push(new s.V(c,i.source,`layer "${i.id}" requires a 'raster-array' source.`)):t.push(new s.V(c,i.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new s.V(c,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new s.V(c,i.source,`source "${i.source}" not found`))}else t.push(new s.V(c,i,'missing required property "source"'));return t=t.concat(hs({key:c,value:i,valueSpec:m.layer,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Un({key:`${c}.type`,value:i.type,valueSpec:m.layer.type,style:l.style,styleSpec:l.styleSpec,object:i,objectKey:"type"}),filter:S=>ho(s.L({layerType:y},S)),layout:S=>hs({layer:i,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":M=>ks(s.L({layerType:y},M))}}),paint:S=>hs({layer:i,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":M=>hl(s.L({layerType:y,layer:i},M))}})}})),t}function ca(l){const t=l.value,i=l.key,c=s.J(t);return c!=="string"?[new s.V(i,t,`string expected, ${c} found`)]:[]}const Zo={promoteId:function l({key:t,value:i}){if(s.J(i)==="string")return ca({key:t,value:i});if(Array.isArray(i)){const c=[],f=s.U(i),m=s.X(f);return m.result==="error"&&m.value.forEach(y=>{c.push(new s.V(`${t}${y.key}`,null,`${y.message}`))}),s.Z(m.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||c.push(new s.V(`${t}`,null,"promoteId expression should be only feature dependent")),c}{const c=[];for(const f in i)c.push(...l({key:`${t}.${f}`,value:i[f]}));return c}}};function Hi(l){const t=l.value,i=l.key,c=l.styleSpec,f=l.style;if(!t.type)return[new s.V(i,t,'"type" is required')];const m=s.M(t.type);let y=[];switch(["vector","raster","raster-dem","raster-array"].includes(m)&&(t.url||t.tiles||y.push(new s.K(i,t,'Either "url" or "tiles" is required.'))),m){case"vector":case"raster":case"raster-dem":case"raster-array":return y=y.concat(hs({key:i,value:t,valueSpec:c[`source_${m.replace("-","_")}`],style:l.style,styleSpec:c,objectElementValidators:Zo})),y;case"geojson":if(y=hs({key:i,value:t,valueSpec:c.source_geojson,style:f,styleSpec:c,objectElementValidators:Zo}),t.cluster)for(const w in t.clusterProperties){const[S,M]=t.clusterProperties[w],P=typeof S=="string"?[S,["accumulated"],["get",w]]:S;y.push(...Oi({key:`${i}.${w}.map`,value:M,expressionContext:"cluster-map"})),y.push(...Oi({key:`${i}.${w}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return y;case"video":return hs({key:i,value:t,valueSpec:c.source_video,style:f,styleSpec:c});case"image":return hs({key:i,value:t,valueSpec:c.source_image,style:f,styleSpec:c});case"canvas":return[new s.V(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return la({key:`${i}.type`,value:t.type,valueSpec:{values:Ds(c)}})}}function Ds(l){return l.source.reduce((t,i)=>{const c=l[i];return c.type.type==="enum"&&(t=t.concat(Object.keys(c.type.values))),t},[])}function wa(l){const t=l.value,i=l.styleSpec,c=i.light,f=l.style;let m=[];const y=s.J(t);if(t===void 0)return m;if(y!=="object")return m=m.concat([new s.V("light",t,`object expected, ${y} found`)]),m;for(const w in t){const S=w.match(/^(.*)-transition$/),M=w.match(/^(.*)-use-theme$/);m=m.concat(M&&c[M[1]]?Un({key:w,value:t[w],valueSpec:{type:"string"},style:f,styleSpec:i}):S&&c[S[1]]&&c[S[1]].transition?Un({key:w,value:t[w],valueSpec:i.transition,style:f,styleSpec:i}):c[w]?Un({key:w,value:t[w],valueSpec:c[w],style:f,styleSpec:i}):[new s.V(w,t[w],`unknown property "${w}"`)])}return m}function ba(l){const t=l.value;let i=[];if(!t)return i;const c=s.J(t);if(c!=="object")return i=i.concat([new s.V("light-3d",t,`object expected, ${c} found`)]),i;const f=l.styleSpec,m=f["light-3d"],y=l.key,w=l.style,S=l.style.lights;for(const O of["type","id"])if(!(O in t))return i=i.concat([new s.V("light-3d",t,`missing property ${O} on light`)]),i;if(t.type&&S)for(let O=0;O<l.arrayIndex;O++){const D=s.M(t.type),F=S[O];s.M(F.type)===D&&i.push(new s.V(y,t.id,`duplicate light type "${t.type}", previously defined at line ${F.id.__line__}`))}const M=`properties_light_${t.type}`;if(!(M in f))return i=i.concat([new s.V("light-3d",t,`Invalid light type ${t.type}`)]),i;const P=f[M];for(const O in t)if(O==="properties"){const D=t[O],F=s.J(D);if(F!=="object")return i=i.concat([new s.V("properties",D,`object expected, ${F} found`)]),i;for(const q in D){const V=q.match(/^(.*)-transition$/),W=q.match(/^(.*)-use-theme$/);i=i.concat(W&&P[W[1]]?Un({key:O,value:D[q],valueSpec:{type:"string"},style:w,styleSpec:f}):V&&P[V[1]]&&P[V[1]].transition?Un({key:O,value:t[O],valueSpec:f.transition,style:w,styleSpec:f}):P[q]?Un({key:q,value:D[q],valueSpec:P[q],style:w,styleSpec:f}):[new s.K(l.key,D[q],`unknown property "${q}"`)])}}else i=i.concat(m[O]?Un({key:O,value:t[O],valueSpec:m[O],style:w,styleSpec:f}):[new s.K(O,t[O],`unknown property "${O}"`)]);return i}function dl(l){const t=l.value,i=l.key,c=l.style,f=l.styleSpec,m=f.terrain;let y=[];const w=s.J(t);if(t===void 0||w==="null")return y;if(w!=="object")return y=y.concat([new s.V("terrain",t,`object expected, ${w} found`)]),y;for(const S in t){const M=S.match(/^(.*)-transition$/),P=S.match(/^(.*)-use-theme$/);y=y.concat(P&&m[P[1]]?Un({key:S,value:t[S],valueSpec:{type:"string"},style:c,styleSpec:f}):M&&m[M[1]]&&m[M[1]].transition?Un({key:S,value:t[S],valueSpec:f.transition,style:c,styleSpec:f}):m[S]?Un({key:S,value:t[S],valueSpec:m[S],style:c,styleSpec:f}):[new s.K(S,t[S],`unknown property "${S}"`)])}if(t.source){const S=c.sources&&c.sources[t.source],M=S&&s.M(S.type);S?M!=="raster-dem"&&y.push(new s.V(i,t.source,`terrain cannot be used with a source of type ${String(M)}, it only be used with a "raster-dem" source type`)):y.push(new s.V(i,t.source,`source "${t.source}" not found`))}else y.push(new s.V(i,t,'terrain is missing required property "source"'));return y}function ua(l){const t=l.value,i=l.style,c=l.styleSpec,f=c.fog;let m=[];const y=s.J(t);if(t===void 0)return m;if(y!=="object")return m=m.concat([new s.V("fog",t,`object expected, ${y} found`)]),m;for(const w in t){const S=w.match(/^(.*)-transition$/),M=w.match(/^(.*)-use-theme$/);m=m.concat(M&&f[M[1]]?Un({key:w,value:t[w],valueSpec:{type:"string"},style:i,styleSpec:c}):S&&f[S[1]]&&f[S[1]].transition?Un({key:w,value:t[w],valueSpec:c.transition,style:i,styleSpec:c}):f[w]?Un({key:w,value:t[w],valueSpec:f[w],style:i,styleSpec:c}):[new s.K(w,t[w],`unknown property "${w}"`)])}return m}const Fa={"*":()=>[],array:Ho,boolean:function(l){const t=l.value,i=l.key,c=s.J(t);return c!=="boolean"?[new s.V(i,t,`boolean expected, ${c} found`)]:[]},number:Ul,color:function(l){const t=l.key,i=l.value,c=s.J(i);return c!=="string"?[new s.V(t,i,`color expected, ${c} found`)]:s.a0.parseCSSColor(i)===null?[new s.V(t,i,`color expected, "${i}" found`)]:[]},enum:la,filter:ho,function:ds,layer:Wo,object:hs,source:Hi,model:s.a4,light:wa,"light-3d":ba,terrain:dl,fog:ua,string:ca,formatted:function(l){return ca(l).length===0?[]:Oi(l)},resolvedImage:function(l){return ca(l).length===0?[]:Oi(l)},projection:function(l){const t=l.value,i=l.styleSpec,c=i.projection,f=l.style;let m=[];const y=s.J(t);if(y==="object")for(const w in t)m=m.concat(Un({key:w,value:t[w],valueSpec:c[w],style:f,styleSpec:i}));else y!=="string"&&(m=m.concat([new s.V("projection",t,`object or string expected, ${y} found`)]));return m},import:function(l){const{value:t,styleSpec:i}=l,{data:c,...f}=t;Object.defineProperty(f,"__line__",{value:t.__line__,enumerable:!1});let m=hs(s.L({},l,{value:f,valueSpec:i.import}));return s.M(f.id)===""&&m.push(new s.V(`${l.key}.id`,f,"import id can't be an empty string")),c&&(m=m.concat(Wn(c,i,{key:`${l.key}.data`}))),m},iconset:function(l){const t=l.value,i=l.key,c=l.styleSpec,f=l.style;if(!t.type)return[new s.V(i,t,'"type" is required')];const m=s.M(t.type);let y=[];if(y=y.concat(hs({key:i,value:t,valueSpec:c[`iconset_${m}`],style:f,styleSpec:c})),m==="source"&&t.source){const w=f.sources&&f.sources[t.source],S=w&&s.M(w.type);w?S!=="raster-array"&&y.push(new s.V(i,t.source,`iconset cannot be used with a source of type ${String(S)}, it only be used with a "raster-array" source type`)):y.push(new s.V(i,t.source,`source "${t.source}" not found`))}return y}};function Un(l,t=!1){const i=l.value,c=l.valueSpec,f=l.styleSpec;if(c.expression&&s.a2(s.M(i)))return ds(l);if(c.expression&&s.S(s.U(i)))return Oi(l);if(c.type&&Fa[c.type]){const m=Fa[c.type](l);return t===!0&&m.length>0&&s.J(l.value)==="array"?Oi(l):m}return hs(s.L({},l,{valueSpec:c.type?f[c.type]:c}))}function Qr(l){const t=l.value,i=l.key,c=ca(l);return c.length||(t.indexOf("{fontstack}")===-1&&c.push(new s.V(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&c.push(new s.V(i,t,'"glyphs" url must include a "{range}" token'))),c}function Wn(l,t=s.a5,i={}){return Un({key:i.key||"",value:l,valueSpec:t.$root,styleSpec:t,style:l,objectElementValidators:{glyphs:Qr,"*":()=>[]}})}function In(l,t=s.a5){return we(Wn(l,t))}const Nn=l=>we(Hi(l)),Ri=l=>we(wa(l)),Wi=l=>we(ba(l)),ft=l=>we(dl(l)),ws=l=>we(ua(l)),Xs=l=>we(function(t){const i=t.value,c=t.style,f=t.styleSpec,m=f.snow;let y=[];const w=s.J(i);if(i===void 0)return y;if(w!=="object")return y=y.concat([new s.V("snow",i,`object expected, ${w} found`)]),y;for(const S in i){const M=S.match(/^(.*)-transition$/);y=y.concat(M&&m[M[1]]&&m[M[1]].transition?Un({key:S,value:i[S],valueSpec:f.transition,style:c,styleSpec:f}):m[S]?Un({key:S,value:i[S],valueSpec:m[S],style:c,styleSpec:f}):[new s.K(S,i[S],`unknown property "${S}"`)])}return y}(l)),fo=l=>we(function(t){const i=t.value,c=t.style,f=t.styleSpec,m=f.rain;let y=[];const w=s.J(i);if(i===void 0)return y;if(w!=="object")return y=y.concat([new s.V("rain",i,`object expected, ${w} found`)]),y;for(const S in i){const M=S.match(/^(.*)-transition$/);y=y.concat(M&&m[M[1]]&&m[M[1]].transition?Un({key:S,value:i[S],valueSpec:f.transition,style:c,styleSpec:f}):m[S]?Un({key:S,value:i[S],valueSpec:m[S],style:c,styleSpec:f}):[new s.K(S,i[S],`unknown property "${S}"`)])}return y}(l)),en=l=>we(Wo(l)),Oe=l=>we(ho(l)),Y=l=>we(hl(l)),Q=l=>we(ks(l)),he=l=>we(s.a4(l));function we(l){return l.slice().sort((t,i)=>t.line&&i.line?t.line-i.line:0)}function me(l,t){let i=!1;if(t&&t.length)for(const c of t)c instanceof s.K?s.w(c.message):(l.fire(new s.z(new Error(c.message))),i=!0);return i}let Ae;class Ne extends s.E{constructor(t,i="flat"){super(),this._transitionable=new s.a6(Ae||(Ae=new s.a7({anchor:new s.a8(s.a5.light.anchor),position:new s.a9(s.a5.light.position),color:new s.a8(s.a5.light.color),intensity:new s.a8(s.a5.light.intensity)}))),this.setLight(t,i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,i,c={}){this._validate(Ri,t,c)||(this._transitionable.setTransitionOrValue(t),this.id=i)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,c){return(!c||c.validate!==!1)&&me(this,t.call(In,s.h({value:i,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let Ce=class extends s.E{constructor(l,t,i,c,f){super(),this.scope=i,this._transitionable=new s.a6(new s.a7({source:new s.a8(s.a5.terrain.source),exaggeration:new s.a8(s.a5.terrain.exaggeration)}),i,c),this._transitionable.setTransitionOrValue(l,c),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=f}get(){return this._transitionable.serialize()}set(l,t){this._transitionable.setTransitionOrValue(l,t)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}getExaggeration(l){return this._transitioning.possiblyEvaluate(new s.aa(l,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const l=this._transitionable._values.exaggeration;if(!l)return null;const t=l.value.expression;if(!t)return null;let i=-1,c=-1,f=1;for(const m of t.zoomStops)f=t.evaluate(new s.aa(m,{worldview:this.worldview})),f>.01?(i=m,c=-1):c=m;return f<.01&&i>0&&c>i?[i,c]:null}isZoomDependent(){const l=this._transitionable._values.exaggeration;return l!=null&&l.value!=null&&l.value.expression!=null&&l.value.expression instanceof s.ab}};const je=45,nt=65,Ue=.05;function Et(l,t,i,c){const f=s.af(je,nt,i),[m,y]=$t(l,c);let w=1-Math.min(1,Math.exp((t-m)/(y-m)*-6));return w*=w*w,w=Math.min(1,1.00747*w),w*f*l.alpha}function $t(l,t){const i=.5/Math.tan(.5*t);return[l.range[0]+i,l.range[1]+i]}function Yt(l,t,i,c,f){const m=s.ad([],[t,i,c],f.mercatorFogMatrix);return Et(l,s.ae(m),f.pitch,f._fov)}function mr(l,t,i,c,f,m,y){const w=[[i,c,0],[f,c,0],[f,m,0],[i,m,0]];let S=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(const P of w){const O=s.ad([],P,t),D=s.ae(O);S=Math.min(S,D),M=Math.max(M,D)}return[Et(l,S,y.pitch,y._fov),Et(l,M,y.pitch,y._fov)]}class _r extends s.E{constructor(t,i,c,f){super();const m=new s.a7({range:new s.a8(s.a5.fog.range),color:new s.a8(s.a5.fog.color),"color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.a8(s.a5.fog["high-color"]),"high-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.a8(s.a5.fog["space-color"]),"space-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.a8(s.a5.fog["horizon-blend"]),"star-intensity":new s.a8(s.a5.fog["star-intensity"]),"vertical-range":new s.a8(s.a5.fog["vertical-range"])});this._transitionable=new s.a6(m,c,new Map(f)),this.set(t,f),this._transitioning=this._transitionable.untransitioned(),this._transform=i,this.properties=new s.ag(m),this.scope=c}get state(){const t=this._transform,i=t.projection.name==="globe",c=s.ah(t.zoom),f=this.properties.get("range"),m=[.5,3];return{range:i?[s.ai(m[0],f[0],c),s.ai(m[1],f[1],c)]:f,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,i,c={}){if(this._validate(ws,t,c))return;const f=s.h({},t);for(const m of Object.keys(s.a5.fog))f[m]===void 0&&(f[m]=s.a5.fog[m].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,i)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.af(je,nt,t))*i.a}getOpacityAtLatLng(t,i){return this._transform.projection.supportsFog?function(c,f,m){const y=s.ac.fromLngLat(f),w=m.elevation?m.elevation.getAtPointOrZero(y):0;return Yt(c,y.x,y.y,w,m)}(this.state,t,i):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const i=this._transform.calculateFogTileMatrix(t.toUnwrapped());return mr(this.state,i,0,0,s.aj,s.aj,this._transform)}getOpacityForBounds(t,i,c,f,m){return this._transform.projection.supportsFog?mr(this.state,t,i,c,f,m,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?$t(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const i=[4,5,6,7];for(const c of i){const f=t.points[c];let m;if(f[2]>=0)m=f;else{const y=t.points[c-4];m=s.ak(y,f,y[2]/(y[2]-f[2]))}if(Yt(this.state,m[0],m[1],0,this._transform)>=Ue)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,c){return(!c||c.validate!==!1)&&me(this,t.call(In,s.h({value:i,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let xr,$r,Rr,jn,on=class extends s.E{constructor(l,t,i,c){super();const f=xr||(xr=new s.a7({density:new s.a8(s.a5.snow.density),intensity:new s.a8(s.a5.snow.intensity),color:new s.a8(s.a5.snow.color),opacity:new s.a8(s.a5.snow.opacity),vignette:new s.a8(s.a5.snow.vignette),"vignette-color":new s.a8(s.a5.snow["vignette-color"]),"center-thinning":new s.a8(s.a5.snow["center-thinning"]),direction:new s.a8(s.a5.snow.direction),"flake-size":new s.a8(s.a5.snow["flake-size"])}));this._transitionable=new s.a6(f,i,new Map(c)),this.set(l,c),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ag(f),this.scope=i}get state(){const l=this.properties.get("opacity"),t=this.properties.get("color"),i=this.properties.get("direction"),c=s.al(i[0]),f=-Math.max(s.al(i[1]),.01),m=[Math.cos(c)*Math.cos(f),Math.sin(c)*Math.cos(f),Math.sin(f)],y=this.properties.get("vignette"),w=this.properties.get("vignette-color");return w.a=y,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.am(t.r,t.g,t.b,t.a*l),direction:m,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:w}}get(){return this._transitionable.serialize()}set(l,t,i={}){if(this._validate(Xs,l,i))return;const c=s.h({},l);for(const f of Object.keys(s.a5.snow))c[f]===void 0&&(c[f]=s.a5.snow[f].default);this._options=c,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,t,i){return(!i||i.validate!==!1)&&me(this,l.call(In,s.h({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}},ti=class extends s.E{constructor(l,t,i,c){super();const f=$r||($r=new s.a7({density:new s.a8(s.a5.rain.density),intensity:new s.a8(s.a5.rain.intensity),color:new s.a8(s.a5.rain.color),opacity:new s.a8(s.a5.rain.opacity),vignette:new s.a8(s.a5.rain.vignette),"vignette-color":new s.a8(s.a5.rain["vignette-color"]),"center-thinning":new s.a8(s.a5.rain["center-thinning"]),direction:new s.a8(s.a5.rain.direction),"droplet-size":new s.a8(s.a5.rain["droplet-size"]),"distortion-strength":new s.a8(s.a5.rain["distortion-strength"])}));this._transitionable=new s.a6(f,i,new Map(c)),this.set(l,c),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ag(f),this.scope=i}get state(){const l=this.properties.get("opacity"),t=this.properties.get("color"),i=this.properties.get("direction"),c=s.al(i[0]),f=-Math.max(s.al(i[1]),.01),m=[Math.cos(c)*Math.cos(f),Math.sin(c)*Math.cos(f),Math.sin(f)],y=this.properties.get("vignette-color");return y.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.am(t.r,t.g,t.b,t.a*l),direction:m,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:y}}get(){return this._transitionable.serialize()}set(l,t,i={}){if(this._validate(fo,l,i))return;const c=s.h({},l);for(const f of Object.keys(s.a5.rain))c[f]===void 0&&(c[f]=s.a5.rain[f].default);this._options=c,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,t,i){return(!i||i.validate!==!1)&&me(this,l.call(In,s.h({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}};class An extends s.E{constructor(t,i,c,f){super(),this.scope=c,this._options=t,this.properties=new s.ag(i),this._transitionable=new s.a6(i,c,new Map(f)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,i){this._options=t,this._transitionable.setTransitionOrValue(t.properties,i)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class bn{constructor(t,i,c,f){this.screenBounds=t,this.cameraPoint=i,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,f)}static createFromScreenPoints(t,i){let c,f;if(t instanceof s.P||typeof t[0]=="number"){const m=s.P.convert(t);c=[m],f=i.isPointAboveHorizon(m)}else{const m=s.P.convert(t[0]),y=s.P.convert(t[1]),w=m.add(y)._div(2);c=[m,y],f=s.ao(m,y).every(S=>i.isPointAboveHorizon(S))&&i.isPointAboveHorizon(w)}return new bn(c,i.getCameraPoint(),f,i)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return s.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const i=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],f=s.ao(i,c,0,!1);return this.cameraPoint.y>c.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<c.x?f.splice(3,0,this.cameraPoint):this.cameraPoint.x>=c.x?f[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(f[3]=this.cameraPoint)),s.ap(f,t)}bufferedCameraGeometryGlobe(t){const i=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],f=s.ao(i,c,t),m=this.cameraPoint.clone();switch(3*((m.y>i.y)+(m.y>c.y))+((m.x>i.x)+(m.x>c.x))){case 0:f[0]=m,f[4]=m.clone();break;case 1:f.splice(1,0,m);break;case 2:f[1]=m;break;case 3:f.splice(4,0,m);break;case 5:f.splice(2,0,m);break;case 6:f[3]=m;break;case 7:f.splice(3,0,m);break;case 8:f[2]=m}return f}containsTile(t,i,c,f=0){const m=t.queryPadding/i._pixelsPerMercatorPixel+1,y=c?this._bufferedCameraMercator(m,i):this._bufferedScreenMercator(m,i);let w=t.tileID.wrap+(y.unwrapped?f:0);const S=y.polygon.map(W=>s.aq(t.tileTransform,W,w));if(!s.ar(S,0,0,s.aj,s.aj))return;w=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?f:0);const M=this.screenGeometryMercator.polygon.map(W=>s.as(t.tileTransform,W,w)),P=M.map(W=>new s.P(W[0],W[1])),O=i.getFreeCameraOptions().position||new s.ac(0,0,0),D=s.as(t.tileTransform,O,w),F=M.map(W=>{const X=s.at(W,W,D);return s.au(X,X),new s.av(D,X)}),q=s.aw(t,1,i.zoom)*i._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:F,bufferedTilespaceGeometry:S,bufferedTilespaceBounds:(V=s.ax(S),V.min.x=s.ay(V.min.x,0,s.aj),V.min.y=s.ay(V.min.y,0,s.aj),V.max.x=s.ay(V.max.x,0,s.aj),V.max.y=s.ay(V.max.y,0,s.aj),V),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:q};var V}_bufferedScreenMercator(t,i){const c=hi(t);if(this._screenRaycastCache[c])return this._screenRaycastCache[c];{let f;return f=i.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),i):{polygon:this.bufferedScreenGeometry(t).map(m=>i.pointCoordinate3D(m)),unwrapped:!0},this._screenRaycastCache[c]=f,f}}_bufferedCameraMercator(t,i){const c=hi(t);if(this._cameraRaycastCache[c])return this._cameraRaycastCache[c];{let f;return f=i.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),i):{polygon:this.bufferedCameraGeometry(t).map(m=>i.pointCoordinate3D(m)),unwrapped:!0},this._cameraRaycastCache[c]=f,f}}_projectAndResample(t,i){const c=function(m,y){const w=s.az([],y.pixelMatrix,y.globeMatrix),S=[0,-s.aB,0,1],M=[0,s.aB,0,1],P=[0,0,0,1];s.aA(S,S,w),s.aA(M,M,w),s.aA(P,P,w);const O=new s.P(S[0]/S[3],S[1]/S[3]),D=new s.P(M[0]/M[3],M[1]/M[3]),F=s.aC(m,O)&&S[3]<P[3],q=s.aC(m,D)&&M[3]<P[3];if(!F&&!q)return null;const V=function(pe,ue,ye){for(let xe=1;xe<pe.length;xe++){const Pe=xi(ue.pointCoordinate3D(pe[xe-1]).x),Le=xi(ue.pointCoordinate3D(pe[xe]).x);if(ye<0){if(Pe<Le)return{idx:xe,t:-Pe/(Le-1-Pe)}}else if(Le<Pe)return{idx:xe,t:(1-Pe)/(Le+1-Pe)}}return null}(m,y,F?-1:1);if(!V)return null;const{idx:W,t:X}=V;let J=W>1?gi(m.slice(0,W),y):[],se=W<m.length?gi(m.slice(W),y):[];J=J.map(pe=>new s.P(xi(pe.x),pe.y)),se=se.map(pe=>new s.P(xi(pe.x),pe.y));const le=[...J];le.length===0&&le.push(se[se.length-1]);const ge=s.ai(le[le.length-1].y,(se.length===0?J[0]:se[0]).y,X);let _e;return _e=F?[new s.P(0,ge),new s.P(0,0),new s.P(1,0),new s.P(1,ge)]:[new s.P(1,ge),new s.P(1,1),new s.P(0,1),new s.P(0,ge)],le.push(..._e),se.length===0?le.push(J[0]):le.push(...se),{polygon:le.map(pe=>new s.ac(pe.x,pe.y)),unwrapped:!1}}(t,i);if(c)return c;const f=function(m,y){let w=!1,S=-1/0,M=0;for(let O=0;O<m.length-1;O++)m[O].x>S&&(S=m[O].x,M=O);for(let O=0;O<m.length-1;O++){const D=(M+O)%(m.length-1),F=m[D],q=m[D+1];Math.abs(F.x-q.x)>.5&&(F.x<q.x?(F.x+=1,D===0&&(m[m.length-1].x+=1)):(q.x+=1,D+1===m.length-1&&(m[0].x+=1)),w=!0)}const P=s.aD(y.center.lng);return w&&P<Math.abs(P-1)&&m.forEach(O=>{O.x-=1}),{polygon:m,unwrapped:w}}(gi(t,i).map(m=>new s.P(xi(m.x),m.y)),i);return{polygon:f.polygon.map(m=>new s.ac(m.x,m.y)),unwrapped:f.unwrapped}}}function gi(l,t){return s.aE(l,i=>{const c=t.pointCoordinate3D(i);i.x=c.x,i.y=c.y},1/256)}function xi(l){return l<0?1+l%1:l%1}function hi(l){return 100*l|0}function Zi(l,t,i,c,f){const m=function(w,S){if(w)return f(w);if(S){if(l.url&&S.tiles&&l.tiles&&delete l.tiles,S.variants){if(!Array.isArray(S.variants))return f(new Error("variants must be an array"));for(const P of S.variants){if(P==null||typeof P!="object"||P.constructor!==Object)return f(new Error("variant must be an object"));if(!Array.isArray(P.capabilities))return f(new Error("capabilities must be an array"));if(P.capabilities.length===1&&P.capabilities[0]==="meshopt"){S=s.h(S,P);break}}}const M=s.aF(s.h({},S,l),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);M.tiles=t.canonicalizeTileset(M,l.url),f(null,M)}},y=function(w,S,M){if(!w)return null;if(!S&&!M)return w;M=M||w.worldview_default;const P=Object.values(w.language||{});if(P.length===0)return null;const O=Object.values(w.worldview||{});if(O.length===0)return null;const D=P.every(q=>q===S),F=O.every(q=>q===M);return D&&F?w:S in(w.language_options||{})||M in(w.worldview_options||{})?null:w.language_options&&w.worldview_options?w:null}(l.data,i,c);return y?s.q.frame(()=>m(null,y)):l.url?s.n(t.transformRequest(t.normalizeSourceURL(l.url,null,i,c),s.R.Source),m):s.q.frame(()=>{const{data:w,...S}=l;m(null,S)})}function Ui(l,t){const i=Math.pow(2,t.z),c=Math.floor(s.aD(l.getWest())*i),f=Math.floor(s.aH(l.getNorth())*i),m=Math.ceil(s.aD(l.getEast())*i),y=Math.ceil(s.aH(l.getSouth())*i);return t.x>=c&&t.x<m&&t.y>=f&&t.y<y}class $s{constructor(t,i,c){this.bounds=t?s.aG.convert(this.validateBounds(t)):null,this.minzoom=i||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const i of t)this.extraBounds.push(s.aG.convert(this.validateBounds(i)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!Ui(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const i of this.extraBounds)if(Ui(i,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const i=new $s(t.bounds,t.minzoom,t.maxzoom);return i.addExtraBounds(t.extra_bounds),i}}class po extends s.E{constructor(t,i,c,f){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.h(this,s.aF(i,["url","scheme","tileSize","promoteId"])),this._options=s.h({type:"vector"},i),this._collectResourceTiming=!!i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f),this._tileWorkers={},this._deduped=new s.aI}load(t){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=Zi(this._options,this.map._requestManager,i,c,(f,m)=>{if(this._tileJSONRequest=null,this._loaded=!0,f)i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),c&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new s.z(f));else if(m){if(s.h(this,m),this.hasWorldviews=!!m.worldview_options,m.worldview_default&&(this.worldviewDefault=m.worldview_default),m.vector_layers){this.vectorLayers=m.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const y of m.vector_layers)this.vectorLayerIds.push(y.id),m.worldview&&m.worldview[y.source]&&this.localizableLayerIds.add(y.id)}this.tileBounds=$s.fromTileJSON(m),Ot(m.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(f)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return s.h({},this._options)}loadTile(t,i){const c=t.tileID.canonical.url(this.tiles,this.scheme),f=this.map._requestManager.normalizeTileURL(c),m=this.map._requestManager.transformRequest(f,s.R.Tile),y=this.map.style?this.map.style.getLut(this.scope):null,w=y?{image:y.image.clone()}:null,S={request:m,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:w,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&s.j(c)&&(S.localizableLayerIds=this.localizableLayerIds),S.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=i:t.request=t.actor.send("reloadTile",S,M.bind(this));else if(t.actor=this._tileWorkers[f]=this._tileWorkers[f]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",S,M.bind(this),void 0,!0);else{const P=s.aJ.call({deduped:this._deduped},S,(O,D)=>{O||!D?M.call(this,O):(S.data={cacheControl:D.cacheControl,expires:D.expires,rawData:D.rawData.slice(0)},t.actor&&t.actor.send("loadTile",S,M.bind(this),void 0,!0))},!0);t.request={cancel:P}}function M(P,O){return delete t.request,t.aborted?i(null):P&&P.status!==404?i(P):(O&&O.resourceTiming&&(t.resourceTiming=O.resourceTiming),this.map._refreshExpiredTiles&&O&&t.setExpiryData(O),t.loadVectorData(O,this.map.painter),s.aK(this.dispatcher),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,i){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class bs extends s.E{constructor(t,i,c,f){super(),this.id=t,this.dispatcher=c,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.h({type:"raster"},i),s.h(this,s.aF(i,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const i=this.map.getWorldview();this._tileJSONRequest=Zi(this._options,this.map._requestManager,null,i,(c,f)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new s.z(c)):f&&(s.h(this,f),f.raster_layers&&(this.rasterLayers=f.raster_layers,this.rasterLayerIds=this.rasterLayers.map(m=>m.id)),this.tileBounds=$s.fromTileJSON(f),Ot(f.tiles),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(c)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return s.h({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,i){const c=s.q.devicePixelRatio>=2,f=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),c,this.tileSize);t.request=s.o(this.map._requestManager.transformRequest(f,s.R.Tile),(m,y,w,S)=>(delete t.request,t.aborted?(t.state="unloaded",i(null)):m?(t.state="errored",i(m)):y?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:w,expires:S}),t.setTexture(y,this.map.painter),t.state="loaded",s.aK(this.dispatcher),void i(null)):i(null)))}abortTile(t,i){t.request&&(t.request.cancel(),delete t.request),i&&i()}unloadTile(t,i){t.texture&&t.texture instanceof s.T?(t.destroy(!0),t.texture&&t.texture instanceof s.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),i&&i()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class $l extends bs{constructor(t,i,c,f){super(t,i,c,f),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=s.h({type:"raster-array"},i)}triggerRepaint(t){const i=this.map.painter._terrain,c=this.map.style.getSourceCache(this.id);i&&i.enabled&&c&&i._clearRenderCacheForTile(c.id,t.tileID),this.map.triggerRepaint()}loadTile(t,i){const c=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),f=this.map._requestManager.transformRequest(c,s.R.Tile),m={request:f,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=f,t.actor||(t.actor=this.dispatcher.getActor());const y=(w,S,M,P)=>{if(delete t.request,t.aborted)return t.state="unloaded",i(null);if(w)return w.name==="AbortError"?void 0:(t.state="errored",i(w));if(this.map._refreshExpiredTiles&&S&&t.setExpiryData({cacheControl:M,expires:P}),this.partial)t.state="empty";else{if(!S)return i(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=S}i(null)};t.request=this.partial?t.fetchHeader(void 0,y.bind(this)):t.actor.send("loadTile",m,y.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,i){const c=t.texture;c&&c instanceof s.T?(t.destroy(!0),this.map.painter.saveTileTexture(c)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,i,c){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(i,c,(f,m)=>{if(f)return t.state="errored",this.fire(new s.z(f)),void this.triggerRepaint(t);m&&(t._isHeaderLoaded=!0,t.setTexture(m,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const i=this.rasterLayers.find(({id:m})=>m===t),c=i&&i.fields,f=c&&c.bands&&c.bands;return f?f[0]:0}getTextureDescriptor(t,i,c){if(!t)return;const f=i.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!f)return;let m=null;i instanceof s.aN?m=i.paint.get("raster-array-band"):i instanceof s.aO&&(m=i.paint.get("raster-particle-array-band"));const y=m||this.getInitialBand(f);if(y!=null)if(t.textureDescriptor){if(!t.updateNeeded(f,y)||c)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,f,y)}getImages(t,i){const c=new Map;for(const f of t)for(const m of i){const[y,w]=m.split("/"),S=f.getLayer(y);if(!S||!S.hasBand(w)||!S.hasDataForBand(w))continue;const{bytes:M,tileSize:P,buffer:O}=S.getBandView(w),D=P+2*O,F={data:new s.r({width:D,height:D},M),pixelRatio:2,sdf:!1,usvg:!1,version:0};c.set(m,F)}return c}}const ad={vector:po,raster:bs,"raster-dem":class extends bs{constructor(l,t,i,c){super(l,t,i,c),this.type="raster-dem",this.maxzoom=22,this._options=s.h({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(l,t){const i=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function c(f,m){f&&(l.state="errored",t(f)),m&&(l.dem=m,l.dem.onDeserialize(),l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0,l.state="loaded",t(null))}l.request=s.o(this.map._requestManager.transformRequest(i,s.R.Tile),(function(f,m,y,w){if(delete l.request,l.aborted)l.state="unloaded",t(null);else if(f)l.state="errored",t(f);else if(m){this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:y,expires:w});const S=ImageBitmap&&m instanceof ImageBitmap&&s.t(),M=1-(m.width-s.aL(m.width))/2;M<1||l.neighboringTiles||(l.neighboringTiles=this._getNeighboringTiles(l.tileID));const P=S?m:s.q.getImageData(m,M),O={uid:l.uid,tileID:l.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:P,encoding:this.encoding,padding:M};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadTile",O,c.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(l){const t=l.canonical,i=Math.pow(2,t.z),c=(t.x-1+i)%i,f=t.x===0?l.wrap-1:l.wrap,m=(t.x+1+i)%i,y=t.x+1===i?l.wrap+1:l.wrap,w={};return w[new s.aM(l.overscaledZ,f,t.z,c,t.y).key]={backfilled:!1},w[new s.aM(l.overscaledZ,y,t.z,m,t.y).key]={backfilled:!1},t.y>0&&(w[new s.aM(l.overscaledZ,f,t.z,c,t.y-1).key]={backfilled:!1},w[new s.aM(l.overscaledZ,l.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},w[new s.aM(l.overscaledZ,y,t.z,m,t.y-1).key]={backfilled:!1}),t.y+1<i&&(w[new s.aM(l.overscaledZ,f,t.z,c,t.y+1).key]={backfilled:!1},w[new s.aM(l.overscaledZ,l.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},w[new s.aM(l.overscaledZ,y,t.z,m,t.y+1).key]={backfilled:!1}),w}},"raster-array":$l,geojson:class extends s.E{constructor(l,t,i,c){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(c),this._data=t.data,this._options=s.h({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const f=s.aj/this.tileSize;this.workerOptions=s.h({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*f,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*f,extent:s.aj,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:s.aj,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*f,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(l){this.map=l,this.setData(this._data)}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){if(!this._options.dynamic)return this.fire(new s.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof l!="string"&&(l.type==="Feature"&&(l={type:"FeatureCollection",features:[l]}),l.type!=="FeatureCollection"))return this.fire(new s.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof l!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const i of this._data.features)t.set(i.id,i);for(const i of l.features)t.set(i.id,i);this._data.features=[...t.values()]}else this._data=l;return this._updateWorkerData(!0),this}getClusterExpansionZoom(l,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterChildren(l,t){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterLeaves(l,t,i,c){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:l,limit:t,offset:i},c),this}_updateWorkerData(l=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.A("dataloading",{dataType:"source"})),this._loaded=!1;const t=s.h({append:l},this.workerOptions);t.scope=this.scope;const i=this._data;typeof i=="string"?(t.request=this.map._requestManager.transformRequest(s.q.resolveURL(i),s.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(c,f)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new s.z(c));else{const m={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&f&&f.resourceTiming&&f.resourceTiming[this.id]&&(m.resourceTiming=f.resourceTiming[this.id]),l&&(this._partialReload=!0),this.fire(new s.A("data",m)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(l),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const l=s.C(this.id,this.scope);this.map.style.clearSource(l),this._updateWorkerData()}loadTile(l,t){const i=l.actor?"reloadTile":"loadTile";l.actor=this.actor;const c=this.map.style?this.map.style.getLut(this.scope):null,f=c?{image:c.image.clone()}:null,m=this._partialReload,y={type:this.type,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:f,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:m,worldview:this.map.getWorldview()};l.request=this.actor.send(i,y,(w,S)=>m&&!S?(l.state="loaded",t(null)):(delete l.request,l.destroy(),l.aborted?t(null):w?t(w):(l.loadVectorData(S,this.map.painter,i==="reloadTile"),t(null))),void 0,i==="loadTile")}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l,t){this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}onRemove(l){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aP{constructor(l,t,i,c){super(l,t,i,c),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const l=this.options;this.urls=[];for(const t of l.urls)this.urls.push(this.map._requestManager.transformRequest(t,s.R.Source).url);s.aQ(this.urls,(t,i)=>{this._loaded=!0,t?this.fire(new s.z(t)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const t=this.video.seekable;l<t.start(0)||l>t.end(0)?this.fire(new s.z(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,t=l.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(l,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(l)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aP,model:class extends s.E{constructor(l,t,i,c){super(),this.id=l,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const l=[];for(const t in this._options.models){const i=this._options.models[t],c=s.aS(this.map._requestManager.transformRequest(i.uri,s.R.Model).url).then(f=>{if(!f)return;const m=s.aT(f),y=new s.aU(t,i.position,i.orientation,m);y.computeBoundsAndApplyParent(),this.models.push(y)}).catch(f=>{this.fire(new s.z(new Error(`Could not load model ${t} from ${i.uri}: ${f.message}`)))});l.push(c)}Promise.allSettled(l).then(()=>{this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this._loaded=!0,this.fire(new s.z(new Error(`Could not load models: ${t.message}`)))})}onAdd(l){this.map=l,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(l,t){}serialize(){return this._options}},"batched-model":class extends s.E{constructor(l,t,i,c){super(),this.type="batched-model",this.id=l,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=i,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(c)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(l){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map.getWorldview();this._tileJSONRequest=Zi(this._options,this.map._requestManager,t,i,(c,f)=>{this._tileJSONRequest=null,this._loaded=!0,c?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),i&&i.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${i}`),this.fire(new s.z(c))):f&&(s.h(this,f),f.bounds&&(this.tileBounds=new $s(f.bounds,this.minzoom,this.maxzoom)),Ot(f.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),l&&l(c)})}hasTransition(){return!1}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loaded(){return this._loaded}loadTile(l,t){const i=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),c={request:this.map._requestManager.transformRequest(i,s.R.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.q.devicePixelRatio,promoteId:this.promoteId};if(l.actor&&l.state!=="expired")if(l.state==="loading")l.reloadCallback=t;else{if(l.buckets){const m=Object.values(l.buckets);for(const y of m)y.dirty=!0;return void(l.state="loaded")}l.request=l.actor.send("reloadTile",c,f.bind(this))}else l.actor=this.dispatcher.getActor(),l.request=l.actor.send("loadTile",c,f.bind(this),void 0,!0);function f(m,y){return l.aborted?t(null):m&&m.status!==404?t(m):(this.map._refreshExpiredTiles&&y&&l.setExpiryData(y),l.loadModelData(y,this.map.painter),l.state="loaded",void t(null))}}serialize(){return s.h({},this._options)}},canvas:class extends s.aP{constructor(l,t,i,c){super(l,t,i,c),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(m=>typeof m!="number"))||this.fire(new s.z(new s.V(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.z(new s.V(`sources.${l}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new s.z(new s.V(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new s.z(new s.V(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.z(new s.V(`sources.${l}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(l){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!l&&!this._playing||this.texture instanceof s.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}},custom:class extends s.E{constructor(l,t,i,c){super(),this.id=l,this.type="custom",this._dataType="raster",this._dispatcher=i,this._implementation=t,this.setEventedParent(c),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new $s(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),s.h(this,s.aF(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(l){this.map=l,this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(l),this.load()}onRemove(l){this._implementation.onRemove&&this._implementation.onRemove(l)}hasTile(l){if(this._implementation.hasTile){const{x:t,y:i,z:c}=l.canonical;return this._implementation.hasTile({x:t,y:i,z:c})}return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,t){const{x:i,y:c,z:f}=l.tileID.canonical,m=new AbortController;l.request=Promise.resolve(this._implementation.loadTile({x:i,y:c,z:f},{signal:m.signal})).then((function(y){return delete l.request,l.aborted?(l.state="unloaded",t(null)):y===void 0?(l.state="errored",t(null)):y===null?(this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",t(null)):function(w){return w instanceof ImageData||w instanceof HTMLCanvasElement||w instanceof ImageBitmap||w instanceof HTMLImageElement}(y)?(this.loadTileData(l,y),l.state="loaded",void t(null)):(l.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(y=>{y.name!=="AbortError"&&(l.state="errored",t(y))}),l.request.cancel=()=>m.abort()}loadTileData(l,t){l.setTexture(t,this.map.painter)}unloadTile(l,t){if(l.texture&&l.texture instanceof s.T?(l.destroy(!0),l.texture&&l.texture instanceof s.T&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),this._implementation.unloadTile){const{x:i,y:c,z:f}=l.tileID.canonical;this._implementation.unloadTile({x:i,y:c,z:f})}t&&t()}abortTile(l,t){l.request&&l.request.cancel&&(l.request.cancel(),delete l.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(l=>({x:l.canonical.x,y:l.canonical.y,z:l.canonical.z}))}_clearTiles(){const l=s.C(this.id,this.scope);this.map.style.clearSource(l)}_update(){this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}}},Gl=function(l,t,i,c){const f=new ad[t.type](l,t,i,c);if(f.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${f.id}`);return s.aV(["load","abort","unload","serialize","prepare"],f),f};function ql(l,t,i=""){return`${i}:${t.id||""}:${t.layer.id}:${function(c){if("layerId"in c)return`layer:${c.layerId}`;{const{featuresetId:f,importId:m}=c;return`featureset:${f}${m?`:import:${m}`:""}`}}(l.target)}`}function Hl(l,t,i,c=""){if(l.uniqueFeatureID){const f=ql(l,t,c);if(i.has(f))return!0;i.add(f)}return!1}function Ic(l,t,i,c,f=!1){const m=t.sourceCache.transform,y=t.sourceCache.tilesIn(l,t.has3DLayers,f);y.sort(_u);const w=[];for(const S of y){const M=S.tile.queryRenderedFeatures(t,S,i,c,m,f);Object.keys(M).length&&w.push({wrappedTileID:S.tile.tileID.wrapped().key,queryResults:M})}return w.length===0?{}:function(S){const M={},P={};for(const O of S){const D=O.queryResults,F=O.wrappedTileID,q=P[F]=P[F]||{};for(const V in D){const W=D[V],X=q[V]=q[V]||{},J=M[V]=M[V]||[];for(const se of W)X[se.featureIndex]||(X[se.featureIndex]=!0,J.push(se))}}return M}(w)}function Ac(l,t,i,c,f,m){const y={},w=c.queryRenderedSymbols(l),S=[];for(const M of Object.keys(w).map(Number))S.push(f[M]);S.sort(_u);for(const M of S){const P=M.featureIndex.lookupSymbolFeatures(w[M.bucketInstanceId],M.bucketIndex,M.sourceLayerIndex,t,i,m);for(const O in P){const D=y[O]=y[O]||[],F=P[O];F.sort((q,V)=>{const W=M.featureSortOrder;if(W){const X=W.indexOf(q.featureIndex);return W.indexOf(V.featureIndex)-X}return V.featureIndex-q.featureIndex});for(const q of F)D.push(q)}}return y}function dh(l,t){const i=l.getRenderableIds().map(m=>l.getTileByID(m)),c=[],f={};for(let m=0;m<i.length;m++){const y=i[m],w=y.tileID.canonical.key;f[w]||(f[w]=!0,y.querySourceFeatures(c,t))}return c}function _u(l,t){const i=l.tileID,c=t.tileID;return i.overscaledZ-c.overscaledZ||i.canonical.y-c.canonical.y||i.wrap-c.wrap||i.canonical.x-c.canonical.x}function ha(l,t){const i={};if(!t)return i;for(const c of l){const f=c.layerIds.map(m=>t.getLayer(m)).filter(Boolean);if(f.length!==0){c.layers=f,c.stateDependentLayerIds&&(c.stateDependentLayers=c.stateDependentLayerIds.map(m=>f.filter(y=>y.id===m)[0]));for(const m of f)i[m.fqid]=c}}return i}const mo=32,Ys=33,fl=new Uint16Array(8184);for(let l=0;l<2046;l++){let t=l+2,i=0,c=0,f=0,m=0,y=0,w=0;for(1&t?f=m=y=mo:i=c=w=mo;(t>>=1)>1;){const M=i+f>>1,P=c+m>>1;1&t?(f=i,m=c,i=y,c=w):(i=f,c=m,f=y,m=w),y=M,w=P}const S=4*l;fl[S+0]=i,fl[S+1]=c,fl[S+2]=f,fl[S+3]=m}const Xo=new Uint16Array(2178),Yn=new Uint8Array(1089),yu=new Uint16Array(1089);function Ta(l){return l===0?-.03125:l===32?.03125:0}const Cc={type:2,extent:s.aj,loadGeometry:()=>[[new s.P(0,0),new s.P(s.aj+1,0),new s.P(s.aj+1,s.aj+1),new s.P(0,s.aj+1),new s.P(0,0)]]};class Wl{constructor(t,i,c,f,m,y){this.tileID=t,this.uid=s.a$(),this.uses=0,this.tileSize=i,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,f&&f.style&&(this._lastUpdatedBrightness=f.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection),this.worldview=y}registerFadeDuration(t){const i=t+this.timeAdded;i<s.q.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,i,c){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=ha(t.buckets,i.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const m=this.buckets[f];if(m instanceof s.b1){if(this.hasSymbolBuckets=!0,!c)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const m=this.buckets[f];if(m instanceof s.b1&&m.hasRTLText){this.hasRTLText=!0,s.b2();break}}this.queryPadding=0;for(const f in this.buckets){const m=this.buckets[f],y=i.style.getOwnLayer(f);if(!y)continue;const w=y.queryRadius(m);this.queryPadding=Math.max(this.queryPadding,w)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new s.b0}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,i,c){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,ha(t.buckets,i.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const f in this.buckets){const m=this.buckets[f];m.uploadPending()&&m.upload(t)}const i=t.gl,c=this.imageAtlas;c&&!c.uploaded&&(this.imageAtlasTexture=new s.T(t,c.image,i.RGBA8,{useMipmap:!!c.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(t,this.glyphAtlasImage,i.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(t,this.lineAtlas.image,i.R8),this.lineAtlas.uploaded=!0)}prepare(t,i,c){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,c),!i||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const f=i.style.getBrightness();(this._lastUpdatedBrightness||f)&&(this._lastUpdatedBrightness&&f&&Math.abs(this._lastUpdatedBrightness-f)<.001||(this.updateBuckets(i,this._lastUpdatedBrightness!==f),this._lastUpdatedBrightness=f))}queryRenderedFeatures(t,i,c,f,m,y){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const w=function(S,M){const P=s.bn([],[.5*S.width,.5*-S.height,1]);return s.bo(P,P,[1,-1,0]),s.az(P,P,S.calculateProjMatrix(M.toUnwrapped())),Float32Array.from(P)}(m,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:i,pixelPosMatrix:w,transform:f,availableImages:c,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(t,i){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const f=c.loadVTLayers(),m=i?i.sourceLayer:"",y=f._geojsonTileLayer||f[m];if(!y)return;const w=s.b3(i&&i.filter),{z:S,x:M,y:P}=this.tileID.canonical,O={z:S,x:M,y:P};for(let D=0;D<y.length;D++){const F=y.feature(D);if(w.needGeometry){const W=s.b4(F,!0);if(!w.filter(new s.aa(this.tileID.overscaledZ,{worldview:this.worldview}),W,this.tileID.canonical))continue}else if(!w.filter(new s.aa(this.tileID.overscaledZ,{worldview:this.worldview}),F))continue;const q=c.getId(F,m),V=new s.b5(F,S,M,P,q);V.tile=O,t.push(V)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const i=this.expirationTime;if(t.cacheControl){const c=s.b6(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let f=!1;if(this.expirationTime>c)f=!1;else if(i)if(this.expirationTime<i)f=!0;else{const m=this.expirationTime-i;m?this.expirationTime=c+Math.max(m,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,i){if(!this.latestFeatureIndex||!t.style)return;const c=this.latestFeatureIndex.loadVTLayers(),f=t.style.listImages(),m=t.style.getBrightness();for(const y in this.buckets){if(!t.style.hasLayer(y))continue;const w=this.buckets[y],S=w.layers[0],M=S.sourceLayer||"_geojsonTileLayer",P=c[M],O=t.style.getLayerSourceCache(S);let D={};O&&(D=O._state.getState(M,void 0));const F=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},q=Object.keys(D).length>0&&!i;q&&!w.stateDependentLayers.length&&!i||w.update(D,P,f,F,q?w.stateDependentLayers:w.layers,i,m),(w instanceof s.b7||w instanceof s.b8)&&t._terrain&&t._terrain.enabled&&O&&w.uploadPending()&&t._terrain._clearRenderCacheForTile(O.id,this.tileID);const V=t&&t.style&&t.style.getOwnLayer(y);V&&(this.queryPadding=Math.max(this.queryPadding,V.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.q.now()+t}setTexture(t,i){const c=i.context,f=c.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture&&this.texture instanceof s.T?this.texture.update(t):(this.texture=new s.T(c,t,f.RGBA8,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE))}setDependencies(t,i){const c={};for(const f of i)c[f]=!0;this.dependencies[t]=c}hasDependency(t,i){for(const c of t){const f=this.dependencies[c];if(f){for(const m of i)if(f[m])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const c=s.b9(Cc,this.tileID.canonical,this.tileTransform)[0],f=new s.ba,m=new s.bb;for(let y=0;y<c.length;y++){const{x:w,y:S}=c[y];f.emplaceBack(w,S),m.emplaceBack(y)}m.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(m),this._tileDebugBuffer=t.createVertexBuffer(f,s.bc.members),this._tileDebugSegments=s.bd.simpleSegment(0,0,f.length,m.length)}_makeTileBoundsBuffers(t,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const c=s.b9(Cc,this.tileID.canonical,this.tileTransform)[0];let f,m;if(this.isRaster){const y=function(w,S){const M=s.aW(w,S),P=Math.pow(2,w.z);for(let W=0;W<Ys;W++)for(let X=0;X<Ys;X++){const J=s.aX((w.x+(X+Ta(X))/mo)/P),se=s.aY((w.y+(W+Ta(W))/mo)/P),le=S.project(J,se),ge=W*Ys+X;Xo[2*ge+0]=Math.round((le.x*M.scale-M.x)*s.aj),Xo[2*ge+1]=Math.round((le.y*M.scale-M.y)*s.aj)}Yn.fill(0),yu.fill(0);for(let W=2045;W>=0;W--){const X=4*W,J=fl[X+0],se=fl[X+1],le=fl[X+2],ge=fl[X+3],_e=J+le>>1,pe=se+ge>>1,ue=_e+pe-se,ye=pe+J-_e,xe=se*Ys+J,Pe=ge*Ys+le,Le=pe*Ys+_e,Ye=Math.hypot((Xo[2*xe+0]+Xo[2*Pe+0])/2-Xo[2*Le+0],(Xo[2*xe+1]+Xo[2*Pe+1])/2-Xo[2*Le+1])>=16;Yn[Le]=Yn[Le]||(Ye?1:0),W<1022&&(Yn[Le]=Yn[Le]||Yn[(se+ye>>1)*Ys+(J+ue>>1)]||Yn[(ge+ye>>1)*Ys+(le+ue>>1)])}const O=new s.aZ,D=new s.a_;let F=0;function q(W,X){const J=X*Ys+W;return yu[J]===0&&(O.emplaceBack(Xo[2*J+0],Xo[2*J+1],W*s.aj/mo,X*s.aj/mo),yu[J]=++F),yu[J]-1}function V(W,X,J,se,le,ge){const _e=W+J>>1,pe=X+se>>1;if(Math.abs(W-le)+Math.abs(X-ge)>1&&Yn[pe*Ys+_e])V(le,ge,W,X,_e,pe),V(J,se,le,ge,_e,pe);else{const ue=q(W,X),ye=q(J,se),xe=q(le,ge);D.emplaceBack(ue,ye,xe)}}return V(0,0,mo,mo,mo,0),V(mo,mo,0,0,0,mo),{vertices:O,indices:D}}(this.tileID.canonical,i);f=y.vertices,m=y.indices}else{f=new s.aZ,m=new s.a_;for(const{x:w,y:S}of c)f.emplaceBack(w,S,0,0);const y=s.be(f.int16.subarray(0,4*f.length),void 0,4);for(let w=0;w<y.length;w+=3)m.emplaceBack(y[w],y[w+1],y[w+2])}this._tileBoundsBuffer=t.createVertexBuffer(f,s.bf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(m),this._tileBoundsSegments=s.bd.simpleSegment(0,0,f.length,m.length)}_makeGlobeTileDebugBuffers(t,i){const c=i.projection;if(!c||c.name!=="globe"||i.freezeTileCoverage)return;const f=this.tileID.canonical,m=s.bg(f,i),y=s.bh(m),w=s.ah(i.zoom);let S;w>0&&(S=s.bi(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,f,i,y,S,w),this._makeGlobeTileDebugTextBuffer(t,f,i,y,S,w)}_globePoint(t,i,c,f,m,y,w){let S=s.bj(t,i,c);if(y){const M=1<<c.z,P=s.aD(f.center.lng),O=s.aH(f.center.lat),D=(c.x+.5)/M-P;let F=0;D>.5?F=-1:D<-.5&&(F=1);let q=(t/s.aj+c.x)/M+F,V=(i/s.aj+c.y)/M;q=(q-P)*f._pixelsPerMercatorPixel+P,V=(V-O)*f._pixelsPerMercatorPixel+O;const W=[q*f.worldSize,V*f.worldSize,0];s.ad(W,W,y),S=s.bk(S,W,w)}return s.ad(S,S,m)}_makeGlobeTileDebugBorderBuffer(t,i,c,f,m,y){const w=new s.ba,S=new s.bb,M=new s.bl,P=(D,F,q,V,W)=>{const X=(q-D)/(W-1),J=(V-F)/(W-1),se=w.length;for(let le=0;le<W;le++){const ge=D+le*X,_e=F+le*J;w.emplaceBack(ge,_e);const pe=this._globePoint(ge,_e,i,c,f,m,y);M.emplaceBack(pe[0],pe[1],pe[2]),S.emplaceBack(se+le)}},O=s.aj;P(0,0,O,0,16),P(O,0,O,O,16),P(O,O,0,O,16),P(0,O,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(S),this._tileDebugBuffer=t.createVertexBuffer(w,s.bc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(M,s.bm.members),this._tileDebugSegments=s.bd.simpleSegment(0,0,w.length,S.length)}_makeGlobeTileDebugTextBuffer(t,i,c,f,m,y){const w=s.aj/4,S=new s.ba,M=new s.a_,P=new s.bl,O=25;M.reserve(32),S.reserve(O),P.reserve(O);const D=(F,q)=>O*F+q;for(let F=0;F<O;F++){const q=F*w;for(let V=0;V<O;V++){const W=V*w;S.emplaceBack(W,q);const X=this._globePoint(W,q,i,c,f,m,y);P.emplaceBack(X[0],X[1],X[2])}}for(let F=0;F<4;F++)for(let q=0;q<4;q++){const V=D(F,q),W=D(F,q+1),X=D(F+1,q),J=D(F+1,q+1);M.emplaceBack(V,W,X),M.emplaceBack(X,W,J)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(M),this._tileDebugTextBuffer=t.createVertexBuffer(S,s.bc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(P,s.bm.members),this._tileDebugTextSegments=s.bd.simpleSegment(0,0,O,32)}destroy(t=!1){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bp.setPbf(s.bq);class Mc extends Wl{constructor(t,i,c,f,m){super(t,i,c,f,m),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexture(t,i){const c=i.context,f=c.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture&&this.texture instanceof s.T?this.texture.update(t,{premultiply:!1}):this.texture=new s.T(c,t,f.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,i){const c=this._mrt=new s.bp(30),f=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=s.br(f,(m,y,w,S)=>{if(m)i(m);else try{const M=c.getHeaderLength(y);if(M>t)return void(this.request=this.fetchHeader(M,i));c.parseHeader(y),this._isHeaderLoaded=!0;let P=0;for(const O of Object.values(c.layers))P=Math.max(P,O.dataIndex[O.dataIndex.length-1].lastByte);y.byteLength>=P&&(this.entireBuffer=y),i(null,this.entireBuffer||y,w,S)}catch(M){i(M)}}),this.request}fetchBand(t,i,c){const f=this._mrt;if(!this._isHeaderLoaded||!f)return void c(new Error("Tile header is not ready"));const m=this.actor;if(!m)return void c(new Error("Can't fetch tile band without an actor"));let y;const w=(O,D)=>{y.complete(O,D),O?c(O):(this.updateTextureDescriptor(t,i),c(null,this.textureDescriptor&&this.textureDescriptor.img))},S=(O,D)=>{if(O)return c(O);const F=m.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:D,task:y},w,void 0,!0);this._workQueue.push(()=>{F&&F.cancel(),y.cancel()})},M=f.getLayer(t);if(!M)return void c(new Error(`Unknown sourceLayer "${t}"`));if(M.hasDataForBand(i))return this.updateTextureDescriptor(t,i),void c(null,this.textureDescriptor?this.textureDescriptor.img:null);const P=M.getDataRange([i]);if(y=f.createDecodingTask(P),!y||y.tasks.length)if(this.flushQueues(),this.entireBuffer)S(null,this.entireBuffer.slice(P.firstByte,P.lastByte+1));else{const O=Object.assign({},this.requestParams,{headers:{Range:`bytes=${P.firstByte}-${P.lastByte}`}}),D=s.br(O,S);this._fetchQueue.push(()=>{D.cancel(),y.cancel()})}else c(null)}updateNeeded(t,i){return(!this.textureDescriptor||this.textureDescriptor.band!==i||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,i){if(!this._mrt)return;const c=this._mrt.getLayer(t);if(!c||!c.hasBand(i)||!c.hasDataForBand(i))return;const{bytes:f,tileSize:m,buffer:y,offset:w,scale:S}=c.getBandView(i),M=m+2*y,P=new s.r({width:M,height:M},f),O=this.texture;O&&O instanceof s.T&&O.update(P,{premultiply:!1}),this.textureDescriptor={layer:t,band:i,img:P,buffer:y,offset:w,tileSize:m,format:c.pixelFormat,mix:[S,256*S,65536*S,16777216*S]}}}class ld{constructor(t,i){this.max=t,this.onRemove=i,this.reset()}reset(){for(const t in this.data)for(const i of this.data[t])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(t,i,c){const f=t.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);const m={value:i,timeout:void 0};if(c!==void 0&&(m.timeout=setTimeout(()=>{this.remove(t,m)},c)),this.data[f].push(m),this.order.push(f),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const i=this.data[t].shift();return i.timeout&&clearTimeout(i.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),i.value}getByKey(t){const i=this.data[t];return i?i[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,i){if(!this.has(t))return this;const c=t.wrapped().key,f=i===void 0?0:this.data[c].indexOf(i),m=this.data[c][f];return this.data[c].splice(f,1),m.timeout&&clearTimeout(m.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(m.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(t){const i=[];for(const c in this.data)for(const f of this.data[c])t(f.value)||i.push(f);for(const c of i)this.remove(c.value.tileID,c)}}class fh{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,i,c){const f=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][f]=this.stateChanges[t][f]||{},s.h(this.stateChanges[t][f],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const m in this.state[t])m!==f&&(this.deletedStates[t][m]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][f]===null){this.deletedStates[t][f]={};for(const m in this.state[t][f])c[m]||(this.deletedStates[t][f][m]=null)}else for(const m in c)this.deletedStates[t]&&this.deletedStates[t][f]&&this.deletedStates[t][f][m]===null&&delete this.deletedStates[t][f][m]}removeFeatureState(t,i,c){if(this.deletedStates[t]===null)return;const f=String(i);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&i!==void 0)this.deletedStates[t][f]!==null&&(this.deletedStates[t][f]=this.deletedStates[t][f]||{},this.deletedStates[t][f][c]=null);else if(i!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][f])for(c in this.deletedStates[t][f]={},this.stateChanges[t][f])this.deletedStates[t][f][c]=null;else this.deletedStates[t][f]=null;else this.deletedStates[t]=null}getState(t,i){const c=this.state[t]||{},f=this.stateChanges[t]||{},m=this.deletedStates[t];if(m===null)return{};if(i!==void 0){const w=String(i),S=s.h({},c[w],f[w]);if(m){const M=m[i];if(M===null)return{};for(const P in M)delete S[P]}return S}const y=s.h({},c,f);if(m)for(const w in m)delete y[w];return y}initializeTileState(t,i){t.refreshFeatureState(i)}coalesceChanges(t,i){const c={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const m={};for(const y in this.stateChanges[f])this.state[f][y]||(this.state[f][y]={}),s.h(this.state[f][y],this.stateChanges[f][y]),m[y]=this.state[f][y];c[f]=m}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const m={};if(this.deletedStates[f]===null)for(const y in this.state[f])m[y]={},this.state[f][y]={};else for(const y in this.deletedStates[f]){if(this.deletedStates[f][y]===null)this.state[f][y]={};else if(this.state[f][y])for(const w of Object.keys(this.deletedStates[f][y]))delete this.state[f][y][w];m[y]=this.state[f][y]}c[f]=c[f]||{},s.h(c[f],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const f in t)t[f].refreshFeatureState(i)}}class Ls extends s.E{constructor(t,i,c){super(),this.id=t,this._onlySymbols=c,i.on("data",f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new ld(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new fh,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,i){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,i)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const c=this._tiles[i];c.upload(t),c.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Co).map(t=>t.key)}getRenderableIds(t,i){const c=[];for(const f in this._tiles)this._isIdRenderable(+f,t,i)&&c.push(this._tiles[f]);return t?c.sort((f,m)=>{const y=f.tileID,w=m.tileID,S=new s.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),M=new s.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-w.overscaledZ||M.y-S.y||M.x-S.x}).map(f=>f.tileID.key):c.map(f=>f.tileID).sort(Co).map(f=>f.key)}hasRenderableParent(t){const i=this.findLoadedParent(t,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(t,i,c){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(i||!this._tiles[t].holdingForFade())&&(c||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,i){const c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=i),this._loadTile(c,this._tileLoaded.bind(this,c,t,i)))}_tileLoaded(t,i,c,f){if(f)if(t.state="errored",f.status!==404)this._source.fire(new s.z(f,{tile:t}));else{if(this._source.fire(new s.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=s.q.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new s.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const i=this.getRenderableIds();for(let f=0;f<i.length;f++){const m=i[f];if(t.neighboringTiles&&t.neighboringTiles[m]){const y=this.getTileByID(m);c(t,y),c(y,t)}}function c(f,m){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let y=m.tileID.canonical.x-f.tileID.canonical.x;const w=m.tileID.canonical.y-f.tileID.canonical.y,S=Math.pow(2,f.tileID.canonical.z),M=m.tileID.key;y===0&&w===0||Math.abs(w)>1||(Math.abs(y)>1&&(Math.abs(y+S)===1?y+=S:Math.abs(y-S)===1&&(y-=S)),m.dem&&f.dem&&(f.dem.backfillBorder(m.dem,y,w),f.neighboringTiles&&f.neighboringTiles[M]&&(f.neighboringTiles[M].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,i,c,f){for(const m in this._tiles){let y=this._tiles[m];if(f[m]||!y.hasData()||y.tileID.overscaledZ<=i||y.tileID.overscaledZ>c)continue;let w=y.tileID;for(;y&&y.tileID.overscaledZ>i+1;){const M=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[M.key],y&&y.hasData()&&(w=M)}let S=w;for(;S.overscaledZ>i;)if(S=S.scaledTo(S.overscaledZ-1),t[S.key]){f[w.key]=w;break}}}findLoadedParent(t,i){if(t.key in this._loadedParentTiles){const c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=i?c:null}for(let c=t.overscaledZ-1;c>=i;c--){const f=t.scaledTo(c),m=this._getLoadedTile(f);if(m)return m}}_getLoadedTile(t){const i=this._tiles[t.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,i){i=i||this._source.tileSize;const c=Math.ceil(t.width/i)+1,f=Math.ceil(t.height/i)+1,m=Math.floor(c*f*5),y=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,m):m,w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(w)}handleWrapJump(t){const i=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,i){const c={};for(const f in this._tiles){const m=this._tiles[f];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+i),c[m.tileID.key]=m}this._tiles=c;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(t,i,c,f,m){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;this.updateCacheSize(t,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const y=this._source.type==="batched-model";let w,S=this._source.maxzoom;const M=this.map&&this.map.painter?this.map.painter._terrain:null;if(M&&M.sourceCache===this&&M.attenuationRange()){const D=M.attenuationRange()[0],F=Math.floor(D)-Math.log2(M.getDemUpscale());S>F&&(S=F)}if(this.used||this.usedForTerrain){if(this._source.tileID)w=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new s.aM(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y));else if(this.tileCoverLift!==0){const D=t.clone();D.tileCoverLift=this.tileCoverLift,w=D.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:S,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:y}),this._source.minzoom<=1&&t.projection.name==="globe"&&(w.push(new s.aM(1,0,1,0,0)),w.push(new s.aM(1,0,1,1,0)),w.push(new s.aM(1,0,1,0,1)),w.push(new s.aM(1,0,1,1,1)))}else if(w=t.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:S,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:y}),this._source.hasTile){const D=this._source.hasTile.bind(this._source);w=w.filter(F=>D(F))}}else w=[];if(w.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!da(this._source.type)){const D=t.coveringZoomLevel({tileSize:i||this._source.tileSize,roundZoom:this._source.roundZoom&&!c}),F=Math.min(D,this._source.maxzoom);if(y){const q=t.extendTileCover(w,F);for(const V of q)w.push(V)}else if(m){const q=t.extendTileCover(w,F,this.transform._camera.forward());for(const V of q)w.push(V)}else if(this.castsShadows&&f){const q=t.extendTileCover(w,F,f);for(const V of q)this._shadowCasterTiles[V.key]=!0,w.push(V)}}const P=this._updateRetainedTiles(w);if(da(this._source.type)&&w.length!==0){const D={},F={},q=Object.keys(P);for(const W of q){const X=P[W],J=this._tiles[W];if(!J||J.fadeEndTime&&J.fadeEndTime<=s.q.now())continue;const se=this.findLoadedParent(X,Math.max(X.overscaledZ-Ls.maxOverzooming,this._source.minzoom));se&&(this._addTile(se.tileID),D[se.tileID.key]=se.tileID),F[W]=X}const V=w[w.length-1].overscaledZ;for(const W in this._tiles){const X=this._tiles[W];if(P[W]||!X.hasData())continue;let J=X.tileID;for(;J.overscaledZ>V;){J=J.scaledTo(J.overscaledZ-1);const se=this._tiles[J.key];if(se&&se.hasData()&&F[J.key]){P[W]=X.tileID;break}}}for(const W in D)P[W]||(this._coveredTiles[W]=!0,P[W]=D[W])}for(const D in P)this._tiles[D].clearFadeHold();const O=s.bs(this._tiles,P);for(const D of O){const F=this._tiles[D];F.hasSymbolBuckets&&!F.holdingForFade()?F.setHoldDuration(this.map._fadeDuration):F.hasSymbolBuckets&&!F.symbolFadeFinished()||this._removeTile(+D)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const i={};if(t.length===0)return i;const c={},f=t.reduce((M,P)=>Math.min(M,P.overscaledZ),1/0),m=t[0].overscaledZ,y=Math.max(m-Ls.maxOverzooming,this._source.minzoom),w=Math.max(m+Ls.maxUnderzooming,this._source.minzoom),S={};for(const M of t){const P=this._addTile(M);i[M.key]=M,P.hasData()||f<this._source.maxzoom&&(S[M.key]=M)}this._retainLoadedChildren(S,f,w,i);for(const M of t){let P=this._tiles[M.key];if(P.hasData())continue;if(M.canonical.z>=this._source.maxzoom){const D=M.children(this._source.maxzoom)[0],F=this.getTile(D);if(F&&F.hasData()){i[D.key]=D;continue}}else{const D=M.children(this._source.maxzoom);if(i[D[0].key]&&i[D[1].key]&&i[D[2].key]&&i[D[3].key])continue}let O=P.wasRequested();for(let D=M.overscaledZ-1;D>=y;--D){const F=M.scaledTo(D);if(c[F.key]||(c[F.key]=!0,P=this.getTile(F),!P&&O&&(P=this._addTile(F)),P&&(i[F.key]=F,O=P.wasRequested(),P.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const i=[];let c,f=this._tiles[t].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){c=this._loadedParentTiles[f.key];break}i.push(f.key);const m=f.scaledTo(f.overscaledZ-1);if(c=this._getLoadedTile(m),c)break;f=m}for(const m of i)this._loadedParentTiles[m]=c}}_addTile(t){let i=this._tiles[t.key];if(i)return i.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));const c=!!i;if(!c){const f=this.map?this.map.painter:null,m=this._source.tileSize*t.overscaleFactor();i=this._source.type==="raster-array"?new Mc(t,m,this.transform.tileZoom,f,this._isRaster):new Wl(t,m,this.transform.tileZoom,f,this._isRaster,this._source.worldview),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))}return i.uses++,this._tiles[t.key]=i,c||this._source.fire(new s.A("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(t,i){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const c=i.getExpiryTimeout();c&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},c))}_removeTile(t){const i=this._tiles[t];i&&(i.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),i.uses>0||(i.hasData()&&i.state!=="reloading"||i.state==="empty"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,i,c){const f=[],m=this.transform;if(!m)return f;const y=m.projection.name==="globe",w=s.aD(m.center.lng);for(const S in this._tiles){const M=this._tiles[S];if(c&&M.clearQueryDebugViz(),M.holdingForFade())continue;let P;if(y){const O=M.tileID.canonical;if(O.z===0){const D=[Math.abs(s.ay(w,...Yo(O,-1))-w),Math.abs(s.ay(w,...Yo(O,1))-w)];P=[0,2*D.indexOf(Math.min(...D))-1]}else{const D=[Math.abs(s.ay(w,...Yo(O,-1))-w),Math.abs(s.ay(w,...Yo(O,0))-w),Math.abs(s.ay(w,...Yo(O,1))-w)];P=[D.indexOf(Math.min(...D))-1]}}else P=[0];for(const O of P){const D=t.containsTile(M,m,i,O);D&&f.push(D)}}return f}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,i){const c=this.getRenderableIds(t,i).map(m=>this._tiles[m].tileID),f=this.transform.projection.name==="globe";for(const m of c)m.projMatrix=this.transform.calculateProjMatrix(m.toUnwrapped()),m.expandedProjMatrix=f?this.transform.calculateProjMatrix(m.toUnwrapped(),!1,!0):m.projMatrix;return c}sortCoordinatesByDistance(t){const i=t.slice(),c=this.transform._camera.position,f=this.transform._camera.forward(),m={};for(const y of i){const w=1/(1<<y.canonical.z);m[y.key]=((y.canonical.x+.5)*w+y.wrap-c[0])*f[0]+((y.canonical.y+.5)*w-c[1])*f[1]-c[2]*f[2]}return i.sort((y,w)=>m[y.key]-m[w.key]),i}hasTransition(){if(this._source.hasTransition())return!0;if(da(this._source.type))for(const t in this._tiles){const i=this._tiles[t];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=s.q.now())return!0}return!1}setFeatureState(t,i,c){this._state.updateState(t=t||"_geojsonTileLayer",i,c)}removeFeatureState(t,i,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",i,c)}getFeatureState(t,i){return this._state.getState(t=t||"_geojsonTileLayer",i)}setDependencies(t,i,c){const f=this._tiles[t];f&&f.setDependencies(i,c)}reloadTilesForDependencies(t,i){for(const c in this._tiles)this._tiles[c].hasDependency(t,i)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(t,i))}_preloadTiles(t,i){if(!this._sourceLoaded){const S=()=>{this._sourceLoaded&&(this._source.off("data",S),this._preloadTiles(t,i))};return void this._source.on("data",S)}const c=new Map,f=Array.isArray(t)?t:[t],m=this.map.painter.terrain,y=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(const S of f){const M=S.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const P of M)c.set(P.key,P);this.usedForTerrain&&S.updateElevation(!1)}const w=Array.from(c.values());s.bt(w,(S,M)=>{const P=new Wl(S,this._source.tileSize*S.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(P,O=>{this._source.type==="raster-dem"&&P.dem&&this._backfillDEM(P),M(O,P)})},i)}}function Co(l,t){const i=Math.abs(2*l.wrap)-+(l.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return l.overscaledZ-t.overscaledZ||c-i||t.canonical.y-l.canonical.y||t.canonical.x-l.canonical.x}function da(l){return l==="raster"||l==="image"||l==="video"||l==="custom"}function Yo(l,t){const i=1<<l.z;return[l.x/i+t,(l.x+1)/i+t]}Ls.maxOverzooming=10,Ls.maxUnderzooming=3;class vu{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,i=!1;for(const c in this.style._mergedLayers){const f=this.style._mergedLayers[c];if(f.type==="fill-extrusion"||f.type==="building")this.layers.push({layer:f,visible:t,visibilityChanged:i});else if(f.type==="model"){const m=this.style.getLayerSource(f);m&&m.type==="batched-model"&&this.layers.push({layer:f,visible:t,visibilityChanged:i})}}}onNewFrame(t){this.layersGotHidden=!1;for(const i of this.layers){const c=i.layer;let f=!1;c.type==="fill-extrusion"?f=!c.isHidden(t)&&c.paint.get("fill-extrusion-opacity")>0:c.type==="building"?f=!c.isHidden(t)&&c.paint.get("building-opacity")>0:c.type==="model"&&(f=!c.isHidden(t)&&c.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!f&&i.visible,i.visible=f}}updateZOffset(t,i){this.currentBuildingBuckets=[];for(const f of this.layers){const m=f.layer,y=this.style.getLayerSourceCache(m);let w=1;m.type==="fill-extrusion"?w=f.visible?m.paint.get("fill-extrusion-vertical-scale"):0:m.type==="building"&&(w=f.visible?m.paint.get("building-vertical-scale"):0);let S=y?y.getTile(i):null;if(!S&&y&&i.canonical.z>y.getSource().minzoom){let M=i.scaledTo(Math.min(y.getSource().maxzoom,i.overscaledZ-1));for(;M.overscaledZ>=y.getSource().minzoom&&(S=y.getTile(M),!S&&M.overscaledZ!==0);)M=M.scaledTo(M.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:S?S.getBucket(m):null,tileID:S?S.tileID:i,verticalScale:w})}t.hasAnyZOffset=!1;let c=!1;for(let f=0;f<t.symbolInstances.length;f++){const m=t.symbolInstances.get(f),y=m.zOffset,w=this._getHeightAtTileOffset(i,m.tileAnchorX,m.tileAnchorY);m.zOffset=w!==Number.NEGATIVE_INFINITY?w:y,c||y===m.zOffset||(c=!0),t.hasAnyZOffset||m.zOffset===0||(t.hasAnyZOffset=!0)}c&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,i,c,f){let m=i,y=c;if(t.canonical.z!==f.canonical.z){const w=f.canonical,S=1/(1<<t.canonical.z-w.z);m=(i+t.canonical.x*s.aj)*S-w.x*s.aj|0,y=(c+t.canonical.y*s.aj)*S-w.y*s.aj|0}return{tileX:m,tileY:y}}_getHeightAtTileOffset(t,i,c){let f,m;for(let y=0;y<this.layers.length;++y){const w=this.layers[y].layer;if(w.type!=="fill-extrusion"&&w.type!=="building")continue;const{bucket:S,tileID:M,verticalScale:P}=this.currentBuildingBuckets[y];if(!S)continue;const{tileX:O,tileY:D}=this._mapCoordToOverlappingTile(t,i,c,M),F=S.getHeightAtTileCoord(O,D);F&&F.height!==void 0&&(F.hidden?f=F.height:m=Math.max(F.height*P,m||0))}if(m!==void 0)return m;for(let y=0;y<this.layers.length;++y){const w=this.layers[y];if(w.layer.type!=="model"||!w.visible)continue;const{bucket:S,tileID:M}=this.currentBuildingBuckets[y];if(!S)continue;const{tileX:P,tileY:O}=this._mapCoordToOverlappingTile(t,i,c,M),D=S.getHeightAtTileCoord(P,O);if(D&&!D.hidden)return D.height===void 0&&f!==void 0?Math.min(D.maxHeight,f)*D.verticalScale:D.height?D.height*D.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function xu(l,t){const i={};for(const c in l)c!=="ref"&&(i[c]=l[c]);return s.bu.forEach(c=>{c in t&&(i[c]=t[c])}),i}function fa(l){l=l.slice();const t=Object.create(null);for(let i=0;i<l.length;i++)t[l[i].id]=l[i];for(let i=0;i<l.length;i++)"ref"in l[i]&&(l[i]=xu(l[i],t[l[i].ref]));return l}const gn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function ph(l,t,i){i.push({command:gn.addSource,args:[l,t[l]]})}function Na(l,t,i){t.push({command:gn.removeSource,args:[l]}),i[l]=!0}function mh(l,t,i,c){Na(l,i,c),ph(l,t,i)}function vp(l,t,i){let c;for(c in l[i])if(l[i].hasOwnProperty(c)&&c!=="data"&&!s.bv(l[i][c],t[i][c]))return!1;for(c in t[i])if(t[i].hasOwnProperty(c)&&c!=="data"&&!s.bv(l[i][c],t[i][c]))return!1;return!0}function Zl(l,t,i,c,f,m){let y;for(y in t=t||{},l=l||{})l.hasOwnProperty(y)&&(s.bv(l[y],t[y])||i.push({command:m,args:[c,y,t[y],f]}));for(y in t)t.hasOwnProperty(y)&&!l.hasOwnProperty(y)&&(s.bv(l[y],t[y])||i.push({command:m,args:[c,y,t[y],f]}))}function Xl(l){return l.id}function Yl(l,t){return l[t.id]=t,l}class Pc{constructor(t,i){this.reset(t,i)}reset(t,i){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.ay(t,0,1);let i=1,c=this._distances[i];const f=t*this.paddedLength+this.padding;for(;c<f&&i<this._distances.length;)c=this._distances[++i];const m=i-1,y=this._distances[m],w=c-y,S=w>0?(f-y)/w:0;return this.points[m].mult(1-S).add(this.points[i].mult(S))}}class Rc{constructor(t,i,c){const f=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(i/c);for(let y=0;y<this.xCellCount*this.yCellCount;y++)f.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=i,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,i,c,f,m){this._forEachCell(i,c,f,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(i),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(m)}insertCircle(t,i,c,f){this._forEachCell(i-f,c-f,i+f,c+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(i),this.circles.push(c),this.circles.push(f)}_insertBoxCell(t,i,c,f,m,y){this.boxCells[m].push(y)}_insertCircleCell(t,i,c,f,m,y){this.circleCells[m].push(y)}_query(t,i,c,f,m,y){if(c<0||t>this.width||f<0||i>this.height)return!m&&[];const w=[];if(t<=0&&i<=0&&this.width<=c&&this.height<=f){if(m)return!0;for(let S=0;S<this.boxKeys.length;S++)w.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){const M=this.circles[3*S],P=this.circles[3*S+1],O=this.circles[3*S+2];w.push({key:this.circleKeys[S],x1:M-O,y1:P-O,x2:M+O,y2:P+O})}return y?w.filter(y):w}return this._forEachCell(t,i,c,f,this._queryCell,w,{hitTest:m,seenUids:{box:{},circle:{}}},y),m?w.length>0:w}_queryCircle(t,i,c,f,m){const y=t-c,w=t+c,S=i-c,M=i+c;if(w<0||y>this.width||M<0||S>this.height)return!f&&[];const P=[];return this._forEachCell(y,S,w,M,this._queryCellCircle,P,{hitTest:f,circle:{x:t,y:i,radius:c},seenUids:{box:{},circle:{}}},m),f?P.length>0:P}query(t,i,c,f,m){return this._query(t,i,c,f,!1,m)}hitTest(t,i,c,f,m){return this._query(t,i,c,f,!0,m)}hitTestCircle(t,i,c,f){return this._queryCircle(t,i,c,!0,f)}_queryCell(t,i,c,f,m,y,w,S){const M=w.seenUids,P=this.boxCells[m];if(P!==null){const D=this.bboxes;for(const F of P)if(!M.box[F]){M.box[F]=!0;const q=4*F;if(t<=D[q+2]&&i<=D[q+3]&&c>=D[q+0]&&f>=D[q+1]&&(!S||S(this.boxKeys[F]))){if(w.hitTest)return y.push(!0),!0;y.push({key:this.boxKeys[F],x1:D[q],y1:D[q+1],x2:D[q+2],y2:D[q+3]})}}}const O=this.circleCells[m];if(O!==null){const D=this.circles;for(const F of O)if(!M.circle[F]){M.circle[F]=!0;const q=3*F;if(this._circleAndRectCollide(D[q],D[q+1],D[q+2],t,i,c,f)&&(!S||S(this.circleKeys[F]))){if(w.hitTest)return y.push(!0),!0;{const V=D[q],W=D[q+1],X=D[q+2];y.push({key:this.circleKeys[F],x1:V-X,y1:W-X,x2:V+X,y2:W+X})}}}}}_queryCellCircle(t,i,c,f,m,y,w,S){const M=w.circle,P=w.seenUids,O=this.boxCells[m];if(O!==null){const F=this.bboxes;for(const q of O)if(!P.box[q]){P.box[q]=!0;const V=4*q;if(this._circleAndRectCollide(M.x,M.y,M.radius,F[V+0],F[V+1],F[V+2],F[V+3])&&(!S||S(this.boxKeys[q])))return y.push(!0),!0}}const D=this.circleCells[m];if(D!==null){const F=this.circles;for(const q of D)if(!P.circle[q]){P.circle[q]=!0;const V=3*q;if(this._circlesCollide(F[V],F[V+1],F[V+2],M.x,M.y,M.radius)&&(!S||S(this.circleKeys[q])))return y.push(!0),!0}}}_forEachCell(t,i,c,f,m,y,w,S){const M=this._convertToXCellCoord(t),P=this._convertToYCellCoord(i),O=this._convertToXCellCoord(c),D=this._convertToYCellCoord(f);for(let F=M;F<=O;F++)for(let q=P;q<=D;q++)if(m.call(this,t,i,c,f,this.xCellCount*q+F,y,w,S))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,i,c,f,m,y){const w=f-t,S=m-i,M=c+y;return M*M>w*w+S*S}_circleAndRectCollide(t,i,c,f,m,y,w){const S=(y-f)/2,M=Math.abs(t-(f+S));if(M>S+c)return!1;const P=(w-m)/2,O=Math.abs(i-(m+P));if(O>P+c)return!1;if(M<=S||O<=P)return!0;const D=M-S,F=O-P;return D*D+F*F<=c*c}}const pa={unknown:0,flipRequired:1,flipNotRequired:2},gh=Math.tan(85*Math.PI/180);function pl(l,t,i,c,f,m,y){const w=s.bz();if(i)if(m.name==="globe"){const S=s.bA(f,t);s.az(w,w,S)}else{const S=s.bB([],y);w[0]=S[0],w[1]=S[1],w[4]=S[2],w[5]=S[3],c||s.by(w,w,f.angle)}else s.az(w,f.labelPlaneMatrix,l);return w}function cd(l,t,i,c,f,m,y){const w=pl(l,t,i,c,f,m,y);return m.name==="globe"&&i||(w[2]=w[6]=w[10]=w[14]=0),w}function wu(l,t,i,c,f,m,y){if(i){if(m.name==="globe"){const w=pl(l,t,i,c,f,m,y);return s.bi(w,w),s.az(w,l,w),w}{const w=s.bw(l),S=s.bx([]);return S[0]=y[0],S[1]=y[1],S[4]=y[2],S[5]=y[3],s.az(w,w,S),c||s.by(w,w,-f.angle),w}}return f.glCoordMatrix}function Mo(l,t,i,c){const f=[l,t,i,1];i?s.aA(f,f,c):_n(f,f,c);const m=f[3];return f[0]/=m,f[1]/=m,f[2]/=m,f}function zc(l,t){return Math.min(.5+l/t*.5,1.5)}function Kl(l,t){const i=l[0]/l[3],c=l[1]/l[3];return i>=-t[0]&&i<=t[0]&&c>=-t[1]&&c<=t[1]}function Sa(l,t,i,c,f,m,y,w,S,M){const P=i.transform,O=c?l.textSizeData:l.iconSizeData,D=s.bH(O,i.transform.zoom),F=P.projection.name==="globe",q=[256/i.width*2+1,256/i.height*2+1],V=c?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;V.clear();let W=null;F&&(W=c?l.text.globeExtVertexArray:l.icon.globeExtVertexArray);const X=l.lineVertexArray,J=c?l.text.placedSymbolArray:l.icon.placedSymbolArray,se=i.transform.width/i.transform.height;let le,ge=!1;for(let _e=0;_e<J.length;_e++){const pe=J.get(_e),{numGlyphs:ue,writingMode:ye}=pe;if(ye!==s.bI.vertical||ge||le===s.bI.horizontal||(ge=!0),le=ye,(pe.hidden||ye===s.bI.vertical)&&!ge){Ts(ue,V);continue}ge=!1;const xe=new s.P(pe.tileAnchorX,pe.tileAnchorY);let{x:Pe,y:Le,z:Ye}=P.projection.projectTilePoint(xe.x,xe.y,M.canonical);if(S){const[Pt,Lt,Mt]=S(xe);Pe+=Pt,Le+=Lt,Ye+=Mt}const Xe=[Pe,Le,Ye,1];if(s.aA(Xe,Xe,t),!Kl(Xe,q)){Ts(ue,V);continue}const ot=Xe[3],ze=zc(i.transform.getCameraToCenterDistance(P.projection),ot),$e=s.bJ(O,D,pe),Ie=y?$e/ze:$e*ze,Je=Mo(Pe,Le,Ye,f);if(Je[3]<=0){Ts(ue,V);continue}let Ve={};const st=s.al(l.layers[0].layout.get("text-max-angle")),vt=Math.cos(st),Qe=y?null:S,pt=Jl(pe,Ie,!1,w,t,f,m,l.glyphOffsetArray,X,V,W,Je,xe,Ve,se,Qe,P.projection,M,y,vt);ge=pt.useVertical,Qe&&pt.needsFlipping&&(Ve={}),(pt.notEnoughRoom||ge||pt.needsFlipping&&Jl(pe,Ie,!0,w,t,f,m,l.glyphOffsetArray,X,V,W,Je,xe,Ve,se,Qe,P.projection,M,y,vt).notEnoughRoom)&&Ts(ue,V)}c?(l.text.dynamicLayoutVertexBuffer.updateData(V),W&&l.text.globeExtVertexBuffer&&l.text.globeExtVertexBuffer.updateData(W)):(l.icon.dynamicLayoutVertexBuffer.updateData(V),W&&l.icon.globeExtVertexBuffer&&l.icon.globeExtVertexBuffer.updateData(W))}function _h(l,t,i,c,f,m,y,w,S,M,P,O,D,F,q,V,W){const{lineStartIndex:X,glyphStartIndex:J,segment:se}=w,le=J+w.numGlyphs,ge=X+w.lineLength,_e=t.getoffsetX(J),pe=t.getoffsetX(le-1),ue=Dc(l*_e,i,c,f,m,y,se,X,ge,S,M,P,O,D,!0,F,q,V,W);if(!ue)return null;const ye=Dc(l*pe,i,c,f,m,y,se,X,ge,S,M,P,O,D,!0,F,q,V,W);return ye?{first:ue,last:ye}:null}function kc(l,t,i,c){return l===s.bI.horizontal&&Math.abs(c)>Math.abs(i)?{useVertical:!0}:l===s.bI.vertical?c>0?{needsFlipping:!0}:null:t!==pa.unknown&&function(f,m){return f===0||Math.abs(m/f)>gh}(i,c)?t===pa.flipRequired?{needsFlipping:!0}:null:i<0?{needsFlipping:!0}:null}function Jl(l,t,i,c,f,m,y,w,S,M,P,O,D,F,q,V,W,X,J,se){const le=t/24,ge=l.lineOffsetX*le,_e=l.lineOffsetY*le,{lineStartIndex:pe,glyphStartIndex:ue,numGlyphs:ye,segment:xe,writingMode:Pe,flipState:Le}=l,Ye=pe+l.lineLength,Xe=ot=>{if(P){const[Je,Ve,st]=ot.up,vt=M.length;s.bK(P,vt+0,Je,Ve,st),s.bK(P,vt+1,Je,Ve,st),s.bK(P,vt+2,Je,Ve,st),s.bK(P,vt+3,Je,Ve,st)}const[ze,$e,Ie]=ot.point;s.bL(M,ze,$e,Ie,ot.angle)};if(ye>1){const ot=_h(le,w,ge,_e,i,O,D,l,S,m,F,V,!1,W,X,J,se);if(!ot)return{notEnoughRoom:!0};if(c&&!i){let[ze,$e,Ie]=ot.first.point,[Je,Ve,st]=ot.last.point;[ze,$e]=Mo(ze,$e,Ie,y),[Je,Ve]=Mo(Je,Ve,st,y);const vt=kc(Pe,Le,(Je-ze)*q,Ve-$e);if(l.flipState=vt&&vt.needsFlipping?pa.flipRequired:pa.flipNotRequired,vt)return vt}Xe(ot.first);for(let ze=ue+1;ze<ue+ye-1;ze++){const $e=Dc(le*w.getoffsetX(ze),ge,_e,i,O,D,xe,pe,Ye,S,m,F,V,!1,!1,W,X,J,se);if(!$e)return M.length-=4*(ze-ue),{notEnoughRoom:!0};Xe($e)}Xe(ot.last)}else{if(c&&!i){const ze=Mo(D.x,D.y,0,f),$e=pe+xe+1,Ie=new s.P(S.getx($e),S.gety($e)),Je=Mo(Ie.x,Ie.y,0,f),Ve=Je[3]>0?Je:bu(D,Ie,ze,1,f,void 0,W,X.canonical),st=kc(Pe,Le,(Ve[0]-ze[0])*q,Ve[1]-ze[1]);if(l.flipState=st&&st.needsFlipping?pa.flipRequired:pa.flipNotRequired,st)return st}const ot=Dc(le*w.getoffsetX(ue),ge,_e,i,O,D,xe,pe,Ye,S,m,F,V,!1,!1,W,X,J,se);if(!ot)return{notEnoughRoom:!0};Xe(ot)}return{}}function Gs(l,t,i,c,f){const{x:m,y,z:w}=c.projectTilePoint(l.x,l.y,t);if(!f)return Mo(m,y,w,i);const[S,M,P]=f(l);return Mo(m+S,y+M,w+P,i)}function bu(l,t,i,c,f,m,y,w){const S=Gs(l.sub(t)._unit()._add(l),w,f,y,m);return s.at(S,i,S),s.au(S,S),s.bE(S,i,S,c)}function Dc(l,t,i,c,f,m,y,w,S,M,P,O,D,F,q,V,W,X,J){const se=c?l-t:l+t;let le=se>0?1:-1,ge=0;c&&(le*=-1,ge=Math.PI),le<0&&(ge+=Math.PI);let _e=w+y+(le>0?0:1)|0,pe=f,ue=f,ye=0,xe=0;const Pe=Math.abs(se),Le=[],Ye=[];let Xe=m,ot=Xe,ze=s.bC([]);const $e=()=>bu(ot,Xe,ue,Pe-ye+1,P,D,V,W.canonical);for(;ye+xe<=Pe;){if(_e+=le,_e<w||_e>=S)return null;if(ue=pe,ot=Xe,Le.push(ue),F&&Ye.push(ot),Xe=new s.P(M.getx(_e),M.gety(_e)),pe=O[_e],!pe){const Mt=Gs(Xe,W.canonical,P,V,D);pe=Mt[3]>0?O[_e]=Mt:$e()}ye+=xe;const Pt=s.at([],pe,ue),Lt=s.bD(ue,pe);if(i&&Lt>0&&xe>0&&s.bG(ze,Pt)/(xe*Lt)<J)return null;xe=Lt,ze=Pt}q&&D&&(O[_e]&&(pe=$e(),xe=s.bD(ue,pe),ze=s.at([],pe,ue)),O[_e]=pe);const Ie=(Pe-ye)/xe,Je=Xe.sub(ot)._mult(Ie)._add(ot),Ve=s.bE([],ue,ze,Ie);let st=[0,0,1],vt=ze[0],Qe=ze[1];if(X&&(st=V.upVector(W.canonical,Je.x,Je.y),st[0]!==0||st[1]!==0||st[2]!==1)){const Pt=[st[2],0,-st[0]],Lt=s.bF([],st,Pt);s.au(Pt,Pt),s.au(Lt,Lt),vt=s.bG(ze,Pt),Qe=s.bG(ze,Lt)}if(i){const Pt=s.bF([],st,ze);s.au(Pt,Pt),s.bE(Ve,Ve,Pt,i*le)}const pt=ge+Math.atan2(Qe,vt);return Le.push(Ve),F&&Ye.push(Je),{point:Ve,angle:pt,path:Le,tilePath:Ye,up:st}}function Ts(l,t){const i=t.length,c=i+4*l;t.resize(c),t.float32.fill(-1/0,4*i,4*c)}function _n(l,t,i){const c=t[0],f=t[1];return l[0]=i[0]*c+i[4]*f+i[12],l[1]=i[1]*c+i[5]*f+i[13],l[3]=i[3]*c+i[7]*f+i[15],l}const Ko=100;class yh{constructor(t,i,c=new Rc(t.width+200,t.height+200,25),f=new Rc(t.width+200,t.height+200,25)){this.transform=t,this.grid=c,this.ignoredGrid=f,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Ko,this.screenBottomBoundary=t.height+Ko,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=i}placeCollisionBox(t,i,c,f,m,y,w,S){let M=c.projectedAnchorX,P=c.projectedAnchorY,O=c.projectedAnchorZ;const D=c.elevation,F=c.tileID,q=t.getProjection();if(D&&F){const[_e,pe,ue]=q.upVector(F.canonical,c.tileAnchorX,c.tileAnchorY),ye=q.upVectorScale(F.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;M+=_e*D*ye,P+=pe*D*ye,O+=ue*D*ye}const V=this.projectAndGetPerspectiveRatio(w,M,P,O,c.tileID,q.name==="globe"||!!D||this.transform.pitch>0,q),W=y*V.perspectiveRatio,X=(c.x1*i+f.x-c.padding)*W+V.point.x,J=(c.y1*i+f.y-c.padding)*W+V.point.y,se=(c.x2*i+f.x+c.padding)*W+V.point.x,le=(c.y2*i+f.y+c.padding)*W+V.point.y,ge=V.perspectiveRatio<=.55||V.occluded;return!this.isInsideGrid(X,J,se,le)||!m&&this.grid.hitTest(X,J,se,le,S)||ge?{box:[],offscreen:!1,occluded:V.occluded}:{box:[X,J,se,le],offscreen:this.isOffscreen(X,J,se,le),occluded:!1}}placeCollisionCircles(t,i,c,f,m,y,w,S,M,P,O,D,F,q,V){const W=[],X=this.transform.elevation,J=t.getProjection(),se=X?X.getAtTileOffsetFunc(V,this.transform.center.lat,this.transform.worldSize,J):null,le=new s.P(c.tileAnchorX,c.tileAnchorY);let{x:ge,y:_e,z:pe}=J.projectTilePoint(le.x,le.y,V.canonical);if(se){const[st,vt,Qe]=se(le);ge+=st,_e+=vt,pe+=Qe}const ue=J.name==="globe",ye=this.projectAndGetPerspectiveRatio(w,ge,_e,pe,V,ue||!!X||this.transform.pitch>0,J),{perspectiveRatio:xe}=ye,Pe=(O?y/xe:y*xe)/s.bO,Le=Mo(ge,_e,pe,S),Ye=c.lineOffsetX*Pe,Xe=c.lineOffsetY*Pe,ot=s.al(t.layers[0].layout.get("text-max-angle")),ze=Math.cos(ot),$e=ye.signedDistanceFromCamera>0?_h(Pe,m,Ye,Xe,!1,Le,le,c,f,S,{},X&&!O?se:null,O&&!!X,J,V,O,ze):null;let Ie=!1,Je=!1,Ve=!0;if($e&&!ye.occluded){const st=.5*F*xe+q,vt=new s.P(-100,-100),Qe=new s.P(this.screenRightBoundary,this.screenBottomBoundary),pt=new Pc,{first:Pt,last:Lt}=$e,Mt=Pt.path.length;let Nt=[];for(let dr=Mt-1;dr>=1;dr--)Nt.push(Pt.path[dr]);for(let dr=1;dr<Lt.path.length;dr++)Nt.push(Lt.path[dr]);const er=2.5*st;M&&(Nt=Nt.map(([dr,Dr,dn],Gn)=>(se&&!ue&&(dn=se(Gn<Mt-1?Pt.tilePath[Mt-1-Gn]:Lt.tilePath[Gn-Mt+2])[2]),Mo(dr,Dr,dn,M))),Nt.some(dr=>dr[3]<=0)&&(Nt=[]));let nr=[];if(Nt.length>0){let dr=1/0,Dr=-1/0,dn=1/0,Gn=-1/0;for(const Mn of Nt)dr=Math.min(dr,Mn[0]),dn=Math.min(dn,Mn[1]),Dr=Math.max(Dr,Mn[0]),Gn=Math.max(Gn,Mn[1]);Dr>=vt.x&&dr<=Qe.x&&Gn>=vt.y&&dn<=Qe.y&&(nr=[Nt.map(Mn=>new s.P(Mn[0],Mn[1]))],(dr<vt.x||Dr>Qe.x||dn<vt.y||Gn>Qe.y)&&(nr=s.bM(nr,vt.x,vt.y,Qe.x,Qe.y)))}for(const dr of nr){pt.reset(dr,.25*st);let Dr=0;Dr=pt.length<=.5*st?1:Math.ceil(pt.paddedLength/er)+1;for(let dn=0;dn<Dr;dn++){const Gn=dn/Math.max(Dr-1,1),Mn=pt.lerp(Gn),wn=Mn.x+Ko,wi=Mn.y+Ko;W.push(wn,wi,st,0);const yr=wn-st,Lr=wi-st,Wr=wn+st,qn=wi+st;if(Ve=Ve&&this.isOffscreen(yr,Lr,Wr,qn),Je=Je||this.isInsideGrid(yr,Lr,Wr,qn),!i&&this.grid.hitTestCircle(wn,wi,st,D)&&(Ie=!0,!P))return{circles:[],offscreen:!1,collisionDetected:Ie,occluded:!1}}}}return{circles:!P&&Ie||!Je?[]:W,offscreen:Ve,collisionDetected:Ie,occluded:ye.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const i=[];let c=1/0,f=1/0,m=-1/0,y=-1/0;for(const P of t){const O=new s.P(P.x+Ko,P.y+Ko);c=Math.min(c,O.x),f=Math.min(f,O.y),m=Math.max(m,O.x),y=Math.max(y,O.y),i.push(O)}const w=this.grid.query(c,f,m,y).concat(this.ignoredGrid.query(c,f,m,y)),S={},M={};for(const P of w){const O=P.key;if(S[O.bucketInstanceId]===void 0&&(S[O.bucketInstanceId]={}),S[O.bucketInstanceId][O.featureIndex])continue;const D=[new s.P(P.x1,P.y1),new s.P(P.x2,P.y1),new s.P(P.x2,P.y2),new s.P(P.x1,P.y2)];s.bN(i,D)&&(S[O.bucketInstanceId][O.featureIndex]=!0,M[O.bucketInstanceId]===void 0&&(M[O.bucketInstanceId]=[]),M[O.bucketInstanceId].push(O.featureIndex))}return M}insertCollisionBox(t,i,c,f,m){(i?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:f,collisionGroupID:m},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,i,c,f,m){const y=i?this.ignoredGrid:this.grid,w={bucketInstanceId:c,featureIndex:f,collisionGroupID:m};for(let S=0;S<t.length;S+=4)y.insertCircle(w,t[S],t[S+1],t[S+2])}projectAndGetPerspectiveRatio(t,i,c,f,m,y,w){const S=[i,c,f,1];let M=!1;f||this.transform.pitch>0?(s.aA(S,S,t),this.fogState&&m&&w.name!=="globe"&&(M=function(D,F,q,V,W,X){const J=X.calculateFogTileMatrix(W),se=[F,q,V];return s.ad(se,se,J),Et(D,s.ae(se),X.pitch,X._fov)}(this.fogState,i,c,f,m.toUnwrapped(),this.transform)>.9)):_n(S,S,t);const P=S[3];return{point:new s.P((S[0]/P+1)/2*this.transform.width+Ko,(-S[1]/P+1)/2*this.transform.height+Ko),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(w)/P*.5,1.5),signedDistanceFromCamera:P,occluded:y&&S[2]>P||M}}isOffscreen(t,i,c,f){return c<Ko||t>=this.screenRightBoundary||f<Ko||i>this.screenBottomBoundary}isInsideGrid(t,i,c,f){return c>=0&&t<this.gridRightBoundary&&f>=0&&i<this.gridBottomBoundary}getViewportMatrix(){const t=s.bx([]);return s.bo(t,t,[-100,-100,0]),t}}function _f(l,t,i){const c=t.createTileMatrix(l,l.worldSize,i.toUnwrapped());return s.az(new Float32Array(16),l.projMatrix,c)}function lr(l,t,i){if(t.projection.name===i.projection.name)return l.projMatrix;const c=i.clone();return c.setProjection(t.projection),_f(c,t.getProjection(),l)}function Tu(l,t,i){return t.name===i.projection.name?l.projMatrix:_f(i,t,l)}class ml{constructor(t,i,c,f){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?i:-i))):f&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class Ba{constructor(t,i,c,f,m,y=!1){this.text=new ml(t?t.text:null,i,c,m),this.icon=new ml(t?t.icon:null,i,f,m),this.clipped=y}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Po{constructor(t,i,c,f=!1){this.text=t,this.icon=i,this.skipFade=c,this.clipped=f}}class yf{constructor(){this.invProjMatrix=s.bz(),this.viewportMatrix=s.bz(),this.circles=[]}}class Su{constructor(t,i,c,f,m){this.bucketInstanceId=t,this.featureIndex=i,this.sourceLayerIndex=c,this.bucketIndex=f,this.tileID=m}}class Qt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const i=++this.maxGroupID;this.collisionGroups[t]={ID:i,predicate:c=>c.collisionGroupID===i}}return this.collisionGroups[t]}}function Pn(l,t,i,c,f){const{horizontalAlign:m,verticalAlign:y}=s.bT(l),w=-(m-.5)*t,S=-(y-.5)*i,M=s.bU(l,c);return new s.P(w+M[0]*f,S+M[1]*f)}function Cn(l,t,i,c,f){const m=new s.P(l,t);return i&&m._rotate(c?f:-f),m}class Ro{constructor(t,i,c,f,m,y){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new yh(this.transform,m),this.buildingIndex=y,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=i,this.retainedQueryData={},this.collisionGroups=new Qt(c),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,i,c,f,m=1){const y=c.getBucket(i),w=c.latestFeatureIndex;if(!y||!w||i.fqid!==y.layerIds[0])return;const S=y.layers[0].layout,M=y.layers[0].paint,P=c.collisionBoxArray,O=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),D=c.tileSize/s.aj,F=c.tileID.toUnwrapped();this.transform.setProjection(y.projection);const q=(V=c.tileID,W=y.getProjection(),X=this.transform,W.name===this.projection?X.calculateProjMatrix(V.toUnwrapped()):_f(X,W,V));var V,W,X;const J=S.get("text-pitch-alignment")==="map",se=S.get("text-rotation-alignment")==="map";i.compileFilter(i.options);const le=i.dynamicFilter(),ge=i.dynamicFilterNeedsFeature(),_e=this.transform.calculatePixelsToTileUnitsMatrix(c),pe=cd(q,c.tileID.canonical,J,se,this.transform,y.getProjection(),_e);let ue=null;if(J){const $e=wu(q,c.tileID.canonical,J,se,this.transform,y.getProjection(),_e);ue=s.az([],this.transform.labelPlaneMatrix,$e)}let ye=null;le&&c.latestFeatureIndex&&(ye={unwrappedTileID:F,dynamicFilter:le,dynamicFilterNeedsFeature:ge}),this.retainedQueryData[y.bucketInstanceId]=new Su(y.bucketInstanceId,w,y.sourceLayerIndex,y.index,c.tileID);const[xe,Pe]=y.layers[0].layout.get("text-size-scale-range"),Le=s.ay(m,xe,Pe),[Ye,Xe]=S.get("icon-size-scale-range"),ot=s.ay(m,Ye,Xe),ze={bucket:y,layout:S,paint:M,posMatrix:q,textLabelPlaneMatrix:pe,labelToScreenMatrix:ue,clippingData:ye,scale:O,textPixelRatio:D,holdingForFade:c.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:s.bH(y.textSizeData,this.transform.zoom,Le),partiallyEvaluatedIconSize:s.bH(y.iconSizeData,this.transform.zoom,ot),collisionGroup:this.collisionGroups.get(y.sourceID),latestFeatureIndex:c.latestFeatureIndex};if(f)for(const $e of y.sortKeyRanges){const{sortKey:Ie,symbolInstanceStart:Je,symbolInstanceEnd:Ve}=$e;t.push({sortKey:Ie,symbolInstanceStart:Je,symbolInstanceEnd:Ve,parameters:ze})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:ze})}attemptAnchorPlacement(t,i,c,f,m,y,w,S,M,P,O,D,F,q,V,W,X,J){const{textOffset0:se,textOffset1:le,crossTileID:ge}=D,_e=[se,le],pe=Pn(t,c,f,_e,m),ue=this.collisionIndex.placeCollisionBox(q,m,i,Cn(pe.x,pe.y,y,w,this.transform.angle),O,S,M,P.predicate);if(W){const ye=q.getSymbolInstanceIconSize(J,this.transform.zoom,D.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(q,ye,W,Cn(pe.x,pe.y,y,w,this.transform.angle),O,S,M,P.predicate).box.length===0)return}if(ue.box.length>0){let ye;return this.prevPlacement&&this.prevPlacement.variableOffsets[ge]&&this.prevPlacement.placements[ge]&&this.prevPlacement.placements[ge].text&&(ye=this.prevPlacement.variableOffsets[ge].anchor),this.variableOffsets[ge]={textOffset:_e,width:c,height:f,anchor:t,textScale:m,prevAnchor:ye},this.markUsedJustification(q,t,D,V),q.allowVerticalPlacement&&(this.markUsedOrientation(q,V,D),this.placedOrientations[ge]=V),{shift:pe,placedGlyphBoxes:ue}}}placeLayerBucketPart(t,i,c,f,m=1){const{bucket:y,layout:w,paint:S,posMatrix:M,textLabelPlaneMatrix:P,labelToScreenMatrix:O,clippingData:D,textPixelRatio:F,holdingForFade:q,collisionBoxArray:V,partiallyEvaluatedTextSize:W,partiallyEvaluatedIconSize:X,collisionGroup:J,latestFeatureIndex:se}=t.parameters,le=w.get("text-optional"),ge=w.get("icon-optional"),_e=w.get("text-allow-overlap"),pe=w.get("icon-allow-overlap"),ue=w.get("text-rotation-alignment")==="map",ye=w.get("text-pitch-alignment")==="map",xe=S.get("symbol-z-offset"),Pe=w.get("symbol-elevation-reference")==="sea",[Le,Ye]=w.get("text-size-scale-range"),[Xe,ot]=w.get("icon-size-scale-range"),ze=s.ay(m,Le,Ye),$e=s.ay(m,Xe,ot);this.transform.setProjection(y.projection);let Ie=_e&&(pe||!y.hasIconData()||ge),Je=pe&&(_e||!y.hasTextData()||le);const Ve=!xe.isConstant();!y.collisionArrays&&V&&y.deserializeCollisionBoxes(V),c&&f&&y.updateCollisionDebugBuffers(this.transform.zoom,V,ze,$e);const st=(Qe,pt,Pt)=>{const{crossTileID:Lt,numVerticalGlyphVertices:Mt}=Qe;let Nt=null;if(D&&D.dynamicFilterNeedsFeature||Ve){const kn=this.retainedQueryData[y.bucketInstanceId];Nt=se.loadFeature({featureIndex:Qe.featureIndex,bucketIndex:kn.bucketIndex,sourceLayerIndex:kn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(D&&!(0,D.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Nt,this.retainedQueryData[y.bucketInstanceId].tileID.canonical,new s.P(Qe.tileAnchorX,Qe.tileAnchorY),this.transform.calculateDistanceTileData(D.unwrappedTileID)))return this.placements[Lt]=new Po(!1,!1,!1,!0),void i.add(Lt);const er=xe.evaluate(Nt,{});if(i.has(Lt))return;if(q)return void(this.placements[Lt]=new Po(!1,!1,!1));let nr=!1,dr=!1,Dr=!0,dn=!1,Gn=!1,Mn=null,wn={box:null,offscreen:null,occluded:null},wi={box:null},yr=null,Lr=null,Wr=null,qn=0,Ci=0,Zn=0;Pt.textFeatureIndex?qn=Pt.textFeatureIndex:Qe.useRuntimeCollisionCircles&&(qn=Qe.featureIndex),Pt.verticalTextFeatureIndex&&(Ci=Pt.verticalTextFeatureIndex);const Sn=kn=>{kn.tileID=this.retainedQueryData[y.bucketInstanceId].tileID;const Xn=this.transform.elevation;kn.elevation=Pe?er:er+(Xn?Xn.getAtTileOffset(kn.tileID,kn.tileAnchorX,kn.tileAnchorY):0),kn.elevation+=Qe.zOffset},_i=Pt.textBox;if(_i){Sn(_i);const kn=zr=>{let bi=s.bI.horizontal;if(y.allowVerticalPlacement&&!zr&&this.prevPlacement){const _s=this.prevPlacement.placedOrientations[Lt];_s&&(this.placedOrientations[Lt]=_s,bi=_s,this.markUsedOrientation(y,bi,Qe))}return bi},Xn=(zr,bi)=>{if(y.allowVerticalPlacement&&Mt>0&&Pt.verticalTextBox){for(const _s of y.writingModes)if(_s===s.bI.vertical?(wn=bi(),wi=wn):wn=zr(),wn&&wn.box&&wn.box.length)break}else wn=zr()};if(w.get("text-variable-anchor")){let zr=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Lt]){const ri=this.prevPlacement.variableOffsets[Lt];zr.indexOf(ri.anchor)>0&&(zr=zr.filter(Tn=>Tn!==ri.anchor),zr.unshift(ri.anchor))}const bi=(ri,Tn,bo)=>{const no=y.getSymbolInstanceTextSize(W,Qe,this.transform.zoom,pt),na=(ri.x2-ri.x1)*no+2*ri.padding,Ji=(ri.y2-ri.y1)*no+2*ri.padding,jo=Qe.hasIconTextFit&&!pe?Tn:null;jo&&Sn(jo);let To={box:[],offscreen:!1,occluded:!1};const So=_e?2*zr.length:zr.length;for(let Vo=0;Vo<So;++Vo){const Uo=this.attemptAnchorPlacement(zr[Vo%zr.length],ri,na,Ji,no,ue,ye,F,M,J,Vo>=zr.length,Qe,pt,y,bo,jo,W,X);if(Uo&&(To=Uo.placedGlyphBoxes,To&&To.box&&To.box.length)){nr=!0,Mn=Uo.shift;break}}return To};Xn(()=>bi(_i,Pt.iconBox,s.bI.horizontal),()=>{const ri=Pt.verticalTextBox;return ri&&Sn(ri),y.allowVerticalPlacement&&!(wn&&wn.box&&wn.box.length)&&Mt>0&&ri?bi(ri,Pt.verticalIconBox,s.bI.vertical):{box:null,offscreen:null,occluded:null}}),wn&&(nr=wn.box,Dr=wn.offscreen,dn=wn.occluded);const _s=kn(!(!wn||!wn.box));if(!nr&&this.prevPlacement){const ri=this.prevPlacement.variableOffsets[Lt];ri&&(this.variableOffsets[Lt]=ri,this.markUsedJustification(y,ri.anchor,Qe,_s))}}else{const zr=(bi,_s)=>{const ri=y.getSymbolInstanceTextSize(W,Qe,this.transform.zoom,pt,m),Tn=this.collisionIndex.placeCollisionBox(y,ri,bi,new s.P(0,0),_e,F,M,J.predicate);return Tn&&Tn.box&&Tn.box.length&&(this.markUsedOrientation(y,_s,Qe),this.placedOrientations[Lt]=_s),Tn};Xn(()=>zr(_i,s.bI.horizontal),()=>{const bi=Pt.verticalTextBox;return y.allowVerticalPlacement&&Mt>0&&bi?(Sn(bi),zr(bi,s.bI.vertical)):{box:null,offscreen:null,occluded:null}}),kn(!!(wn&&wn.box&&wn.box.length))}}if(yr=wn,nr=yr&&yr.box&&yr.box.length>0,Dr=yr&&yr.offscreen,dn=yr&&yr.occluded,Qe.useRuntimeCollisionCircles){const kn=y.text.placedSymbolArray.get(Qe.centerJustifiedTextSymbolIndex>=0?Qe.centerJustifiedTextSymbolIndex:Qe.verticalPlacedTextSymbolIndex),Xn=s.bJ(y.textSizeData,W,kn),zr=w.get("text-padding");Lr=this.collisionIndex.placeCollisionCircles(y,_e,kn,y.lineVertexArray,y.glyphOffsetArray,Xn,M,P,O,c,ye,J.predicate,Qe.collisionCircleDiameter*Xn/s.bO,zr,this.retainedQueryData[y.bucketInstanceId].tileID),nr=_e||Lr.circles.length>0&&!Lr.collisionDetected,Dr=Dr&&Lr.offscreen,dn=Lr.occluded}if(Pt.iconFeatureIndex&&(Zn=Pt.iconFeatureIndex),Pt.iconBox){const kn=Xn=>{Sn(Xn);const zr=Qe.hasIconTextFit&&Mn?Cn(Mn.x,Mn.y,ue,ye,this.transform.angle):new s.P(0,0),bi=y.getSymbolInstanceIconSize(X,this.transform.zoom,Qe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(y,bi,Xn,zr,pe,F,M,J.predicate)};wi&&wi.box&&wi.box.length&&Pt.verticalIconBox?(Wr=kn(Pt.verticalIconBox),dr=Wr.box.length>0):(Wr=kn(Pt.iconBox),dr=Wr.box.length>0),Dr=Dr&&Wr.offscreen,Gn=Wr.occluded}const hn=le||Qe.numHorizontalGlyphVertices===0&&Mt===0,yi=ge||Qe.numIconVertices===0;if(hn||yi?yi?hn||(dr=dr&&nr):nr=dr&&nr:dr=nr=dr&&nr,nr&&yr&&yr.box&&this.collisionIndex.insertCollisionBox(yr.box,w.get("text-ignore-placement"),y.bucketInstanceId,wi&&wi.box&&Ci?Ci:qn,J.ID),dr&&Wr&&this.collisionIndex.insertCollisionBox(Wr.box,w.get("icon-ignore-placement"),y.bucketInstanceId,Zn,J.ID),Lr&&(nr&&this.collisionIndex.insertCollisionCircles(Lr.circles,w.get("text-ignore-placement"),y.bucketInstanceId,qn,J.ID),c)){const kn=y.bucketInstanceId;let Xn=this.collisionCircleArrays[kn];Xn===void 0&&(Xn=this.collisionCircleArrays[kn]=new yf);for(let zr=0;zr<Lr.circles.length;zr+=4)Xn.circles.push(Lr.circles[zr+0]),Xn.circles.push(Lr.circles[zr+1]),Xn.circles.push(Lr.circles[zr+2]),Xn.circles.push(Lr.collisionDetected?1:0)}const Jn=y.projection.name!=="globe";Ie=Ie&&(Jn||!dn),Je=Je&&(Jn||!Gn),this.placements[Lt]=new Po(nr||Ie,dr||Je,Dr||y.justReloaded),i.add(Lt)},vt=this.retainedQueryData[y.bucketInstanceId].tileID;if(y.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(y,vt),y.elevationType==="road"&&y.updateRoadElevation(vt.canonical),y.updateZOffset(),y.sortFeaturesByY){const Qe=y.getSortedSymbolIndexes(this.transform.angle);for(let pt=Qe.length-1;pt>=0;--pt){const Pt=Qe[pt];st(y.symbolInstances.get(Pt),Pt,y.collisionArrays[Pt])}y.hasAnyZOffset&&s.w(`${y.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(y.hasAnyZOffset){const Qe=y.getSortedIndexesByZOffset();for(let pt=0;pt<Qe.length;++pt){const Pt=Qe[pt];st(y.symbolInstances.get(Pt),Pt,y.collisionArrays[Pt])}}else for(let Qe=t.symbolInstanceStart;Qe<t.symbolInstanceEnd;Qe++)st(y.symbolInstances.get(Qe),Qe,y.collisionArrays[Qe]);if(c&&y.bucketInstanceId in this.collisionCircleArrays){const Qe=this.collisionCircleArrays[y.bucketInstanceId];s.bi(Qe.invProjMatrix,M),Qe.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(t,i,c,f){const{leftJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:y,rightJustifiedTextSymbolIndex:w,verticalPlacedTextSymbolIndex:S,crossTileID:M}=c,P=s.bV(i),O=f===s.bI.vertical?S:P==="left"?m:P==="center"?y:P==="right"?w:-1;m>=0&&(t.text.placedSymbolArray.get(m).crossTileID=O>=0&&m!==O?0:M),y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=O>=0&&y!==O?0:M),w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=O>=0&&w!==O?0:M),S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=O>=0&&S!==O?0:M)}markUsedOrientation(t,i,c){const f=i===s.bI.horizontal||i===s.bI.horizontalOnly?i:0,m=i===s.bI.vertical?i:0,{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:M}=c,P=t.text.placedSymbolArray;y>=0&&(P.get(y).placedOrientation=f),w>=0&&(P.get(w).placedOrientation=f),S>=0&&(P.get(S).placedOrientation=f),M>=0&&(P.get(M).placedOrientation=m)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const i=this.prevPlacement;let c=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;const f=i?i.symbolFadeChange(t):1,m=i?i.opacities:{},y=i?i.variableOffsets:{},w=i?i.placedOrientations:{};for(const S in this.placements){const M=this.placements[S],P=m[S];P?(this.opacities[S]=new Ba(P,f,M.text,M.icon,null,M.clipped),c=c||M.text!==P.text.placed||M.icon!==P.icon.placed):(this.opacities[S]=new Ba(null,f,M.text,M.icon,M.skipFade,M.clipped),c=c||M.text||M.icon)}for(const S in m){const M=m[S];if(!this.opacities[S]){const P=new Ba(M,f,!1,!1);P.isHidden()||(this.opacities[S]=P,c=c||M.text.placed||M.icon.placed)}}for(const S in y)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=y[S]);for(const S in w)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=w[S]);c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:t)}updateLayerOpacities(t,i,c,f){const m=new Set;for(const y of i){const w=y.getBucket(t);w&&y.latestFeatureIndex&&t.fqid===w.layerIds[0]&&(this.updateBucketOpacities(w,m,y,y.collisionBoxArray,c,f,y.tileID,t.scope),w.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(w,y.tileID),w.elevationType==="road"&&w.updateRoadElevation(y.tileID.canonical),w.updateZOffset())}}updateBucketOpacities(t,i,c,f,m,y,w,S){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const M=t.layers[0].layout,P=t.layers[0].paint,O=!!t.layers[0].dynamicFilter(),D=new Ba(null,0,!1,!1,!0),F=M.get("text-allow-overlap"),q=M.get("icon-allow-overlap"),V=M.get("text-variable-anchor"),W=M.get("text-rotation-alignment")==="map",X=M.get("text-pitch-alignment")==="map",J=P.get("symbol-z-offset"),se=M.get("symbol-elevation-reference")==="sea",le=!J.isConstant(),ge=new Ba(null,0,F&&(q||!t.hasIconData()||M.get("icon-optional")),q&&(F||!t.hasTextData()||M.get("text-optional")),!0);!t.collisionArrays&&f&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(f);const _e=(ue,ye,xe)=>{for(let Pe=0;Pe<ye/4;Pe++)ue.opacityVertexArray.emplaceBack(xe)};let pe=0;y&&t.updateReplacement(w,y);for(let ue=0;ue<t.symbolInstances.length;ue++){const ye=t.symbolInstances.get(ue),{numHorizontalGlyphVertices:xe,numVerticalGlyphVertices:Pe,crossTileID:Le,numIconVertices:Ye,tileAnchorX:Xe,tileAnchorY:ot}=ye;let ze=null;const $e=this.retainedQueryData[t.bucketInstanceId];le&&ye&&$e&&(ze=c.latestFeatureIndex.loadFeature({featureIndex:ye.featureIndex,bucketIndex:$e.bucketIndex,sourceLayerIndex:$e.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ie=J.evaluate(ze,{}),Je=i.has(Le);let Ve=this.opacities[Le];Je?Ve=D:Ve||(Ve=ge,this.opacities[Le]=Ve),i.add(Le);const st=xe>0||Pe>0,vt=Ye>0,Qe=this.placedOrientations[Le],pt=Qe===s.bI.vertical,Pt=Qe===s.bI.horizontal||Qe===s.bI.horizontalOnly;!st&&!vt||Ve.isHidden()||pe++;let Lt=!1;if((st||vt)&&y)for(const Mt of t.activeReplacements){if(s.bP(Mt,m,s.bQ.Symbol,S)||Mt.min.x>Xe||Xe>Mt.max.x||Mt.min.y>ot||ot>Mt.max.y)continue;const Nt=s.bR(Xe,ot,w.canonical,Mt.footprintTileId.canonical);if(Lt=s.bS(Nt,Mt.footprint),Lt)break}if(st){const Mt=Lt?ec:Ql(Ve.text);_e(t.text,xe,pt?ec:Mt),_e(t.text,Pe,Pt?ec:Mt);const Nt=Ve.text.isHidden(),{leftJustifiedTextSymbolIndex:er,centerJustifiedTextSymbolIndex:nr,rightJustifiedTextSymbolIndex:dr,verticalPlacedTextSymbolIndex:Dr}=ye,dn=t.text.placedSymbolArray,Gn=Nt||pt?1:0;er>=0&&(dn.get(er).hidden=Gn),nr>=0&&(dn.get(nr).hidden=Gn),dr>=0&&(dn.get(dr).hidden=Gn),Dr>=0&&(dn.get(Dr).hidden=Nt||Pt?1:0);const Mn=this.variableOffsets[Le];Mn&&this.markUsedJustification(t,Mn.anchor,ye,Qe);const wn=this.placedOrientations[Le];wn&&(this.markUsedJustification(t,"left",ye,wn),this.markUsedOrientation(t,wn,ye))}if(vt){const Mt=Lt?ec:Ql(Ve.icon),{placedIconSymbolIndex:Nt,verticalPlacedIconSymbolIndex:er}=ye,nr=t.icon.placedSymbolArray,dr=Ve.icon.isHidden()?1:0;Nt>=0&&(_e(t.icon,Ye,pt?ec:Mt),nr.get(Nt).hidden=dr),er>=0&&(_e(t.icon,ye.numVerticalIconVertices,Pt?ec:Mt),nr.get(er).hidden=dr)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Mt=t.collisionArrays[ue];if(Mt){let Nt=new s.P(0,0),er=!0;if(Mt.textBox||Mt.verticalTextBox){if(V){const dr=this.variableOffsets[Le];dr?(Nt=Pn(dr.anchor,dr.width,dr.height,dr.textOffset,dr.textScale),W&&Nt._rotate(X?this.transform.angle:-this.transform.angle)):er=!1}O&&(er=!Ve.clipped),Mt.textBox&&gl(t.textCollisionBox.collisionVertexArray,Ve.text.placed,!er||pt,Ie,se,Nt.x,Nt.y),Mt.verticalTextBox&&gl(t.textCollisionBox.collisionVertexArray,Ve.text.placed,!er||Pt,Ie,se,Nt.x,Nt.y)}const nr=er&&!!(!Pt&&Mt.verticalIconBox);Mt.iconBox&&gl(t.iconCollisionBox.collisionVertexArray,Ve.icon.placed,nr,Ie,se,ye.hasIconTextFit?Nt.x:0,ye.hasIconTextFit?Nt.y:0),Mt.verticalIconBox&&gl(t.iconCollisionBox.collisionVertexArray,Ve.icon.placed,!nr,Ie,se,ye.hasIconTextFit?Nt.x:0,ye.hasIconTextFit?Nt.y:0)}}}if(t.fullyClipped=pe===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ue=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ue.invProjMatrix,t.placementViewportMatrix=ue.viewportMatrix,t.collisionCircleArray=ue.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,i){const c=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function gl(l,t,i,c,f,m,y){l.emplaceBack(t?1:0,i?1:0,m||0,y||0,c,f?1:0),l.emplaceBack(t?1:0,i?1:0,m||0,y||0,c,f?1:0),l.emplaceBack(t?1:0,i?1:0,m||0,y||0,c,f?1:0),l.emplaceBack(t?1:0,i?1:0,m||0,y||0,c,f?1:0)}const Rn=Math.pow(2,25),ud=Math.pow(2,24),Eu=Math.pow(2,17),vh=Math.pow(2,16),Ks=Math.pow(2,9),$i=Math.pow(2,8),mm=Math.pow(2,1);function Ql(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;const t=l.placed?1:0,i=Math.floor(127*l.opacity);return i*Rn+t*ud+i*Eu+t*vh+i*Ks+t*$i+i*mm+t}const ec=0;class xh{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,i,c,f,m,y){const w=this._bucketParts;for(;this._currentTileIndex<t.length;)if(i.getBucketParts(w,f,t[this._currentTileIndex],this._sortAcrossTiles,y),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((S,M)=>S.sortKey-M.sortKey));this._currentPartIndex<w.length;){const S=w[this._currentPartIndex];if(i.placeLayerBucketPart(S,this._seenCrossTileIDs,c,S.symbolInstanceStart===0,y),this._currentPartIndex++,m())return!0}return!1}}class hd{constructor(t,i,c,f,m,y,w,S,M){this.placement=new Ro(t,m,y,w,S,M),this._currentPlacementIndex=i.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(t,i,c,f,m){const y=s.q.now(),w=()=>{const S=s.q.now()-y;return!this._forceFullPlacement&&S>2};for(;this._currentPlacementIndex>=0;){const S=i[t[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=M)&&(!S.maxzoom||S.maxzoom>M)){const P=S,O=P.layout.get("symbol-z-elevate"),D=P.layout.get("symbol-sort-key").constantOr(1)!==void 0,F=P.layout.get("symbol-z-order"),q=F==="viewport-y"||F==="auto"&&!(F!=="viewport-y"&&D),V=P.layout.get("text-allow-overlap")||P.layout.get("icon-allow-overlap")||P.layout.get("text-ignore-placement")||P.layout.get("icon-ignore-placement"),W=q&&V,X=this._inProgressLayer=this._inProgressLayer||new xh(P),J=s.C(S.source,S.scope);if(X.continuePlacement(O||W?f[J]:c[J],this.placement,this._showCollisionBoxes,S,w,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Iu=512/s.aj/2;class dd{constructor(t,i,c){this.tileID=t,this.bucketInstanceId=c,this.index=new s.bW(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const f=t.canonical.x*s.aj,m=t.canonical.y*s.aj;for(let y=0;y<i.length;y++){const{key:w,crossTileID:S,tileAnchorX:M,tileAnchorY:P}=i.get(y),O=Math.floor((f+M)*Iu),D=Math.floor((m+P)*Iu);this.index.add(O,D),this.keys.push(w),this.crossTileIDs.push(S)}this.index.finish()}findMatches(t,i,c){const f=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),m=Iu/Math.pow(2,i.canonical.z-this.tileID.canonical.z),y=i.canonical.x*s.aj,w=i.canonical.y*s.aj;for(let S=0;S<t.length;S++){const M=t.get(S);if(M.crossTileID)continue;const{key:P,tileAnchorX:O,tileAnchorY:D}=M,F=Math.floor((y+O)*m),q=Math.floor((w+D)*m),V=this.index.range(F-f,q-f,F+f,q+f).sort((W,X)=>W-X);for(const W of V){const X=this.crossTileIDs[W];if(this.keys[W]===P&&!c.has(X)){c.add(X),M.crossTileID=X;break}}}}}class Js{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class _l{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const i=Math.round((t-this.lng)/360);if(i!==0)for(const c in this.indexes){const f=this.indexes[c],m={};for(const y in f){const w=f[y];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+i),m[w.tileID.key]=w}this.indexes[c]=m}this.lng=t}addBucket(t,i,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let m=0;m<i.symbolInstances.length;m++)i.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const f=this.usedCrossTileIDs[t.overscaledZ];for(const m in this.indexes){const y=this.indexes[m];if(Number(m)>t.overscaledZ)for(const w in y){const S=y[w];S.tileID.isChildOf(t)&&S.findMatches(i.symbolInstances,t,f)}else{const w=y[t.scaledTo(Number(m)).key];w&&w.findMatches(i.symbolInstances,t,f)}}for(let m=0;m<i.symbolInstances.length;m++){const y=i.symbolInstances.get(m);y.crossTileID||(y.crossTileID=c.generate(),f.add(y.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new dd(t,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(t,i){for(const c of i.crossTileIDs)this.usedCrossTileIDs[t].delete(c)}removeStaleBuckets(t){let i=!1;for(const c in this.indexes){const f=this.indexes[c];for(const m in f)t[f[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,f[m]),delete f[m],i=!0)}return i}}class go{constructor(){this.layerIndexes={},this.crossTileIDs=new Js,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,i,c,f){let m=this.layerIndexes[t.fqid];m===void 0&&(m=this.layerIndexes[t.fqid]=new _l);let y=!1;const w={};f.name!=="globe"&&m.handleWrapJump(c);for(const S of i){const M=S.getBucket(t);M&&t.fqid===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(S.tileID,M,this.crossTileIDs)&&(y=!0),w[M.bucketInstanceId]=!0)}return m.removeStaleBuckets(w)&&(y=!0),y}pruneUnusedLayers(t){const i={};t.forEach(c=>{i[c]=!0});for(const c in this.layerIndexes)i[c]||delete this.layerIndexes[c]}}const Lc=771;class Gr{constructor(t,i,c,f){this.blendFunction=t,this.blendColor=i.toNonPremultipliedRenderColor(null),this.mask=c,this.blendEquation=f}}Gr.Replace=[1,0,1,0],Gr.disabled=new Gr(Gr.Replace,s.am.transparent,[!1,!1,!1,!1]),Gr.unblended=new Gr(Gr.Replace,s.am.transparent,[!0,!0,!0,!0]),Gr.alphaBlended=new Gr([1,Lc,1,Lc],s.am.transparent,[!0,!0,!0,!0]),Gr.alphaBlendedNonPremultiplied=new Gr([770,Lc,770,Lc],s.am.transparent,[!0,!0,!0,!0]),Gr.multiply=new Gr([774,0,774,0],s.am.transparent,[!0,!0,!0,!0]);class Bt{constructor(t,i,c){this.func=t,this.mask=i,this.range=c}}Bt.ReadOnly=!1,Bt.ReadWrite=!0,Bt.disabled=new Bt(519,Bt.ReadOnly,[0,1]);const zo=7680;class ur{constructor(t,i,c,f,m,y){this.test=t,this.ref=i,this.mask=c,this.fail=f,this.depthFail=m,this.pass=y}}ur.disabled=new ur({func:519,mask:0},0,0,zo,zo,zo);const Fi=1029,Au=2305;class ar{constructor(t,i,c){this.enable=t,this.mode=i,this.frontFace=c}}function Oc(l,t){const i=s.c1(l,3);s.c3(l,t),s.c7(l,3,i)}function Fc(l,t){const i=s.b_([]);return s.b$(i,i,-t),s.c0(i,i,-l),i}function yl(l,t){const i=[l[0],l[1],0],c=[t[0],t[1],0];if(s.ae(i)>=1e-15){const y=s.au([],i);s.bY(c,y,s.bG(c,y)),t[0]=c[0],t[1]=c[1]}const f=s.bF([],t,l);if(s.bZ(f)<1e-15)return null;const m=Math.atan2(-f[1],f[0]);return Fc(Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2]),m)}ar.disabled=new ar(!1,Fi,Au),ar.backCCW=new ar(!0,Fi,Au),ar.backCW=new ar(!0,Fi,2304),ar.frontCW=new ar(!0,1028,2304),ar.frontCCW=new ar(!0,1028,Au);class Nc{constructor(t,i){this.position=t,this.orientation=i}get position(){return this._position}set position(t){if(t){const i=t instanceof s.ac?t:new s.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(i.x=s.bX(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(t,i){if(this.orientation=null,!this.position)return;const c=this.position,f=this._elevation?this._elevation.getAtPointOrZero(s.ac.fromLngLat(t)):0,m=s.ac.fromLngLat(t,f),y=[m.x-c.x,m.y-c.y,m.z-c.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=yl(y,i)}setPitchBearing(t,i){this.orientation=Fc(s.al(t),s.al(-i))}}class ma{constructor(t,i){this._transform=s.bx([]),this.orientation=i,this.position=t}get mercatorPosition(){const t=this.position;return new s.ac(t[0],t[1],t[2])}get position(){const t=s.c1(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var i;t&&s.c7(this._transform,3,[(i=t)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||s.b_([]),t&&Oc(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),i=this.right();return{bearing:Math.atan2(-i[1],i[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,i){this._orientation=Fc(t,i),Oc(this._transform,this._orientation)}forward(){const t=s.c1(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=s.c1(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=s.c1(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,i){const c=new Float64Array(16);return s.bi(c,this.getWorldToCamera(t,i)),c}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,i,c){const f=this.position;s.bY(f,f,-t);const m=new Float64Array(16);return s.bn(m,[c,c,c]),s.bo(m,m,f),m[10]*=i,m}getWorldToCamera(t,i){const c=new Float64Array(16),f=new Float64Array(4),m=this.position;return s.c2(f,this._orientation),s.bY(m,m,-t),s.c3(c,f),s.bo(c,c,m),c[1]*=-1,c[5]*=-1,c[9]*=-1,c[13]*=-1,c[8]*=i,c[9]*=i,c[10]*=i,c[11]*=i,c}getCameraToClipPerspective(t,i,c,f){const m=new Float64Array(16);return s.c4(m,t,i,c,f),m}getCameraToClipOrthographic(t,i,c,f,m,y){const w=new Float64Array(16);return s.c5(w,t,i,c,f,m,y),w}getDistanceToElevation(t,i=!1){const c=t===0?0:s.c6(t,i?s.aY(this.position[1]):this.position[1]),f=this.forward();return(c-this.position[2])/f[2]}clone(){return new ma([...this.position],[...this.orientation])}}const Qs={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class wh{constructor(t=0,i=0,c=0,f=0){if(isNaN(t)||t<0||isNaN(i)||i<0||isNaN(c)||c<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=i,this.left=c,this.right=f}interpolate(t,i,c){return i.top!=null&&t.top!=null&&(this.top=s.ai(t.top,i.top,c)),i.bottom!=null&&t.bottom!=null&&(this.bottom=s.ai(t.bottom,i.bottom,c)),i.left!=null&&t.left!=null&&(this.left=s.ai(t.left,i.left,c)),i.right!=null&&t.right!=null&&(this.right=s.ai(t.right,i.right,c)),this}getCenter(t,i){const c=s.ay((this.left+t-this.right)/2,0,t),f=s.ay((this.top+i-this.bottom)/2,0,i);return new s.P(c,f)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new wh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const is=15;class fd{constructor(t,i,c,f,m,y,w){this.tileSize=512,this._renderWorldCopies=m===void 0||m,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=c??0,this._maxPitch=f??60,this.setProjection(y),this.setMaxBounds(w),this.width=0,this.height=0,this._center=new s.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new wh,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new ma,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new fd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<is}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,i=!1){const c=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||c)&&this._updateCameraOnTerrain(),(t||c)&&this._constrainCamera(i),this._calcMatrices()}getProjection(){return s.aF(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const i=this.projection?this.getProjection():void 0;this.projection=s.ce(this.projectionOptions);const c=this.getProjection(),f=!s.bv(i,c);return f&&this._calcMatrices(),this.mercatorFromTransition=!1,f}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.ce({name:"mercator"});const i=t!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bX(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const i=-t*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=s.cf(),s.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const i=s.ay(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=s.al(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const i=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==i&&(this._unmodified=!1,this._setZoom(i),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,i=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!i||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;i||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&c.exaggeration()&&this._centerAltitudeValidForExaggeration!==c.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*c.exaggeration(),this._centerAltitudeValidForExaggeration=c.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=c.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],c=this.horizonLineFromTop();let f=0,m=0;for(let y=0;y<i.length;y++){const w=new s.P(i[y][0]*this.width,c+i[y][1]*(this.height-c)),S=t.pointCoordinate(w);if(!S)continue;const M=1/Math.hypot(S[0]-this._camera.position[0],S[1]-this._camera.position[1]);f+=S[3]*M,m+=M}return m===0?NaN:f/m}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,i=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),c=this.pixelsPerMeter/this.worldSize*i,f=this._mercatorZfromZoom(t),m=this._mercatorZfromZoom(this._maxZoom),y=Math.max(f-c,m);this._setZoom(this._zoomFromMercatorZ(y))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let c;c=t.z<this._camera.position[2]?[i.x,i.y,i.z]:[t.x,t.y,t.z];const f=s.ae(s.at([],this._camera.position,c));return s.ay(this._zoomFromMercatorZ(f),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let i=!1;if(t.orientation&&!s.ch(t.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(t.orientation)),t.position){const c=[t.position.x,t.position.y,t.position.z];s.ci(c,this._camera.position)||(this._setCameraPosition(c),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,i=new Nc;return i.position=new s.ac(t[0],t[1],t[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(t){if(!s.cj(t))return!1;s.ck(t,t);const i=s.cl([],[0,0,-1],t),c=s.cl([],[0,-1,0],t);if(c[2]<0)return!1;const f=yl(i,c);return!!f&&(this._camera.orientation=f,!0)}_setCameraPosition(t){const i=this.zoomScale(this.minZoom)*this.tileSize,c=this.zoomScale(this.maxZoom)*this.tileSize,f=this.cameraToCenterDistance;t[2]=s.ay(t[2],f/c,f/i),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,i,c){this._unmodified=!1,this._edgeInsets.interpolate(t,i,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const i=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,i)}getVisibleUnwrappedCoordinates(t){const i=[new s.cm(0,t)];if(this.renderWorldCopies){const c=this.pointCoordinate(new s.P(0,0)),f=this.pointCoordinate(new s.P(this.width,0)),m=this.pointCoordinate(new s.P(this.width,this.height)),y=this.pointCoordinate(new s.P(0,this.height)),w=Math.floor(Math.min(c.x,f.x,m.x,y.x)),S=Math.floor(Math.max(c.x,f.x,m.x,y.x)),M=1;for(let P=w-M;P<=S+M;P++)P!==0&&i.push(new s.cm(P,t))}return i}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,i,c){let f=[];const m=c!=null,y=!m;if(y&&this.zoom<i||m&&c[0]===0&&c[1]===0)return f;const w=new Set,S=(P,O,D,F,q)=>{const V=s.cK(O,P,D,F,q);w.has(V)||(f.push(new s.aM(P,O,D,F,q)),w.add(V))};for(let P=0;P<t.length;P++){const O=t[P];if(y&&O.canonical.z!==i)continue;const D=O.canonical,F=O.overscaledZ,q=O.wrap,V=1<<D.z,W=D.x+1<V,X=D.x>0,J=D.y+1<V,se=D.y>0,le=O.wrap-(X?0:1),ge=O.wrap+(W?0:1),_e=X?D.x-1:V-1,pe=W?D.x+1:0;if(m)c[0]<0?(S(F,ge,D.z,pe,D.y),c[1]<0&&J&&(S(F,q,D.z,D.x,D.y+1),S(F,ge,D.z,pe,D.y+1)),c[1]>0&&se&&(S(F,q,D.z,D.x,D.y-1),S(F,ge,D.z,pe,D.y-1))):c[0]>0?(S(F,le,D.z,_e,D.y),c[1]<0&&J&&(S(F,q,D.z,D.x,D.y+1),S(F,le,D.z,_e,D.y+1)),c[1]>0&&se&&(S(F,q,D.z,D.x,D.y-1),S(F,le,D.z,_e,D.y-1))):c[1]<0&&J?S(F,q,D.z,D.x,D.y+1):se&&S(F,q,D.z,D.x,D.y-1);else{const ue=O.visibleQuadrants;1&ue&&(S(F,le,D.z,_e,D.y),se&&(S(F,q,D.z,D.x,D.y-1),S(F,le,D.z,_e,D.y-1))),2&ue&&(S(F,ge,D.z,pe,D.y),se&&(S(F,q,D.z,D.x,D.y-1),S(F,ge,D.z,pe,D.y-1))),4&ue&&(S(F,le,D.z,_e,D.y),J&&(S(F,q,D.z,D.x,D.y+1),S(F,le,D.z,_e,D.y+1))),8&ue&&(S(F,ge,D.z,pe,D.y),J&&(S(F,q,D.z,D.x,D.y+1),S(F,ge,D.z,pe,D.y+1)))}}const M=[];for(const P of f)f.some(O=>P.isChildOf(O))||M.push(P);if(f=M.filter(P=>!t.some(O=>!!(P.overscaledZ<i&&O.isChildOf(P))||P.equals(O)||P.isChildOf(O))),y){const P=1<<i,O=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),D=[P*O.x,P*O.y],F=4,q=F*F;f=f.filter(V=>{const W=V.canonical.x+.5-D[0],X=V.canonical.y+.5-D[1];return W*W+X*X<q})}return f}coveringTiles(t){let i=this.coveringZoomLevel(t);const c=i,f=this.elevation&&this.elevation.exaggeration(),m=f&&!t.isTerrainDEM,y=this.projection.name==="mercator";if(t.minzoom!==void 0&&i<t.minzoom)return[];t.maxzoom!==void 0&&i>t.maxzoom&&(i=t.maxzoom);const w=this.locationCoordinate(this.center),S=this.center.lat,M=1<<i,P=[M*w.x,M*w.y,0],O=this.projection.name==="globe",D=!O,F=s.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,D),q=O?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),V=M*s.c6(1,this.center.lat),W=this._camera.position[2]/s.c6(1,this.center.lat),X=[M*q.x,M*q.y,W*(D?1:V)],J=O||f,se=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),le=this.isLODDisabled(!0)?i:0;let ge;if(this._elevation&&t.isTerrainDEM)ge=1e4*this._elevation.exaggeration();else if(this._elevation){const Ie=this._elevation.getMinMaxForVisibleTiles();ge=Ie?Ie.max:this._centerAltitude}else ge=this._centerAltitude;const _e=t.isTerrainDEM?-ge:this._elevation?this._elevation.getMinElevationBelowMSL():0,pe=this.projection.isReprojectedInTileSpace?s.co(this):1,ue=Ie=>{const Ve=new s.ac(Ie.x+25e-6,Ie.y,Ie.z),st=new s.ac(Ie.x,Ie.y+25e-6,Ie.z),vt=Ie.toLngLat(),Qe=Ve.toLngLat(),pt=st.toLngLat(),Pt=this.locationCoordinate(vt),Lt=this.locationCoordinate(Qe),Mt=this.locationCoordinate(pt),Nt=Math.hypot(Lt.x-Pt.x,Lt.y-Pt.y),er=Math.hypot(Mt.x-Pt.x,Mt.y-Pt.y);return Math.sqrt(Nt*er)*pe/25e-6},ye=Ie=>{const Je=ge,Ve=_e;return{aabb:s.cr(this,M,0,0,0,Ie,Ve,Je,this.projection),zoom:0,x:0,y:0,minZ:Ve,maxZ:Je,wrap:Ie,fullyVisible:!1}},xe=[];let Pe=[];const Le=i,Ye=t.reparseOverscaled?c:i,Xe=(W-this._centerAltitude)*V,ot=Ie=>{if(!this._elevation||!Ie.tileID||!y)return;const Je=this._elevation.getMinMaxForTile(Ie.tileID),Ve=Ie.aabb;Je?(Ve.min[2]=Je.min,Ve.max[2]=Je.max,Ve.center[2]=(Ve.min[2]+Ve.max[2])/2):(Ie.shouldSplit=$e(Ie),Ie.shouldSplit||(Ve.min[2]=Ve.max[2]=Ve.center[2]=this._centerAltitude))},ze=(Ie,Je)=>{if(.707*Je<Ie)return 1;const Ve=Je/Ie;return Ve/(1.4144271570014144+(Math.pow(1.1,Ve-1.4144271570014144+1)-1)/(1.1-1)-1)},$e=Ie=>{if(Ie.zoom<le)return!0;if(Ie.zoom===Le)return!1;if(Ie.shouldSplit!=null)return Ie.shouldSplit;const Je=Ie.aabb.distanceX(X),Ve=Ie.aabb.distanceY(X);let st=Xe,vt=1;if(O){st=Ie.aabb.distanceZ(X);const er=Math.pow(2,Ie.zoom),nr=s.aY((Ie.y+1)/er),dr=s.aY(Ie.y/er),Dr=Math.min(Math.max(S,nr),dr),dn=s.cO(Dr)/s.cO(S);if(vt=Dr===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,dn/this._mercatorScaleRatio),this.zoom<=s.cL&&Ie.zoom===Le-1&&dn>=.9)return!0}else if(m&&(st=Ie.aabb.distanceZ(X)*V),this.projection.isReprojectedInTileSpace&&c<=5){const er=Math.pow(2,Ie.zoom),nr=ue(new s.ac((Ie.x+.5)/er,(Ie.y+.5)/er));vt=nr>.85?1:nr}if(!y){const er=Math.sqrt(Je*Je+Ve*Ve+st*st);let nr=(1<<Le-Ie.zoom)*se*vt;return nr*=ze(Math.max(st,Xe),er),er<nr}let Qe=Number.MAX_VALUE,pt=0;const Pt=Ie.aabb.getCorners(),Lt=[];for(const er of Pt){s.at(Lt,er,X),O||(m?Lt[2]*=V:Lt[2]=Xe);const nr=s.bG(Lt,this._camera.forward());nr<Qe&&(Qe=nr,pt=Math.abs(Lt[2]))}let Mt=(1<<Le-Ie.zoom)*se*vt;if(Mt*=ze(Math.max(pt,Xe),Qe),Qe<Mt)return!0;const Nt=Ie.aabb.closestPoint(P);return Nt[0]===P[0]&&Nt[1]===P[1]};if(this.renderWorldCopies)for(let Ie=1;Ie<=3;Ie++)xe.push(ye(-Ie)),xe.push(ye(Ie));for(xe.push(ye(0));xe.length>0;){const Ie=xe.pop(),Je=Ie.x,Ve=Ie.y;let st=Ie.fullyVisible;const vt=()=>this.projection.name==="globe"&&(Ie.y===0||Ie.y===(1<<Ie.zoom)-1);if(!st){let Qe=J?Ie.aabb.intersects(F):Ie.aabb.intersectsFlat(F);if(Qe===0&&vt()){const pt=new s.cp(Ie.zoom,Je,Ve);Qe=s.cq(this,M,pt,!0).intersects(F)}if(Qe===0)continue;st=Qe===2}if(Ie.zoom!==Le&&$e(Ie))for(let Qe=0;Qe<4;Qe++){const pt=(Je<<1)+Qe%2,Pt=(Ve<<1)+(Qe>>1),Lt={aabb:y?Ie.aabb.quadrant(Qe):s.cr(this,M,Ie.zoom+1,pt,Pt,Ie.wrap,Ie.minZ,Ie.maxZ,this.projection),zoom:Ie.zoom+1,x:pt,y:Pt,wrap:Ie.wrap,fullyVisible:st,tileID:void 0,shouldSplit:void 0,minZ:Ie.minZ,maxZ:Ie.maxZ};m&&!O&&(Lt.tileID=new s.aM(Ie.zoom+1===Le?Ye:Ie.zoom+1,Ie.wrap,Ie.zoom+1,pt,Pt),ot(Lt)),xe.push(Lt)}else{const Qe=Ie.zoom===Le?Ye:Ie.zoom;if(t.minzoom&&t.minzoom>Qe)continue;let pt=0;if(!st){let Nt=J?Ie.aabb.intersectsPrecise(F):Ie.aabb.intersectsPreciseFlat(F);if(Nt===0&&vt()){const er=new s.cp(Ie.zoom,Je,Ve);Nt=s.cq(this,M,er,!0).intersectsPrecise(F)}if(Nt===0)continue;if(t.calculateQuadrantVisibility)if(F.containsPoint(Ie.aabb.center))pt=15;else for(let er=0;er<4;er++)Ie.aabb.quadrant(er).intersects(F)!==0&&(pt|=1<<er)}const Pt=P[0]-(.5+Je+(Ie.wrap<<Ie.zoom))*(1<<i-Ie.zoom),Lt=P[1]-.5-Ve,Mt=Ie.tileID?Ie.tileID:new s.aM(Qe,Ie.wrap,Ie.zoom,Je,Ve);t.calculateQuadrantVisibility&&(Mt.visibleQuadrants=pt),Pe.push({tileID:Mt,distanceSq:Pt*Pt+Lt*Lt})}}if(this.fogCullDistSq){const Ie=this.fogCullDistSq,Je=this.horizonLineFromTop();Pe=Pe.filter(Ve=>{const st=[0,0,0,1],vt=[s.aj,s.aj,0,1],Qe=this.calculateFogTileMatrix(Ve.tileID.toUnwrapped());s.aA(st,st,Qe),s.aA(vt,vt,Qe);const pt=s.cs([],st,vt),Pt=s.ct([],st,vt),Lt=s.cM(pt,Pt);if(Lt===0)return!0;let Mt=!1;const Nt=this._elevation;if(Nt&&Lt>Ie&&Je!==0){const er=this.calculateProjMatrix(Ve.tileID.toUnwrapped());let nr;t.isTerrainDEM||(nr=Nt.getMinMaxForTile(Ve.tileID)),nr||(nr={min:_e,max:ge});const dr=s.cu(this.rotation),Dr=[dr[0]*s.aj,dr[1]*s.aj,nr.max];s.ad(Dr,Dr,er),Mt=(1-Dr[1])*this.height*.5<Je}return Lt<Ie||Mt})}return Pe.sort((Ie,Je)=>Ie.distanceSq-Je.distanceSq).map(Ie=>Ie.tileID)}resize(t,i){this.width=t,this.height=i,this.pixelsToGLUnits=[2/t,-2/i],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const i=s.ay(t.lat,-85.051129,s.cv),c=this.projection.project(t.lng,i);return new s.P(c.x*this.worldSize,c.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,i){let c,f;const m=this.centerPoint;if(this.projection.name==="globe"){const w=this.worldSize;c=(i.x-m.x)/w,f=(i.y-m.y)/w}else{const w=this.pointCoordinate(i),S=this.pointCoordinate(m);c=w.x-S.x,f=w.y-S.y}const y=this.locationCoordinate(t);this.setLocation(new s.ac(y.x-c,y.y-f))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,i){return this.projection.locationPoint(this,t,i)}locationPoint3D(t,i){return this.projection.locationPoint(this,t,i,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,i){return this.coordinateLocation(this.pointCoordinate3D(t,i))}locationCoordinate(t,i){const c=i?s.c6(i,t.lat):void 0,f=this.projection.project(t.lng,t.lat);return new s.ac(f.x,f.y,c)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,i){const c=i??this._centerAltitude,f=[t.x,t.y,0,1],m=[t.x,t.y,1,1];s.aA(f,f,this.pixelMatrixInverse),s.aA(m,m,this.pixelMatrixInverse);const y=m[3];s.cw(f,f,1/f[3]),s.cw(m,m,1/y);const w=f[2],S=m[2];return{p0:f,p1:m,t:w===S?0:(c-w)/(S-w)}}screenPointToMercatorRay(t){const i=[t.x,t.y,0,1],c=[t.x,t.y,1,1];return s.aA(i,i,this.pixelMatrixInverse),s.aA(c,c,this.pixelMatrixInverse),s.cw(i,i,1/i[3]),s.cw(c,c,1/c[3]),i[2]=s.c6(i[2],this._center.lat)*this.worldSize,c[2]=s.c6(c[2],this._center.lat)*this.worldSize,s.cw(i,i,1/this.worldSize),s.cw(c,c,1/this.worldSize),new s.av([i[0],i[1],i[2]],s.au([],s.at([],c,i)))}rayIntersectionCoordinate(t){const{p0:i,p1:c,t:f}=t,m=s.c6(i[2],this._center.lat),y=s.c6(c[2],this._center.lat);return new s.ac(s.ai(i[0],c[0],f)/this.worldSize,s.ai(i[1],c[1],f)/this.worldSize,s.ai(m,y,f))}pointCoordinate(t,i=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,i)}pointCoordinate3D(t,i){if(!this.elevation)return this.pointCoordinate(t,i);let c=this.projection.pointCoordinate3D(this,t.x,t.y);if(c)return new s.ac(c[0],c[1],c[2]);let f=0,m=this.horizonLineFromTop();if(t.y>m)return this.pointCoordinate(t,i);const y=.02*m,w=t.clone();for(let S=0;S<10&&m-f>y;S++){w.y=s.ai(f,m,.66);const M=this.projection.pointCoordinate3D(this,w.x,w.y);M?(m=w.y,c=M):f=w.y}return c?new s.ac(c[0],c[1],c[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=s.cx)return!this.isPointAboveHorizon(t);const i=this.pointCoordinate(t);return i.y>=0&&i.y<=1}_coordinatePoint(t,i){const c=i&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,f=[t.x*this.worldSize,t.y*this.worldSize,c+t.toAltitude(),1];return s.aA(f,f,this.pixelMatrix),f[3]>0?new s.P(f[0]/f[3],f[1]/f[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:i}=this._edgeInsets,c=this.height-this._edgeInsets.bottom,f=this.width-this._edgeInsets.right,m=this.pointLocation3D(new s.P(i,t)),y=this.pointLocation3D(new s.P(f,t)),w=this.pointLocation3D(new s.P(f,c)),S=this.pointLocation3D(new s.P(i,c));let M=Math.min(m.lng,y.lng,w.lng,S.lng),P=Math.max(m.lng,y.lng,w.lng,S.lng),O=Math.min(m.lat,y.lat,w.lat,S.lat),D=Math.max(m.lat,y.lat,w.lat,S.lat);const F=Math.pow(2,-this.zoom)/16*270,q=this.projection.name==="globe"?1:4,V=(W,X,J,se,le)=>{const ge=(W+J)/2,_e=(X+se)/2,pe=new s.P(ge,_e),{lng:ue,lat:ye}=this.pointLocation3D(pe),xe=Math.max(0,M-ue,O-ye,ue-P,ye-D);M=Math.min(M,ue),P=Math.max(P,ue),O=Math.min(O,ye),D=Math.max(D,ye),(le<q||xe>F)&&(V(W,X,ge,_e,le+1),V(ge,_e,J,se,le+1))};if(V(i,t,f,t,1),V(f,t,f,c,1),V(f,c,i,c,1),V(i,c,i,t,1),this.projection.name==="globe"){const[W,X]=s.cy(this);W?(D=90,P=180,M=-180):X&&(O=-90,P=180,M=-180)}return new s.aG(new s.cd(M,O),new s.cd(P,D))}_getBoundsRectangular(t,i){const{top:c,left:f}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,w=new s.P(f,c),S=new s.P(y,c),M=new s.P(y,m),P=new s.P(f,m);let O=this.pointCoordinate(w,t),D=this.pointCoordinate(S,t);const F=this.pointCoordinate(M,i),q=this.pointCoordinate(P,i),V=(W,X)=>(X.y-W.y)/(X.x-W.x);return O.y>1&&D.y>=0?O=new s.ac((1-q.y)/V(q,O)+q.x,1):O.y<0&&D.y<=1&&(O=new s.ac(-q.y/V(q,O)+q.x,0)),D.y>1&&O.y>=0?D=new s.ac((1-F.y)/V(F,D)+F.x,1):D.y<0&&O.y<=1&&(D=new s.ac(-F.y/V(F,D)+F.x,0)),new s.aG().extend(this.coordinateLocation(O)).extend(this.coordinateLocation(D)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(F))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const i=t.visibleDemTiles.reduce((c,f)=>{if(f.dem){const m=f.dem.tree;c.min=Math.min(c.min,m.minimums[0]),c.max=Math.max(c.max,m.maximums[0])}return c},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(i.min*t.exaggeration(),i.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const i=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,c=this.height/2-i*(1-this._horizonShift);return t?Math.max(0,c):c}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-85.051129,this.maxLat=s.cv,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.aD(this.minLng)*this.tileSize,this.worldMaxX=s.aD(this.maxLng)*this.tileSize,this.worldMinY=s.aH(this.maxLat)*this.tileSize,this.worldMaxY=s.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,i){return this.projection.createTileMatrix(this,i,t)}calculateDistanceTileData(t){const i=t.key,c=this._distanceTileDataCache;if(c[i])return c[i];const f=t.canonical,m=1/this.height,y=this.cameraWorldSize,w=y/this.zoomScale(f.z),S=(f.x+Math.pow(2,f.z)*t.wrap)*w,M=f.y*w,P=this.point;P.x*=y/this.worldSize,P.y*=y/this.worldSize;const O=this.angle,D=Math.sin(-O),F=-Math.cos(-O);return c[i]={bearing:[D,F],center:[(P.x-S)*m,(P.y-M)*m],scale:w/s.aj*m},c[i]}calculateFogTileMatrix(t){const i=t.key,c=this._fogTileMatrixCache;if(c[i])return c[i];const f=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return s.az(f,this.worldToFogMatrix,f),c[i]=new Float32Array(f),c[i]}calculateProjMatrix(t,i=!1,c=!1){const f=t.key;let m;if(m=c?this._expandedProjMatrixCache:i?this._alignedProjMatrixCache:this._projMatrixCache,m[f])return m[f];const y=this.calculatePosMatrix(t,this.worldSize);let w;return w=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.expandedFarZProjMatrix:i?this.alignedProjMatrix:this.projMatrix,s.az(y,w,y),m[f]=new Float32Array(y),m[f]}calculatePixelsToTileUnitsMatrix(t){const i=t.tileID.key,c=this._pixelsToTileUnitsCache;if(c[i])return c[i];const f=s.cz(t,this);return c[i]=f,c[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,i=s.bn([],[t,t,t]);return s.az(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const i=s.c6(1,this._center.lat)*this.worldSize,c=this._computeCameraPosition(i),f=this._camera.forward(),m=s.c6(1,this._center.lat);c[2]/=m,f[2]/=m,s.au(f,f);const y=t.raycast(c,f,t.exaggeration());if(y){const w=s.bE([],c,f,y),S=new s.ac(w[0],w[1],s.c6(w[2],s.aY(w[1]))),M=(S.z+s.ae([S.x-c[0],S.y-c[1],S.z-c[2]*m]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(M),this._centerAltitude=S.toAltitude(),this._center=this.coordinateLocation(S),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const i=this._elevation,c=s.c6(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(c),m=i.getAtPointOrZero(new s.ac(...f)),y=this.pixelsPerMeter/this.worldSize*m,w=this._minimumHeightOverTerrain(),S=f[2]-y;if(S<=w)if(S<0||t){const M=this.locationCoordinate(this._center,this._centerAltitude),P=[f[0],f[1],M.z-f[2]],O=s.ae(P);P[2]-=(w-S)/this._pixelsPerMercatorPixel;const D=s.ae(P);if(D===0)return;s.bY(P,P,O/D*this._pixelsPerMercatorPixel),this._camera.position=[f[0],f[1],M.z*this._pixelsPerMercatorPixel-P[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const D=this.center;return D.lat=s.ay(D.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(D.lng=s.ay(D.lng,this.minLng,this.maxLng)),this.center=D,void(this._constraining=!1)}const i=this._unmodified,{x:c,y:f}=this.point;let m=0,y=c,w=f;const S=this.width/2,M=this.height/2,P=this.worldMinY*this.scale,O=this.worldMaxY*this.scale;if(f-M<P&&(w=P+M),f+M>O&&(w=O-M),O-P<this.height&&(m=Math.max(m,this.height/(O-P)),w=(O+P)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const D=this.worldMinX*this.scale,F=this.worldMaxX*this.scale,q=this.worldSize/2-(D+F)/2;y=(c+q+this.worldSize)%this.worldSize-q,y-S<D&&(y=D+S),y+S>F&&(y=F-S),F-D<this.width&&(m=Math.max(m,this.width/(F-D)),y=(F+D)/2)}y===c&&w===f||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(y,w))),m&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(m)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,i=this.projection.name==="globe",c=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.c6(1,this.center.lat)/s.c6(1,s.cP));const f=s.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,f),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const m=this.projection.zAxisUnit==="meters"?c:1,y=this._camera.getWorldToCamera(this.worldSize,m);let w;const S=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(S[8]=2*-t.x/this.width,S[9]=2*t.y/this.height,this.isOrthographic){let ye=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),xe=ye*this.aspect,Pe=-xe,Le=-ye;xe-=t.x,Pe-=t.x,ye+=t.y,Le+=t.y,w=this._camera.getCameraToClipOrthographic(Pe,xe,Le,ye,this._nearZ,this._farZ),((Ye,Xe,ot,ze)=>{for(let $e=0;$e<16;$e++)Ye[$e]=s.ai(Xe[$e],ot[$e],ze)})(w,w,S,s.cN(this.pitch>=is?1:this.pitch/is))}else w=S;const M=s.cB([],S,y);let P=s.cB([],w,y);if(this.projection.isReprojectedInTileSpace){const ye=this.locationCoordinate(this.center),xe=s.bx([]);s.bo(xe,xe,[ye.x*this.worldSize,ye.y*this.worldSize,0]),s.az(xe,xe,s.cC(this)),s.bo(xe,xe,[-ye.x*this.worldSize,-ye.y*this.worldSize,0]),s.az(P,P,xe),s.az(M,M,xe),this.inverseAdjustmentMatrix=s.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cE([],P,[this.worldSize,this.worldSize,this.worldSize/m,1]),this.projMatrix=P,this.invProjMatrix=s.bi(new Float64Array(16),this.projMatrix),i){const ye=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ye[8]=2*-t.x/this.width,ye[9]=2*t.y/this.height,this.expandedFarZProjMatrix=s.cB([],ye,y)}else this.expandedFarZProjMatrix=this.projMatrix;const O=s.bi([],w);this.frustumCorners=s.cF.fromInvProjectionMatrix(O,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!i);const D=new Float32Array(16);s.bx(D),s.cE(D,D,[1,-1,1]),s.cG(D,D,this._pitch),s.by(D,D,this.angle);const F=s.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.bw(F);const q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;F[8]=2*-t.x/this.width,F[9]=2*(t.y+q)/this.height,this.skyboxMatrix=s.az(D,F,D);const V=this.point,W=V.x,X=V.y,J=this.width%2/2,se=this.height%2/2,le=Math.cos(this.angle),ge=Math.sin(this.angle),_e=W-Math.round(W)+le*J+ge*se,pe=X-Math.round(X)+le*se+ge*J,ue=new Float64Array(P);if(s.bo(ue,ue,[_e>.5?_e-1:_e,pe>.5?pe-1:pe,0]),this.alignedProjMatrix=ue,P=s.bz(),s.cE(P,P,[this.width/2,-this.height/2,1]),s.bo(P,P,[1,-1,0]),this.labelPlaneMatrix=P,P=s.bz(),s.cE(P,P,[1,-1,1]),s.bo(P,P,[-1,-1,0]),s.cE(P,P,[2/this.width,2/this.height,1]),this.glCoordMatrix=P,this.pixelMatrix=s.az(new Float64Array(16),this.labelPlaneMatrix,M),this._calcFogMatrices(),this._distanceTileDataCache={},P=s.bi(new Float64Array(16),this.pixelMatrix),!P)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=P,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cH(this);const ye=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.ad(ye,ye,y),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=P;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,c=this._camera.position,f=1/this.height/this._pixelsPerMercatorPixel,m=[t,t,i];s.bY(m,m,f),s.bY(c,c,-1),s.cI(c,c,m);const y=s.bz();s.bo(y,y,c),s.cE(y,y,m),this.mercatorFogMatrix=y,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,i,f)}_computeCameraPosition(t){const i=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,c=this._camera.forward(),f=this.point,m=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*i-t/this.worldSize*this._centerAltitude;return[f.x/this.worldSize-c[0]*m,f.y/this.worldSize-c[1]*m,t/this.worldSize*this._centerAltitude-c[2]*m]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),c=this._camera.position[2],f=t[2];let m=1;this.projection.wrap&&(this.center=this.center.wrap()),f>0&&(m=Math.min((i-c)/f,1)),this._camera.position=s.bE([],this._camera.position,t,m),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,i=this._camera.forward(),{pitch:c,bearing:f}=this._camera.getPitchBearing(),m=s.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,y=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.al(this._maxPitch)),w=Math.max((t[2]-m)/Math.cos(c),y),S=this._zoomFromMercatorZ(w);s.bE(t,t,i,w),this._pitch=s.ay(c,s.al(this.minPitch),s.al(this.maxPitch)),this.angle=s.bX(f,-Math.PI,Math.PI),this._setZoom(s.ay(S,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let i=0,c=s.cx,f=0,m=1/0;for(;c-i>1e-6&&c>i;){const y=i+.5*(c-i),w=this.tileSize*Math.pow(2,y),S=this.getCameraToCenterDistance(this.projection,y,w),M=this.scaleZoom(S/(Math.max(0,t)*this.tileSize)),P=Math.abs(y-M);P<m&&(m=P,f=y),y<M?i=y:c=y}return f}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,i){const c=Math.min(t.x,i.x),f=Math.max(t.x,i.x),m=Math.min(t.y,i.y),y=Math.max(t.y,i.y);if(m<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const w=[new s.P(c,m),new s.P(f,y),new s.P(c,y),new s.P(f,m)],S=this.renderWorldCopies?-3:0,M=this.renderWorldCopies?4:1;for(const P of w){const O=this.pointRayIntersection(P);if(O.t<0)return!0;const D=this.rayIntersectionCoordinate(O);if(D.x<S||D.y<0||D.x>M||D.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(t,i){const c=s.ae(s.at([],this._camera.position,t)),f=this._zoomFromMercatorZ(c)+i;return c-this._mercatorZfromZoom(f)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([i,c,f],m){const y=[i,c,f,1];s.aA(y,y,m);const w=y[3]=Math.max(y[3],1e-6);return y[0]/=w,y[1]/=w,y[2]/=w,y}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,t))}}getCameraToCenterDistance(t,i=this.zoom,c=this.worldSize){const f=s.cA(t,i,this.width,this.height,1024),m=t.pixelSpaceConversion(this.center.lat,c,f);let y=.5/Math.tan(.5*this._fov)*this.height*m;return this.isOrthographic&&(y=s.ai(1,y,s.cN(this.pitch>=is?1:this.pitch/is))),y}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.az(t,t,this.globeMatrix),t}getFrustum(t){return s.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const ko=(l,t)=>{if(t>0&&l.terrain&&s.w("Cutoff is currently disabled on terrain"),t<=0||l.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const i=l.transform,c=Math.max(Math.abs(i._zoom-(l.minCutoffZoom-1)),1),f=i.isLODDisabled(!1)?s.af(60,45,i.pitch):s.af(30,15,i.pitch),m=i._farZ-i._nearZ,y=t*i.height,w=((1-(S=f))*i.cameraToCenterDistance+S*(i._farZ+y))*c;var S;return{shouldRenderCutoff:f<1,uniformValues:{u_cutoff_params:[i._nearZ,i._farZ,(w-i._nearZ)/m,(w-y-i._nearZ)/m]}}},ss={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class bh{constructor(t,i){this.aabb=t,this.lastCascade=i}}class pd{add(t,i){const c=this.receivers[t.key];c!==void 0?(c.aabb.min[0]=Math.min(c.aabb.min[0],i.min[0]),c.aabb.min[1]=Math.min(c.aabb.min[1],i.min[1]),c.aabb.min[2]=Math.min(c.aabb.min[2],i.min[2]),c.aabb.max[0]=Math.max(c.aabb.max[0],i.max[0]),c.aabb.max[1]=Math.max(c.aabb.max[1],i.max[1]),c.aabb.max[2]=Math.max(c.aabb.max[2],i.max[2])):this.receivers[t.key]=new bh(i,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,i,c){const f=s.cW.fromPoints(t.points);let m=0;for(const y in this.receivers){const w=this.receivers[y];if(!w||!f.intersectsAabb(w.aabb))continue;w.aabb.min=f.closestPoint(w.aabb.min),w.aabb.max=f.closestPoint(w.aabb.max);const S=w.aabb.getCorners();for(let M=0;M<c.length;M++){let P=!0;for(const O of S){const D=[O[0]*i,O[1]*i,O[2]];if(s.ad(D,D,c[M].matrix),D[0]<-1||D[0]>1||D[1]<-1||D[1]>1){P=!1;break}}if(w.lastCascade=M,m=Math.max(m,M),P)break}}return m+1}}class gm{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new pd,this._depthMode=new Bt(t.context.gl.LEQUAL,Bt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(ss,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(ss,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(ss,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,i){const c=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!i||!i.properties)return;const f=i.properties.get("shadow-intensity");if(!i.shadowsEnabled()||f<=0||(this._shadowLayerCount=c.style.order.reduce((q,V)=>{const W=c.style._mergedLayers[V];return q+(W.hasShadowPass()&&!W.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const m=c.context,y=ss.shadowMapResolution,w=ss.shadowMapResolution;if(this._cascades.length===0||ss.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let q=0;q<ss.cascadeCount;++q){const V=c._shadowMapDebug,W=m.gl,X=m.createFramebuffer(y,w,V,"texture"),J=new s.T(m,{width:y,height:w,data:null},W.DEPTH_COMPONENT16);if(X.depthAttachment.set(J.texture),V){const se=new s.T(m,{width:y,height:w,data:null},W.RGBA8);X.colorAttachment.set(se.texture)}this._cascades.push({framebuffer:X,texture:J,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cn,scale:0})}}this.shadowDirection=tc(i);let S=0;if(t.elevation){const q=t.elevation,V=[1e4,-1e4];q.visibleDemTiles.filter(W=>W.dem).forEach(W=>{const X=W.dem.tree;V[0]=Math.min(V[0],X.minimums[0]),V[1]=Math.max(V[1],X.maximums[0])}),V[0]!==1e4&&(S=(V[1]-V[0])*q.exaggeration())}const M=1.5*t.cameraToCenterDistance,P=3*M,O=new Float64Array(16);for(let q=0;q<this._cascades.length;++q){const V=this._cascades[q];let W=t.height/50,X=1;ss.cascadeCount===1?X=P:q===0?X=M:(W=M,X=P);const[J,se]=Bc(t,this.shadowDirection,W,X,ss.shadowMapResolution,S);V.scale=t.scale,V.matrix=J,V.boundingSphereRadius=se,s.bi(O,V.matrix),V.frustum=s.cn.fromInvProjectionMatrix(O,1,0,!0),V.far=X}const D=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[D].far,this._cascades[D].far],this._uniformValues.u_shadow_intensity=f,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ss.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ss.shadowMapResolution,this._uniformValues.u_shadowmap_0=Qs.ShadowMap0,this._uniformValues.u_shadowmap_1=Qs.ShadowMap0+1,this._groundShadowTiles=c.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const F=c.transform.elevation;for(const q of this._groundShadowTiles){let V={min:0,max:0};if(F){const W=F.getMinMaxForTile(q);W&&(V=W)}this.addShadowReceiver(q.toUnwrapped(),V.min,V.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,i){if(!this.enabled)return;const c=this.painter,f=c.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(c.transform.getFrustum(0),c.transform.worldSize,this._cascades),f.viewport.set([0,0,ss.shadowMapResolution,ss.shadowMapResolution]);for(let m=0;m<this._numCascadesToRender;++m){c.currentShadowCascade=m,f.bindFramebuffer.set(this._cascades[m].framebuffer.framebuffer),f.clear({color:s.am.white,depth:1});for(const y of t.order){const w=t._mergedLayers[y];if(!w.hasShadowPass()||w.isHidden(c.transform.zoom))continue;const S=t.getLayerSourceCache(w),M=S?i[S.id]:void 0;(w.type==="model"||M&&M.length)&&c.renderLayer(c,S,w,M)}}c.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,i=t.style,c=t.context,f=c.gl,m=i.directionalLight,y=i.ambientLight;if(!m||!y)return;const w=[],S=ko(t,t.longestCutoffRange);S.shouldRenderCutoff&&w.push("RENDER_CUTOFF"),w.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&w.push("NORMAL_OFFSET");const M=xl(i,m,y),P=new Bt(f.LEQUAL,Bt.ReadOnly,t.depthRangeFor3D),O=new ur({func:f.EQUAL,mask:255},0,255,f.KEEP,f.KEEP,f.KEEP);for(const D of this._groundShadowTiles){const F=D.toUnwrapped(),q=t.isTileAffectedByFog(D),V=t.getOrCreateProgram("groundShadow",{defines:w,overrideFog:q});this.setupShadows(F,V),t.uploadCommonUniforms(c,V,F,null,S);const W={u_matrix:t.transform.calculateProjMatrix(F),u_ground_shadow_factor:M};V.draw(t,f.TRIANGLES,P,O,Gr.multiply,ar.disabled,W,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Gr.unblended:Gr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const i=this.painter.transform,c=i.calculatePosMatrix(t,i.worldSize);return s.az(c,this._cascades[this.painter.currentShadowCascade].matrix,c),Float32Array.from(c)}calculateShadowPassMatrixFromMatrix(t){return s.az(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,i,c,f=0){if(!this.enabled)return;const m=this.painter.transform,y=this.painter.context,w=y.gl,S=this._uniformValues,M=new Float64Array(16),P=m.calculatePosMatrix(t,m.worldSize);for(let O=0;O<this._cascades.length;O++)s.az(M,this._cascades[O].matrix,P),S[O===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),y.activeTexture.set(w.TEXTURE0+Qs.ShadowMap0+O),this._cascades[O].texture.bindExtraParam(w.LINEAR,w.LINEAR,w.CLAMP_TO_EDGE,w.CLAMP_TO_EDGE,w.GREATER);if(this.useNormalOffset=!!c,this.useNormalOffset){const O=s.cU(t.canonical),D=2/m.tileSize*s.aj/ss.shadowMapResolution,F=D*this._cascades[0].boundingSphereRadius,q=D*this._cascades[this._cascades.length-1].boundingSphereRadius,V=(c==="vector-tile"?1:3)/Math.pow(2,f-t.canonical.z-(1-m.zoom+Math.floor(m.zoom)));S.u_shadow_normal_offset=[O,F*V,q*V],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(y,S)}setupShadowsFromMatrix(t,i,c=!1){if(!this.enabled)return;const f=this.painter.context,m=f.gl,y=this._uniformValues,w=new Float64Array(16);for(let S=0;S<ss.cascadeCount;S++)s.az(w,this._cascades[S].matrix,t),y[S===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(w),f.activeTexture.set(m.TEXTURE0+Qs.ShadowMap0+S),this._cascades[S].texture.bindExtraParam(m.LINEAR,m.LINEAR,m.CLAMP_TO_EDGE,m.CLAMP_TO_EDGE,m.GREATER);if(this.useNormalOffset=c,c){const S=ss.normalOffset;y.u_shadow_normal_offset=[1,S,S],y.u_shadow_bias=[6e-5,.0012,.012]}else y.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(f,y)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,i,c,f){if(f[2]>=0)return{};const m=function(S,M,P){const O=P/(1<<S.canonical.z);return new s.cW([S.canonical.x*O+S.wrap*P,S.canonical.y*O+S.wrap*P,0],[(S.canonical.x+1)*O+S.wrap*P,(S.canonical.y+1)*O+S.wrap*P,M])}(t,i,c).getCorners(),y=i/-f[2];f[0]<0?(s.cV(m[0],m[0],[f[0]*y,0,0]),s.cV(m[3],m[3],[f[0]*y,0,0])):f[0]>0&&(s.cV(m[1],m[1],[f[0]*y,0,0]),s.cV(m[2],m[2],[f[0]*y,0,0])),f[1]<0?(s.cV(m[0],m[0],[0,f[1]*y,0]),s.cV(m[1],m[1],[0,f[1]*y,0])):f[1]>0&&(s.cV(m[2],m[2],[0,f[1]*y,0]),s.cV(m[3],m[3],[0,f[1]*y,0]));const w={};return w.vertices=m,w.planes=[vl(m[1],m[0],m[4]),vl(m[2],m[1],m[5]),vl(m[3],m[2],m[6]),vl(m[0],m[3],m[7])],w}addShadowReceiver(t,i,c){this._receivers.add(t,s.cW.fromTileIdAndHeight(t,i,c))}getMaxCascadeForTile(t){const i=this._receivers.get(t);return i&&i.lastCascade?i.lastCascade:0}}function vl(l,t,i){const c=s.at([],i,t),f=s.at([],l,t),m=s.bF([],c,f),y=s.ae(m);return y===0?[0,0,1,0]:(s.bY(m,m,1/y),[m[0],m[1],m[2],-s.bG(m,t)])}function tc(l){const t=l.properties.get("direction"),i=s.cR(t.x,t.y,t.z);i[2]=s.ay(i[2],0,75);const c=s.cT([i[0],i[1],i[2]]);return s.cS(c.x,c.y,c.z)}function xl(l,t,i){const c=t.properties.get("color-use-theme")==="none",f=t.properties.get("color"),m=t.properties.get("intensity"),y=t.properties.get("direction"),w=[y.x,y.y,y.z],S=i.properties.get("color-use-theme")==="none",M=i.properties.get("color"),P=i.properties.get("intensity"),O=Math.max(s.bG([0,0,1],w),0),D=[0,0,0];s.bY(D,M.toPremultipliedRenderColor(S?null:l.getLut(t.scope)).toArray01Linear().slice(0,3),P);const F=[0,0,0];return s.bY(F,f.toPremultipliedRenderColor(c?null:l.getLut(i.scope)).toArray01Linear().slice(0,3),O*m),s.cY([D[0]>0?D[0]/(D[0]+F[0]):0,D[1]>0?D[1]/(D[1]+F[1]):0,D[2]>0?D[2]/(D[2]+F[2]):0])}function Bc(l,t,i,c,f,m){const y=l.zoom,w=l.scale,S=l.worldSize,M=1/S,P=l.aspect,O=Math.sqrt(1+P*P)*Math.tan(.5*l.fovX),D=O*O,F=c-i,q=c+i;let V,W;D>F/q?(V=c,W=c*O):(V=.5*q*(1+D),W=.5*Math.sqrt(F*F+2*(c*c+i*i)*D+q*q*D*D));const X=l.projection.pixelsPerMeter(l.center.lat,S),J=l._camera.getCameraToWorldMercator(),se=[0,0,-V*M];s.ad(se,se,J);let le=W*M;const ge=l._edgeInsets;if(!(ge.left===0&&ge.top===0&&ge.right===0&&ge.bottom===0||ge.left===ge.right&&ge.top===ge.bottom)){const st=l._camera.getWorldToCamera(l.worldSize,l.projection.zAxisUnit==="meters"?X:1),vt=l._camera.getCameraToClipPerspective(l._fov,l.width/l.height,i,c);vt[8]=2*-l.centerOffset.x/l.width,vt[9]=2*l.centerOffset.y/l.height;const Qe=new Float64Array(16);s.cB(Qe,vt,st);const pt=new Float64Array(16);s.bi(pt,Qe);const Pt=s.cn.fromInvProjectionMatrix(pt,S,y,!0);for(const Lt of Pt.points){const Mt=((_e=Lt)[0]/=w,_e[1]/=w,_e[2]=s.c6(_e[2],l._center.lat),_e);le=Math.max(le,s.bZ(s.cX([],se,Mt)))}}var _e;le*=f/(f-1);const pe=Math.acos(t[2]),ue=Math.atan2(-t[0],-t[1]),ye=new ma;ye.position=se,ye.setPitchBearing(pe,ue);const xe=ye.getWorldToCamera(S,X),Pe=le*S,Le=Math.min(l._mercatorZfromZoom(17)*S*-2,-2*Pe),Ye=ye.getCameraToClipOrthographic(-Pe,Pe,-Pe,Pe,Le,(Pe+m*X)/t[2]),Xe=new Float64Array(16);s.az(Xe,Ye,xe);const ot=s.cS(Math.floor(1e6*se[0])/1e6*S,Math.floor(1e6*se[1])/1e6*S,0),ze=.5*f,$e=[0,0,0];s.ad($e,ot,Xe),s.bY($e,$e,ze);const Ie=[Math.floor($e[0]),Math.floor($e[1]),Math.floor($e[2])],Je=[0,0,0];s.at(Je,$e,Ie),s.bY(Je,Je,-1/ze);const Ve=new Float64Array(16);return s.bx(Ve),s.bo(Ve,Ve,Je),s.az(Xe,Ve,Xe),[Xe,Pe]}class vf extends s.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,i){return s.aS(this.requestManager.transformRequest(i,s.R.Model).url).then(c=>{if(!c)return;const f=s.aT(c),m=new s.aU(t,void 0,void 0,f);return m.computeBoundsAndApplyParent(),m}).catch(c=>{if(c&&c.status===404)return null;this.fire(new s.z(new Error(`Could not load model ${t} from ${i}: ${c.message}`)))})}load(t,i,c={forceReload:!1}){this.models[i]||(this.models[i]={});const f=Object.keys(t),m=[],y=[];for(const w of f){const S=t[w];this.hasURLBeenRequested(S)&&!c.forceReload||(this.modelByURL[S]={modelId:w,scope:i},m.push(this.loadModel(w,S)),y.push(w)),this.models[i][w]||(this.models[i][w]={model:null,numReferences:1})}this.numModelsLoading[i]=(this.numModelsLoading[i]||0)+y.length,Promise.allSettled(m).then(w=>{for(let S=0;S<w.length;S++){const{status:M}=w[S];if(M==="rejected")continue;const{value:P}=w[S];this.models[i][y[S]]||(this.models[i][y[S]]={model:null,numReferences:1}),this.models[i][y[S]].model=P}this.numModelsLoading[i]-=y.length,this.fire(new s.A("data",{dataType:"style"}))}).catch(w=>{this.fire(new s.z(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,i,c={exactIdMatch:!1}){return!!(c.exactIdMatch?this.getModel(t,i):this.getModelByURL(this.modelUris[i][t]))}getModel(t,i){return this.models[i]||(this.models[i]={}),this.models[i][t]?this.models[i][t].model:void 0}getModelByURL(t){if(!t)return null;const i=this.modelByURL[t];return i?this.models[i.scope][i.modelId].model:null}hasModelBeenAdded(t,i){return this.models[i]&&this.models[i][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,i,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const f=this.requestManager.normalizeModelURL(i);if((this.hasModel(t,c,{exactIdMatch:!0})||this.hasModelBeenAdded(t,c))&&this.modelUris[c][t]===f)this.models[c][t].numReferences++;else if(this.hasURLBeenRequested(f)){const{scope:m,modelId:y}=this.modelByURL[f];this.models[m][y].numReferences++}else this.modelUris[c][t]=f,this.load({[t]:this.modelUris[c][t]},c)}addModelURLs(t,i){this.models[i]||(this.models[i]={}),this.modelUris[i]||(this.modelUris[i]={});const c=this.modelUris[i];for(const f in t)c[f]=this.requestManager.normalizeModelURL(t[f])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,i){this.models[i]||(this.models[i]={}),this.modelUris[i]||(this.modelUris[i]={});const c={};for(const f of t)this.hasModel(f,i,{exactIdMatch:!0})||this.hasURLBeenRequested(f)?this.models[i][f].numReferences++:this.modelUris[i][f]&&!this.hasURLBeenRequested(f)?c[f]=this.modelUris[i][f]:!this.hasURLBeenRequested(f)&&s.cZ(f,!1)&&(this.modelUris[i][f]=this.requestManager.normalizeModelURL(f),c[f]=this.modelUris[i][f]);this.load(c,i)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,i,c=!1){if(this.models[i]&&this.models[i][t]&&(this.models[i][t].numReferences--,this.models[i][t].numReferences===0)){const f=this.modelUris[i][t];c||delete this.modelUris[i][t],delete this.modelByURL[f];const m=this.models[i][t].model;if(!m)return;delete this.models[i][t],m.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const i of Object.keys(this.models[t])){const c=this.models[t][i].model;delete this.models[t][i],c&&c.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,i){this.models[i]||(this.models[i]={});for(const c in this.models[i])this.models[i][c].model&&this.models[i][c].model.upload(t.context)}}const Th=new s.a7({data:new s.a8(s.a5.colorTheme.data)}),xf={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function wl(l){return l=l||{},Object.assign(l,xf)}class _m extends s.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._floorplanStates={},s.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new s.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible()}_onMove(){this._checkFloorplanVisible()}_checkFloorplanVisible(){if(!this._queryFeatureSetId||!this._map.isStyleLoaded())return;const t=()=>{this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new s.A("floorplangone"))};if(this._map.transform.zoom<13)return void t();const i={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},c=this._map.transform.width,f=this._map.transform.height,m=c*(2/3),y=f*(2/3),w=.5*(c-m),S=.5*(f-y),M=[new s.P(w,S),new s.P(w+m,S+y)],P=this._map.queryRenderedFeatures(M,i);P.length>0?this._selectedFloorplan&&P[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=P[0],this._floorplanSelected()):t()}_floorplanSelected(){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._floorplanStates[this._indoorData.id]=this._floorplanStates[this._indoorData.id]||{},this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[this._indoorData.id]]);const t=this._floorplanStates[this._indoorData.id].selectedBuilding,i=t?this._indoorData.buildings.find(w=>w.id===t):this._indoorData.buildings.length>0?this._indoorData.buildings[0]:null,c=this._floorplanStates[this._indoorData.id].selectedLevel,f=this._indoorData.levels.find(w=>w.id===c),m=this._indoorData.levels.find(w=>!(!i||!i.levels)&&Number(w.levelOrder)===0&&i.levels.includes(w.id)),y=f?f.id:m?m.id:void 0;this.fire(new s.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:y})),i&&this._buildingSelected(i,!1),y&&this._levelSelected(y)}_buildingSelected(t,i){if(!t||!t.id)return void console.warn("IndoorManager: Building or building id is undefined");i&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const c=this._indoorData.levels.filter(f=>t.levels.includes(f.id));this.fire(new s.A("buildingselected",{buildingId:t.id,levels:c}))}_levelSelected(t){const i=this._indoorData.levels.find(c=>c.id===t);i?(this._updateLevels(i,!0),this.fire(new s.A("levelselected",{levelId:i.id}))):console.warn(`IndoorManager: Level with ID ${t} not found in the current floorplan.`)}_updateLevels(t,i){if(!t||!t.id)throw new Error("IndoorManager: Selected level or level ID is undefined");function c(M){const P=M.indexOf("/floor/");if(P===-1)return M;const O=P+7,D=M.indexOf("/",O);return D===-1?M.slice(O):M.slice(O,D)}this._floorplanStates[this._indoorData.id].selectedLevel=t.id;const f=[],m={},y={},w={},S={};for(const M of this._indoorData.levels){if(f.push(M.id),m[M.id]=M.levelOrder>=0?3*Math.abs(M.levelOrder+1):3*Math.abs(M.levelOrder),y[M.id]=M.levelOrder>=0?3*M.levelOrder:0,this.mergeFloors){const P=c(t.id),O=c(M.id);w[M.id]=O===P?"true":"false"}else w[M.id]=M.id===t.id?"true":"false";S[M.id]=M.levelOrder<t.levelOrder?"true":"false"}this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",f]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",m]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",y]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",w]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",S]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",t.levelOrder<0)}selectFloorplan(t){const i={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},c=[new s.P(0,0),new s.P(this._map.transform.width,this._map.transform.height)],f=this._map.queryRenderedFeatures(c,i);if(f.length>0){for(const m of f)if(JSON.parse(m.properties["indoor-data"]).id===t){this._selectedFloorplan=m,this._floorplanSelected();break}}}selectBuilding(t){const i=this._indoorData.buildings.find(c=>c.id===t);this._buildingSelected(i,!0)}selectLevel(t){this._levelSelected(t)}}function ym(l){if(!l.metadata||!l.metadata.content_area)return;const t=s.q.devicePixelRatio,{left:i,top:c,width:f,height:m}=l.metadata.content_area,y=i*t,w=c*t;return[y,w,y+f*t,w+m*t]}function xp(l){if(l)return l.map(([t,i])=>[t*s.q.devicePixelRatio,i*s.q.devicePixelRatio])}class ga{constructor(t,i,c){this.id=t,this.scope=i,this.sourceCache=c,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const i=this.sourceCache.getVisibleCoordinates();if(i.length===0)return t;const c=this.sourceCache.getSource();if(!(c instanceof $l))return t;const f=i.map(y=>this.sourceCache.getTile(y)),m=c.getImages(f,Array.from(this.pendingRequests));for(const[y,w]of m)t.set(s.I.from({name:y,iconsetId:this.id}),w),this.pendingRequests.delete(y);for(const y of this.pendingRequests)this.missingRequests.add(y);return this.pendingRequests.clear(),t}}const Ea=(l,t)=>me(l,t&&t.filter(i=>i.identifier!=="source.canvas")),md=s.aF(gn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),wf=s.aF(gn,["setCenter","setZoom","setBearing","setPitch"]),Sh=new Set(["background","sky","slot","custom"]),gd={version:8,layers:[],sources:{}},Eh={duration:300,delay:0};class qs extends s.E{constructor(t,i={}){super(),this.map=t,this.scope=i.scope||"",this.globalId=null,this.fragments=[],this.importDepth=i.importDepth||0,this.importsCache=i.importsCache||new Map,this.resolvedImports=i.resolvedImports||new Set,this.transition=s.h({},Eh),this._buildingIndex=new vu(this),this.crossTileSymbolIndex=new go,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=i.styleChanges||new vi,this.dispatcher=i.dispatcher?i.dispatcher:new s.D(s.c$(),this),i.imageManager?this.imageManager=i.imageManager:(this.imageManager=new aa(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=i.glyphManager?i.glyphManager:new s.d0(t._requestManager,i.localFontFamily?s.d1.all:i.localIdeographFontFamily?s.d1.ideographs:s.d1.none,i.localFontFamily||i.localIdeographFontFamily),i.modelManager?this.modelManager=i.modelManager:(this.modelManager=new vf(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=i.configOptions?i.configOptions:new Map,this._configDependentLayers=i.configDependentLayers?i.configDependentLayers:new Set,this._config=i.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:i.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=i.initialConfig,this.dispatcher.broadcast("setReferrer",s.d2());const c=this;this._rtlTextPluginCallback=qs.registerForPluginStateChange(f=>{c.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:f.pluginStatus,pluginURL:f.pluginURL},(m,y)=>{if(s.d3(m),y&&y.every(w=>w))for(const w in c._sourceCaches){const S=c._sourceCaches[w],M=S.getSource().type;M!=="vector"&&M!=="geojson"||S.reload()}})}),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;const m=this.getOwnSource(f.sourceId);if(m&&m.vectorLayerIds)for(const y in this._layers){const w=this._layers[y];w.source===m.id&&this._validateLayer(w)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(s.j(t))return t;const i=s.d4(t);if(!i.startsWith("http"))try{return new URL(i,location.href).toString()}catch{return i}return i}return`json://${s.d5(JSON.stringify(t))}`}_diffStyle(t,i,c){this.globalId=this._getGlobalId(t);const f=(m,y)=>{try{y(null,this.setState(m,c))}catch(w){y(w,!1)}};if(typeof t=="string"){const m=this.map._requestManager.normalizeStyleURL(t),y=this.map._requestManager.transformRequest(m,s.R.Style);s.n(y,(w,S)=>{w?this.fire(new s.z(w)):S&&f(S,i)})}else typeof t=="object"&&f(t,i)}loadURL(t,i={}){this.fire(new s.A("dataloading",{dataType:"style"}));const c=typeof i.validate=="boolean"?i.validate:!s.j(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,i.accessToken),this.resolvedImports.add(t);const f=this.importsCache.get(t);if(f)return this._load(f,c);const m=this.map._requestManager.transformRequest(t,s.R.Style);this._request=s.n(m,(y,w)=>{if(this._request=null,y)this.fire(new s.z(y));else if(w)return this.importsCache.set(t,w),this._load(w,c)})}loadJSON(t,i={}){this.fire(new s.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=s.q.frame(()=>{this._request=null,this._load(t,i.validate!==!1)})}loadEmpty(){this.fire(new s.A("dataloading",{dataType:"style"})),this._load(gd,!1)}_loadImports(t,i,c){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const f=[];for(const m of t){const y=this._createFragmentStyle(m),w=new Promise(P=>{y.once("style.import.load",P),y.once("error",P)}).then(()=>this.mergeAll());if(f.push(w),this.resolvedImports.has(m.url)){y.loadEmpty();continue}const S=m.data||this.importsCache.get(m.url);S?(y.loadJSON(S,{validate:i}),this._isInternalStyle(S)&&(y.globalId=null)):m.url?y.loadURL(m.url,{validate:i}):y.loadEmpty();const M={style:y,id:m.id,config:m.config};if(c){const P=this.fragments.findIndex(({id:O})=>O===c);this.fragments=this.fragments.slice(0,P).concat(M).concat(this.fragments.slice(P))}else this.fragments.push(M)}return Promise.allSettled(f)}getImportGlobalIds(t=this,i=new Set){for(const c of t.fragments)c.style.globalId&&i.add(c.style.globalId),this.getImportGlobalIds(c.style,i);return[...i.values()]}_createFragmentStyle(t){const i=this.scope?s.C(t.id,this.scope):t.id;let c;const f=this._initialConfig&&this._initialConfig[i];(t.config||f)&&(c=s.h({},t.config,f));const m=new qs(this.map,{scope:i,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:c,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return m.setEventedParent(this.map,{style:m}),m}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,i){const c=t.indoor?wl(t.schema):t.schema;if(this._isInternalStyle(t)){const y=s.h({},gd,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(y,i)}if(this.updateConfig(this._config,c),i&&Ea(this,In(t)))return;this._loaded=!0,this.stylesheet=s.d6(t);const f=()=>{for(const M in t.sources)this.addSource(M,t.sources[M],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const M in t.iconsets)this.addIconset(M,t.iconsets[M]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(t.glyphs);const y=fa(this.stylesheet.layers);if(this._order=y.map(M=>M.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const M=this.stylesheet.lights[0];this.light=new Ne(M.properties,M.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ne(this.stylesheet.light)),this._layers={};for(const M of y){const P=s.db(M,this.scope,this._styleColorTheme.lut,this.options);P.configDependencies.size!==0&&this._configDependentLayers.add(P.fqid),P.setEventedParent(this,{layer:{id:P.id}}),this._layers[P.id]=P;const O=this.getOwnLayerSourceCache(P),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();O&&P.canCastShadows()&&D&&(O.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const w=this.stylesheet.terrain;w&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(w,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.A("data",{dataType:"style"}));const S=this.isRootStyle();t.imports?this._loadImports(t.imports,i).then(()=>{this._reloadImports(),this.fire(new s.A(S?"style.load":"style.import.load"))}).catch(M=>{this.fire(new s.z(new Error("Failed to load imports",M))),this.fire(new s.A(S?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.A(S?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const m=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(m){const y=this._evaluateColorThemeData(m);this._loadColorTheme(y).then(()=>{f()}).catch(w=>{s.w(`Couldn't load color theme from the stylesheet: ${w}`),f()})}else this._styleColorTheme.lut=null,f()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,i,c,f,m,y,w,S,M,P;const O={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(D=>{if(D.stylesheet){if(D.light!=null&&(t=D.light),D.stylesheet.lights)for(const F of D.stylesheet.lights)F.type==="ambient"&&D.ambientLight!=null&&(i=D.ambientLight),F.type==="directional"&&D.directionalLight!=null&&(c=D.directionalLight);f=this._prioritizeTerrain(f,D.terrain,D.stylesheet.terrain),D.stylesheet.fog&&D.fog!=null&&(m=D.fog),D.stylesheet.snow&&D.snow!=null&&(y=D.snow),D.stylesheet.rain&&D.rain!=null&&(w=D.rain),D.stylesheet.camera!=null&&(P=D.stylesheet.camera),D.stylesheet.projection!=null&&(S=D.stylesheet.projection),D.stylesheet.transition!=null&&(M=D.stylesheet.transition),O[D.scope]=D._styleColorTheme}}),this.light=t,this.ambientLight=i,this.directionalLight=c,this.fog=m,this.snow=y,this.rain=w,this._styleColorThemeForScope=O,f===null?delete this.terrain:this.terrain=f,this.camera=P||{"camera-projection":"perspective"},this.projection=S||{name:"mercator"},this.transition=s.h({},Eh,M),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const i=c=>{for(const f of c.fragments)i(f.style);t(c)};i(this)}_prioritizeTerrain(t,i,c){const f=t&&t.drapeRenderMode===0;return c===null?i&&i.drapeRenderMode===0?i:f?t:null:i!=null&&(!t||f||i&&i.drapeRenderMode===1)?i:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(i=>{t=this._prioritizeTerrain(t,i.terrain,i.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(i=>{i.stylesheet.projection!=null&&(t=i.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},i={},c={};this.forEachFragmentStyle(f=>{for(const m in f._sourceCaches){const y=s.C(m,f.scope);t[y]=f._sourceCaches[m]}for(const m in f._otherSourceCaches){const y=s.C(m,f.scope);i[y]=f._otherSourceCaches[m]}for(const m in f._symbolSourceCaches){const y=s.C(m,f.scope);c[y]=f._symbolSourceCaches[m]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=i,this._mergedSymbolSourceCaches=c}mergeLayers(){const t={},i=[],c={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(m=>{for(const y of m._order){const w=m._layers[y];if(w.type==="slot"){const S=s.d7(y);if(t[S])continue;t[S]=[]}w.slot&&t[w.slot]?t[w.slot].push(w):i.push(w)}}),this._mergedOrder=[];const f=(m=[])=>{for(const y of m)if(y.type==="slot"){const w=s.d7(y.id);t[w]&&f(t[w]),this._mergedSlots.push(w)}else{const w=s.C(y.id,y.scope);this._mergedOrder.push(w),c[w]=y,y.is3D(!!this.terrain)&&(this._has3DLayers=!0),y.type==="circle"&&(this._hasCircleLayers=!0),y.type==="symbol"&&(this._hasSymbolLayers=!0),y.type==="clip"&&(this._clipLayerPresent=!0)}};f(i),this._mergedOrder.sort((m,y)=>{const w=c[m],S=c[y];return w.hasInitialOcclusionOpacityProperties?S.is3D(!!this.terrain)?1:0:w.is3D(!!this.terrain)&&S.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=c,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=s.h({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(i,c,f,m){const y=s.h({},c);for(const S of Object.keys(s.a5.colorTheme))y[S]===void 0&&(y[S]=s.a5.colorTheme[S].default);const w=new s.a6(Th,i,new Map(f));return w.setTransitionOrValue(y,f),w.untransitioned().possiblyEvaluate(new s.aa(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const i=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((c,f)=>{const m="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void c();let y=t;y.startsWith(m)||(y=m+y);const w=s.I.from("mapbox-reserved-lut"),S=new Image;S.src=y,S.onerror=()=>{this._styleColorTheme.lutLoading=!1,f(new Error("Failed to load image data"))},S.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==i)return void c();this._styleColorTheme.lutLoading=!1;const{width:M,height:P,data:O}=s.q.getImageData(S);if(P>32)return void f(new Error("The height of the image must be less than or equal to 32 pixels."));if(M!==P*P)return void f(new Error("The width of the image must be equal to the height squared."));this.getImage(w)&&this.removeImage(w),this.addImage(w,{data:new s.r({width:M,height:P},O),pixelRatio:1,sdf:!1,usvg:!1,version:0});const D=this.imageManager.getImage(w,this.scope);D?(this._styleColorTheme.lut={image:D.data,data:t},c()):f(new Error("Missing LUT image."))}})}getLut(t){const i=this._styleColorThemeForScope[t];return i?i.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(i,c,f){let m,y,w;const S=s.q.devicePixelRatio>1?"@2x":"";let M=s.n(c.transformRequest(c.normalizeSpriteURL(i,S,".json"),s.R.SpriteJSON),(D,F)=>{M=null,w||(w=D,m=F,O())}),P=s.o(c.transformRequest(c.normalizeSpriteURL(i,S,".png"),s.R.SpriteImage),(D,F)=>{P=null,w||(w=D,y=F,O())});function O(){if(w)f(w);else if(m&&y){const D=s.q.getImageData(y),F={};for(const q in m){const{width:V,height:W,x:X,y:J,sdf:se,pixelRatio:le,stretchX:ge,stretchY:_e,content:pe}=m[q],ue=new s.r({width:V,height:W});s.r.copy(D,ue,{x:X,y:J},{x:0,y:0},{width:V,height:W},null),F[q]={data:ue,pixelRatio:le,sdf:se,stretchX:ge,stretchY:_e,content:pe,usvg:!1}}f(null,F)}}return{cancel(){M&&(M.cancel(),M=null),P&&(P.cancel(),P=null)}}}(t,this.map._requestManager,(i,c)=>{if(this._spriteRequest=null,i)this.fire(new s.z(i));else if(c){const f=new Map;for(const m in c)f.set(s.I.from(m),c[m]);this.addImages(f)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))})}addIconset(t,i){if(i.type==="sprite")return void this._loadSprite(i.url);const c=this.getOwnSourceCache(i.source);if(!c)return void this.fire(new s.z(new Error(`Source "${i.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const f=c.getSource();if(f.type!=="raster-array")return void this.fire(new s.z(new Error(`Source "${i.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));f.partial=!1;const m=new ga(t,this.scope,c);this.imageManager.addImageProvider(m,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!s.j(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const i=this.map._spriteFormat==="auto";var c,f;this._spriteRequest=(f=(m,y)=>{if(this._spriteRequest=null,m)i?this._loadSprite(t):this.fire(new s.z(m));else if(y){const w=new Map;for(const S in y)w.set(s.I.from(S),y[S]);this.addImages(w)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))},s.br((c=this.map._requestManager).transformRequest(c.normalizeIconsetURL(t),s.R.Iconset),(m,y)=>{if(m)return void f(m);const w={},S=s.c_(new s.bq(y));for(const M of S.icons){const P={version:1,pixelRatio:s.q.devicePixelRatio,content:ym(M),stretchX:M.metadata?xp(M.metadata.stretch_x_areas):void 0,stretchY:M.metadata?xp(M.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:M};w[M.name]=P}f(null,w)}))}_validateLayer(t){const i=this.getOwnSource(t.source);if(!i)return;const c=t.sourceLayer;c&&(i.type==="geojson"||i.vectorLayerIds&&i.vectorLayerIds.indexOf(c)===-1)&&this.fire(new s.z(new Error(`Source layer "${c}" does not exist on source "${i.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,i)=>{const c=this.fragments[i];return c&&c.style&&(t.data=c.style.serialize()),t})}_serializeSources(){const t={};for(const i in this._sourceCaches){const c=this._sourceCaches[i].getSource();t[c.id]||(t[c.id]=c.serialize())}return t}_serializeLayers(t){const i=[];for(const c of t){const f=this._layers[c];f&&f.type!=="custom"&&i.push(f.serialize())}return i}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const i=this.getOwnLayer(t);if(i)return i;this.fire(new s.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const i=this.getOwnSource(t);if(i)return i;this.fire(new s.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,i){const c=this.map.painter;if(c)for(let f=t.minzoom||0;f<(t.maxzoom||25.5);f++){const m=t.getProgramIds();if(m)for(const y of m){const w=t.getDefaultProgramParams(y,i.zoom,this._styleColorTheme.lut);w&&(c.style=this,this.fog&&(c._fogVisible=!0,w.overrideFog=!0,c.getOrCreateProgram(y,w)),c._fogVisible=!1,w.overrideFog=!1,c.getOrCreateProgram(y,w),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(w.overrideRtt=!0,c.getOrCreateProgram(y,w)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const i=this.calculateLightsBrightness();t.brightness=i||0,i!==this._brightness&&(this._brightness=i,this.dispatcher.broadcast("setBrightness",i)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const c=this._changes.isDirty();let f=!1;if(this._changes.isDirty()){const w=this._changes.getLayerUpdatesByScope();for(const S in w){const{updatedIds:M,removedIds:P}=w[S];(M||P)&&(this._updateWorkerLayers(S,M,P),f=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const m={};for(const w in this._mergedSourceCaches){const S=this._mergedSourceCaches[w];m[w]=S.used,S.used=!1,S.tileCoverLift=0}for(const w of this._mergedOrder){const S=this._mergedLayers[w];if(S.recalculate(t,this._availableImages),!S.isHidden(t.zoom)){const M=this.getLayerSourceCache(S);M&&(M.used=!0,M.tileCoverLift=Math.max(M.tileCoverLift,S.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(S,t)}):this.precompilePrograms(S,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&f&&this.mergeLayers();const y=this.imageManager.getPendingImageProviders();for(const w of y)w.sourceCache.used=!0;for(const w in m){const S=this._mergedSourceCaches[w];m[w]!==S.used&&S.getSource().fire(new s.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:S.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),c&&this.fire(new s.A("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const i of t){const c=i.resolvePendingRequests(),f=this.getFragmentStyle(i.scope);f&&f.addImages(c)}}_updateTilesForChangedImages(){const t={};for(const i in this._mergedSourceCaches){const c=this._mergedSourceCaches[i].getSource().scope;t[c]=t[c]||this._changes.getUpdatedImages(c),t[c].length!==0&&this._mergedSourceCaches[i].reloadTilesForDependencies(["icons","patterns"],t[c])}for(const i in t)this._changes.resetUpdatedImages(i)}_updateWorkerLayers(t,i,c){const f=this.getFragmentStyle(t);f&&this.dispatcher.broadcast("updateLayers",{layers:i?f._serializeLayers(i):[],scope:t,removedIds:c||[],options:f.options})}setState(t,i){if(this._checkLoaded(),Ea(this,In(t)))return!1;(t=s.d6(t)).layers=fa(t.layers);const c=function(y,w){if(!y)return[{command:gn.setStyle,args:[w]}];let S=[];try{if(!s.bv(y.version,w.version))return[{command:gn.setStyle,args:[w]}];if(s.bv(y.center,w.center)||S.push({command:gn.setCenter,args:[w.center]}),s.bv(y.zoom,w.zoom)||S.push({command:gn.setZoom,args:[w.zoom]}),s.bv(y.bearing,w.bearing)||S.push({command:gn.setBearing,args:[w.bearing]}),s.bv(y.pitch,w.pitch)||S.push({command:gn.setPitch,args:[w.pitch]}),s.bv(y.sprite,w.sprite)||S.push({command:gn.setSprite,args:[w.sprite]}),s.bv(y.glyphs,w.glyphs)||S.push({command:gn.setGlyphs,args:[w.glyphs]}),s.bv(y.imports,w.imports)||function(F=[],q=[],V){q=q||[];const W=(F=F||[]).map(Xl),X=q.map(Xl),J=F.reduce(Yl,{}),se=q.reduce(Yl,{}),le=W.slice();let ge,_e,pe,ue;for(ge=0,_e=0;ge<W.length;ge++)pe=W[ge],se.hasOwnProperty(pe)?_e++:(V.push({command:gn.removeImport,args:[pe]}),le.splice(le.indexOf(pe,_e),1));for(ge=0,_e=0;ge<X.length;ge++)pe=X[X.length-1-ge],le[le.length-1-ge]!==pe&&(J.hasOwnProperty(pe)?(V.push({command:gn.removeImport,args:[pe]}),le.splice(le.lastIndexOf(pe,le.length-_e),1)):_e++,ue=le[le.length-ge],V.push({command:gn.addImport,args:[se[pe],ue]}),le.splice(le.length-ge,0,pe));for(const ye of q){const xe=J[ye.id];xe&&(delete xe.data,s.bv(xe,ye)||V.push({command:gn.updateImport,args:[ye.id,ye]}))}}(y.imports,w.imports,S),s.bv(y.transition,w.transition)||S.push({command:gn.setTransition,args:[w.transition]}),s.bv(y.light,w.light)||S.push({command:gn.setLight,args:[w.light]}),s.bv(y.fog,w.fog)||S.push({command:gn.setFog,args:[w.fog]}),s.bv(y.snow,w.snow)||S.push({command:gn.setSnow,args:[w.snow]}),s.bv(y.rain,w.rain)||S.push({command:gn.setRain,args:[w.rain]}),s.bv(y.projection,w.projection)||S.push({command:gn.setProjection,args:[w.projection]}),s.bv(y.lights,w.lights)||S.push({command:gn.setLights,args:[w.lights]}),s.bv(y.camera,w.camera)||S.push({command:gn.setCamera,args:[w.camera]}),s.bv(y.iconsets,w.iconsets)||function(F,q,V){let W;for(W in q=q||{},F=F||{})F.hasOwnProperty(W)&&(q.hasOwnProperty(W)||V.push({command:gn.removeIconset,args:[W]}));for(W in q){if(!q.hasOwnProperty(W))continue;const X=q[W];F.hasOwnProperty(W)?s.bv(F[W],X)||(V.push({command:gn.removeIconset,args:[W]}),V.push({command:gn.addIconset,args:[W,X]})):V.push({command:gn.addIconset,args:[W,X]})}}(y.iconsets,w.iconsets,S),!s.bv(y["color-theme"],w["color-theme"]))return[{command:gn.setStyle,args:[w]}];const M={},P=[];(function(F,q,V,W){let X;for(X in q=q||{},F=F||{})F.hasOwnProperty(X)&&(q.hasOwnProperty(X)||Na(X,V,W));for(X in q){if(!q.hasOwnProperty(X))continue;const J=q[X];F.hasOwnProperty(X)?s.bv(F[X],J)||(F[X].type==="geojson"&&J.type==="geojson"&&vp(F,q,X)?V.push({command:gn.setGeoJSONSourceData,args:[X,J.data]}):mh(X,q,V,W)):ph(X,q,V)}})(y.sources,w.sources,P,M);const O=[];y.layers&&y.layers.forEach(F=>{F.source&&M[F.source]?S.push({command:gn.removeLayer,args:[F.id]}):O.push(F)});let D=y.terrain;D&&M[D.source]&&(S.push({command:gn.setTerrain,args:[void 0]}),D=void 0),S=S.concat(P),s.bv(D,w.terrain)||S.push({command:gn.setTerrain,args:[w.terrain]}),function(F,q,V){q=q||[];const W=(F=F||[]).map(Xl),X=q.map(Xl),J=F.reduce(Yl,{}),se=q.reduce(Yl,{}),le=W.slice(),ge=Object.create(null);let _e,pe,ue,ye,xe,Pe,Le;for(_e=0,pe=0;_e<W.length;_e++)ue=W[_e],se.hasOwnProperty(ue)?pe++:(V.push({command:gn.removeLayer,args:[ue]}),le.splice(le.indexOf(ue,pe),1));for(_e=0,pe=0;_e<X.length;_e++)ue=X[X.length-1-_e],le[le.length-1-_e]!==ue&&(J.hasOwnProperty(ue)?(V.push({command:gn.removeLayer,args:[ue]}),le.splice(le.lastIndexOf(ue,le.length-pe),1)):pe++,Pe=le[le.length-_e],V.push({command:gn.addLayer,args:[se[ue],Pe]}),le.splice(le.length-_e,0,ue),ge[ue]=!0);for(_e=0;_e<X.length;_e++)if(ue=X[_e],ye=J[ue],xe=se[ue],!ge[ue]&&!s.bv(ye,xe))if(s.bv(ye.source,xe.source)&&s.bv(ye["source-layer"],xe["source-layer"])&&s.bv(ye.type,xe.type)){for(Le in Zl(ye.layout,xe.layout,V,ue,null,gn.setLayoutProperty),Zl(ye.paint,xe.paint,V,ue,null,gn.setPaintProperty),s.bv(ye.slot,xe.slot)||V.push({command:gn.setSlot,args:[ue,xe.slot]}),s.bv(ye.filter,xe.filter)||V.push({command:gn.setFilter,args:[ue,xe.filter]}),s.bv(ye.minzoom,xe.minzoom)&&s.bv(ye.maxzoom,xe.maxzoom)||V.push({command:gn.setLayerZoomRange,args:[ue,xe.minzoom,xe.maxzoom]}),ye)ye.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&Le!=="slot"&&(Le.indexOf("paint.")===0?Zl(ye[Le],xe[Le],V,ue,Le.slice(6),gn.setPaintProperty):s.bv(ye[Le],xe[Le])||V.push({command:gn.setLayerProperty,args:[ue,Le,xe[Le]]}));for(Le in xe)xe.hasOwnProperty(Le)&&!ye.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&Le!=="slot"&&(Le.indexOf("paint.")===0?Zl(ye[Le],xe[Le],V,ue,Le.slice(6),gn.setPaintProperty):s.bv(ye[Le],xe[Le])||V.push({command:gn.setLayerProperty,args:[ue,Le,xe[Le]]}))}else V.push({command:gn.removeLayer,args:[ue]}),Pe=le[le.lastIndexOf(ue)+1],V.push({command:gn.addLayer,args:[xe,Pe]})}(O,w.layers,S)}catch(M){console.warn("Unable to compute style diff:",M),S=[{command:gn.setStyle,args:[w]}]}return S}(this.serialize(),t).filter(y=>!(y.command in wf));if(c.length===0)return!1;const f=c.filter(y=>!(y.command in md));if(f.length>0)throw new Error(`Unimplemented: ${f.map(y=>y.command).join(", ")}.`);const m=[];return c.forEach(y=>{m.push(this[y.command](...y.args))}),i&&Promise.all(m).then(i).catch(i),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){for(const[i,c]of t.entries()){if(this.getImage(i))return this.fire(new s.z(new Error(`An image with the name "${i.name}" already exists.`)));this.imageManager.addImage(i,this.scope,c),this._changes.updateImage(i,this.scope)}return this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this}addImage(t,i){return this.getImage(t)?this.fire(new s.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,i),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this)}updateImage(t,i,c=!1){this.imageManager.updateImage(t,this.scope,i),c&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this):this.fire(new s.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new s.A("data",{dataType:"style"})),this}addModel(t,i,c={}){return this._checkLoaded(),this._validate(he,`models.${t}`,i,null,c)||(this.modelManager.addModel(t,i,this.scope),this.fire(new s.A("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this.fire(new s.A("data",{dataType:"style"})),this):this.fire(new s.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,i,c={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(Nn,`sources.${t}`,i,null,c))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const f=Gl(t,i,this.dispatcher,this);f.scope=this.scope,f.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(f.id),source:f.serialize(),sourceId:f.id}));const m=y=>{const w=(y?"symbol:":"other:")+f.id,S=s.C(w,this.scope),M=this._sourceCaches[w]=new Ls(S,f,y);(y?this._symbolSourceCaches:this._otherSourceCaches)[f.id]=M,M.onAdd(this.map)};m(!1),i.type!=="vector"&&i.type!=="geojson"||m(!0),f.onAdd&&f.onAdd(this.map),c.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const i=this.getOwnSource(t);if(!i)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===t)return this.fire(new s.z(new Error(`Source "${t}" cannot be removed while layer "${f}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new s.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const f=Object.entries(this.stylesheet.iconsets).find(([m,y])=>y.type==="source"&&y.source===t);if(f)return this.fire(new s.z(new Error(`Source "${t}" cannot be removed while iconset "${f[0]}" is using it.`)))}const c=this.getOwnSourceCaches(t);for(const f of c){const m=s.d7(f.id);delete this._sourceCaches[m],this._changes.discardSourceCacheUpdate(f.id),f.fire(new s.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:f.getSource().id})),f.setEventedParent(null),f.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,i){this._checkLoaded(),this.getOwnSource(t).setData(i),this._changes.setDirty()}getOwnSource(t){const i=this.getOwnSourceCache(t);return i&&i.getSource()}getOwnSources(){const t=[];for(const i in this._otherSourceCaches){const c=this.getOwnSourceCache(i);c&&t.push(c.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const i in t){const c=t[i]._tiles;for(const f in c){const m=c[f];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const i=this._getTransitionParameters();for(const m of t){if(this._validate(Wi,"lights",m))return;switch(m.type){case"ambient":if(this.ambientLight){const y=this.ambientLight;y.set(m),y.updateTransitions(i)}else this.ambientLight=new An(m,Rr||(Rr=new s.a7({color:new s.a8(s.a5.properties_light_ambient.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const y=this.directionalLight;y.set(m),y.updateTransitions(i)}else this.directionalLight=new An(m,jn||(jn=new s.a7({direction:new s.an(s.a5.properties_light_directional.direction),color:new s.a8(s.a5.properties_light_directional.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_directional.intensity),"cast-shadows":new s.a8(s.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new s.a8(s.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.a8(s.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const c=Object.assign(i,{worldview:this.map.getWorldview()}),f=new s.aa(this.z||0,c);this.ambientLight&&this.ambientLight.recalculate(f),this.directionalLight&&this.directionalLight.recalculate(f),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,i=this.ambientLight;if(!t||!i)return;const c=D=>.2126*(D[0]<=.03928?D[0]/12.92:Math.pow((D[0]+.055)/1.055,2.4))+.7152*(D[1]<=.03928?D[1]/12.92:Math.pow((D[1]+.055)/1.055,2.4))+.0722*(D[2]<=.03928?D[2]/12.92:Math.pow((D[2]+.055)/1.055,2.4)),f=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),m=t.properties.get("intensity"),y=t.properties.get("direction"),w=1-s.cR(y.x,y.y,y.z)[2]/90,S=c(f)*m*w,M=i.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),P=i.properties.get("intensity"),O=c(M)*P;return Number(((S+O)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(s.d8(t)){const i=s.d9(t),c=this.fragments.find(({id:m})=>m===i);if(!c)return;const f=s.d7(t);return c.style.getFragmentStyle(f)}{const i=this.fragments.find(({id:c})=>c===t);return i?i.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const i={},c=(f,m="")=>`${f}::${m}`;this._featuresetSelectors={};for(const f in t){const m=this._featuresetSelectors[f]=[];for(const y of t[f].selectors){if(y.featureNamespace){const S=this.getOwnLayer(y.layer);if(!S){s.w(`Layer is undefined for selector: ${y.layer}`);continue}const M=c(S.source,S.sourceLayer);if(M in i&&i[M]!==y.featureNamespace){s.w(`"featureNamespace ${y.featureNamespace} of featureset ${f}'s selector is not associated to the same source, skip this selector`);continue}i[M]=y.featureNamespace}let w;if(y.properties)for(const S in y.properties){const M=s.X(y.properties[S]);M.result==="success"&&(w=w||{},w[S]=M.value)}m.push({layerId:y.layer,namespace:y.featureNamespace,properties:w,uniqueFeatureID:y._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const i=this.getFragmentStyle(t);if(!i||!i.stylesheet.featuresets)return[];const c=[];for(const f in i.stylesheet.featuresets)c.push({featuresetId:f,importId:i.scope?i.scope:void 0});return c}getFeaturesetLayers(t,i){const c=this.getFragmentStyle(i),f=c.stylesheet.featuresets;if(!f||!f[t])return this.fire(new s.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const m=[];for(const y of f[t].selectors){const w=c.getOwnLayer(y.layer);w&&m.push(w)}return m}getConfigProperty(t,i){const c=this.getFragmentStyle(t);if(!c)return null;const f=s.C(i,c.scope),m=c.options.get(f),y=m?m.value||m.default:null;return y?y.serialize():null}setConfigProperty(t,i,c){const f=this.getFragmentStyle(t);if(!f)return;const m=f.stylesheet.indoor?wl(f.stylesheet.schema):f.stylesheet.schema;if(!m||!m[i])return;const y=s.X(c);if(y.result!=="success")return void Ea(this,y.value);const w=y.value.expression,S=s.C(i,f.scope),M=f.options.get(S);if(!M)return;let P;const{minValue:O,maxValue:D,stepValue:F,type:q,values:V}=m[i],W=s.X(m[i].default);W.result==="success"&&(P=W.value.expression),P?(this.options.set(S,Object.assign({},M,{value:w,default:P,minValue:O,maxValue:D,stepValue:F,type:q,values:V})),this.updateConfigDependencies(i)):this.fire(new s.z(new Error(`No schema defined for the config option "${i}" in the "${t}" fragment.`)))}getConfig(t){const i=this.getFragmentStyle(t);if(!i)return null;const c=i.stylesheet.schema;if(!c)return null;const f={};for(const m in c){const y=s.C(m,i.scope),w=i.options.get(y),S=w?w.value||w.default:null;f[m]=S?S.serialize():null}return f}setConfig(t,i){const c=this.getFragmentStyle(t);c&&(c.updateConfig(i,c.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const i=this.getFragmentStyle(t);return i?i.stylesheet.schema:null}setSchema(t,i){const c=this.getFragmentStyle(t);c&&(c.stylesheet.schema=i,c.updateConfig(c._config,i),this.updateConfigDependencies())}updateConfig(t,i){if(this._config=t,t||i)if(i)for(const c in i){let f,m;const y=s.X(i[c].default);if(y.result==="success"&&(f=y.value.expression),t&&t[c]!==void 0){const D=s.X(t[c]);D.result==="success"&&(m=D.value.expression)}const{minValue:w,maxValue:S,stepValue:M,type:P,values:O}=i[c];if(f){const D=s.C(c,this.scope);this.options.set(D,{default:f,value:m,minValue:w,maxValue:S,stepValue:M,type:P,values:O})}else this.fire(new s.z(new Error(`No schema defined for config option "${c}".`)))}else this.fire(new s.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const i of this._configDependentLayers){const c=this.getLayer(i);if(c){if(t&&!c.configDependencies.has(t))continue;c.possiblyEvaluateVisibility(),this._updateLayer(c)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(i=>{const c=i._styleColorTheme.colorThemeOverride?i._styleColorTheme.colorThemeOverride:i._styleColorTheme.colorTheme;if(c){const f=i._evaluateColorThemeData(c);(!i._styleColorTheme.lut&&f!==""||i._styleColorTheme.lut&&f!==i._styleColorTheme.lut.data)&&i.setColorTheme(c)}}),this._changes.setDirty()}addLayer(t,i,c={}){this._checkLoaded();const f=t.id;if(this._layers[f])return void this.fire(new s.z(new Error(`Layer with id "${f}" already exists on this map`)));let m;if(t.type==="custom"){if(Ea(this,s.da(t)))return;m=s.db(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(f,t.source),t=s.d6(t),t=s.h(t,{source:f})),this._validate(en,`layers.${f}`,t,{arrayIndex:-1},c))return;m=s.db(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(m),m.setEventedParent(this,{layer:{id:f}})}m.configDependencies.size!==0&&this._configDependentLayers.add(m.fqid);let y=this._order.length;if(i){const P=this._order.indexOf(i);if(P===-1)return void this.fire(new s.z(new Error(`Layer with id "${i}" does not exist on this map.`)));m.slot===this._layers[i].slot?y=P:s.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,f),this._layerOrderChanged=!0,this._layers[f]=m;const w=this.getOwnLayerSourceCache(m),S=!!this.directionalLight&&this.directionalLight.shadowsEnabled();w&&m.canCastShadows()&&S&&(w.castsShadows=!0);const M=this._changes.getRemovedLayer(m);if(M&&m.source&&w&&m.type!=="custom"){this._changes.discardLayerRemoval(m);const P=s.C(m.source,m.scope);M.type!==m.type?this._changes.updateSourceCache(P,"clear"):(this._changes.updateSourceCache(P,"reload"),w.pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map),m.scope=this.scope,this.mergeLayers()}moveLayer(t,i){this._checkLoaded();const c=this._checkLayer(t);if(!c||t===i)return;const f=this._order.indexOf(t);this._order.splice(f,1);let m=this._order.length;if(i){const y=this._order.indexOf(i);if(y===-1)return void this.fire(new s.z(new Error(`Layer with id "${i}" does not exist on this map.`)));c.slot===this._layers[i].slot?m=y:s.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(m,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const i=this._checkLayer(t);if(!i)return;i.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(i.fqid),this._changes.removeLayer(i);const f=this.getOwnLayerSourceCache(i);if(f&&f.castsShadows){let m=!1;for(const y in this._layers)if(this._layers[y].source===i.source&&this._layers[y].canCastShadows()){m=!0;break}f.castsShadows=m}i.onRemove&&i.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const i in this._layers)if(this._layers[i].type===t)return!0;return!1}setLayerZoomRange(t,i,c){this._checkLoaded();const f=this._checkLayer(t);f&&(f.minzoom===i&&f.maxzoom===c||(i!=null&&(f.minzoom=i),c!=null&&(f.maxzoom=c),this._updateLayer(f)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,i){this._checkLoaded();const c=this._checkLayer(t);c&&c.slot!==i&&(c.slot=i,this._updateLayer(c))}setFilter(t,i,c={}){this._checkLoaded();const f=this._checkLayer(t);if(f&&!s.bv(f.filter,i))return i==null?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(Oe,`layers.${f.id}.filter`,i,{layerType:f.type},c)||(f.filter=s.d6(i),this._updateLayer(f)))}getFilter(t){const i=this._checkLayer(t);if(i)return s.d6(i.filter)}setLayoutProperty(t,i,c,f={}){this._checkLoaded();const m=this._checkLayer(t);if(m&&!s.bv(m.getLayoutProperty(i),c)){if(c!=null&&(!f||f.validate!==!1)&&Ea(m,Q.call(In,{key:`layers.${t}.layout.${i}`,layerType:m.type,objectKey:i,value:c,styleSpec:s.a5,style:{glyphs:!0,sprite:!0}})))return;m.setLayoutProperty(i,c),m.configDependencies.size!==0&&this._configDependentLayers.add(m.fqid),this._updateLayer(m)}}getLayoutProperty(t,i){const c=this._checkLayer(t);if(c)return c.getLayoutProperty(i)}setPaintProperty(t,i,c,f={}){this._checkLoaded();const m=this._checkLayer(t);if(!m||s.bv(m.getPaintProperty(i),c)||c!=null&&(!f||f.validate!==!1)&&Ea(m,Y.call(In,{key:`layers.${t}.paint.${i}`,layerType:m.type,objectKey:i,value:c,styleSpec:s.a5})))return;const y=m.setPaintProperty(i,c);m.configDependencies.size!==0&&this._configDependentLayers.add(m.fqid),y&&this._updateLayer(m),this._changes.updatePaintProperties(m)}getPaintProperty(t,i){const c=this._checkLayer(t);if(c)return c.getPaintProperty(i)}setFeatureState(t,i){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:S,importId:M}=t.target,P=this.getFragmentStyle(M),O=P.getFeaturesetLayers(S);for(const{source:D,sourceLayer:F}of O)P.setFeatureState({id:t.id,source:D,sourceLayer:F},i)}else if("layerId"in t.target){const{layerId:S}=t.target,M=this.getLayer(S);this.setFeatureState({id:t.id,source:M.source,sourceLayer:M.sourceLayer},i)}return}const c=t.source,f=t.sourceLayer,m=this._checkSource(c);if(!m)return;const y=m.type;if(y==="geojson"&&f)return void this.fire(new s.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(y==="vector"&&!f)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided.")));const w=this.getOwnSourceCaches(c);for(const S of w)S.setFeatureState(f,t.id,i)}removeFeatureState(t,i){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:S,importId:M}=t.target,P=this.getFragmentStyle(M),O=P.getFeaturesetLayers(S);for(const{source:D,sourceLayer:F}of O)P.removeFeatureState({id:t.id,source:D,sourceLayer:F},i)}else if("layerId"in t.target){const{layerId:S}=t.target,M=this.getLayer(S);this.removeFeatureState({id:t.id,source:M.source,sourceLayer:M.sourceLayer},i)}return}const c=t.source,f=this._checkSource(c);if(!f)return;const m=f.type,y=m==="vector"?t.sourceLayer:void 0;if(m==="vector"&&!y)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new s.z(new Error("A feature id is required to remove its specific state property.")));const w=this.getOwnSourceCaches(c);for(const S of w)S.removeFeatureState(y,t.id,i)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let m;if("featuresetId"in t.target){const{featuresetId:y,importId:w}=t.target,S=this.getFragmentStyle(w),M=S.getFeaturesetLayers(y);for(const{source:P,sourceLayer:O}of M){const D=S.getFeatureState({id:t.id,source:P,sourceLayer:O});if(D&&!m)m=D;else if(!s.bv(m,D))return void this.fire(new s.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:y}=t.target,w=this.getLayer(y);m=this.getFeatureState({id:t.id,source:w.source,sourceLayer:w.sourceLayer})}return m}const i=t.source,c=t.sourceLayer,f=this._checkSource(i);if(f){if(f.type!=="vector"||c)return t.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(i)[0].getFeatureState(c,t.id);this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=s.h({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return s.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),i=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return s.dc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:i,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},c=>c!==void 0)}_updateFilteredLayers(t){for(const i of Object.values(this._mergedLayers))t(i)&&this._updateLayer(i)}_updateLayer(t){this._changes.updateLayer(t);const i=this.getLayerSourceCache(t),c=s.C(t.source,t.scope),f=this._changes.getUpdatedSourceCaches();t.source&&!f[c]&&i&&i.getSource().type!=="raster"&&(this._changes.updateSourceCache(c,"reload"),i.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const i=w=>this._mergedLayers[w].is3D(!!this.terrain),c=this.order,f={},m=[];for(let w=c.length-1;w>=0;w--){const S=c[w];if(i(S)){f[S]=w;for(const M of t){const P=M[S];if(P)for(const O of P)m.push(O)}}}m.sort((w,S)=>S.intersectionZ-w.intersectionZ);const y=[];for(let w=c.length-1;w>=0;w--){const S=c[w];if(i(S))for(let M=m.length-1;M>=0;M--){const P=m[M].feature;if(P.layer&&f[P.layer.id]<w)break;y.push(P),m.pop()}else for(const M of t){const P=M[S];if(P)for(const O of P)y.push(O.feature)}}return y}queryRenderedFeatures(t,i,c){let f;i&&!Array.isArray(i)&&i.filter&&(this._validate(Oe,"queryRenderedFeatures.filter",i.filter,null,i),f=s.b3(i.filter));const m={},y=P=>{if(Sh.has(P.type))return;const O=this.getOwnLayerSourceCache(P),D=m[O.id]=m[O.id]||{sourceCache:O,layers:{},has3DLayers:!1};P.is3D(!!this.terrain)&&(D.has3DLayers=!0),D.layers[P.fqid]=D.layers[P.fqid]||{styleLayer:P,targets:[]},D.layers[P.fqid].targets.push({filter:f})};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new s.z(new Error("parameters.layers must be an Array."))),[];for(const P of i.layers){const O=this._layers[P];if(!O)return this.fire(new s.z(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];y(O)}}else for(const P in this._layers)y(this._layers[P]);const w=this._queryRenderedFeatures(t,m,c),S=this._flattenAndSortRenderedFeatures(w),M=[];for(const P of S)s.dd(P.layer.id)===this.scope&&M.push(P);return M}queryRenderedFeatureset(t,i,c){let f;i&&!Array.isArray(i)&&i.filter&&(this._validate(Oe,"queryRenderedFeatures.filter",i.filter,null,i),f=s.b3(i.filter));const m="mock",y=[];if(i&&i.target)y.push(Object.assign({},i,{targetId:m,filter:f}));else{const P=this.getFeaturesetDescriptors();for(const O of P)y.push({targetId:m,filter:f,target:O});for(const{style:O}of this.fragments){const D=O.getFeaturesetDescriptors();for(const F of D)y.push({targetId:m,filter:f,target:F})}}const w=this.queryRenderedTargets(t,y,c),S=[],M=new Set;for(const P of w)for(const O of P.variants[m])Hl(O,P,M)||S.push(new s.de(P,O));return S}queryRenderedTargets(t,i,c){const f={},m=(w,S,M,P)=>{const O=f[S.id]=f[S.id]||{sourceCache:S,layers:{},has3DLayers:!1};if(O.layers[w.fqid]=O.layers[w.fqid]||{styleLayer:w,targets:[]},w.is3D(!!this.terrain)&&(O.has3DLayers=!0),!P)return M.uniqueFeatureID=!1,void O.layers[w.fqid].targets.push(M);O.layers[w.fqid].targets.push(Object.assign({},M,{namespace:P.namespace,properties:P.properties,uniqueFeatureID:P.uniqueFeatureID}))};for(const w of i)if("featuresetId"in w.target){const{featuresetId:S,importId:M}=w.target,P=this.getFragmentStyle(M);if(!P||!P._featuresetSelectors)continue;const O=P._featuresetSelectors[S];if(!O){this.fire(new s.z(new Error(`The featureset '${S}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const D of O){const F=P.getOwnLayer(D.layerId);F&&!Sh.has(F.type)&&m(F,P.getOwnLayerSourceCache(F),w,D)}}else if("layerId"in w.target){const{layerId:S}=w.target,M=this.getLayer(S);if(!M||Sh.has(M.type))continue;m(M,this.getLayerSourceCache(M),w)}const y=this._queryRenderedFeatures(t,f,c);return this._flattenAndSortRenderedFeatures(y)}_queryRenderedFeatures(t,i,c){const f=[],m=!!this.map._showQueryGeometry,y=bn.createFromScreenPoints(t,c);for(const w in i){const S=Ic(y,i[w],this._availableImages,c,m);Object.keys(S).length&&f.push(S)}if(this.placement)for(const w in i){if(!i[w].sourceCache._onlySymbols)continue;const S=Ac(y.screenGeometry,i[w],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(S).length&&f.push(S)}return f}querySourceFeatures(t,i){const c=i&&i.filter;c&&this._validate(Oe,"querySourceFeatures.filter",c,null,i);let f=[];const m=this.getOwnSourceCaches(t);for(const y of m)f=f.concat(dh(y,i));return f}addSourceType(t,i,c){return qs.getSourceType(t)?c(new Error(`A source type called "${t}" already exists.`)):(qs.setSourceType(t,i),i.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:i.workerSourceURL},c):c(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,i,c={}){this._checkLoaded();const f=this.light.getLight();let m=!1;for(const w in t)if(!s.bv(t[w],f[w])){m=!0;break}if(!m)return;const y=this._getTransitionParameters();this.light.setLight(t,i,c),this.light.updateTransitions(y)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,i=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),i===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let c=t;const f=t.source==null;if(i===1){if(this.disableElevatedTerrain)return;if(typeof c.source=="object"){const w="terrain-dem-src";this.addSource(w,c.source),c=s.d6(c),c=s.h(c,{source:w})}const m=s.h({},c),y={};if(this.terrain&&f){m.source=this.terrain.get().source;const w=this.terrain?this.getFragmentStyle(this.terrain.scope):null;w&&(y.style=w.serialize())}if(this._validate(ft,"terrain",m,y))return}if(!this.terrain||this.terrain.scope!==this.scope&&!f||this.terrain&&i!==this.terrain.drapeRenderMode){if(!c)return;this._createTerrain(c,i),this.fire(new s.A("data",{dataType:"style"}))}else{const m=this.terrain,y=m.get();for(const w of Object.keys(s.a5.terrain))!c.hasOwnProperty(w)&&s.a5.terrain[w].default&&(c[w]=s.a5.terrain[w].default);for(const w in t)if(!s.bv(t[w],y[w])){m.set(t,this.options),this.stylesheet.terrain=t;const S=this._getTransitionParameters({duration:0});m.updateTransitions(S),this.fire(new s.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const i=this.fog=new _r(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=i.get();const c=this._getTransitionParameters({duration:0});i.updateTransitions(c)}_createSnow(t){const i=this.snow=new on(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=i.get();const c=this._getTransitionParameters({duration:0});i.updateTransitions(c)}_createRain(t){const i=this.rain=new ti(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=i.get();const c=this._getTransitionParameters({duration:0});i.updateTransitions(c)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog;if(!s.bv(i.get(),t)){i.set(t,this.options),this.stylesheet.fog=i.get();const c=this._getTransitionParameters({duration:0});i.updateTransitions(c)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const i=this.snow;if(!s.bv(i.get(),t)){i.set(t,this.options),this.stylesheet.snow=i.get();const c=this._getTransitionParameters({duration:0});i.updateTransitions(c)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const i=this.rain;if(!s.bv(i.get(),t)){i.set(t,this.options),this.stylesheet.rain=i.get();const c=this._getTransitionParameters({duration:0});i.updateTransitions(c)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const f in this._layers)this._layers[f].lut=this._styleColorTheme.lut;for(const f in this._sourceCaches)this._sourceCaches[f].clearTiles()},i=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!i)return this._styleColorTheme.lut=null,void t();const c=this._evaluateColorThemeData(i);this._loadColorTheme(c).then(()=>{this.fire(new s.A("colorthemeset")),t()}).catch(f=>{s.w(`Couldn't set color theme: ${f}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,i){const c=this.getFragmentStyle(t);c&&(c._styleColorTheme.colorThemeOverride=i,c._reloadColorTheme())}_getTransitionParameters(t){return{now:s.q.now(),transition:s.h(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],i=[];for(const c of this._mergedOrder)this.isLayerDraped(this._mergedLayers[c])?t.push(c):i.push(c);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...i)}_createTerrain(t,i){const c=this.terrain=new Ce(t,i,this.scope,this.options,this.map.getWorldview());i===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}_force3DLayerUpdate(){for(const t in this._layers){const i=this._layers[t];i.type==="fill-extrusion"&&this._updateLayer(i)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const i=this._layers[t];i.type==="symbol"&&this._updateLayer(i)}}_validate(t,i,c,f,m={}){if(m&&m.validate===!1)return!1;const y=s.h({},this.serialize());return Ea(this,t.call(In,s.h({key:i,style:y,value:c,styleSpec:s.a5},f)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.df.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const i=this.getSourceCaches(t);for(const c of i)c.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const i=this.getSourceCaches(t);for(const c of i)c.resume(),c.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let i;this.directionalLight&&(i=tc(this.directionalLight));const c=new Set;for(const f in this._mergedLayers){const m=this._mergedLayers[f];m.hasElevation()&&!c.has(m.source)&&c.add(m.source)}for(const f in this._mergedSourceCaches){const m=this._mergedSourceCaches[f],y=c.has(m._source.id);m.update(t,void 0,void 0,i,y)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const i=this._sourceCaches[t];i.resume(),i.reload()}}_updatePlacement(t,i,c,f,m,y,w=!1){let S=!1,M=!1;const P={},O={};for(const D of this._mergedOrder){const F=this._mergedLayers[D];if(F.type!=="symbol")continue;const q=s.C(F.source,F.scope);let V=P[q];if(!V){const X=this.getLayerSourceCache(F);if(!X)continue;const J=X.getRenderableIds(!0).map(se=>X.getTileByID(se));O[q]=J.slice(),V=P[q]=J.sort((se,le)=>le.tileID.overscaledZ-se.tileID.overscaledZ||(se.tileID.isLessThan(le.tileID)?-1:1))}const W=this.crossTileSymbolIndex.addLayer(F,V,i.center.lng,i.projection);S=S||W}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),w=w||this._layerOrderChanged||f===0,this._layerOrderChanged&&this.fire(new s.A("neworder")),(w||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.q.now(),i.zoom))&&(this.pauseablePlacement=new hd(i,this._mergedOrder,w,c,f,m,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,P,O,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.q.now()),M=!0),S&&this.pauseablePlacement.placement.setStale()),M||S){this._buildingIndex.onNewFrame(i.zoom);for(let D=0;D<this._mergedOrder.length;D++){const F=this._mergedLayers[this._mergedOrder[D]];if(F.type!=="symbol")continue;const q=this.isLayerClipped(F);this.placement.updateLayerOpacities(F,P[s.C(F.source,F.scope)],D,q?y:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,i){this._checkLoaded();const c=this.stylesheet.imports=this.stylesheet.imports||[];if(c.findIndex(({id:m})=>m===t.id)!==-1)return void this.fire(new s.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!i)return c.push(t),this._loadImports([t],!0);const f=c.findIndex(({id:m})=>m===i);return f===-1&&this.fire(new s.z(new Error(`Import with id "${i}" does not exist on this map.`))),this.stylesheet.imports=c.slice(0,f).concat(t).concat(c.slice(f)),this._loadImports([t],!0,i)}updateImport(t,i){this._checkLoaded();const c=this.stylesheet.imports||[],f=this.getImportIndex(t);return f===-1?this:typeof i=="string"?(this.setImportUrl(t,i),this):(i.url&&i.url!==c[f].url&&this.setImportUrl(t,i.url),s.bv(i.config,c[f].config)||this.setImportConfig(t,i.config,i.data.schema),s.bv(i.data,c[f].data)||this.setImportData(t,i.data),this)}moveImport(t,i){this._checkLoaded();let c=this.stylesheet.imports||[];const f=this.getImportIndex(t);if(f===-1)return this;const m=this.getImportIndex(i);if(m===-1)return this;const y=c[f],w=this.fragments[f];return c=c.filter(({id:S})=>S!==t),this.fragments=this.fragments.filter(({id:S})=>S!==t),this.stylesheet.imports=c.slice(0,m).concat(y).concat(c.slice(m)),this.fragments=this.fragments.slice(0,m).concat(w).concat(this.fragments.slice(m)),this.mergeLayers(),this}setImportUrl(t,i){this._checkLoaded();const c=this.stylesheet.imports||[],f=this.getImportIndex(t);if(f===-1)return this;c[f].url=i;const m=this.fragments[f];return m.style=this._createFragmentStyle(c[f]),m.style.on("style.import.load",()=>this.mergeAll()),m.style.loadURL(i),this}setImportData(t,i){this._checkLoaded();const c=this.getImportIndex(t),f=this.stylesheet.imports||[];return c===-1?this:i?(this.fragments[c].style.setState(i),this._reloadImports(),this):(delete f[c].data,this.setImportUrl(t,f[c].url))}setImportConfig(t,i,c){this._checkLoaded();const f=this.getImportIndex(t),m=this.stylesheet.imports||[];if(f===-1)return this;i?m[f].config=i:delete m[f].config;const y=this.fragments[f];c&&y.style.stylesheet&&(y.style.stylesheet.schema=c);const w=y.style.stylesheet&&y.style.stylesheet.schema;return y.config=i,y.style.updateConfig(i,w),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const i=this.stylesheet.imports||[],c=this.getImportIndex(t);c!==-1&&(i.splice(c,1),this.fragments[c].style._remove(),this.fragments.splice(c,1),this._reloadImports())}getImportIndex(t){const i=(this.stylesheet.imports||[]).findIndex(c=>c.id===t);return i===-1&&this.fire(new s.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),i}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const i in this._mergedOtherSourceCaches){const c=this._mergedOtherSourceCaches[i];c&&t.push(c.getSource())}return t}getSource(t,i){const c=this.getSourceCache(t,i);return c&&c.getSource()}getLayerSource(t){const i=this.getLayerSourceCache(t);return i&&i.getSource()}getSourceCache(t,i){const c=s.C(t,i);return this._mergedOtherSourceCaches[c]}getLayerSourceCache(t){const i=s.C(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[i]:this._mergedOtherSourceCaches[i]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const i=[];return this._mergedOtherSourceCaches[t]&&i.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&i.push(this._mergedSymbolSourceCaches[t]),i}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const i in t){const c=t[i];c==="reload"?this.reloadSource(i):c==="clear"&&this.clearSource(i)}}updateLayers(t){const i=this._changes.getUpdatedPaintProperties();for(const c of i){const f=this.getLayer(c);f&&f.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t,this.scope)}getImages(t,i,c){this.imageManager.getImages(i.images,i.scope,c),this._updateTilesForChangedImages();const f=y=>{if(y){const w=i.images.map(S=>s.I.toString(S));y.setDependencies(i.tileID.key,i.type,w)}},m=s.C(i.source,i.scope);f(this._mergedOtherSourceCaches[m]),f(this._mergedSymbolSourceCaches[m])}rasterizeImages(t,i,c){this.imageManager.rasterizeImages(i,c)}getGlyphs(t,i,c){this.glyphManager.getGlyphs(i.stacks,i.scope,c)}getResource(t,i,c){return s.dg(i,c)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const i=[];return this._otherSourceCaches[t]&&i.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&i.push(this._symbolSourceCaches[t]),i}_isSourceCacheLoaded(t){const i=this.getOwnSourceCaches(t);return i.length===0?(this.fire(new s.z(new Error(`There is no source with ID '${t}'`))),!1):i.every(c=>c.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,i){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const c=t.type==="fill-extrusion"&&t.sourceLayer==="building",f=t.type==="building";if(t.is3D(!!this.terrain)){if(c||f||i&&i.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}qs.getSourceType=function(l){return ad[l]},qs.setSourceType=function(l,t){ad[l]=t},qs.registerForPluginStateChange=s.dh;var Ih=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,rc=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Ah=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,ja="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",nc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,_d=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,jc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Os=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Cu=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Ct=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Mu=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Vc=[];Ss(Ih,Vc),Ss(Ah,Vc),Ss(rc,Vc);const Uc={"_prelude_fog.vertex.glsl":_d,"_prelude_terrain.vertex.glsl":nc,"_prelude_shadow.vertex.glsl":Ct,"_prelude_fog.fragment.glsl":jc,"_prelude_shadow.fragment.glsl":Mu,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Os,"_prelude_raster_particle.glsl":Cu},Pu={};tn("",nc),tn(jc,_d),tn(Mu,Ct),tn(Os,""),tn(Cu,"");const Ru=tn(rc,Ah),Ia=Ih;var Ch={background:tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:tn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:tn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:tn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:tn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:tn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:tn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:tn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:tn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:tn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:tn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:tn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:tn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:tn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:tn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:tn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:tn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:tn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:tn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:tn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ja),skyboxGradient:tn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ja),skyboxCapture:tn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:tn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:tn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:tn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:tn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:tn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:tn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:tn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ss(l,t){const i=l.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let c of i)if(c=c.trim(),c[0]==="#"&&c.includes("if")&&!c.includes("endif")){c=c.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const f=c.split(" ");for(const m of f)t.includes(m)||t.push(m)}}function tn(l,t){const i=/#include\s+"([^"]+)"/g,c=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let f=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);f&&(f=f.map(M=>{const P=M.split(" ");return P[P.length-1]}),f=[...new Set(f)]);const m={},y=[],w=[];if(l=l.replace(i,(M,P)=>(w.push(P),"")),(t=t.replace(i,(M,P)=>(y.push(P),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let S=[...Vc];Ss(l,S),Ss(t,S);for(const M of[...y,...w])Uc[M]||console.error(`Undefined include: ${M}`),Pu[M]||(Pu[M]=[],Ss(Uc[M],Pu[M])),S=[...S,...Pu[M]];return{fragmentSource:l=l.replace(c,(M,P,O,D,F)=>(m[F]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${F}
in ${O} ${D} ${F};
#else
uniform ${O} ${D} u_${F};
#endif
`:P==="initialize"?`
#ifdef HAS_UNIFORM_u_${F}
    ${O} ${D} ${F} = u_${F};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    in ${O} ${D} ${F};
#endif
`:P==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(c,(M,P,O,D,F)=>{const q=D==="float"?"vec2":D,V=F.match(/color/)?"color":q;return P==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${F}
in ${O} ${D} a_${F};
#endif
`:m[F]?P==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${O} ${q} a_${F};
out ${O} ${D} ${F};
#else
uniform ${O} ${D} u_${F};
#endif
`:P==="initialize"?V==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${O} ${D} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${V}(a_${F}, u_${F}_t);
#else
    ${O} ${D} ${F} = u_${F};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    in ${O} ${D} a_${F};
    out ${O} ${D} ${F};
#endif
`:P==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    ${F} = a_${F};
#endif
`:void 0:P==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${O} ${q} a_${F};
#else
uniform ${O} ${D} u_${F};
#endif
`:P==="define-instanced"?V==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${F}0;
in vec4 a_${F}1;
in vec4 a_${F}2;
in vec4 a_${F}3;
#else
uniform ${O} ${D} u_${F};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${O} ${q} a_${F};
#else
uniform ${O} ${D} u_${F};
#endif
`:P==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    ${O} ${D} ${F} = a_${F};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${O} ${D} ${F} = a_${F};
#else
    ${O} ${D} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${O} ${D} ${F} = unpack_mix_${V}(a_${F}, u_${F}_t);
#else
    ${O} ${D} ${F} = u_${F};
#endif
`}),staticAttributes:f,usedDefines:S,vertexIncludes:y,fragmentIncludes:w}}class ic{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,i,c,f,m,y,w,S){this.context=t;let M=this.boundPaintVertexBuffers.length!==f.length;for(let O=0;!M&&O<f.length;O++)this.boundPaintVertexBuffers[O]!==f[O]&&(M=!0);let P=this.boundDynamicVertexBuffers.length!==w.length;for(let O=0;!P&&O<w.length;O++)this.boundDynamicVertexBuffers[O]!==w[O]&&(P=!0);if(!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==c||M||P||this.boundIndexBuffer!==m||this.boundVertexOffset!==y)this.freshBind(i,c,f,m,y,w,S);else{t.bindVertexArrayOES.set(this.vao);for(const O of w)O&&(O.bind(),S&&O.instanceCount&&O.setVertexAttribDivisor(t.gl,i,S));m&&m.dynamicDraw&&m.bind()}}freshBind(t,i,c,f,m,y,w){const S=t.numAttributes,M=this.context,P=M.gl;this.vao&&this.destroy(),this.vao=M.gl.createVertexArray(),M.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=f,this.boundVertexOffset=m,this.boundDynamicVertexBuffers=y,i.enableAttributes(P,t),i.bind(),i.setVertexAttribPointers(P,t,m);for(const O of c)O.enableAttributes(P,t),O.bind(),O.setVertexAttribPointers(P,t,m);for(const O of y)O&&(O.enableAttributes(P,t),O.bind(),O.setVertexAttribPointers(P,t,m),w&&O.instanceCount&&O.setVertexAttribDivisor(P,t,w));f&&f.bind(),M.currentNumAttributes=S}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function vm(l,t){const i=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new s.ac(0,c/i).toLngLat().lat,new s.ac(0,(c+1)/i).toLngLat().lat]}function xm(l,t,i,c,f,m,y){const w=l.context,S=w.gl,M=i.hillshadeFBO;if(!M)return;l.prepareDrawTile();const P=l.isTileAffectedByFog(t),O=l.getOrCreateProgram("hillshade",{overrideFog:P});w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,M.colorAttachment.get());const D=((W,X,J,se)=>{const le=J.paint.get("hillshade-shadow-color"),ge=J.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",_e=J.paint.get("hillshade-highlight-color"),pe=J.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ue=J.paint.get("hillshade-accent-color"),ye=J.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",xe=J.paint.get("hillshade-emissive-strength");let Pe=s.al(J.paint.get("hillshade-illumination-direction"));if(J.paint.get("hillshade-illumination-anchor")==="viewport")Pe-=W.transform.angle;else if(W.style&&W.style.enable3dLights()&&W.style.directionalLight){const Ye=W.style.directionalLight.properties.get("direction"),Xe=s.cR(Ye.x,Ye.y,Ye.z);Pe=s.al(Xe[1])}const Le=!W.options.moving;return{u_matrix:se||W.transform.calculateProjMatrix(X.tileID.toUnwrapped(),Le),u_image:0,u_latrange:vm(0,X.tileID),u_light:[J.paint.get("hillshade-exaggeration"),Pe],u_shadow:le.toPremultipliedRenderColor(ge?null:J.lut),u_highlight:_e.toPremultipliedRenderColor(pe?null:J.lut),u_emissive_strength:xe,u_accent:ue.toPremultipliedRenderColor(ye?null:J.lut)}})(l,i,c,l.terrain?t.projMatrix:null);l.uploadCommonUniforms(w,O,t.toUnwrapped());const{tileBoundsBuffer:F,tileBoundsIndexBuffer:q,tileBoundsSegments:V}=l.getTileBoundsBuffers(i);O.draw(l,S.TRIANGLES,f,m,y,ar.disabled,D,c.id,F,q,V)}function sc(l,t,i){if(!t.needsDEMTextureUpload)return;const c=l.context,f=c.gl;c.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||l.getTileTexture(i.stride);const m=i.getPixels();t.demTexture?t.demTexture.update(m,{premultiply:!1}):t.demTexture=new s.T(c,m,f.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function wm(l,t,i){const c=l.context,f=c.gl;if(!t.dem)return;const m=t.dem;if(c.activeTexture.set(f.TEXTURE1),sc(l,t,m),!t.demTexture)return;t.demTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE);const y=m.dim;c.activeTexture.set(f.TEXTURE0);let w=t.hillshadeFBO;if(!w){const D=new s.T(c,{width:y,height:y,data:null},f.RGBA8);D.bind(f.LINEAR,f.CLAMP_TO_EDGE),w=t.hillshadeFBO=c.createFramebuffer(y,y,!0,"renderbuffer"),w.colorAttachment.set(D.texture)}c.bindFramebuffer.set(w.framebuffer),c.viewport.set([0,0,y,y]);const{tileBoundsBuffer:S,tileBoundsIndexBuffer:M,tileBoundsSegments:P}=l.getMercatorTileBoundsBuffers(),O=[];l.linearFloatFilteringSupported()&&O.push("TERRAIN_DEM_FLOAT_FORMAT"),l.getOrCreateProgram("hillshadePrepare",{defines:O}).draw(l,f.TRIANGLES,Bt.disabled,ur.disabled,Gr.unblended,ar.disabled,((D,F)=>{const q=F.stride,V=s.bz();return s.c5(V,0,s.aj,-8192,0,0,1),s.bo(V,V,[0,-8192,0]),{u_matrix:V,u_image:1,u_dimension:[q,q],u_zoom:D.overscaledZ}})(t.tileID,m),i.id,S,M,P),t.needsHillshadePrepare=!1}class di{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class bf extends di{getDefault(){return s.am.transparent.toNonPremultipliedRenderColor(null)}set(t){const i=this.current;(t.r!==i.r||t.g!==i.g||t.b!==i.b||t.a!==i.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class zi extends di{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Tf extends di{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class yd extends di{getDefault(){return[!0,!0,!0,!0]}set(t){const i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Mh extends di{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class wp extends di{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class vd extends di{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const i=this.current;(t.func!==i.func||t.ref!==i.ref||t.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Ph extends di{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class $c extends di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;t?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=t,this.dirty=!1}}class zu extends di{getDefault(){return[0,1]}set(t){const i=this.current;(t[0]!==i[0]||t[1]!==i[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Sf extends di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;t?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=t,this.dirty=!1}}class Ef extends di{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class xd extends di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;t?i.enable(i.BLEND):i.disable(i.BLEND),this.current=t,this.dirty=!1}}class wd extends di{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Va extends di{getDefault(){return s.am.transparent.toNonPremultipliedRenderColor(null)}set(t){const i=this.current;(t.r!==i.r||t.g!==i.g||t.b!==i.b||t.a!==i.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class bl extends di{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class ku extends di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;t?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=t,this.dirty=!1}}class Du extends di{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class oc extends di{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let bd=class extends di{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}};class If extends di{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Af extends di{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Lu extends di{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Td extends di{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ou extends di{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.bindTexture(i.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Ua extends di{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Rh extends di{getDefault(){return null}set(t){const i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class $a extends di{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Aa extends di{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Fu extends di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ga extends di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class qa extends di{constructor(t,i){super(t),this.context=t,this.parent=i}getDefault(){return null}}class bp extends qa{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Tp extends qa{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,this.attachment(),i.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Gc extends qa{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,this.attachment(),i.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class zh extends Tp{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const ac=(l,t,i)=>({u_matrix:l,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:i}),qc=(l,t,i,c,f,m,y,w,S,M,P,O,D,F,q,V)=>({u_proj_matrix:Float32Array.from(l),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(c),u_merc_matrix:i,u_zoom_transition:f,u_merc_center:m,u_image0:0,u_frustum_tl:y,u_frustum_tr:w,u_frustum_br:S,u_frustum_bl:M,u_globe_pos:P,u_globe_radius:O,u_viewport:D,u_grid_matrix:V?Float32Array.from(V):new Float32Array(9),u_skirt_height:F,u_far_z_cutoff:q});function Nu(l,t){return l!=null&&t!=null&&!(!l.hasData()||!t.hasData())&&l.demTexture!=null&&t.demTexture!=null&&l.tileID.key!==t.tileID.key}const Jo=new class{constructor(){this.operations={}}newMorphing(l,t,i,c,f){if(l in this.operations){const m=this.operations[l];m.to.tileID.key!==i.tileID.key&&(m.queued=i)}else this.operations[l]={startTime:c,phase:0,duration:f,from:t,to:i,queued:null}}getMorphValuesForProxy(l){if(!(l in this.operations))return null;const t=this.operations[l];return{from:t.from,to:t.to,phase:t.phase}}update(l){for(const t in this.operations){const i=this.operations[t];for(i.phase=(l-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,l)){delete this.operations[t];break}}}_nextOp(l,t){return!!l.queued&&(l.from=l.to,l.to=l.queued,l.queued=null,l.phase=0,l.startTime=t,!0)}_validOp(l){return l.from.hasData()&&l.to.hasData()}},Ha={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ki(l,t,i){if(t===0)return 0;const c=t<1&&i===514?.25/t:1;return 6*Math.pow(1.5,22-l)*Math.max(t,1)*c}function Di(l,t){const i=1<<l.z;return!t&&(l.x===0||l.x===i-1)||l.y===0||l.y===i-1}const Do=l=>({u_matrix:l});function Ki(l,t,i,c,f){if(f>0){const m=s.q.now(),y=(m-l.timeAdded)/f,w=t?(m-t.timeAdded)/f:-1,S=i.getSource(),M=c.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),P=!t||Math.abs(t.tileID.overscaledZ-M)>Math.abs(l.tileID.overscaledZ-M),O=P&&l.refreshedUponExpiration?1:s.ay(P?y:1-w,0,1);return l.refreshedUponExpiration&&y>=1&&(l.refreshedUponExpiration=!1),t?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}class _o extends Ls{constructor(t){const i={type:"raster-dem",maxzoom:t.transform.maxZoom},c=new s.D(s.c$(),null),f=Gl("mock-dem",i,c,t.style);super("mock-dem",f,!1),f.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,i){t.state="loaded",i(null)}}class Es extends Ls{constructor(t){const i=Gl("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new s.D(s.c$(),null),t.style);super("proxy",i,!1),i.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,i,c){if(t.freezeTileCoverage)return;this.transform=t;const f=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((m,y)=>{if(m[y.key]="",!this._tiles[y.key]){const w=new Wl(y,this._source.tileSize*y.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);w.state="loaded",this._tiles[y.key]=w}return m},{});for(const m in this._tiles)m in f||(this.freeFBO(m),this._tiles[m].unloadVectorData(),delete this._tiles[m])}freeFBO(t){const i=this.proxyCachedFBO[t];if(i!==void 0){const c=Object.values(i);this.renderCachePool.push(...c),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Tl extends s.aM{constructor(t,i,c){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=i,this.projMatrix=c}}class Fs extends s.dt{constructor(t,i){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[c,f,m]=function(S){const M=new s.ba,P=new s.a_,O=131;M.reserve(17161),P.reserve(33800);const D=s.aj/128,F=s.aj+D/2,q=F+D;for(let W=-64;W<q;W+=D)for(let X=-64;X<q;X+=D){const J=X<0||X>F||W<0||W>F?24575:0,se=s.ay(Math.round(X),0,s.aj),le=s.ay(Math.round(W),0,s.aj);M.emplaceBack(se+J,le)}const V=(W,X)=>{const J=X*O+W;P.emplaceBack(J+1,J,J+O),P.emplaceBack(J+O,J+O+1,J+1)};for(let W=1;W<129;W++)for(let X=1;X<129;X++)V(X,W);return[0,129].forEach(W=>{for(let X=0;X<130;X++)V(X,W),V(W,X)}),[M,P,32768]}(),y=t.context;this.gridBuffer=y.createVertexBuffer(c,s.bc.members),this.gridIndexBuffer=y.createIndexBuffer(f),this.gridSegments=s.bd.simpleSegment(0,0,c.length,f.length),this.gridNoSkirtSegments=s.bd.simpleSegment(0,0,c.length,m),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Es(i.map),this.orthoMatrix=s.bz(),s.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.aj,0,s.aj,0,1);const w=y.gl;this._overlapStencilMode=new ur({func:w.GEQUAL,mask:255},0,255,w.KEEP,w.KEEP,w.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new _o(i.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,i,c){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const f=t.terrain.properties,m=t.terrain.drapeRenderMode===0,y=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.q.now();const w=t.terrain&&t.terrain.scope,S=f.get("source"),M=m?this._mockSourceCache:t.getSourceCache(S,w);if(!M)return void s.w(`Couldn't find terrain source "${S}".`);if(this.sourceCache=M,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=y?this.calculateExaggeration(i):f.get("exaggeration"),!i.projection.requiresDraping&&y&&this._exaggeration===0)return void this._disable();this.enabled=!0;const P=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const O=this.getScaledDemTileSize();this.sourceCache.update(i,O,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,P(),this._initializing=!0),P(),i.updateElevation(!0,c),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0,this._previousZoom=i.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const i=this._previousCameraAltitude,c=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=c;const f=i!=null?c-i:Number.MAX_VALUE;if(Math.abs(f)<2)return this._exaggeration;const m=t.zoom,y=this._style.terrain;if(!this._previousUpdateTimestamp)return y.getExaggeration(m);let w=m-this._previousZoom;const S=this._previousUpdateTimestamp;let M=m;this._evaluationZoom!=null&&(M=this._evaluationZoom,Math.abs(m-M)>.5&&(w=.5*(m-M+w)),w*f<0&&(M+=w)),this._evaluationZoom=M;const P=y.getExaggeration(M),O=P===y.getExaggeration(Math.max(0,M-.1));if(O&&Math.abs(P-this._exaggeration)<.01)return P;let D=Math.min(.1,.00375*(this._updateTimestamp-S));return(O||P<.1||Math.abs(w)<1e-4)&&(D=Math.min(.2,4*D)),s.ai(this._exaggeration,P,D)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,c=this.painter.transform;this._initializing&&(this._initializing=c._centerAltitude===0&&this.getAtPointOrZero(s.ac.fromLngLat(c.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const f=this.proxyCoords=i.getIds().map(S=>{const M=i.getTileByID(S).tileID;return M.projMatrix=c.calculateProjMatrix(M.toUnwrapped()),M});(function(S,M){const P=M.transform.pointCoordinate(M.transform.getCameraPoint()),O=new s.P(P.x,P.y);S.sort((D,F)=>{if(F.overscaledZ-D.overscaledZ)return F.overscaledZ-D.overscaledZ;const q=new s.P(D.canonical.x+(1<<D.canonical.z)*D.wrap,D.canonical.y),V=new s.P(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),W=O.mult(1<<D.canonical.z);return W.x-=.5,W.y-=.5,W.distSqr(q)-W.distSqr(V)})})(f,this.painter);const m=this.proxyToSource||{};this.proxyToSource={},f.forEach(S=>{this.proxyToSource[S.key]={}}),this.terrainTileForTile={};const y=this._style._mergedSourceCaches;for(const S in y){const M=y[S];if(!M.used||(M!==this.sourceCache&&this.resetTileLookupCache(M.id),this._setupProxiedCoordsForOrtho(M,t[S],m),M.usedForTerrain))continue;const P=t[S];M.getSource().reparseOverscaled&&this._assignTerrainTiles(P)}this.proxiedCoords[i.id]=f.map(S=>new Tl(S,S.key,this.orthoMatrix)),this._assignTerrainTiles(f),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(m),this.renderingToTexture=!1;const w={};this._visibleDemTiles=[];for(const S of this.proxyCoords){const M=this.terrainTileForTile[S.key];if(!M)continue;const P=M.tileID.key;P in w||(this._visibleDemTiles.push(M),w[P]=P)}}_assignTerrainTiles(t){this._initializing||t.forEach(i=>{if(this.terrainTileForTile[i.key])return;const c=this._findTileCoveringTileID(i,this.sourceCache);c&&(this.terrainTileForTile[i.key]=c)})}_prepareDEMTextures(){const t=this.painter.context,i=t.gl;for(const c in this.terrainTileForTile){const f=this.terrainTileForTile[c],m=f.dem;!m||f.demTexture&&!f.needsDEMTextureUpload||(t.activeTexture.set(i.TEXTURE1),sc(this.painter,f,m))}}_prepareDemTileUniforms(t,i,c,f){if(!i||i.demTexture==null)return!1;const m=t.tileID.canonical,y=Math.pow(2,i.tileID.canonical.z-m.z),w=f||"";return c[`u_dem_tl${w}`]=[m.x*y%1,m.y*y%1],c[`u_dem_scale${w}`]=y,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const i=this._visibleDemTiles.reduce((c,f)=>{if(!f.dem)return c;const m=f.dem.tree.minimums[0];return m>0&&t++,c+m},0);return t?i/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,i=t.gl;t.activeTexture.set(i.TEXTURE2);const c=this._getLoadedAreaMinimum(),f=new s.du({width:1,height:1},new Float32Array([c]));this._emptyDEMTextureDirty=!1;let m=this._emptyDEMTexture;return m?m.update(f,{premultiply:!1}):m=this._emptyDEMTexture=new s.T(t,f,i.R32F,{premultiply:!1}),m}setupElevationDraw(t,i,c){const f=this.painter.context,m=f.gl,y={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};y.u_exaggeration=this.exaggeration();let w=null,S=null,M=1;if(c&&c.morphing&&this._useVertexMorphing){const F=c.morphing.srcDemTile,q=c.morphing.dstDemTile;M=c.morphing.phase,F&&q&&(this._prepareDemTileUniforms(t,F,y,"_prev")&&(S=F),this._prepareDemTileUniforms(t,q,y)&&(w=q))}const P=F=>F&&F.demTexture&&this.painter.linearFloatFilteringSupported()?m.LINEAR:m.NEAREST;let O=null;var D;if(this.enabled?S&&w?(O=w.demTexture,f.activeTexture.set(m.TEXTURE4),S.demTexture.bind(P(S),m.CLAMP_TO_EDGE),y.u_dem_lerp=M):(w=this.terrainTileForTile[t.tileID.key],O=this._prepareDemTileUniforms(t,w,y)?w.demTexture:this.emptyDEMTexture):O=this.emptyDEMTexture,f.activeTexture.set(m.TEXTURE2),O&&(y.u_dem_size=(D=O).size[0]===1?1:D.size[0]-2,O.bind(P(w),m.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(c&&c.useDepthForOcclusion,i,y),c&&c.useMeterToDem&&w){const F=(1<<w.tileID.canonical.z)*s.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;y.u_meter_to_dem=F}if(c&&c.labelPlaneMatrixInv&&(y.u_label_plane_matrix_inv=c.labelPlaneMatrixInv),i.setTerrainUniformValues(f,y),this.painter.transform.projection.name==="globe"){const F=this.globeUniformValues(this.painter.transform,t.tileID.canonical,c&&c.useDenormalizedUpVectorScale);i.setGlobeUniformValues(f,F)}}globeUniformValues(t,i,c){const f=t.projection;return{u_tile_tl_up:f.upVector(i,0,0),u_tile_tr_up:f.upVector(i,s.aj,0),u_tile_br_up:f.upVector(i,s.aj,s.aj),u_tile_bl_up:f.upVector(i,0,s.aj),u_tile_up_scale:c?s.dv(1):f.upVectorScale(i,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const i=this.painter,c=this.painter.context;t.length!==0&&(c.bindFramebuffer.set(null),c.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(f,m,y,w,S){if(f.transform.projection.name==="globe")(function(M,P,O,D,F){const q=M.context,V=q.gl;let W,X;const J=M.transform,se=s.dl(M,q,J),le=(Ye,Xe)=>{if(X===Xe)return;const ot=[Ha[Xe],"PROJECTION_GLOBE_VIEW"];se&&ot.push("CUSTOM_ANTIALIASING");const ze=M.isTileAffectedByFog(Ye);W=M.getOrCreateProgram("globeRaster",{defines:ot,overrideFog:ze}),X=Xe},ge=M.colorModeForRenderPass(),_e=new Bt(V.LEQUAL,Bt.ReadWrite,M.depthRangeFor3D);Jo.update(F);const pe=s.dm(J),ue=[s.aD(J.center.lng),s.aH(J.center.lat)],ye=M.globeSharedBuffers,xe=[J.width*s.q.devicePixelRatio,J.height*s.q.devicePixelRatio],Pe=Float32Array.from(J.globeMatrix),Le={useDenormalizedUpVectorScale:!0};{const Ye=M.transform,Xe=ki(Ye.zoom,P.exaggeration(),P.sourceCache._source.tileSize);X=-1;const ot=V.TRIANGLES;for(const ze of D){const $e=O.getTile(ze),Ie=ur.disabled,Je=P.prevTerrainTileForTile[ze.key],Ve=P.terrainTileForTile[ze.key];Nu(Je,Ve)&&Jo.newMorphing(ze.key,Je,Ve,F,250),q.activeTexture.set(V.TEXTURE0),$e.texture&&$e.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const st=Jo.getMorphValuesForProxy(ze.key),vt=st?1:0;st&&s.L(Le,{morphing:{srcDemTile:st.from,dstDemTile:st.to,phase:s.dk(st.phase)}});const Qe=s.dn(ze.canonical),pt=s.dp(Qe.getCenter().lat),Pt=s.dq(ze.canonical,Qe,pt,Ye.worldSize/Ye._pixelsPerMercatorPixel),Lt=s.bh(s.dr(ze.canonical)),Mt=qc(Ye.expandedFarZProjMatrix,Pe,pe,Lt,s.ah(Ye.zoom),ue,Ye.frustumCorners.TL,Ye.frustumCorners.TR,Ye.frustumCorners.BR,Ye.frustumCorners.BL,Ye.globeCenterInViewSpace,Ye.globeRadius,xe,Xe,Ye._farZ,Pt);if(le(ze,vt),W&&(P.setupElevationDraw($e,W,Le),M.uploadCommonUniforms(q,W,ze.toUnwrapped()),ye)){const[Nt,er,nr]=ye.getGridBuffers(pt,Xe!==0);W.draw(M,ot,_e,Ie,ge,ar.backCCW,Mt,"globe_raster",Nt,er,nr)}}}if(ye&&(M.renderDefaultNorthPole||M.renderDefaultSouthPole)){const Ye=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];se&&Ye.push("CUSTOM_ANTIALIASING"),W=M.getOrCreateProgram("globeRaster",{defines:Ye});for(const Xe of D){const{x:ot,y:ze,z:$e}=Xe.canonical,Ie=ze===0,Je=ze===(1<<$e)-1,[Ve,st,vt,Qe]=ye.getPoleBuffers($e,!1);if(Qe&&(Ie||Je)){const pt=O.getTile(Xe);q.activeTexture.set(V.TEXTURE0),pt.texture&&pt.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);let Pt=s.ds($e,ot,J);const Lt=s.bh(s.dr(Xe.canonical)),Mt=(Nt,er)=>Nt.draw(M,V.TRIANGLES,_e,ur.disabled,ge,ar.disabled,qc(J.expandedFarZProjMatrix,Pt,Pt,Lt,0,ue,J.frustumCorners.TL,J.frustumCorners.TR,J.frustumCorners.BR,J.frustumCorners.BL,J.globeCenterInViewSpace,J.globeRadius,xe,0,J._farZ),"globe_pole_raster",er,vt,Qe);P.setupElevationDraw(pt,W,Le),M.uploadCommonUniforms(q,W,Xe.toUnwrapped()),Ie&&M.renderDefaultNorthPole&&Mt(W,Ve),Je&&M.renderDefaultSouthPole&&(Pt=s.cE(s.bz(),Pt,[1,-1,1]),Mt(W,st))}}}})(f,m,y,w,S);else{const M=f.context,P=M.gl;let O,D;const F=f.shadowRenderer,q=ko(f,f.longestCutoffRange),V=ge=>{if(D===ge)return;const _e=[];_e.push(Ha[ge]),q.shouldRenderCutoff&&_e.push("RENDER_CUTOFF"),F&&(_e.push("RENDER_SHADOWS","DEPTH_TEXTURE"),F.useNormalOffset&&_e.push("NORMAL_OFFSET")),O=f.getOrCreateProgram("terrainRaster",{defines:_e}),D=ge},W=f.colorModeForRenderPass(),X=new Bt(P.LEQUAL,Bt.ReadWrite,f.depthRangeFor3D);Jo.update(S);const J=f.transform,se=ki(J.zoom,m.exaggeration(),m.sourceCache._source.tileSize);let le=[0,0,0];if(F){const ge=f.style.directionalLight,_e=f.style.ambientLight;ge&&_e&&(le=xl(f.style,ge,_e))}{D=-1;const ge=P.TRIANGLES,[_e,pe]=[m.gridIndexBuffer,m.gridSegments];for(const ue of w){const ye=y.getTile(ue),xe=ur.disabled,Pe=m.prevTerrainTileForTile[ue.key],Le=m.terrainTileForTile[ue.key];Nu(Pe,Le)&&Jo.newMorphing(ue.key,Pe,Le,S,250),M.activeTexture.set(P.TEXTURE0),ye.texture&&ye.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE);const Ye=Jo.getMorphValuesForProxy(ue.key),Xe=Ye?1:0;let ot;Ye&&(ot={morphing:{srcDemTile:Ye.from,dstDemTile:Ye.to,phase:s.dk(Ye.phase)}});const ze=ac(ue.projMatrix,Di(ue.canonical,J.renderWorldCopies)?se/10:se,le);if(V(Xe),!O)continue;m.setupElevationDraw(ye,O,ot);const $e=ue.toUnwrapped();F&&F.setupShadows($e,O),f.uploadCommonUniforms(M,O,$e,null,q),O.draw(f,ge,X,xe,W,ar.backCCW,ze,"terrain_raster",m.gridBuffer,_e,pe)}}}}(i,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const i=this.painter,c=this.painter.context,f=this.proxySourceCache,m=this.proxiedCoords[f.id],y=this._drapedRenderBatches.shift(),w=i.style.order,S=[];let M=0;for(const P of m){const O=f.getTileByID(P.proxyTileKey),D=f.proxyCachedFBO[P.key]?f.proxyCachedFBO[P.key][t]:void 0,F=D!==void 0?f.renderCache[D]:this.pool[M++],q=D!==void 0;if(O.texture=F.tex,q&&!F.dirty){S.push(O.tileID);continue}let V;c.bindFramebuffer.set(F.fb.framebuffer),this.renderedToTile=!1,F.dirty&&(c.clear({color:s.am.transparent,stencil:0}),F.dirty=!1);for(let W=y.start;W<=y.end;++W){const X=i.style._mergedLayers[w[W]];if(X.isHidden(i.transform.zoom))continue;const J=i.style.getLayerSourceCache(X),se=J?this.proxyToSource[P.key][J.id]:[P];if(!se)continue;const le=se;c.viewport.set([0,0,F.fb.width,F.fb.height]),V!==(J?J.id:null)&&(this._setupStencil(F,se,X,J),V=J?J.id:null),i.renderLayer(i,J,X,le)}if(this._drapedRenderBatches.length===0)for(const W of this._pendingGroundEffectLayers){const X=i.style._mergedLayers[w[W]];if(X.isHidden(i.transform.zoom))continue;const J=i.style.getLayerSourceCache(X),se=J?this.proxyToSource[P.key][J.id]:[P];if(!se)continue;const le=se;c.viewport.set([0,0,F.fb.width,F.fb.height]),V!==(J?J.id:null)&&(this._setupStencil(F,se,X,J),V=J?J.id:null),i.renderLayer(i,J,X,le)}this.renderedToTile?(F.dirty=!0,S.push(O.tileID)):q||--M,M===5&&(M=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,c.bindFramebuffer.set(null),c.viewport.set([0,0,i.width,i.height]),y.end+1}postRender(){}isLayerOrderingCorrect(t){const i=t.order.length;let c=-1,f=i;for(let m=0;m<i;++m)this._style.isLayerDraped(t._mergedLayers[t.order[m]])?c=Math.max(c,m):f=Math.min(f,m);return f>c}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(i=>i.dem).forEach(i=>{t=Math.min(t,i.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,i,c){if(!this._visibleDemTiles)return null;const f=this._visibleDemTiles.filter(m=>m.dem).map(m=>{const y=m.tileID,w=1<<y.overscaledZ,{x:S,y:M}=y.canonical,P=S/w,O=(S+1)/w,D=M/w,F=(M+1)/w;return{minx:P,miny:D,maxx:O,maxy:F,t:m.dem.tree.raycastRoot(P,D,O,F,t,i,c),tile:m}});f.sort((m,y)=>(m.t!==null?m.t:Number.MAX_VALUE)-(y.t!==null?y.t:Number.MAX_VALUE));for(const m of f){if(m.t==null)return null;const y=m.tile.dem.tree.raycast(m.minx,m.miny,m.maxx,m.maxy,t,i,c);if(y!=null)return y}return null}_createFBO(){const t=this.painter.context,i=t.gl,c=this.drapeBufferSize;t.activeTexture.set(i.TEXTURE0);const f=new s.T(t,{width:c[0],height:c[1],data:null},i.RGBA8);f.bind(i.LINEAR,i.CLAMP_TO_EDGE);const m=t.createFramebuffer(c[0],c[1],!0,null);return m.colorAttachment.set(f.texture),m.depthAttachment=new zh(t,m.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,c[0],c[1]),this._stencilRef=0,m.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):m.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:m,tex:f,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const i=this._style._mergedLayers[t],c=i.isHidden(this.painter.transform.zoom);return i.type==="hillshade"||i.type==="custom"?!c&&i.shouldRedrape():!c&&i.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const c of this._style.getSources())if(c instanceof po){t=!0;break}if(!t)return;const i={};for(let c=0;c<this._style.order.length;++c){const f=this._style._mergedLayers[this._style.order[c]],m=this._style.getLayerSourceCache(f);if(m&&!i[m.id]&&!f.isHidden(this.painter.transform.zoom)&&f.type==="line"&&f.widthExpression()instanceof s.ab){i[m.id]=!0;for(const y of this.proxyCoords){const w=this.proxyToSource[y.key][m.id];if(w)for(const S of w)this._clearRenderCacheForTile(m.id,S)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const c in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[c]._source instanceof bs){t=!0;break}if(!t)return;const i={};for(let c=0;c<this._style.order.length;++c){const f=this._style._mergedLayers[this._style.order[c]],m=this._style.getLayerSourceCache(f);if(!m||i[m.id]||f.isHidden(this.painter.transform.zoom)||f.type!=="raster")continue;const y=f.paint.get("raster-fade-duration");for(const w of this.proxyCoords){const S=this.proxyToSource[w.key][m.id];if(S)for(const M of S){const P=Ki(m.getTile(M),m.findLoadedParent(M,0),m,this.painter.transform,y);(P.opacity!==1||P.mix!==0)&&this._clearRenderCacheForTile(m.id,M)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,i=t.length;if(i===0)return;const c=[];this._pendingGroundEffectLayers=[];let f,m=0,y=this._style._mergedLayers[t[m]];for(;!this._style.isLayerDraped(y)&&y.isHidden(this.painter.transform.zoom)&&++m<i;)y=this._style._mergedLayers[t[m]];for(;m<i;++m){const w=this._style._mergedLayers[t[m]];w.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(w)?f===void 0&&(f=m):(w.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(m),f!==void 0&&(c.push({start:f,end:m-1}),f=void 0)))}if(f!==void 0&&c.push({start:f,end:m-1}),c.length!==0){const w=c[c.length-1];this._pendingGroundEffectLayers.every(S=>S>w.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=c}_setupRenderCache(t){const i=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,i.renderCache.length>i.renderCachePool.length){const y=Object.values(i.proxyCachedFBO);i.proxyCachedFBO={};for(let w=0;w<y.length;++w){const S=Object.values(y[w]);i.renderCachePool.push(...S)}}return}this._clearRasterLayersFromRenderCache();const c=this.proxyCoords,f=this._tilesDirty;for(let y=c.length-1;y>=0;y--){const w=c[y];if(i.getTileByID(w.key),i.proxyCachedFBO[w.key]!==void 0){const S=t[w.key],M=this.proxyToSource[w.key];let P=0;for(const O in M){const D=M[O],F=S[O];if(!F||F.length!==D.length||D.some((q,V)=>q!==F[V]||f[O]&&f[O].hasOwnProperty(q.key))){P=-1;break}++P}for(const O in i.proxyCachedFBO[w.key])i.renderCache[i.proxyCachedFBO[w.key][O]].dirty=P<0||P!==Object.values(S).length}}const m=[...this._drapedRenderBatches];m.sort((y,w)=>w.end-w.start-(y.end-y.start));for(const y of m)for(const w of c){if(i.proxyCachedFBO[w.key])continue;let S=i.renderCachePool.pop();S===void 0&&i.renderCache.length<50&&(S=i.renderCache.length,i.renderCache.push(this._createFBO())),S!==void 0&&(i.proxyCachedFBO[w.key]={},i.proxyCachedFBO[w.key][y.start]=S,i.renderCache[S].dirty=!0)}this._tilesDirty={}}_setupStencil(t,i,c,f){if(!f||!this._sourceTilesOverlap[f.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const m=this.painter.context,y=m.gl;if(i.length<=1)return void(this._overlapStencilType=!1);let w;if(c.isTileClipped())w=i.length,this._overlapStencilMode.test={func:y.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(i[0].overscaledZ>i[i.length-1].overscaledZ))return void(this._overlapStencilType=!1);w=1,this._overlapStencilMode.test={func:y.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+w>255&&(m.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=w,this._overlapStencilMode.ref=this._stencilRef,c.isTileClipped()&&this._renderTileClippingMasks(i,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):ur.disabled}_renderTileClippingMasks(t,i){const c=this.painter,f=this.painter.context,m=f.gl;c._tileClippingMaskIDs={},f.setColorMode(Gr.disabled),f.setDepthMode(Bt.disabled);const y=c.getOrCreateProgram("clippingMask");for(const w of t){const S=c._tileClippingMaskIDs[w.key]=--i;y.draw(c,m.TRIANGLES,Bt.disabled,new ur({func:m.ALWAYS,mask:0},S,255,m.KEEP,m.KEEP,m.REPLACE),Gr.disabled,ar.disabled,Do(w.projMatrix),"$clipping",c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}pointCoordinate(t){const i=this.painter.transform;if(t.x<0||t.x>i.width||t.y<0||t.y>i.height)return null;const c=[t.x,t.y,1,1];s.aA(c,c,i.pixelMatrixInverse),s.cw(c,c,1/c[3]),c[0]/=i.worldSize,c[1]/=i.worldSize;const f=i._camera.position,m=s.c6(1,i.center.lat),y=[f[0],f[1],f[2]/m,0],w=s.cX([],c.slice(0,3),y);s.au(w,w);const S=this.raycast(y,w,this._exaggeration);return S!==null&&S?(s.bE(y,y,w,S),y[3]=y[2],y[2]*=m,y):null}_setupProxiedCoordsForOrtho(t,i,c){if(t.getSource()instanceof s.aP)return this._setupProxiedCoordsForImageSource(t,i,c);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const f=this.proxiedCoords[t.id]=[],m=this.proxyCoords;for(let S=0;S<m.length;S++){const M=m[S],P=this._findTileCoveringTileID(M,t);if(P){const O=this._createProxiedId(M,P,c[M.key]&&c[M.key][t.id]);f.push(O),this.proxyToSource[M.key][t.id]=[O]}}let y=!1;const w=new Set;for(let S=0;S<i.length;S++){const M=t.getTile(i[S]);if(!M||!M.hasData())continue;const P=this._findTileCoveringTileID(M.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==M.tileID.canonical.z){const O=this.proxyToSource[P.tileID.key][t.id],D=this._createProxiedId(P.tileID,M,c[P.tileID.key]&&c[P.tileID.key][t.id]);O?O.splice(O.length-1,0,D):this.proxyToSource[P.tileID.key][t.id]=[D];const F=this.proxyToSource[P.tileID.key][t.id];w.has(F)||w.add(F),f.push(D),y=!0}}if(this._sourceTilesOverlap[t.id]=y,y&&this._debugParams.sortTilesHiZFirst)for(const S of w)S.sort((M,P)=>P.overscaledZ-M.overscaledZ)}_setupProxiedCoordsForImageSource(t,i,c){if(!t.getSource().loaded())return;const f=this.proxiedCoords[t.id]=[],m=this.proxyCoords,y=t.getSource(),w=y.tileID;if(!w)return;const S=new s.P(w.x,w.y)._div(1<<w.z),M=y.coordinates.map(s.ac.fromLngLat).reduce((O,D)=>(O.min.x=Math.min(O.min.x,D.x-S.x),O.min.y=Math.min(O.min.y,D.y-S.y),O.max.x=Math.max(O.max.x,D.x-S.x),O.max.y=Math.max(O.max.y,D.y-S.y),O),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(O,D)=>{const F=O.wrap+O.canonical.x/(1<<O.canonical.z),q=O.canonical.y/(1<<O.canonical.z),V=s.aj/(1<<O.canonical.z),W=D.wrap+D.canonical.x/(1<<D.canonical.z),X=D.canonical.y/(1<<D.canonical.z);return F+V<W+M.min.x||F>W+M.max.x||q+V<X+M.min.y||q>X+M.max.y};for(let O=0;O<m.length;O++){const D=m[O];for(let F=0;F<i.length;F++){const q=t.getTile(i[F]);if(!q||!q.hasData()||P(D,q.tileID))continue;const V=this._createProxiedId(D,q,c[D.key]&&c[D.key][t.id]),W=this.proxyToSource[D.key][t.id];W?W.push(V):this.proxyToSource[D.key][t.id]=[V],f.push(V)}}}_createProxiedId(t,i,c){let f=this.orthoMatrix;if(c){const m=c.find(y=>y.key===i.tileID.key);if(m)return m}if(i.tileID.key!==t.key){const m=t.canonical.z-i.tileID.canonical.z;let y,w,S;f=s.bz();const M=i.tileID.wrap-t.wrap<<t.overscaledZ;m>0?(y=s.aj>>m,w=y*((i.tileID.canonical.x<<m)-t.canonical.x+M),S=y*((i.tileID.canonical.y<<m)-t.canonical.y)):(y=s.aj<<-m,w=s.aj*(i.tileID.canonical.x-(t.canonical.x+M<<-m)),S=s.aj*(i.tileID.canonical.y-(t.canonical.y<<-m))),s.c5(f,0,y,0,y,0,1),s.bo(f,f,[w,S,0])}return new Tl(i.tileID,t.key,f)}_findTileCoveringTileID(t,i){let c=i.getTile(t);if(c&&c.hasData())return c;const f=this._findCoveringTileCache[i.id],m=f[t.key];if(c=m?i.getTileByID(m):null,c&&c.hasData()||m===null)return c;let y=c?c.tileID:t,w=y.overscaledZ;const S=i.getSource().minzoom,M=[];if(!m){const O=i.getSource().maxzoom;if(t.canonical.z>=O){const D=t.canonical.z-O;i.getSource().reparseOverscaled?(w=Math.max(t.canonical.z+2,i.transform.tileZoom),y=new s.aM(w,t.wrap,O,t.canonical.x>>D,t.canonical.y>>D)):D!==0&&(w=O,y=new s.aM(w,t.wrap,O,t.canonical.x>>D,t.canonical.y>>D))}y.key!==t.key&&(M.push(y.key),c=i.getTile(y))}const P=O=>{M.forEach(D=>{f[D]=O}),M.length=0};for(w-=1;w>=S&&(!c||!c.hasData());w--){c&&P(c.tileID.key);const O=y.calculateScaledKey(w);if(c=i.getTileByID(O),c&&c.hasData())break;const D=f[O];if(D===null)break;D===void 0?M.push(O):c=i.getTileByID(D)}return P(c?c.tileID.key:null),c&&c.hasData()?c:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,i){let c=this._tilesDirty[t];c||(c=this._tilesDirty[t]={}),c[i.key]=!0}}function Hc(l,t,i){const c=function(w,S,M){const P=s.bG(S,w),O=s.bG(M,[.2126,.7152,.0722]),D=(q,V,W)=>(1-W)*q+W*V,F=D(1-.3*Math.min(O,1),1,Math.min(P+1,1));return D(.92,1,Math.asin(s.ay(S[2],-1,1))/Math.PI+.5)*F}(l,[0,0,1],t),f=[0,0,0];s.bY(f,i.slice(0,3),c);const m=[0,0,0];s.bY(m,t.slice(0,3),l[2]);const y=[0,0,0];return s.cV(y,f,m),s.cY(y)}const Sd=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Ed=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Wc{static cacheKey(t,i,c,f){let m=`${i}${f?f.cacheKey:""}`;for(const y of c)t.usedDefines.includes(y)&&(m+=`/${y}`);return m}constructor(t,i,c,f,m,y){const w=t.gl;this.program=w.createProgram(),this.configuration=f,this.name=i,this.fixedDefines=[...y];const S=f?f.getBinderAttributes():[],M=(c.staticAttributes||[]).concat(S);let P=f?f.defines():[];P=P.concat(y.map(W=>`#define ${W}`));const O=`#version 300 es
`;let D=O+P.concat("precision mediump float;",Ia,Ru.fragmentSource).join(`
`);for(const W of c.fragmentIncludes)D+=`
${Uc[W]}`;D+=`
${c.fragmentSource}`;let F=O+P.concat("precision highp float;",Ia,Ru.vertexSource).join(`
`);for(const W of c.vertexIncludes)F+=`
${Uc[W]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&c.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(F+=`
uniform int u_instanceID;
`),F+=`
${c.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(F=F.replaceAll("gl_InstanceID","u_instanceID"));const q=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);w.shaderSource(q,D),w.compileShader(q),w.attachShader(this.program,q);const V=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())this.failedToCreate=!0;else{w.shaderSource(V,F),w.compileShader(V),w.attachShader(this.program,V),this.attributes={},this.numAttributes=M.length;for(let W=0;W<this.numAttributes;W++)if(M[W]){const X=M[W].startsWith("a_")?M[W]:`a_${M[W]}`;w.bindAttribLocation(this.program,W,X),this.attributes[X]=W}w.linkProgram(this.program),w.deleteShader(V),w.deleteShader(q),this.fixedUniforms=m(t),this.binderUniforms=f?f.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(W=>({u_instanceID:new s.c8(W)}))(t)),(y.includes("TERRAIN")||i.indexOf("symbol")!==-1||i.indexOf("circle")!==-1)&&(this.terrainUniforms=(W=>({u_dem:new s.c8(W),u_dem_prev:new s.c8(W),u_dem_tl:new s.cb(W),u_dem_scale:new s.ca(W),u_dem_tl_prev:new s.cb(W),u_dem_scale_prev:new s.ca(W),u_dem_size:new s.ca(W),u_dem_lerp:new s.ca(W),u_exaggeration:new s.ca(W),u_depth:new s.c8(W),u_depth_size_inv:new s.cb(W),u_depth_range_unpack:new s.cb(W),u_occluder_half_size:new s.ca(W),u_occlusion_depth_offset:new s.ca(W),u_meter_to_dem:new s.ca(W),u_label_plane_matrix_inv:new s.cc(W)}))(t)),y.includes("GLOBE")&&(this.globeUniforms=(W=>({u_tile_tl_up:new s.c9(W),u_tile_tr_up:new s.c9(W),u_tile_br_up:new s.c9(W),u_tile_bl_up:new s.c9(W),u_tile_up_scale:new s.ca(W)}))(t)),y.includes("FOG")&&(this.fogUniforms=(W=>({u_fog_matrix:new s.cc(W),u_fog_range:new s.cb(W),u_fog_color:new s.cQ(W),u_fog_horizon_blend:new s.ca(W),u_fog_vertical_limit:new s.cb(W),u_fog_temporal_offset:new s.ca(W),u_frustum_tl:new s.c9(W),u_frustum_tr:new s.c9(W),u_frustum_br:new s.c9(W),u_frustum_bl:new s.c9(W),u_globe_pos:new s.c9(W),u_globe_radius:new s.ca(W),u_globe_transition:new s.ca(W),u_is_globe:new s.c8(W),u_viewport:new s.cb(W)}))(t)),y.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(W=>({u_cutoff_params:new s.cQ(W)}))(t)),y.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(W=>({u_lighting_ambient_color:new s.c9(W),u_lighting_directional_dir:new s.c9(W),u_lighting_directional_color:new s.c9(W),u_ground_radiance:new s.c9(W)}))(t)),y.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(W=>({u_light_matrix_0:new s.cc(W),u_light_matrix_1:new s.cc(W),u_fade_range:new s.cb(W),u_shadow_normal_offset:new s.c9(W),u_shadow_intensity:new s.ca(W),u_shadow_texel_size:new s.ca(W),u_shadow_map_resolution:new s.ca(W),u_shadow_direction:new s.c9(W),u_shadow_bias:new s.c9(W),u_shadowmap_0:new s.c8(W),u_shadowmap_1:new s.c8(W)}))(t))}}setTerrainUniformValues(t,i){if(!this.terrainUniforms)return;const c=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in i)c[f]&&c[f].set(this.program,f,i[f])}}setGlobeUniformValues(t,i){if(!this.globeUniforms)return;const c=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in i)c[f]&&c[f].set(this.program,f,i[f])}}setFogUniformValues(t,i){if(!this.fogUniforms)return;const c=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in i)c[f].set(this.program,f,i[f])}}setCutoffUniformValues(t,i){if(!this.cutoffUniforms)return;const c=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in i)c[f].set(this.program,f,i[f])}}setLightsUniformValues(t,i){if(!this.lightsUniforms)return;const c=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in i)c[f].set(this.program,f,i[f])}}setShadowUniformValues(t,i){if(this.failedToCreate||!this.shadowUniforms)return;const c=this.shadowUniforms;t.program.set(this.program);for(const f in i)c[f].set(this.program,f,i[f])}_drawDebugWireframe(t,i,c,f,m,y,w,S,M,P){const O=t.options.wireframe;if(O.terrain===!1&&O.layers2D===!1&&O.layers3D===!1)return;const D=t.context;if(!(!(!O.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!O.layers2D||t._terrain&&t._terrain.renderingToTexture||!Sd.includes(this.name))||!(!O.layers3D||!Ed.includes(this.name))))return;const F=D.gl,q=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,m,D);if(!q)return;const V=[...this.fixedDefines];V.push("DEBUG_WIREFRAME");const W=t.getOrCreateProgram(this.name,{config:this.configuration,defines:V});D.program.set(W.program);const X=(le,ge,_e)=>{if(ge[le]&&_e[le])for(const pe in ge[le])_e[le][pe]&&_e[le][pe].set(_e.program,pe,ge[le][pe].current)};M&&M.setUniforms(W.program,D,W.binderUniforms,w,{zoom:S}),X("fixedUniforms",this,W),X("terrainUniforms",this,W),X("globeUniforms",this,W),X("fogUniforms",this,W),X("lightsUniforms",this,W),X("shadowUniforms",this,W),q.bind(),D.setColorMode(new Gr([F.ONE,F.ONE_MINUS_SRC_ALPHA,F.ZERO,F.ONE],s.am.transparent,[!0,!0,!0,!1])),D.setDepthMode(new Bt(i.func===F.LESS?F.LEQUAL:i.func,Bt.ReadOnly,i.range)),D.setStencilMode(ur.disabled);const J=3*y.primitiveLength*2,se=3*y.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const le=P||1;for(let ge=0;ge<le;++ge)W.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ge),F.drawElements(F.LINES,J,F.UNSIGNED_SHORT,se)}else P&&P>1?F.drawElementsInstanced(F.LINES,J,F.UNSIGNED_SHORT,se,P):F.drawElements(F.LINES,J,F.UNSIGNED_SHORT,se);m.bind(),D.program.set(this.program),D.setDepthMode(i),D.setStencilMode(c),D.setColorMode(f)}checkUniforms(t,i,c){if(this.fixedDefines.includes(i)){for(const f of Object.keys(c))if(!c[f].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${f} not set but required by ${i} being defined`)}}draw(t,i,c,f,m,y,w,S,M,P,O,D,F,q,V,W){const X=t.context,J=X.gl;if(this.failedToCreate)return;X.program.set(this.program),X.setDepthMode(c),X.setStencilMode(f),X.setColorMode(m),X.setCullFace(y);for(const ge of Object.keys(this.fixedUniforms))this.fixedUniforms[ge].set(this.program,ge,w[ge]);q&&q.setUniforms(this.program,X,this.binderUniforms,D,{zoom:F});const se={[J.POINTS]:1,[J.LINES]:2,[J.TRIANGLES]:3,[J.LINE_STRIP]:1}[i];this.checkUniforms(S,"RENDER_SHADOWS",this.shadowUniforms);const le=W&&W>0?1:void 0;for(const ge of O.get()){const _e=ge.vaos||(ge.vaos={});if((_e[S]||(_e[S]=new ic)).bind(X,this,M,q?q.getPaintVertexBuffers():[],P,ge.vertexOffset,V||[],le),this.forceManualRenderingForInstanceIDShaders){const pe=W||1;for(let ue=0;ue<pe;++ue)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ue),P?J.drawElements(i,ge.primitiveLength*se,J.UNSIGNED_SHORT,ge.primitiveOffset*se*2):J.drawArrays(i,ge.vertexOffset,ge.vertexLength)}else W&&W>1?J.drawElementsInstanced(i,ge.primitiveLength*se,J.UNSIGNED_SHORT,ge.primitiveOffset*se*2,W):P?J.drawElements(i,ge.primitiveLength*se,J.UNSIGNED_SHORT,ge.primitiveOffset*se*2):J.drawArrays(i,ge.vertexOffset,ge.vertexLength);i===J.TRIANGLES&&P&&this._drawDebugWireframe(t,c,f,m,P,ge,D,F,q,W)}}}function Bu(l,t,i=0){const c=Math.pow(2,t.tileID.overscaledZ),f=t.tileSize*Math.pow(2,l.transform.tileZoom)/c,m=f*(t.tileID.canonical.x+t.tileID.wrap*c),y=f*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.aw(t,1,l.transform.tileZoom),u_pixel_coord_upper:[m>>16,y>>16],u_pixel_coord_lower:[65535&m,65535&y],u_pattern_transition:i}}const Lo={terrain:0,flat:1},ju=s.bz(),Zc=(l,t,i,c,f,m,y,w,S,M,P,O,D,F,q,V,W,X)=>{const J=t.style.light,se=J.properties.get("position"),le=[se.x,se.y,se.z],ge=s.dx();J.properties.get("anchor")==="viewport"&&(s.dy(ge,-t.transform.angle),s.dz(le,le,ge));const _e=J.properties.get("color").toPremultipliedRenderColor(null),pe=t.transform,ue={u_matrix:l,u_lightpos:le,u_lightintensity:J.properties.get("intensity"),u_lightcolor:[_e.r,_e.g,_e.b],u_vertical_gradient:+i,u_opacity:c,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ju,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Lo[M],u_base_type:Lo[P],u_ao:f,u_edge_radius:m,u_width_scale:y,u_flood_light_color:q,u_vertical_scale:V,u_flood_light_intensity:W,u_ground_shadow_factor:X};return pe.projection.name==="globe"&&(ue.u_tile_id=[w.canonical.x,w.canonical.y,1<<w.canonical.z],ue.u_zoom_transition=O,ue.u_inv_rot_matrix=F,ue.u_merc_center=D,ue.u_up_dir=pe.projection.upVector(new s.cp(0,0,0),D[0]*s.aj,D[1]*s.aj),ue.u_height_lift=S),ue},Cf=(l,t,i,c,f,m)=>({u_matrix:l,u_edge_radius:t,u_width_scale:i,u_vertical_scale:c,u_height_type:Lo[f],u_base_type:Lo[m]}),Sp=(l,t,i,c,f,m,y,w,S,M,P,O,D,F,q,V,W,X)=>{const J=Zc(l,t,i,c,f,m,y,w,M,P,O,D,F,q,V,W,1,[0,0,0]),se={u_height_factor:-Math.pow(2,w.overscaledZ)/S.tileSize/8};return s.h(J,Bu(t,S,X),se)},Oo=(l,t,i)=>({u_matrix:l,u_emissive_strength:t,u_ground_shadow_factor:i}),Xc=(l,t,i,c,f,m=0)=>s.h(Oo(l,t,f),Bu(i,c,m)),Vu=(l,t,i,c)=>({u_matrix:l,u_world:i,u_emissive_strength:t,u_ground_shadow_factor:c}),Id=(l,t,i,c,f,m,y=0)=>s.h(Xc(l,t,i,c,m,y),{u_world:f}),Ad=(l,t)=>({u_matrix:l,u_ground_shadow_factor:t}),yo=(l,t,i,c,f)=>({u_matrix:l,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:i,u_height_scale:c,u_reset_depth:f}),_a=(l,t,i,c)=>{const f=s.aj/i.tileSize;return{u_matrix:l,u_camera_to_center_distance:t.getCameraToCenterDistance(c),u_extrude_scale:[t.pixelsToGLUnits[0]/f,t.pixelsToGLUnits[1]/f]}},Wa=(l,t,i=1)=>({u_matrix:l,u_color:t,u_overlay:0,u_overlay_scale:i}),Ca=s.bz(),Za=(l,t,i,c,f,m,y)=>{const w=l.transform,S=w.projection.name==="globe",M=S?s.dA(w.zoom,t.canonical)*w._pixelsPerMercatorPixel:s.aw(i,1,m),P={u_matrix:t.projMatrix,u_extrude_scale:M,u_intensity:y,u_inv_rot_matrix:Ca,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){P.u_inv_rot_matrix=c,P.u_merc_center=f,P.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],P.u_zoom_transition=s.ah(w.zoom);const O=f[0]*s.aj,D=f[1]*s.aj;P.u_up_dir=w.projection.upVector(new s.cp(0,0,0),O,D)}return P};function Qo(l,[t,i,c,f],[m,y]){if(m===y)return[0,0,0,0];const w=255*(l-1)/(l*(y-m));return[t*w,i*w,c*w,f*w]}function Cd(l,t,[i,c]){return i===c?0:.5/l+(t-i)*(l-1)/(l*(c-i))}const kh=(l,t,i,c,f,m,y,w,S,M,P,O,D,F,q,V,W,X,J,se,le)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:i,u_merc_matrix:c,u_grid_matrix:f,u_tl_parent:m,u_scale_parent:M,u_fade_t:P.mix,u_opacity:P.opacity*O.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:O.paint.get("raster-brightness-min"),u_brightness_high:O.paint.get("raster-brightness-max"),u_saturation_factor:s.dC(O.paint.get("raster-saturation")),u_contrast_factor:s.dB(O.paint.get("raster-contrast")),u_spin_weights:Md(O.paint.get("raster-hue-rotate")),u_perspective_transform:D,u_raster_elevation:F,u_zoom_transition:y,u_merc_center:w,u_cutoff_params:S,u_colorization_mix:Qo(s.dD,V,X),u_colorization_offset:Cd(s.dD,W,X),u_color_ramp:q,u_texture_offset:[se/(J+2*se),J/(J+2*se)],u_texture_res:[J+2*se,J+2*se],u_emissive_strength:le});function Md(l){l*=Math.PI/180;const t=Math.sin(l),i=Math.cos(l);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}const fs=.05,Is=(l,t,i,c,f,m,y,w,S,M,P,O)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:i,u_merc_matrix:c,u_grid_matrix:f,u_tl_parent:m,u_scale_parent:M,u_fade_t:P.mix,u_opacity:P.opacity,u_image0:0,u_image1:1,u_raster_elevation:O,u_zoom_transition:y,u_merc_center:w,u_cutoff_params:S}),Ni=(l,t,i,c,f,m,y,w,S,M)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_tile_offset:i,u_velocity:c,u_color_ramp:m,u_velocity_res:f,u_max_speed:y,u_uv_offset:w,u_data_scale:[255*S[0],255*S[1]],u_data_offset:M,u_particle_pos_scale:1.1,u_particle_pos_offset:[fs,fs]}),Ns=(l,t,i,c,f,m,y,w,S,M)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_velocity:i,u_velocity_res:c,u_max_speed:f,u_speed_factor:m,u_reset_rate:y,u_rand_seed:Math.random(),u_uv_offset:w,u_data_scale:[255*S[0],255*S[1]],u_data_offset:M,u_particle_pos_scale:1.1,u_particle_pos_offset:[fs,fs]}),Dh=s.bz(),Uu=(l,t,i,c,f,m,y,w,S,M,P,O,D,F,q,V,W,X,J,se,le,ge,_e,pe)=>{const ue=f.transform,ye={u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ue.getCameraToCenterDistance(J),u_rotate_symbol:+i,u_aspect_ratio:ue.width/ue.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:m,u_label_plane_matrix:y,u_coord_matrix:w,u_is_text:+M,u_elevation_from_sea:S?1:0,u_pitch_with_map:+c,u_texsize:P,u_texsize_icon:O,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Dh,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Dh,u_up_vector:[0,-1,0],u_color_adj_mat:ge,u_icon_transition:_e||0,u_gamma_scale:c?f.transform.getCameraToCenterDistance(J)*Math.cos(f.terrain?0:f.transform._pitch):1,u_device_pixel_ratio:s.q.devicePixelRatio,u_is_halo:1,u_scale_factor:pe||1,u_ground_shadow_factor:se,u_inv_matrix:s.bi(s.bz(),y),u_normal_scale:le};return J.name==="globe"&&(ye.u_tile_id=[F.canonical.x,F.canonical.y,1<<F.canonical.z],ye.u_zoom_transition=q,ye.u_inv_rot_matrix=W,ye.u_merc_center=V,ye.u_camera_forward=ue._camera.forward(),ye.u_ecef_origin=s.dE(ue.globeMatrix,F.toUnwrapped()),ye.u_tile_matrix=Float32Array.from(ue.globeMatrix),ye.u_up_vector=X),ye},Lh=(l,t,i,c)=>({u_matrix:l,u_emissive_strength:t,u_opacity:i,u_color:c}),Oh=(l,t,i,c,f,m,y,w,S)=>s.h(function(M,P,O,D,F,q){const{width:V,height:W}=D.imageManager.getPixelSize(P),X=Math.pow(2,q.tileID.overscaledZ),J=q.tileSize*Math.pow(2,D.transform.tileZoom)/X,se=J*(q.tileID.canonical.x+q.tileID.wrap*X),le=J*q.tileID.canonical.y;return{u_image:0,u_pattern_tl:O.tl,u_pattern_br:O.br,u_texsize:[V,W],u_pattern_size:O.displaySize,u_pattern_units_to_pixels:F?[D.transform.width,-1*D.transform.height]:[1/s.aw(q,1,D.transform.tileZoom),1/s.aw(q,1,D.transform.tileZoom)],u_pixel_coord_upper:[se>>16,le>>16],u_pixel_coord_lower:[65535&se,65535&le]}}(0,m,y,c,w,S),{u_matrix:l,u_emissive_strength:t,u_opacity:i}),$u=new Float32Array(s.bx([])),lc=(l,t,i,c,f,m,y,w,S,M,P,O,D,F=[0,0,0],q)=>{const V=f.style.light,W=V.properties.get("position"),X=[-W.x,-W.y,W.z],J=s.dx();V.properties.get("anchor")==="viewport"&&(s.dy(J,-f.transform.angle),s.dz(X,X,J));const se=P.alphaMode==="MASK",le=V.properties.get("color").toNonPremultipliedRenderColor(null),ge=D.paint.get("model-ambient-occlusion-intensity"),_e=D.paint.get("model-color").constantOr(s.am.white).toNonPremultipliedRenderColor(null);return _e.a=D.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:l,u_lighting_matrix:t,u_normal_matrix:i,u_node_matrix:c||$u,u_lightpos:X,u_lightintensity:V.properties.get("intensity"),u_lightcolor:[le.r,le.g,le.b],u_camera_pos:F,u_opacity:m,u_baseTextureIsAlpha:0,u_alphaMask:+se,u_alphaCutoff:P.alphaCutoff,u_baseColorFactor:y.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:w.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:S,u_roughnessFactor:M,u_baseColorTexture:Qs.BaseColor,u_metallicRoughnessTexture:Qs.MetallicRoughness,u_normalTexture:Qs.Normal,u_occlusionTexture:Qs.Occlusion,u_emissionTexture:Qs.Emission,u_lutTexture:Qs.LUT,u_color_mix:_e.toArray01(),u_aoIntensity:ge,u_emissive_strength:O,u_occlusionTextureTransform:q||[0,0,0,0]}},Mf=(l,t=$u,i=$u)=>({u_matrix:l,u_instance:t,u_node_matrix:i}),Yc={fillExtrusion:l=>({u_matrix:new s.cc(l),u_lightpos:new s.c9(l),u_lightintensity:new s.ca(l),u_lightcolor:new s.c9(l),u_vertical_gradient:new s.ca(l),u_opacity:new s.ca(l),u_edge_radius:new s.ca(l),u_width_scale:new s.ca(l),u_ao:new s.cb(l),u_height_type:new s.c8(l),u_base_type:new s.c8(l),u_tile_id:new s.c9(l),u_zoom_transition:new s.ca(l),u_inv_rot_matrix:new s.cc(l),u_merc_center:new s.cb(l),u_up_dir:new s.c9(l),u_height_lift:new s.ca(l),u_flood_light_color:new s.c9(l),u_vertical_scale:new s.ca(l),u_flood_light_intensity:new s.ca(l),u_ground_shadow_factor:new s.c9(l)}),fillExtrusionDepth:l=>({u_matrix:new s.cc(l),u_edge_radius:new s.ca(l),u_width_scale:new s.ca(l),u_vertical_scale:new s.ca(l),u_height_type:new s.c8(l),u_base_type:new s.c8(l)}),fillExtrusionPattern:l=>({u_matrix:new s.cc(l),u_lightpos:new s.c9(l),u_lightintensity:new s.ca(l),u_lightcolor:new s.c9(l),u_vertical_gradient:new s.ca(l),u_height_factor:new s.ca(l),u_edge_radius:new s.ca(l),u_width_scale:new s.ca(l),u_ao:new s.cb(l),u_height_type:new s.c8(l),u_base_type:new s.c8(l),u_tile_id:new s.c9(l),u_zoom_transition:new s.ca(l),u_inv_rot_matrix:new s.cc(l),u_merc_center:new s.cb(l),u_up_dir:new s.c9(l),u_height_lift:new s.ca(l),u_image:new s.c8(l),u_texsize:new s.cb(l),u_pixel_coord_upper:new s.cb(l),u_pixel_coord_lower:new s.cb(l),u_tile_units_to_pixels:new s.ca(l),u_opacity:new s.ca(l),u_pattern_transition:new s.ca(l)}),fillExtrusionGroundEffect:l=>({u_matrix:new s.cc(l),u_opacity:new s.ca(l),u_ao_pass:new s.ca(l),u_meter_to_tile:new s.ca(l),u_ao:new s.cb(l),u_flood_light_intensity:new s.ca(l),u_flood_light_color:new s.c9(l),u_attenuation:new s.ca(l),u_edge_radius:new s.ca(l),u_fb:new s.c8(l),u_fb_size:new s.ca(l),u_dynamic_offset:new s.ca(l)}),fill:l=>({u_matrix:new s.cc(l),u_emissive_strength:new s.ca(l),u_ground_shadow_factor:new s.c9(l)}),fillPattern:l=>({u_matrix:new s.cc(l),u_emissive_strength:new s.ca(l),u_image:new s.c8(l),u_texsize:new s.cb(l),u_pixel_coord_upper:new s.cb(l),u_pixel_coord_lower:new s.cb(l),u_tile_units_to_pixels:new s.ca(l),u_ground_shadow_factor:new s.c9(l),u_pattern_transition:new s.ca(l)}),fillOutline:l=>({u_matrix:new s.cc(l),u_emissive_strength:new s.ca(l),u_world:new s.cb(l),u_ground_shadow_factor:new s.c9(l)}),fillOutlinePattern:l=>({u_matrix:new s.cc(l),u_emissive_strength:new s.ca(l),u_world:new s.cb(l),u_image:new s.c8(l),u_texsize:new s.cb(l),u_pixel_coord_upper:new s.cb(l),u_pixel_coord_lower:new s.cb(l),u_tile_units_to_pixels:new s.ca(l),u_ground_shadow_factor:new s.c9(l),u_pattern_transition:new s.ca(l)}),building:l=>({u_matrix:new s.cc(l),u_normal_matrix:new s.cc(l),u_opacity:new s.ca(l)}),buildingDepth:l=>({u_matrix:new s.cc(l)}),elevatedStructuresDepth:l=>({u_matrix:new s.cc(l),u_depth_bias:new s.ca(l)}),elevatedStructures:l=>({u_matrix:new s.cc(l),u_ground_shadow_factor:new s.c9(l)}),elevatedStructuresDepthReconstruct:l=>({u_matrix:new s.cc(l),u_camera_pos:new s.c9(l),u_depth_bias:new s.ca(l),u_height_scale:new s.ca(l),u_reset_depth:new s.ca(l)}),circle:s.dH,collisionBox:l=>({u_matrix:new s.cc(l),u_camera_to_center_distance:new s.ca(l),u_extrude_scale:new s.cb(l)}),collisionCircle:l=>({u_matrix:new s.cc(l),u_inv_matrix:new s.cc(l),u_camera_to_center_distance:new s.ca(l),u_viewport_size:new s.cb(l)}),debug:l=>({u_color:new s.di(l),u_matrix:new s.cc(l),u_overlay:new s.c8(l),u_overlay_scale:new s.ca(l)}),clippingMask:l=>({u_matrix:new s.cc(l)}),heatmap:l=>({u_extrude_scale:new s.ca(l),u_intensity:new s.ca(l),u_matrix:new s.cc(l),u_inv_rot_matrix:new s.cc(l),u_merc_center:new s.cb(l),u_tile_id:new s.c9(l),u_zoom_transition:new s.ca(l),u_up_dir:new s.c9(l)}),heatmapTexture:l=>({u_image:new s.c8(l),u_color_ramp:new s.c8(l),u_opacity:new s.ca(l)}),hillshade:l=>({u_matrix:new s.cc(l),u_image:new s.c8(l),u_latrange:new s.cb(l),u_light:new s.cb(l),u_shadow:new s.di(l),u_highlight:new s.di(l),u_emissive_strength:new s.ca(l),u_accent:new s.di(l)}),hillshadePrepare:l=>({u_matrix:new s.cc(l),u_image:new s.c8(l),u_dimension:new s.cb(l),u_zoom:new s.ca(l)}),line:s.dG,linePattern:s.dF,raster:l=>({u_matrix:new s.cc(l),u_normalize_matrix:new s.cc(l),u_globe_matrix:new s.cc(l),u_merc_matrix:new s.cc(l),u_grid_matrix:new s.dj(l),u_tl_parent:new s.cb(l),u_scale_parent:new s.ca(l),u_fade_t:new s.ca(l),u_opacity:new s.ca(l),u_image0:new s.c8(l),u_image1:new s.c8(l),u_brightness_low:new s.ca(l),u_brightness_high:new s.ca(l),u_saturation_factor:new s.ca(l),u_contrast_factor:new s.ca(l),u_spin_weights:new s.c9(l),u_perspective_transform:new s.cb(l),u_raster_elevation:new s.ca(l),u_zoom_transition:new s.ca(l),u_merc_center:new s.cb(l),u_cutoff_params:new s.cQ(l),u_colorization_mix:new s.cQ(l),u_colorization_offset:new s.ca(l),u_color_ramp:new s.c8(l),u_texture_offset:new s.cb(l),u_texture_res:new s.cb(l),u_emissive_strength:new s.ca(l)}),rasterParticle:l=>({u_matrix:new s.cc(l),u_normalize_matrix:new s.cc(l),u_globe_matrix:new s.cc(l),u_merc_matrix:new s.cc(l),u_grid_matrix:new s.dj(l),u_tl_parent:new s.cb(l),u_scale_parent:new s.ca(l),u_fade_t:new s.ca(l),u_opacity:new s.ca(l),u_image0:new s.c8(l),u_image1:new s.c8(l),u_raster_elevation:new s.ca(l),u_zoom_transition:new s.ca(l),u_merc_center:new s.cb(l),u_cutoff_params:new s.cQ(l)}),rasterParticleTexture:l=>({u_texture:new s.c8(l),u_opacity:new s.ca(l)}),rasterParticleDraw:l=>({u_particle_texture:new s.c8(l),u_particle_texture_side_len:new s.ca(l),u_tile_offset:new s.cb(l),u_velocity:new s.c8(l),u_color_ramp:new s.c8(l),u_velocity_res:new s.cb(l),u_max_speed:new s.ca(l),u_uv_offset:new s.cb(l),u_data_scale:new s.cb(l),u_data_offset:new s.ca(l),u_particle_pos_scale:new s.ca(l),u_particle_pos_offset:new s.cb(l)}),rasterParticleUpdate:l=>({u_particle_texture:new s.c8(l),u_particle_texture_side_len:new s.ca(l),u_velocity:new s.c8(l),u_velocity_res:new s.cb(l),u_max_speed:new s.ca(l),u_speed_factor:new s.ca(l),u_reset_rate:new s.ca(l),u_rand_seed:new s.ca(l),u_uv_offset:new s.cb(l),u_data_scale:new s.cb(l),u_data_offset:new s.ca(l),u_particle_pos_scale:new s.ca(l),u_particle_pos_offset:new s.cb(l)}),symbol:l=>({u_is_size_zoom_constant:new s.c8(l),u_is_size_feature_constant:new s.c8(l),u_size_t:new s.ca(l),u_size:new s.ca(l),u_camera_to_center_distance:new s.ca(l),u_rotate_symbol:new s.c8(l),u_aspect_ratio:new s.ca(l),u_fade_change:new s.ca(l),u_matrix:new s.cc(l),u_label_plane_matrix:new s.cc(l),u_coord_matrix:new s.cc(l),u_is_text:new s.c8(l),u_elevation_from_sea:new s.c8(l),u_pitch_with_map:new s.c8(l),u_texsize:new s.cb(l),u_texsize_icon:new s.cb(l),u_texture:new s.c8(l),u_texture_icon:new s.c8(l),u_gamma_scale:new s.ca(l),u_device_pixel_ratio:new s.ca(l),u_tile_id:new s.c9(l),u_zoom_transition:new s.ca(l),u_inv_rot_matrix:new s.cc(l),u_merc_center:new s.cb(l),u_camera_forward:new s.c9(l),u_tile_matrix:new s.cc(l),u_up_vector:new s.c9(l),u_ecef_origin:new s.c9(l),u_is_halo:new s.c8(l),u_icon_transition:new s.ca(l),u_color_adj_mat:new s.cc(l),u_scale_factor:new s.ca(l),u_ground_shadow_factor:new s.c9(l),u_inv_matrix:new s.cc(l),u_normal_scale:new s.ca(l)}),background:l=>({u_matrix:new s.cc(l),u_emissive_strength:new s.ca(l),u_opacity:new s.ca(l),u_color:new s.di(l)}),backgroundPattern:l=>({u_matrix:new s.cc(l),u_emissive_strength:new s.ca(l),u_opacity:new s.ca(l),u_image:new s.c8(l),u_pattern_tl:new s.cb(l),u_pattern_br:new s.cb(l),u_texsize:new s.cb(l),u_pattern_size:new s.cb(l),u_pixel_coord_upper:new s.cb(l),u_pixel_coord_lower:new s.cb(l),u_pattern_units_to_pixels:new s.cb(l)}),terrainRaster:l=>({u_matrix:new s.cc(l),u_image0:new s.c8(l),u_skirt_height:new s.ca(l),u_ground_shadow_factor:new s.c9(l)}),skybox:l=>({u_matrix:new s.cc(l),u_sun_direction:new s.c9(l),u_cubemap:new s.c8(l),u_opacity:new s.ca(l),u_temporal_offset:new s.ca(l)}),skyboxGradient:l=>({u_matrix:new s.cc(l),u_color_ramp:new s.c8(l),u_center_direction:new s.c9(l),u_radius:new s.ca(l),u_opacity:new s.ca(l),u_temporal_offset:new s.ca(l)}),skyboxCapture:l=>({u_matrix_3f:new s.dj(l),u_sun_direction:new s.c9(l),u_sun_intensity:new s.ca(l),u_color_tint_r:new s.cQ(l),u_color_tint_m:new s.cQ(l),u_luminance:new s.ca(l)}),globeRaster:l=>({u_proj_matrix:new s.cc(l),u_globe_matrix:new s.cc(l),u_normalize_matrix:new s.cc(l),u_merc_matrix:new s.cc(l),u_zoom_transition:new s.ca(l),u_merc_center:new s.cb(l),u_image0:new s.c8(l),u_grid_matrix:new s.dj(l),u_skirt_height:new s.ca(l),u_far_z_cutoff:new s.ca(l),u_frustum_tl:new s.c9(l),u_frustum_tr:new s.c9(l),u_frustum_br:new s.c9(l),u_frustum_bl:new s.c9(l),u_globe_pos:new s.c9(l),u_globe_radius:new s.ca(l),u_viewport:new s.cb(l)}),globeAtmosphere:l=>({u_frustum_tl:new s.c9(l),u_frustum_tr:new s.c9(l),u_frustum_br:new s.c9(l),u_frustum_bl:new s.c9(l),u_horizon:new s.ca(l),u_transition:new s.ca(l),u_fadeout_range:new s.ca(l),u_color:new s.cQ(l),u_high_color:new s.cQ(l),u_space_color:new s.cQ(l),u_temporal_offset:new s.ca(l),u_horizon_angle:new s.ca(l)}),model:l=>({u_matrix:new s.cc(l),u_lighting_matrix:new s.cc(l),u_normal_matrix:new s.cc(l),u_node_matrix:new s.cc(l),u_lightpos:new s.c9(l),u_lightintensity:new s.ca(l),u_lightcolor:new s.c9(l),u_camera_pos:new s.c9(l),u_opacity:new s.ca(l),u_baseColorFactor:new s.cQ(l),u_emissiveFactor:new s.cQ(l),u_metallicFactor:new s.ca(l),u_roughnessFactor:new s.ca(l),u_baseTextureIsAlpha:new s.c8(l),u_alphaMask:new s.c8(l),u_alphaCutoff:new s.ca(l),u_baseColorTexture:new s.c8(l),u_metallicRoughnessTexture:new s.c8(l),u_normalTexture:new s.c8(l),u_occlusionTexture:new s.c8(l),u_emissionTexture:new s.c8(l),u_lutTexture:new s.c8(l),u_color_mix:new s.cQ(l),u_aoIntensity:new s.ca(l),u_emissive_strength:new s.ca(l),u_occlusionTextureTransform:new s.cQ(l)}),modelDepth:l=>({u_matrix:new s.cc(l),u_instance:new s.cc(l),u_node_matrix:new s.cc(l)}),groundShadow:l=>({u_matrix:new s.cc(l),u_ground_shadow_factor:new s.c9(l)}),stars:l=>({u_matrix:new s.cc(l),u_up:new s.c9(l),u_right:new s.c9(l),u_intensity_multiplier:new s.ca(l)}),snowParticle:l=>({u_modelview:new s.cc(l),u_projection:new s.cc(l),u_time:new s.ca(l),u_cam_pos:new s.c9(l),u_velocityConeAperture:new s.ca(l),u_velocity:new s.ca(l),u_horizontalOscillationRadius:new s.ca(l),u_horizontalOscillationRate:new s.ca(l),u_boxSize:new s.ca(l),u_billboardSize:new s.ca(l),u_simpleShapeParameters:new s.cb(l),u_screenSize:new s.cb(l),u_thinningCenterPos:new s.cb(l),u_thinningShape:new s.c9(l),u_thinningAffectedRatio:new s.ca(l),u_thinningParticleOffset:new s.ca(l),u_particleColor:new s.cQ(l),u_direction:new s.c9(l)}),rainParticle:l=>({u_modelview:new s.cc(l),u_projection:new s.cc(l),u_time:new s.ca(l),u_cam_pos:new s.c9(l),u_texScreen:new s.c8(l),u_velocityConeAperture:new s.ca(l),u_velocity:new s.ca(l),u_boxSize:new s.ca(l),u_rainDropletSize:new s.cb(l),u_distortionStrength:new s.ca(l),u_rainDirection:new s.c9(l),u_color:new s.cQ(l),u_screenSize:new s.cb(l),u_thinningCenterPos:new s.cb(l),u_thinningShape:new s.c9(l),u_thinningAffectedRatio:new s.ca(l),u_thinningParticleOffset:new s.ca(l),u_shapeDirectionalPower:new s.ca(l),u_shapeNormalPower:new s.ca(l),u_mode:new s.ca(l)}),vignette:l=>({u_vignetteShape:new s.c9(l),u_vignetteColor:new s.cQ(l)}),occlusion:l=>({u_matrix:new s.cc(l),u_anchorPos:new s.c9(l),u_screenSizePx:new s.cb(l),u_occluderSizePx:new s.cb(l),u_color:new s.cQ(l)})};class Fo{constructor(t,i,c,f){this.id=Fo.uniqueIdxCounter,Fo.uniqueIdxCounter++,this.context=t;const m=t.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||f||i.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Fo.uniqueIdxCounter,Fo.uniqueIdxCounter++;const i=this.context.gl;this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Fo.uniqueIdxCounter=0;const bm={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Fh{constructor(t,i,c,f,m,y){this.length=i.length,this.attributes=c,this.itemSize=i.bytesPerElement,this.dynamicDraw=f,this.instanceCount=y,this.context=t;const w=t.gl;this.buffer=w.createBuffer(),t.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||m||i.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,i){for(let c=0;c<this.attributes.length;c++){const f=i.attributes[this.attributes[c].name];f!==void 0&&t.enableVertexAttribArray(f)}}setVertexAttribPointers(t,i,c){for(let f=0;f<this.attributes.length;f++){const m=this.attributes[f],y=i.attributes[m.name];y!==void 0&&t.vertexAttribPointer(y,m.components,t[bm[m.type]],!1,this.itemSize,m.offset+this.itemSize*(c||0))}}setVertexAttribDivisor(t,i,c){for(let f=0;f<this.attributes.length;f++){const m=i.attributes[this.attributes[f].name];m!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(m,c)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Gu{constructor(t,i,c,f,m){this.context=t,this.width=i,this.height=c;const y=this.framebuffer=t.gl.createFramebuffer();f&&(this.colorAttachment=new bp(t,y)),m&&(this.depthAttachmentType=m,this.depthAttachment=m==="renderbuffer"?new Tp(t,y):new Gc(t,y))}destroy(){const t=this.context.gl;if(this.colorAttachment){const i=this.colorAttachment.get();i&&t.deleteTexture(i)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const i=this.depthAttachment.get();i&&t.deleteRenderbuffer(i)}else{const i=this.depthAttachment.get();i&&t.deleteTexture(i)}t.deleteFramebuffer(this.framebuffer)}}class Ep{constructor(t,i){this.gl=t,this.clearColor=new bf(this),this.clearDepth=new zi(this),this.clearStencil=new Tf(this),this.colorMask=new yd(this),this.depthMask=new Mh(this),this.stencilMask=new wp(this),this.stencilFunc=new vd(this),this.stencilOp=new Ph(this),this.stencilTest=new $c(this),this.depthRange=new zu(this),this.depthTest=new Sf(this),this.depthFunc=new Ef(this),this.blend=new xd(this),this.blendFunc=new wd(this),this.blendColor=new Va(this),this.blendEquation=new bl(this),this.cullFace=new ku(this),this.cullFaceSide=new Du(this),this.frontFace=new oc(this),this.program=new bd(this),this.activeTexture=new If(this),this.viewport=new Af(this),this.bindFramebuffer=new Lu(this),this.bindRenderbuffer=new Td(this),this.bindTexture=new Ou(this),this.bindVertexBuffer=new Ua(this),this.bindElementBuffer=new Rh(this),this.bindVertexArrayOES=new $a(this),this.pixelStoreUnpack=new Aa(this),this.pixelStoreUnpackPremultiplyAlpha=new Fu(this),this.pixelStoreUnpackFlipY=new Ga(this),this.options=i?Object.assign({},i):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=i&&!!i.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,i,c){return new Fo(this,t,i,c)}createVertexBuffer(t,i,c,f,m){return new Fh(this,t,i,c,f,m)}createRenderbuffer(t,i,c){const f=this.gl,m=f.createRenderbuffer();return this.bindRenderbuffer.set(m),f.renderbufferStorage(f.RENDERBUFFER,t,i,c),this.bindRenderbuffer.set(null),m}createFramebuffer(t,i,c,f){return new Gu(this,t,i,c,f)}clear({color:t,depth:i,stencil:c,colorMask:f}){const m=this.gl;let y=0;t&&(y|=m.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(f||[!0,!0,!0,!0])),i!==void 0&&(y|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),c!==void 0&&(y|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),m.clear(y)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.bv(t.blendFunction,Gr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Kc;function Sl(l,t,i,c,f,m,y){const w=l.context,S=w.gl,M=l.transform,P=l.getOrCreateProgram("collisionBox"),O=[];let D=0,F=0;for(let le=0;le<c.length;le++){const ge=c[le],_e=t.getTile(ge),pe=_e.getBucket(i);if(!pe)continue;const ue=lr(ge,pe,M);let ye=ue;f[0]===0&&f[1]===0||(ye=l.translatePosMatrix(ue,_e,f,m));const xe=y?pe.textCollisionBox:pe.iconCollisionBox,Pe=pe.collisionCircleArray;if(Pe.length>0){const Le=s.bz(),Ye=ye;s.cB(Le,pe.placementInvProjMatrix,M.glCoordMatrix),s.cB(Le,Le,pe.placementViewportMatrix),O.push({circleArray:Pe,circleOffset:F,transform:Ye,invTransform:Le,projection:pe.getProjection()}),D+=Pe.length/4,F=D}xe&&(l.terrain&&l.terrain.setupElevationDraw(_e,P),P.draw(l,S.LINES,Bt.disabled,ur.disabled,l.colorModeForRenderPass(),ar.disabled,_a(ye,M,_e,pe.getProjection()),i.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,null,M.zoom,null,[xe.collisionVertexBuffer,xe.collisionVertexBufferExt]))}if(!y||!O.length)return;const q=l.getOrCreateProgram("collisionCircle"),V=new s.dI;V.resize(4*D),V._trim();let W=0;for(const le of O)for(let ge=0;ge<le.circleArray.length/4;ge++){const _e=4*ge,pe=le.circleArray[_e+0],ue=le.circleArray[_e+1],ye=le.circleArray[_e+2],xe=le.circleArray[_e+3];V.emplace(W++,pe,ue,ye,xe,0),V.emplace(W++,pe,ue,ye,xe,1),V.emplace(W++,pe,ue,ye,xe,2),V.emplace(W++,pe,ue,ye,xe,3)}(!Kc||Kc.length<2*D)&&(Kc=function(le){const ge=2*le,_e=new s.a_;_e.resize(ge),_e._trim();for(let pe=0;pe<ge;pe++){const ue=6*pe;_e.uint16[ue+0]=4*pe+0,_e.uint16[ue+1]=4*pe+1,_e.uint16[ue+2]=4*pe+2,_e.uint16[ue+3]=4*pe+2,_e.uint16[ue+4]=4*pe+3,_e.uint16[ue+5]=4*pe+0}return _e}(D));const X=w.createIndexBuffer(Kc,!0),J=w.createVertexBuffer(V,s.dJ.members,!0);for(const le of O){const ge={u_matrix:le.transform,u_inv_matrix:le.invTransform,u_camera_to_center_distance:(se=M).getCameraToCenterDistance(le.projection),u_viewport_size:[se.width,se.height]};q.draw(l,S.TRIANGLES,Bt.disabled,ur.disabled,l.colorModeForRenderPass(),ar.disabled,ge,i.id,J,X,s.bd.simpleSegment(0,2*le.circleOffset,le.circleArray.length,le.circleArray.length/2),null,M.zoom)}var se;J.destroy(),X.destroy()}const Xa=s.bz();function cc(l){const t=l._camera.getWorldToCamera(l.worldSize,1),i=s.az([],t,l.globeMatrix);s.bi(i,i);const c=[0,0,0],f=[0,1,0,0];return s.aA(f,f,i),c[0]=f[0],c[1]=f[1],c[2]=f[2],s.au(c,c),c}function uc({width:l,height:t,anchor:i,textOffset:c,textScale:f},m){const{horizontalAlign:y,verticalAlign:w}=s.bT(i),S=-(y-.5)*l,M=-(w-.5)*t,P=s.bU(i,c);return new s.P((S/f+P[0])*m,(M/f+P[1])*m)}function Jc(l,t,i,c,f,m,y,w,S,M){const P=l.text.placedSymbolArray,O=l.text.dynamicLayoutVertexArray,D=l.icon.dynamicLayoutVertexArray,F={},q=l.getProjection(),V=Tu(y,q,f),W=f.elevation,X=q.upVectorScale(y.canonical,f.center.lat,f.worldSize).metersToTile;O.clear();for(let J=0;J<P.length;J++){const se=P.get(J),{tileAnchorX:le,tileAnchorY:ge,numGlyphs:_e}=se,pe=se.hidden||!se.crossTileID||l.allowVerticalPlacement&&!se.placedOrientation?null:c[se.crossTileID];if(pe){let ue=0,ye=0,xe=0;if(W){const Je=W?W.getAtTileOffset(y,le,ge):0,[Ve,st,vt]=q.upVector(y.canonical,le,ge);ue=Je*Ve*X,ye=Je*st*X,xe=Je*vt*X}let[Pe,Le,Ye,Xe]=Mo(se.projectedAnchorX+ue,se.projectedAnchorY+ye,se.projectedAnchorZ+xe,i?V:m);const ot=zc(f.getCameraToCenterDistance(q),Xe);let ze=s.bJ(l.textSizeData,S,se)*ot/s.bO;i&&(ze*=l.tilePixelRatio/w);const $e=uc(pe,ze);i?({x:Pe,y:Le,z:Ye}=q.projectTilePoint(le+$e.x,ge+$e.y,y.canonical),[Pe,Le,Ye]=Mo(Pe+ue,Le+ye,Ye+xe,m)):(t&&$e._rotate(-f.angle),Pe+=$e.x,Le+=$e.y,Ye=0);const Ie=l.allowVerticalPlacement&&se.placedOrientation===s.bI.vertical?Math.PI/2:0;for(let Je=0;Je<_e;Je++)s.bL(O,Pe,Le,Ye,Ie);M&&se.associatedIconIndex>=0&&(F[se.associatedIconIndex]={x:Pe,y:Le,z:Ye,angle:Ie})}else Ts(_e,O)}if(M){D.clear();const J=l.icon.placedSymbolArray;for(let se=0;se<J.length;se++){const le=J.get(se),{numGlyphs:ge}=le,_e=F[se];if(le.hidden||!_e)Ts(ge,D);else{const{x:pe,y:ue,z:ye,angle:xe}=_e;for(let Pe=0;Pe<ge;Pe++)s.bL(D,pe,ue,ye,xe)}}l.icon.dynamicLayoutVertexBuffer.updateData(D)}l.text.dynamicLayoutVertexBuffer.updateData(O)}function hc(l,t,i,c,f,m,y={}){const w=i.paint.get("icon-translate"),S=i.paint.get("text-translate"),M=i.paint.get("icon-translate-anchor"),P=i.paint.get("text-translate-anchor"),O=i.layout.get("icon-rotation-alignment"),D=i.layout.get("text-rotation-alignment"),F=i.layout.get("icon-pitch-alignment"),q=i.layout.get("text-pitch-alignment"),V=i.layout.get("icon-keep-upright"),W=i.layout.get("text-keep-upright"),X=i.paint.get("icon-color-saturation"),J=i.paint.get("icon-color-contrast"),se=i.paint.get("icon-color-brightness-min"),le=i.paint.get("icon-color-brightness-max"),ge=i.layout.get("symbol-elevation-reference")==="sea",_e=l.context,pe=_e.gl,ue=l.transform,ye=O==="map",xe=D==="map",Pe=F==="map",Le=q==="map",Ye=i.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Xe=!1;const ot=l.depthModeForSublayer(0,Bt.ReadOnly),ze=new Bt(l.context.gl.LEQUAL,Bt.ReadOnly,l.depthRangeFor3D),$e=[s.aD(ue.center.lng),s.aH(ue.center.lat)],Ie=i.layout.get("text-variable-anchor"),Je=ue.projection.name==="globe",Ve=[],st=[0,-1,0];for(const vt of c){const Qe=t.getTile(vt),pt=Qe.getBucket(i);if(!pt||pt.projection.name==="mercator"&&Je||pt.fullyClipped)continue;const Pt=pt.projection.name==="globe",Lt=Pt?s.ah(ue.zoom):0,Mt=Tu(vt,pt.getProjection(),ue),Nt=ue.calculatePixelsToTileUnitsMatrix(Qe),er=Ie&&pt.hasTextData(),nr=pt.hasIconTextFit()&&er&&pt.hasIconData(),dr=pt.getProjection().createInversionMatrix(ue,vt.canonical),Dr=(1<<Qe.tileID.canonical.z)*s.aj/l.transform.worldSize,dn=Zn=>{let Sn=[0,0,0];if(Zn){const _i=l.style.directionalLight,hn=l.style.ambientLight;_i&&hn&&(Sn=xl(l.style,_i,hn))}return Sn},Gn=Zn=>{ue.depthOcclusionForSymbolsAndCircles&&(i.hasInitialOcclusionOpacityProperties||l.terrain)&&(Zn.push("DEPTH_D24"),Zn.push("DEPTH_OCCLUSION"))},Mn=()=>{const Zn=ye&&i.layout.get("symbol-placement")!=="point",Sn=[];Gn(Sn);const _i=Zn||nr,hn=pt.elevationType==="road"&&Pe,yi=l.shadowRenderer,Jn=hn&&!!yi&&yi.enabled,kn=dn(Jn),Xn=hn?ze:ot,zr=i.paint.get("icon-image-cross-fade");l.terrainRenderModeElevated()&&Pe&&Sn.push("PITCH_WITH_MAP_TERRAIN"),Pt&&(Sn.push("PROJECTION_GLOBE_VIEW"),_i&&Sn.push("PROJECTED_POS_ON_VIEWPORT")),zr>0&&Sn.push("ICON_TRANSITION"),pt.icon.zOffsetVertexBuffer&&Sn.push("Z_OFFSET"),X===0&&J===0&&se===0&&le===1||Sn.push("COLOR_ADJUSTMENT"),pt.sdfIcons&&Sn.push("RENDER_SDF"),Jn&&Sn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),hn&&pt.icon.orientationVertexBuffer&&Sn.push("ELEVATED_ROADS");const bi=pt.icon.programConfigurations.get(i.id),_s=l.getOrCreateProgram("symbol",{config:bi,defines:Sn}),ri=Qe.imageAtlasTexture?Qe.imageAtlasTexture.size:[0,0],Tn=pt.iconSizeData,bo=s.bH(Tn,ue.zoom),no=Pe||!ue.isOrthographic,na=pl(Mt,Qe.tileID.canonical,Pe,ye,ue,pt.getProjection(),Nt),Ji=wu(Mt,Qe.tileID.canonical,Pe,ye,ue,pt.getProjection(),Nt),jo=l.translatePosMatrix(Ji,Qe,w,M,!0),To=l.translatePosMatrix(Mt,Qe,w,M),So=_i?Xa:na,Vo=ye&&!Pe&&!Zn;let Uo=st;!Je&&!ue.mercatorFromTransition||ye||(Uo=cc(ue));const yc=Pt?Uo:st,ed=i.getColorAdjustmentMatrix(X,J,se,le),vc=Uu(Tn.kind,bo,Vo,Pe,l,To,So,jo,ge,!1,ri,[0,0],0,vt,Lt,$e,dr,yc,pt.getProjection(),kn,Dr,ed,zr,null),$f=Qe.imageAtlasTexture?Qe.imageAtlasTexture:null,hu=i.layout.get("icon-size").constantOr(0)!==1||pt.iconsNeedLinear,Kd=pt.sdfIcons||l.options.rotating||l.options.zooming||hu||no?pe.LINEAR:pe.NEAREST,td=pt.sdfIcons&&i.paint.get("icon-halo-width").constantOr(1)!==0,Da=l.terrain&&Pe&&Zn?s.bi(s.bz(),na):Xa;if(Zn&&pt.icon){const Dl=ue.elevation,sl=Dl?Dl.getAtTileOffsetFunc(vt,ue.center.lat,ue.worldSize,pt.getProjection()):null,Ll=cd(Mt,Qe.tileID.canonical,Pe,ye,ue,pt.getProjection(),Nt);Sa(pt,Mt,l,!1,Ll,Ji,Pe,V,sl,vt)}return{program:_s,buffers:pt.icon,uniformValues:vc,atlasTexture:$f,atlasTextureIcon:null,atlasInterpolation:Kd,atlasInterpolationIcon:null,isSDF:pt.sdfIcons,hasHalo:td,depthMode:Xn,tile:Qe,renderWithShadows:Jn,labelPlaneMatrixInv:Da}},wn=()=>{const Zn=xe&&i.layout.get("symbol-placement")!=="point",Sn=[],_i=Zn||Ie||nr,hn=pt.elevationType==="road"&&Le,yi=l.shadowRenderer,Jn=hn&&!!yi&&yi.enabled,kn=dn(Jn),Xn=hn?ze:ot;l.terrainRenderModeElevated()&&Le&&Sn.push("PITCH_WITH_MAP_TERRAIN"),Pt&&(Sn.push("PROJECTION_GLOBE_VIEW"),_i&&Sn.push("PROJECTED_POS_ON_VIEWPORT")),pt.text.zOffsetVertexBuffer&&Sn.push("Z_OFFSET"),pt.iconsInText&&Sn.push("RENDER_TEXT_AND_SYMBOL"),Sn.push("RENDER_SDF"),Jn&&Sn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),hn&&pt.text.orientationVertexBuffer&&Sn.push("ELEVATED_ROADS"),Gn(Sn);const zr=pt.text.programConfigurations.get(i.id),bi=l.getOrCreateProgram("symbol",{config:zr,defines:Sn});let _s,ri=[0,0],Tn=null;const bo=pt.textSizeData;pt.iconsInText&&(ri=Qe.imageAtlasTexture?Qe.imageAtlasTexture.size:[0,0],Tn=Qe.imageAtlasTexture?Qe.imageAtlasTexture:null,_s=Le||!ue.isOrthographic||l.options.rotating||l.options.zooming||bo.kind==="composite"||bo.kind==="camera"?pe.LINEAR:pe.NEAREST);const no=Qe.glyphAtlasTexture?Qe.glyphAtlasTexture.size:[0,0],na=i.layout.get("text-size-scale-range"),Ji=s.ay(l.scaleFactor,na[0],na[1]),jo=s.bH(bo,ue.zoom,Ji),To=pl(Mt,Qe.tileID.canonical,Le,xe,ue,pt.getProjection(),Nt),So=wu(Mt,Qe.tileID.canonical,Le,xe,ue,pt.getProjection(),Nt),Vo=l.translatePosMatrix(So,Qe,S,P,!0),Uo=l.translatePosMatrix(Mt,Qe,S,P),yc=_i?Xa:To,ed=xe&&!Le&&!Zn;let vc=st;!Je&&!ue.mercatorFromTransition||xe||(vc=cc(ue));const $f=Uu(bo.kind,jo,ed,Le,l,Uo,yc,Vo,ge,!0,no,ri,0,vt,Lt,$e,dr,Pt?vc:st,pt.getProjection(),kn,Dr,null,null,Ji),hu=Qe.glyphAtlasTexture?Qe.glyphAtlasTexture:null,Kd=pe.LINEAR,td=i.paint.get("text-halo-width").constantOr(1)!==0,Da=l.terrain&&Le&&Zn?s.bi(s.bz(),To):Xa;if(Zn&&pt.text){const Dl=ue.elevation,sl=Dl?Dl.getAtTileOffsetFunc(vt,ue.center.lat,ue.worldSize,pt.getProjection()):null,Ll=cd(Mt,Qe.tileID.canonical,Le,xe,ue,pt.getProjection(),Nt);Sa(pt,Mt,l,!0,Ll,So,Le,W,sl,vt)}return{program:bi,buffers:pt.text,uniformValues:$f,atlasTexture:hu,atlasTextureIcon:Tn,atlasInterpolation:Kd,atlasInterpolationIcon:_s,isSDF:!0,hasHalo:td,depthMode:Xn,tile:Qe,renderWithShadows:Jn,labelPlaneMatrixInv:Da}},wi=pt.icon.segments.get().length,yr=pt.text.segments.get().length,Lr=wi&&!y.onlyText?Mn():null,Wr=yr&&!y.onlyIcons?wn():null,qn=i.paint.get("icon-opacity").constantOr(1),Ci=i.paint.get("text-opacity").constantOr(1);if(Ye&&pt.canOverlap){Xe=!0;const Zn=qn&&!y.onlyText?pt.icon.segments.get():[],Sn=Ci&&!y.onlyIcons?pt.text.segments.get():[];for(const _i of Zn)Ve.push({segments:new s.bd([_i]),sortKey:_i.sortKey,state:Lr});for(const _i of Sn)Ve.push({segments:new s.bd([_i]),sortKey:_i.sortKey,state:Wr})}else y.onlyText||Ve.push({segments:qn?pt.icon.segments:new s.bd([]),sortKey:0,state:Lr}),y.onlyIcons||Ve.push({segments:Ci?pt.text.segments:new s.bd([]),sortKey:0,state:Wr})}Xe&&Ve.sort((vt,Qe)=>vt.sortKey-Qe.sortKey);for(const vt of Ve){const Qe=vt.state;if(Qe)if(l.terrain?l.terrain.setupElevationDraw(Qe.tile,Qe.program,{useDepthForOcclusion:ue.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Qe.labelPlaneMatrixInv}):l.setupDepthForOcclusion(ue.depthOcclusionForSymbolsAndCircles,Qe.program),_e.activeTexture.set(pe.TEXTURE0),Qe.atlasTexture&&Qe.atlasTexture.bind(Qe.atlasInterpolation,pe.CLAMP_TO_EDGE,!0),Qe.atlasTextureIcon&&(_e.activeTexture.set(pe.TEXTURE1),Qe.atlasTextureIcon&&Qe.atlasTextureIcon.bind(Qe.atlasInterpolationIcon,pe.CLAMP_TO_EDGE,!0)),Qe.renderWithShadows&&l.shadowRenderer.setupShadows(Qe.tile.tileID.toUnwrapped(),Qe.program,"vector-tile",Qe.tile.tileID.overscaledZ),l.uploadCommonLightUniforms(l.context,Qe.program),Qe.hasHalo){const pt=Qe.uniformValues;pt.u_is_halo=1,dc(Qe.buffers,vt.segments,i,l,Qe.program,Qe.depthMode,f,m,pt,2),pt.u_is_halo=0}else{if(Qe.isSDF){const pt=Qe.uniformValues;Qe.hasHalo&&(pt.u_is_halo=1,dc(Qe.buffers,vt.segments,i,l,Qe.program,Qe.depthMode,f,m,pt,1)),pt.u_is_halo=0}dc(Qe.buffers,vt.segments,i,l,Qe.program,Qe.depthMode,f,m,Qe.uniformValues,1)}}}function dc(l,t,i,c,f,m,y,w,S,M){const P=[l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer,l.iconTransitioningVertexBuffer,l.globeExtVertexBuffer,l.zOffsetVertexBuffer,l.orientationVertexBuffer];f.draw(c,c.context.gl.TRIANGLES,m,y,w,ar.disabled,S,i.id,l.layoutVertexBuffer,l.indexBuffer,t,i.paint,c.transform.zoom,l.programConfigurations.get(i.id),P,M)}function qu(l,t){const i=1<<l.canonical.z,c=(t.x*i-l.canonical.x-l.wrap*i)*s.aj,f=(t.y*i-l.canonical.y)*s.aj,m=s.dS(t.z,t.y);return s.cS(c,f,m)}function Nh(l,t,i,c,f){if(!i.layout||i.layout.get("fill-elevation-reference")==="none")return;const m=l.context.gl,y=new Bt(l.context.gl.LEQUAL,Bt.ReadWrite,l.depthRangeFor3D),w=new Bt(l.context.gl.GREATER,Bt.ReadWrite,l.depthRangeFor3D),S=function(F){const q=s.cJ(F.pitch);let V=.01;return F.isOrthographic&&(V=s.ai(1e-4,V,s.cN(q>=is?1:q/is))),2*V}(l.transform),M=l.transform.getFreeCameraOptions().position,P="elevatedStructuresDepthReconstruct",O=l.getOrCreateProgram(P,{defines:["DEPTH_RECONSTRUCTION"]}),D=l.getOrCreateProgram(P);for(const F of c){const q=t.getTile(F),V=q.getBucket(i);if(!V)continue;const W=V.elevatedStructures;if(!W)continue;const X=V.elevationBufferData.heightRange,J=qu(F.toUnwrapped(),M),se=l.translatePosMatrix(F.projMatrix,q,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));let le,ge,_e,pe;if(f==="initialize"){if(!X||X.min>=1||W.depthSegments.segments[0].primitiveLength===0)continue;le=yo(se,J,S,1,0),ge=y,_e=W.depthSegments,pe=O}else if(f==="reset"){if(!X||X.min>=0||W.maskSegments.segments[0].primitiveLength===0)continue;le=yo(se,J,0,0,1),ge=w,_e=W.maskSegments,pe=O}else if(f==="geometry"){if(W.depthSegments.segments[0].primitiveLength===0)continue;le=yo(se,J,S,1,0),ge=y,_e=W.depthSegments,pe=D}pe.draw(l,m.TRIANGLES,ge,ur.disabled,Gr.disabled,ar.disabled,le,i.id,W.vertexBuffer,W.indexBuffer,_e,i.paint,l.transform.zoom)}}function fc(l,t,i){const{painter:c,sourceCache:f,layer:m,coords:y,colorMode:w,elevationType:S,terrainEnabled:M,pass:P}=l,O=c.context.gl,D=m.paint.get("fill-pattern"),F=m.paint.get("fill-pattern-cross-fade"),q=D.constantOr(null);let V=S;S!=="road"||t&&!M||(V="none");const W=V==="road",X=l.painter.shadowRenderer,J=W&&!!X&&X.enabled,se=new Bt(c.context.gl.LEQUAL,Bt.ReadOnly,c.depthRangeFor3D);let le=[0,0,0];if(J){const pe=c.style.directionalLight,ue=c.style.ambientLight;pe&&ue&&(le=xl(c.style,pe,ue))}const ge=D&&D.constantOr(1),_e=(pe,ue)=>{let ye,xe,Pe,Le,Ye;ue?(ye=ge&&!m.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Pe=O.LINES):(ye=ge?"fillPattern":"fill",Pe=O.TRIANGLES);for(const Xe of y){const ot=f.getTile(Xe);if(ge&&!ot.patternsLoaded())continue;const ze=ot.getBucket(m);if(!ze)continue;const $e=t?ze.elevationBufferData:ze.bufferData;if($e.isEmpty())continue;c.prepareDrawTile();const Ie=$e.programConfigurations.get(m.id),Je=c.isTileAffectedByFog(Xe),Ve=[],st=[];W&&(Ve.push("ELEVATED_ROADS"),st.push($e.elevatedLayoutVertexBuffer)),J&&Ve.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ge&&(c.context.activeTexture.set(O.TEXTURE0),ot.imageAtlasTexture&&ot.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Ie.updatePaintBuffers());let vt=!1;if(q&&ot.imageAtlas){const Mt=ot.imageAtlas,Nt=s.dN.from(q),er=Nt.getPrimary().scaleSelf(s.q.devicePixelRatio).toString(),nr=Nt.getSecondary(),dr=Mt.patternPositions.get(er),Dr=nr?Mt.patternPositions.get(nr.scaleSelf(s.q.devicePixelRatio).toString()):null;vt=!!dr&&!!Dr,dr&&Ie.setConstantPatternPositions(dr,Dr)}F>0&&(vt||Ie.getPatternTransitionVertexBuffer("fill-pattern"))&&Ve.push("FILL_PATTERN_TRANSITION");const Qe=c.getOrCreateProgram(ye,{config:Ie,overrideFog:Je,defines:Ve}),pt=c.translatePosMatrix(Xe.projMatrix,ot,m.paint.get("fill-translate"),m.paint.get("fill-translate-anchor"));J&&X.setupShadows(ot.tileID.toUnwrapped(),Qe,"vector-tile",ot.tileID.overscaledZ);const Pt=m.paint.get("fill-emissive-strength");if(ue){Le=$e.lineIndexBuffer,Ye=$e.lineSegments;const Mt=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[O.drawingBufferWidth,O.drawingBufferHeight];xe=ye==="fillOutlinePattern"&&ge?Id(pt,Pt,c,ot,Mt,le,F):Vu(pt,Pt,Mt,le)}else Le=$e.indexBuffer,Ye=$e.triangleSegments,xe=ge?Xc(pt,Pt,c,ot,le,F):Oo(pt,Pt,le);c.uploadCommonUniforms(c.context,Qe,Xe.toUnwrapped());let Lt=pe;(S==="road"&&!M||S==="offset")&&(Lt=se),Qe.draw(c,Pe,Lt,i||c.stencilModeForClipping(Xe),w,ar.disabled,xe,m.id,$e.layoutVertexBuffer,Le,Ye,m.paint,c.transform.zoom,Ie,st)}};c.renderPass===P&&_e(c.depthModeForSublayer(1,c.renderPass==="opaque"?Bt.ReadWrite:Bt.ReadOnly),!1),V==="none"&&c.renderPass==="translucent"&&m.paint.get("fill-antialias")&&_e(c.depthModeForSublayer(m.getPaintProperty("fill-outline-color")?2:0,Bt.ReadOnly),!0)}function ps(l,t,i,c,f,m,y,w){i.resetLayerRenderingStats(l);const S=l.context,M=S.gl,P=l.transform,O=i.paint.get("fill-extrusion-pattern"),D=i.paint.get("fill-extrusion-pattern-cross-fade"),F=O.constantOr(null),q=O.constantOr(1),V=i.paint.get("fill-extrusion-opacity"),W=l.style.enable3dLights(),X=i.paint.get(W&&!q?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),J=[i.paint.get("fill-extrusion-ambient-occlusion-intensity"),X],se=i.layout.get("fill-extrusion-edge-radius"),le=se>0&&!i.paint.get("fill-extrusion-rounded-roof"),ge=le?0:se,_e=P.projection.name==="globe"?s.dV():0,pe=P.projection.name==="globe",ue=pe?s.ah(P.zoom):0,ye=[s.aD(P.center.lng),s.aH(P.center.lat)],xe=i.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Pe=i.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(xe?null:i.lut).toArray01().slice(0,3),Le=i.paint.get("fill-extrusion-flood-light-intensity"),Ye=i.paint.get("fill-extrusion-vertical-scale"),Xe=i.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ot=i.paint.get("fill-extrusion-height-alignment"),ze=i.paint.get("fill-extrusion-base-alignment"),$e=ko(l,i.paint.get("fill-extrusion-cutoff-fade-range")),Ie=[];let Je;pe&&Ie.push("PROJECTION_GLOBE_VIEW"),J[0]>0&&Ie.push("FAUX_AO"),le&&Ie.push("ZERO_ROOF_RADIUS"),w&&Ie.push("HAS_CENTROID"),Le>0&&Ie.push("FLOOD_LIGHT"),$e.shouldRenderCutoff&&Ie.push("RENDER_CUTOFF"),Xe&&Ie.push("RENDER_WALL_MODE");const Ve=l.renderPass==="shadow",st=l.shadowRenderer,vt=Ve&&!!st,Qe=Ve?ar.disabled:ar.backCCW;l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!0);let pt=[0,0,0];if(st){const Mt=l.style.directionalLight,Nt=l.style.ambientLight;Mt&&Nt&&(pt=xl(l.style,Mt,Nt)),Ve||(Ie.push("RENDER_SHADOWS","DEPTH_TEXTURE"),st.useNormalOffset&&Ie.push("NORMAL_OFFSET")),Je=Ie.concat(["SHADOWS_SINGLE_CASCADE"])}const Pt=vt?"fillExtrusionDepth":q?"fillExtrusionPattern":"fillExtrusion",Lt=i.getLayerRenderingStats();for(const Mt of c){const Nt=t.getTile(Mt),er=Nt.getBucket(i);if(!er||er.projection.name!==P.projection.name)continue;let nr=!1;st&&(nr=st.getMaxCascadeForTile(Mt.toUnwrapped())===0);const dr=l.isTileAffectedByFog(Mt),Dr=er.programConfigurations.get(i.id);let dn=!1;if(F&&Nt.imageAtlas){const Wr=Nt.imageAtlas,qn=s.dN.from(F),Ci=qn.getPrimary().scaleSelf(s.q.devicePixelRatio).toString(),Zn=qn.getSecondary(),Sn=Wr.patternPositions.get(Ci),_i=Zn?Wr.patternPositions.get(Zn.scaleSelf(s.q.devicePixelRatio).toString()):null;dn=!!Sn&&!!_i,Sn&&Dr.setConstantPatternPositions(Sn,_i)}D>0&&(dn||Dr.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ie.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Gn=l.getOrCreateProgram(Pt,{config:Dr,defines:nr?Je:Ie,overrideFog:dr});if(l.terrain&&l.terrain.setupElevationDraw(Nt,Gn,{useMeterToDem:!0}),!er.centroidVertexBuffer){const Wr=Gn.attributes.a_centroid_pos;Wr!==void 0&&M.vertexAttrib2f(Wr,0,0)}!Ve&&st&&st.setupShadows(Nt.tileID.toUnwrapped(),Gn,"vector-tile",Nt.tileID.overscaledZ),q&&(l.context.activeTexture.set(M.TEXTURE0),Nt.imageAtlasTexture&&Nt.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Dr.updatePaintBuffers());const Mn=i.paint.get("fill-extrusion-vertical-gradient"),wn=1/er.tileToMeter;let wi;if(Ve&&st){if(Ka(Nt.tileID,er,l))continue;const Wr=st.calculateShadowPassMatrixFromTile(Nt.tileID.toUnwrapped());wi=Cf(Wr,ge,wn,Ye,ot,ze)}else{const Wr=l.translatePosMatrix(Mt.expandedProjMatrix,Nt,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),qn=P.projection.createInversionMatrix(P,Mt.canonical);wi=q?Sp(Wr,l,Mn,V,J,ge,wn,Mt,Nt,_e,ot,ze,ue,ye,qn,Pe,Ye,D):Zc(Wr,l,Mn,V,J,ge,wn,Mt,_e,ot,ze,ue,ye,qn,Pe,Ye,Le,pt)}l.uploadCommonUniforms(S,Gn,Mt.toUnwrapped(),null,$e);let yr=er.segments;if(P.projection.name==="mercator"&&!Ve&&(yr=er.getVisibleSegments(Nt.tileID,l.terrain,l.transform.getFrustum(0)),!yr.get().length))continue;if(Lt)if(Ve)for(const Wr of yr.get())Lt.numRenderedVerticesInShadowPass+=Wr.primitiveLength;else for(const Wr of yr.get())Lt.numRenderedVerticesInTransparentPass+=Wr.primitiveLength;const Lr=[];(l.terrain||w)&&Lr.push(er.centroidVertexBuffer),pe&&Lr.push(er.layoutVertexExtBuffer),Xe&&Lr.push(er.wallVertexBuffer),Gn.draw(l,S.gl.TRIANGLES,f,m,y,Qe,wi,i.id,er.layoutVertexBuffer,er.indexBuffer,yr,i.paint,l.transform.zoom,Dr,Lr)}l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!1)}function vo(l,t,i,c,f,m,y,w,S,M,P,O,D,F,q,V,W,X,J){const se=l.context,le=se.gl,ge=l.transform,_e=l.transform.zoom,pe=[],ue=ko(l,i.paint.get("fill-extrusion-cutoff-fade-range"));M==="clear"?(pe.push("CLEAR_SUBPASS"),J&&(pe.push("CLEAR_FROM_TEXTURE"),se.activeTexture.set(le.TEXTURE0),J.bind(le.LINEAR,le.CLAMP_TO_EDGE))):M==="sdf"&&pe.push("SDF_SUBPASS"),W&&pe.push("HAS_CENTROID"),ue.shouldRenderCutoff&&pe.push("RENDER_CUTOFF");const ye=i.layout.get("fill-extrusion-edge-radius"),xe=(Pe,Le,Ye,Xe,ot)=>{const ze=Le.programConfigurations.get(i.id),$e=l.isTileAffectedByFog(Pe),Ie=l.getOrCreateProgram("fillExtrusionGroundEffect",{config:ze,defines:pe,overrideFog:$e}),Je=((st,vt,Qe,pt,Pt,Lt,Mt,Nt,er,nr,dr)=>({u_matrix:vt,u_opacity:Qe,u_ao_pass:pt?1:0,u_meter_to_tile:Pt,u_ao:Lt,u_flood_light_intensity:Mt,u_flood_light_color:Nt,u_attenuation:er,u_edge_radius:nr,u_fb:0,u_fb_size:dr,u_dynamic_offset:1}))(0,Xe,P,S,ot,[O,D*ot],F,q,V,_e>=17?0:ye*ot,J?J.size[0]:0),Ve=[];W&&Ve.push(Le.hiddenByLandmarkVertexBuffer),l.uploadCommonUniforms(se,Ie,Pe.toUnwrapped(),null,ue),Ie.draw(l,se.gl.TRIANGLES,f,m,y,w,Je,i.id,Le.vertexBuffer,Le.indexBuffer,Ye,i.paint,_e,ze,Ve)};for(const Pe of c){const Le=t.getTile(Pe),Ye=Le.getBucket(i);if(!Ye||Ye.projection.name!==ge.projection.name||!Ye.groundEffect||Ye.groundEffect&&!Ye.groundEffect.hasData())continue;const Xe=Ye.groundEffect,ot=1/Ye.tileToMeter;{const ze=l.translatePosMatrix(Pe.projMatrix,Le,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),$e=Xe.getDefaultSegment();xe(Pe,Xe,$e,ze,ot)}if(X)for(let ze=0;ze<4;ze++){const $e=s.dT[ze](Pe),Ie=t.getTile($e);if(!Ie)continue;const Je=Ie.getBucket(i);if(!Je||Je.projection.name!==ge.projection.name||!Je.groundEffect||Je.groundEffect&&!Je.groundEffect.hasData())continue;const Ve=Je.groundEffect;let st,vt;ze===0?(st=[-8192,0,0],vt=1):ze===1?(st=[s.aj,0,0],vt=0):ze===2?(st=[0,-8192,0],vt=3):(st=[0,s.aj,0],vt=2);const Qe=Ve.regionSegments[vt];if(!Qe)continue;const pt=new Float32Array(16);s.bo(pt,Pe.projMatrix,st),xe(Pe,Ve,Qe,l.translatePosMatrix(pt,Le,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),ot)}}}function Ft(l,t,i,c,f,m,y){c.centroidVertexArray.length===0&&c.createCentroidsBuffer();const w=m?m.findDEMTileFor(i):null;if(!(w&&w.dem||y))return;m&&w&&w.dem&&c.selfDEMTileTimestamp!==w.dem._timestamp&&(c.borderDoneWithNeighborZ=[-1,-1,-1,-1],c.selfDEMTileTimestamp=w.dem._timestamp);const S=X=>new s.P(Math.ceil((X+s.dX)*s.dY),0),M=X=>{const J=t.getSource().minzoom,se=ge=>{const _e=t.getTileByID(ge);if(_e&&_e.hasData())return _e.getBucket(f)},le=[0,-1,1];for(const ge of le){if(X.overscaledZ+ge<J)continue;const _e=se(X.calculateScaledKey(X.overscaledZ+ge));if(_e)return _e}},P=[0,0,0],O=(X,J)=>(P[0]=Math.min(X.min.y,J.min.y),P[1]=Math.max(X.max.y,J.max.y),P[2]=s.aj-J.min.x>X.max.x?J.min.x-s.aj:X.max.x,P),D=(X,J)=>(P[0]=Math.min(X.min.x,J.min.x),P[1]=Math.max(X.max.x,J.max.x),P[2]=s.aj-J.min.y>X.max.y?J.min.y-s.aj:X.max.y,P),F=[(X,J)=>O(X,J),(X,J)=>O(J,X),(X,J)=>D(X,J),(X,J)=>D(J,X)],q=(X,J,se,le,ge,_e,pe)=>{if(!m)return 0;const ue=[[_e?se:X,_e?X:se,0],[_e?se:J,_e?J:se,0]],ye=pe<0?s.aj+pe:pe,xe=[_e?ye:(X+J)/2,_e?(X+J)/2:ye,0];return se===0&&pe<0||se!==0&&pe>0?m.getForTilePoints(ge,[xe],!0,le):ue.push(xe),m.getForTilePoints(i,ue,!0,w),Math.max(ue[0][2],ue[1][2],xe[2])/m.exaggeration()};for(let X=0;X<4;X++){const J=c.borderFeatureIndices[X];if(J.length===0)continue;const se=s.dT[X](i),le=M(se);if(!(le&&le instanceof s.dU))continue;const ge=m?m.findDEMTileFor(se):null;if(!(ge&&ge.dem||y)||(m&&ge&&ge.dem&&c.borderDEMTileTimestamp[X]!==ge.dem._timestamp&&(c.borderDoneWithNeighborZ[X]=-1,c.borderDEMTileTimestamp[X]=ge.dem._timestamp),c.borderDoneWithNeighborZ[X]===le.canonical.z))continue;le.centroidVertexArray.length===0&&le.createCentroidsBuffer();const _e=(X<2?1:5)-X,pe=le.borderDoneWithNeighborZ[_e]!==c.canonical.z,ue=le.borderFeatureIndices[_e];let ye=0;if(c.canonical.z!==le.canonical.z){for(const xe of J)c.showCentroid(c.featuresOnBorder[xe]);if(pe)for(const xe of ue)le.showCentroid(le.featuresOnBorder[xe]);c.borderDoneWithNeighborZ[X]=le.canonical.z,le.borderDoneWithNeighborZ[_e]=c.canonical.z}for(const xe of J){const Pe=c.featuresOnBorder[xe],Le=c.centroidData[Pe.centroidDataIndex],Ye=Pe.borders[X];let Xe;for(;ye<ue.length;){Xe=le.featuresOnBorder[ue[ye]];const ot=Xe.borders[_e];if(ot[1]>Ye[0]+3||ot[0]>Ye[0]-3)break;le.showCentroid(Xe),ye++}if(Xe&&ye<ue.length){const ot=ye;let ze=0;for(;!(Xe.borders[_e][0]>Ye[1]-3)&&(ze++,++ye!==ue.length);)Xe=le.featuresOnBorder[ue[ye]];Xe=le.featuresOnBorder[ue[ot]];let $e=!1;if(ze>=1){const Ve=Xe.borders[_e];Math.abs(Ye[0]-Ve[0])<3&&Math.abs(Ye[1]-Ve[1])<3&&(ze=1,$e=!0,ye=ot+1)}else if(ze===0){c.showCentroid(Pe);continue}const Ie=le.centroidData[Xe.centroidDataIndex];y&&$e&&(((V=Le).flags|(W=Ie).flags)&s.dW?(V.flags|=s.dW,W.flags|=s.dW):(V.flags&=2147483647,W.flags&=2147483647));const Je=Pe.intersectsCount()>1||Xe.intersectsCount()>1;if(ze>1)ye=ot,Le.centroidXY=Ie.centroidXY=new s.P(0,0);else if(ge&&ge.dem&&!Je){const Ve=F[X](Le,Ie),st=X%2?s.aj-1:0,vt=q(Ve[0],Math.min(s.aj-1,Ve[1]),st,ge,se,X<2,Ve[2]);Le.centroidXY=Ie.centroidXY=S(vt)}else Je?Le.centroidXY=Ie.centroidXY=new s.P(0,0):(Le.centroidXY=c.encodeBorderCentroid(Pe),Ie.centroidXY=le.encodeBorderCentroid(Xe));c.writeCentroidToBuffer(Le),le.writeCentroidToBuffer(Ie)}else c.showCentroid(Pe)}c.borderDoneWithNeighborZ[X]=le.canonical.z,le.borderDoneWithNeighborZ[_e]=c.canonical.z}var V,W;(c.needsCentroidUpdate||!c.centroidVertexBuffer&&c.centroidVertexArray.length!==0)&&c.uploadCentroid(l)}const Pf=[1,0,0],Ya=[0,1,0],xo=[0,0,1];function Ka(l,t,i){const c=i.transform,f=i.shadowRenderer;if(!f)return!0;const m=l.toUnwrapped(),y=c.tileSize*f._cascades[i.currentShadowCascade].scale;let w=t.maxHeight;if(c.elevation){const V=c.elevation.getMinMaxForTile(l);V&&(w+=V.max)}const S=[...f.shadowDirection];S[2]=-S[2];const M=f.computeSimplifiedTileShadowVolume(m,w,y,S);if(!M)return!1;const P=[Pf,Ya,xo,S,[S[0],0,S[2]],[0,S[1],S[2]]],O=c.projection.name==="globe",D=c.scaleZoom(y),F=s.cn.fromInvProjectionMatrix(c.invProjMatrix,c.worldSize,D,!O),q=f.getCurrentCascadeFrustum();return F.intersectsPrecise(M.vertices,M.planes,P)===0||q.intersectsPrecise(M.vertices,M.planes,P)===0}function sr(l){return[l[0]*s.dZ,l[1]*s.dZ,l[2]*s.dZ,0]}function ea(l,t,i,c,f,m,y,w,S){const M=c.getSource(),P=i.globeSharedBuffers;if(!P)return;let O,D,F;if(t&&(O=c.getTile(t)),M instanceof s.aP?(D=M.texture,F=s.ds(0,0,i.transform)):O&&t&&(D=O.texture,F=s.ds(t.canonical.z,t.canonical.x,i.transform)),!D||!F)return;l||(F=s.cE(s.bz(),F,[1,-1,1]));const q=i.context,V=q.gl,W=f.paint.get("raster-resampling")==="nearest"?V.NEAREST:V.LINEAR,X=i.colorModeForDrapableLayerRenderPass(m),J=y.defines;J.push("GLOBE_POLES");const se=new Bt(V.LEQUAL,Bt.ReadWrite,i.depthRangeFor3D),le=Float32Array.from(i.transform.expandedFarZProjMatrix),ge=Float32Array.from(s.bh(s.dr(new s.cp(0,0,0))));i.terrain&&i.terrain.prepareDrawTile(),q.activeTexture.set(V.TEXTURE0),D.bind(W,V.CLAMP_TO_EDGE),q.activeTexture.set(V.TEXTURE1),D.bind(W,V.CLAMP_TO_EDGE),"useMipmap"in D&&q.extTextureFilterAnisotropic&&i.transform.pitch>20&&V.texParameterf(V.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);const[_e,pe,ue,ye]=t?P.getPoleBuffers(t.canonical.z,!1):P.getPoleBuffers(0,!0),xe=f.paint.get("raster-elevation");let Pe;l?(Pe=_e,i.renderDefaultNorthPole=xe!==0):(Pe=pe,i.renderDefaultSouthPole=xe!==0);const Le=sr(y.mix),Ye=((ot,ze,$e,Ie,Je,Ve,st,vt,Qe,pt,Pt,Lt,Mt)=>kh(ot,ze,$e,new Float32Array(16),new Float32Array(9),[0,0],Ie,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ve,[0,0],vt,2,pt,Pt,Lt,1,0,Mt))(le,ge,F,s.ah(i.transform.zoom),0,f,0,xe,0,Le,y.offset,y.range,m),Xe=i.getOrCreateProgram("raster",{defines:J});i.uploadCommonUniforms(q,Xe,null),Xe.draw(i,V.TRIANGLES,se,S,X,w,Ye,f.id,Pe,ue,ye)}function pc(l){const t=l._nearZ,i=l.projection.farthestPixelDistance(l),c=i-t,f=.2*l.height,m=t+f;return[t,i,(m-f-t)/c,(m-t)/c]}function Pd(l,t,i,c){if(l)return t instanceof $l&&l instanceof Mc?t.getTextureDescriptor(l,i,!0):{texture:l.texture,mix:sr(c.mix),offset:c.offset,buffer:0,tileSize:1}}var Rd=s.d_([{name:"a_index",type:"Int16",components:1}]);class Bh{constructor(t,i,c,f){const m={width:c[0],height:c[1],data:null},y=t.gl;this.targetColorTexture=new s.T(t,m,y.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(t,m,y.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(i,f),this.lastInvalidatedAt=0}updateParticleTexture(t,i){if(this.particleTextureDimension===i.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const c=this.context.gl,f=i.width*i.height;this.particleTexture0=new s.T(this.context,i,c.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,i,c.RGBA8,{premultiply:!1,useMipmap:!1});const m=new s.d$;m.reserve(f);for(let y=0;y<f;y++)m.emplaceBack(y);this.particleIndexBuffer=this.context.createVertexBuffer(m,Rd.members,!0),this.particleSegment=s.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=i.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=s.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Ip(l,t,i){if(!l)return null;const c=t.getTextureDescriptor(l,i,!0);if(!c)return null;let{texture:f,mix:m,offset:y,tileSize:w,buffer:S,format:M}=c;if(!f||!M)return null;let P=!1;return M==="uint32"&&(P=!0,m[3]=0,m=Qo(s.e0,m,[0,i.paint.get("raster-particle-max-speed")]),y=Cd(s.e0,y,[0,i.paint.get("raster-particle-max-speed")])),{texture:f,textureOffset:[S/(w+2*S),w/(w+2*S)],tileSize:w,scalarData:P,scale:m,offset:y,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[M]]}}function Hu(l){const t=l._nearZ,i=l.projection.farthestPixelDistance(l),c=i-t,f=.2*l.height,m=t+f;return[t,i,(m-f-t)/c,(m-t)/c]}const Ja=new s.am(1,0,0,1),jh=new s.am(0,1,0,1),Bs=new s.am(0,0,1,1),El=new s.am(1,0,1,1),js=new s.am(0,1,1,1);function No(l,t,i,c,f,m){for(let y=0;y<i.length;y++)if(f){const M=new s.am(c.r*.8,c.g*.8,c.b*.8,1);mc(l,t,i[y],c,-1,-1,m),mc(l,t,i[y],c,-1,1,m),mc(l,t,i[y],c,1,1,m),mc(l,t,i[y],c,1,-1,m),mc(l,t,i[y],M,0,0,m)}else mc(l,t,i[y],c,0,0,m)}function mc(l,t,i,c,f,m,y){const w=l.context,S=l.transform,M=w.gl,P=S.projection.name==="globe",O=P?["PROJECTION_GLOBE_VIEW"]:[];let D=s.bw(i.projMatrix);if(P&&s.ah(S.zoom)>0){const Le=s.bg(i.canonical,S),Ye=s.e1(Le);D=s.az(new Float32Array(16),S.globeMatrix,Ye),s.az(D,S.projMatrix,D)}const F=s.bz();F[12]+=2*f/(s.q.devicePixelRatio*S.width),F[13]+=2*m/(s.q.devicePixelRatio*S.height),s.az(D,F,D);const q=l.getOrCreateProgram("debug",{defines:O}),V=t.getTileByID(i.key);l.terrain&&l.terrain.setupElevationDraw(V,q);const W=Bt.disabled,X=ur.disabled,J=l.colorModeForRenderPass(),se="$debug";w.activeTexture.set(M.TEXTURE0),l.emptyTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),P?V._makeGlobeTileDebugBuffers(l.context,S):V._makeDebugTileBoundsBuffers(l.context,S.projection);const le=V._tileDebugBuffer||l.debugBuffer,ge=V._tileDebugIndexBuffer||l.debugIndexBuffer,_e=V._tileDebugSegments||l.debugSegments;if(q.draw(l,M.LINE_STRIP,W,X,J,ar.disabled,Wa(D,c.toPremultipliedRenderColor(null)),se,le,ge,_e,null,null,null,[V._globeTileDebugBorderBuffer]),y){const Le=V.latestRawTileData,Ye=Math.floor((Le&&Le.byteLength||0)/1024);let Xe=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(Xe+=` => ${i.overscaledZ}`),Xe+=` ${V.state}`,Xe+=` ${Ye}kb`,function(ot,ze){ot.initDebugOverlayCanvas();const $e=ot.debugOverlayCanvas,Ie=ot.context.gl,Je=ot.debugOverlayCanvas.getContext("2d");Je.clearRect(0,0,$e.width,$e.height),Je.shadowColor="white",Je.shadowBlur=2,Je.lineWidth=1.5,Je.strokeStyle="white",Je.textBaseline="top",Je.font="bold 36px Open Sans, sans-serif",Je.fillText(ze,5,5),Je.strokeText(ze,5,5),ot.debugOverlayTexture.update($e),ot.debugOverlayTexture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE)}(l,Xe)}const pe=t.getTile(i).tileSize,ue=512/Math.min(pe,512)*(i.overscaledZ/S.zoom)*.5,ye=V._tileDebugTextBuffer||l.debugBuffer,xe=V._tileDebugTextIndexBuffer||l.quadTriangleIndexBuffer,Pe=V._tileDebugTextSegments||l.debugSegments;q.draw(l,M.TRIANGLES,W,X,Gr.alphaBlended,ar.disabled,Wa(D,s.am.transparent.toPremultipliedRenderColor(null),ue),se,ye,xe,Pe,null,null,null,[V._globeTileDebugTextBuffer])}function Wu(l,t,i,c){Il(l,0,t+i/2,l.transform.width,i,c)}function Li(l,t,i,c){Il(l,t-i/2,0,i,l.transform.height,c)}function Il(l,t,i,c,f,m){const y=l.context,w=y.gl;w.enable(w.SCISSOR_TEST),w.scissor(t*s.q.devicePixelRatio,i*s.q.devicePixelRatio,c*s.q.devicePixelRatio,f*s.q.devicePixelRatio),y.clear({color:m}),w.disable(w.SCISSOR_TEST)}const zd=s.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ma}=zd;function zn(l,t,i,c){l.emplaceBack(t,i,c)}class Qc{constructor(t){this.vertexArray=new s.e2,this.indices=new s.a_,zn(this.vertexArray,-1,-1,1),zn(this.vertexArray,1,-1,1),zn(this.vertexArray,-1,1,1),zn(this.vertexArray,1,1,1),zn(this.vertexArray,-1,-1,-1),zn(this.vertexArray,1,-1,-1),zn(this.vertexArray,-1,1,-1),zn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Ma),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=s.bd.simpleSegment(0,0,36,12)}}function Bo(l,t,i,c,f,m){const y=l.context.gl,w=t.paint.get("sky-atmosphere-color"),S=t.paint.get("sky-atmosphere-halo-color"),M=t.paint.get("sky-atmosphere-sun-intensity"),P=((O,D,F,q,V)=>({u_matrix_3f:O,u_sun_direction:D,u_sun_intensity:F,u_color_tint_r:[q.r,q.g,q.b,q.a],u_color_tint_m:[V.r,V.g,V.b,V.a],u_luminance:5e-5}))(s.e4(s.dx(),c),f,M,w.toPremultipliedRenderColor(null),S.toPremultipliedRenderColor(null));y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_CUBE_MAP_POSITIVE_X+m,t.skyboxTexture,0),i.draw(l,y.TRIANGLES,Bt.disabled,ur.disabled,Gr.unblended,ar.frontCW,P,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Gi=s.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ms{constructor(t){const i=new s.e5;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const c=new s.a_;c.emplaceBack(0,1,2),c.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(i,Gi.members),this.indexBuffer=t.createIndexBuffer(c),this.segments=s.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const As=s.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class kd{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Qa{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Gr([1,Lc,1,Lc],s.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Gr([1,0,1,0],s.am.transparent,[!1,!1,!1,!0]),this.params=new kd,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const i=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ms(i);const c=this.params.sizeRange,f=this.params.intensityRange,m=function(P){const O=s.e7(30),D=[];for(let F=0;F<P;++F){const q=2*Math.PI*O(),V=Math.acos(1-2*O())-.5*Math.PI;D.push(s.cS(Math.cos(V)*Math.cos(q),Math.cos(V)*Math.sin(q),Math.sin(V)))}return D}(this.params.starsCount),y=s.e7(300),w=new s.e6,S=new s.a_;let M=0;for(let P=0;P<m.length;++P){const O=s.bY([],m[P],200),D=Math.max(0,1+.01*c*(1*y()-.5)),F=Math.max(0,1+.01*f*(1*y()-.5));w.emplaceBack(O[0],O[1],O[2],-1,-1,D,F),w.emplaceBack(O[0],O[1],O[2],1,-1,D,F),w.emplaceBack(O[0],O[1],O[2],1,1,D,F),w.emplaceBack(O[0],O[1],O[2],-1,1,D,F),S.emplaceBack(M+0,M+1,M+2),S.emplaceBack(M+0,M+2,M+3),M+=4}this.starsVx=i.createVertexBuffer(w,As.members),this.starsIdx=i.createIndexBuffer(S),this.starsSegments=s.bd.simpleSegment(0,0,w.length,S.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,i){const c=t.context,f=c.gl,m=t.transform,y=new Bt(f.LEQUAL,Bt.ReadOnly,[0,1]),w=s.ah(m.zoom),S=t.style.getLut(i.scope),M=i.properties.get("color-use-theme")==="none",P=i.properties.get("color").toNonPremultipliedRenderColor(M?null:S).toArray01(),O=i.properties.get("high-color-use-theme")==="none",D=i.properties.get("high-color").toNonPremultipliedRenderColor(O?null:S).toArray01(),F=i.properties.get("space-color-use-theme")==="none",q=i.properties.get("space-color").toNonPremultipliedRenderColor(F?null:S).toArray01(),V=5e-4,W=s.e8(i.properties.get("horizon-blend"),0,1,V,.25),X=s.dl(t,c,m)&&W===V?m.worldSize/(2*Math.PI*1.025)-1:m.globeRadius,J=t.frameCounter/1e3%1,se=s.ae(m.globeCenterInViewSpace),le=Math.sqrt(Math.pow(se,2)-Math.pow(X,2)),ge=Math.acos(le/se),_e=pe=>{const ue=m.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];pe&&ue.push("ALPHA_PASS");const ye=t.getOrCreateProgram("globeAtmosphere",{defines:ue}),xe=((Le,Ye,Xe,ot,ze,$e,Ie,Je,Ve,st,vt,Qe)=>({u_frustum_tl:Le,u_frustum_tr:Ye,u_frustum_br:Xe,u_frustum_bl:ot,u_horizon:ze,u_transition:$e,u_fadeout_range:Ie,u_color:Je,u_high_color:Ve,u_space_color:st,u_temporal_offset:vt,u_horizon_angle:Qe}))(m.frustumCorners.TL,m.frustumCorners.TR,m.frustumCorners.BR,m.frustumCorners.BL,m.frustumCorners.horizon,w,W,P,D,q,J,ge);t.uploadCommonUniforms(c,ye);const Pe=this.atmosphereBuffer;Pe&&ye.draw(t,f.TRIANGLES,y,ur.disabled,pe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,ar.backCW,xe,pe?"atmosphere_glow_alpha":"atmosphere_glow",Pe.vertexBuffer,Pe.indexBuffer,Pe.segments)};_e(!1),_e(!0)}drawStars(t,i){const c=s.ay(i.properties.get("star-intensity"),0,1);if(c===0)return;const f=t.context,m=f.gl,y=t.transform,w=t.getOrCreateProgram("stars"),S=s.b_([]);s.c0(S,S,-y._pitch),s.b$(S,S,-y.angle),s.c0(S,S,s.al(y._center.lat)),s.e9(S,S,-s.al(y._center.lng));const M=s.c3(new Float32Array(16),S),P=s.az([],y.starsProjMatrix,M),O=s.e4([],M),D=s.ea([],O),F=[0,1,0];s.dz(F,F,D),s.bY(F,F,this.params.sizeMultiplier);const q=[1,0,0];s.dz(q,q,D),s.bY(q,q,this.params.sizeMultiplier);const V=(W=F,X=q,J=c,{u_matrix:Float32Array.from(P),u_up:W,u_right:X,u_intensity_multiplier:J});var W,X,J;t.uploadCommonUniforms(f,w),this.starsVx&&this.starsIdx&&w.draw(t,m.TRIANGLES,Bt.disabled,ur.disabled,this.colorModeAlphaBlendedWriteRGB,ar.disabled,V,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Pa(l,t){const i=[...l],c=t.cameraWorldSizeForFog/t.worldSize,f=s.bx([]);return s.cE(f,f,[c,c,1]),s.az(i,f,i),s.az(i,t.worldToFogMatrix,i),i}function gt(l,t,i,c,f){const m=i.material,y=c.context,{baseColorTexture:w,metallicRoughnessTexture:S}=m.pbrMetallicRoughness,{normalTexture:M,occlusionTexture:P,emissionTexture:O}=m;function D(q,V,W){if(q&&(l.push(V),y.activeTexture.set(y.gl.TEXTURE0+W),q.gfxTexture)){const{minFilter:X,magFilter:J,wrapS:se,wrapT:le}=q.sampler;q.gfxTexture.bindExtraParam(X,J,se,le)}}D(w,"HAS_TEXTURE_u_baseColorTexture",Qs.BaseColor),D(S,"HAS_TEXTURE_u_metallicRoughnessTexture",Qs.MetallicRoughness),D(M,"HAS_TEXTURE_u_normalTexture",Qs.Normal),D(P,"HAS_TEXTURE_u_occlusionTexture",Qs.Occlusion),D(O,"HAS_TEXTURE_u_emissionTexture",Qs.Emission),f&&(f.texture||(f.texture=new s.eh(c.context,f.image,[f.image.height,f.image.height,f.image.height],y.gl.RGBA8)),y.activeTexture.set(y.gl.TEXTURE0+Qs.LUT),f.texture&&f.texture.bind(y.gl.LINEAR,y.gl.CLAMP_TO_EDGE),l.push("APPLY_LUT_ON_GPU")),i.texcoordBuffer&&(l.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(i.texcoordBuffer)),i.colorBuffer&&(l.push(i.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(i.colorBuffer)),i.normalBuffer&&(l.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(i.normalBuffer)),i.pbrBuffer&&(l.push("HAS_ATTRIBUTE_a_pbr"),l.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(i.pbrBuffer)),m.alphaMode!=="OPAQUE"&&m.alphaMode!=="MASK"||l.push("UNPREMULT_TEXTURE_IN_SHADER"),m.defined||l.push("DIFFUSE_SHADED");const F=c.shadowRenderer;F&&(l.push("RENDER_SHADOWS","DEPTH_TEXTURE"),F.useNormalOffset&&l.push("NORMAL_OFFSET"))}function It(l,t,i,c,f,m){const y=i.paint.get("model-opacity").constantOr(1),w=t.context,S=new Bt(t.context.gl.LEQUAL,Bt.ReadWrite,t.depthRangeFor3D),M=t.transform,P=l.mesh,O=P.material,D=O.pbrMetallicRoughness,F=t.style.fog;let q;q=t.transform.projection.zAxisUnit==="pixels"?[...l.nodeModelMatrix]:s.az([],c.zScaleMatrix,l.nodeModelMatrix),s.az(q,c.negCameraPosMatrix,q);const V=s.bi([],q);s.ee(V,V);const W=i.paint.get("model-color-use-theme").constantOr("default")==="none",X=i.paint.get("model-emissive-strength").constantOr(0),J=lc(new Float32Array(l.worldViewProjection),new Float32Array(q),new Float32Array(V),null,t,y,D.baseColorFactor,O.emissiveFactor,D.metallicFactor,D.roughnessFactor,O,X,i),se={defines:[]},le=[],ge=t.shadowRenderer;ge&&(ge.useNormalOffset=!1),gt(se.defines,le,P,t,W?null:i.lut);let _e=null;if(F){const ye=Pa(l.nodeModelMatrix,t.transform);if(_e=new Float32Array(ye),M.projection.name!=="globe"){const xe=P.aabb.min,Pe=P.aabb.max,[Le,Ye]=F.getOpacityForBounds(ye,xe[0],xe[1],Pe[0],Pe[1]);se.overrideFog=Le>=Ue||Ye>=Ue}}const pe=ko(t,i.paint.get("model-cutoff-fade-range"));pe.shouldRenderCutoff&&se.defines.push("RENDER_CUTOFF");const ue=t.getOrCreateProgram("model",se);t.uploadCommonUniforms(w,ue,null,_e,pe),t.renderPass!=="shadow"&&ge&&ge.setupShadowsFromMatrix(l.nodeModelMatrix,ue),ue.draw(t,w.gl.TRIANGLES,S,f,m,P.material.doubleSided?ar.disabled:ar.backCCW,J,i.id,P.vertexBuffer,P.indexBuffer,P.segments,i.paint,t.transform.zoom,void 0,le)}function Al(l,t,i,c,f,m,y){let w;w=l.projection.name==="globe"?s.ed(i,l):[...i],s.az(w,w,t.matrix);const S=s.az([],c,w);if(t.meshes)for(const M of t.meshes){if(M.material.alphaMode!=="BLEND"){y.push({mesh:M,depth:0,modelIndex:f,worldViewProjection:S,nodeModelMatrix:w});continue}const P=s.ad([],M.centroid,S);!l.isOrthographic&&P[2]<=0||m.push({mesh:M,depth:P[2],modelIndex:f,worldViewProjection:S,nodeModelMatrix:w})}if(t.children)for(const M of t.children)Al(l,M,i,c,f,m,y)}function fi(l,t,i,c){const f=i.shadowRenderer;if(!f)return;const m=f.getShadowPassDepthMode(),y=f.getShadowPassColorMode(),w=f.calculateShadowPassMatrixFromMatrix(t),S=Mf(w);i.getOrCreateProgram("modelDepth",{defines:i._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(i,i.context.gl.TRIANGLES,m,ur.disabled,y,ar.backCCW,S,c.id,l.vertexBuffer,l.indexBuffer,l.segments,c.paint,i.transform.zoom,void 0,void 0)}function ke(l,t,i){const c=t.updateZoomBasedPaintProperties(),f=function(m,y,w){let S,M,P,O=m.terrain?m.terrain.exaggeration():0;if(m.terrain&&O>0){const D=m.terrain,F=D.findDEMTileFor(w);F&&F.dem?S=s.ei.create(D,w,F):O=0}if(O===0&&(y.terrainElevationMin=0,y.terrainElevationMax=0),O===y.validForExaggeration&&(O===0||S&&S._demTile&&S._demTile.tileID===y.validForDEMTile.id&&S._dem._timestamp===y.validForDEMTile.timestamp))return!1;for(const D in y.instancesPerModel){const F=y.instancesPerModel[D];for(let q=0;q<F.instancedDataArray.length;++q){const V=(S?O*S.getElevationAt(0|F.instancedDataArray.float32[16*q],0|F.instancedDataArray.float32[16*q+1],!0,!0):0)+F.instancesEvaluatedElevation[q];F.instancedDataArray.float32[16*q+6]=V,M=M?Math.min(y.terrainElevationMin,V):V,P=P?Math.max(y.terrainElevationMax,V):V}}return y.terrainElevationMin=M||0,y.terrainElevationMax=P||0,y.validForExaggeration=O,y.validForDEMTile=S&&S._demTile?{id:S._demTile.tileID,timestamp:S._dem._timestamp}:{id:void 0,timestamp:0},!0}(l,t,i);(c||f)&&(t.uploaded=!1,t.upload(l.context))}const gs={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.cW([0,0,0],[s.aj,s.aj,0])};function wo(l,t){const i=1<<l.canonical.z,c=t.getFreeCameraOptions().position,f=t.elevation,m=l.canonical.x/i,y=(l.canonical.x+1)/i,w=l.canonical.y/i,S=(l.canonical.y+1)/i;let M=t._centerAltitude;if(f){const F=f.getMinMaxForTile(l);F&&F.max>M&&(M=F.max)}const P=s.ay(c.x,m,y)-c.x,O=s.ay(c.y,w,S)-c.y,D=s.c6(M,t.center.lat)-c.z;return t._zoomFromMercatorZ(Math.sqrt(P*P+O*O+D*D))}function gc(l,t,i,c,f,m,y){const w=l.context,S=l.renderPass==="shadow",M=l.shadowRenderer,P=S&&M?M.getShadowPassDepthMode():new Bt(w.gl.LEQUAL,Bt.ReadWrite,l.depthRangeFor3D),O=l.isTileAffectedByFog(m);if(i.meshes)for(const D of i.meshes){const F=["MODEL_POSITION_ON_GPU"],q=[];let V,W,X;c.instancedDataArray.length>20&&F.push("INSTANCED_ARRAYS");const J=ko(l,t.paint.get("model-cutoff-fade-range"));if(J.shouldRenderCutoff&&F.push("RENDER_CUTOFF"),S&&M)V=l.getOrCreateProgram("modelDepth",{defines:F}),W=Mf(y.shadowTileMatrix,y.shadowTileMatrix,Float32Array.from(i.matrix)),X=M.getShadowPassColorMode();else{gt(F,q,D,l,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),V=l.getOrCreateProgram("model",{defines:F,overrideFog:O});const le=D.material,ge=le.pbrMetallicRoughness,_e=t.paint.get("model-opacity").constantOr(1),pe=t.paint.get("model-emissive-strength").constantOr(0);W=lc(m.expandedProjMatrix,Float32Array.from(i.matrix),new Float32Array(16),null,l,_e,ge.baseColorFactor,le.emissiveFactor,ge.metallicFactor,ge.roughnessFactor,le,pe,t,f),M&&(y.shadowUniformsInitialized?V.setShadowUniformValues(w,M.getShadowUniformValues()):(M.setupShadows(m.toUnwrapped(),V,"model-tile",m.overscaledZ),y.shadowUniformsInitialized=!0)),X=J.shouldRenderCutoff||_e<1||le.alphaMode!=="OPAQUE"?Gr.alphaBlended:Gr.unblended}l.uploadCommonUniforms(w,V,m.toUnwrapped(),null,J);const se=D.material.doubleSided?ar.disabled:ar.backCCW;if(c.instancedDataArray.length>20)q.push(c.instancedDataBuffer),V.draw(l,w.gl.TRIANGLES,P,ur.disabled,X,se,W,t.id,D.vertexBuffer,D.indexBuffer,D.segments,t.paint,l.transform.zoom,void 0,q,c.instancedDataArray.length);else{const le=S?"u_instance":"u_normal_matrix";for(let ge=0;ge<c.instancedDataArray.length;++ge)W[le]=new Float32Array(c.instancedDataArray.arrayBuffer,64*ge,16),V.draw(l,w.gl.TRIANGLES,P,ur.disabled,X,se,W,t.id,D.vertexBuffer,D.indexBuffer,D.segments,t.paint,l.transform.zoom,void 0,q)}}if(i.children)for(const D of i.children)gc(l,t,D,c,f,m,y)}const Vh=[1,-1,1];function Dd(l,t,i,c){if(!i.modelManager)return!0;const f=i.modelManager;if(!i.shadowRenderer)return!0;const m=i.shadowRenderer,y=t.aabb;let w=!0,S=l.maxHeight;if(S===0){let P=0;for(const O in l.instancesPerModel){const D=f.getModel(O,c);D?P=Math.max(P,Math.max(Math.max(D.aabb.max[0],D.aabb.max[1]),D.aabb.max[2])):w=!1}S=l.maxScale*P*1.41+l.maxVerticalOffset,w&&(l.maxHeight=S)}y.max[2]=S,y.min[2]+=l.terrainElevationMin,y.max[2]+=l.terrainElevationMax,s.ad(y.min,y.min,t.tileMatrix),s.ad(y.max,y.max,t.tileMatrix);const M=y.intersects(m.getCurrentCascadeFrustum());return i.currentShadowCascade===0&&(l.isInsideFirstShadowMapFrustum=M===2),M===0}function Rf(l,t){const i=l.uniformValues.u_cutoff_params[0],c=l.uniformValues.u_cutoff_params[1],f=l.uniformValues.u_cutoff_params[2],m=l.uniformValues.u_cutoff_params[3];return c===i||m===f?1:s.ay(((t-i)/(c-i)-f)/(m-f),0,1)}function eu(l,t,i,c){if(t.pitch<20)return 1;const f=t.getWorldToCameraMatrix();s.az(f,f,l);const m=s.ej(i.min[0],i.min[1],i.min[2],1);let y=s.aA(s.ek(),m,f),w=y,S=y;m[1]=i.max[1],y=s.aA(s.ek(),m,f),w=y[1]<w[1]?y:w,S=y[1]>S[1]?y:S,m[0]=i.max[0],y=s.aA(s.ek(),m,f),w=y[1]<w[1]?y:w,S=y[1]>S[1]?y:S,m[1]=i.min[1],y=s.aA(s.ek(),m,f),w=y[1]<w[1]?y:w,S=y[1]>S[1]?y:S;const M=s.ay(c[0],0,1),P=100*t.pixelsPerMeter*s.ay(c[1],0,1),O=s.ay(c[2],0,1),D=s.el(s.ek(),w,S,M),F=Math.tan(.5*t.fovX),q=-D[2]*F;if(P===0)return D[1]<-Math.abs(q)?O:1;const V=(-Math.abs(q)-D[1])/P,W=(J,se,le)=>(1-le)*J+le*se,X=s.ay(W(1,O,V),O,1);return W(1,X,s.ay((t.pitch-20)/20,0,1))}class Ap{}class Cp{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,i,c){{const O=this._storage.get(i.id);if(O)return O.lastUsedFrameIdx=t,O.buf}const f=c.gl,m=f.getBufferParameter(f.ELEMENT_ARRAY_BUFFER,f.BUFFER_SIZE),y=new ArrayBuffer(m),w=new Int16Array(y);f.getBufferSubData(f.ELEMENT_ARRAY_BUFFER,0,new Int16Array(y));const S=new s.en;for(let O=0;O<m/2;O+=3){const D=w[O],F=w[O+1],q=w[O+2];S.emplaceBack(D,F),S.emplaceBack(F,q),S.emplaceBack(q,D)}const M=c.bindVertexArrayOES.current,P=new Ap;return P.buf=new Fo(c,S),P.lastUsedFrameIdx=t,this._storage.set(i.id,P),c.bindVertexArrayOES.set(M),P.buf}update(t){for(const[i,c]of this._storage)t-c.lastUsedFrameIdx>30&&(c.buf.destroy(),this._storage.delete(i))}destroy(){for(const[t,i]of this._storage)i.buf.destroy(),this._storage.delete(t)}}class zf{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Uh=s.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Ld{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Od{constructor(t,i){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...i,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...i,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Zu=s.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class $h{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,i){const c=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const y=new s.eo,w=new s.a_;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(1,1),y.emplaceBack(-1,1),w.emplaceBack(0,1,2),w.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(y,Zu.members),this.vignetteIdx=t.context.createIndexBuffer(w)}const f=s.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,c);const y={u_vignetteShape:(m={vignetteShape:[i.start,i.range,Math.pow(10,i.fadePower)],vignetteColor:[i.color.r,i.color.g,i.color.b,i.color.a*i.strength]}).vignetteShape,u_vignetteColor:m.vignetteColor};c.draw(t,t.context.gl.TRIANGLES,Bt.disabled,ur.disabled,Gr.alphaBlended,ar.disabled,y,"vignette",this.vignetteVx,this.vignetteIdx,f)}var m}}class _c{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,i){const c=t.getFreeCameraOptions().position,f=c.toAltitude(),m=c.toLngLat(),y=s.al(m.lng),w=s.al(m.lat),S=t.pixelsPerMeter/i,M=y*s.eq,P=s.eq*Math.log(Math.tan(Math.PI/4+w/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const O=-this._offsetYPrev+P,D=-this._elevationPrev+f;this._accumulatedOffsetX+=(-this._offsetXPrev+M)*S,this._accumulatedOffsetY+=O*S,this._accumulatedElevation+=D*S,this._offsetXPrev=M,this._offsetYPrev=P,this._elevationPrev=f}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function el(l,t){return[-(l[0]-Math.floor(l[0]/t)*t),-(l[1]-Math.floor(l[1]/t)*t),-(l[2]-Math.floor(l[2]/t)*t)]}function Fd(l){const t=s.e7(1323123451230),i=[];for(let c=0;c<l;++c){const f=2*t()-1,m=2*t()-1,y=2*t()-1;i.push(s.cS(f,m,y))}return i}function tl(l,t,i,c,f){const m=s.ay((f-i)/(c-i),0,1);return(1-m)*l+m*t}class Vs{constructor(t){this._movement=new _c,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new $h,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,i){const c=t.transform;this._movement.update(c,this._ppmScaleFactor);const f=c.starsProjMatrix,m=s.b_([]);s.c0(m,m,s.al(90)-c._pitch),s.b$(m,m,-c.angle);const y=s.c3(new Float32Array(16),m),w=s.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),S=s.ee([],w),M=s.az([],S,y),P=Date.now()/1e3;return this._accumulatedTimeFromStart+=(P-this._prevTime)*i,this._prevTime=P,{projectionMatrix:f,modelviewMatrix:M}}}class Mp extends Vs{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Od(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const i=t.context;if(!this.particlesVx){const c=Fd(this.particlesCount),f=new s.er,m=new s.a_;let y=0;const w=s.e7(1323123451230);for(let S=0;S<c.length;++S){const M=c[S],P=[2*w()-1,w(),w(),w()];f.emplaceBack(M[0],M[1],M[2],-1,-1,...P),f.emplaceBack(M[0],M[1],M[2],1,-1,...P),f.emplaceBack(M[0],M[1],M[2],1,1,...P),f.emplaceBack(M[0],M[1],M[2],-1,1,...P),m.emplaceBack(y+0,y+1,y+2),m.emplaceBack(y+0,y+2,y+3),y+=4}this.particlesVx=i.createVertexBuffer(f,Uh.members),this.particlesIdx=i.createIndexBuffer(m)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const i=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},c=t.transform.zoom;if(i.revealStart>c)return;const f=tl(0,1,i.revealStart,i.revealStart+i.revealRange,c);if(!this.particlesVx||!this.particlesIdx)return;const m=structuredClone(this._params);let y=[-m.direction.x,m.direction.y,-100];s.au(y,y);const w=structuredClone(this._vignetteParams);w.strength*=f,m.overrideStyleParameters||(m.intensity=t.style.rain.state.density,m.timeFactor=t.style.rain.state.intensity,m.color=structuredClone(t.style.rain.state.color),y=structuredClone(t.style.rain.state.direction),m.screenThinning.intensity=t.style.rain.state.centerThinning,m.dropletSizeX=t.style.rain.state.dropletSize[0],m.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],m.distortionStrength=100*t.style.rain.state.distortionStrength,w.strength=1,w.color=structuredClone(t.style.rain.state.vignetteColor));const S=this.updateOnRender(t,m.timeFactor),M=t.context,P=M.gl,O=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new s.T(M,{width:t.width,height:t.height,data:null},P.RGBA8)),m.distortionStrength>0&&(M.activeTexture.set(P.TEXTURE0),this.screenTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),P.copyTexSubImage2D(P.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const D=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(M,D),M.activeTexture.set(P.TEXTURE0),this.screenTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE);const F=[m.color.r,m.color.g,m.color.b,m.color.a],q=(V,W)=>{const X=el(this._movement.getPosition(),V),J=m.dropletSizeX,se=m.dropletSizeX*m.dropletSizeYScale,le=t.width/2,ge=t.height/2,_e=tl(0,m.screenThinning.start,0,1,m.screenThinning.intensity),pe=tl(.001,m.screenThinning.range,0,1,m.screenThinning.intensity),ue=tl(0,m.screenThinning.particleOffset,0,1,m.screenThinning.intensity),ye=(xe={modelview:S.modelviewMatrix,projection:S.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:X,velocityConeAperture:m.velocityConeAperture,velocity:m.velocity,boxSize:V,rainDropletSize:[J,se],distortionStrength:m.distortionStrength,rainDirection:y,color:F,screenSize:[O.width,O.height],thinningCenterPos:[le,ge],thinningShape:[_e,pe,Math.pow(10,m.screenThinning.fadePower)],thinningAffectedRatio:m.screenThinning.affectedRatio,thinningParticleOffset:ue,shapeDirectionalPower:m.shapeDirPower,shapeNormalPower:m.shapeNormalPower,mode:W?0:1},{u_modelview:Float32Array.from(xe.modelview),u_projection:Float32Array.from(xe.projection),u_time:xe.time,u_cam_pos:xe.camPos,u_texScreen:0,u_velocityConeAperture:xe.velocityConeAperture,u_velocity:xe.velocity,u_boxSize:xe.boxSize,u_rainDropletSize:xe.rainDropletSize,u_distortionStrength:xe.distortionStrength,u_rainDirection:xe.rainDirection,u_color:xe.color,u_screenSize:xe.screenSize,u_thinningCenterPos:xe.thinningCenterPos,u_thinningShape:xe.thinningShape,u_thinningAffectedRatio:xe.thinningAffectedRatio,u_thinningParticleOffset:xe.thinningParticleOffset,u_shapeDirectionalPower:xe.shapeDirectionalPower,u_shapeNormalPower:xe.shapeNormalPower,u_mode:xe.mode});var xe;const Pe=Math.round(m.intensity*this.particlesCount),Le=s.bd.simpleSegment(0,0,4*Pe,2*Pe);D.draw(t,P.TRIANGLES,Bt.disabled,ur.disabled,Gr.alphaBlended,ar.disabled,ye,"rain_particles",this.particlesVx,this.particlesIdx,Le)};m.distortionStrength>0&&q(m.boxSize,!0),q(m.boxSize,!1),this._vignette.draw(t,w)}}const Xu=s.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Kn extends Vs{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Od(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const i=t.context;if(!this.particlesVx){const c=Fd(this.particlesCount),f=new s.es,m=new s.a_;let y=0;const w=s.e7(1323123451230);for(let S=0;S<c.length;++S){const M=c[S],P=w(),O=w(),D=w(),F=[S/c.length,P,O,D],q=[w(),w()];f.emplaceBack(M[0],M[1],M[2],-1,-1,...F,...q),f.emplaceBack(M[0],M[1],M[2],1,-1,...F,...q),f.emplaceBack(M[0],M[1],M[2],1,1,...F,...q),f.emplaceBack(M[0],M[1],M[2],-1,1,...F,...q),m.emplaceBack(y+0,y+1,y+2),m.emplaceBack(y+0,y+2,y+3),y+=4}this.particlesVx=i.createVertexBuffer(f,Xu.members),this.particlesIdx=i.createIndexBuffer(m)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const i=structuredClone(this._params);let c=[-i.direction.x,i.direction.y,-100];s.au(c,c);const f=structuredClone(this._vignetteParams),m=i.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},y=t.transform.zoom;if(m.revealStart>y)return;const w=tl(0,1,m.revealStart,m.revealStart+m.revealRange,y);f.strength*=w,i.overrideStyleParameters||(i.intensity=t.style.snow.state.density,i.timeFactor=t.style.snow.state.intensity,i.color=structuredClone(t.style.snow.state.color),c=structuredClone(t.style.snow.state.direction),i.screenThinning.intensity=t.style.snow.state.centerThinning,i.billboardSize=2.79*t.style.snow.state.flakeSize,f.strength=1,f.color=structuredClone(t.style.snow.state.vignetteColor));const S=this.updateOnRender(t,i.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const M=t.context,P=M.gl,O=t.transform,D=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(M,D),((F,q,V)=>{const W=el(this._movement.getPosition(),F),X=O.width/2,J=O.height/2,se=tl(0,V.screenThinning.start,0,1,V.screenThinning.intensity),le=tl(.001,V.screenThinning.range,0,1,V.screenThinning.intensity),ge=tl(0,V.screenThinning.particleOffset,0,1,V.screenThinning.intensity),_e=(pe={modelview:S.modelviewMatrix,projection:S.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:W,velocityConeAperture:V.velocityConeAperture,velocity:V.velocity,horizontalOscillationRadius:V.horizontalOscillationRadius,horizontalOscillationRate:V.horizontalOscillationRate,boxSize:F,billboardSize:1*V.billboardSize,simpleShapeParameters:[V.shapeFadeStart,V.shapeFadePower],screenSize:[O.width,O.height],thinningCenterPos:[X,J],thinningShape:[se,le,Math.pow(10,V.screenThinning.fadePower)],thinningAffectedRatio:V.screenThinning.affectedRatio,thinningParticleOffset:ge,color:[V.color.r,V.color.g,V.color.b,V.color.a],direction:c},{u_modelview:Float32Array.from(pe.modelview),u_projection:Float32Array.from(pe.projection),u_time:pe.time,u_cam_pos:pe.camPos,u_velocityConeAperture:pe.velocityConeAperture,u_velocity:pe.velocity,u_horizontalOscillationRadius:pe.horizontalOscillationRadius,u_horizontalOscillationRate:pe.horizontalOscillationRate,u_boxSize:pe.boxSize,u_billboardSize:pe.billboardSize,u_simpleShapeParameters:pe.simpleShapeParameters,u_screenSize:pe.screenSize,u_thinningCenterPos:pe.thinningCenterPos,u_thinningShape:pe.thinningShape,u_thinningAffectedRatio:pe.thinningAffectedRatio,u_thinningParticleOffset:pe.thinningParticleOffset,u_particleColor:pe.color,u_direction:pe.direction});var pe;const ue=Math.round(V.intensity*this.particlesCount),ye=s.bd.simpleSegment(0,0,4*ue,2*ue);this.particlesVx&&this.particlesIdx&&D.draw(t,P.TRIANGLES,Bt.disabled,ur.disabled,Gr.alphaBlended,ar.disabled,_e,"snow_particles",this.particlesVx,this.particlesIdx,ye)})(i.boxSize,0,i),this._vignette.draw(t,f)}}const pn={symbol:function(l,t,i,c,f){if(l.renderPass!=="translucent")return;const m=ur.disabled,y=l.colorModeForRenderPass(),w=i.layout.get("text-variable-anchor"),S=i.layout.get("text-size-scale-range"),M=s.ay(l.scaleFactor,S[0],S[1]);w&&function(D,F,q,V,W,X,J,se){const le=F.transform,ge=W==="map",_e=X==="map";for(const pe of D){const ue=V.getTile(pe),ye=ue.getBucket(q);if(!ye||!ye.text||!ye.text.segments.get().length)continue;const xe=s.bH(ye.textSizeData,le.zoom,se),Pe=Tu(pe,ye.getProjection(),le),Le=le.calculatePixelsToTileUnitsMatrix(ue),Ye=pl(Pe,ue.tileID.canonical,_e,ge,le,ye.getProjection(),Le),Xe=ye.hasIconTextFit()&&ye.hasIconData();xe&&Jc(ye,ge,_e,J,le,Ye,pe,Math.pow(2,le.zoom-ue.tileID.overscaledZ),xe,Xe)}}(c,l,i,t,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),f,M);const P=i.paint.get("icon-opacity").constantOr(1)!==0,O=i.paint.get("text-opacity").constantOr(1)!==0;i.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(P||O)?hc(l,t,i,c,m,y):(P&&hc(l,t,i,c,m,y,{onlyIcons:!0}),O&&hc(l,t,i,c,m,y,{onlyText:!0})),t.map.showCollisionBoxes&&(Sl(l,t,i,c,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),Sl(l,t,i,c,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))},circle:function(l,t,i,c){if(l.renderPass!=="translucent")return;const f=i.paint.get("circle-opacity"),m=i.paint.get("circle-stroke-width"),y=i.paint.get("circle-stroke-opacity"),w=i.layout.get("circle-sort-key").constantOr(1)!==void 0,S=i.paint.get("circle-emissive-strength");if(f.constantOr(1)===0&&(m.constantOr(1)===0||y.constantOr(1)===0))return;const M=l.context,P=M.gl,O=l.transform,D=!(!l.terrain||!l.terrain.enabled),F=i.layout.get("circle-elevation-reference"),q=l.depthModeForSublayer(0,Bt.ReadOnly),V=new Bt(l.context.gl.LEQUAL,Bt.ReadOnly,l.depthRangeFor3D),W=F==="none"||D?q:V,X=ur.disabled,J=l.colorModeForDrapableLayerRenderPass(S),se=O.projection.name==="globe",le=[s.aD(O.center.lng),s.aH(O.center.lat)],ge=[];for(let pe=0;pe<c.length;pe++){const ue=c[pe],ye=t.getTile(ue),xe=ye.getBucket(i);if(!xe||xe.projection.name!==O.projection.name)continue;const Pe=xe.programConfigurations.get(i.id),Le=xe.layoutVertexBuffer,Ye=xe.globeExtVertexBuffer,Xe=xe.indexBuffer,ot=s.dK(i),ze=[Ye],$e=l.isTileAffectedByFog(ue);se&&ot.push("PROJECTION_GLOBE_VIEW"),ot.push("DEPTH_D24"),l.terrain&&O.depthOcclusionForSymbolsAndCircles&&ot.push("DEPTH_OCCLUSION"),xe.hasElevation&&(ot.push("ELEVATED_ROADS"),ze.push(xe.elevatedLayoutVertexBuffer));const Ie=l.getOrCreateProgram("circle",{config:Pe,defines:ot,overrideFog:$e}),Je=O.projection.createInversionMatrix(O,ue.canonical),Ve={programConfiguration:Pe,program:Ie,layoutVertexBuffer:Le,dynamicBuffers:ze,indexBuffer:Xe,uniformValues:s.dL(l,ue,ye,Je,le,i),tile:ye};if(w){const st=xe.segments.get();for(const vt of st)ge.push({segments:new s.bd([vt]),sortKey:vt.sortKey,state:Ve})}else ge.push({segments:xe.segments,sortKey:0,state:Ve})}w&&ge.sort((pe,ue)=>pe.sortKey-ue.sortKey);const _e={useDepthForOcclusion:O.depthOcclusionForSymbolsAndCircles};for(const pe of ge){const{programConfiguration:ue,program:ye,layoutVertexBuffer:xe,dynamicBuffers:Pe,indexBuffer:Le,uniformValues:Ye,tile:Xe}=pe.state,ot=pe.segments;l.terrain&&l.terrain.setupElevationDraw(Xe,ye,_e),l.uploadCommonUniforms(M,ye,Xe.tileID.toUnwrapped()),ye.draw(l,P.TRIANGLES,W,X,J,ar.disabled,Ye,i.id,xe,Le,ot,i.paint,O.zoom,ue,Pe)}},heatmap:function(l,t,i,c){if(i.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){const f=l.context,m=f.gl,y=ur.disabled,w=new Gr([m.ONE,m.ONE,m.ONE,m.ONE],s.am.transparent,[!0,!0,!0,!0]);(function(F,q,V,W){const X=F.gl,J=q.width*W,se=q.height*W;F.activeTexture.set(X.TEXTURE1),F.viewport.set([0,0,J,se]);let le=V.heatmapFbo;if(!le||le&&(le.width!==J||le.height!==se)){le&&le.destroy();const ge=X.createTexture();X.bindTexture(X.TEXTURE_2D,ge),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),le=V.heatmapFbo=F.createFramebuffer(J,se,!0,null),function(_e,pe,ue,ye,xe,Pe){const Le=_e.gl;Le.texImage2D(Le.TEXTURE_2D,0,_e.extRenderToTextureHalfFloat?Le.RGBA16F:Le.RGBA,xe,Pe,0,Le.RGBA,_e.extRenderToTextureHalfFloat?Le.HALF_FLOAT:Le.UNSIGNED_BYTE,null),ye.colorAttachment.set(ue)}(F,0,ge,le,J,se)}else X.bindTexture(X.TEXTURE_2D,le.colorAttachment.get()),F.bindFramebuffer.set(le.framebuffer)})(f,l,i,l.transform.projection.name==="globe"?.5:.25),f.clear({color:s.am.transparent});const S=l.transform,M=S.projection.name==="globe",P=M?["PROJECTION_GLOBE_VIEW"]:[],O=M?ar.frontCCW:ar.disabled,D=[s.aD(S.center.lng),s.aH(S.center.lat)];for(let F=0;F<c.length;F++){const q=c[F];if(t.hasRenderableParent(q))continue;const V=t.getTile(q),W=V.getBucket(i);if(!W||W.projection.name!==S.projection.name)continue;const X=l.isTileAffectedByFog(q),J=W.programConfigurations.get(i.id),se=l.getOrCreateProgram("heatmap",{config:J,defines:P,overrideFog:X}),{zoom:le}=l.transform;l.terrain&&l.terrain.setupElevationDraw(V,se),l.uploadCommonUniforms(f,se,q.toUnwrapped());const ge=S.projection.createInversionMatrix(S,q.canonical);se.draw(l,m.TRIANGLES,Bt.disabled,y,w,O,Za(l,q,V,ge,D,le,i.paint.get("heatmap-intensity")),i.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,i.paint,l.transform.zoom,J,M?[W.globeExtVertexBuffer]:null)}f.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(f,m){const y=f.context,w=y.gl,S=m.heatmapFbo;if(!S)return;y.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,S.colorAttachment.get()),y.activeTexture.set(w.TEXTURE1);let M=m.colorRampTexture;M||(M=m.colorRampTexture=new s.T(y,m.colorRamp,w.RGBA8)),M.bind(w.LINEAR,w.CLAMP_TO_EDGE),f.getOrCreateProgram("heatmapTexture").draw(f,w.TRIANGLES,Bt.disabled,ur.disabled,f.colorModeForRenderPass(),ar.disabled,((P,O,D,F)=>({u_image:0,u_color_ramp:1,u_opacity:O.paint.get("heatmap-opacity")}))(0,m),m.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments,m.paint,f.transform.zoom)}(l,i))},line:function(l,t,i,c){if(l.renderPass!=="translucent")return;const f=i.paint.get("line-opacity"),m=i.paint.get("line-width");if(f.constantOr(1)===0||m.constantOr(1)===0)return;const y=i.paint.get("line-emissive-strength"),w=i.paint.get("line-occlusion-opacity"),S=i.layout.get("line-elevation-reference"),M=i.layout.get("line-width-unit")==="meters",P=S==="sea",O=!(!l.terrain||!l.terrain.enabled),D=l.context,F=D.gl;if(i.hasElevatedBuckets&&l.transform.projection.name==="globe")return;const q=i.layout.get("line-cross-slope"),V=q!==void 0,W=q<1,X=l.colorModeForDrapableLayerRenderPass(y),J=l.terrain&&l.terrain.renderingToTexture,se=J?1:s.q.devicePixelRatio,le=i.paint.get("line-dasharray"),ge=le.constantOr(1),_e=i.layout.get("line-cap"),pe=le.constantOr(null),ue=_e.constantOr(null),ye=i.paint.get("line-pattern"),xe=ye.constantOr(1),Pe=i.paint.get("line-pattern-cross-fade"),Le=ye.constantOr(null),Ye=i.paint.get("line-opacity").constantOr(1);let Xe=!xe&&Ye!==1||l.depthOcclusion&&w>0&&w<1;const ot=i.paint.get("line-gradient"),ze=xe?"linePattern":"line",$e=s.dM(i);let Ie;if(J&&l.terrain&&l.terrain.clipOrMaskOverlapStencilType()&&(Xe=!1),w!==0&&l.depthOcclusion){const vt=i.paint._values["line-opacity"];vt&&vt.value&&vt.value.kind==="constant"?Ie=vt.value:s.w(`Occlusion opacity for layer ${i.id} is supported only when line-opacity isn't data-driven.`)}m.value.kind!=="constant"&&m.value.isLineProgressConstant===!1&&$e.push("VARIABLE_LINE_WIDTH");const Je=(vt,Qe,pt,Pt,Lt,Mt)=>{for(const Nt of vt){const er=t.getTile(Nt);if(xe&&!er.patternsLoaded())continue;const nr=er.getBucket(i);if(!nr||nr.elevationType!=="none"&&!Lt||nr.elevationType==="none"&&Lt)continue;l.prepareDrawTile();const dr=[...Qe],Dr=l.shadowRenderer,dn=nr.elevationType==="road"&&!!Dr&&Dr.enabled;let Gn=[0,0,0];if(dn){const hn=l.style.directionalLight,yi=l.style.ambientLight;hn&&yi&&(Gn=xl(l.style,hn,yi)),dr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Mn=nr.programConfigurations.get(i.id);let wn=!1;if(Le&&er.imageAtlas){const hn=s.dN.from(Le),yi=hn.getPrimary().scaleSelf(se).toString(),Jn=er.imageAtlas.patternPositions.get(yi),kn=hn.getSecondary(),Xn=kn?er.imageAtlas.patternPositions.get(kn.scaleSelf(se).toString()):null;wn=!!Jn&&!!Xn,Jn&&Mn.setConstantPatternPositions(Jn,Xn)}Pe>0&&(wn||Mn.getPatternTransitionVertexBuffer("line-pattern"))&&dr.push("LINE_PATTERN_TRANSITION");const wi=l.isTileAffectedByFog(Nt),yr=l.getOrCreateProgram(ze,{config:Mn,defines:dr,overrideFog:wi,overrideRtt:!Lt&&void 0});if(!xe&&pe&&ue&&er.lineAtlas){const hn=er.lineAtlas.getDash(pe,ue);hn&&Mn.setConstantPatternPositions(hn)}dn&&Dr.setupShadows(er.tileID.toUnwrapped(),yr,"vector-tile",er.tileID.overscaledZ);let[Lr,Wr]=i.paint.get("line-trim-offset");(ue==="round"||ue==="square")&&Lr!==Wr&&(Lr===0&&(Lr-=1),Wr===1&&(Wr+=1));const qn=J?Nt.projMatrix:null,Ci=M?1/nr.tileToMeter/s.aw(er,1,l.transform.zoom):1,Zn=M?1/nr.tileToMeter/s.aw(er,1,Math.floor(l.transform.zoom)):1,Sn=xe?s.dO(l,er,i,qn,se,Ci,Zn,[Lr,Wr],Gn,Pe):s.dP(l,er,i,qn,nr.lineClipsArray.length,se,Ci,Zn,[Lr,Wr],Gn);if(ot){const hn=nr.gradients[i.id];let yi=hn.texture;if(i.gradientVersion!==hn.version){let Jn=256;if(i.stepInterpolant){const kn=t.getSource().maxzoom,Xn=Nt.canonical.z===kn?Math.ceil(1<<l.transform.maxZoom-Nt.canonical.z):1;Jn=s.ay(s.dQ(nr.maxLineLength/s.aj*1024*Xn),256,D.maxTextureSize)}hn.gradient=s.dR({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:Jn,image:hn.gradient||void 0,clips:nr.lineClipsArray}),hn.texture?hn.texture.update(hn.gradient):hn.texture=new s.T(D,hn.gradient,F.RGBA8),hn.version=i.gradientVersion,yi=hn.texture}D.activeTexture.set(F.TEXTURE1),yi.bind(i.stepInterpolant?F.NEAREST:F.LINEAR,F.CLAMP_TO_EDGE)}ge&&(D.activeTexture.set(F.TEXTURE0),er.lineAtlasTexture&&er.lineAtlasTexture.bind(F.LINEAR,F.REPEAT),Mn.updatePaintBuffers()),xe&&(D.activeTexture.set(F.TEXTURE0),er.imageAtlasTexture&&er.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Mn.updatePaintBuffers()),Lt&&!P&&l.terrain.setupElevationDraw(er,yr),l.uploadCommonUniforms(D,yr,Nt.toUnwrapped());const _i=hn=>{Ie!=null&&(Ie.value=Ye*w),yr.draw(l,F.TRIANGLES,pt,hn,X,ar.disabled,Sn,i.id,nr.layoutVertexBuffer,nr.indexBuffer,nr.segments,i.paint,l.transform.zoom,Mn,[nr.layoutVertexBuffer2,nr.patternVertexBuffer,nr.zOffsetVertexBuffer]),Ie!=null&&(Ie.value=Ye)};if(Xe&&!Lt){const hn=l.stencilModeForClipping(Nt).ref;hn===0&&J&&D.clear({stencil:0});const yi={func:F.EQUAL,mask:255};Sn.u_alpha_discard_threshold=.8,_i(new ur(yi,hn,255,F.KEEP,F.KEEP,F.INVERT)),Sn.u_alpha_discard_threshold=0,_i(new ur(yi,hn,255,F.KEEP,F.KEEP,F.KEEP))}else Sn.u_alpha_discard_threshold=Xe&&Lt&&Mt?.8:0,_i(Lt?Pt:l.stencilModeForClipping(Nt))}};let Ve=l.depthModeForSublayer(0,Bt.ReadOnly);const st=new Bt(l.depthOcclusion?F.GREATER:F.LEQUAL,Bt.ReadOnly,l.depthRangeFor3D);if(i.hasNonElevatedBuckets){const vt=!J&&l.terrain;w!==0&&vt?s.w(`Occlusion opacity for layer ${i.id} is supported on terrain only if the layer has line-z-offset enabled.`):vt?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${i.id}.`):Je(c,$e,Ve,ur.disabled,!1,!0)}if(i.hasElevatedBuckets){S==="hd-road-markup"?O||(Ve=st,$e.push("ELEVATED_ROADS")):($e.push("ELEVATED"),Ve=st,V&&$e.push(W?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),P&&$e.push("ELEVATION_REFERENCE_SEA"));const vt=Xe?l.stencilModeFor3D():ur.disabled;l.forceTerrainMode=!0,Je(c,$e,Ve,vt,!0,!0),Xe&&Je(c,$e,Ve,vt,!0,!1),l.forceTerrainMode=!1}Xe&&(l.resetStencilClippingMasks(),J&&D.clear({stencil:0})),w===0||l.depthOcclusion||J||l.layersWithOcclusionOpacity.push(l.currentLayer)},fill:function(l,t,i,c){const f=i.paint.get("fill-color"),m=i.paint.get("fill-opacity");if(m.constantOr(1)===0)return;const y=i.paint.get("fill-emissive-strength"),w=l.colorModeForDrapableLayerRenderPass(y),S=i.paint.get("fill-pattern"),M=l.opaquePassEnabledForLayer()&&!S.constantOr(1)&&f.constantOr(s.am.transparent).a===1&&m.constantOr(0)===1?"opaque":"translucent";let P="none";i.layout.get("fill-elevation-reference")!=="none"?P="road":i.paint.get("fill-z-offset").constantOr(1)!==0&&(P="offset");const O=!(!l.terrain||!l.terrain.enabled),D={painter:l,sourceCache:t,layer:i,coords:c,colorMode:w,elevationType:P,terrainEnabled:O,pass:M};if(l.renderPass!=="shadow")if(P!=="offset"){if(fc(D,!1),P==="road"){const F=!O&&l.renderPass==="translucent";F&&Nh(l,t,i,c,"geometry"),fc(D,!0,ur.disabled),F&&function(q){const{painter:V,sourceCache:W,layer:X,coords:J,colorMode:se}=q,le=V.context.gl,ge=q.painter.shadowRenderer,_e=!!ge&&ge.enabled,pe=new Bt(V.context.gl.LEQUAL,Bt.ReadOnly,V.depthRangeFor3D);let ue=[0,0,0];if(_e){const xe=V.style.directionalLight,Pe=V.style.ambientLight;xe&&Pe&&(ue=xl(V.style,xe,Pe))}const ye=xe=>{for(const Pe of J){const Le=W.getTile(Pe),Ye=Le.getBucket(X);if(!Ye)continue;const Xe=Ye.elevatedStructures;if(!Xe)continue;let ot,ze;if(xe?(ot=Xe.renderableBridgeSegments,ze=Xe.bridgeProgramConfigurations.get(X.id)):(ot=Xe.renderableTunnelSegments,ze=Xe.tunnelProgramConfigurations.get(X.id)),!ot||ot.segments[0].primitiveLength===0)continue;ze.updatePaintBuffers(),V.prepareDrawTile();const $e=V.isTileAffectedByFog(Pe),Ie=[];_e&&Ie.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Je=V.getOrCreateProgram("elevatedStructures",{config:ze,overrideFog:$e,defines:Ie}),Ve=V.translatePosMatrix(Pe.projMatrix,Le,X.paint.get("fill-translate"),X.paint.get("fill-translate-anchor"));_e&&ge.setupShadows(Le.tileID.toUnwrapped(),Je,"vector-tile",Le.tileID.overscaledZ);const st=Ad(Ve,ue);V.uploadCommonUniforms(V.context,Je,Pe.toUnwrapped()),Je.draw(V,le.TRIANGLES,pe,ur.disabled,se,ar.backCCW,st,X.id,Xe.vertexBuffer,Xe.indexBuffer,ot,X.paint,V.transform.zoom,ze,[Xe.vertexBufferNormal])}};ye(!0),ye(!1)}(D)}}else fc(D,!1,l.stencilModeFor3D());else l.shadowRenderer&&P==="road"&&!O&&function(F){const{painter:q,sourceCache:V,layer:W,coords:X}=F,J=q.context.gl,se=F.painter.shadowRenderer;for(const le of X){const ge=V.getTile(le),_e=ge.getBucket(W);if(!_e)continue;const pe=_e.elevatedStructures;if(!pe||!pe.shadowCasterSegments||pe.shadowCasterSegments.segments[0].primitiveLength===0)continue;q.prepareDrawTile();const ue=_e.bufferData.programConfigurations.get(W.id),ye=q.isTileAffectedByFog(le),xe=q.getOrCreateProgram("elevatedStructuresDepth",{config:ue,overrideFog:ye}),Pe=se.calculateShadowPassMatrixFromTile(ge.tileID.toUnwrapped());q.uploadCommonUniforms(q.context,xe,le.toUnwrapped());const Le={u_matrix:Pe,u_depth_bias:.001};xe.draw(q,J.TRIANGLES,se.getShadowPassDepthMode(),ur.disabled,se.getShadowPassColorMode(),ar.disabled,Le,W.id,pe.vertexBuffer,pe.indexBuffer,pe.shadowCasterSegments,W.paint,q.transform.zoom,ue)}}(D)},"fill-extrusion":function(l,t,i,c){const f=i.paint.get("fill-extrusion-opacity"),m=l.context,y=m.gl,w=l.terrain,S=w&&w.renderingToTexture;if(f===0)return;const M=l.conflationActive&&l.style.isLayerClipped(i,t.getSource()),P=l.style.order.indexOf(i.fqid);if(M&&function(O,D,F,q,V){for(const W of q){const X=D.getTile(W).getBucket(F);X&&(X.updateReplacement(W,O.replacementSource,V),X.uploadCentroid(O.context))}}(l,t,i,c,P),w||M)for(const O of c){const D=t.getTile(O).getBucket(i);D&&Ft(l.context,t,O,D,i,w,M)}if(l.renderPass==="shadow"&&l.shadowRenderer){const O=l.shadowRenderer;if(w&&f<.65&&i._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ab)return;const D=O.getShadowPassDepthMode(),F=O.getShadowPassColorMode();ps(l,t,i,c,D,ur.disabled,F,M)}else if(l.renderPass==="translucent"){const O=!i.paint.get("fill-extrusion-pattern").constantOr(1),D=i.paint.get("fill-extrusion-color").constantOr(s.am.white);if(!S&&D.a!==0){const F=new Bt(l.context.gl.LEQUAL,Bt.ReadWrite,l.depthRangeFor3D);f===1&&O?ps(l,t,i,c,F,ur.disabled,Gr.unblended,M):(ps(l,t,i,c,F,ur.disabled,Gr.disabled,M),ps(l,t,i,c,F,l.stencilModeFor3D(),l.colorModeForRenderPass(),M),l.resetStencilClippingMasks())}if(l.style.enable3dLights()&&O&&(!w&&l.transform.projection.name!=="globe"||S)){const F=i.paint.get("fill-extrusion-opacity"),q=i.paint.get("fill-extrusion-ambient-occlusion-intensity"),V=i.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),W=i.paint.get("fill-extrusion-flood-light-intensity"),X=i.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",J=i.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(X?null:i.lut).toArray01().slice(0,3),se=q>0&&V>0,le=W>0,ge=(pe,ue,ye)=>(1-ye)*pe+ye*ue,_e=pe=>{const ue=l.depthModeForSublayer(1,Bt.ReadOnly,y.LEQUAL,!0),ye=i.paint.get(pe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),xe=ge(.1,3,ye),Pe=l._showOverdrawInspector;if(!Pe){const Le=new ur({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),Ye=new Gr([y.ONE,y.ONE,y.ONE,y.ONE],s.am.transparent,[!1,!1,!1,!0],y.MIN);vo(l,t,i,c,ue,Le,Ye,ar.disabled,pe,"sdf",F,q,V,W,J,xe,M,!1)}{const Le=Pe?ur.disabled:new ur({func:y.EQUAL,mask:255},255,255,y.KEEP,y.DECR,y.DECR),Ye=Pe?l.colorModeForRenderPass():new Gr([y.ONE_MINUS_DST_ALPHA,y.DST_ALPHA,y.ONE,y.ONE],s.am.transparent,[!0,!0,!0,!0]);vo(l,t,i,c,ue,Le,Ye,ar.disabled,pe,"color",F,q,V,W,J,xe,M,!1)}};if(S){const pe=(ue,ye,xe)=>{const Pe=l.depthModeForSublayer(1,Bt.ReadOnly,y.LEQUAL,!1),Le=i.paint.get(ue?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ye=ge(.1,3,Le);{const Xe=new Gr([y.ONE,y.ONE,y.ONE,y.ONE],s.am.transparent,[!1,!1,!1,!0]);vo(l,t,i,c,Pe,ur.disabled,Xe,ar.disabled,ue,"clear",F,q,V,W,J,Ye,M,ye)}{const Xe=new ur({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),ot=new Gr([y.ONE,y.ONE,y.ONE,y.ONE],s.am.transparent,[!1,!1,!1,!0],y.MIN);vo(l,t,i,c,Pe,Xe,ot,ar.disabled,ue,"sdf",F,q,V,W,J,Ye,M,ye)}{const Xe=ue?y.ZERO:y.ONE_MINUS_DST_ALPHA,ot=new ur({func:y.EQUAL,mask:255},255,255,y.KEEP,y.DECR,y.DECR),ze=new Gr([Xe,y.DST_ALPHA,y.ONE_MINUS_DST_ALPHA,y.ZERO],s.am.transparent,[!0,!0,!0,!0]);vo(l,t,i,c,Pe,ot,ze,ar.disabled,ue,"color",F,q,V,W,J,Ye,M,ye)}{const Xe=new Gr([y.ONE,y.ONE,y.ONE,ue?y.ZERO:y.ONE],s.am.transparent,[!1,!1,!1,!0],ue?y.FUNC_ADD:y.MAX);vo(l,t,i,c,Pe,ur.disabled,Xe,ar.disabled,ue,"clear",F,q,V,W,J,Ye,M,ye,xe)}};if(se||le){let ue;if(l.prepareDrawTile(),w){const ye=w.drapeBufferSize[0],xe=w.drapeBufferSize[1];ue=w.framebufferCopyTexture,ue&&(!ue||ue.size[0]===ye&&ue.size[1]===xe)||(ue&&ue.destroy(),ue=w.framebufferCopyTexture=new s.T(m,new s.r({width:ye,height:xe}),y.RGBA8)),ue.bind(y.LINEAR,y.CLAMP_TO_EDGE),y.copyTexSubImage2D(y.TEXTURE_2D,0,0,0,0,0,ye,xe)}se&&pe(!0,!1,ue),le&&pe(!1,!0,ue)}}else se&&_e(!0),le&&_e(!1),(se||le)&&l.resetStencilClippingMasks()}}},building:function(l,t,i,c){},hillshade:function(l,t,i,c){if(l.renderPass!=="offscreen"&&l.renderPass!=="translucent"||l.style.disableElevatedTerrain)return;const f=l.context,m=l.terrain&&l.terrain.renderingToTexture,[y,w]=l.renderPass!=="translucent"||m?[{},c]:l.stencilConfigForOverlap(c);for(const S of w){const M=t.getTile(S);if(M.needsHillshadePrepare&&l.renderPass==="offscreen")wm(l,M,i);else if(l.renderPass==="translucent"){const P=l.depthModeForSublayer(0,Bt.ReadOnly),O=i.paint.get("hillshade-emissive-strength"),D=l.colorModeForDrapableLayerRenderPass(O),F=m&&l.terrain?l.terrain.stencilModeForRTTOverlap(S):y[S.overscaledZ];xm(l,S,M,i,P,F,D)}}f.viewport.set([0,0,l.width,l.height]),l.resetStencilClippingMasks()},raster:function(l,t,i,c,f,m){if(l.renderPass!=="translucent"||i.paint.get("raster-opacity")===0)return;const y=l.transform.projection.name==="globe",w=i.paint.get("raster-elevation")!==0,S=w&&y;if(l.renderElevatedRasterBackface&&!S)return;const M=l.context,P=M.gl,O=t.getSource(),D=function(_e,pe,ue,ye){const xe=pe.paint.get("raster-color"),Pe=_e.type==="raster-array",Le=[],Ye=pe.paint.get("raster-resampling"),Xe=pe.paint.get("raster-color-mix");let ot=pe.paint.get("raster-color-range");const ze=[Xe[0],Xe[1],Xe[2],0],$e=Xe[3];let Ie=Ye==="nearest"?ye.NEAREST:ye.LINEAR;if(Pe&&(Le.push("RASTER_ARRAY"),xe||Le.push("RASTER_COLOR"),Ye==="linear"&&Le.push("RASTER_ARRAY_LINEAR"),Ie=ye.NEAREST,!ot&&_e.rasterLayers)){const Je=_e.rasterLayers.find(({id:Ve})=>Ve===pe.sourceLayer);Je&&Je.fields&&Je.fields.range&&(ot=Je.fields.range)}if(ot=ot||[0,1],xe){Le.push("RASTER_COLOR"),ue.activeTexture.set(ye.TEXTURE2),pe.updateColorRamp(ot);let Je=pe.colorRampTexture;Je||(Je=pe.colorRampTexture=new s.T(ue,pe.colorRamp,ye.RGBA8)),Je.bind(ye.LINEAR,ye.CLAMP_TO_EDGE)}return{mix:ze,range:ot,offset:$e,defines:Le,resampling:Ie}}(O,i,M,P);if(O instanceof s.aP&&!c.length&&!y)return;const F=i.paint.get("raster-emissive-strength"),q=l.colorModeForDrapableLayerRenderPass(F),V=l.terrain&&l.terrain.renderingToTexture,W=!l.options.moving,X=i.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;if(O instanceof s.aP&&!c.length&&(O.onNorthPole||O.onSouthPole)){const _e=w?l.stencilModeFor3D():ur.disabled;return void ea(!!O.onNorthPole,null,l,t,i,F,D,ar.disabled,_e)}if(!c.length)return;const[J,se]=O instanceof s.aP||V?[{},c]:l.stencilConfigForOverlap(c),le=se[se.length-1].overscaledZ;S&&D.defines.push("PROJECTION_GLOBE_VIEW"),w&&D.defines.push("RENDER_CUTOFF");const ge=(_e,pe,ue)=>{for(const ye of _e){const xe=ye.toUnwrapped(),Pe=t.getTile(ye);if(V&&(!Pe||!Pe.hasData()))continue;M.activeTexture.set(P.TEXTURE0);const Le=Pd(Pe,O,i,D);if(!Le||!Le.texture)continue;const{texture:Ye,mix:Xe,offset:ot,tileSize:ze,buffer:$e}=Le;let Ie,Je;V?(Ie=Bt.disabled,Je=ye.projMatrix):w?(Ie=new Bt(P.LEQUAL,Bt.ReadWrite,l.depthRangeFor3D),Je=y?Float32Array.from(l.transform.expandedFarZProjMatrix):l.transform.calculateProjMatrix(xe,W)):(Ie=l.depthModeForSublayer(ye.overscaledZ-le,i.paint.get("raster-opacity")===1?Bt.ReadWrite:Bt.ReadOnly,P.LESS),Je=l.transform.calculateProjMatrix(xe,W));const Ve=l.terrain&&V?l.terrain.stencilModeForRTTOverlap(ye):J[ye.overscaledZ],st=m?0:i.paint.get("raster-fade-duration");Pe.registerFadeDuration(st);const vt=t.findLoadedParent(ye,0),Qe=Ki(Pe,vt,t,l.transform,st);let pt,Pt;l.terrain&&l.terrain.prepareDrawTile(),M.activeTexture.set(P.TEXTURE0),Ye.bind(X,P.CLAMP_TO_EDGE),M.activeTexture.set(P.TEXTURE1),vt?(vt.texture&&vt.texture.bind(X,P.CLAMP_TO_EDGE),pt=Math.pow(2,vt.tileID.overscaledZ-Pe.tileID.overscaledZ),Pt=[Pe.tileID.canonical.x*pt%1,Pe.tileID.canonical.y*pt%1]):Ye.bind(X,P.CLAMP_TO_EDGE),"useMipmap"in Ye&&M.extTextureFilterAnisotropic&&l.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);const Lt=l.transform;let Mt;const Nt=w?pc(Lt):[0,0,0,0];let er,nr,dr,Dr,dn,Gn=0;if(S&&O instanceof s.aP&&O.coordinates.length>3)er=Float32Array.from(s.bh(s.dr(new s.cp(0,0,0)))),nr=Float32Array.from(Lt.globeMatrix),dr=Float32Array.from(s.dm(Lt)),Dr=[s.aD(Lt.center.lng),s.aH(Lt.center.lat)],Mt=O.elevatedGlobePerspectiveTransform,dn=O.elevatedGlobeGridMatrix||new Float32Array(9);else if(S){const yr=s.dn(ye.canonical);Gn=s.dp(yr.getCenter().lat),er=Float32Array.from(s.bh(s.dr(ye.canonical))),nr=Float32Array.from(Lt.globeMatrix),dr=Float32Array.from(s.dm(Lt)),Dr=[s.aD(Lt.center.lng),s.aH(Lt.center.lat)],Mt=[0,0],dn=Float32Array.from(s.dq(ye.canonical,yr,Gn,Lt.worldSize/Lt._pixelsPerMercatorPixel))}else Mt=O instanceof s.aP?O.perspectiveTransform:[0,0],er=new Float32Array(16),nr=new Float32Array(9),dr=new Float32Array(16),Dr=[0,0],dn=new Float32Array(9);const Mn=kh(Je,er,nr,dr,dn,Pt||[0,0],s.ah(l.transform.zoom),Dr,Nt,pt||1,Qe,i,Mt,w?i.paint.get("raster-elevation"):0,2,Xe,ot,D.range,ze,$e,F),wn=l.isTileAffectedByFog(ye),wi=l.getOrCreateProgram("raster",{defines:D.defines,overrideFog:wn});if(l.uploadCommonUniforms(M,wi,xe),O instanceof s.aP){const yr=O.elevatedGlobeVertexBuffer,Lr=O.elevatedGlobeIndexBuffer;if(V||!y)O.boundsBuffer&&O.boundsSegments&&wi.draw(l,P.TRIANGLES,Ie,ur.disabled,q,ar.disabled,Mn,i.id,O.boundsBuffer,l.quadTriangleIndexBuffer,O.boundsSegments);else if(yr&&Lr){const Wr=Lt.zoom<=s.cL?O.elevatedGlobeSegments:O.getSegmentsForLongitude(Lt.center.lng);Wr&&wi.draw(l,P.TRIANGLES,Ie,ur.disabled,q,pe,Mn,i.id,yr,Lr,Wr)}}else if(S){Ie=new Bt(P.LEQUAL,Bt.ReadOnly,l.depthRangeFor3D);const yr=l.globeSharedBuffers;if(yr){const[Lr,Wr,qn]=yr.getGridBuffers(Gn,!1);wi.draw(l,P.TRIANGLES,Ie,ue||Ve,l.colorModeForRenderPass(),pe,Mn,i.id,Lr,Wr,qn)}}else{const{tileBoundsBuffer:yr,tileBoundsIndexBuffer:Lr,tileBoundsSegments:Wr}=l.getTileBoundsBuffers(Pe);wi.draw(l,P.TRIANGLES,Ie,Ve,q,ar.disabled,Mn,i.id,yr,Lr,Wr)}}if(!(O instanceof s.aP)&&S)for(const ye of _e){const xe=ye.canonical.y===(1<<ye.canonical.z)-1;ye.canonical.y===0&&ea(!0,ye,l,t,i,F,D,pe,ue||ur.disabled),xe&&ea(!1,ye,l,t,i,F,D,pe===ar.frontCW?ar.backCW:ar.frontCW,ue||ur.disabled)}};S?ge(se,l.renderElevatedRasterBackface?ar.backCW:ar.frontCW,l.stencilModeFor3D()):ge(se,ar.disabled,void 0),l.resetStencilClippingMasks()},"raster-particle":function(l,t,i,c,f,m){l.renderPass==="offscreen"&&function(y,w,S,M){if(!M.length)return;const P=y.context,O=P.gl,D=w.getSource();if(!(D instanceof $l))return;const F=Math.ceil(Math.sqrt(S.paint.get("raster-particle-count")));let q=S.particlePositionRGBAImage;if(!q||q.width!==F){const se=function(le){const ge=le*le,_e=new Uint8Array(4*ge),pe=function(ye){return ye|=0,ye=Math.imul(2747636419^ye,2654435769),ye=Math.imul(ye^ye>>>16,2654435769),((ye=Math.imul(ye^ye>>>16,2654435769))>>>0)/4294967296},ue=1/1.1;for(let ye=0;ye<ge;ye++){const xe=ue*(pe(2*ye+0)+fs),Pe=ue*(pe(2*ye+1)+fs),Le=255*xe%1,Ye=255*Pe%1,Xe=Le,ot=Pe-Ye/255,ze=Ye;_e[4*ye+0]=255*(xe-Le/255),_e[4*ye+1]=255*Xe,_e[4*ye+2]=255*ot,_e[4*ye+3]=255*ze}return _e}(F);q=S.particlePositionRGBAImage=new s.r({width:F,height:F},se)}let V=S.particleFramebuffer;V?V.width!==F&&(V.destroy(),V=S.particleFramebuffer=P.createFramebuffer(F,F,!0,null)):V=S.particleFramebuffer=P.createFramebuffer(F,F,!0,null);const W=[];for(const se of M){const le=w.getTile(se);if(!(le instanceof Mc))continue;const ge=Ip(le,D,S);if(!ge)continue;const _e=[le.tileSize,le.tileSize];let pe=S.tileFramebuffer;pe||(pe=S.tileFramebuffer=P.createFramebuffer(_e[0],_e[1],!0,null));let ue=le.rasterParticleState;ue||(ue=le.rasterParticleState=new Bh(P,se,_e,q));const ye=ue.update(S.lastInvalidatedAt);ue.particleTextureDimension!==F&&ue.updateParticleTexture(se,q);const xe=ue.targetColorTexture;ue.targetColorTexture=ue.backgroundColorTexture,ue.backgroundColorTexture=xe;const Pe=ue.particleTexture0;ue.particleTexture0=ue.particleTexture1,ue.particleTexture1=Pe,W.push([se,ge,ue,ye])}if(W.length===0)return;const X=s.q.now(),J=S.previousDrawTimestamp?.001*(X-S.previousDrawTimestamp):.0167;if(S.previousDrawTimestamp=X,S.hasColorMap()){P.activeTexture.set(O.TEXTURE0+2);let se=S.colorRampTexture;se||(se=S.colorRampTexture=new s.T(P,S.colorRamp,O.RGBA8)),se.bind(O.LINEAR,O.CLAMP_TO_EDGE)}P.bindFramebuffer.set(S.tileFramebuffer.framebuffer),function(se,le,ge){const _e=se.context,pe=_e.gl,ue=le.tileFramebuffer;_e.activeTexture.set(pe.TEXTURE0);const ye={u_texture:0,u_opacity:1.05*(Pe=le.paint.get("raster-particle-fade-opacity-factor"))/(Pe+.05)},xe=se.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Pe;for(const Le of ge){const[,,Ye,Xe]=Le;ue.colorAttachment.set(Ye.targetColorTexture.texture),_e.viewport.set([0,0,ue.width,ue.height]),_e.clear({color:s.am.transparent}),Xe&&(Ye.backgroundColorTexture.bind(pe.NEAREST,pe.CLAMP_TO_EDGE),xe.draw(se,pe.TRIANGLES,Bt.disabled,ur.disabled,Gr.alphaBlended,ar.disabled,ye,le.id,se.viewportBuffer,se.quadTriangleIndexBuffer,se.viewportSegments))}}(y,S,W),function(se,le,ge,_e){const pe=se.context,ue=pe.gl,ye=ge.tileFramebuffer,xe=se.transform.projection.name==="globe",Pe=ge.paint.get("raster-particle-max-speed");for(const Le of _e){const[Ye,Xe,ot]=Le;pe.activeTexture.set(ue.TEXTURE0+0),Xe.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),ye.colorAttachment.set(ot.targetColorTexture.texture);const ze=se.getOrCreateProgram("rasterParticleDraw",{defines:Xe.defines,overrideFog:!1});pe.activeTexture.set(ue.TEXTURE0+1);const $e=Xe.scalarData?[]:[0,1,2,3].map(Ve=>s.dT[Ve](Ye));$e.push(Ye);const Ie=Ye.canonical.x,Je=Ye.canonical.y;for(const Ve of $e){const st=le.getTile(xe?Ve.wrapped():Ve);if(!st)continue;const vt=st.rasterParticleState;if(!vt)continue;const Qe=Ve.canonical.x+(1<<Ve.canonical.z)*(Ve.wrap-Ye.wrap),pt=Ve.canonical.y;vt.particleTexture0.bind(ue.NEAREST,ue.CLAMP_TO_EDGE);const Pt=Ni(1,vt.particleTexture0.size[0],[Qe-Ie,pt-Je],0,Xe.texture.size,2,Pe,Xe.textureOffset,Xe.scale,Xe.offset);ze.draw(se,ue.POINTS,Bt.disabled,ur.disabled,Gr.alphaBlended,ar.disabled,Pt,ge.id,vt.particleIndexBuffer,void 0,vt.particleSegment)}}}(y,w,S,W),P.bindFramebuffer.set(S.particleFramebuffer.framebuffer),function(se,le,ge,_e){const pe=se.context,ue=pe.gl,ye=le.paint.get("raster-particle-max-speed"),xe=_e*le.paint.get("raster-particle-speed-factor")*.15,Pe=function(Ye){return Math.pow(Ye,6)}(.01+1*le.paint.get("raster-particle-reset-rate-factor")),Le=le.particleFramebuffer;pe.viewport.set([0,0,Le.width,Le.height]);for(const Ye of ge){const[,Xe,ot]=Ye;pe.activeTexture.set(ue.TEXTURE0+0),Xe.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),pe.activeTexture.set(ue.TEXTURE0+1);const ze=ot.particleTexture0;ze.bind(ue.NEAREST,ue.CLAMP_TO_EDGE);const $e=Ns(1,ze.size[0],0,Xe.texture.size,ye,xe,Pe,Xe.textureOffset,Xe.scale,Xe.offset);Le.colorAttachment.set(ot.particleTexture1.texture),pe.clear({color:s.am.transparent}),se.getOrCreateProgram("rasterParticleUpdate",{defines:Xe.defines}).draw(se,ue.TRIANGLES,Bt.disabled,ur.disabled,Gr.unblended,ar.disabled,$e,le.id,se.viewportBuffer,se.quadTriangleIndexBuffer,se.viewportSegments)}}(y,S,W,J)}(l,t,i,c),l.renderPass==="translucent"&&(function(y,w,S,M,P){const O=y.context,D=O.gl,F=w.getSource().tileSize,q=5*(1-s.af(s.cx,s.cx+1,y.transform.zoom))*F+S.paint.get("raster-particle-elevation"),V=!y.options.moving,W=y.transform.projection.name==="globe";if(!M.length)return;const[X,J]=y.stencilConfigForOverlap(M),se=[];W&&se.push("PROJECTION_GLOBE_VIEW");const le=y.stencilModeFor3D();for(const ge of J){const _e=ge.toUnwrapped(),pe=w.getTile(ge);if(!pe.rasterParticleState)continue;const ue=pe.rasterParticleState,ye=100;pe.registerFadeDuration(ye);const xe=w.findLoadedParent(ge,0),Pe=Ki(pe,xe,w,y.transform,ye);let Le,Ye;y.terrain&&y.terrain.prepareDrawTile(),O.activeTexture.set(D.TEXTURE0),ue.targetColorTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),O.activeTexture.set(D.TEXTURE1),xe&&xe.rasterParticleState?(xe.rasterParticleState.targetColorTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Le=Math.pow(2,xe.tileID.overscaledZ-pe.tileID.overscaledZ),Ye=[pe.tileID.canonical.x*Le%1,pe.tileID.canonical.y*Le%1]):ue.targetColorTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const Xe=W?Float32Array.from(y.transform.expandedFarZProjMatrix):y.transform.calculateProjMatrix(_e,V),ot=y.transform,ze=Hu(ot),$e=s.dn(ge.canonical),Ie=s.dp($e.getCenter().lat);let Je,Ve,st,vt,Qe;W?(Je=Float32Array.from(s.bh(s.dr(ge.canonical))),Ve=Float32Array.from(ot.globeMatrix),st=Float32Array.from(s.dm(ot)),vt=[s.aD(ot.center.lng),s.aH(ot.center.lat)],Qe=Float32Array.from(s.dq(ge.canonical,$e,Ie,ot.worldSize/ot._pixelsPerMercatorPixel))):(Je=new Float32Array(16),Ve=new Float32Array(9),st=new Float32Array(16),vt=[0,0],Qe=new Float32Array(9));const pt=Is(Xe,Je,Ve,st,Qe,Ye||[0,0],s.ah(y.transform.zoom),vt,ze,Le||1,Pe,q),Pt=y.isTileAffectedByFog(ge),Lt=y.getOrCreateProgram("rasterParticle",{defines:se,overrideFog:Pt});if(y.uploadCommonUniforms(O,Lt,_e),W){const Mt=new Bt(D.LEQUAL,Bt.ReadOnly,y.depthRangeFor3D),Nt=0,er=y.globeSharedBuffers;if(er){const[nr,dr,Dr]=er.getGridBuffers(Ie,Nt!==0);Lt.draw(y,D.TRIANGLES,Mt,le,Gr.alphaBlended,y.renderElevatedRasterBackface?ar.frontCCW:ar.backCCW,pt,S.id,nr,dr,Dr)}}else{const Mt=y.depthModeForSublayer(0,Bt.ReadOnly),Nt=X[ge.overscaledZ],{tileBoundsBuffer:er,tileBoundsIndexBuffer:nr,tileBoundsSegments:dr}=y.getTileBoundsBuffers(pe);Lt.draw(y,D.TRIANGLES,Mt,Nt,Gr.alphaBlended,ar.disabled,pt,S.id,er,nr,dr)}}y.resetStencilClippingMasks()}(l,t,i,c),l.style.map.triggerRepaint())},background:function(l,t,i,c){const f=i.paint.get("background-color"),m=i.paint.get("background-color-use-theme").constantOr("default")==="none",y=i.paint.get("background-opacity"),w=i.paint.get("background-emissive-strength"),S=i.paint.get("background-pitch-alignment")==="viewport";if(y===0)return;const M=l.context,P=M.gl,O=l.transform,D=O.tileSize,F=i.paint.get("background-pattern");let q;if(F!==void 0&&(F===null||(q=l.imageManager.getPattern(s.I.from(F.toString()),i.scope,l.style.getLut(i.scope)),!q)))return;const V=!F&&f.a===1&&y===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==V)return;const W=ur.disabled,X=l.depthModeForSublayer(0,V==="opaque"?Bt.ReadWrite:Bt.ReadOnly),J=l.colorModeForDrapableLayerRenderPass(w),se=F?"backgroundPattern":"background";let le,ge=c;if(ge||(le=l.getBackgroundTiles(),ge=Object.values(le).map(_e=>_e.tileID)),F&&(M.activeTexture.set(P.TEXTURE0),l.imageManager.bind(l.context,i.scope)),S){const _e=l.getOrCreateProgram(se,{overrideFog:!1,overrideRtt:!0}),pe=new Float32Array(s.bx([])),ue=new s.aM(0,0,0,0,0),ye=F?Oh(pe,w,y,l,0,i.scope,q,S,{tileID:ue,tileSize:D}):Lh(pe,w,y,f.toPremultipliedRenderColor(m?null:i.lut));_e.draw(l,P.TRIANGLES,X,W,J,ar.disabled,ye,i.id,l.viewportBuffer,l.quadTriangleIndexBuffer,l.viewportSegments)}else for(const _e of ge){const pe=l.isTileAffectedByFog(_e),ue=l.getOrCreateProgram(se,{overrideFog:pe}),ye=_e.toUnwrapped(),xe=c?_e.projMatrix:l.transform.calculateProjMatrix(ye);l.prepareDrawTile();const Pe=t?t.getTile(_e):le?le[_e.key]:new Wl(_e,D,O.zoom,l),Le=F?Oh(xe,w,y,l,0,i.scope,q,S,{tileID:_e,tileSize:D}):Lh(xe,w,y,f.toPremultipliedRenderColor(m?null:i.lut));l.uploadCommonUniforms(M,ue,ye);const{tileBoundsBuffer:Ye,tileBoundsIndexBuffer:Xe,tileBoundsSegments:ot}=l.getTileBoundsBuffers(Pe);ue.draw(l,P.TRIANGLES,X,W,J,ar.disabled,Le,i.id,Ye,Xe,ot)}},sky:function(l,t,i){const c=l._atmosphere?s.ah(l.transform.zoom):1,f=i.paint.get("sky-opacity")*c;if(f===0)return;const m=l.context,y=i.paint.get("sky-type"),w=new Bt(m.gl.LEQUAL,Bt.ReadOnly,[0,1]),S=l.frameCounter/1e3%1;y==="atmosphere"?l.renderPass==="offscreen"?i.needsSkyboxCapture(l)&&(function(M,P,O,D){const F=M.context,q=F.gl;let V=P.skyboxFbo;if(!V){V=P.skyboxFbo=F.createFramebuffer(32,32,!0,null),P.skyboxGeometry=new Qc(F),P.skyboxTexture=F.gl.createTexture(),q.bindTexture(q.TEXTURE_CUBE_MAP,P.skyboxTexture),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MAG_FILTER,q.LINEAR);for(let se=0;se<6;++se)q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+se,0,q.RGBA,32,32,0,q.RGBA,q.UNSIGNED_BYTE,null)}F.bindFramebuffer.set(V.framebuffer),F.viewport.set([0,0,32,32]);const W=P.getCenter(M,!0),X=M.getOrCreateProgram("skyboxCapture"),J=new Float64Array(16);s.bx(J),s.e3(J,J,.5*-Math.PI),Bo(M,P,X,J,W,0),s.bx(J),s.e3(J,J,.5*Math.PI),Bo(M,P,X,J,W,1),s.bx(J),s.cG(J,J,.5*-Math.PI),Bo(M,P,X,J,W,2),s.bx(J),s.cG(J,J,.5*Math.PI),Bo(M,P,X,J,W,3),s.bx(J),Bo(M,P,X,J,W,4),s.bx(J),s.e3(J,J,Math.PI),Bo(M,P,X,J,W,5),F.viewport.set([0,0,M.width,M.height])}(l,i),i.markSkyboxValid(l)):l.renderPass==="sky"&&function(M,P,O,D,F){const q=M.context,V=q.gl,W=M.transform,X=M.getOrCreateProgram("skybox");q.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_CUBE_MAP,P.skyboxTexture);const J=((se,le,ge,_e,pe)=>({u_matrix:se,u_sun_direction:le,u_cubemap:0,u_opacity:_e,u_temporal_offset:pe}))(W.skyboxMatrix,P.getCenter(M,!1),0,D,F);M.uploadCommonUniforms(q,X),X.draw(M,V.TRIANGLES,O,ur.disabled,M.colorModeForRenderPass(),ar.backCW,J,"skybox",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(l,i,w,f,S):y==="gradient"&&l.renderPass==="sky"&&function(M,P,O,D,F){const q=M.context,V=q.gl,W=M.transform,X=M.getOrCreateProgram("skyboxGradient");P.skyboxGeometry||(P.skyboxGeometry=new Qc(q)),q.activeTexture.set(V.TEXTURE0);let J=P.colorRampTexture;J||(J=P.colorRampTexture=new s.T(q,P.colorRamp,V.RGBA8)),J.bind(V.LINEAR,V.CLAMP_TO_EDGE);const se=((le,ge,_e,pe,ue)=>({u_matrix:le,u_color_ramp:0,u_center_direction:ge,u_radius:s.al(_e),u_opacity:pe,u_temporal_offset:ue}))(W.skyboxMatrix,P.getCenter(M,!1),P.paint.get("sky-gradient-radius"),D,F);M.uploadCommonUniforms(q,X),X.draw(M,V.TRIANGLES,O,ur.disabled,M.colorModeForRenderPass(),ar.backCW,se,"skyboxGradient",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(l,i,w,f,S)},custom:function(l,t,i,c){const f=l.context,m=i.implementation;if(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes("custom")||l.terrain&&(l.terrain.renderingToTexture||l.renderPass==="offscreen")&&i.isDraped(t)){if(l.renderPass==="offscreen"){const y=m.prerender;if(y){if(l.setCustomLayerDefaults(),f.setColorMode(l.colorModeForRenderPass()),l.transform.projection.name==="globe"){const w=l.transform.pointMerc;y.call(m,f.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),s.ah(l.transform.zoom),[w.x,w.y],l.transform.pixelsPerMeterRatio)}else y.call(m,f.gl,l.transform.customLayerMatrix());f.setDirty(),l.setBaseState()}}else if(l.renderPass==="translucent"){if(l.terrain&&l.terrain.renderingToTexture){const w=m.renderToTile;if(w){const S=c[0].canonical,M={x:S.x+c[0].wrap*(m.wrapTileId?0:1<<S.z),y:S.y,z:S.z};f.setDepthMode(Bt.disabled),f.setStencilMode(ur.disabled),f.setColorMode(l.colorModeForRenderPass()),l.setCustomLayerDefaults(),w.call(m,f.gl,M),f.setDirty(),l.setBaseState()}return}l.setCustomLayerDefaults(),f.setColorMode(l.colorModeForRenderPass()),f.setStencilMode(ur.disabled);const y=m.renderingMode==="3d"?new Bt(l.context.gl.LEQUAL,Bt.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,Bt.ReadOnly);if(f.setDepthMode(y),l.transform.projection.name==="globe"){const w=l.transform.pointMerc;m.render(f.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),s.ah(l.transform.zoom),[w.x,w.y],l.transform.pixelsPerMeterRatio)}else m.render(f.gl,l.transform.customLayerMatrix());f.setDirty(),l.setBaseState(),f.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(l,t,i,c){if(l.renderPass==="opaque")return;const f=i.paint.get("model-opacity").constantOr(1);if(f===0)return;const m=i.paint.get("model-cast-shadows");if(l.renderPass==="shadow"&&(!m||l.terrain&&f<.65&&i._transitionablePaint._values["model-opacity"].value.expression instanceof s.ab))return;const y=l.shadowRenderer,w=i.paint.get("model-receive-shadows");y&&(y.useNormalOffset=!0,w||(y.enabled=!1));const S=()=>{y&&(y.useNormalOffset=!0,w||(y.enabled=!0))},M=t.getSource();if(l.renderPass==="light-beam"&&M.type!=="batched-model")return;if(M.type==="vector"||M.type==="geojson")return function(X,J,se,le,ge){const _e=X.transform;if(_e.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${_e.projection.name} projection is not yet implemented`);const pe=_e.getFreeCameraOptions().position;if(!X.modelManager)return;const ue=X.modelManager;se.modelManager=ue;const ye=X.shadowRenderer;if(!se._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const xe=se._unevaluatedLayout._values["model-id"],Pe=Object.assign({},se.layout.get("model-id").parameters),Le=X.style.order.indexOf(se.fqid);for(const Ye of le){const Xe=J.getTile(Ye).getBucket(se);if(!Xe||Xe.projection.name!==_e.projection.name)continue;const ot=Xe.getModelUris();ot&&!Xe.modelsRequested&&(ue.addModelsFromBucket(ot,ge),Xe.modelsRequested=!0);const ze=wo(Ye,_e);Pe.zoom=ze;const $e=xe.possiblyEvaluate(Pe);if(ke(X,Xe,Ye),gs.shadowUniformsInitialized=!1,gs.useSingleShadowCascade=!!ye&&ye.getMaxCascadeForTile(Ye.toUnwrapped())===0,X.renderPass==="shadow"&&ye){if(X.currentShadowCascade===1&&Xe.isInsideFirstShadowMapFrustum)continue;const Ve=_e.calculatePosMatrix(Ye.toUnwrapped(),_e.worldSize);if(gs.tileMatrix.set(Ve),gs.shadowTileMatrix=Float32Array.from(ye.calculateShadowPassMatrixFromMatrix(Ve)),gs.aabb.min.fill(0),gs.aabb.max[0]=gs.aabb.max[1]=s.aj,gs.aabb.max[2]=0,Dd(Xe,gs,X,se.scope))continue}const Ie=1<<Ye.canonical.z,Je=[((pe.x-Ye.wrap)*Ie-Ye.canonical.x)*s.aj,(pe.y*Ie-Ye.canonical.y)*s.aj,pe.z*Ie*s.aj];X.conflationActive&&Object.keys(Xe.instancesPerModel).length>0&&X.style.isLayerClipped(se,J.getSource())&&Xe.updateReplacement(Ye,X.replacementSource,Le,ge)&&(Xe.uploaded=!1,Xe.upload(X.context));for(let Ve in Xe.instancesPerModel){const st=Xe.instancesPerModel[Ve];st.features.length>0&&(Ve=$e.evaluate(st.features[0].feature,{}));const vt=ue.getModel(Ve,ge);if(vt||ue.hasURLBeenRequested(Ve)||Xe.modelUris.includes(Ve)||(Xe.modelUris.push(Ve),Xe.modelsRequested=!1),vt&&vt.uploaded)for(const Qe of vt.nodes)gc(X,se,Qe,st,Je,Ye,gs)}}}(l,t,i,c,M.type==="vector"?i.scope:""),void S();if(!M.loaded())return;if(M.type==="batched-model")return function(X,J,se,le){se.resetLayerRenderingStats(X);const ge=X.context,_e=X.transform,pe=X.style.fog,ue=X.shadowRenderer;if(_e.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${_e.projection.name} projection is not yet implemented`);const ye=X.transform.getFreeCameraOptions().position,xe=s.bY([],[ye.x,ye.y,ye.z],X.transform.worldSize),Pe=s.eb([],xe),Le=s.bx([]),Ye=s.ec(_e.center.lat,_e.zoom),Xe=s.bn([],[1,1,1/Ye]);s.bo(Le,Le,Pe);const ot=se.paint.get("model-opacity").constantOr(1),ze=new Bt(ge.gl.LEQUAL,Bt.ReadWrite,X.depthRangeFor3D),$e=new Bt(ge.gl.LEQUAL,Bt.ReadOnly,X.depthRangeFor3D),Ie=new s.cW([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Je=X.renderPass==="shadow",Ve=Je&&ue?ue.getCurrentCascadeFrustum():_e.getFrustum(_e.scaleZoom(_e.worldSize)),st=se.paint.get("model-front-cutoff"),vt=st[2]<1,Qe=ko(X,se.paint.get("model-cutoff-fade-range")),pt=se.getLayerRenderingStats();(function(Pt,Lt,Mt,Nt){const er=Pt.terrain?Pt.terrain.exaggeration():0,nr=Pt.transform.zoom;for(const dr of Nt){const Dr=Lt.getTile(dr).getBucket(Mt);Dr&&(Dr.setFilter(Mt.filter),Pt.conflationActive&&Dr.updateReplacement(dr,Pt.replacementSource),Dr.evaluateTransform(Pt,Mt),Pt.terrain&&er>0&&Dr.elevationUpdate(Pt.terrain,er,dr,Mt.source),Dr.needsReEvaluation(Pt,nr,Mt)&&Dr.evaluate(Mt))}})(X,J,se,le),function(){let Pt,Lt,Mt;vt?(Pt=le.length-1,Lt=-1,Mt=-1):(Pt=0,Lt=le.length,Mt=1);const Nt=new Float64Array(16),er=s.ef(),nr=new s.P(0,0);for(let dr=Pt;dr!==Lt;dr+=Mt){const Dr=le[dr],dn=J.getTile(Dr).getBucket(se);if(!dn||!dn.uploaded)continue;let Gn=!1;ue&&(Gn=ue.getMaxCascadeForTile(Dr.toUnwrapped())===0);const Mn=_e.calculatePosMatrix(Dr.toUnwrapped(),_e.worldSize),wn=dn.modelTraits;!Je&&vt&&(s.bi(Nt,Mn),s.ad(er,xe,Nt),nr.x=er[0],nr.y=er[1]);const wi=[];dn.setFilter(se.filter);for(const yr of dn.getNodesInfo()){if(yr.hiddenByReplacement||!yr.node.meshes)continue;const Lr=yr.node;let Wr=0;X.terrain&&Lr.elevation&&(Wr=Lr.elevation*X.terrain.exaggeration());const qn=(()=>{const bi=yr.aabb;return Ie.min=[...bi.min],Ie.max=[...bi.max],Ie.min[2]+=Wr,Ie.max[2]+=Wr,s.ad(Ie.min,Ie.min,Mn),s.ad(Ie.max,Ie.max,Mn),Ie})(),Ci=yr.evaluatedScale;if(Ci[0]<=1&&Ci[1]<=1&&Ci[2]<=1&&qn.intersects(Ve)===0)continue;if(!Je&&vt){const bi=.16666666666666666;yr.cameraCollisionOpacity=xe[0]>qn.min[0]&&xe[0]<qn.max[0]&&xe[1]>qn.min[1]&&xe[1]<qn.max[1]&&xe[2]*Ye<qn.max[2]&&Lr.footprint&&s.bS(nr,Lr.footprint)?Math.max(yr.cameraCollisionOpacity-bi,0):Math.min(1,yr.cameraCollisionOpacity+bi)}const Zn=[...Mn],Sn=1/s.cU(Dr.canonical),_i=Lr.anchor?Lr.anchor[0]:0,hn=Lr.anchor?Lr.anchor[1]:0;s.bo(Zn,Zn,[_i*(Ci[0]-1)+yr.evaluatedTranslation[0]*Sn,hn*(Ci[1]-1)+yr.evaluatedTranslation[1]*Sn,Wr+yr.evaluatedTranslation[2]]),s.ci(Ci,s.eg)||s.cE(Zn,Zn,Ci);const yi=s.az([],Zn,Lr.matrix),Jn=s.az([],_e.expandedFarZProjMatrix,yi),kn=s.az([],_e.expandedFarZProjMatrix,Zn),Xn=s.aA([],[_i,hn,Wr,1],Jn)[2];Lr.hidden=!1;let zr=ot;Je||(vt&&(zr*=yr.cameraCollisionOpacity,zr*=eu(Zn,_e,yr.aabb,st)),zr*=Rf(Qe,Xn)),zr!==0?wi.push({nodeInfo:yr,depth:Xn,opacity:zr,wvpForNode:Jn,wvpForTile:kn,nodeModelMatrix:yi,tileModelMatrix:Zn}):Lr.hidden=!0}Je||wi.sort((yr,Lr)=>!vt||yr.opacity===1&&Lr.opacity===1?yr.depth<Lr.depth?-1:1:yr.opacity===1?-1:Lr.opacity===1?1:yr.depth>Lr.depth?-1:1);for(const yr of wi){const Lr=yr.nodeInfo,Wr=Lr.node;let qn=s.az([],Xe,yr.tileModelMatrix);s.az(qn,Le,qn);const Ci=s.bi([],qn);s.ee(Ci,Ci),s.cE(Ci,Ci,Vh),qn=s.az(qn,qn,Wr.matrix);const Zn=X.renderPass==="light-beam",Sn=se.paint.get("model-color-use-theme").constantOr("default")==="none",_i=wn&s.em.HasMapboxMeshFeatures,hn=_i?0:Lr.evaluatedRMEA[0][2];for(let yi=0;yi<Wr.meshes.length;++yi){const Jn=Wr.meshes[yi],kn=yi===Wr.lightMeshIndex;let Xn=yr.wvpForNode;if(kn){if(!Zn&&!X.terrain&&X.shadowRenderer){X.currentLayer<X.firstLightBeamLayer&&(X.firstLightBeamLayer=X.currentLayer);continue}Xn=yr.wvpForTile}else if(Zn)continue;const zr={defines:[]},bi=[];if(!Je&&ue&&(ue.useNormalOffset=!!Jn.normalBuffer),gt(zr.defines,bi,Jn,X,Sn?null:se.lut),_i||zr.defines.push("DIFFUSE_SHADED"),Gn&&zr.defines.push("SHADOWS_SINGLE_CASCADE"),pt&&(Je?pt.numRenderedVerticesInShadowPass+=Jn.vertexArray.length:pt.numRenderedVerticesInTransparentPass+=Jn.vertexArray.length),Je){fi(Jn,yr.nodeModelMatrix,X,se);continue}let _s=null;if(pe){const Ji=Pa(yr.nodeModelMatrix,X.transform);if(_s=new Float32Array(Ji),_e.projection.name!=="globe"){const jo=Jn.aabb.min,To=Jn.aabb.max,[So,Vo]=pe.getOpacityForBounds(Ji,jo[0],jo[1],To[0],To[1]);zr.overrideFog=So>=Ue||Vo>=Ue}}const ri=Jn.material;let Tn;ri.occlusionTexture&&ri.occlusionTexture.offsetScale&&(Tn=ri.occlusionTexture.offsetScale,zr.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const bo=X.getOrCreateProgram("model",zr);!Je&&ue&&ue.setupShadowsFromMatrix(yr.tileModelMatrix,bo,ue.useNormalOffset),X.uploadCommonUniforms(ge,bo,null,_s);const no=ri.pbrMetallicRoughness;no.metallicFactor=.9,no.roughnessFactor=.5;const na=lc(new Float32Array(Xn),new Float32Array(qn),new Float32Array(Ci),new Float32Array(Wr.matrix),X,yr.opacity,no.baseColorFactor,ri.emissiveFactor,no.metallicFactor,no.roughnessFactor,ri,hn,se,[0,0,0],Tn);!kn&&(Lr.hasTranslucentParts||yr.opacity<1)&&bo.draw(X,ge.gl.TRIANGLES,ze,ur.disabled,Gr.disabled,ar.backCCW,na,se.id,Jn.vertexBuffer,Jn.indexBuffer,Jn.segments,se.paint,X.transform.zoom,void 0,bi),bo.draw(X,ge.gl.TRIANGLES,kn?$e:ze,ur.disabled,kn||yr.opacity<1||Lr.hasTranslucentParts?Gr.alphaBlended:Gr.unblended,ar.backCCW,na,se.id,Jn.vertexBuffer,Jn.indexBuffer,Jn.segments,se.paint,X.transform.zoom,void 0,bi)}}}}()}(l,t,i,c),void S();if(M.type!=="model")return;const P=M.getModels(),O=[],D=l.transform.getFreeCameraOptions().position,F=s.bY([],[D.x,D.y,D.z],l.transform.worldSize);s.eb(F,F);const q=[],V=[];let W=0;for(const X of P){const J=i.paint.get("model-rotation").constantOr(null),se=i.paint.get("model-scale").constantOr(null),le=i.paint.get("model-translation").constantOr(null);X.computeModelMatrix(l,J,se,le,!0,!0,!1);const ge=s.bx([]),_e=s.ec(X.position.lat,l.transform.zoom),pe=s.bn([],[1,1,1/_e]);s.bo(ge,ge,F),O.push({zScaleMatrix:pe,negCameraPosMatrix:ge});for(const ue of X.nodes)Al(l.transform,ue,X.matrix,l.transform.expandedFarZProjMatrix,W,q,V);W++}if(q.sort((X,J)=>J.depth-X.depth),l.renderPass!=="shadow"){if(f===1)for(const X of V)It(X,l,i,O[X.modelIndex],ur.disabled,l.colorModeForRenderPass());else{for(const X of V)It(X,l,i,O[X.modelIndex],ur.disabled,Gr.disabled);for(const X of V)It(X,l,i,O[X.modelIndex],l.stencilModeFor3D(),l.colorModeForRenderPass());l.resetStencilClippingMasks()}for(const X of q)It(X,l,i,O[X.modelIndex],ur.disabled,l.colorModeForRenderPass());S()}else{for(const X of V)fi(X.mesh,X.nodeModelMatrix,l,i);for(const X of q)fi(X.mesh,X.nodeModelMatrix,l,i);S()}}},Nd={line:function(l,t,i){if(l.hasElevatedBuckets=!1,l.hasNonElevatedBuckets=!1,l._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||l._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const c=t.getVisibleCoordinates();for(const f of c){const m=t.getTile(f).getBucket(l);if(m&&(m.elevationType!=="none"?l.hasElevatedBuckets=!0:l.hasNonElevatedBuckets=!0,l.hasElevatedBuckets&&l.hasNonElevatedBuckets))break}}}else l.hasNonElevatedBuckets=!0},model:function(l,t,i){const c=t.getSource();if(!c.loaded())return;if(c.type==="vector"||c.type==="geojson")return void(i.modelManager&&i.modelManager.upload(i,c.type==="vector"?l.scope:""));if(c.type==="batched-model"||c.type!=="model")return;const f=c.getModels();for(const m of f)m.upload(i.context)},raster:function(l,t,i){const c=t.getSource();if(!(c instanceof $l&&c.loaded()))return;const f=l.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!f)return;const m=l.paint.get("raster-array-band")||c.getInitialBand(f);if(m==null)return;const y=t.getIds().map(w=>t.getTileByID(w));for(const w of y)w.updateNeeded(f,m)&&c.prepareTile(w,f,m)},"raster-particle":function(l,t,i){const c=t.getSource();if(!(c instanceof $l&&c.loaded()))return;const f=l.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!f)return;const m=l.paint.get("raster-particle-array-band")||c.getInitialBand(f);if(m==null)return;const y=t.getIds().map(w=>t.getTileByID(w));for(const w of y)w.updateNeeded(f,m)&&c.prepareTile(w,f,m)}},rl={fill:Nh},Yu={fill:function(l,t,i,c){if(!i.layout||i.layout.get("fill-elevation-reference")==="none")return;const f=l.context.gl,m=new Bt(f.LEQUAL,Bt.ReadOnly,l.depthRangeFor3D),y=new ur({func:f.ALWAYS,mask:255},255,255,f.KEEP,f.KEEP,f.REPLACE),w=l.transform.getFreeCameraOptions().position,S=l.getOrCreateProgram("elevatedStructuresDepthReconstruct",{defines:["DEPTH_RECONSTRUCTION"]});for(const M of c){const P=t.getTile(M),O=P.getBucket(i);if(!O)continue;const D=O.elevatedStructures;if(!D||D.maskSegments.segments[0].primitiveLength===0)continue;const F=qu(M.toUnwrapped(),w),q=l.translatePosMatrix(M.projMatrix,P,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor")),V=yo(q,F,0,0,0);S.draw(l,f.TRIANGLES,m,y,Gr.disabled,ar.disabled,V,i.id,D.vertexBuffer,D.indexBuffer,D.maskSegments,i.paint,l.transform.zoom)}}};class Ku{constructor(t,i,c,f,m,y){this.context=new Ep(t,i),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=m,this._timeStamp=s.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const w=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const M of w)this._debugParams.enabledLayers[M]=!0;m.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),m.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),m.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),m.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),m.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),m.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const M of w)m.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],M);this.occlusionParams=new zf(m),this.setup(),this.numSublayers=Ls.maxUnderzooming+Ls.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new gm(this),this._wireframeDebugCache=new Cp,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const S=new s.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,S,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=f,this.worldview=y}updateTerrain(t,i){const c=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(c||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Fs(this,t));const f=this._terrain;this.transform.elevation=c?f:null,f.update(t,this.transform,i),this.transform.elevation&&!f.enabled&&(this.transform.elevation=null)}_updateFog(t){const i=t.fog;if(!i||this.transform.projection.name==="globe"||i.getOpacity(this.transform.pitch)<1||i.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[c,f]=i.getFovAdjustedRange(this.transform._fov);if(c>f)return void(this.transform.fogCullDistSq=null);const m=c+.78*(f-c);this.transform.fogCullDistSq=m*m}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Fs(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,i){if(this.width=t*s.q.devicePixelRatio,this.height=i*s.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style.order)this.style._mergedLayers[c].resize()}setup(){const t=this.context,i=new s.ba;i.emplaceBack(0,0),i.emplaceBack(s.aj,0),i.emplaceBack(0,s.aj),i.emplaceBack(s.aj,s.aj),this.tileExtentBuffer=t.createVertexBuffer(i,s.bc.members),this.tileExtentSegments=s.bd.simpleSegment(0,0,4,2);const c=new s.ba;c.emplaceBack(0,0),c.emplaceBack(s.aj,0),c.emplaceBack(0,s.aj),c.emplaceBack(s.aj,s.aj),this.debugBuffer=t.createVertexBuffer(c,s.bc.members),this.debugSegments=s.bd.simpleSegment(0,0,4,5);const f=new s.ba;f.emplaceBack(-1,-1),f.emplaceBack(1,-1),f.emplaceBack(-1,1),f.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(f,s.bc.members),this.viewportSegments=s.bd.simpleSegment(0,0,4,2);const m=new s.aZ;m.emplaceBack(0,0,0,0),m.emplaceBack(s.aj,0,s.aj,0),m.emplaceBack(0,s.aj,0,s.aj),m.emplaceBack(s.aj,s.aj,s.aj,s.aj),this.mercatorBoundsBuffer=t.createVertexBuffer(m,s.bf.members),this.mercatorBoundsSegments=s.bd.simpleSegment(0,0,4,2);const y=new s.a_;y.emplaceBack(0,1,2),y.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(y);const w=new s.bb;for(const M of[0,1,3,2,0])w.emplaceBack(M);this.debugIndexBuffer=t.createIndexBuffer(w),this.emptyTexture=new s.T(t,new s.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=s.bz();const S=this.context.gl;this.stencilClearMode=new ur({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Bt.disabled,this.stencilClearMode,Gr.disabled,ar.disabled,Do(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,i,c){if(!i||this.currentStencilSource===i.id||!t.isTileClipped()||!c||c.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let w=!1;for(const S of c)if(this._tileClippingMaskIDs[S.key]===void 0){w=!0;break}if(!w)return}this.currentStencilSource=i.id;const f=this.context,m=f.gl;this.nextStencilID+c.length>256&&this.clearStencil(),f.setColorMode(Gr.disabled),f.setDepthMode(Bt.disabled);const y=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of c){const S=i.getTile(w),M=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,{tileBoundsBuffer:P,tileBoundsIndexBuffer:O,tileBoundsSegments:D}=this.getTileBoundsBuffers(S);y.draw(this,m.TRIANGLES,Bt.disabled,new ur({func:m.ALWAYS,mask:0},M,255,m.KEEP,m.KEEP,m.REPLACE),Gr.disabled,ar.disabled,Do(w.projMatrix),"$clipping",P,O,D)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,i=this.context.gl;return new ur({func:i.NOTEQUAL,mask:255},t,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const i=this.context.gl;return new ur({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(t){const i=this.context.gl,c=t.sort((y,w)=>w.overscaledZ-y.overscaledZ),f=c[c.length-1].overscaledZ,m=c[0].overscaledZ-f+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const y={};for(let w=0;w<m;w++)y[w+f]=new ur({func:i.GEQUAL,mask:255},w+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=m,[y,c]}return[{[f]:ur.disabled},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Gr([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new s.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Gr.unblended:Gr.alphaBlended}colorModeForDrapableLayerRenderPass(t){const i=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Gr([i.ONE,i.ONE_MINUS_SRC_ALPHA,i.CONSTANT_ALPHA,i.ONE_MINUS_SRC_ALPHA],new s.am(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,i,c,f=!1){if(this.depthOcclusion)return new Bt(this.context.gl.GREATER,Bt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!f)return Bt.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Bt(c||this.context.gl.LEQUAL,i,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,i=Math.ceil(this.width),c=Math.ceil(this.height),f=this.context.bindFramebuffer.get(),m=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===i&&this.depthFBO.height===c||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),i!==0&&c!==0&&(this.depthFBO=new Gu(this.context,i,c,!1,"texture"),this.depthTexture=new s.T(this.context,{width:i,height:c,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(f),t.bindTexture(t.TEXTURE_2D,m),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,i,c,0,0,i,c,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,i)=>t+i/this._fpsHistory.length,0))}render(t,i){const c=s.q.now();this._dt=c-this._timeStamp,this._timeStamp=c,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=i;const f=this.style._mergedLayers,m=!(!this.terrain||!this.terrain.enabled),y=()=>this.style._getOrder(m).filter(ze=>{const $e=f[ze];return!($e.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[$e.type]});let w=y(),S=!1,M=!1;for(const ze of w){const $e=f[ze];$e.type==="circle"&&(S=!0),$e.type==="symbol"&&($e.hasInitialOcclusionOpacityProperties?M=!0:S=!0)}let P=w.map(ze=>f[ze]);const O=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.q.now()),this.imageManager.beginFrame();let D=0,F=!1;for(const ze in O){const $e=O[ze];$e.used&&($e.prepare(this.context),$e.getSource().usedInConflation&&++D)}let q=!1;for(const ze of P)ze.isHidden(this.transform.zoom)||(ze.type==="clip"&&(q=!0),this.prepareLayer(ze));const V={},W={},X={},J={},se={};for(const ze in O){const $e=O[ze];V[ze]=$e.getVisibleCoordinates(),W[ze]=V[ze].slice().reverse(),X[ze]=$e.getVisibleCoordinates(!0).reverse(),J[ze]=$e.getShadowCasterCoordinates(),se[ze]=$e.sortCoordinatesByDistance(V[ze])}const le=ze=>{const $e=this.style.getLayerSourceCache(ze);return $e&&$e.used?$e.getSource():null};if(D||q||this._clippingActiveLastFrame){const ze=[],$e=[];let Ie=0;for(const Je of P)this.isSourceForClippingOrConflation(Je,le(Je))&&(ze.push(Je),$e.push(Ie)),Ie++;if(ze&&(q||ze.length>1)||this._clippingActiveLastFrame){q=!1;const Je=[];for(let Ve=0;Ve<ze.length;Ve++){const st=ze[Ve],vt=$e[Ve],Qe=this.style.getLayerSourceCache(st);if(!Qe||!Qe.used||!Qe.getSource().usedInConflation&&st.type!=="clip")continue;let pt=s.eu,Pt=s.bQ.None;const Lt=[];let Mt=!0;if(st.type==="clip"){pt=vt;for(const Nt of st.layout.get("clip-layer-types"))Pt|=Nt==="model"?s.bQ.Model:Nt==="symbol"?s.bQ.Symbol:s.bQ.FillExtrusion;for(const Nt of st.layout.get("clip-layer-scope"))Lt.push(Nt);st.isHidden(this.transform.zoom)?Mt=!1:q=!0}Mt&&Je.push({layer:st.fqid,cache:Qe,order:pt,clipMask:Pt,clipScope:Lt})}this.replacementSource.setSources(Je),F=!0}}this._clippingActiveLastFrame=q,F||this.replacementSource.clear(),this.conflationActive=F,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ze=0;ze<P.length;ze++){const $e=P[ze],Ie=$e.cutoffRange();if(this.longestCutoffRange=Math.max(Ie,this.longestCutoffRange),Ie>0){const Je=le($e);Je&&(this.minCutoffZoom=Math.max(Je.minzoom,this.minCutoffZoom)),$e.minzoom&&(this.minCutoffZoom=Math.max($e.minzoom,this.minCutoffZoom))}$e.is3D(m)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ze),this._lastOcclusionLayer=ze)}const ge=this.style&&this.style.fog;ge?(this._fogVisible=ge.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ge.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(X),this.opaquePassCutoff=0,w=y(),P=w.map(ze=>f[ze]));const _e=this._shadowRenderer;if(_e){_e.updateShadowParameters(this.transform,this.style.directionalLight);for(const ze in O)for(const $e of V[ze]){let Ie={min:0,max:0};this.terrain&&(Ie=this.terrain.getMinMaxForTile($e)||Ie),_e.addShadowReceiver($e.toUnwrapped(),Ie.min,Ie.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.ev(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Qa(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const pe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ue=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(pe&&!this._snow&&(this._snow=new Kn(this)),!pe&&this._snow&&(this._snow.destroy(),delete this._snow),ue&&!this._rain&&(this._rain=new Mp(this)),!ue&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!qi.has(this.context.gl))return;this.renderPass="offscreen";for(const ze of P){const $e=t.getLayerSourceCache(ze);if(!ze.hasOffscreenPass()||ze.isHidden(this.transform.zoom))continue;const Ie=$e?W[$e.id]:void 0;(ze.type==="custom"||ze.type==="raster"||ze.type==="raster-particle"||ze.isSky()||Ie&&Ie.length)&&this.renderLayer(this,$e,ze,Ie)}this.depthRangeFor3D=[0,1-(P.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,J)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ye=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),xe=(()=>{if(i.showOverdrawInspector)return s.am.black;const ze=this.style.fog;if(ze&&this.transform.projection.supportsFog){const $e=this.style.getLut(ze.scope);if(!ye){const Ie=ze.properties.get("color-use-theme")==="none",Je=ze.properties.get("color").toNonPremultipliedRenderColor(Ie?null:$e).toArray01();return new s.am(...Je)}if(ye){const Ie=ze.properties.get("space-color-use-theme")==="none",Je=ze.properties.get("space-color").toNonPremultipliedRenderColor(Ie?null:$e).toArray01();return new s.am(...Je)}}return s.am.transparent})();if(this.context.clear({color:xe,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ye&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const ze=P[this.currentLayer],$e=t.getLayerSourceCache(ze);if(ze.isSky())continue;const Ie=$e?(ze.is3D(m)?se:W)[$e.id]:void 0;this._renderTileClippingMasks(ze,$e,Ie),this.renderLayer(this,$e,ze,Ie)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ye&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const ze=P[this.currentLayer],$e=t.getLayerSourceCache(ze);ze.isSky()&&this.renderLayer(this,$e,ze,$e?W[$e.id]:void 0)}function Pe(ze,$e){let Ie;return $e&&(Ie=(ze.type==="symbol"?X:ze.is3D(m)?se:W)[$e.id]),Ie}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<w.length;){const ze=P[this.currentLayer];if(ze.type==="raster"||ze.type==="raster-particle"){const $e=t.getLayerSourceCache(ze);this.renderLayer(this,$e,ze,Pe(ze,$e))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Le=0;_e&&(Le=_e.getShadowCastingLayerCount());let Ye=!1,Xe=-1;for(let ze=0;ze<w.length;++ze){const $e=P[ze];$e.isHidden(this.transform.zoom)||$e.is3D(m)&&(Xe=ze)}M&&Xe===-1&&(S=!0);let ot=!1;for(;this.currentLayer<w.length;){const ze=P[this.currentLayer],$e=t.getLayerSourceCache(ze);if(ze.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(ze)){if(ze.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!ot&&ze.is3D(m)&&!m){const Ie=this.currentLayer,Je=Ve=>{for(this.currentLayer=0;this.currentLayer<P.length;this.currentLayer++){const st=P[this.currentLayer];if(rl[st.type]){const vt=this.style.getLayerSourceCache(st);rl[st.type](this,vt,st,Pe(st,vt),Ve)}}};Je("initialize"),Je("reset"),this.currentLayer=Ie,ot=!0}if(S&&!Ye&&this.terrain&&!this.transform.isOrthographic&&(Ye=!0,this.blitDepth()),M&&Xe!==-1&&this.currentLayer===Xe+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(ze,$e,$e?V[$e.id]:void 0),this.renderLayer(this,$e,ze,Pe(ze,$e)),!this.terrain&&_e&&Le>0&&ze.hasShadowPass()&&--Le==0){{this.clearStencil();const Ie=this.currentLayer;for(this.currentLayer=0;this.currentLayer<P.length;this.currentLayer++){const Je=P[this.currentLayer];if(Yu[Je.type]){const Ve=this.style.getLayerSourceCache(Je);Yu[Je.type](this,Ve,Je,Pe(Je,Ve))}}this.currentLayer=Ie}if(_e.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Ie=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ie;this.currentLayer++){const Je=P[this.currentLayer];if(!Je.hasLightBeamPass())continue;const Ve=t.getLayerSourceCache(Je);this.renderLayer(this,Ve,Je,Ve?W[Ve.id]:void 0)}this.currentLayer=Ie,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ie=this.currentLayer;this.depthOcclusion=!0;for(const Je of this.layersWithOcclusionOpacity){this.currentLayer=Je;const Ve=P[this.currentLayer],st=t.getLayerSourceCache(Ve),vt=st?W[st.id]:void 0;this.terrain||this._renderTileClippingMasks(Ve,st,st?V[st.id]:void 0),this.renderLayer(this,st,Ve,vt)}this.depthOcclusion=!1,this.currentLayer=Ie,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ze=null;P.forEach($e=>{const Ie=t.getLayerSourceCache($e);Ie&&!$e.isHidden(this.transform.zoom)&&Ie.getVisibleCoordinates().length&&(!ze||ze.getSource().maxzoom<Ie.getSource().maxzoom)&&(ze=Ie)}),ze&&this.options.showTileBoundaries&&No(this,ze,ze.getVisibleCoordinates(),s.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&No(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ze){const $e=ze.transform.padding;Wu(ze,ze.transform.height-($e.top||0),3,Ja),Wu(ze,$e.bottom||0,3,jh),Li(ze,$e.left||0,3,Bs),Li(ze,ze.transform.width-($e.right||0),3,El);const Ie=ze.transform.centerPoint;(function(Je,Ve,st,vt){Il(Je,Ve-1,st-10,2,20,vt),Il(Je,Ve-10,st-1,20,2,vt)})(ze,Ie.x,ze.transform.height-Ie.y,js)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),F||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:i}=this.transform.projection,c=!i||!i.includes(t.type);if(Nd[t.type]&&(c||this.terrain&&t.type==="custom")){const f=this.style.getLayerSourceCache(t);Nd[t.type](t,f,this)}this.gpuTimingEnd()}renderLayer(t,i,c,f){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="sky"||c.type==="custom"||c.type==="model"||c.type==="raster"||c.type==="raster-particle"||f&&f.length)&&(this.id=c.id,this.gpuTimingStart(c),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(c.type)&&(!t.terrain||c.type!=="custom")||c.type==="clip"||pn[c.type](t,i,c,f,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery,c=this.context.gl;let f=this.gpuTimers[t.id];f||(f=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:c.createQuery()}),f.calls++,c.beginQuery(i.TIME_ELAPSED_EXT,f.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,i=this.context.gl,c=i.createQuery();this.deferredRenderGpuTimeQueries.push(c),i.beginQuery(t.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const i={};for(const c in t){const f=t[c],m=this.context.extTimerQuery,y=m.getQueryParameter(f.query,this.context.gl.QUERY_RESULT)/1e6;m.deleteQueryEXT(f.query),i[c]=y}return i}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const i=this.context.gl;let c=0;for(const f of t)c+=i.getQueryParameter(f,i.QUERY_RESULT)/1e6,i.deleteQuery(f);return c}translatePosMatrix(t,i,c,f,m){if(!c[0]&&!c[1])return t;const y=m?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(y){const M=Math.sin(y),P=Math.cos(y);c=[c[0]*P-c[1]*M,c[0]*M+c[1]*P]}const w=[m?c[0]:s.aw(i,c[0],this.transform.zoom),m?c[1]:s.aw(i,c[1],this.transform.zoom),0],S=new Float32Array(16);return s.bo(S,t,w),S}saveTileTexture(t){const i=t.size[0],c=this._tileTextures[i];c?c.push(t):this._tileTextures[i]=[t]}getTileTexture(t){const i=this._tileTextures[t];return i&&i.length>0?i.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,i,c){const f=c===void 0?this.terrain&&this.terrain.renderingToTexture:c,m=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(m.push("LIGHTING_3D_MODE"),m.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):f||m.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||m.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(m.push("TERRAIN"),this.linearFloatFilteringSupported()&&m.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&m.push("GLOBE"),!this._fogVisible||f||i!==void 0&&!i||m.push("FOG","FOG_DITHERING"),f&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}getOrCreateProgram(t,i){this.cache=this.cache||{};const c=i&&i.defines||[],f=i&&i.config,m=this.currentGlobalDefines(t,i&&i.overrideFog,i&&i.overrideRtt).concat(c),y=Wc.cacheKey(Ch[t],t,m,f);return this.cache[y]||(this.cache[y]=new Wc(this.context,t,Ch[t],f,Yc[t],m)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,i){if(this.style.enable3dLights()){const c=this.style.directionalLight,f=this.style.ambientLight;if(c&&f){const m=((y,w,S)=>{const M=y.properties.get("direction"),P=y.properties.get("color-use-theme")==="none",O=y.properties.get("color").toNonPremultipliedRenderColor(P?null:S.getLut(y.scope)).toArray01(),D=y.properties.get("intensity"),F=w.properties.get("color-use-theme")==="none",q=w.properties.get("color").toNonPremultipliedRenderColor(F?null:S.getLut(w.scope)).toArray01(),V=w.properties.get("intensity"),W=[M.x,M.y,M.z],X=s.dw(q,V),J=s.dw(O,D);return{u_lighting_ambient_color:X,u_lighting_directional_dir:W,u_lighting_directional_color:J,u_ground_radiance:Hc(W,J,X)}})(c,f,this.style);i.setLightsUniformValues(t,m)}}}uploadCommonUniforms(t,i,c,f,m){if(this.uploadCommonLightUniforms(t,i),this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const w=y.getOpacity(this.transform.pitch),S=((M,P,O,D,F,q,V,W,X,J,se,le)=>{const ge=M.transform,_e=P.properties.get("color-use-theme")==="none",pe=P.properties.get("color").toNonPremultipliedRenderColor(_e?null:M.style.getLut(P.scope)).toArray01();pe[3]=D;const ue=M.frameCounter/1e3%1,[ye,xe]=P.properties.get("vertical-range");return{u_fog_matrix:O?ge.calculateFogTileMatrix(O):le||M.identityMat,u_fog_range:P.getFovAdjustedRange(ge._fov),u_fog_color:pe,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ye,xe),xe],u_fog_temporal_offset:ue,u_frustum_tl:F,u_frustum_tr:q,u_frustum_br:V,u_frustum_bl:W,u_globe_pos:X,u_globe_radius:J,u_viewport:se,u_globe_transition:s.ah(ge.zoom),u_is_globe:+(ge.projection.name==="globe")}})(this,y,c,w,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.q.devicePixelRatio,this.transform.height*s.q.devicePixelRatio],f);i.setFogUniformValues(t,S)}m&&i.setCutoffUniformValues(t,m.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,i=t.createTexture();return t.bindTexture(t.TEXTURE_2D,i),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),i}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,i=this._backgroundTiles={},c=this.transform.coveringTiles({tileSize:512});for(const f of c)i[f.key]=t[f.key]||new Wl(f,512,this.transform.tileZoom,this,void 0,this.worldview);return i}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,i){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!i||i.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let i=this._cachedTileFogOpacities[t.key];return i||(this._cachedTileFogOpacities[t.key]=i=this.style.fog.getOpacityForTile(t)),i[0]>=Ue||i[1]>=Ue}setupDepthForOcclusion(t,i,c){const f=this.context,m=f.gl,y=!!c;var w;c||(c={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),f.activeTexture.set(m.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE),c.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],c.u_depth_range_unpack=[2/((w=this.depthRangeFor3D)[1]-w[0]),-1-2*w[0]/(w[1]-w[0])],c.u_occluder_half_size=.5*this.occlusionParams.occluderSize,c.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE),f.activeTexture.set(m.TEXTURE0),y||i.setTerrainUniformValues(f,c)}}function Cl(l,t){let i=!1,c=null;const f=()=>{c=null,i&&(l(),c=setTimeout(f,t),i=!1)};return()=>(i=!0,c||f(),c)}class kf{constructor(t){this._hashName=t&&encodeURIComponent(t),s.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Cl(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const i=Bd(t);if(this._hashName){const c=this._hashName;let f=!1;const m=location.hash.slice(1).split("&").map(y=>{const w=y.split("=")[0];return w===c?(f=!0,`${w}=${i}`):y}).filter(y=>y);return f||m.push(`${c}=${i}`),`#${m.join("&")}`}return`#${i}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let i;return t.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(i=c)}),(i&&i[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const i=this._getCurrentHash();if(i.length>=3&&!i.some(c=>isNaN(Number(c)))){const c=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(i[3]||0):t.getBearing();return t.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:c,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Bd(l,t){const i=l.getCenter(),c=Math.round(100*l.getZoom())/100,f=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,f),y=Math.round(i.lng*m)/m,w=Math.round(i.lat*m)/m,S=l.getBearing(),M=l.getPitch();let P=t?`/${y}/${w}/${c}`:`${c}/${w}/${y}`;return(S||M)&&(P+="/"+Math.round(10*S)/10),M&&(P+=`/${Math.round(M)}`),P}const tu={linearity:.3,easing:s.ew(0,0,.3,1)},jd=s.h({deceleration:2500,maxSpeed:1400},tu),Ra=s.h({deceleration:20,maxSpeed:1400},tu),za=s.h({deceleration:1e3,maxSpeed:360},tu),Gh=s.h({deceleration:1e3,maxSpeed:90},tu);class Vd{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,i=s.q.now();for(;t.length>0&&i-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const i={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)i.zoom+=m.zoomDelta||0,i.bearing+=m.bearingDelta||0,i.pitch+=m.pitchDelta||0,m.panDelta&&i.pan._add(m.panDelta),m.around&&(i.around=m.around),m.pinchAround&&(i.pinchAround=m.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(i.pan.mag()){const m=eo(i.pan.mag(),c,s.h({},jd,t||{}));f.offset=i.pan.mult(m.amount/i.pan.mag()),f.center=this._map.transform.center,Ju(f,m)}if(i.zoom){const m=eo(i.zoom,c,Ra);f.zoom=this._map.transform.zoom+m.amount,Ju(f,m)}if(i.bearing){const m=eo(i.bearing,c,za);f.bearing=this._map.transform.bearing+s.ay(m.amount,-179,179),Ju(f,m)}if(i.pitch){const m=eo(i.pitch,c,Gh);f.pitch=this._map.transform.pitch+m.amount,Ju(f,m)}if(f.zoom||f.bearing){const m=i.pinchAround===void 0?i.around:i.pinchAround;f.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),f.noMoveStart=!0,f}}function Ju(l,t){(!l.duration||l.duration<t.duration)&&(l.duration=t.duration,l.easing=t.easing)}function eo(l,t,i){const{maxSpeed:c,linearity:f,deceleration:m}=i,y=s.ay(l*f/(t/1e3),-c,c),w=Math.abs(y)/(m*f);return{easing:i.easing,duration:1e3*w,amount:y*(w/2)}}class os extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,c,f={}){const m=Wt(i.getCanvasContainer(),c),y=i.unproject(m);super(t,s.h({point:m,lngLat:y,originalEvent:c},f)),this._defaultPrevented=!1,this.target=i}}class Ml extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,c){const f=t==="touchend"?c.changedTouches:c.touches,m=Cr(i.getCanvasContainer(),f),y=m.map(S=>i.unproject(S)),w=m.reduce((S,M,P,O)=>S.add(M.div(O.length)),new s.P(0,0));super(t,{points:m,point:w,lngLats:y,lngLat:i.unproject(w),originalEvent:c}),this._defaultPrevented=!1}}class Pl extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i){super("wheel",{originalEvent:i}),this._defaultPrevented=!1}}class Ud{constructor(t,i){this._map=t,this._clickTolerance=i.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Pl(this._map,t))}mousedown(t,i){return this._mousedownPos=i,this._firePreventable(new os(t.type,this._map,t))}mouseup(t){this._map.fire(new os(t.type,this._map,t))}preclick(t){const i=s.h({},t);i.type="preclick",this._map.fire(new os(i.type,this._map,i))}click(t,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||(this.preclick(t),this._map.fire(new os(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new os(t.type,this._map,t))}mouseover(t){this._map.fire(new os(t.type,this._map,t))}mouseout(t){this._map.fire(new os(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ml(t.type,this._map,t))}touchmove(t){this._map.fire(new Ml(t.type,this._map,t))}touchend(t){this._map.fire(new Ml(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ml(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qh{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new os(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new os("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new os(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hh{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,i){this.isEnabled()&&t.shiftKey&&t.button===0&&(jt(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(t,i){if(!this._active)return;const c=i,f=this._startPos,m=this._lastPos;if(!f||!m||m.equals(c)||!this._box&&c.dist(f)<this._clickTolerance)return;this._lastPos=c,this._box||(this._box=Be("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const y=Math.min(f.x,c.x),w=Math.max(f.x,c.x),S=Math.min(f.y,c.y),M=Math.max(f.y,c.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${y}px,${S}px)`,this._box.style.width=w-y+"px",this._box.style.height=M-S+"px")})}mouseupWindow(t,i){if(!this._active)return;const c=this._startPos,f=i;if(c&&t.button===0){if(this.reset(),Kt(),c.x!==f.x||c.y!==f.y)return this._map.fire(new s.A("boxzoomend",{originalEvent:t})),{cameraAnimation:m=>m.fitScreenCoordinates(c,f,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),vr(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new s.A(t,{originalEvent:i}))}}function nl(l,t){const i={};for(let c=0;c<l.length;c++)i[l[c].identifier]=t[c];return i}class as{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,i,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=function(f){const m=new s.P(0,0);for(const y of f)m._add(y);return m.div(f.length)}(i),this.touches=nl(c,i)))}touchmove(t,i,c){if(this.aborted||!this.centroid)return;const f=nl(c,i);for(const m in this.touches){const y=f[m];(!y||y.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(t,i,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class ru{constructor(t){this.singleTap=new as(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,i,c){this.singleTap.touchstart(t,i,c)}touchmove(t,i,c){this.singleTap.touchmove(t,i,c)}touchend(t,i,c){const f=this.singleTap.touchend(t,i,c);if(f){const m=t.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(f)<30;if(m&&y||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class Df{constructor(){this._zoomIn=new ru({numTouches:1,numTaps:2}),this._zoomOut=new ru({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,i,c){this._zoomIn.touchstart(t,i,c),this._zoomOut.touchstart(t,i,c)}touchmove(t,i,c){this._zoomIn.touchmove(t,i,c),this._zoomOut.touchmove(t,i,c)}touchend(t,i,c){const f=this._zoomIn.touchend(t,i,c),m=this._zoomOut.touchend(t,i,c);return f?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()+1,around:y.unproject(f)},{originalEvent:t})}):m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()-1,around:y.unproject(m)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const $d={0:1,2:2},Rl={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Qu{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,i){return!1}_move(t,i){return{}}mousedown(t,i){if(this._lastPoint)return;const c=oi(t);this._correctButton(t,c)&&(this._lastPoint=i,this._eventButton=c)}mousemoveWindow(t,i){const c=this._lastPoint;if(c){if(t.preventDefault(),this._eventButton!=null&&function(f,m){const y=$d[m];return f.buttons===void 0||(f.buttons&y)!==y}(t,this._eventButton))this.reset();else if(this._moved||!(i.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=i,this._move(c,i)}}mouseupWindow(t){this._lastPoint&&oi(t)===this._eventButton&&(this._moved&&Kt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gd extends Qu{mousedown(t,i){super.mousedown(t,i),this._lastPoint&&(this._active=!0)}_correctButton(t,i){return i===0&&!t.ctrlKey}_move(t,i){return{around:i,panDelta:i.sub(t)}}}class Wh extends Qu{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Rl[t.pitchRotateKey]:void 0}_correctButton(t,i){return this._pitchRotateKey?i===0&&t[this._pitchRotateKey]:i===0&&t.ctrlKey||i===2}_move(t,i){const c=.8*(i.x-t.x);if(c)return this._active=!0,{bearingDelta:c}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class nu extends Qu{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Rl[t.pitchRotateKey]:void 0}_correctButton(t,i){return this._pitchRotateKey?i===0&&t[this._pitchRotateKey]:i===0&&t.ctrlKey||i===2}_move(t,i){const c=-.5*(i.y-t.y);if(c)return this._active=!0,{pitchDelta:c}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class to{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),s.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(t,i,c){return this._calculateTransform(t,i,c)}touchmove(t,i,c){if(this._active&&!(c.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(c.length===1&&!s.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,i,c)}}touchend(t,i,c){this._calculateTransform(t,i,c),this._active&&c.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,c){c.length>0&&(this._active=!0);const f=nl(c,i),m=new s.P(0,0),y=new s.P(0,0);let w=0;for(const M in f){const P=f[M],O=this._touches[M];O&&(m._add(P),y._add(P.sub(O)),w++,f[M]=P)}if(this._touches=f,w<this._minTouches||!y.mag())return;const S=y.div(w);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(w),panDelta:S}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Be("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Cs{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,i,c){return{}}touchstart(t,i,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([i[0],i[1]]))}touchmove(t,i,c){const f=this._firstTwoTouches;if(!f)return;t.preventDefault();const[m,y]=f,w=iu(c,i,m),S=iu(c,i,y);if(!w||!S)return;const M=this._aroundCenter?null:w.add(S).div(2);return this._move([w,S],M,t)}touchend(t,i,c){if(!this._firstTwoTouches)return;const[f,m]=this._firstTwoTouches,y=iu(c,i,f),w=iu(c,i,m);y&&w||(this._active&&Kt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function iu(l,t,i){for(let c=0;c<l.length;c++)if(l[c].identifier===i)return t[c]}function eh(l,t){return Math.log(l/t)/Math.LN2}class qd extends Cs{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,i){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(eh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:eh(this._distance,c),pinchAround:i}}}function Zh(l,t){return 180*l.angleWith(t)/Math.PI}class Lf extends Cs{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,i){const c=this._vector;if(this._vector=t[0].sub(t[1]),c&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Zh(this._vector,c),pinchAround:i}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const i=25/(Math.PI*this._minDiameter)*360,c=this._startVector;if(!c)return!1;const f=Zh(t,c);return Math.abs(f)<i}}function th(l){return Math.abs(l.y)>Math.abs(l.x)}class Of extends Cs{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,th(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,i,c){const f=this._lastPoints;if(!f)return;const m=t[0].sub(f[0]),y=t[1].sub(f[1]);return this._map._cooperativeGestures&&!s.ex()&&c.touches.length<3||(this._valid=this.gestureBeginsVertically(m,y,c.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(m.y+y.y)/2*-.5})}gestureBeginsVertically(t,i,c){if(this._valid!==void 0)return this._valid;const f=t.mag()>=2,m=i.mag()>=2;if(!f&&!m)return;if(!f||!m)return this._firstMove==null&&(this._firstMove=c),c-this._firstMove<100&&void 0;const y=t.y>0==i.y>0;return th(t)&&th(i)&&y}}const Hd={panStep:100,bearingStep:15,pitchStep:10};class Ff{constructor(){const t=Hd;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let i=0,c=0,f=0,m=0,y=0;switch(t.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),m=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),m=1);break;case 38:t.shiftKey?f=1:(t.preventDefault(),y=-1);break;case 40:t.shiftKey?f=-1:(t.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(c=0,f=0),{cameraAnimation:w=>{const S=w.getZoom();w.easeTo({duration:300,easeId:"keyboardHandler",easing:Nf,zoom:i?Math.round(S)+i*(t.shiftKey?2:1):S,bearing:w.getBearing()+c*this._bearingStep,pitch:w.getPitch()+f*this._pitchStep,offset:[-m*this._panStep,-y*this._panStep],center:w.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Nf(l){return l*(2-l)}const Xh=4.000244140625,Wd=1/450;class Bf{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._handler=i,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Wd,s.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||s.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=s.q.now(),f=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,i!==0&&i%Xh==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=i,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(f*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=Wt(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:i,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const i=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>Xh?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&P!==0&&(P=1/P);const O=i(),D=Math.pow(2,O),F=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):D;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(F*P))),this._type==="wheel"&&(this._startZoom=O,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const c=typeof this._targetZoom=="number"?this._targetZoom:i(),f=this._startZoom,m=this._easing;let y,w=!1;if(this._type==="wheel"&&f&&m){const M=Math.min((s.q.now()-this._lastWheelEventTime)/200,1),P=m(M);y=s.ai(f,c,P),M<1?this._frameId||(this._frameId=!0):w=!0}else y=c,w=!0;this._active=!0,w&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let S=y-i();return S*this._lastDelta<0&&(S=0),{noInertia:!0,needsRenderFrame:!w,zoomDelta:S,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=s.ey;if(this._prevEase){const c=this._prevEase,f=(s.q.now()-c.start)/c.duration,m=c.easing(f+.01)-c.easing(f),y=.27/Math.sqrt(m*m+1e-4)*.01,w=Math.sqrt(.0729-y*y);i=s.ew(y,w,.25,1)}return this._prevEase={start:s.q.now(),duration:t,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Be("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Zd{constructor(t,i){this._clickZoom=t,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Yh{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,i){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:c.getZoom()+(t.shiftKey?-1:1),around:c.unproject(i)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pp{constructor(){this._tap=new ru({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,i,c){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=i[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(t,i,c))}touchmove(t,i,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const f=i[0],m=f.y-this._swipePoint.y;return this._swipePoint=f,t.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(t,i,c)}touchend(t,i,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(t,i,c)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jf{constructor(t,i,c){this._el=t,this._mousePan=i,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Vf{constructor(t,i,c){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=i,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Rp{constructor(t,i,c,f){this._el=t,this._touchZoom=i,this._touchRotate=c,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const su=l=>l.zoom||l.drag||l.pitch||l.rotate;class $n extends s.A{}class zp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,i){const c=s.at([],i,t);this.radius=s.ae(c[2]<0?s.eA([],c,this.constants):[c[0],c[1],0])}projectRay(t){s.eA(t,t,this.constants),s.au(t,t),s.eB(t,t,this.constants);const i=s.bY([],t,this.radius);if(i[2]>0){const c=s.bY([],[0,0,1],s.bG(i,[0,0,1])),f=s.bY([],s.au([],[i[0],i[1],0]),this.radius),m=s.cV([],i,s.bY([],s.at([],s.cV([],f,c),i),2));i[0]=m[0],i[1]=m[1]}return i}}function Kh(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class Jh{constructor(t,i){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Vd(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new zp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),s.aV(["handleEvent","handleWindowEvent"],this);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,m,y]of this._listeners){const w=f===document?this.handleWindowEvent:this.handleEvent;f.addEventListener(m,w,y)}}destroy(){for(const[t,i,c]of this._listeners){const f=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(i,f,c)}}_addDefaultHandlers(t){const i=this._map,c=i.getCanvasContainer();this._add("mapEvent",new Ud(i,t));const f=i.boxZoom=new Hh(i,t);this._add("boxZoom",f);const m=new Df,y=new Yh;i.doubleClickZoom=new Zd(y,m),this._add("tapZoom",m),this._add("clickZoom",y);const w=new Pp;this._add("tapDragZoom",w);const S=i.touchPitch=new Of(i);this._add("touchPitch",S);const M=new Wh(t),P=new nu(t);i.dragRotate=new Vf(t,M,P),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);const O=new Gd(t),D=new to(i,t);i.dragPan=new jf(c,O,D),this._add("mousePan",O),this._add("touchPan",D,["touchZoom","touchRotate"]);const F=new Lf,q=new qd;i.touchZoomRotate=new Rp(c,q,F,w),this._add("touchRotate",F,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new qh(i));const V=i.scrollZoom=new Bf(i,this);this._add("scrollZoom",V,["mousePan"]);const W=i.keyboard=new Ff;this._add("keyboard",W);for(const X of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[X]&&i[X].enable(t[X])}_add(t,i,c){this._handlers.push({handlerName:t,handler:i,allowed:c}),this._handlersById[t]=i}stop(t){if(!this._updatingCamera){for(const{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!su(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,i,c){for(const f in t)if(f!==c&&(!i||i.indexOf(f)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const i=[];for(const c of t)this._el.contains(c.target)&&i.push(c);return i}handleEvent(t,i){this._updatingCamera=!0;const c=t.type==="renderFrame",f=c?void 0:t,m={needsRenderFrame:!1},y={},w={},S=t.touches?this._getMapTouches(t.touches):void 0,M=S?Cr(this._el,S):c?void 0:Wt(this._el,t);for(const{handlerName:D,handler:F,allowed:q}of this._handlers){if(!F.isEnabled())continue;let V;this._blockedByActive(w,q,D)?F.reset():F[i||t.type]&&(V=F[i||t.type](t,M,S),this.mergeHandlerResult(m,y,V,D,f),V&&V.needsRenderFrame&&this._triggerRenderFrame()),(V||F.isActive())&&(w[D]=F)}const P={};for(const D in this._previousActiveHandlers)w[D]||(P[D]=f);this._previousActiveHandlers=w,(Object.keys(P).length||Kh(m))&&(this._changes.push([m,y,P]),this._triggerRenderFrame()),(Object.keys(w).length||Kh(m))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:O}=m;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))}mergeHandlerResult(t,i,c,f,m){if(!c)return;s.h(t,c);const y={handlerName:f,originalEvent:c.originalEvent||m};c.zoomDelta!==void 0&&(i.zoom=y),c.panDelta!==void 0&&(i.drag=y),c.pitchDelta!==void 0&&(i.pitch=y),c.bearingDelta!==void 0&&(i.rotate=y)}_applyChanges(){const t={},i={},c={};for(const[f,m,y]of this._changes)f.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(f.panDelta)),f.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+f.pitchDelta),f.around!==void 0&&(t.around=f.around),f.aroundCoord!==void 0&&(t.aroundCoord=f.aroundCoord),f.pinchAround!==void 0&&(t.pinchAround=f.pinchAround),f.noInertia&&(t.noInertia=f.noInertia),s.h(i,m),s.h(c,y);this._updateMapTransform(t,i,c),this._changes=[]}_updateMapTransform(t,i,c){const f=this._map,m=f.transform,y=J=>[J.x,J.y,J.z];if((J=>{const se=this._eventsInProgress.drag;return se&&!this._handlersById[se.handlerName].isActive()})()&&!Kh(t)){const J=m.zoom;m.cameraElevationReference="sea",this._originalZoom!=null&&m._orthographicProjectionAtLowPitch&&m.projection.name!=="globe"&&m.pitch===0?(m.cameraElevationReference="ground",m.zoom=this._originalZoom):(m.recenterOnTerrain(),m.cameraElevationReference="ground"),J!==m.zoom&&this._map._update(!0)}if(m._isCameraConstrained&&f._stop(!0),!Kh(t))return void this._fireEvents(i,c,!0);let{panDelta:w,zoomDelta:S,bearingDelta:M,pitchDelta:P,around:O,aroundCoord:D,pinchAround:F}=t;m._isCameraConstrained&&(S>0&&(S=0),m._isCameraConstrained=!1),F!==void 0&&(O=F),(S||(J=>i[J]&&!this._eventsInProgress[J])("drag"))&&O&&(this._dragOrigin=y(m.pointCoordinate3D(O)),this._originalZoom=m.zoom,this._trackingEllipsoid.setup(m._camera.position,this._dragOrigin)),m.cameraElevationReference="sea",f._stop(!0),O=O||f.transform.centerPoint,M&&(m.bearing+=M),P&&(m.pitch+=P),m._updateCameraState();const q=[0,0,0];if(w)if(m.projection.name==="mercator"){const J=this._trackingEllipsoid.projectRay(m.screenPointToMercatorRay(O).dir),se=this._trackingEllipsoid.projectRay(m.screenPointToMercatorRay(O.sub(w)).dir);q[0]=se[0]-J[0],q[1]=se[1]-J[1]}else{const J=m.pointCoordinate(O);if(m.projection.name==="globe"){w=w.rotate(-m.angle);const se=m._pixelsPerMercatorPixel/m.worldSize;q[0]=-w.x*s.ez(s.aY(J.y))*se,q[1]=-w.y*s.ez(m.center.lat)*se}else{const se=m.pointCoordinate(O.sub(w));J&&se&&(q[0]=se.x-J.x,q[1]=se.y-J.y)}}const V=m.zoom,W=[0,0,0];if(S){const J=y(D||m.pointCoordinate3D(O)),se={dir:s.au([],s.at([],J,m._camera.position))};if(se.dir[2]<0){const le=m.zoomDeltaToMovement(J,S);s.bY(W,se.dir,le)}}const X=s.cV(q,q,W);m._translateCameraConstrained(X),S&&Math.abs(m.zoom-V)>1e-4&&m.recenterOnTerrain(),m.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(i,c,!0)}_fireEvents(t,i,c){const f=su(this._eventsInProgress),m=su(t),y={};for(const P in t){const{originalEvent:O}=t[P];this._eventsInProgress[P]||(y[`${P}start`]=O),this._eventsInProgress[P]=t[P]}!f&&m&&this._fireEvent("movestart",m.originalEvent);for(const P in y)this._fireEvent(P,y[P]);m&&this._fireEvent("move",m.originalEvent);for(const P in t){const{originalEvent:O}=t[P];this._fireEvent(P,O)}const w={};let S;for(const P in this._eventsInProgress){const{handlerName:O,originalEvent:D}=this._eventsInProgress[P];this._handlersById[O].isActive()||(delete this._eventsInProgress[P],S=i[O]||D,w[`${P}end`]=S)}for(const P in w)this._fireEvent(P,w[P]);const M=su(this._eventsInProgress);if(c&&(f||m)&&!M){this._updatingCamera=!0;const P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=D=>D!==0&&-this._bearingSnap<D&&D<this._bearingSnap;P?(O(P.bearing||this._map.getBearing())&&(P.bearing=0),this._map.easeTo(P,{originalEvent:S})):(this._map.fire(new s.A("moveend",{originalEvent:S})),O(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new s.A(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new $n("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Uf="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class rh extends s.E{constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,this._respectPrefersReducedMotion=i.respectPrefersReducedMotion!==!1,s.aV(["_renderFrameCallback"],this)}getCenter(){return new s.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(t,i){return this.jumpTo({center:t},i)}panBy(t,i,c){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,s.h({offset:t},i),c)}panTo(t,i,c){return this.easeTo(s.h({center:t},i),c)}getZoom(){return this.transform.zoom}setZoom(t,i){return this.jumpTo({zoom:t},i),this}zoomTo(t,i,c){return this.easeTo(s.h({zoom:t},i),c)}zoomIn(t,i){return this.zoomTo(this.getZoom()+1,t,i),this}zoomOut(t,i){return this.zoomTo(this.getZoom()-1,t,i),this}getBearing(){return this.transform.bearing}setBearing(t,i){return this.jumpTo({bearing:t},i),this}getPadding(){return this.transform.padding}setPadding(t,i){return this.jumpTo({padding:t},i),this}rotateTo(t,i,c){return this.easeTo(s.h({bearing:t},i),c)}resetNorth(t,i){return this.rotateTo(0,s.h({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(s.h({bearing:0,pitch:0,duration:1e3},t),i),this}snapToNorth(t,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,i):this}getPitch(){return this.transform.pitch}setPitch(t,i){return this.jumpTo({pitch:t},i),this}cameraForBounds(t,i){t=s.aG.convert(t);const c=i&&i.bearing||0,f=i&&i.pitch||0,m=t.getNorthWest(),y=t.getSouthEast();return this._cameraForBounds(this.transform,m,y,c,f,i)}_extendPadding(t){const i={top:0,right:0,bottom:0,left:0};return t==null?s.h({},i,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:s.h({},i,t)}_extendCameraOptions(t){return(t=s.h({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,i){const c=i.max[0]-i.min[0],f=i.max[1]-i.min[1];return c/f>t.aspect?c/(2*Math.tan(.5*t.fovX)*t.aspect):f/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,i,c,f,m,y){const w=t.clone(),S=this._extendCameraOptions(y);w.bearing=f,w.pitch=m;const M=s.cd.convert(i),P=s.cd.convert(c),O=.5*(M.lat+P.lat),D=.5*(M.lng+P.lng),F=s.eC(O,D),q=s.au([],F),V=s.au([],s.bF([],q,[0,1,0])),W=s.bF([],V,q),X=[V[0],V[1],V[2],0,W[0],W[1],W[2],0,q[0],q[1],q[2],0,0,0,0,1],J=[F,s.eC(M.lat,M.lng),s.eC(P.lat,M.lng),s.eC(P.lat,P.lng),s.eC(M.lat,P.lng),s.eC(O,M.lng),s.eC(O,P.lng),s.eC(M.lat,D),s.eC(P.lat,D)];let se=s.cW.fromPoints(J.map(Ve=>[s.bG(V,Ve),s.bG(W,Ve),s.bG(q,Ve)]));const le=s.ad([],se.center,X);s.eD(le)===0&&s.eE(le,0,0,1),s.au(le,le),s.bY(le,le,s.aB),w.center=s.eF(le);const ge=w.getWorldToCameraMatrix(),_e=s.bi(new Float64Array(16),ge);se=s.cW.applyTransform(se,s.az([],ge,X));const pe=this._extendAABB(se,w,S,f);if(!pe)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");se=pe,s.ad(le,le,ge);const ue=.5*(se.max[2]-se.min[2]),ye=this._minimumAABBFrustumDistance(w,se),xe=s.bY([],[0,0,1],ue),Pe=s.cV(xe,le,xe),Le=ye+(w.pitch===0?0:s.bD(le,Pe)),Ye=w.globeCenterInViewSpace,Xe=s.at([],le,[Ye[0],Ye[1],Ye[2]]);s.au(Xe,Xe),s.bY(Xe,Xe,Le);const ot=s.cV([],le,Xe);s.ad(ot,ot,_e);const ze=s.eq/s.aB,$e=s.ae(ot),Ie=s.c6(Math.max($e*ze-s.eq,Number.EPSILON),0),Je=Math.min(w.zoomFromMercatorZAdjusted(Ie),S.maxZoom);return Je>.5*(s.cL+s.cx)?(w.setProjection({name:"mercator"}),w.zoom=Je,this._cameraForBounds(w,i,c,f,m,y)):{center:w.center,zoom:Je,bearing:f,pitch:m}}_extendAABB(t,i,c,f){const m=.5*((c.padding.left||0)+(c.padding.right||0)),y=.5*((c.padding.top||0)+(c.padding.bottom||0)),w=y,S=m,M=m,P=y,O=i.width-(S+M),D=i.height-(w+P),F=s.at([],t.max,t.min),q=Math.min(O/F[0],D/F[1]),V=Math.min(i.scaleZoom(i.scale*q),c.maxZoom);if(isNaN(V))return null;const W=i.scale/i.zoomScale(V),X=new s.cW([t.min[0]-S*W,t.min[1]-P*W,t.min[2]],[t.max[0]+M*W,t.max[1]+w*W,t.max[2]]),J=(typeof c.offset.x=="number"&&typeof c.offset.y=="number"?new s.P(c.offset.x,c.offset.y):s.P.convert(c.offset)).rotate(-s.al(f));return X.center[0]-=J.x*W,X.center[1]+=J.y*W,X}queryTerrainElevation(t,i){const c=this.transform.elevation;return c?(i=s.h({},{exaggerated:!0},i),c.getAtPoint(s.ac.fromLngLat(t),null,i.exaggerated)):null}_cameraForBounds(t,i,c,f,m,y){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,i,c,f,m,y);const w=t.clone(),S=this._extendCameraOptions(y);w.bearing=f,w.pitch=m;const M=s.cd.convert(i),P=s.cd.convert(c),O=new s.cd(M.lng,P.lat),D=new s.cd(P.lng,M.lat),F=w.project(M),q=w.project(P),V=this.queryTerrainElevation(M),W=this.queryTerrainElevation(P),X=this.queryTerrainElevation(O),J=this.queryTerrainElevation(D),se=[[F.x,F.y,Math.min(V||0,W||0,X||0,J||0)],[q.x,q.y,Math.max(V||0,W||0,X||0,J||0)]];let le=s.cW.fromPoints(se);const ge=w.getWorldToCameraMatrix(),_e=s.bi(new Float64Array(16),ge);le=s.cW.applyTransform(le,ge);const pe=this._extendAABB(le,w,S,f);if(!pe)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");le=pe;const ue=.5*s.at([],le.max,le.min)[2],ye=this._minimumAABBFrustumDistance(w,le),xe=[0,0,1,0];s.aA(xe,xe,ge),s.eG(xe,xe);const Pe=s.bY([],xe,ye+ue),Le=s.cV([],le.center,Pe);s.ad(le.center,le.center,_e),s.ad(Le,Le,_e);const Ye=w.unproject(new s.P(le.center[0],le.center[1])),Xe=s.eH(w.projection,Ye),ot=Math.pow(2,Xe),ze=Math.min(w._zoomFromMercatorZ(Le[2]*w.pixelsPerMeter*ot/w.worldSize),S.maxZoom);return w.mercatorFromTransition&&ze<.5*(s.cL+s.cx)?(w.setProjection({name:"globe"}),w.zoom=ze,this._cameraForBounds(w,i,c,f,m,y)):{center:Ye,zoom:ze,bearing:f,pitch:m}}fitBounds(t,i,c){const f=this.cameraForBounds(t,i);return this._fitInternal(f,i,c)}fitScreenCoordinates(t,i,c,f,m){const y=s.P.convert(t),w=s.P.convert(i),S=new s.P(Math.min(y.x,w.x),Math.min(y.y,w.y)),M=new s.P(Math.max(y.x,w.x),Math.max(y.y,w.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(y,w))return this;const P=this.transform.pointLocation3D(S),O=this.transform.pointLocation3D(M),D=this.transform.pointLocation3D(new s.P(S.x,M.y)),F=this.transform.pointLocation3D(new s.P(M.x,S.y)),q=[Math.min(P.lng,O.lng,D.lng,F.lng),Math.min(P.lat,O.lat,D.lat,F.lat)],V=[Math.max(P.lng,O.lng,D.lng,F.lng),Math.max(P.lat,O.lat,D.lat,F.lat)],W=f&&f.pitch?f.pitch:this.getPitch(),X=this._cameraForBounds(this.transform,q,V,c,W,f);return this._fitInternal(X,f,m)}_fitInternal(t,i,c){return t?(i=s.h(t,i)).linear?this.easeTo(i,c):this.flyTo(i,c):this}jumpTo(t,i){this.stop();const c=t.preloadOnly?this.transform.clone():this.transform;let f=!1,m=!1,y=!1;"zoom"in t&&c.zoom!==+t.zoom&&(f=!0,c.zoom=+t.zoom),t.center!==void 0&&(c.center=s.cd.convert(t.center)),"bearing"in t&&c.bearing!==+t.bearing&&(m=!0,c.bearing=+t.bearing),"pitch"in t&&c.pitch!==+t.pitch&&(y=!0,c.pitch=+t.pitch);const w=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!c.isPaddingEqual(w))if(t.retainPadding===!1){const S=c.clone();S.padding=w,c.setLocationAtPoint(c.center,S.centerPoint)}else c.padding=w;return t.preloadOnly?(this._preloadTiles(c),this):(this.fire(new s.A("movestart",i)).fire(new s.A("move",i)),f&&this.fire(new s.A("zoomstart",i)).fire(new s.A("zoom",i)).fire(new s.A("zoomend",i)),m&&this.fire(new s.A("rotatestart",i)).fire(new s.A("rotate",i)).fire(new s.A("rotateend",i)),y&&this.fire(new s.A("pitchstart",i)).fire(new s.A("pitch",i)).fire(new s.A("pitchend",i)),this.fire(new s.A("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(Uf),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,i){const c=this.transform;if(!c.projection.supportsFreeCamera)return s.w(Uf),this;this.stop();const f=c.zoom,m=c.pitch,y=c.bearing;c.setFreeCameraOptions(t);const w=f!==c.zoom,S=m!==c.pitch,M=y!==c.bearing;return this.fire(new s.A("movestart",i)).fire(new s.A("move",i)),w&&this.fire(new s.A("zoomstart",i)).fire(new s.A("zoom",i)).fire(new s.A("zoomend",i)),M&&this.fire(new s.A("rotatestart",i)).fire(new s.A("rotate",i)).fire(new s.A("rotateend",i)),S&&this.fire(new s.A("pitchstart",i)).fire(new s.A("pitch",i)).fire(new s.A("pitchend",i)),this.fire(new s.A("moveend",i)),this}easeTo(t,i){this._stop(!1,t.easeId),((t=s.h({offset:[0,0],duration:500,easing:s.ey},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const c=this.transform,f=this.getZoom(),m=this.getBearing(),y=this.getPitch(),w=this.getPadding(),S="zoom"in t?+t.zoom:f,M="bearing"in t?this._normalizeBearing(t.bearing,m):m,P="pitch"in t?+t.pitch:y,O=this._extendPadding(t.padding),D=s.P.convert(t.offset);let F,q,V;if(c.projection.name==="globe"){const xe=s.ac.fromLngLat(c.center),Pe=D.rotate(-c.angle);xe.x+=Pe.x/c.worldSize,xe.y+=Pe.y/c.worldSize;const Le=xe.toLngLat(),Ye=s.cd.convert(t.center||Le);this._normalizeCenter(Ye),F=c.centerPoint.add(Pe),q=new s.P(xe.x,xe.y).mult(c.worldSize),V=new s.P(s.aD(Ye.lng),s.aH(Ye.lat)).mult(c.worldSize).sub(q)}else{F=c.centerPoint.add(D);const xe=c.pointLocation(F),Pe=s.cd.convert(t.center||xe);this._normalizeCenter(Pe),q=c.project(xe),V=c.project(Pe).sub(q)}const W=c.zoomScale(S-f);let X,J;t.around&&(X=s.cd.convert(t.around),J=c.locationPoint(X));const se=this._zooming||S!==f,le=this._rotating||m!==M,ge=this._pitching||P!==y,_e=!c.isPaddingEqual(O),pe=t.retainPadding===!1?c.clone():c,ue=xe=>Pe=>{if(se&&(xe.zoom=s.ai(f,S,Pe)),le&&(xe.bearing=s.ai(m,M,Pe)),ge&&(xe.pitch=s.ai(y,P,Pe)),_e&&(pe.interpolatePadding(w,O,Pe),F=pe.centerPoint.add(D)),X)xe.setLocationAtPoint(X,J);else{const Le=xe.zoomScale(xe.zoom-f),Ye=S>f?Math.min(2,W):Math.max(.5,W),Xe=Math.pow(Ye,1-Pe),ot=xe.unproject(q.add(V.mult(Pe*Xe)).mult(Le));xe.setLocationAtPoint(xe.renderWorldCopies?ot.wrap():ot,F)}return t.preloadOnly||this._fireMoveEvents(i),xe};if(t.preloadOnly){const xe=this._emulate(ue,t.duration,c);return this._preloadTiles(xe),this}const ye={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=se,this._rotating=le,this._pitching=ge,this._padding=_e,this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,ye),this._ease(ue(c),xe=>{c.cameraElevationReference==="sea"&&c.recenterOnTerrain(),this._afterEase(i,xe)},t),this}_prepareEase(t,i,c={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),i||c.moving||this.fire(new s.A("movestart",t)),this._zooming&&!c.zooming&&this.fire(new s.A("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new s.A("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new s.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new s.A("move",t)),this._zooming&&this.fire(new s.A("zoom",t)),this._rotating&&this.fire(new s.A("rotate",t)),this._pitching&&this.fire(new s.A("pitch",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const c=this._zooming,f=this._rotating,m=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new s.A("zoomend",t)),f&&this.fire(new s.A("rotateend",t)),m&&this.fire(new s.A("pitchend",t)),this.fire(new s.A("moveend",t))}flyTo(t,i){if(this._prefersReducedMotion(t)){const Ve=s.aF(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ve,i)}this.stop(),t=s.h({offset:[0,0],speed:1.2,curve:1.42,easing:s.ey},t);const c=this.transform,f=this.getZoom(),m=this.getBearing(),y=this.getPitch(),w=this.getPadding(),S="zoom"in t?s.ay(+t.zoom,c.minZoom,c.maxZoom):f,M="bearing"in t?this._normalizeBearing(t.bearing,m):m,P="pitch"in t?+t.pitch:y,O=this._extendPadding(t.padding),D=c.zoomScale(S-f),F=s.P.convert(t.offset);let q=c.centerPoint.add(F);const V=c.pointLocation(q),W=s.cd.convert(t.center||V);this._normalizeCenter(W);const X=c.project(V),J=c.project(W).sub(X);let se=t.curve;const le=Math.max(c.width,c.height),ge=le/D,_e=J.mag();if("minZoom"in t){const Ve=s.ay(Math.min(t.minZoom,f,S),c.minZoom,c.maxZoom),st=le/c.zoomScale(Ve-f);se=Math.sqrt(st/_e*2)}const pe=se*se;function ue(Ve){const st=(ge*ge-le*le+(Ve?-1:1)*pe*pe*_e*_e)/(2*(Ve?ge:le)*pe*_e);return Math.log(Math.sqrt(st*st+1)-st)}function ye(Ve){return(Math.exp(Ve)-Math.exp(-Ve))/2}function xe(Ve){return(Math.exp(Ve)+Math.exp(-Ve))/2}const Pe=ue(0);let Le=function(Ve){return xe(Pe)/xe(Pe+se*Ve)},Ye=function(Ve){return le*((xe(Pe)*(ye(st=Pe+se*Ve)/xe(st))-ye(Pe))/pe)/_e;var st},Xe=(ue(1)-Pe)/se;if(Math.abs(_e)<1e-6||!isFinite(Xe)){if(Math.abs(le-ge)<1e-6)return this.easeTo(t,i);const Ve=ge<le?-1:1;Xe=Math.abs(Math.log(ge/le))/se,Ye=function(){return 0},Le=function(st){return Math.exp(Ve*se*st)}}t.duration="duration"in t?+t.duration:1e3*Xe/("screenSpeed"in t?+t.screenSpeed/se:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const ot=m!==M,ze=P!==y,$e=!c.isPaddingEqual(O),Ie=t.retainPadding===!1?c.clone():c,Je=Ve=>st=>{const vt=st*Xe,Qe=1/Le(vt);Ve.zoom=st===1?S:f+Ve.scaleZoom(Qe),ot&&(Ve.bearing=s.ai(m,M,st)),ze&&(Ve.pitch=s.ai(y,P,st)),$e&&(Ie.interpolatePadding(w,O,st),q=Ie.centerPoint.add(F));const pt=st===1?W:Ve.unproject(X.add(J.mult(Ye(vt))).mult(Qe));return Ve.setLocationAtPoint(Ve.renderWorldCopies?pt.wrap():pt,q),Ve._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(i),Ve};if(t.preloadOnly){const Ve=this._emulate(Je,t.duration,c);return this._preloadTiles(Ve),this}return this._zooming=!0,this._rotating=ot,this._pitching=ze,this._padding=$e,this._prepareEase(i,!1),this._ease(Je(c),()=>this._afterEase(i),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,i){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const c=this._onEaseEnd;this._onEaseEnd=void 0,c.call(this,i)}if(!t){const c=this.handlers;c&&c.stop(!1)}return this}_ease(t,i,c){c.animate===!1||c.duration===0?(t(1),i()):(this._easeStart=s.q.now(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((s.q.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,i){t=s.bX(t,-180,180);const c=Math.abs(t-i);return Math.abs(t-360-i)<c&&(t-=360),Math.abs(t+360-i)<c&&(t+=360),t}_normalizeCenter(t){const i=this.transform;if(i.maxBounds||i.projection.name!=="globe"&&!i.renderWorldCopies)return;const c=t.lng-i.center.lng;t.lng+=c>180?-360:c<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&s.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,i,c){const f=Math.ceil(15*i/1e3),m=[],y=t(c.clone());for(let w=0;w<=f;w++){const S=y(w/f);m.push(S.clone())}return m}_preloadTiles(t,i){}}class ou{constructor(t={}){this.options=t,s.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const i=this.options&&this.options.compact,c=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Be("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Be("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",c);const f=Be("span","mapboxgl-ctrl-icon",this._compactButton);return f.setAttribute("aria-hidden","true"),f.setAttribute("title",c),this._innerContainer=Be("div","mapboxgl-ctrl-attrib-inner",this._container),i&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),i===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(t){const c=i.reduce((f,m,y)=>(m.value&&(f+=`${m.key}=${m.value}${y<i.length-1?"&":""}`),f),"?");t.href=`${s.e.FEEDBACK_URL}/${c}#${Bd(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const i=this._map.style._mergedSourceCaches;for(const f in i){const m=i[f];if(m.used){const y=m.getSource();y.attribution&&t.indexOf(y.attribution)<0&&t.push(y.attribution)}}t.sort((f,m)=>f.length-m.length),t=t.filter((f,m)=>{for(let y=m+1;y<t.length;y++)if(t[y].indexOf(f)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ms{constructor(){s.aV(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Be("div","mapboxgl-ctrl");const i=Be("a","mapboxgl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://www.mapbox.com/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const i in t){const c=t[i].getSource();if(c.hasOwnProperty("mapbox_logo")&&!c.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const i=t[0];this._map.getCanvasContainer().offsetWidth<250?i.classList.add("mapboxgl-compact"):i.classList.remove("mapboxgl-compact")}}}class Qh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const i=++this._id;return this._queue.push({callback:t,id:i,cancelled:!1}),i}remove(t){const i=this._currentlyRunning,c=i?this._queue.concat(i):this._queue;for(const f of c)if(f.id===t)return void(f.cancelled=!0)}run(t=0){const i=this._currentlyRunning=this._queue;this._queue=[];for(const c of i)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class zl{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const i=s.dk((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,i,c){this._start=this.getValue(i),this._end=t,this._startTime=i,this._endTime=i+c}}const au={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class On extends s.A{constructor(t,i,c,f){const{point:m,lngLat:y,originalEvent:w,target:S}=t;super(t.type,{point:m,lngLat:y,originalEvent:w,target:S}),this.preventDefault=()=>{t.preventDefault()},this.id=i,this.interaction=c,this.feature=f}}class il{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,i){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const c=i.filter;let f=i.type;c&&this.filters.set(t,s.b3(c)),f==="mouseover"&&(f="mouseenter"),f==="mouseout"&&(f="mouseleave");const m=this.interactionsByType.get(f)||new Map;f==="mouseenter"||f==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,i)):m.size===0&&this.map.on(f,this.handleType),m.size===0&&this.interactionsByType.set(f,m),m.set(t,i),this.typeById.set(t,f)}get(t){const i=this.typeById.get(t);if(!i)return;const c=this.interactionsByType.get(i);return c?c.get(t):void 0}remove(t){const i=this.typeById.get(t);if(!i)return;this.typeById.delete(t),this.filters.delete(t);const c=this.interactionsByType.get(i);c&&(c.delete(t),i==="mouseenter"||i==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):c.size===0&&this.map.off(i,this.handleType))}queryTargets(t,i){const c=[];for(const[f,m]of i)m.target&&c.push({targetId:f,target:m.target,filter:this.filters.get(f)});return this.map.style.queryRenderedTargets(t,c,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const i=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());i.length&&(t.type="mouseenter",this.handleType(t,i));const c=new Map;for(const[f,{feature:m}]of this.prevHoveredFeatures)this.hoveredFeatures.has(f)||c.set(m.id,m);c.size&&(t.type="mouseleave",this.handleType(t,Array.from(c.values())))}handleOut(t){const i=Array.from(this.hoveredFeatures.values()).map(({feature:c})=>c);i.length&&(t.type="mouseleave",this.handleType(t,i)),this.hoveredFeatures.clear()}handleType(t,i){const c=t.type==="mouseenter";if(c&&!this.interactionsByType.has(t.type))return void s.w("mouseenter interaction required for mouseleave to work.");const f=Array.from(this.interactionsByType.get(t.type)).reverse(),m=!!i;i=i||this.queryTargets(t.point,f);let y=!1;const w=new Set;for(const S of i){for(const[M,P]of f){if(!P.target)continue;const O=S.variants?S.variants[M]:null;if(O){for(const D of O){if(Hl(D,S,w,M))continue;const F=new s.de(S,D),q=ql(D,S,M);m&&(F.state=this.map.getFeatureState(F));const V=c?this.prevHoveredFeatures.get(q):null,W=new On(t,M,P,F),X=V?V.stop:P.handler(W);if(c&&this.hoveredFeatures.set(q,{feature:S,stop:X}),X!==!1){y=!0;break}}if(y)break}}if(y)break}if(!y)for(const[S,M]of f){const{handler:P,target:O}=M;if(!O&&P(new On(t,S,M,null))!==!1)break}}}function Er(l,t){if(Array.isArray(l)&&Array.isArray(t)){const i=new Set(l),c=new Set(t);return i.size===c.size&&l.every(f=>c.has(f))}return s.bv(l,t)}const kl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Xd={showCompass:!0,showZoom:!0,visualizePitch:!1};class kp{constructor(t,i,c=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new Wh({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,c&&(this.mousePitch=new nu({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),s.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(t,i){this.mouseRotate.mousedown(t,i),this.mousePitch&&this.mousePitch.mousedown(t,i),jt()}move(t,i){const c=this.map,f=this.mouseRotate.mousemoveWindow(t,i),m=f&&f.bearingDelta;if(m&&c.setBearing(c.getBearing()+m),this.mousePitch){const y=this.mousePitch.mousemoveWindow(t,i),w=y&&y.pitchDelta;w&&c.setPitch(c.getPitch()+w)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){vr(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(s.h({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Wt(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Wt(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Cr(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Cr(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function nh(l,t,i){if(l=new s.cd(l.lng,l.lat),t){const c=new s.cd(l.lng-360,l.lat),f=new s.cd(l.lng+360,l.lat),m=360*Math.ceil(Math.abs(l.lng-i.center.lng)/360),y=i.locationPoint3D(l).distSqr(t),w=t.x<0||t.y<0||t.x>i.width||t.y>i.height;i.locationPoint3D(c).distSqr(t)<y&&(w||Math.abs(c.lng-i.center.lng)<m)?l=c:i.locationPoint3D(f).distSqr(t)<y&&(w||Math.abs(f.lng-i.center.lng)<m)&&(l=f)}for(;Math.abs(l.lng-i.center.lng)>180;){const c=i.locationPoint3D(l);if(c.x>=0&&c.y>=0&&c.x<=i.width&&c.y<=i.height)break;l.lng>i.center.lng?l.lng-=360:l.lng+=360}return l}const lu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},ta={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class cu extends s.E{constructor(t,i){super(),(t instanceof HTMLElement||i)&&(t=s.h({element:t},i)),s.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:c="center",color:f="#3FB1CE",scale:m=1,draggable:y=!1,clickTolerance:w=0,rotation:S=ta.rotation,rotationAlignment:M=ta.rotationAlignment,pitchAlignment:P=ta.pitchAlignment,occludedOpacity:O=ta.occludedOpacity,altitude:D=ta.altitude}=t||{};this._anchor=c,this._color=f,this._scale=m,this._draggable=y,this._clickTolerance=w,this._rotation=S,this._rotationAlignment=M,this._pitchAlignment=P,this._occludedOpacity=O,this._altitude=D,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",V=>{V.preventDefault()}),this._element.addEventListener("mousedown",V=>{V.preventDefault()});const F=this._element.classList;for(const V in lu)F.remove(`mapboxgl-marker-anchor-${V}`);F.add(`mapboxgl-marker-anchor-${this._anchor}`);const q=t&&t.className?t.className.trim().split(/\s+/):[];F.add(...q),this._popup=null}_createDefaultMarker(){const t=Be("div"),i=ct("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const c=ct("radialGradient",{id:"shadowGradient"},ct("defs",{},i));ct("stop",{offset:"10%","stop-opacity":.4},c),ct("stop",{offset:"100%","stop-opacity":.05},c),ct("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},i)}return ct("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},i),ct("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},i),ct("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},i),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.cd.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||ta.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const f=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const i=t.code,c=t.charCode||t.keyCode;i!=="Space"&&i!=="Enter"&&c!==32&&c!==13||this.togglePopup()}_onMapClick(t){const i=t.originalEvent.target,c=this._element;this._popup&&(i===c||c.contains(i))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,i=this._pos;if(!t||!i)return!1;const c=t.unproject(i,this._altitude),f=t.getFreeCameraOptions();if(!f.position)return!1;const m=f.position.toLngLat();return m.distanceTo(c)<.9*m.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const i=this._pos;if(!i||i.x<0||i.x>t.transform.width||i.y<0||i.y>t.transform.height)return void this._clearFadeTimer();const c=t.unproject(i,this._altitude);let f;t._showingGlobe()&&s.eK(t.transform,this._lngLat)?f=0:(f=1-t._queryFogOpacity(c),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(f*=this._occludedOpacity)),this._element.style.opacity=`${f}`,this._element.style.pointerEvents=f>0?"auto":"none",this._popup&&this._popup._setOpacity(f),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const i=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${lu[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${i.x}px,${i.y}px)
        `}_calculateXYTransform(){const t=this._pos,i=this._map,c=this.getPitchAlignment();if(!i||!t||c!=="map")return"";if(!i._showingGlobe()){const S=i.getPitch();return S?`rotateX(${S}deg)`:""}const f=s.cJ(s.eL(i.transform,this._lngLat)),m=t.sub(s.eM(i.transform)),y=Math.abs(m.x)+Math.abs(m.y);if(y===0)return"";const w=f/y;return`rotateX(${-m.y*w}deg) rotateY(${m.x*w}deg)`}_calculateZTransform(){const t=this._pos,i=this._map;if(!i||!t)return"";let c=0;const f=this.getRotationAlignment();if(f==="map")if(i._showingGlobe()){const m=i.project(new s.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),y=i.project(new s.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(m);c=s.cJ(Math.atan2(y.y,y.x))-90}else c=-i.getBearing();else if(f==="horizon"){const m=s.af(4,6,i.getZoom()),y=s.eM(i.transform);y.y+=m*i.transform.height;const w=t.sub(y),S=s.cJ(Math.atan2(w.y,w.x));c=(S>90?S-270:S+90)*(1-m)}return c+=this._rotation,c?`rotateZ(${c}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const i=this._map;i&&(i.transform.renderWorldCopies&&(this._lngLat=nh(this._lngLat,this._pos,i.transform)),this._pos=i.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),i._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(i._showingGlobe()||i.getTerrain()||i.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const i=this._map;if(!i)return;const c=this._pointerdownPos,f=this._positionDelta;if(c&&f){if(!this._isDragging){const m=this._clickTolerance||i._clickTolerance;if(t.point.dist(c)<m)return;this._isDragging=!0}this._pos=t.point.sub(f),this._lngLat=i.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.A("dragstart"))),this.fire(new s.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.A("dragend")),this._state="inactive"}_addDragHandler(t){const i=this._map,c=this._pos;i&&c&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(c),this._pointerdownPos=t.point,this._state="pending",i.on("mousemove",this._onMove),i.on("touchmove",this._onMove),i.once("mouseup",this._onUp),i.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const i=this._map;return i&&(t?(i.on("mousedown",this._addDragHandler),i.on("touchstart",this._addDragHandler)):(i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||ta.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||ta.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||ta.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||ta.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Yd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ih={maxWidth:100,unit:"metric"},uu={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ka={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},ra=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ai(l=new s.P(0,0),t="bottom"){if(typeof l=="number"){const i=Math.round(Math.sqrt(.5*Math.pow(l,2)));switch(t){case"top":return new s.P(0,l);case"top-left":return new s.P(i,i);case"top-right":return new s.P(-i,i);case"bottom":return new s.P(0,-l);case"bottom-left":return new s.P(i,-i);case"bottom-right":return new s.P(-i,-i);case"left":return new s.P(l,0);case"right":return new s.P(-l,0)}return new s.P(0,0)}return l instanceof s.P||Array.isArray(l)?s.P.convert(l):s.P.convert(l[t]||[0,0])}return{version:ce,supported:Xt.supported,setRTLTextPlugin:s.eQ,getRTLTextPluginStatus:s.eP,Map:class extends rh{constructor(l){Se.mark(be.create);const t=l;if((l=s.h({},kl,l)).minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(l.antialias&&s.eI(window)&&(l.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new fd(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies,null,null),l),this._repaint=!!l.repaint,this._interactive=l.interactive,this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=l.crossSourceCollisions,this._collectResourceTiming=l.collectResourceTiming,this._language=this._parseLanguage(l.language),this._worldview=l.worldview,this._renderTaskQueue=new Qh,this._domRenderTaskQueue=new Qh,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.a$(),this._locale=s.h({},au,l.locale),this._clickTolerance=l.clickTolerance,this._cooperativeGestures=l.cooperativeGestures,this._performanceMetricsCollection=l.performanceMetricsCollection,this._tessellationStep=l.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=l.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new zl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=l.scaleFactor,this._requestManager=new Mr(l.transformRequest,l.accessToken,l.testMode),this._silenceAuthErrors=!!l.testMode,this._contextCreateOptions=l.contextCreateOptions?Object.assign({},l.contextCreateOptions):{},typeof l.container=="string"){const i=document.getElementById(l.container);if(!i)throw new Error(`Container '${l.container.toString()}' not found.`);this._container=i}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),l.maxBounds&&this.setMaxBounds(l.maxBounds),this._spriteFormat=l.spriteFormat,s.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Ld),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Jh(this,l),this._localFontFamily=l.localFontFamily,this._localIdeographFontFamily=l.localIdeographFontFamily,(l.style||!l.testMode)&&this.setStyle(l.style||s.e.DEFAULT_STYLE,{config:l.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),l.projection&&this.setProjection(l.projection),this.indoor=new _m(this),l.hash&&(this._hash=new kf(typeof l.hash=="string"&&l.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch});const i=l.bounds;i&&(this.resize(),this.fitBounds(i,s.h({},l.fitBoundsOptions,{duration:0})))}this.resize(),l.attributionControl&&this.addControl(new ou({customAttribution:l.customAttribution})),this._logoControl=new Ms,this.addControl(this._logoControl,l.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new s.A(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new s.A(`${i.dataType}dataloading`,i))}),this._interactions=new il(this)}_getMapId(){return this._mapId}addControl(l,t){if(t===void 0&&(t=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new s.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=l.onAdd(this);this._controls.push(l);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(i,c.firstChild):c.appendChild(i),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new s.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(l);return t>-1&&this._controls.splice(t,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(l){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new s.A("movestart",l)).fire(new s.A("move",l)),this.fire(new s.A("resize",l)),t&&this.fire(new s.A("moveend",l)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(l){return this.transform.setMaxBounds(s.aG.convert(l)),this._update()}setMinZoom(l){if((l=l??-2)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l?this.setZoom(l):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l??22)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l?this.setZoom(l):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l?this.setPitch(l):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l?this.setPitch(l):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(l){return this._scaleFactor=l,this.painter.scaleFactor=l,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(l){return l==="auto"?navigator.language:Array.isArray(l)?l.length===0?void 0:l.map(t=>t==="auto"?navigator.language:t):l}setLanguage(l){const t=this._parseLanguage(l);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const i of this._controls)i._setLanguage&&i._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(l){return this.style&&l!==this._worldview?(this._worldview=l,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(l){return this._lazyInitEmptyStyle(),l?typeof l=="string"&&(l={name:l}):l=null,this._useExplicitProjection=!!l,this._prioritizeAndUpdateProjection(l,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const l=this.transform,t=l.projection.name;let i;t==="globe"&&l.zoom>=s.cx?(l.setMercatorFromTransition(),i=!0):t==="mercator"&&l.zoom<s.cx&&(l.setProjection({name:"globe"}),i=!0),i&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(l,t){return this._updateProjection(l||t||{name:"mercator"})}_updateProjection(l){let t;return t=l.name==="globe"&&this.transform.zoom>=s.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(l),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(l,t){return this.transform.locationPoint3D(s.cd.convert(l),t)}unproject(l,t){return this.transform.pointLocation3D(s.P.convert(l),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(l,t,i){const c=f=>{let m=[];if(Array.isArray(t)){const y=t.filter(w=>this.getLayer(w));m=y.length?this.queryRenderedFeatures(f,{layers:y}):[]}else m=this.queryRenderedFeatures(f,{target:t});return m};if(l==="mouseenter"||l==="mouseover"){let f=!1;return{listener:i,targets:t,delegates:{mousemove:y=>{const w=c(y.point);w.length?f||(f=!0,i.call(this,new os(l,this,y.originalEvent,{features:w}))):f=!1},mouseout:()=>{f=!1}}}}if(l==="mouseleave"||l==="mouseout"){let f=!1;return{listener:i,targets:t,delegates:{mousemove:w=>{c(w.point).length?f=!0:f&&(f=!1,i.call(this,new os(l,this,w.originalEvent)))},mouseout:w=>{f&&(f=!1,i.call(this,new os(l,this,w.originalEvent)))}}}}{const f=m=>{const y=c(m.point);y.length&&(m.features=y,i.call(this,m),delete m.features)};return{listener:i,targets:t,delegates:{[l]:f}}}}on(l,t,i){if(typeof t=="function"||i===void 0)return super.on(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._createDelegatedListener(l,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(c);for(const f in c.delegates)this.on(f,c.delegates[f]);return this}once(l,t,i){if(typeof t=="function"||i===void 0)return super.once(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._createDelegatedListener(l,t,i);for(const f in c.delegates)this.once(f,c.delegates[f]);return this}off(l,t,i){if(typeof t=="function"||i===void 0)return super.off(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._delegatedListeners?this._delegatedListeners[l]:void 0;return c&&(f=>{for(let m=0;m<f.length;m++){const y=f[m];if(y.listener===i&&Er(y.targets,t)){for(const w in y.delegates)this.off(w,y.delegates[w]);return f.splice(m,1),this}}})(c),this}queryRenderedFeatures(l,t){if(!this.style)return[];if(l===void 0||l instanceof s.P||Array.isArray(l)||t!==void 0||(t=l,l=void 0),l=l||[[0,0],[this.transform.width,this.transform.height]],!t){const m=this.style.queryRenderedFeatures(l,void 0,this.transform),y=this.style.queryRenderedFeatureset(l,void 0,this.transform);return m.concat(y)}let i=!0;if(t.target&&(i=this._isTargetValid(t.target),i&&!t.layers))return this.style.queryRenderedFeatureset(l,t,this.transform);let c=!0;if(t.layers&&Array.isArray(t.layers)){for(const m of t.layers)if(!this._isValidId(m)){c=!1;break}if(c&&!t.target)return this.style.queryRenderedFeatures(l,t,this.transform)}let f=[];return c&&(f=f.concat(this.style.queryRenderedFeatures(l,t,this.transform))),i&&(f=f.concat(this.style.queryRenderedFeatureset(l,t,this.transform))),f}querySourceFeatures(l,t){return!l||typeof l=="string"&&!this._isValidId(l)?[]:this.style.querySourceFeatures(l,t)}isPointOnSurface(l){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&s.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(l))}addInteraction(l,t){return this._interactions.add(l,t),this}removeInteraction(l){return this._interactions.remove(l),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(l){return this._cooperativeGestures=l,this}setStyle(l,t){return t=s.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&l&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(l,(i,c)=>{if(i){const f=typeof i=="string"?i:i instanceof Error?i.message:i.error;s.w(`Unable to perform style diff: ${f}. Rebuilding the style from scratch.`),this._updateStyle(l,t)}else c&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(l,t))}_getUIString(l){const t=this._locale[l];if(t==null)throw new Error(`Missing UI string '${l}'`);return t}_updateStyle(l,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),l){const i=s.h({},t);t&&t.config&&(i.initialConfig=t.config,delete i.config),this.style=new qs(this,i).load(l),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new qs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(l){return l==null?(this.fire(new s.z(new Error("IDs can't be empty."))),!1):!s.d8(l)||(this.fire(new s.z(new Error(`IDs can't contain special symbols: "${l}".`))),!1)}_isTargetValid(l){return"featuresetId"in l?this._isValidId("importId"in l?l.importId:l.featuresetId):"layerId"in l&&this._isValidId(l.layerId)}_areTargetsValid(l){if(Array.isArray(l)){for(const t of l)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(l)}addSource(l,t){return this._isValidId(l)?(this._lazyInitEmptyStyle(),this.style.addSource(l,t),this._update(!0)):this}isSourceLoaded(l){return!!this._isValidId(l)&&!!this.style&&this.style._isSourceCacheLoaded(l)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(l,t,i){this._lazyInitEmptyStyle(),this.style.addSourceType(l,t,i)}removeSource(l){return this._isValidId(l)?(this.style.removeSource(l),this._updateTerrain(),this._update(!0)):this}getSource(l){return this._isValidId(l)?this.style.getOwnSource(l):null}addImage(l,t,{pixelRatio:i=1,sdf:c=!1,stretchX:f,stretchY:m,content:y}={}){this._lazyInitEmptyStyle();const w=s.I.from(l);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:S,height:M,data:P}=s.q.getImageData(t);this.style.addImage(w,{data:new s.r({width:S,height:M},P),pixelRatio:i,stretchX:f,stretchY:m,content:y,sdf:c,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new s.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:M}=t,P=t;this.style.addImage(w,{data:new s.r({width:S,height:M},new Uint8Array(P.data)),pixelRatio:i,stretchX:f,stretchY:m,content:y,sdf:c,usvg:!1,version:0,userImage:P}),P.onAdd&&P.onAdd(this,l)}}updateImage(l,t){this._lazyInitEmptyStyle();const i=s.I.from(l),c=this.style.getImage(i);if(!c)return void this.fire(new s.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?s.q.getImageData(t):t,{width:m,height:y,data:w}=f;if(m===void 0||y===void 0)return void this.fire(new s.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==(c.usvg?c.icon.usvg_tree.width:c.data.width)||y!==(c.usvg?c.icon.usvg_tree.height:c.data.height))return void this.fire(new s.z(new Error(`The width and height of the updated image (${m}, ${y})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`)));const S=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let M=!1;c.usvg?(c.data=new s.r({width:m,height:y},new Uint8Array(w)),c.usvg=!1,c.icon=void 0,M=!0):c.data.replace(w,S),this.style.updateImage(i,c,M)}hasImage(l){return l?!!this.style&&!!this.style.getImage(s.I.from(l)):(this.fire(new s.z(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(s.I.from(l))}loadImage(l,t){s.o(this._requestManager.transformRequest(l,s.R.Image),(i,c)=>{t(i,c instanceof HTMLImageElement?s.q.getImageData(c):c)})}listImages(){return this.style.listImages().map(l=>l.name)}addModel(l,t){this._lazyInitEmptyStyle(),this.style.addModel(l,t)}hasModel(l){return l?this.style.hasModel(l):(this.fire(new s.z(new Error("Missing required model id"))),!1)}removeModel(l){this.style.removeModel(l)}listModels(){return this.style.listModels()}addLayer(l,t){return this._isValidId(l.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(l,t),this._update(!0)):this}getSlot(l){const t=this.getLayer(l);return t&&t.slot||null}setSlot(l,t){return this.style.setSlot(l,t),this.style.mergeLayers(),this._update(!0)}addImport(l,t){return this.style.addImport(l,t).catch(i=>this.fire(new s.z(new Error("Failed to add import",i)))),this}updateImport(l,t){return typeof t!="string"&&t.id!==l?(this.removeImport(l),this.addImport(t)):(this.style.updateImport(l,t),this._update(!0))}removeImport(l){return this.style.removeImport(l),this}moveImport(l,t){return this.style.moveImport(l,t),this._update(!0)}moveLayer(l,t){return this._isValidId(l)?(this.style.moveLayer(l,t),this._update(!0)):this}removeLayer(l){return this._isValidId(l)?(this.style.removeLayer(l),this._update(!0)):this}getLayer(l){if(!this._isValidId(l))return null;const t=this.style.getOwnLayer(l);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(l,t,i){return this._isValidId(l)?(this.style.setLayerZoomRange(l,t,i),this._update(!0)):this}setFilter(l,t,i={}){return this._isValidId(l)?(this.style.setFilter(l,t,i),this._update(!0)):this}getFilter(l){return this._isValidId(l)?this.style.getFilter(l):null}setPaintProperty(l,t,i,c={}){return this._isValidId(l)?(this.style.setPaintProperty(l,t,i,c),this._update(!0)):this}getPaintProperty(l,t){return this._isValidId(l)?this.style.getPaintProperty(l,t):null}setLayoutProperty(l,t,i,c={}){return this._isValidId(l)?(this.style.setLayoutProperty(l,t,i,c),this._update(!0)):this}getLayoutProperty(l,t){return this._isValidId(l)?this.style.getLayoutProperty(l,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(l){return this.style.setGlyphsUrl(l),this._update(!0)}getSchema(l){return this.style.getSchema(l)}setSchema(l,t){return this.style.setSchema(l,t),this._update(!0)}getConfig(l){return this.style.getConfig(l)}setConfig(l,t){return this.style.setConfig(l,t),this._update(!0)}getConfigProperty(l,t){return this.style.getConfigProperty(l,t)}setConfigProperty(l,t,i){return this.style.setConfigProperty(l,t,i),this._update(!0)}getFeaturesetDescriptors(l){return this.style.getFeaturesetDescriptors(l)}setLights(l){if(this._lazyInitEmptyStyle(),l&&l.length===1&&l[0].type==="flat"){const t=l[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(l),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const l=this.style.getLights()||[];return l.length===0&&l.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),l}setLight(l,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:l}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(l){return this._lazyInitEmptyStyle(),!l&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(l),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(l){return this._lazyInitEmptyStyle(),this.style.setFog(l),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(l){return this._lazyInitEmptyStyle(),this.style.setSnow(l),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(l){return this._lazyInitEmptyStyle(),this.style.setRain(l),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(l){return this._lazyInitEmptyStyle(),this.style.setColorTheme(l),this._update(!0)}setImportColorTheme(l,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(l,t),this._update(!0)}setCamera(l){return this.style.setCamera(l),this._triggerCameraUpdate(l)}_triggerCameraUpdate(l){return this._update(this.transform.setOrthographicProjectionAtLowPitch(l["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(l){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.cd.convert(l),this.transform):0}setFeatureState(l,t){return l.source&&!this._isValidId(l.source)?this:(this.style.setFeatureState(l,t),this._update())}removeFeatureState(l,t){return l.source&&!this._isValidId(l.source)?this:(this.style.removeFeatureState(l,t),this._update())}getFeatureState(l){return l.source&&!this._isValidId(l.source)?null:this.style.getFeatureState(l)}_updateContainerDimensions(){if(!this._container)return;const l=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let i,c,f,m=this._container;for(;m&&(!c||!f);){const y=window.getComputedStyle(m).transform;y&&y!=="none"&&(i=y.match(/matrix.*\((.+)\)/)[1].split(", "),i[0]&&i[0]!=="0"&&i[0]!=="1"&&(c=i[0]),i[3]&&i[3]!=="0"&&i[3]!=="1"&&(f=i[3])),m=m.parentElement}this._containerWidth=c?Math.abs(l/c):l,this._containerHeight=f?Math.abs(t/f):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const l=this._container;l.classList.add("mapboxgl-map"),(this._missingCSSCanary=Be("div","mapboxgl-canary",l)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Be("div","mapboxgl-canvas-container",l);this._canvas=Be("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=Be("div","mapboxgl-control-container",l),c=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(f=>{c[f]=Be("div",`mapboxgl-ctrl-${f}`,i)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(l,t){const i=s.q.devicePixelRatio||1;this._canvas.width=i*Math.ceil(l),this._canvas.height=i*Math.ceil(t),this._canvas.style.width=`${l}px`,this._canvas.style.height=`${t}px`}_addMarker(l){this._markers.push(l)}_removeMarker(l){const t=this._markers.indexOf(l);t!==-1&&this._markers.splice(t,1)}_addPopup(l){this._popups.push(l)}_removePopup(l){const t=this._popups.indexOf(l);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const l=s.h({},Xt.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",l);t?(us(t,!0),this.painter=new Ku(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",i=>{i.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.l.testSupport(t)):this.fire(new s.z(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.A("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.A("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_requestDomTask(l){!this.loaded()||this.loaded()&&!this.isMoving()?l():this._domRenderTaskQueue.add(l)}_render(l){let t;this.fire(new s.A("renderstart")),++this._frameId;const i=this.painter.context.extTimerQuery,c=s.q.now(),f=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=f.createQuery(),f.beginQuery(i.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(l),this._domRenderTaskQueue.run(l),this._removed)return;this._updateProjectionTransition();const m=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,P=this.transform.pitch,O=s.q.now(),D=new s.aa(M,{now:O,fadeDuration:m,pitch:P,transition:this.style.transition,worldview:this._worldview});this.style.update(D)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let y=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),y=this._updateAverageElevation(c),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):y=this._updateAverageElevation(c);const w=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,m,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),w&&(this._placementDirty=w.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:m,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,Se.mark(be.load),this.fire(new s.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const M=s.q.now()-c;f.endQuery(i.TIME_ELAPSED_EXT),setTimeout(()=>{const P=f.getQueryParameter(t,f.QUERY_RESULT)/1e6;f.deleteQuery(t),this.fire(new s.A("gpu-timing-frame",{cpuTime:M,gpuTime:P}))},50)}if(this.listens("gpu-timing-layer")){const M=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(M);this.fire(new s.A("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){const M=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const P=this.painter.queryGpuTimeDeferredRender(M);this.fire(new s.A("gpu-timing-deferred-render",{gpuTime:P}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||y;if(S||this._repaint)this.triggerRepaint();else{const M=this.idle();if(M&&(y=this._updateAverageElevation(c,!0)),y)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new s.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new s.A("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,Se.mark(be.fullLoad),this._performanceMetricsCollection&&vn(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(l){for(const t of this._markers)l&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!l||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(l,t=!1){const i=f=>(this.transform.averageElevation=f,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&i(0);const c=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(c||(t||l-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(l)){const f=this.transform.averageElevation;let m=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(m)?m=0:this._averageElevationLastSampledAt=l;const y=Math.abs(f-m);if(y>1){if(this._isInitialLoad||c)return this._averageElevation.jumpTo(m),i(m);this._averageElevation.easeTo(m,l,300)}else if(y>1e-4)return this._averageElevation.jumpTo(m),i(m)}return!!this._averageElevation.isEasing(l)&&i(this._averageElevation.getValue(l))}_authenticate(){Pi(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,l=>{if(l&&(l.message===gr||l.status===401)){const t=this.painter.context.gl;us(t,!1),this._logoControl instanceof Ms&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Hr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Br(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const l=this._isDragging();this.painter.updateTerrain(this.style,l)}_calculateSpeedIndex(){const l=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const i=this.painter.context.gl,c=i.createFramebuffer();function f(m){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,m,0);const y=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,y),y}return i.bindFramebuffer(i.FRAMEBUFFER,c),this._canvasPixelComparison(f(l),t.canvasCopies.map(f),t.timeStamps)}_canvasPixelComparison(l,t,i){let c=i[1]-i[0];const f=l.length/4;for(let m=0;m<t.length;m++){const y=t[m];let w=0;for(let S=0;S<y.length;S+=4)y[S]===l[S]&&y[S+1]===l[S+1]&&y[S+2]===l[S+2]&&y[S+3]===l[S+3]&&(w+=1);c+=(i[m+2]-i[m+1])*(1-w/f)}return c}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),qi.delete(this.painter.context.gl),Ar.remove(),Pr.remove(),this._removed=!0,this.fire(new s.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(l){this._renderNextFrame=this._renderNextFrame||l,this.style&&!this._frame&&(this._frame=s.q.frame(t=>{const i=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,i&&this._render(t)}))}_preloadTiles(l){const t=this.style?this.style.getSourceCaches():[];return s.bt(t,(i,c)=>i._preloadTiles(l,c),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(l){this._showParseStatus!==l&&(this._showParseStatus=l,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(l){this._showTerrainWireframe!==l&&(this._showTerrainWireframe=l,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(l){this._showLayers2DWireframe!==l&&(this._showLayers2DWireframe=l,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(l){this._showLayers3DWireframe!==l&&(this._showLayers3DWireframe=l,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(l){this._speedIndexTiming!==l&&(this._speedIndexTiming=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,this._tp.refreshUI(),l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(l){this._showTileAABBs!==l&&(this._showTileAABBs=l,this._tp.refreshUI(),l&&this._update())}_setCacheLimits(l,t){s.eJ(l,t)}get version(){return ce}},NavigationControl:class{constructor(l={}){this.options=s.h({},Xd,l),this._container=Be("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(s.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Be("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Be("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const i=this._map;i&&(this.options.visualizePitch?i.resetNorthPitch({},{originalEvent:t}):i.resetNorth({},{originalEvent:t}))}),this._compassIcon=Be("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const l=this._map;if(!l)return;const t=l.getZoom(),i=t===l.getMaxZoom(),c=t===l.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const l=this._map;if(!l)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(l.transform.pitch*(Math.PI/180)),.5)}) rotateX(${l.transform.pitch}deg) rotateZ(${l.transform.angle*(180/Math.PI)}deg)`:`rotate(${l.transform.angle*(180/Math.PI)}deg)`;l._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),l.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&l.on("pitch",this._rotateCompassArrow),l.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new kp(l,this._compass,this.options.visualizePitch)),this._container}onRemove(){const l=this._map;l&&(this._container.remove(),this.options.showZoom&&l.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&l.off("pitch",this._rotateCompassArrow),l.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(l,t){const i=Be("button",l,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(l,t){if(!this._map)return;const i=this._map._getUIString(`NavigationControl.${t}`);l.setAttribute("aria-label",i),l.firstElementChild&&l.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends s.E{constructor(l={}){super();const t=navigator.geolocation;this.options=s.h({geolocation:t},Yd,l),s.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Cl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(l){return this._map=l,this._container=Be("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(l){const t=(i=!!this.options.geolocation)=>{this._supportsGeolocation=i,l(i)};this._supportsGeolocation!==void 0?l(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(i=>t(i.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(l){const t=this._map.getMaxBounds(),i=l.coords;return!!t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new s.A("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("geolocate",l)),this._finish()}}_updateCamera(l){const t=new s.cd(l.coords.longitude,l.coords.latitude),i=l.coords.accuracy,c=this._map.getBearing(),f=s.h({bearing:c},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(i),f,{geolocateSource:!0})}_updateMarker(l){if(l){const t=new s.cd(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map.transform,t=s.c6(1,l._center.lat)*l.worldSize,i=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${i}px`,this._circleElement.style.height=`${i}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Be("button","mapboxgl-ctrl-geolocate",this._container),Be("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Be("div","mapboxgl-user-location"),this._dotElement.appendChild(Be("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Be("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new cu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Be("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new cu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.A("trackuserlocationend")))})}}_onDeviceOrientation(l){this._userLocationDotMarker&&(l.webkitCompassHeading?this._heading=l.webkitCompassHeading:l.absolute===!0&&(this._heading=-1*l.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(l={maximumAge:6e5,timeout:0},this._noTimeout=!0):(l=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,l),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const l=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&l()}).catch(console.error):l()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ou,ScaleControl:class{constructor(l={}){this.options=s.h({},ih,l),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const l=this.options.maxWidth||100,t=this._map,i=t._containerHeight/2,c=t._containerWidth/2-l/2,f=t.unproject([c,i]),m=t.unproject([c+l,i]),y=f.distanceTo(m);if(this.options.unit==="imperial"){const w=3.2808*y;w>5280?this._setScale(l,w/5280,"mile"):this._setScale(l,w,"foot")}else this.options.unit==="nautical"?this._setScale(l,y/1852,"nautical-mile"):y>=1e3?this._setScale(l,y/1e3,"kilometer"):this._setScale(l,y,"meter")}_setScale(l,t,i){this._map._requestDomTask(()=>{const c=function(m){const y=Math.pow(10,`${Math.floor(m)}`.length-1);let w=m/y;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(S){const M=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*M)/M}(w),y*w}(t),f=c/t;this._container.innerHTML=this._isNumberFormatSupported&&i!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(c):`${c}&nbsp;${uu[i]}`,this._container.style.width=l*f+"px"})}onAdd(l){return this._map=l,this._language=l.getLanguage(),this._container=Be("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(l){this._language=l,this._update()}setUnit(l){this.options.unit=l,this._update()}},FullscreenControl:class{constructor(l={}){this._fullscreen=!1,l&&l.container&&(l.container instanceof HTMLElement?this._container=l.container:s.w("Full screen control 'container' must be a DOM element.")),s.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=Be("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const l=this._fullscreenButton=Be("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Be("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",l)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.E{constructor(l){super(),this.options=s.h(Object.create(ka),l),this._altitude=this.options.altitude,s.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(l&&l.className?l.className.trim().split(/\s+/):[])}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&l.on("preclick",this._onClose),this.options.closeOnMove&&l.on("move",this._onClose),l.on("remove",this.remove),this._update(),l._addPopup(this),this._focusFirstElement(),this._trackPointer?(l.on("mousemove",this._onMouseEvent),l.on("mouseup",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")):l.on("move",this._update),this.fire(new s.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const l=this._map;return l&&(l.off("move",this._update),l.off("move",this._onClose),l.off("preclick",this._onClose),l.off("click",this._onClose),l.off("remove",this.remove),l.off("mousemove",this._onMouseEvent),l.off("mouseup",this._onMouseEvent),l.off("drag",this._onMouseEvent),l._canvasContainer&&l._canvasContainer.classList.remove("mapboxgl-track-pointer"),l._removePopup(this),this._map=void 0),this.fire(new s.A("close")),this}getLngLat(){return this._lngLat}setLngLat(l){this._lngLat=s.cd.convert(l),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(l){return this._altitude=l,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const l=this._map;return l&&(l.off("move",this._update),l.on("mousemove",this._onMouseEvent),l.on("drag",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(document.createTextNode(l))}setHTML(l){const t=document.createDocumentFragment(),i=document.createElement("body");let c;for(i.innerHTML=l;c=i.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Be("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(l),this.options.closeButton){const i=this._closeButton=Be("button","mapboxgl-popup-close-button",t);i.type="button",i.setAttribute("aria-label","Close popup"),i.innerHTML='<span aria-hidden="true">&#215;</span>',i.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(l){return this._classList.add(l),this._updateClassList(),this}removeClassName(l){return this._classList.delete(l),this._updateClassList(),this}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){let t;return this._classList.delete(l)?t=!1:(this._classList.add(l),t=!0),this._updateClassList(),t}_onMouseEvent(l){this._update(l.point)}_getAnchor(l){if(this.options.anchor)return this.options.anchor;const t=this._map,i=this._container,c=this._pos;if(!t||!i||!c)return"bottom";const f=i.offsetWidth,m=i.offsetHeight,y=c.x<f/2,w=c.x>t.transform.width-f/2;if(c.y+l<m)return y?"top-left":w?"top-right":"top";if(c.y>t.transform.height-m){if(y)return"bottom-left";if(w)return"bottom-right"}return y?"left":w?"right":"bottom"}_updateClassList(){const l=this._container;if(!l)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),l.className=t.join(" ")}_update(l){const t=this._map,i=this._content;if(!t||!this._lngLat&&!this._trackPointer||!i)return;let c=this._container;if(c||(c=this._container=Be("div","mapboxgl-popup",t.getContainer()),this._tip=Be("div","mapboxgl-popup-tip",c),c.appendChild(i)),this.options.maxWidth&&c.style.maxWidth!==this.options.maxWidth&&(c.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=nh(this._lngLat,this._pos,t.transform)),!this._trackPointer||l){const f=this._pos=this._trackPointer&&l instanceof s.P?l:t.project(this._lngLat,this._altitude),m=Ai(this.options.offset),y=this._anchor=this._getAnchor(m.y),w=Ai(this.options.offset,y),S=f.add(w).round();t._requestDomTask(()=>{this._container&&y&&(this._container.style.transform=`${lu[y]} translate(${S.x}px,${S.y}px)`)})}if(!this._marker&&t._showingGlobe()){const f=s.eK(t.transform,this._lngLat)?0:1;this._setOpacity(f)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(ra);l&&l.focus()}_onClose(){this.remove()}_setOpacity(l){this._container&&(this._container.style.opacity=`${l}`),this._content&&(this._content.style.pointerEvents=l?"auto":"none")}},Marker:cu,Style:qs,LngLat:s.cd,LngLatBounds:s.aG,Point:s.P,MercatorCoordinate:s.ac,FreeCameraOptions:Nc,Evented:s.E,config:s.e,prewarm:s.eO,clearPrewarmedResources:s.eN,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(l){s.e.ACCESS_TOKEN=l},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(l){s.e.API_URL=l},get workerCount(){return s.eX.workerCount},set workerCount(l){s.eX.workerCount=l},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){s.e.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){s.eW(l)},get workerUrl(){return s.eV.workerUrl},set workerUrl(l){s.eV.workerUrl=l},get workerClass(){return s.eV.workerClass},set workerClass(l){s.eV.workerClass=l},get workerParams(){return s.eV.workerParams},set workerParams(l){s.eV.workerParams=l},get dracoUrl(){return s.eU()},set dracoUrl(l){s.eT(l)},get meshoptUrl(){return s.eS()},set meshoptUrl(l){s.eR(l)},setNow:s.q.setNow,restoreNow:s.q.restoreNow}});var re=B;return re})}(F_)),F_.exports}var PO=MO();const Jv=X_(PO),RO=_=>{const b=[];for(let B=0;B<10;B++){const $=Math.random()*2*Math.PI,re=.002+Math.random()*(.015-.002),s=re*Math.cos($),ce=re*Math.sin($),be=_[0]+s,Se=_[1]+ce;b.push({id:`scooter-${B+1}`,lngLat:[be,Se],title:`Самокат ${B+1}`,description:"Доступен для аренды",type:"marker"})}return b};function zO(){const[_,b]=Fe.useState(null),I=Fe.useRef(null),z=Fe.useRef(null),B=Fe.useRef([]),$=Fe.useCallback(()=>{if(I.current){const ce=I.current.getZoom();I.current.flyTo({zoom:ce+1,essential:!0})}},[I]),re=Fe.useCallback(()=>{if(I.current){const ce=I.current.getZoom();I.current.flyTo({zoom:ce-1,essential:!0})}},[I]),s=Fe.useCallback(()=>new Promise((ce,be)=>{if(navigator.geolocation)navigator.geolocation.getCurrentPosition(Se=>{const{latitude:Me,longitude:tt}=Se.coords,wt=[tt,Me];console.log("coords",wt),I.current?.flyTo({center:wt,zoom:14,essential:!0}),b(wt),ce(wt)},Se=>{alert("Не удалось получить геолокацию"),be(Se)});else{const Se=new Error("Геолокация не поддерживается");alert("Геолокация не поддерживается"),be(Se)}}),[I]);return{mapRef:I,mapContainer:z,markersRef:B,handleGeolocate:s,zoomMap:$,zoomOutMap:re,position:_}}function kO({mapRef:_,mapContainer:b,markersRef:I,handleGeolocate:z,position:B,onMarkerClick:$}){const re=ce=>{console.log(ce);const be=document.createElement("div");return be.className="custom-marker",be.innerHTML=ce.type==="position"?`
          <div class="size-4 flex items-center justify-center rounded-full bg-blue-500 border-2 border-white ring-[0.5rem] ring-blue-500/20"></div>
        `:`
          <img src="./images/pin.svg" class="size-10" />
        `,be},s=async ce=>{if(I.current.forEach(Se=>Se.remove()),I.current=[],(ce?RO(ce):[]).forEach(Se=>{const Me=re(Se),tt=new Jv.Marker(Me).setLngLat(Se.lngLat).addTo(_.current);Me.addEventListener("click",()=>{$?.(Se)}),I.current.push(tt)}),ce){const Se=re({id:"position",lngLat:ce,title:"Position",description:"Position",type:"position"}),Me=new Jv.Marker(Se).setLngLat(ce).addTo(_.current);I.current.push(Me)}};return Fe.useEffect(()=>(b.current&&(_.current=new Jv.Map({container:b.current,style:"mapbox://styles/mapbox/streets-v12",center:[37.6173,55.7558],zoom:9,accessToken:"pk.eyJ1IjoiZGFuaWxyb3poa292IiwiYSI6ImNtYjR2em1ibDBpMm0ybHF1d2NiOWZyY3gifQ.cTZPv1vHnlhb4e6TXiqQsA"}),_.current.on("load",async()=>{try{const ce=await z();await s(ce)}catch(ce){console.error("Failed to get geolocation:",ce),await s(null)}})),()=>{_.current&&_.current.remove()}),[]),Fe.useEffect(()=>{_.current&&_.current.isStyleLoaded()&&s(B)},[B]),H.jsx("div",{className:"relative h-full w-full",children:H.jsx("div",{ref:b,className:"h-full w-full"})})}function df(_,b,{checkForDefaultPrevented:I=!0}={}){return function(B){if(_?.(B),I===!1||!B.defaultPrevented)return b?.(B)}}function DO(_,b){const I=Fe.createContext(b),z=$=>{const{children:re,...s}=$,ce=Fe.useMemo(()=>s,Object.values(s));return H.jsx(I.Provider,{value:ce,children:re})};z.displayName=_+"Provider";function B($){const re=Fe.useContext(I);if(re)return re;if(b!==void 0)return b;throw new Error(`\`${$}\` must be used within \`${_}\``)}return[z,B]}function LO(_,b=[]){let I=[];function z($,re){const s=Fe.createContext(re),ce=I.length;I=[...I,re];const be=Me=>{const{scope:tt,children:wt,...Xt}=Me,Be=tt?.[_]?.[ce]||s,ct=Fe.useMemo(()=>Xt,Object.values(Xt));return H.jsx(Be.Provider,{value:ct,children:wt})};be.displayName=$+"Provider";function Se(Me,tt){const wt=tt?.[_]?.[ce]||s,Xt=Fe.useContext(wt);if(Xt)return Xt;if(re!==void 0)return re;throw new Error(`\`${Me}\` must be used within \`${$}\``)}return[be,Se]}const B=()=>{const $=I.map(re=>Fe.createContext(re));return function(s){const ce=s?.[_]||$;return Fe.useMemo(()=>({[`__scope${_}`]:{...s,[_]:ce}}),[s,ce])}};return B.scopeName=_,[z,OO(B,...b)]}function OO(..._){const b=_[0];if(_.length===1)return b;const I=()=>{const z=_.map(B=>({useScope:B(),scopeName:B.scopeName}));return function($){const re=z.reduce((s,{useScope:ce,scopeName:be})=>{const Me=ce($)[`__scope${be}`];return{...s,...Me}},{});return Fe.useMemo(()=>({[`__scope${b.scopeName}`]:re}),[re])}};return I.scopeName=b.scopeName,I}var Tg=globalThis?.document?Fe.useLayoutEffect:()=>{},FO=Ox[" useId ".trim().toString()]||(()=>{}),NO=0;function Qv(_){const[b,I]=Fe.useState(FO());return Tg(()=>{I(z=>z??String(NO++))},[_]),_||(b?`radix-${b}`:"")}var BO=Ox[" useInsertionEffect ".trim().toString()]||Tg;function jO({prop:_,defaultProp:b,onChange:I=()=>{},caller:z}){const[B,$,re]=VO({defaultProp:b,onChange:I}),s=_!==void 0,ce=s?_:B;{const Se=Fe.useRef(_!==void 0);Fe.useEffect(()=>{const Me=Se.current;Me!==s&&console.warn(`${z} is changing from ${Me?"controlled":"uncontrolled"} to ${s?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),Se.current=s},[s,z])}const be=Fe.useCallback(Se=>{if(s){const Me=UO(Se)?Se(_):Se;Me!==_&&re.current?.(Me)}else $(Se)},[s,_,$,re]);return[ce,be]}function VO({defaultProp:_,onChange:b}){const[I,z]=Fe.useState(_),B=Fe.useRef(I),$=Fe.useRef(b);return BO(()=>{$.current=b},[b]),Fe.useEffect(()=>{B.current!==I&&($.current?.(I),B.current=I)},[I,B]),[I,z,$]}function UO(_){return typeof _=="function"}var $O=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],hh=$O.reduce((_,b)=>{const I=jx(`Primitive.${b}`),z=Fe.forwardRef((B,$)=>{const{asChild:re,...s}=B,ce=re?I:b;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),H.jsx(ce,{...s,ref:$})});return z.displayName=`Primitive.${b}`,{..._,[b]:z}},{});function GO(_,b){_&&VT.flushSync(()=>_.dispatchEvent(b))}function Sg(_){const b=Fe.useRef(_);return Fe.useEffect(()=>{b.current=_}),Fe.useMemo(()=>(...I)=>b.current?.(...I),[])}function qO(_,b=globalThis?.document){const I=Sg(_);Fe.useEffect(()=>{const z=B=>{B.key==="Escape"&&I(B)};return b.addEventListener("keydown",z,{capture:!0}),()=>b.removeEventListener("keydown",z,{capture:!0})},[I,b])}var HO="DismissableLayer",Rx="dismissableLayer.update",WO="dismissableLayer.pointerDownOutside",ZO="dismissableLayer.focusOutside",ST,EI=Fe.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),II=Fe.forwardRef((_,b)=>{const{disableOutsidePointerEvents:I=!1,onEscapeKeyDown:z,onPointerDownOutside:B,onFocusOutside:$,onInteractOutside:re,onDismiss:s,...ce}=_,be=Fe.useContext(EI),[Se,Me]=Fe.useState(null),tt=Se?.ownerDocument??globalThis?.document,[,wt]=Fe.useState({}),Xt=mp(b,Kt=>Me(Kt)),Be=Array.from(be.layers),[ct]=[...be.layersWithOutsidePointerEventsDisabled].slice(-1),Tt=Be.indexOf(ct),Dt=Se?Be.indexOf(Se):-1,Vt=be.layersWithOutsidePointerEventsDisabled.size>0,jt=Dt>=Tt,vr=KO(Kt=>{const Wt=Kt.target,Cr=[...be.branches].some(oi=>oi.contains(Wt));!jt||Cr||(B?.(Kt),re?.(Kt),Kt.defaultPrevented||s?.())},tt),hr=JO(Kt=>{const Wt=Kt.target;[...be.branches].some(oi=>oi.contains(Wt))||($?.(Kt),re?.(Kt),Kt.defaultPrevented||s?.())},tt);return qO(Kt=>{Dt===be.layers.size-1&&(z?.(Kt),!Kt.defaultPrevented&&s&&(Kt.preventDefault(),s()))},tt),Fe.useEffect(()=>{if(Se)return I&&(be.layersWithOutsidePointerEventsDisabled.size===0&&(ST=tt.body.style.pointerEvents,tt.body.style.pointerEvents="none"),be.layersWithOutsidePointerEventsDisabled.add(Se)),be.layers.add(Se),ET(),()=>{I&&be.layersWithOutsidePointerEventsDisabled.size===1&&(tt.body.style.pointerEvents=ST)}},[Se,tt,I,be]),Fe.useEffect(()=>()=>{Se&&(be.layers.delete(Se),be.layersWithOutsidePointerEventsDisabled.delete(Se),ET())},[Se,be]),Fe.useEffect(()=>{const Kt=()=>wt({});return document.addEventListener(Rx,Kt),()=>document.removeEventListener(Rx,Kt)},[]),H.jsx(hh.div,{...ce,ref:Xt,style:{pointerEvents:Vt?jt?"auto":"none":void 0,..._.style},onFocusCapture:df(_.onFocusCapture,hr.onFocusCapture),onBlurCapture:df(_.onBlurCapture,hr.onBlurCapture),onPointerDownCapture:df(_.onPointerDownCapture,vr.onPointerDownCapture)})});II.displayName=HO;var XO="DismissableLayerBranch",YO=Fe.forwardRef((_,b)=>{const I=Fe.useContext(EI),z=Fe.useRef(null),B=mp(b,z);return Fe.useEffect(()=>{const $=z.current;if($)return I.branches.add($),()=>{I.branches.delete($)}},[I.branches]),H.jsx(hh.div,{..._,ref:B})});YO.displayName=XO;function KO(_,b=globalThis?.document){const I=Sg(_),z=Fe.useRef(!1),B=Fe.useRef(()=>{});return Fe.useEffect(()=>{const $=s=>{if(s.target&&!z.current){let ce=function(){AI(WO,I,be,{discrete:!0})};const be={originalEvent:s};s.pointerType==="touch"?(b.removeEventListener("click",B.current),B.current=ce,b.addEventListener("click",B.current,{once:!0})):ce()}else b.removeEventListener("click",B.current);z.current=!1},re=window.setTimeout(()=>{b.addEventListener("pointerdown",$)},0);return()=>{window.clearTimeout(re),b.removeEventListener("pointerdown",$),b.removeEventListener("click",B.current)}},[b,I]),{onPointerDownCapture:()=>z.current=!0}}function JO(_,b=globalThis?.document){const I=Sg(_),z=Fe.useRef(!1);return Fe.useEffect(()=>{const B=$=>{$.target&&!z.current&&AI(ZO,I,{originalEvent:$},{discrete:!1})};return b.addEventListener("focusin",B),()=>b.removeEventListener("focusin",B)},[b,I]),{onFocusCapture:()=>z.current=!0,onBlurCapture:()=>z.current=!1}}function ET(){const _=new CustomEvent(Rx);document.dispatchEvent(_)}function AI(_,b,I,{discrete:z}){const B=I.originalEvent.target,$=new CustomEvent(_,{bubbles:!1,cancelable:!0,detail:I});b&&B.addEventListener(_,b,{once:!0}),z?GO(B,$):B.dispatchEvent($)}var ex="focusScope.autoFocusOnMount",tx="focusScope.autoFocusOnUnmount",IT={bubbles:!1,cancelable:!0},QO="FocusScope",CI=Fe.forwardRef((_,b)=>{const{loop:I=!1,trapped:z=!1,onMountAutoFocus:B,onUnmountAutoFocus:$,...re}=_,[s,ce]=Fe.useState(null),be=Sg(B),Se=Sg($),Me=Fe.useRef(null),tt=mp(b,Be=>ce(Be)),wt=Fe.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;Fe.useEffect(()=>{if(z){let Be=function(Vt){if(wt.paused||!s)return;const jt=Vt.target;s.contains(jt)?Me.current=jt:lf(Me.current,{select:!0})},ct=function(Vt){if(wt.paused||!s)return;const jt=Vt.relatedTarget;jt!==null&&(s.contains(jt)||lf(Me.current,{select:!0}))},Tt=function(Vt){if(document.activeElement===document.body)for(const vr of Vt)vr.removedNodes.length>0&&lf(s)};document.addEventListener("focusin",Be),document.addEventListener("focusout",ct);const Dt=new MutationObserver(Tt);return s&&Dt.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",Be),document.removeEventListener("focusout",ct),Dt.disconnect()}}},[z,s,wt.paused]),Fe.useEffect(()=>{if(s){CT.add(wt);const Be=document.activeElement;if(!s.contains(Be)){const Tt=new CustomEvent(ex,IT);s.addEventListener(ex,be),s.dispatchEvent(Tt),Tt.defaultPrevented||(eF(sF(MI(s)),{select:!0}),document.activeElement===Be&&lf(s))}return()=>{s.removeEventListener(ex,be),setTimeout(()=>{const Tt=new CustomEvent(tx,IT);s.addEventListener(tx,Se),s.dispatchEvent(Tt),Tt.defaultPrevented||lf(Be??document.body,{select:!0}),s.removeEventListener(tx,Se),CT.remove(wt)},0)}}},[s,be,Se,wt]);const Xt=Fe.useCallback(Be=>{if(!I&&!z||wt.paused)return;const ct=Be.key==="Tab"&&!Be.altKey&&!Be.ctrlKey&&!Be.metaKey,Tt=document.activeElement;if(ct&&Tt){const Dt=Be.currentTarget,[Vt,jt]=tF(Dt);Vt&&jt?!Be.shiftKey&&Tt===jt?(Be.preventDefault(),I&&lf(Vt,{select:!0})):Be.shiftKey&&Tt===Vt&&(Be.preventDefault(),I&&lf(jt,{select:!0})):Tt===Dt&&Be.preventDefault()}},[I,z,wt.paused]);return H.jsx(hh.div,{tabIndex:-1,...re,ref:tt,onKeyDown:Xt})});CI.displayName=QO;function eF(_,{select:b=!1}={}){const I=document.activeElement;for(const z of _)if(lf(z,{select:b}),document.activeElement!==I)return}function tF(_){const b=MI(_),I=AT(b,_),z=AT(b.reverse(),_);return[I,z]}function MI(_){const b=[],I=document.createTreeWalker(_,NodeFilter.SHOW_ELEMENT,{acceptNode:z=>{const B=z.tagName==="INPUT"&&z.type==="hidden";return z.disabled||z.hidden||B?NodeFilter.FILTER_SKIP:z.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;I.nextNode();)b.push(I.currentNode);return b}function AT(_,b){for(const I of _)if(!rF(I,{upTo:b}))return I}function rF(_,{upTo:b}){if(getComputedStyle(_).visibility==="hidden")return!0;for(;_;){if(b!==void 0&&_===b)return!1;if(getComputedStyle(_).display==="none")return!0;_=_.parentElement}return!1}function nF(_){return _ instanceof HTMLInputElement&&"select"in _}function lf(_,{select:b=!1}={}){if(_&&_.focus){const I=document.activeElement;_.focus({preventScroll:!0}),_!==I&&nF(_)&&b&&_.select()}}var CT=iF();function iF(){let _=[];return{add(b){const I=_[0];b!==I&&I?.pause(),_=MT(_,b),_.unshift(b)},remove(b){_=MT(_,b),_[0]?.resume()}}}function MT(_,b){const I=[..._],z=I.indexOf(b);return z!==-1&&I.splice(z,1),I}function sF(_){return _.filter(b=>b.tagName!=="A")}var oF="Portal",PI=Fe.forwardRef((_,b)=>{const{container:I,...z}=_,[B,$]=Fe.useState(!1);Tg(()=>$(!0),[]);const re=I||B&&globalThis?.document?.body;return re?RP.createPortal(H.jsx(hh.div,{...z,ref:b}),re):null});PI.displayName=oF;function aF(_,b){return Fe.useReducer((I,z)=>b[I][z]??I,_)}var _y=_=>{const{present:b,children:I}=_,z=lF(b),B=typeof I=="function"?I({present:z.isPresent}):Fe.Children.only(I),$=mp(z.ref,cF(B));return typeof I=="function"||z.isPresent?Fe.cloneElement(B,{ref:$}):null};_y.displayName="Presence";function lF(_){const[b,I]=Fe.useState(),z=Fe.useRef(null),B=Fe.useRef(_),$=Fe.useRef("none"),re=_?"mounted":"unmounted",[s,ce]=aF(re,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return Fe.useEffect(()=>{const be=M_(z.current);$.current=s==="mounted"?be:"none"},[s]),Tg(()=>{const be=z.current,Se=B.current;if(Se!==_){const tt=$.current,wt=M_(be);_?ce("MOUNT"):wt==="none"||be?.display==="none"?ce("UNMOUNT"):ce(Se&&tt!==wt?"ANIMATION_OUT":"UNMOUNT"),B.current=_}},[_,ce]),Tg(()=>{if(b){let be;const Se=b.ownerDocument.defaultView??window,Me=wt=>{const Be=M_(z.current).includes(wt.animationName);if(wt.target===b&&Be&&(ce("ANIMATION_END"),!B.current)){const ct=b.style.animationFillMode;b.style.animationFillMode="forwards",be=Se.setTimeout(()=>{b.style.animationFillMode==="forwards"&&(b.style.animationFillMode=ct)})}},tt=wt=>{wt.target===b&&($.current=M_(z.current))};return b.addEventListener("animationstart",tt),b.addEventListener("animationcancel",Me),b.addEventListener("animationend",Me),()=>{Se.clearTimeout(be),b.removeEventListener("animationstart",tt),b.removeEventListener("animationcancel",Me),b.removeEventListener("animationend",Me)}}else ce("ANIMATION_END")},[b,ce]),{isPresent:["mounted","unmountSuspended"].includes(s),ref:Fe.useCallback(be=>{z.current=be?getComputedStyle(be):null,I(be)},[])}}function M_(_){return _?.animationName||"none"}function cF(_){let b=Object.getOwnPropertyDescriptor(_.props,"ref")?.get,I=b&&"isReactWarning"in b&&b.isReactWarning;return I?_.ref:(b=Object.getOwnPropertyDescriptor(_,"ref")?.get,I=b&&"isReactWarning"in b&&b.isReactWarning,I?_.props.ref:_.props.ref||_.ref)}var rx=0;function uF(){Fe.useEffect(()=>{const _=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",_[0]??PT()),document.body.insertAdjacentElement("beforeend",_[1]??PT()),rx++,()=>{rx===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(b=>b.remove()),rx--}},[])}function PT(){const _=document.createElement("span");return _.setAttribute("data-radix-focus-guard",""),_.tabIndex=0,_.style.outline="none",_.style.opacity="0",_.style.position="fixed",_.style.pointerEvents="none",_}var uh=function(){return uh=Object.assign||function(b){for(var I,z=1,B=arguments.length;z<B;z++){I=arguments[z];for(var $ in I)Object.prototype.hasOwnProperty.call(I,$)&&(b[$]=I[$])}return b},uh.apply(this,arguments)};function RI(_,b){var I={};for(var z in _)Object.prototype.hasOwnProperty.call(_,z)&&b.indexOf(z)<0&&(I[z]=_[z]);if(_!=null&&typeof Object.getOwnPropertySymbols=="function")for(var B=0,z=Object.getOwnPropertySymbols(_);B<z.length;B++)b.indexOf(z[B])<0&&Object.prototype.propertyIsEnumerable.call(_,z[B])&&(I[z[B]]=_[z[B]]);return I}function hF(_,b,I){if(I||arguments.length===2)for(var z=0,B=b.length,$;z<B;z++)($||!(z in b))&&($||($=Array.prototype.slice.call(b,0,z)),$[z]=b[z]);return _.concat($||Array.prototype.slice.call(b))}var N_="right-scroll-bar-position",B_="width-before-scroll-bar",dF="with-scroll-bars-hidden",fF="--removed-body-scroll-bar-size";function nx(_,b){return typeof _=="function"?_(b):_&&(_.current=b),_}function pF(_,b){var I=Fe.useState(function(){return{value:_,callback:b,facade:{get current(){return I.value},set current(z){var B=I.value;B!==z&&(I.value=z,I.callback(z,B))}}}})[0];return I.callback=b,I.facade}var mF=typeof window<"u"?Fe.useLayoutEffect:Fe.useEffect,RT=new WeakMap;function gF(_,b){var I=pF(null,function(z){return _.forEach(function(B){return nx(B,z)})});return mF(function(){var z=RT.get(I);if(z){var B=new Set(z),$=new Set(_),re=I.current;B.forEach(function(s){$.has(s)||nx(s,null)}),$.forEach(function(s){B.has(s)||nx(s,re)})}RT.set(I,_)},[_]),I}function _F(_){return _}function yF(_,b){b===void 0&&(b=_F);var I=[],z=!1,B={read:function(){if(z)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return I.length?I[I.length-1]:_},useMedium:function($){var re=b($,z);return I.push(re),function(){I=I.filter(function(s){return s!==re})}},assignSyncMedium:function($){for(z=!0;I.length;){var re=I;I=[],re.forEach($)}I={push:function(s){return $(s)},filter:function(){return I}}},assignMedium:function($){z=!0;var re=[];if(I.length){var s=I;I=[],s.forEach($),re=I}var ce=function(){var Se=re;re=[],Se.forEach($)},be=function(){return Promise.resolve().then(ce)};be(),I={push:function(Se){re.push(Se),be()},filter:function(Se){return re=re.filter(Se),I}}}};return B}function vF(_){_===void 0&&(_={});var b=yF(null);return b.options=uh({async:!0,ssr:!1},_),b}var zI=function(_){var b=_.sideCar,I=RI(_,["sideCar"]);if(!b)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var z=b.read();if(!z)throw new Error("Sidecar medium not found");return Fe.createElement(z,uh({},I))};zI.isSideCarExport=!0;function xF(_,b){return _.useMedium(b),zI}var kI=vF(),ix=function(){},yy=Fe.forwardRef(function(_,b){var I=Fe.useRef(null),z=Fe.useState({onScrollCapture:ix,onWheelCapture:ix,onTouchMoveCapture:ix}),B=z[0],$=z[1],re=_.forwardProps,s=_.children,ce=_.className,be=_.removeScrollBar,Se=_.enabled,Me=_.shards,tt=_.sideCar,wt=_.noRelative,Xt=_.noIsolation,Be=_.inert,ct=_.allowPinchZoom,Tt=_.as,Dt=Tt===void 0?"div":Tt,Vt=_.gapMode,jt=RI(_,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),vr=tt,hr=gF([I,b]),Kt=uh(uh({},jt),B);return Fe.createElement(Fe.Fragment,null,Se&&Fe.createElement(vr,{sideCar:kI,removeScrollBar:be,shards:Me,noRelative:wt,noIsolation:Xt,inert:Be,setCallbacks:$,allowPinchZoom:!!ct,lockRef:I,gapMode:Vt}),re?Fe.cloneElement(Fe.Children.only(s),uh(uh({},Kt),{ref:hr})):Fe.createElement(Dt,uh({},Kt,{className:ce,ref:hr}),s))});yy.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};yy.classNames={fullWidth:B_,zeroRight:N_};var wF=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function bF(){if(!document)return null;var _=document.createElement("style");_.type="text/css";var b=wF();return b&&_.setAttribute("nonce",b),_}function TF(_,b){_.styleSheet?_.styleSheet.cssText=b:_.appendChild(document.createTextNode(b))}function SF(_){var b=document.head||document.getElementsByTagName("head")[0];b.appendChild(_)}var EF=function(){var _=0,b=null;return{add:function(I){_==0&&(b=bF())&&(TF(b,I),SF(b)),_++},remove:function(){_--,!_&&b&&(b.parentNode&&b.parentNode.removeChild(b),b=null)}}},IF=function(){var _=EF();return function(b,I){Fe.useEffect(function(){return _.add(b),function(){_.remove()}},[b&&I])}},DI=function(){var _=IF(),b=function(I){var z=I.styles,B=I.dynamic;return _(z,B),null};return b},AF={left:0,top:0,right:0,gap:0},sx=function(_){return parseInt(_||"",10)||0},CF=function(_){var b=window.getComputedStyle(document.body),I=b[_==="padding"?"paddingLeft":"marginLeft"],z=b[_==="padding"?"paddingTop":"marginTop"],B=b[_==="padding"?"paddingRight":"marginRight"];return[sx(I),sx(z),sx(B)]},MF=function(_){if(_===void 0&&(_="margin"),typeof window>"u")return AF;var b=CF(_),I=document.documentElement.clientWidth,z=window.innerWidth;return{left:b[0],top:b[1],right:b[2],gap:Math.max(0,z-I+b[2]-b[0])}},PF=DI(),sm="data-scroll-locked",RF=function(_,b,I,z){var B=_.left,$=_.top,re=_.right,s=_.gap;return I===void 0&&(I="margin"),`
  .`.concat(dF,` {
   overflow: hidden `).concat(z,`;
   padding-right: `).concat(s,"px ").concat(z,`;
  }
  body[`).concat(sm,`] {
    overflow: hidden `).concat(z,`;
    overscroll-behavior: contain;
    `).concat([b&&"position: relative ".concat(z,";"),I==="margin"&&`
    padding-left: `.concat(B,`px;
    padding-top: `).concat($,`px;
    padding-right: `).concat(re,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(z,`;
    `),I==="padding"&&"padding-right: ".concat(s,"px ").concat(z,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(N_,` {
    right: `).concat(s,"px ").concat(z,`;
  }
  
  .`).concat(B_,` {
    margin-right: `).concat(s,"px ").concat(z,`;
  }
  
  .`).concat(N_," .").concat(N_,` {
    right: 0 `).concat(z,`;
  }
  
  .`).concat(B_," .").concat(B_,` {
    margin-right: 0 `).concat(z,`;
  }
  
  body[`).concat(sm,`] {
    `).concat(fF,": ").concat(s,`px;
  }
`)},zT=function(){var _=parseInt(document.body.getAttribute(sm)||"0",10);return isFinite(_)?_:0},zF=function(){Fe.useEffect(function(){return document.body.setAttribute(sm,(zT()+1).toString()),function(){var _=zT()-1;_<=0?document.body.removeAttribute(sm):document.body.setAttribute(sm,_.toString())}},[])},kF=function(_){var b=_.noRelative,I=_.noImportant,z=_.gapMode,B=z===void 0?"margin":z;zF();var $=Fe.useMemo(function(){return MF(B)},[B]);return Fe.createElement(PF,{styles:RF($,!b,B,I?"":"!important")})},zx=!1;if(typeof window<"u")try{var P_=Object.defineProperty({},"passive",{get:function(){return zx=!0,!0}});window.addEventListener("test",P_,P_),window.removeEventListener("test",P_,P_)}catch{zx=!1}var Qp=zx?{passive:!1}:!1,DF=function(_){return _.tagName==="TEXTAREA"},LI=function(_,b){if(!(_ instanceof Element))return!1;var I=window.getComputedStyle(_);return I[b]!=="hidden"&&!(I.overflowY===I.overflowX&&!DF(_)&&I[b]==="visible")},LF=function(_){return LI(_,"overflowY")},OF=function(_){return LI(_,"overflowX")},kT=function(_,b){var I=b.ownerDocument,z=b;do{typeof ShadowRoot<"u"&&z instanceof ShadowRoot&&(z=z.host);var B=OI(_,z);if(B){var $=FI(_,z),re=$[1],s=$[2];if(re>s)return!0}z=z.parentNode}while(z&&z!==I.body);return!1},FF=function(_){var b=_.scrollTop,I=_.scrollHeight,z=_.clientHeight;return[b,I,z]},NF=function(_){var b=_.scrollLeft,I=_.scrollWidth,z=_.clientWidth;return[b,I,z]},OI=function(_,b){return _==="v"?LF(b):OF(b)},FI=function(_,b){return _==="v"?FF(b):NF(b)},BF=function(_,b){return _==="h"&&b==="rtl"?-1:1},jF=function(_,b,I,z,B){var $=BF(_,window.getComputedStyle(b).direction),re=$*z,s=I.target,ce=b.contains(s),be=!1,Se=re>0,Me=0,tt=0;do{if(!s)break;var wt=FI(_,s),Xt=wt[0],Be=wt[1],ct=wt[2],Tt=Be-ct-$*Xt;(Xt||Tt)&&OI(_,s)&&(Me+=Tt,tt+=Xt);var Dt=s.parentNode;s=Dt&&Dt.nodeType===Node.DOCUMENT_FRAGMENT_NODE?Dt.host:Dt}while(!ce&&s!==document.body||ce&&(b.contains(s)||b===s));return(Se&&Math.abs(Me)<1||!Se&&Math.abs(tt)<1)&&(be=!0),be},R_=function(_){return"changedTouches"in _?[_.changedTouches[0].clientX,_.changedTouches[0].clientY]:[0,0]},DT=function(_){return[_.deltaX,_.deltaY]},LT=function(_){return _&&"current"in _?_.current:_},VF=function(_,b){return _[0]===b[0]&&_[1]===b[1]},UF=function(_){return`
  .block-interactivity-`.concat(_,` {pointer-events: none;}
  .allow-interactivity-`).concat(_,` {pointer-events: all;}
`)},$F=0,em=[];function GF(_){var b=Fe.useRef([]),I=Fe.useRef([0,0]),z=Fe.useRef(),B=Fe.useState($F++)[0],$=Fe.useState(DI)[0],re=Fe.useRef(_);Fe.useEffect(function(){re.current=_},[_]),Fe.useEffect(function(){if(_.inert){document.body.classList.add("block-interactivity-".concat(B));var Be=hF([_.lockRef.current],(_.shards||[]).map(LT),!0).filter(Boolean);return Be.forEach(function(ct){return ct.classList.add("allow-interactivity-".concat(B))}),function(){document.body.classList.remove("block-interactivity-".concat(B)),Be.forEach(function(ct){return ct.classList.remove("allow-interactivity-".concat(B))})}}},[_.inert,_.lockRef.current,_.shards]);var s=Fe.useCallback(function(Be,ct){if("touches"in Be&&Be.touches.length===2||Be.type==="wheel"&&Be.ctrlKey)return!re.current.allowPinchZoom;var Tt=R_(Be),Dt=I.current,Vt="deltaX"in Be?Be.deltaX:Dt[0]-Tt[0],jt="deltaY"in Be?Be.deltaY:Dt[1]-Tt[1],vr,hr=Be.target,Kt=Math.abs(Vt)>Math.abs(jt)?"h":"v";if("touches"in Be&&Kt==="h"&&hr.type==="range")return!1;var Wt=kT(Kt,hr);if(!Wt)return!0;if(Wt?vr=Kt:(vr=Kt==="v"?"h":"v",Wt=kT(Kt,hr)),!Wt)return!1;if(!z.current&&"changedTouches"in Be&&(Vt||jt)&&(z.current=vr),!vr)return!0;var Cr=z.current||vr;return jF(Cr,ct,Be,Cr==="h"?Vt:jt)},[]),ce=Fe.useCallback(function(Be){var ct=Be;if(!(!em.length||em[em.length-1]!==$)){var Tt="deltaY"in ct?DT(ct):R_(ct),Dt=b.current.filter(function(vr){return vr.name===ct.type&&(vr.target===ct.target||ct.target===vr.shadowParent)&&VF(vr.delta,Tt)})[0];if(Dt&&Dt.should){ct.cancelable&&ct.preventDefault();return}if(!Dt){var Vt=(re.current.shards||[]).map(LT).filter(Boolean).filter(function(vr){return vr.contains(ct.target)}),jt=Vt.length>0?s(ct,Vt[0]):!re.current.noIsolation;jt&&ct.cancelable&&ct.preventDefault()}}},[]),be=Fe.useCallback(function(Be,ct,Tt,Dt){var Vt={name:Be,delta:ct,target:Tt,should:Dt,shadowParent:qF(Tt)};b.current.push(Vt),setTimeout(function(){b.current=b.current.filter(function(jt){return jt!==Vt})},1)},[]),Se=Fe.useCallback(function(Be){I.current=R_(Be),z.current=void 0},[]),Me=Fe.useCallback(function(Be){be(Be.type,DT(Be),Be.target,s(Be,_.lockRef.current))},[]),tt=Fe.useCallback(function(Be){be(Be.type,R_(Be),Be.target,s(Be,_.lockRef.current))},[]);Fe.useEffect(function(){return em.push($),_.setCallbacks({onScrollCapture:Me,onWheelCapture:Me,onTouchMoveCapture:tt}),document.addEventListener("wheel",ce,Qp),document.addEventListener("touchmove",ce,Qp),document.addEventListener("touchstart",Se,Qp),function(){em=em.filter(function(Be){return Be!==$}),document.removeEventListener("wheel",ce,Qp),document.removeEventListener("touchmove",ce,Qp),document.removeEventListener("touchstart",Se,Qp)}},[]);var wt=_.removeScrollBar,Xt=_.inert;return Fe.createElement(Fe.Fragment,null,Xt?Fe.createElement($,{styles:UF(B)}):null,wt?Fe.createElement(kF,{noRelative:_.noRelative,gapMode:_.gapMode}):null)}function qF(_){for(var b=null;_!==null;)_ instanceof ShadowRoot&&(b=_.host,_=_.host),_=_.parentNode;return b}const HF=xF(kI,GF);var NI=Fe.forwardRef(function(_,b){return Fe.createElement(yy,uh({},_,{ref:b,sideCar:HF}))});NI.classNames=yy.classNames;var WF=function(_){if(typeof document>"u")return null;var b=Array.isArray(_)?_[0]:_;return b.ownerDocument.body},tm=new WeakMap,z_=new WeakMap,k_={},ox=0,BI=function(_){return _&&(_.host||BI(_.parentNode))},ZF=function(_,b){return b.map(function(I){if(_.contains(I))return I;var z=BI(I);return z&&_.contains(z)?z:(console.error("aria-hidden",I,"in not contained inside",_,". Doing nothing"),null)}).filter(function(I){return!!I})},XF=function(_,b,I,z){var B=ZF(b,Array.isArray(_)?_:[_]);k_[I]||(k_[I]=new WeakMap);var $=k_[I],re=[],s=new Set,ce=new Set(B),be=function(Me){!Me||s.has(Me)||(s.add(Me),be(Me.parentNode))};B.forEach(be);var Se=function(Me){!Me||ce.has(Me)||Array.prototype.forEach.call(Me.children,function(tt){if(s.has(tt))Se(tt);else try{var wt=tt.getAttribute(z),Xt=wt!==null&&wt!=="false",Be=(tm.get(tt)||0)+1,ct=($.get(tt)||0)+1;tm.set(tt,Be),$.set(tt,ct),re.push(tt),Be===1&&Xt&&z_.set(tt,!0),ct===1&&tt.setAttribute(I,"true"),Xt||tt.setAttribute(z,"true")}catch(Tt){console.error("aria-hidden: cannot operate on ",tt,Tt)}})};return Se(b),s.clear(),ox++,function(){re.forEach(function(Me){var tt=tm.get(Me)-1,wt=$.get(Me)-1;tm.set(Me,tt),$.set(Me,wt),tt||(z_.has(Me)||Me.removeAttribute(z),z_.delete(Me)),wt||Me.removeAttribute(I)}),ox--,ox||(tm=new WeakMap,tm=new WeakMap,z_=new WeakMap,k_={})}},YF=function(_,b,I){I===void 0&&(I="data-aria-hidden");var z=Array.from(Array.isArray(_)?_:[_]),B=WF(_);return B?(z.push.apply(z,Array.from(B.querySelectorAll("[aria-live], script"))),XF(z,B,I,"aria-hidden")):function(){return null}},vy="Dialog",[jI,q5]=LO(vy),[KF,gu]=jI(vy),VI=_=>{const{__scopeDialog:b,children:I,open:z,defaultOpen:B,onOpenChange:$,modal:re=!0}=_,s=Fe.useRef(null),ce=Fe.useRef(null),[be,Se]=jO({prop:z,defaultProp:B??!1,onChange:$,caller:vy});return H.jsx(KF,{scope:b,triggerRef:s,contentRef:ce,contentId:Qv(),titleId:Qv(),descriptionId:Qv(),open:be,onOpenChange:Se,onOpenToggle:Fe.useCallback(()=>Se(Me=>!Me),[Se]),modal:re,children:I})};VI.displayName=vy;var UI="DialogTrigger",$I=Fe.forwardRef((_,b)=>{const{__scopeDialog:I,...z}=_,B=gu(UI,I),$=mp(b,B.triggerRef);return H.jsx(hh.button,{type:"button","aria-haspopup":"dialog","aria-expanded":B.open,"aria-controls":B.contentId,"data-state":N0(B.open),...z,ref:$,onClick:df(_.onClick,B.onOpenToggle)})});$I.displayName=UI;var O0="DialogPortal",[JF,GI]=jI(O0,{forceMount:void 0}),qI=_=>{const{__scopeDialog:b,forceMount:I,children:z,container:B}=_,$=gu(O0,b);return H.jsx(JF,{scope:b,forceMount:I,children:Fe.Children.map(z,re=>H.jsx(_y,{present:I||$.open,children:H.jsx(PI,{asChild:!0,container:B,children:re})}))})};qI.displayName=O0;var Z_="DialogOverlay",HI=Fe.forwardRef((_,b)=>{const I=GI(Z_,_.__scopeDialog),{forceMount:z=I.forceMount,...B}=_,$=gu(Z_,_.__scopeDialog);return $.modal?H.jsx(_y,{present:z||$.open,children:H.jsx(eN,{...B,ref:b})}):null});HI.displayName=Z_;var QF=jx("DialogOverlay.RemoveScroll"),eN=Fe.forwardRef((_,b)=>{const{__scopeDialog:I,...z}=_,B=gu(Z_,I);return H.jsx(NI,{as:QF,allowPinchZoom:!0,shards:[B.contentRef],children:H.jsx(hh.div,{"data-state":N0(B.open),...z,ref:b,style:{pointerEvents:"auto",...z.style}})})}),dp="DialogContent",WI=Fe.forwardRef((_,b)=>{const I=GI(dp,_.__scopeDialog),{forceMount:z=I.forceMount,...B}=_,$=gu(dp,_.__scopeDialog);return H.jsx(_y,{present:z||$.open,children:$.modal?H.jsx(tN,{...B,ref:b}):H.jsx(rN,{...B,ref:b})})});WI.displayName=dp;var tN=Fe.forwardRef((_,b)=>{const I=gu(dp,_.__scopeDialog),z=Fe.useRef(null),B=mp(b,I.contentRef,z);return Fe.useEffect(()=>{const $=z.current;if($)return YF($)},[]),H.jsx(ZI,{..._,ref:B,trapFocus:I.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:df(_.onCloseAutoFocus,$=>{$.preventDefault(),I.triggerRef.current?.focus()}),onPointerDownOutside:df(_.onPointerDownOutside,$=>{const re=$.detail.originalEvent,s=re.button===0&&re.ctrlKey===!0;(re.button===2||s)&&$.preventDefault()}),onFocusOutside:df(_.onFocusOutside,$=>$.preventDefault())})}),rN=Fe.forwardRef((_,b)=>{const I=gu(dp,_.__scopeDialog),z=Fe.useRef(!1),B=Fe.useRef(!1);return H.jsx(ZI,{..._,ref:b,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:$=>{_.onCloseAutoFocus?.($),$.defaultPrevented||(z.current||I.triggerRef.current?.focus(),$.preventDefault()),z.current=!1,B.current=!1},onInteractOutside:$=>{_.onInteractOutside?.($),$.defaultPrevented||(z.current=!0,$.detail.originalEvent.type==="pointerdown"&&(B.current=!0));const re=$.target;I.triggerRef.current?.contains(re)&&$.preventDefault(),$.detail.originalEvent.type==="focusin"&&B.current&&$.preventDefault()}})}),ZI=Fe.forwardRef((_,b)=>{const{__scopeDialog:I,trapFocus:z,onOpenAutoFocus:B,onCloseAutoFocus:$,...re}=_,s=gu(dp,I),ce=Fe.useRef(null),be=mp(b,ce);return uF(),H.jsxs(H.Fragment,{children:[H.jsx(CI,{asChild:!0,loop:!0,trapped:z,onMountAutoFocus:B,onUnmountAutoFocus:$,children:H.jsx(II,{role:"dialog",id:s.contentId,"aria-describedby":s.descriptionId,"aria-labelledby":s.titleId,"data-state":N0(s.open),...re,ref:be,onDismiss:()=>s.onOpenChange(!1)})}),H.jsxs(H.Fragment,{children:[H.jsx(oN,{titleId:s.titleId}),H.jsx(lN,{contentRef:ce,descriptionId:s.descriptionId})]})]})}),F0="DialogTitle",nN=Fe.forwardRef((_,b)=>{const{__scopeDialog:I,...z}=_,B=gu(F0,I);return H.jsx(hh.h2,{id:B.titleId,...z,ref:b})});nN.displayName=F0;var XI="DialogDescription",iN=Fe.forwardRef((_,b)=>{const{__scopeDialog:I,...z}=_,B=gu(XI,I);return H.jsx(hh.p,{id:B.descriptionId,...z,ref:b})});iN.displayName=XI;var YI="DialogClose",sN=Fe.forwardRef((_,b)=>{const{__scopeDialog:I,...z}=_,B=gu(YI,I);return H.jsx(hh.button,{type:"button",...z,ref:b,onClick:df(_.onClick,()=>B.onOpenChange(!1))})});sN.displayName=YI;function N0(_){return _?"open":"closed"}var KI="DialogTitleWarning",[H5,JI]=DO(KI,{contentName:dp,titleName:F0,docsSlug:"dialog"}),oN=({titleId:_})=>{const b=JI(KI),I=`\`${b.contentName}\` requires a \`${b.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${b.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${b.docsSlug}`;return Fe.useEffect(()=>{_&&(document.getElementById(_)||console.error(I))},[I,_]),null},aN="DialogDescriptionWarning",lN=({contentRef:_,descriptionId:b})=>{const z=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${JI(aN).contentName}}.`;return Fe.useEffect(()=>{const B=_.current?.getAttribute("aria-describedby");b&&B&&(document.getElementById(b)||console.warn(z))},[z,_,b]),null},cN=VI,uN=$I,hN=qI,dN=HI,fN=WI;function pN(_){if(typeof document>"u")return;let b=document.head||document.getElementsByTagName("head")[0],I=document.createElement("style");I.type="text/css",b.appendChild(I),I.styleSheet?I.styleSheet.cssText=_:I.appendChild(document.createTextNode(_))}const QI=Nr.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),Dg=()=>{const _=Nr.useContext(QI);if(!_)throw new Error("useDrawerContext must be used within a Drawer.Root");return _};pN(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}`);function mN(){const _=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(_)&&/Mobile/.test(_)||/FxiOS/.test(_))}function gN(){return B0(/^Mac/)}function _N(){return B0(/^iPhone/)}function OT(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function yN(){return B0(/^iPad/)||gN()&&navigator.maxTouchPoints>1}function eA(){return _N()||yN()}function B0(_){return typeof window<"u"&&window.navigator!=null?_.test(window.navigator.platform):void 0}const vN=24,xN=typeof window<"u"?Fe.useLayoutEffect:Fe.useEffect;function FT(..._){return(...b)=>{for(let I of _)typeof I=="function"&&I(...b)}}const ax=typeof document<"u"&&window.visualViewport;function NT(_){let b=window.getComputedStyle(_);return/(auto|scroll)/.test(b.overflow+b.overflowX+b.overflowY)}function tA(_){for(NT(_)&&(_=_.parentElement);_&&!NT(_);)_=_.parentElement;return _||document.scrollingElement||document.documentElement}const wN=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let D_=0,lx;function bN(_={}){let{isDisabled:b}=_;xN(()=>{if(!b)return D_++,D_===1&&eA()&&(lx=TN()),()=>{D_--,D_===0&&lx?.()}},[b])}function TN(){let _,b=0,I=Me=>{_=tA(Me.target),!(_===document.documentElement&&_===document.body)&&(b=Me.changedTouches[0].pageY)},z=Me=>{if(!_||_===document.documentElement||_===document.body){Me.preventDefault();return}let tt=Me.changedTouches[0].pageY,wt=_.scrollTop,Xt=_.scrollHeight-_.clientHeight;Xt!==0&&((wt<=0&&tt>b||wt>=Xt&&tt<b)&&Me.preventDefault(),b=tt)},B=Me=>{let tt=Me.target;kx(tt)&&tt!==document.activeElement&&(Me.preventDefault(),tt.style.transform="translateY(-2000px)",tt.focus(),requestAnimationFrame(()=>{tt.style.transform=""}))},$=Me=>{let tt=Me.target;kx(tt)&&(tt.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{tt.style.transform="",ax&&(ax.height<window.innerHeight?requestAnimationFrame(()=>{BT(tt)}):ax.addEventListener("resize",()=>BT(tt),{once:!0}))}))},re=()=>{window.scrollTo(0,0)},s=window.pageXOffset,ce=window.pageYOffset,be=FT(SN(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let Se=FT(ag(document,"touchstart",I,{passive:!1,capture:!0}),ag(document,"touchmove",z,{passive:!1,capture:!0}),ag(document,"touchend",B,{passive:!1,capture:!0}),ag(document,"focus",$,!0),ag(window,"scroll",re));return()=>{be(),Se(),window.scrollTo(s,ce)}}function SN(_,b,I){let z=_.style[b];return _.style[b]=I,()=>{_.style[b]=z}}function ag(_,b,I,z){return _.addEventListener(b,I,z),()=>{_.removeEventListener(b,I,z)}}function BT(_){let b=document.scrollingElement||document.documentElement;for(;_&&_!==b;){let I=tA(_);if(I!==document.documentElement&&I!==document.body&&I!==_){let z=I.getBoundingClientRect().top,B=_.getBoundingClientRect().top,$=_.getBoundingClientRect().bottom;const re=I.getBoundingClientRect().bottom+vN;$>re&&(I.scrollTop+=B-z)}_=I.parentElement}}function kx(_){return _ instanceof HTMLInputElement&&!wN.has(_.type)||_ instanceof HTMLTextAreaElement||_ instanceof HTMLElement&&_.isContentEditable}function EN(_,b){typeof _=="function"?_(b):_!=null&&(_.current=b)}function IN(..._){return b=>_.forEach(I=>EN(I,b))}function rA(..._){return Fe.useCallback(IN(..._),_)}const nA=new WeakMap;function Ao(_,b,I=!1){if(!_||!(_ instanceof HTMLElement))return;let z={};Object.entries(b).forEach(([B,$])=>{if(B.startsWith("--")){_.style.setProperty(B,$);return}z[B]=_.style[B],_.style[B]=$}),!I&&nA.set(_,z)}function AN(_,b){if(!_||!(_ instanceof HTMLElement))return;let I=nA.get(_);I&&(_.style[b]=I[b])}const lo=_=>{switch(_){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return _}};function L_(_,b){if(!_)return null;const I=window.getComputedStyle(_),z=I.transform||I.webkitTransform||I.mozTransform;let B=z.match(/^matrix3d\((.+)\)$/);return B?parseFloat(B[1].split(", ")[lo(b)?13:12]):(B=z.match(/^matrix\((.+)\)$/),B?parseFloat(B[1].split(", ")[lo(b)?5:4]):null)}function CN(_){return 8*(Math.log(_+1)-2)}function cx(_,b){if(!_)return()=>{};const I=_.style.cssText;return Object.assign(_.style,b),()=>{_.style.cssText=I}}function MN(..._){return(...b)=>{for(const I of _)typeof I=="function"&&I(...b)}}const Rs={DURATION:.5,EASE:[.32,.72,0,1]},iA=.4,PN=.25,RN=100,sA=8,sp=16,Dx=26,ux="vaul-dragging";function oA(_){const b=Nr.useRef(_);return Nr.useEffect(()=>{b.current=_}),Nr.useMemo(()=>(...I)=>b.current==null?void 0:b.current.call(b,...I),[])}function zN({defaultProp:_,onChange:b}){const I=Nr.useState(_),[z]=I,B=Nr.useRef(z),$=oA(b);return Nr.useEffect(()=>{B.current!==z&&($(z),B.current=z)},[z,B,$]),I}function aA({prop:_,defaultProp:b,onChange:I=()=>{}}){const[z,B]=zN({defaultProp:b,onChange:I}),$=_!==void 0,re=$?_:z,s=oA(I),ce=Nr.useCallback(be=>{if($){const Me=typeof be=="function"?be(_):be;Me!==_&&s(Me)}else B(be)},[$,_,B,s]);return[re,ce]}function kN({activeSnapPointProp:_,setActiveSnapPointProp:b,snapPoints:I,drawerRef:z,overlayRef:B,fadeFromIndex:$,onSnapPointChange:re,direction:s="bottom",container:ce,snapToSequentialPoint:be}){const[Se,Me]=aA({prop:_,defaultProp:I?.[0],onChange:b}),[tt,wt]=Nr.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);Nr.useEffect(()=>{function Kt(){wt({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",Kt),()=>window.removeEventListener("resize",Kt)},[]);const Xt=Nr.useMemo(()=>Se===I?.[I.length-1]||null,[I,Se]),Be=Nr.useMemo(()=>{var Kt;return(Kt=I?.findIndex(Wt=>Wt===Se))!=null?Kt:null},[I,Se]),ct=I&&I.length>0&&($||$===0)&&!Number.isNaN($)&&I[$]===Se||!I,Tt=Nr.useMemo(()=>{const Kt=ce?{width:ce.getBoundingClientRect().width,height:ce.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var Wt;return(Wt=I?.map(Cr=>{const oi=typeof Cr=="string";let fn=0;if(oi&&(fn=parseInt(Cr,10)),lo(s)){const gr=oi?fn:tt?Cr*Kt.height:0;return tt?s==="bottom"?Kt.height-gr:-Kt.height+gr:gr}const ui=oi?fn:tt?Cr*Kt.width:0;return tt?s==="right"?Kt.width-ui:-Kt.width+ui:ui}))!=null?Wt:[]},[I,tt,ce]),Dt=Nr.useMemo(()=>Be!==null?Tt?.[Be]:null,[Tt,Be]),Vt=Nr.useCallback(Kt=>{var Wt;const Cr=(Wt=Tt?.findIndex(oi=>oi===Kt))!=null?Wt:null;re(Cr),Ao(z.current,{transition:`transform ${Rs.DURATION}s cubic-bezier(${Rs.EASE.join(",")})`,transform:lo(s)?`translate3d(0, ${Kt}px, 0)`:`translate3d(${Kt}px, 0, 0)`}),Tt&&Cr!==Tt.length-1&&$!==void 0&&Cr!==$&&Cr<$?Ao(B.current,{transition:`opacity ${Rs.DURATION}s cubic-bezier(${Rs.EASE.join(",")})`,opacity:"0"}):Ao(B.current,{transition:`opacity ${Rs.DURATION}s cubic-bezier(${Rs.EASE.join(",")})`,opacity:"1"}),Me(I?.[Math.max(Cr,0)])},[z.current,I,Tt,$,B,Me]);Nr.useEffect(()=>{if(Se||_){var Kt;const Wt=(Kt=I?.findIndex(Cr=>Cr===_||Cr===Se))!=null?Kt:-1;Tt&&Wt!==-1&&typeof Tt[Wt]=="number"&&Vt(Tt[Wt])}},[Se,_,I,Tt,Vt]);function jt({draggedDistance:Kt,closeDrawer:Wt,velocity:Cr,dismissible:oi}){if($===void 0)return;const fn=s==="bottom"||s==="right"?(Dt??0)-Kt:(Dt??0)+Kt,ui=Be===$-1,gr=Be===0,Mr=Kt>0;if(ui&&Ao(B.current,{transition:`opacity ${Rs.DURATION}s cubic-bezier(${Rs.EASE.join(",")})`}),!be&&Cr>2&&!Mr){oi?Wt():Vt(Tt[0]);return}if(!be&&Cr>2&&Mr&&Tt&&I){Vt(Tt[I.length-1]);return}const rn=Tt?.reduce((un,At)=>typeof un!="number"||typeof At!="number"?un:Math.abs(At-fn)<Math.abs(un-fn)?At:un),nn=lo(s)?window.innerHeight:window.innerWidth;if(Cr>iA&&Math.abs(Kt)<nn*.4){const un=Mr?1:-1;if(un>0&&Xt&&I){Vt(Tt[I.length-1]);return}if(gr&&un<0&&oi&&Wt(),Be===null)return;Vt(Tt[Be+un]);return}Vt(rn)}function vr({draggedDistance:Kt}){if(Dt===null)return;const Wt=s==="bottom"||s==="right"?Dt-Kt:Dt+Kt;(s==="bottom"||s==="right")&&Wt<Tt[Tt.length-1]||(s==="top"||s==="left")&&Wt>Tt[Tt.length-1]||Ao(z.current,{transform:lo(s)?`translate3d(0, ${Wt}px, 0)`:`translate3d(${Wt}px, 0, 0)`})}function hr(Kt,Wt){if(!I||typeof Be!="number"||!Tt||$===void 0)return null;const Cr=Be===$-1;if(Be>=$&&Wt)return 0;if(Cr&&!Wt)return 1;if(!ct&&!Cr)return null;const fn=Cr?Be+1:Be-1,ui=Cr?Tt[fn]-Tt[fn-1]:Tt[fn+1]-Tt[fn],gr=Kt/Math.abs(ui);return Cr?1-gr:gr}return{isLastSnapPoint:Xt,activeSnapPoint:Se,shouldFade:ct,getPercentageDragged:hr,setActiveSnapPoint:Me,activeSnapPointIndex:Be,onRelease:jt,onDrag:vr,snapPointsOffset:Tt}}const DN=()=>()=>{};function LN(){const{direction:_,isOpen:b,shouldScaleBackground:I,setBackgroundColorOnScale:z,noBodyStyles:B}=Dg(),$=Nr.useRef(null),re=Fe.useMemo(()=>document.body.style.backgroundColor,[]);function s(){return(window.innerWidth-Dx)/window.innerWidth}Nr.useEffect(()=>{if(b&&I){$.current&&clearTimeout($.current);const ce=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!ce)return;MN(z&&!B?cx(document.body,{background:"black"}):DN,cx(ce,{transformOrigin:lo(_)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${Rs.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Rs.EASE.join(",")})`}));const be=cx(ce,{borderRadius:`${sA}px`,overflow:"hidden",...lo(_)?{transform:`scale(${s()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${s()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{be(),$.current=window.setTimeout(()=>{re?document.body.style.background=re:document.body.style.removeProperty("background")},Rs.DURATION*1e3)}}},[b,I,re])}let lg=null;function ON({isOpen:_,modal:b,nested:I,hasBeenOpened:z,preventScrollRestoration:B,noBodyStyles:$}){const[re,s]=Nr.useState(()=>typeof window<"u"?window.location.href:""),ce=Nr.useRef(0),be=Nr.useCallback(()=>{if(OT()&&lg===null&&_&&!$){lg={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:Me,innerHeight:tt}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-ce.current}px`,left:`${-Me}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const wt=tt-window.innerHeight;wt&&ce.current>=tt&&(document.body.style.top=`${-(ce.current+wt)}px`)}),300)}},[_]),Se=Nr.useCallback(()=>{if(OT()&&lg!==null&&!$){const Me=-parseInt(document.body.style.top,10),tt=-parseInt(document.body.style.left,10);Object.assign(document.body.style,lg),window.requestAnimationFrame(()=>{if(B&&re!==window.location.href){s(window.location.href);return}window.scrollTo(tt,Me)}),lg=null}},[re]);return Nr.useEffect(()=>{function Me(){ce.current=window.scrollY}return Me(),window.addEventListener("scroll",Me),()=>{window.removeEventListener("scroll",Me)}},[]),Nr.useEffect(()=>{if(b)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||Se()}},[b,Se]),Nr.useEffect(()=>{I||!z||(_?(!window.matchMedia("(display-mode: standalone)").matches&&be(),b||window.setTimeout(()=>{Se()},500)):Se())},[_,z,re,b,I,be,Se]),{restorePositionSetting:Se}}function FN({open:_,onOpenChange:b,children:I,onDrag:z,onRelease:B,snapPoints:$,shouldScaleBackground:re=!1,setBackgroundColorOnScale:s=!0,closeThreshold:ce=PN,scrollLockTimeout:be=RN,dismissible:Se=!0,handleOnly:Me=!1,fadeFromIndex:tt=$&&$.length-1,activeSnapPoint:wt,setActiveSnapPoint:Xt,fixed:Be,modal:ct=!0,onClose:Tt,nested:Dt,noBodyStyles:Vt=!1,direction:jt="bottom",defaultOpen:vr=!1,disablePreventScroll:hr=!0,snapToSequentialPoint:Kt=!1,preventScrollRestoration:Wt=!1,repositionInputs:Cr=!0,onAnimationEnd:oi,container:fn,autoFocus:ui=!1}){var gr,Mr;const[rn=!1,nn]=aA({defaultProp:vr,prop:_,onChange:Qr=>{b?.(Qr),!Qr&&!Dt&&ks(),setTimeout(()=>{oi?.(Qr)},Rs.DURATION*1e3),Qr&&!ct&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),Qr||(document.body.style.pointerEvents="auto")}}),[un,At]=Nr.useState(!1),[Tr,Ht]=Nr.useState(!1),[rt,Ot]=Nr.useState(!1),Pr=Nr.useRef(null),Hr=Nr.useRef(null),br=Nr.useRef(null),Br=Nr.useRef(null),Sr=Nr.useRef(null),vn=Nr.useRef(!1),Ar=Nr.useRef(null),Pi=Nr.useRef(0),qi=Nr.useRef(!1),us=Nr.useRef(!vr),vi=Nr.useRef(0),xn=Nr.useRef(null),aa=Nr.useRef(((gr=xn.current)==null?void 0:gr.getBoundingClientRect().height)||0),hs=Nr.useRef(((Mr=xn.current)==null?void 0:Mr.getBoundingClientRect().width)||0),Ho=Nr.useRef(0),Ul=Nr.useCallback(Qr=>{$&&Qr===ho.length-1&&(Hr.current=new Date)},[]),{activeSnapPoint:ds,activeSnapPointIndex:Oi,setActiveSnapPoint:Zs,onRelease:la,snapPointsOffset:ho,onDrag:xs,shouldFade:Oa,getPercentageDragged:hl}=kN({snapPoints:$,activeSnapPointProp:wt,setActiveSnapPointProp:Xt,drawerRef:xn,fadeFromIndex:tt,overlayRef:Pr,onSnapPointChange:Ul,direction:jt,container:fn,snapToSequentialPoint:Kt});bN({isDisabled:!rn||Tr||!ct||rt||!un||!Cr||!hr});const{restorePositionSetting:ks}=ON({isOpen:rn,modal:ct,nested:Dt??!1,hasBeenOpened:un,preventScrollRestoration:Wt,noBodyStyles:Vt});function Wo(){return(window.innerWidth-Dx)/window.innerWidth}function ca(Qr){var Wn,In;!Se&&!$||xn.current&&!xn.current.contains(Qr.target)||(aa.current=((Wn=xn.current)==null?void 0:Wn.getBoundingClientRect().height)||0,hs.current=((In=xn.current)==null?void 0:In.getBoundingClientRect().width)||0,Ht(!0),br.current=new Date,eA()&&window.addEventListener("touchend",()=>vn.current=!1,{once:!0}),Qr.target.setPointerCapture(Qr.pointerId),Pi.current=lo(jt)?Qr.pageY:Qr.pageX)}function Zo(Qr,Wn){var In;let Nn=Qr;const Ri=(In=window.getSelection())==null?void 0:In.toString(),Wi=xn.current?L_(xn.current,jt):null,ft=new Date;if(Nn.tagName==="SELECT"||Nn.hasAttribute("data-vaul-no-drag")||Nn.closest("[data-vaul-no-drag]"))return!1;if(jt==="right"||jt==="left")return!0;if(Hr.current&&ft.getTime()-Hr.current.getTime()<500)return!1;if(Wi!==null&&(jt==="bottom"?Wi>0:Wi<0))return!0;if(Ri&&Ri.length>0)return!1;if(Sr.current&&ft.getTime()-Sr.current.getTime()<be&&Wi===0||Wn)return Sr.current=ft,!1;for(;Nn;){if(Nn.scrollHeight>Nn.clientHeight){if(Nn.scrollTop!==0)return Sr.current=new Date,!1;if(Nn.getAttribute("role")==="dialog")return!0}Nn=Nn.parentNode}return!0}function Hi(Qr){if(xn.current&&Tr){const Wn=jt==="bottom"||jt==="right"?1:-1,In=(Pi.current-(lo(jt)?Qr.pageY:Qr.pageX))*Wn,Nn=In>0,Ri=$&&!Se&&!Nn;if(Ri&&Oi===0)return;const Wi=Math.abs(In),ft=document.querySelector("[data-vaul-drawer-wrapper]"),ws=jt==="bottom"||jt==="top"?aa.current:hs.current;let Xs=Wi/ws;const fo=hl(Wi,Nn);if(fo!==null&&(Xs=fo),Ri&&Xs>=1||!vn.current&&!Zo(Qr.target,Nn))return;if(xn.current.classList.add(ux),vn.current=!0,Ao(xn.current,{transition:"none"}),Ao(Pr.current,{transition:"none"}),$&&xs({draggedDistance:In}),Nn&&!$){const Oe=CN(In),Y=Math.min(Oe*-1,0)*Wn;Ao(xn.current,{transform:lo(jt)?`translate3d(0, ${Y}px, 0)`:`translate3d(${Y}px, 0, 0)`});return}const en=1-Xs;if((Oa||tt&&Oi===tt-1)&&(z?.(Qr,Xs),Ao(Pr.current,{opacity:`${en}`,transition:"none"},!0)),ft&&Pr.current&&re){const Oe=Math.min(Wo()+Xs*(1-Wo()),1),Y=8-Xs*8,Q=Math.max(0,14-Xs*14);Ao(ft,{borderRadius:`${Y}px`,transform:lo(jt)?`scale(${Oe}) translate3d(0, ${Q}px, 0)`:`scale(${Oe}) translate3d(${Q}px, 0, 0)`,transition:"none"},!0)}if(!$){const Oe=Wi*Wn;Ao(xn.current,{transform:lo(jt)?`translate3d(0, ${Oe}px, 0)`:`translate3d(${Oe}px, 0, 0)`})}}}Nr.useEffect(()=>{window.requestAnimationFrame(()=>{us.current=!0})},[]),Nr.useEffect(()=>{var Qr;function Wn(){if(!xn.current||!Cr)return;const In=document.activeElement;if(kx(In)||qi.current){var Nn;const Ri=((Nn=window.visualViewport)==null?void 0:Nn.height)||0,Wi=window.innerHeight;let ft=Wi-Ri;const ws=xn.current.getBoundingClientRect().height||0,Xs=ws>Wi*.8;Ho.current||(Ho.current=ws);const fo=xn.current.getBoundingClientRect().top;if(Math.abs(vi.current-ft)>60&&(qi.current=!qi.current),$&&$.length>0&&ho&&Oi){const en=ho[Oi]||0;ft+=en}if(vi.current=ft,ws>Ri||qi.current){const en=xn.current.getBoundingClientRect().height;let Oe=en;en>Ri&&(Oe=Ri-(Xs?fo:Dx)),Be?xn.current.style.height=`${en-Math.max(ft,0)}px`:xn.current.style.height=`${Math.max(Oe,Ri-fo)}px`}else mN()||(xn.current.style.height=`${Ho.current}px`);$&&$.length>0&&!qi.current?xn.current.style.bottom="0px":xn.current.style.bottom=`${Math.max(ft,0)}px`}}return(Qr=window.visualViewport)==null||Qr.addEventListener("resize",Wn),()=>{var In;return(In=window.visualViewport)==null?void 0:In.removeEventListener("resize",Wn)}},[Oi,$,ho]);function Ds(Qr){ba(),Tt?.(),Qr||nn(!1),setTimeout(()=>{$&&Zs($[0])},Rs.DURATION*1e3)}function wa(){if(!xn.current)return;const Qr=document.querySelector("[data-vaul-drawer-wrapper]"),Wn=L_(xn.current,jt);Ao(xn.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${Rs.DURATION}s cubic-bezier(${Rs.EASE.join(",")})`}),Ao(Pr.current,{transition:`opacity ${Rs.DURATION}s cubic-bezier(${Rs.EASE.join(",")})`,opacity:"1"}),re&&Wn&&Wn>0&&rn&&Ao(Qr,{borderRadius:`${sA}px`,overflow:"hidden",...lo(jt)?{transform:`scale(${Wo()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Wo()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${Rs.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Rs.EASE.join(",")})`},!0)}function ba(){!Tr||!xn.current||(xn.current.classList.remove(ux),vn.current=!1,Ht(!1),Br.current=new Date)}function dl(Qr){if(!Tr||!xn.current)return;xn.current.classList.remove(ux),vn.current=!1,Ht(!1),Br.current=new Date;const Wn=L_(xn.current,jt);if(!Qr||!Zo(Qr.target,!1)||!Wn||Number.isNaN(Wn)||br.current===null)return;const In=Br.current.getTime()-br.current.getTime(),Nn=Pi.current-(lo(jt)?Qr.pageY:Qr.pageX),Ri=Math.abs(Nn)/In;if(Ri>.05&&(Ot(!0),setTimeout(()=>{Ot(!1)},200)),$){la({draggedDistance:Nn*(jt==="bottom"||jt==="right"?1:-1),closeDrawer:Ds,velocity:Ri,dismissible:Se}),B?.(Qr,!0);return}if(jt==="bottom"||jt==="right"?Nn>0:Nn<0){wa(),B?.(Qr,!0);return}if(Ri>iA){Ds(),B?.(Qr,!1);return}var Wi;const ft=Math.min((Wi=xn.current.getBoundingClientRect().height)!=null?Wi:0,window.innerHeight);var ws;const Xs=Math.min((ws=xn.current.getBoundingClientRect().width)!=null?ws:0,window.innerWidth),fo=jt==="left"||jt==="right";if(Math.abs(Wn)>=(fo?Xs:ft)*ce){Ds(),B?.(Qr,!1);return}B?.(Qr,!0),wa()}Nr.useEffect(()=>(rn&&(Ao(document.documentElement,{scrollBehavior:"auto"}),Hr.current=new Date),()=>{AN(document.documentElement,"scrollBehavior")}),[rn]);function ua(Qr){const Wn=Qr?(window.innerWidth-sp)/window.innerWidth:1,In=Qr?-sp:0;Ar.current&&window.clearTimeout(Ar.current),Ao(xn.current,{transition:`transform ${Rs.DURATION}s cubic-bezier(${Rs.EASE.join(",")})`,transform:lo(jt)?`scale(${Wn}) translate3d(0, ${In}px, 0)`:`scale(${Wn}) translate3d(${In}px, 0, 0)`}),!Qr&&xn.current&&(Ar.current=setTimeout(()=>{const Nn=L_(xn.current,jt);Ao(xn.current,{transition:"none",transform:lo(jt)?`translate3d(0, ${Nn}px, 0)`:`translate3d(${Nn}px, 0, 0)`})},500))}function Fa(Qr,Wn){if(Wn<0)return;const In=(window.innerWidth-sp)/window.innerWidth,Nn=In+Wn*(1-In),Ri=-sp+Wn*sp;Ao(xn.current,{transform:lo(jt)?`scale(${Nn}) translate3d(0, ${Ri}px, 0)`:`scale(${Nn}) translate3d(${Ri}px, 0, 0)`,transition:"none"})}function Un(Qr,Wn){const In=lo(jt)?window.innerHeight:window.innerWidth,Nn=Wn?(In-sp)/In:1,Ri=Wn?-sp:0;Wn&&Ao(xn.current,{transition:`transform ${Rs.DURATION}s cubic-bezier(${Rs.EASE.join(",")})`,transform:lo(jt)?`scale(${Nn}) translate3d(0, ${Ri}px, 0)`:`scale(${Nn}) translate3d(${Ri}px, 0, 0)`})}return Nr.useEffect(()=>{ct||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[ct]),Nr.createElement(cN,{defaultOpen:vr,onOpenChange:Qr=>{!Se&&!Qr||(Qr?At(!0):Ds(!0),nn(Qr))},open:rn},Nr.createElement(QI.Provider,{value:{activeSnapPoint:ds,snapPoints:$,setActiveSnapPoint:Zs,drawerRef:xn,overlayRef:Pr,onOpenChange:b,onPress:ca,onRelease:dl,onDrag:Hi,dismissible:Se,shouldAnimate:us,handleOnly:Me,isOpen:rn,isDragging:Tr,shouldFade:Oa,closeDrawer:Ds,onNestedDrag:Fa,onNestedOpenChange:ua,onNestedRelease:Un,keyboardIsOpen:qi,modal:ct,snapPointsOffset:ho,activeSnapPointIndex:Oi,direction:jt,shouldScaleBackground:re,setBackgroundColorOnScale:s,noBodyStyles:Vt,container:fn,autoFocus:ui}},I))}const lA=Nr.forwardRef(function({..._},b){const{overlayRef:I,snapPoints:z,onRelease:B,shouldFade:$,isOpen:re,modal:s,shouldAnimate:ce}=Dg(),be=rA(b,I),Se=z&&z.length>0;if(!s)return null;const Me=Nr.useCallback(tt=>B(tt),[B]);return Nr.createElement(dN,{onMouseUp:Me,ref:be,"data-vaul-overlay":"","data-vaul-snap-points":re&&Se?"true":"false","data-vaul-snap-points-overlay":re&&$?"true":"false","data-vaul-animate":ce?.current?"true":"false",..._})});lA.displayName="Drawer.Overlay";const cA=Nr.forwardRef(function({onPointerDownOutside:_,style:b,onOpenAutoFocus:I,...z},B){const{drawerRef:$,onPress:re,onRelease:s,onDrag:ce,keyboardIsOpen:be,snapPointsOffset:Se,activeSnapPointIndex:Me,modal:tt,isOpen:wt,direction:Xt,snapPoints:Be,container:ct,handleOnly:Tt,shouldAnimate:Dt,autoFocus:Vt}=Dg(),[jt,vr]=Nr.useState(!1),hr=rA(B,$),Kt=Nr.useRef(null),Wt=Nr.useRef(null),Cr=Nr.useRef(!1),oi=Be&&Be.length>0;LN();const fn=(gr,Mr,rn=0)=>{if(Cr.current)return!0;const nn=Math.abs(gr.y),un=Math.abs(gr.x),At=un>nn,Tr=["bottom","right"].includes(Mr)?1:-1;if(Mr==="left"||Mr==="right"){if(!(gr.x*Tr<0)&&un>=0&&un<=rn)return At}else if(!(gr.y*Tr<0)&&nn>=0&&nn<=rn)return!At;return Cr.current=!0,!0};Nr.useEffect(()=>{oi&&window.requestAnimationFrame(()=>{vr(!0)})},[]);function ui(gr){Kt.current=null,Cr.current=!1,s(gr)}return Nr.createElement(fN,{"data-vaul-drawer-direction":Xt,"data-vaul-drawer":"","data-vaul-delayed-snap-points":jt?"true":"false","data-vaul-snap-points":wt&&oi?"true":"false","data-vaul-custom-container":ct?"true":"false","data-vaul-animate":Dt?.current?"true":"false",...z,ref:hr,style:Se&&Se.length>0?{"--snap-point-height":`${Se[Me??0]}px`,...b}:b,onPointerDown:gr=>{Tt||(z.onPointerDown==null||z.onPointerDown.call(z,gr),Kt.current={x:gr.pageX,y:gr.pageY},re(gr))},onOpenAutoFocus:gr=>{I?.(gr),Vt||gr.preventDefault()},onPointerDownOutside:gr=>{if(_?.(gr),!tt||gr.defaultPrevented){gr.preventDefault();return}be.current&&(be.current=!1)},onFocusOutside:gr=>{if(!tt){gr.preventDefault();return}},onPointerMove:gr=>{if(Wt.current=gr,Tt||(z.onPointerMove==null||z.onPointerMove.call(z,gr),!Kt.current))return;const Mr=gr.pageY-Kt.current.y,rn=gr.pageX-Kt.current.x,nn=gr.pointerType==="touch"?10:2;fn({x:rn,y:Mr},Xt,nn)?ce(gr):(Math.abs(rn)>nn||Math.abs(Mr)>nn)&&(Kt.current=null)},onPointerUp:gr=>{z.onPointerUp==null||z.onPointerUp.call(z,gr),Kt.current=null,Cr.current=!1,s(gr)},onPointerOut:gr=>{z.onPointerOut==null||z.onPointerOut.call(z,gr),ui(Wt.current)},onContextMenu:gr=>{z.onContextMenu==null||z.onContextMenu.call(z,gr),Wt.current&&ui(Wt.current)}})});cA.displayName="Drawer.Content";const NN=250,BN=120,jN=Nr.forwardRef(function({preventCycle:_=!1,children:b,...I},z){const{closeDrawer:B,isDragging:$,snapPoints:re,activeSnapPoint:s,setActiveSnapPoint:ce,dismissible:be,handleOnly:Se,isOpen:Me,onPress:tt,onDrag:wt}=Dg(),Xt=Nr.useRef(null),Be=Nr.useRef(!1);function ct(){if(Be.current){Vt();return}window.setTimeout(()=>{Tt()},BN)}function Tt(){if($||_||Be.current){Vt();return}if(Vt(),!re||re.length===0){be||B();return}if(s===re[re.length-1]&&be){B();return}const vr=re.findIndex(Kt=>Kt===s);if(vr===-1)return;const hr=re[vr+1];ce(hr)}function Dt(){Xt.current=window.setTimeout(()=>{Be.current=!0},NN)}function Vt(){Xt.current&&window.clearTimeout(Xt.current),Be.current=!1}return Nr.createElement("div",{onClick:ct,onPointerCancel:Vt,onPointerDown:jt=>{Se&&tt(jt),Dt()},onPointerMove:jt=>{Se&&wt(jt)},ref:z,"data-vaul-drawer-visible":Me?"true":"false","data-vaul-handle":"","aria-hidden":"true",...I},Nr.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},b))});jN.displayName="Drawer.Handle";function VN(_){const b=Dg(),{container:I=b.container,...z}=_;return Nr.createElement(hN,{container:I,...z})}const cg={Root:FN,Content:cA,Overlay:lA,Trigger:uN,Portal:VN};function UN({children:_,trigger:b,open:I,setOpen:z}){return H.jsxs(cg.Root,{open:I,onOpenChange:z,children:[H.jsx(cg.Trigger,{asChild:!0,children:b}),H.jsxs(cg.Portal,{children:[H.jsx(cg.Overlay,{className:"fixed inset-0 bg-black/20"}),H.jsx(cg.Content,{className:"h-auto max-h-[80%] fixed bottom-0 left-0 right-0 outline-none flex flex-col",children:H.jsxs("div",{className:"flex-1 overflow-y-auto p-6 bg-white rounded-t-3xl text-md relative pb-12 flex flex-col gap-2",children:[H.jsx("div",{className:"flex w-9 h-[5px] rounded-full bg-gray-400/80 mx-auto top-1 absolute left-1/2 -translate-x-1/2"}),_]})})]})]})}function $N({setCurrentView:_}){return H.jsxs(H.Fragment,{children:[H.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[H.jsx("div",{className:"size-20 bg-gray-100 rounded-full flex items-center justify-center overflow-hidden",children:H.jsx("img",{src:"./images/scooter-light.png",className:"size-full object-cover"})}),H.jsxs("div",{className:"flex flex-col gap-0",children:[H.jsx("h2",{className:"text-2xl font-bold",children:"Ninebot SL"}),H.jsxs("div",{className:"flex items-center gap-2",children:[H.jsx($x,{className:"size-4 text-gray-500"}),H.jsx("p",{className:"text-gray-500 text-md",children:"480-777"})]}),H.jsxs("div",{className:"flex items-center gap-2 mt-1.5",children:[H.jsxs("div",{className:"flex items-center gap-px",children:[H.jsx("div",{className:"w-2 h-3.5 bg-emerald-400 rounded-sm rounded-r-none"}),H.jsx("div",{className:"w-2 h-3.5 bg-emerald-400"}),H.jsx("div",{className:"w-2 h-3.5 bg-emerald-400 rounded-l-none rounded-sm"}),H.jsx("div",{className:"w-px h-2 bg-emerald-400 rounded-sm"})]}),H.jsx("span",{className:"text-gray-500 text-sm",children:"≈ на 3 часа 10 минут • 2 км"})]})]})]}),H.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[H.jsxs("div",{onClick:()=>{_("wallet")},className:"bg-gray-100 rounded-2xl p-6 aspect-square font-semibold leading-tight flex flex-col justify-between gap-2",children:[H.jsx("div",{className:"size-8 bg-gray-400/80 rounded-full flex items-center justify-center",children:H.jsx(gx,{className:"size-6 text-white"})}),H.jsx("h3",{children:"Кошелек"})]}),H.jsxs("div",{className:"bg-gray-100 rounded-2xl p-6 aspect-square font-semibold leading-tight flex flex-col justify-between gap-2",children:[H.jsx("div",{className:"size-8 bg-gray-400/80 rounded-full flex items-center justify-center",children:H.jsx(Lz,{className:"size-6 text-white"})}),H.jsx("h3",{children:"Промокоды и скидки"})]})]}),H.jsxs("div",{className:"flex gap-2 w-full",children:[H.jsx(ts,{className:"bg-blue-500 hover:bg-blue-600 text-white py-4 h-14 rounded-xl flex-1",onClick:()=>{_("payment")},children:H.jsxs("div",{className:"text-center",children:[H.jsx("div",{className:"text-sm font-bold",children:"Поминутный"}),H.jsx("div",{className:"text-xs",children:"50 ₽ • 5 ₽/мин"})]})}),H.jsx(ts,{className:"bg-blue-500 hover:bg-blue-600 text-white py-4 h-14 rounded-xl flex-1",onClick:()=>{_("payment")},children:H.jsxs("div",{className:"text-center",children:[H.jsx("div",{className:"text-sm font-bold",children:"На 1 час"}),H.jsx("div",{className:"text-xs",children:"399 ₽"})]})})]}),H.jsx(ts,{variant:"outline",className:"py-4 h-14 rounded-xl bg-transparent",onClick:()=>{_("payment")},children:H.jsxs("div",{className:"text-center",children:[H.jsx("div",{className:"text-sm font-bold",children:"Забронировать"}),H.jsx("div",{className:"text-xs text-gray-500",children:"Бесплатно"})]})}),H.jsxs("button",{onClick:()=>{_("eco")},className:"bg-green-500 hover:bg-green-600 text-white px-6 py-3 h-14 rounded-2xl flex items-center justify-center gap-3 font-medium text-lg shadow-lg active:scale-95 transition-all text-nowrap",children:[H.jsx(K_,{className:"w-5 h-5"}),"Эко-трекер"]})]})}const Bi=Fe.forwardRef(({className:_,...b},I)=>H.jsx("div",{ref:I,className:od("rounded-lg border bg-card text-card-foreground shadow-sm",_),...b}));Bi.displayName="Card";const GN=Fe.forwardRef(({className:_,...b},I)=>H.jsx("div",{ref:I,className:od("flex flex-col space-y-1.5 p-6",_),...b}));GN.displayName="CardHeader";const qN=Fe.forwardRef(({className:_,...b},I)=>H.jsx("div",{ref:I,className:od("text-2xl font-semibold leading-none tracking-tight",_),...b}));qN.displayName="CardTitle";const HN=Fe.forwardRef(({className:_,...b},I)=>H.jsx("div",{ref:I,className:od("text-sm text-muted-foreground",_),...b}));HN.displayName="CardDescription";const ji=Fe.forwardRef(({className:_,...b},I)=>H.jsx("div",{ref:I,className:od("p-6 pt-0",_),...b}));ji.displayName="CardContent";const WN=Fe.forwardRef(({className:_,...b},I)=>H.jsx("div",{ref:I,className:od("flex items-center p-6 pt-0",_),...b}));WN.displayName="CardFooter";function ZN({setCurrentView:_}){return H.jsxs("div",{children:[H.jsx("div",{className:"px-4 mb-6",children:H.jsx(Bi,{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-green-200 overflow-hidden",children:H.jsxs(ji,{className:"p-6 text-center relative",children:[H.jsx("div",{className:"absolute top-2 right-2",children:H.jsx("span",{className:"bg-green-500 text-white text-xs px-2 py-1 rounded-full",children:"НОВОЕ"})}),H.jsxs("div",{className:"mb-4",children:[H.jsx(K_,{className:"w-16 h-16 text-green-600 mx-auto mb-2"}),H.jsx("h2",{className:"text-4xl font-bold text-green-700 mb-1",children:"10 кг"}),H.jsx("p",{className:"text-green-600 font-medium",children:"CO₂ сэкономлено"})]}),H.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[H.jsxs("div",{className:"text-center",children:[H.jsx("div",{className:"font-bold text-gray-800",children:"10 км"}),H.jsx("div",{className:"text-gray-600",children:"Пройдено"})]}),H.jsxs("div",{className:"text-center",children:[H.jsx("div",{className:"font-bold text-gray-800",children:"🌳 2.4"}),H.jsx("div",{className:"text-gray-600",children:"Деревьев спасено"})]})]})]})})}),H.jsxs("div",{className:"px-4 mb-6",children:[H.jsxs("h3",{className:"font-semibold mb-3 flex items-center",children:[H.jsx(mS,{className:"w-5 h-5 mr-2 text-blue-500"}),"Поделиться в Telegram"]}),H.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[H.jsxs(ts,{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-xl h-auto flex flex-col items-center",children:[H.jsx("div",{className:"text-2xl mb-1",children:"📱"}),H.jsx("div",{className:"text-sm font-medium",children:"Stories"})]}),H.jsxs(ts,{className:"bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl h-auto flex flex-col items-center",children:[H.jsx("div",{className:"text-2xl mb-1",children:"📢"}),H.jsx("div",{className:"text-sm font-medium",children:"Канал"})]})]})]}),H.jsxs("div",{className:"px-4 mb-6",children:[H.jsx("h3",{className:"font-semibold mb-3",children:"Статистика поездок"}),H.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[H.jsx(Bi,{children:H.jsxs(ji,{className:"p-4 text-center",children:[H.jsx("div",{className:"text-2xl font-bold text-blue-600",children:"23"}),H.jsx("div",{className:"text-sm text-gray-600",children:"Поездки"})]})}),H.jsx(Bi,{children:H.jsxs(ji,{className:"p-4 text-center",children:[H.jsx("div",{className:"text-2xl font-bold text-purple-600",children:"2ч 15м"}),H.jsx("div",{className:"text-sm text-gray-600",children:"Время в пути"})]})})]})]}),H.jsx("div",{className:"px-4 mb-6",children:H.jsx(ts,{onClick:()=>{_("history")},className:"w-full py-4 rounded-xl bg-gradient-to-r from-purple-500 to-pink-500 text-white font-medium",children:"📊 Подробная история поездок"})}),H.jsx("div",{className:"px-4 mb-6",children:H.jsx(Bi,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200",children:H.jsxs(ji,{className:"p-4",children:[H.jsxs("div",{className:"flex items-center justify-between mb-3",children:[H.jsxs("h4",{className:"font-semibold text-blue-800 flex items-center",children:[H.jsx(ok,{className:"w-5 h-5 mr-2"}),"Друзья в Telegram"]}),H.jsx(ts,{variant:"ghost",size:"sm",className:"text-blue-600",children:"Пригласить"})]}),H.jsxs("div",{className:"flex -space-x-2 mb-3",children:[[1,2,3].map(b=>H.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full border-2 border-white flex items-center justify-center text-white text-xs font-bold",children:String.fromCharCode(65+b)},b)),H.jsx("div",{className:"w-8 h-8 bg-gray-300 rounded-full border-2 border-white flex items-center justify-center text-gray-600 text-xs",children:"+5"})]}),H.jsx("p",{className:"text-sm text-blue-700",children:"8 друзей уже экономят CO₂! Пригласите еще и получите бонусы 🎁"})]})})}),H.jsx("div",{className:"px-4 mb-6",children:H.jsx(Bi,{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-green-200",children:H.jsxs(ji,{className:"p-4",children:[H.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"🌍 Ваш вклад"}),H.jsxs("div",{className:"space-y-2 text-sm",children:[H.jsxs("div",{className:"flex justify-between",children:[H.jsx("span",{className:"text-green-700",children:"Эквивалент посаженных деревьев:"}),H.jsx("span",{className:"font-bold",children:"2.4 🌳"})]}),H.jsxs("div",{className:"flex justify-between",children:[H.jsx("span",{className:"text-green-700",children:"Сэкономлено бензина:"}),H.jsx("span",{className:"font-bold",children:"4.2 л ⛽"})]}),H.jsxs("div",{className:"flex justify-between",children:[H.jsx("span",{className:"text-green-700",children:"Чистый воздух для:"}),H.jsx("span",{className:"font-bold",children:"12 человек 💨"})]})]})]})})})]})}function XN({walletBalance:_,paymentHistory:b}){const I=[100,300,500,1e3,2e3,5e3],z=$=>{switch($){case"completed":return H.jsx(Iz,{className:"w-4 h-4 text-green-500"});case"pending":return H.jsx(U_,{className:"w-4 h-4 text-yellow-500"});case"failed":return H.jsx(Cz,{className:"w-4 h-4 text-red-500"});default:return H.jsx(U_,{className:"w-4 h-4 text-gray-500"})}},B=$=>{switch($){case"topup":return H.jsx(vz,{className:"w-4 h-4 text-green-500"});case"ride":return H.jsx(U2,{className:"w-4 h-4 text-blue-500"});default:return H.jsx(U2,{className:"w-4 h-4 text-gray-500"})}};return H.jsxs("div",{className:"max-w-sm mx-auto min-h-screen",children:[H.jsxs("div",{className:"px-4 py-6",children:[H.jsxs("h1",{className:"text-2xl font-bold mb-2 flex items-center",children:[H.jsx(gx,{className:"w-7 h-7 mr-3 text-blue-500"}),"Кошелек"]}),H.jsx("p",{className:"text-sm opacity-70",children:"Управление балансом и платежами"})]}),H.jsx("div",{className:"px-4 mb-6",children:H.jsx(Bi,{className:"bg-gradient-to-br from-blue-500 to-purple-600 text-white",children:H.jsxs(ji,{className:"p-6 text-center",children:[H.jsxs("div",{className:"mb-4",children:[H.jsx(gx,{className:"w-12 h-12 mx-auto mb-3 opacity-80"}),H.jsxs("h2",{className:"text-4xl font-bold mb-1",children:[_," ₽"]}),H.jsx("p",{className:"opacity-80",children:"Доступный баланс"})]}),H.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[H.jsxs("div",{className:"text-center",children:[H.jsx("div",{className:"font-bold",children:b.filter($=>$.type==="ride").length}),H.jsx("div",{className:"opacity-80",children:"Поездок оплачено"})]}),H.jsxs("div",{className:"text-center",children:[H.jsxs("div",{className:"font-bold",children:[b.filter($=>$.type==="topup").reduce(($,re)=>$+re.amount,0)," ","₽"]}),H.jsx("div",{className:"opacity-80",children:"Всего пополнено"})]})]})]})})}),H.jsxs("div",{className:"px-4 mb-6",children:[H.jsxs("h3",{className:"font-semibold mb-3 flex items-center",children:[H.jsx(_S,{className:"w-5 h-5 mr-2 text-green-500"}),"Пополнить кошелек"]}),H.jsx("div",{className:"grid grid-cols-3 gap-2",children:I.map($=>H.jsx(ts,{variant:"outline",className:"py-3 rounded-xl bg-gradient-to-br from-green-50 to-emerald-50 border-green-200 hover:from-green-100 hover:to-emerald-100",children:H.jsxs("div",{className:"text-center",children:[H.jsxs("div",{className:"font-bold text-green-700",children:[$," ₽"]}),$>=1e3&&H.jsxs("div",{className:"text-xs text-green-600",children:["+",Math.floor($*.05)," ₽"]})]})},$))}),H.jsx(Bi,{className:"mt-3 bg-green-50 border-green-200",children:H.jsx(ji,{className:"p-3",children:H.jsxs("div",{className:"flex items-center text-sm text-green-800",children:[H.jsx("div",{className:"text-lg mr-2",children:"🎁"}),H.jsxs("div",{children:[H.jsx("span",{className:"font-semibold",children:"Бонус при пополнении:"}),H.jsx("br",{}),H.jsx("span",{children:"От 1000 ₽ — +5% к балансу"})]})]})})})]}),H.jsxs("div",{className:"px-4 mb-6",children:[H.jsx("h3",{className:"font-semibold mb-3",children:"Способы пополнения"}),H.jsxs("div",{className:"space-y-2",children:[H.jsx(Bi,{className:"bg-blue-50 border-blue-200",children:H.jsx(ji,{className:"p-3",children:H.jsxs("div",{className:"flex items-center text-sm text-blue-800",children:[H.jsx("div",{className:"text-lg mr-3",children:"💳"}),H.jsxs("div",{children:[H.jsx("div",{className:"font-semibold",children:"Telegram Payments"}),H.jsx("div",{className:"text-xs",children:"Карты, Apple Pay, Google Pay"})]})]})})}),H.jsx(Bi,{className:"bg-purple-50 border-purple-200",children:H.jsx(ji,{className:"p-3",children:H.jsxs("div",{className:"flex items-center text-sm text-purple-800",children:[H.jsx("div",{className:"text-lg mr-3",children:"⭐"}),H.jsxs("div",{children:[H.jsx("div",{className:"font-semibold",children:"Telegram Stars"}),H.jsx("div",{className:"text-xs",children:"Оплата через Telegram Stars"})]})]})})})]})]}),H.jsxs("div",{className:"px-4 mb-6",children:[H.jsx("h3",{className:"font-semibold mb-3",children:"История операций"}),H.jsx("div",{className:"space-y-3",children:b.slice(0,10).map($=>H.jsx(Bi,{className:"hover:shadow-sm transition-shadow",children:H.jsx(ji,{className:"p-4",children:H.jsxs("div",{className:"flex items-center justify-between",children:[H.jsxs("div",{className:"flex items-center",children:[H.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center mr-3",children:B($.type)}),H.jsxs("div",{children:[H.jsx("div",{className:"font-semibold text-sm",children:$.description}),H.jsxs("div",{className:"text-xs text-gray-500",children:[$.date," • ",$.time]})]})]}),H.jsxs("div",{className:"text-right",children:[H.jsxs("div",{className:`font-bold ${$.type==="topup"?"text-green-600":"text-red-600"}`,children:[$.type==="topup"?"+":"-",$.amount," ₽"]}),H.jsxs("div",{className:"flex items-center justify-end",children:[z($.status),H.jsx("span",{className:"text-xs text-gray-500 ml-1 capitalize",children:$.status==="completed"?"Завершено":$.status==="pending"?"В обработке":"Ошибка"})]})]})]})})},$.id))}),b.length>10&&H.jsx(ts,{variant:"outline",className:"w-full mt-3 bg-transparent",children:"Показать все операции"})]}),H.jsx("div",{className:"px-4 pb-6",children:H.jsx(Bi,{className:"bg-gradient-to-r from-orange-50 to-yellow-50 border-orange-200",children:H.jsxs(ji,{className:"p-4",children:[H.jsx("h4",{className:"font-semibold text-orange-800 mb-2 flex items-center",children:"🔄 Автопополнение"}),H.jsx("p",{className:"text-sm text-orange-700 mb-3",children:"Автоматически пополняйте кошелек, когда баланс становится меньше 100 ₽"}),H.jsx(ts,{variant:"outline",className:"w-full bg-transparent border-orange-300 text-orange-700",children:"Настроить автопополнение"})]})})})]})}function YN(){const[_]=Fe.useState([{id:1,date:"2024-06-30",time:"14:30",distance:3.2,duration:"18 мин",startLocation:"ул. Тверская, 15",endLocation:"Красная площадь",cost:89,scooterId:"Unit 05",co2Saved:.64},{id:2,date:"2024-06-29",time:"09:15",distance:5.8,duration:"32 мин",startLocation:"Парк Горького",endLocation:"ТЦ Атриум",cost:156,scooterId:"Unit 12",co2Saved:1.16},{id:3,date:"2024-06-28",time:"19:45",distance:2.1,duration:"12 мин",startLocation:"Метро Сокольники",endLocation:"ул. Русаковская, 23",cost:67,scooterId:"Unit 08",co2Saved:.42},{id:4,date:"2024-06-27",time:"16:20",distance:4.5,duration:"25 мин",startLocation:"ВДНХ",endLocation:"Ботанический сад",cost:125,scooterId:"Unit 03",co2Saved:.9},{id:5,date:"2024-06-26",time:"11:00",distance:6.2,duration:"35 мин",startLocation:"Арбат",endLocation:"Воробьевы горы",cost:178,scooterId:"Unit 15",co2Saved:1.24}]),b=_.length,I=_.reduce((Se,Me)=>Se+Me.distance,0),z=_.reduce((Se,Me)=>Se+Me.co2Saved,0),B=I/b,$=_.reduce((Se,Me)=>{const tt=Me.date;return Se[tt]||(Se[tt]=[]),Se[tt].push(Me),Se},{}),[re,s]=Fe.useState("all"),[ce,be]=Fe.useState(!1);return H.jsxs("div",{className:"max-w-sm mx-auto min-h-screen",children:[H.jsxs("div",{className:"px-4 py-6",children:[H.jsxs("div",{className:"flex justify-between items-center mb-2",children:[H.jsx("h1",{className:"text-2xl font-bold",children:"История поездок"}),H.jsx(ts,{variant:"ghost",size:"sm",onClick:()=>be(!ce),className:"text-blue-600",children:"📊"})]}),H.jsx("p",{className:"text-sm opacity-70",children:"Детализация ваших эко-поездок"})]}),H.jsx("div",{className:"px-4 mb-6",children:H.jsx(Bi,{className:"bg-gradient-to-br from-blue-50 via-green-50 to-emerald-50 border-green-200",children:H.jsxs(ji,{className:"p-4",children:[H.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[H.jsxs("div",{className:"text-center",children:[H.jsx("div",{className:"text-3xl font-bold text-blue-600",children:b}),H.jsx("div",{className:"text-sm text-gray-600",children:"Поездок"})]}),H.jsxs("div",{className:"text-center",children:[H.jsxs("div",{className:"text-3xl font-bold text-green-600",children:[z.toFixed(1)," кг"]}),H.jsx("div",{className:"text-sm text-gray-600",children:"CO₂ сэкономлено"})]})]}),H.jsxs("div",{className:"mb-4",children:[H.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[H.jsx("span",{className:"text-gray-600",children:"Прогресс к цели (10 кг CO₂)"}),H.jsxs("span",{className:"text-green-600",children:[(z/10*100).toFixed(0),"%"]})]}),H.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:H.jsx("div",{className:"bg-gradient-to-r from-green-400 to-emerald-500 h-2 rounded-full transition-all duration-500",style:{width:`${Math.min(z/10*100,100)}%`}})})]}),H.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[H.jsxs("div",{className:"text-center",children:[H.jsxs("div",{className:"text-lg font-bold text-purple-600",children:[I.toFixed(1)," км"]}),H.jsx("div",{className:"text-xs text-gray-600",children:"Общий путь"})]}),H.jsxs("div",{className:"text-center",children:[H.jsxs("div",{className:"text-lg font-bold text-orange-600",children:[B.toFixed(1)," км"]}),H.jsx("div",{className:"text-xs text-gray-600",children:"Средняя поездка"})]})]})]})})}),H.jsxs("div",{className:"px-4 mb-6",children:[H.jsxs("h3",{className:"font-semibold mb-3 flex items-center",children:["🏆 Достижения в Telegram",H.jsx("span",{className:"ml-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full",children:"2"})]}),H.jsxs("div",{className:"flex gap-3 overflow-x-auto pb-2",children:[H.jsx(Bi,{className:"min-w-[120px] bg-gradient-to-br from-yellow-50 to-orange-50 border-yellow-200",children:H.jsxs(ji,{className:"p-3 text-center",children:[H.jsx("div",{className:"text-2xl mb-1",children:"🌱"}),H.jsx("div",{className:"text-xs font-semibold",children:"Эко-новичок"}),H.jsx("div",{className:"text-xs text-gray-600",children:"5+ поездок"}),H.jsx(ts,{size:"sm",className:"mt-2 text-xs bg-blue-500 text-white",children:"Поделиться"})]})}),H.jsx(Bi,{className:"min-w-[120px] bg-gradient-to-br from-green-50 to-emerald-50 border-green-200",children:H.jsxs(ji,{className:"p-3 text-center",children:[H.jsx("div",{className:"text-2xl mb-1",children:"🚀"}),H.jsx("div",{className:"text-xs font-semibold",children:"Скоростной"}),H.jsx("div",{className:"text-xs text-gray-600",children:"20+ км/ч"}),H.jsx(ts,{size:"sm",className:"mt-2 text-xs bg-blue-500 text-white",children:"Поделиться"})]})}),H.jsx(Bi,{className:"min-w-[120px] border-dashed border-gray-300",children:H.jsxs(ji,{className:"p-3 text-center",children:[H.jsx("div",{className:"text-2xl mb-1 opacity-50",children:"🌍"}),H.jsx("div",{className:"text-xs font-semibold opacity-50",children:"Эко-герой"}),H.jsx("div",{className:"text-xs text-gray-400",children:"10 кг CO₂"}),H.jsx("div",{className:"text-xs text-blue-500 mt-2",children:"Скоро!"})]})})]})]}),H.jsx("div",{className:"px-4 mb-4",children:H.jsx("div",{className:"flex gap-2 overflow-x-auto",children:["all","today","week","month"].map(Se=>H.jsxs(ts,{variant:re===Se?"default":"outline",size:"sm",className:`whitespace-nowrap ${re===Se?"bg-blue-500 text-white":"bg-transparent"}`,onClick:()=>{s(Se)},children:[Se==="all"&&"Все",Se==="today"&&"Сегодня",Se==="week"&&"Неделя",Se==="month"&&"Месяц"]},Se))})}),ce&&H.jsx("div",{className:"px-4 mb-4",children:H.jsx(Bi,{className:"bg-gradient-to-r from-purple-50 to-pink-50 border-purple-200",children:H.jsxs(ji,{className:"p-4",children:[H.jsx("h4",{className:"font-semibold mb-3 text-purple-800",children:"📈 Статистика недели"}),H.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center text-sm",children:[H.jsxs("div",{children:[H.jsx("div",{className:"font-bold text-purple-600",children:"3"}),H.jsx("div",{className:"text-xs text-gray-600",children:"Поездки"})]}),H.jsxs("div",{children:[H.jsx("div",{className:"font-bold text-green-600",children:"2.2 кг"}),H.jsx("div",{className:"text-xs text-gray-600",children:"CO₂ за неделю"})]}),H.jsxs("div",{children:[H.jsx("div",{className:"font-bold text-blue-600",children:"+15%"}),H.jsx("div",{className:"text-xs text-gray-600",children:"Рост активности"})]})]}),H.jsxs("div",{className:"mt-3",children:[H.jsx("div",{className:"flex items-end justify-between h-16 gap-1",children:[.3,.8,.5,.9,.4,.7,1].map((Se,Me)=>H.jsx("div",{className:"bg-gradient-to-t from-purple-400 to-purple-600 rounded-t flex-1 transition-all duration-500",style:{height:`${Se*100}%`}},Me))}),H.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[H.jsx("span",{children:"Пн"}),H.jsx("span",{children:"Вт"}),H.jsx("span",{children:"Ср"}),H.jsx("span",{children:"Чт"}),H.jsx("span",{children:"Пт"}),H.jsx("span",{children:"Сб"}),H.jsx("span",{children:"Вс"})]})]}),H.jsxs(ts,{className:"w-full mt-3 bg-blue-500 text-white",children:[H.jsx(Xz,{className:"w-4 h-4 mr-2"}),"Поделиться прогрессом"]})]})})}),H.jsx("div",{className:"px-4 space-y-4 pb-6",children:Object.entries($).map(([Se,Me])=>{const tt=Me.reduce((wt,Xt)=>wt+Xt.co2Saved,0);return H.jsxs("div",{children:[H.jsxs("div",{className:"flex justify-between items-center mb-3 px-2",children:[H.jsx("h3",{className:"font-semibold text-gray-800",children:Se}),H.jsxs("div",{className:"text-sm text-gray-500",children:[Me.length," поездок • -",tt.toFixed(1)," кг CO₂"]})]}),H.jsx("div",{className:"space-y-3",children:Me.map(wt=>H.jsx(Bi,{className:"border-l-4 border-l-green-500 hover:shadow-md transition-shadow",children:H.jsxs(ji,{className:"p-4",children:[H.jsxs("div",{className:"flex justify-between items-start mb-3",children:[H.jsxs("div",{className:"flex items-center",children:[H.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-100 to-green-100 rounded-full flex items-center justify-center mr-3",children:H.jsx("span",{className:"text-lg",children:"🛴"})}),H.jsxs("div",{children:[H.jsx("div",{className:"font-semibold text-gray-800",children:wt.time}),H.jsx("div",{className:"text-sm text-gray-500",children:wt.scooterId})]})]}),H.jsxs("div",{className:"text-right",children:[H.jsxs("div",{className:"font-bold text-green-600 flex items-center",children:[H.jsx(K_,{className:"w-4 h-4 mr-1"}),"-",wt.co2Saved," кг"]}),H.jsxs("div",{className:"text-sm text-gray-500",children:[wt.cost," ₽"]})]})]}),H.jsxs("div",{className:"space-y-2 mb-3",children:[H.jsxs("div",{className:"flex items-center text-sm",children:[H.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),H.jsx("span",{className:"text-gray-600 flex-1 truncate",children:wt.startLocation})]}),H.jsxs("div",{className:"flex items-center text-sm",children:[H.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-2"}),H.jsx("span",{className:"text-gray-600 flex-1 truncate",children:wt.endLocation})]})]}),H.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center text-sm bg-gray-50 rounded-lg p-2 mb-3",children:[H.jsxs("div",{children:[H.jsxs("div",{className:"font-bold text-blue-600",children:[wt.distance," км"]}),H.jsx("div",{className:"text-xs text-gray-500",children:"Расстояние"})]}),H.jsxs("div",{children:[H.jsx("div",{className:"font-bold text-purple-600",children:wt.duration}),H.jsx("div",{className:"text-xs text-gray-500",children:"Время"})]}),H.jsxs("div",{children:[H.jsxs("div",{className:"font-bold text-orange-600",children:[(wt.distance/Number.parseFloat(wt.duration)*60).toFixed(1)," ","км/ч"]}),H.jsx("div",{className:"text-xs text-gray-500",children:"Скорость"})]})]}),H.jsxs("div",{className:"flex justify-between items-center",children:[H.jsxs("div",{className:"flex gap-2",children:[H.jsx("span",{className:"bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full",children:"Эко-поездка"}),wt.distance>5&&H.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:"Длинная"})]}),H.jsx(ts,{variant:"ghost",size:"sm",className:"text-blue-600 p-0 h-auto",children:"Поделиться →"})]})]})},wt.id))})]},Se)})}),H.jsx("div",{className:"px-4 pb-6",children:H.jsx(Bi,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200",children:H.jsxs(ji,{className:"p-4",children:[H.jsxs("h4",{className:"font-semibold text-blue-800 mb-2 flex items-center",children:[H.jsx(mS,{className:"w-5 h-5 mr-2"}),"Telegram Бот"]}),H.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"Получайте уведомления о новых достижениях и еженедельные отчеты прямо в Telegram!"}),H.jsx(ts,{className:"w-full bg-blue-500 text-white",onClick:()=>{},children:"Подписаться на бота"})]})})})]})}const j_=Fe.forwardRef(({className:_,type:b,...I},z)=>H.jsx("input",{type:b,className:od("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",_),ref:z,...I}));j_.displayName="Input";var KN="Label",uA=Fe.forwardRef((_,b)=>H.jsx(hh.label,{..._,ref:b,onMouseDown:I=>{I.target.closest("button, input, select, textarea")||(_.onMouseDown?.(I),!I.defaultPrevented&&I.detail>1&&I.preventDefault())}}));uA.displayName=KN;var hA=uA;const JN=nS("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),V_=Fe.forwardRef(({className:_,...b},I)=>H.jsx(hA,{ref:I,className:od(JN(),_),...b}));V_.displayName=hA.displayName;function QN({setCurrentView:_}){const[b,I]=Fe.useState("stars"),[z]=Fe.useState(!1),B=async()=>{_("active-ride")},$=20;return H.jsxs("div",{className:"p-4 space-y-6 h-full overflow-y-auto",children:[H.jsxs("div",{className:"flex items-center gap-3",children:[H.jsx(ts,{variant:"ghost",size:"icon",onClick:()=>_("start"),children:H.jsx(wz,{className:"h-5 w-5"})}),H.jsx("h1",{className:"text-xl font-semibold",children:"Payment"})]}),H.jsxs("div",{className:"space-y-4",children:[H.jsx("h2",{className:"text-lg font-semibold",children:"Order Summary"}),H.jsxs("div",{className:"space-y-3",children:[H.jsxs("div",{className:"flex justify-between",children:[H.jsx("span",{children:"Scooter E-Bike Unit-05"}),H.jsx("span",{className:"font-semibold",children:"15 ₽/min"})]}),H.jsxs("div",{className:"flex justify-between",children:[H.jsx("span",{className:"text-gray-600",children:"Unlock fee"}),H.jsxs("span",{children:[$," ₽"]})]}),H.jsxs("div",{className:"flex justify-between border-t pt-3",children:[H.jsx("span",{className:"font-semibold",children:"Initial charge"}),H.jsxs("span",{className:"font-semibold text-blue-600",children:[$," ₽"]})]})]}),H.jsx("p",{className:"text-xs text-gray-500",children:"* Actual cost will be calculated based on trip duration"})]}),H.jsxs("div",{className:"space-y-4",children:[H.jsx("h3",{className:"text-lg font-semibold",children:"Payment Method"}),H.jsx(Bi,{className:`cursor-pointer transition-colors ${b==="stars"?"ring-2 ring-blue-600 bg-blue-50":""}`,onClick:()=>I("stars"),children:H.jsxs(ji,{className:"p-4 flex items-center justify-between",children:[H.jsxs("div",{className:"flex items-center gap-3",children:[H.jsx("div",{className:"w-10 h-10 bg-yellow-500 rounded-full flex items-center justify-center",children:H.jsx($2,{className:"h-5 w-5 text-white fill-white"})}),H.jsxs("div",{children:[H.jsx("div",{className:"font-semibold",children:"Telegram Stars"}),H.jsx("div",{className:"text-sm text-gray-600",children:"Fast and secure"})]})]}),H.jsxs("div",{className:"flex items-center gap-1",children:[H.jsx($2,{className:"h-4 w-4 text-yellow-500 fill-yellow-500"}),H.jsx("span",{className:"font-semibold",children:"20"})]})]})}),H.jsx(Bi,{className:`cursor-pointer transition-colors ${b==="card"?"ring-2 ring-blue-600 bg-blue-50":""}`,onClick:()=>I("card"),children:H.jsxs(ji,{className:"p-4 flex items-center gap-3",children:[H.jsx("div",{className:"w-10 h-10 bg-gray-600 rounded-full flex items-center justify-center",children:H.jsx(Rz,{className:"h-5 w-5 text-white"})}),H.jsxs("div",{children:[H.jsx("div",{className:"font-semibold",children:"Bank Card"}),H.jsx("div",{className:"text-sm text-gray-600",children:"Visa, MasterCard"})]})]})}),b==="card"&&H.jsxs("div",{className:"space-y-4 pt-4",children:[H.jsxs("div",{children:[H.jsx(V_,{htmlFor:"cardNumber",children:"Card Number"}),H.jsx(j_,{id:"cardNumber",placeholder:"1234 5678 9012 3456",className:"mt-1"})]}),H.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[H.jsxs("div",{children:[H.jsx(V_,{htmlFor:"expiry",children:"Expiry Date"}),H.jsx(j_,{id:"expiry",placeholder:"MM/YY",className:"mt-1"})]}),H.jsxs("div",{children:[H.jsx(V_,{htmlFor:"cvv",children:"CVV"}),H.jsx(j_,{id:"cvv",placeholder:"123",className:"mt-1"})]})]})]})]}),H.jsx(ts,{className:"w-full bg-green-600 hover:bg-green-700",size:"lg",onClick:B,disabled:z,children:z?"Processing...":b==="stars"?"Pay ⭐ 20 Stars and Start":`Pay ${$} ₽ and Start`})]})}function eB({setCurrentView:_,rental:b}){const[I,z]=Fe.useState(0),[B,$]=Fe.useState(20);Fe.useEffect(()=>{const be=setInterval(()=>{if(b?.startTime){const Se=Math.floor((Date.now()-b.startTime.getTime())/1e3);z(Se);const Me=Math.floor(Se/60),tt=(b.scooter?.unlockFee||20)+Me*(b.scooter?.pricePerMin||15);$(tt)}},1e3);return()=>clearInterval(be)},[b]);const re=be=>{const Se=Math.floor(be/60),Me=be%60;return`${Se.toString().padStart(2,"0")}:${Me.toString().padStart(2,"0")}`},s=()=>{_("start")},ce=()=>{_("start")};return H.jsxs("div",{className:"p-4 space-y-6 h-full",children:[H.jsxs("div",{className:"text-center",children:[H.jsx("div",{className:"w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-3",children:H.jsx(ck,{className:"h-8 w-8 text-white"})}),H.jsx("h1",{className:"text-2xl font-bold text-green-600",children:"Rental Active"}),H.jsx("p",{className:"text-gray-600",children:"Enjoy your ride!"})]}),H.jsx(Bi,{className:"bg-gray-50",children:H.jsx(ji,{className:"p-6 text-center",children:H.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[H.jsxs("div",{children:[H.jsx(U_,{className:"h-8 w-8 text-blue-600 mx-auto mb-2"}),H.jsx("div",{className:"text-3xl font-bold",children:re(I)}),H.jsx("div",{className:"text-sm text-gray-600",children:"Duration"})]}),H.jsxs("div",{children:[H.jsx("div",{className:"w-8 h-8 mx-auto mb-2 text-green-600 text-2xl",children:"₽"}),H.jsx("div",{className:"text-3xl font-bold text-green-600",children:B}),H.jsx("div",{className:"text-sm text-gray-600",children:"Current Cost"})]})]})})}),H.jsx(Bi,{children:H.jsx(ji,{className:"p-4",children:H.jsxs("div",{className:"flex items-center justify-between",children:[H.jsxs("div",{children:[H.jsx("h3",{className:"font-semibold",children:b?.scooter?.name||"E-Bike Unit-05"}),H.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[H.jsx(Ux,{className:"h-4 w-4"}),H.jsx("span",{children:"Currently riding"})]})]}),H.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center",children:H.jsx("div",{className:"w-6 h-6 bg-white rounded"})})]})})}),H.jsxs("div",{className:"space-y-3",children:[H.jsxs(ts,{variant:"outline",className:"w-full bg-transparent",size:"lg",onClick:ce,children:[H.jsx(gS,{className:"h-5 w-5 mr-2"}),"Pause Rental"]}),H.jsxs(ts,{className:"w-full bg-red-600 hover:bg-red-700",size:"lg",onClick:s,children:[H.jsx(Qz,{className:"h-5 w-5 mr-2"}),"End Rental"]})]}),H.jsx(Bi,{className:"bg-yellow-50 border-yellow-200",children:H.jsxs(ji,{className:"p-4",children:[H.jsx("h4",{className:"font-semibold text-yellow-800 mb-2",children:"Safety Reminder"}),H.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[H.jsx("li",{children:"• Always wear a helmet"}),H.jsx("li",{children:"• Follow traffic rules"}),H.jsx("li",{children:"• Park in designated areas"}),H.jsx("li",{children:"• End rental when finished"})]})]})})]})}function tB({open:_,setOpen:b,view:I,setView:z}){return H.jsxs(UN,{trigger:H.jsx(H.Fragment,{}),open:_,setOpen:b,children:[I==="start"&&H.jsx($N,{setCurrentView:z}),I==="payment"&&H.jsx(QN,{setCurrentView:z}),I==="active-ride"&&H.jsx(eB,{rental:{startTime:new Date},setCurrentView:z}),I==="eco"&&H.jsx(ZN,{setCurrentView:z}),I==="history"&&H.jsx(YN,{}),I==="wallet"&&H.jsx(XN,{walletBalance:1200,paymentHistory:[]})]})}function rB({zoomMap:_,zoomOutMap:b}){return H.jsxs("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 flex flex-col -space-y-[1px]",children:[H.jsx("button",{onClick:_,className:"w-12 h-12 bg-white rounded-2xl rounded-b-none shadow-lg flex items-center justify-center text-gray-700 hover:bg-gray-50 active:scale-95",children:H.jsx(_S,{className:"size-6"})}),H.jsx("button",{onClick:b,className:"w-12 h-12 bg-white rounded-2xl rounded-t-none shadow-lg flex items-center justify-center text-gray-700 hover:bg-gray-50 active:scale-95",children:H.jsx(Uz,{className:"size-6"})})]})}function nB({startScanning:_,handleGeolocate:b}){return H.jsxs("div",{className:"relative w-full flex justify-center gap-6 items-center flex-col z-1",children:[H.jsx("div",{className:"bg-white px-4 py-2 rounded-full shadow-lg",children:H.jsx("span",{className:"text-md font-medium",children:"10 рядом"})}),H.jsxs("div",{className:"flex gap-2",children:[H.jsxs("button",{onClick:()=>{_()},className:"bg-[var(--tg-theme-button-color)] text-white px-6 py-3 h-14 rounded-full flex items-center gap-3 font-medium text-lg shadow-lg active:scale-95 transition-all text-nowrap",children:[H.jsx($x,{className:"size-6"}),"Сканировать QR-код"]}),H.jsx("button",{onClick:b,className:"absolute right-4 mt-1 bg-white flex size-12 items-center justify-center rounded-full shadow-lg",children:H.jsx(gS,{className:"size-6"})})]})]})}const rm=()=>{const[,_]=Fe.useState(""),[b,I]=Fe.useState(""),z=Fe.useRef(null),B=zO(),{zoomMap:$,zoomOutMap:re,handleGeolocate:s,position:ce}=B,[be,Se]=Fe.useState(null),[Me,tt]=Fe.useState(!1),wt=Ag(),Xt=Bx();let Be="start";wt.pathname==="/eco"?Be="eco":wt.pathname==="/history"?Be="history":wt.pathname==="/wallet"?Be="wallet":wt.pathname==="/payment"?Be="payment":wt.pathname==="/active-ride"?Be="active-ride":Be="start",Fe.useEffect(()=>{if(C_.mount.isAvailable()&&C_.mount(),C_.bindCssVars.isAvailable()&&C_.bindCssVars(),window.Telegram?.WebApp){const Vt=window.Telegram.WebApp;Vt.ready(),Vt.expand();const jt=Vt.themeParams;if(jt){const vr=document.documentElement;Object.entries(jt).forEach(([hr,Kt])=>{Kt&&vr.style.setProperty(`--tg-theme-${hr.replace(/_/g,"-")}`,Kt)})}}async function Dt(){t0("web_app_request_fullscreen")}return ia("visibility_changed",Dt),setTimeout(()=>{Dt()},500),()=>{z.current&&z.current.stop()}},[]);const ct=Dt=>{Se(Dt),tt(!0),Xt("/start")},Tt=async()=>{try{I(""),_(""),z.current=await mD();try{const Dt=await z.current.open({text:"Сканируйте QR-код"});_(Dt.data||Dt),window.Telegram?.WebApp&&window.Telegram.WebApp.showAlert(`QR Code: ${Dt.data||Dt}`)}catch(Dt){console.error("Ошибка сканирования:",Dt),I(`Ошибка сканирования: ${Dt instanceof Error?Dt.message:"Неизвестная ошибка"}`)}}catch(Dt){const Vt=Dt instanceof Error?Dt.message:"Unknown error";I(`Ошибка инициализации сканера: ${Vt}`)}};return H.jsxs("div",{className:"flex flex-col items-end justify-end w-full h-full gap-4 pb-4",children:[H.jsx("div",{className:"text-red-500 absolute top-0 left-0 z-1",children:b}),H.jsx("div",{className:"absolute top-0 left-0 w-dvw h-[calc(100dvh+10dvh)] z-0",children:H.jsx(kO,{onMarkerClick:ct,mapRef:B.mapRef,mapContainer:B.mapContainer,markersRef:B.markersRef,handleGeolocate:s,position:ce})}),H.jsx(tB,{view:Be,setView:Dt=>Xt(`/${Dt}`),marker:be,open:Me,setOpen:tt}),H.jsx(rB,{zoomMap:$,zoomOutMap:re}),H.jsx(nB,{startScanning:Tt,handleGeolocate:s})]})};function dA({children:_}){const[b,I]=Fe.useState({top:0});return Fe.useEffect(()=>{function z(){window.Telegram?.WebApp?.safeAreaInset&&I({top:window.Telegram.WebApp.safeAreaInset.top+40})}return z(),window.Telegram?.WebApp?.onEvent?.("safeAreaChanged",z),()=>{window.Telegram?.WebApp?.offEvent?.("safeAreaChanged",z)}},[]),H.jsx("div",{className:"flex flex-col w-full overflow-y-auto h-full",style:{paddingTop:b.top},children:_})}function iB(){const _=[{id:1,name:"First Ride",description:"Completed",icon:Hz,color:"bg-yellow-100 border-yellow-300",earned:!0},{id:2,name:"Eco Warrior",description:"5kg CO₂ saved",icon:Vv,color:"bg-green-100 border-green-300",earned:!0},{id:3,name:"Explorer",description:"10+ locations",icon:Ux,color:"bg-blue-100 border-blue-300",earned:!0},{id:4,name:"VIP Rider",description:"50 rides",icon:kz,color:"bg-purple-100 border-purple-300",earned:!1}],b=()=>{typeof window<"u"&&window.Telegram&&window.Telegram.WebApp&&typeof window.Telegram.WebApp.shareToStory=="function"?window.Telegram.WebApp.shareToStory("./images/scooter-light.png",{text:"I saved 5.2kg CO₂ with @jetshr! 🌱 Join me in making cities greener! 🛴"}):alert("Sharing to Telegram Stories is only available in Telegram app.")},I=()=>{const z=`Join jetshr and get ₽50 bonus! Use my code: JETSHR24

https://t.me/jetshr_bot?start=JETSHR24`;navigator.share?navigator.share({title:"Join jetshr",text:z}):(navigator.clipboard.writeText(z),typeof window<"u"&&window.Telegram&&window.Telegram.WebApp&&typeof window.Telegram.WebApp.showAlert=="function"?window.Telegram.WebApp.showAlert("Referral code copied to clipboard!"):alert("Referral code copied to clipboard!"))};return H.jsx(dA,{children:H.jsxs("div",{className:"p-4 space-y-6 h-full overflow-y-auto w-full",children:[H.jsxs("div",{className:"flex items-center gap-4",children:[H.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center",children:H.jsx("span",{className:"text-white font-bold text-xl",children:"JD"})}),H.jsxs("div",{children:[H.jsx("h1",{className:"text-xl font-semibold",children:"John Doe"}),H.jsx("p",{className:"text-gray-600",children:"+7 (999) 123-45-67"})]})]}),H.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[H.jsxs("div",{children:[H.jsx("div",{className:"text-2xl font-bold text-blue-600",children:"24"}),H.jsx("div",{className:"text-sm text-gray-600",children:"Total Rides"})]}),H.jsxs("div",{children:[H.jsx("div",{className:"text-2xl font-bold text-green-600",children:"5.2kg"}),H.jsx("div",{className:"text-sm text-gray-600",children:"CO₂ Saved"})]}),H.jsxs("div",{children:[H.jsx("div",{className:"text-2xl font-bold text-purple-600",children:"18.5km"}),H.jsx("div",{className:"text-sm text-gray-600",children:"Distance"})]})]}),H.jsx(Bi,{className:"bg-gradient-to-r from-green-400 to-blue-500 text-white",children:H.jsxs(ji,{className:"p-6",children:[H.jsxs("div",{className:"flex items-start justify-between mb-4",children:[H.jsxs("div",{className:"flex items-center gap-2",children:[H.jsx(Vv,{className:"h-6 w-6"}),H.jsx("span",{className:"font-semibold",children:"Eco Impact"})]}),H.jsx(ts,{variant:"ghost",size:"icon",className:"text-white hover:bg-white/20",onClick:b,children:H.jsx(jv,{className:"h-5 w-5"})})]}),H.jsxs("div",{className:"mb-4",children:[H.jsx("div",{className:"text-3xl font-bold mb-1",children:"5.2 kg CO₂"}),H.jsx("div",{className:"text-green-100",children:"Carbon emissions saved"})]}),H.jsxs("div",{className:"bg-white/20 rounded-lg p-3 mb-4",children:[H.jsx("div",{className:"text-sm font-medium mb-1",children:"Environmental Impact"}),H.jsxs("div",{className:"flex items-center gap-2",children:[H.jsx("span",{children:"Equivalent to planting"}),H.jsx(Vv,{className:"h-4 w-4"}),H.jsx("span",{className:"font-semibold",children:"10 trees"})]})]}),H.jsx(ts,{className:"w-full bg-white text-green-600 hover:bg-gray-100",onClick:b,children:"Share to Telegram Stories"})]})}),H.jsxs("div",{className:"space-y-4",children:[H.jsxs("div",{className:"flex items-center gap-2",children:[H.jsx(rk,{className:"h-5 w-5 text-yellow-600"}),H.jsx("h2",{className:"text-lg font-semibold",children:"Achievements"})]}),H.jsx("div",{className:"grid grid-cols-2 gap-3",children:_.map(z=>{const B=z.icon;return H.jsx(Bi,{className:`${z.color} ${z.earned?"":"opacity-50"}`,children:H.jsxs(ji,{className:"p-4 text-center",children:[H.jsx(B,{className:"h-8 w-8 mx-auto mb-2"}),H.jsx("div",{className:"font-semibold text-sm",children:z.name}),H.jsx("div",{className:"text-xs text-gray-600",children:z.description})]})},z.id)})})]}),H.jsxs("div",{className:"space-y-4",children:[H.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[H.jsx(jv,{className:"h-5 w-5 text-blue-600"}),"Invite Friends"]}),H.jsx(Bi,{className:"bg-gray-50",children:H.jsxs(ji,{className:"p-4 text-center",children:[H.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Your referral code"}),H.jsx("div",{className:"text-2xl font-bold text-blue-600 mb-2",children:"JETSHR24"}),H.jsx("div",{className:"text-sm text-gray-600 mb-4",children:"Share and get ₽50 bonus for each friend who joins!"}),H.jsxs(ts,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:I,children:[H.jsx(jv,{className:"h-4 w-4 mr-2"}),"Share Referral Code"]})]})})]})]})})}const sB=[{id:1,route:"Красная площадь → Парк Горького",date:"2024-07-01",time:"14:30",duration:"12 min",cost:"200 ₽",co2Saved:"0.3 kg CO₂"},{id:2,route:"Арбат → Кропоткинская",date:"2024-06-30",time:"18:45",duration:"8 min",cost:"140 ₽",co2Saved:"0.2 kg CO₂"},{id:3,route:"Новокузнецкая → Сокольники",date:"2024-06-29",time:"12:15",duration:"15 min",cost:"245 ₽",co2Saved:"0.4 kg CO₂"},{id:4,route:"Тверская → Пушкинская",date:"2024-06-28",time:"16:20",duration:"6 min",cost:"110 ₽",co2Saved:"0.1 kg CO₂"}];function oB(){return H.jsx(dA,{children:H.jsxs("div",{className:"p-4 space-y-6 h-full overflow-y-auto w-full",children:[H.jsxs("div",{children:[H.jsx("h1",{className:"text-2xl font-bold",children:"Trip History"}),H.jsx("p",{className:"text-gray-600",children:"View your recent rides"})]}),H.jsx(Bi,{className:"bg-gray-50",children:H.jsxs(ji,{className:"p-4",children:[H.jsx("h2",{className:"font-semibold mb-4",children:"This Month"}),H.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[H.jsxs("div",{children:[H.jsx("div",{className:"text-2xl font-bold text-blue-600",children:"4"}),H.jsx("div",{className:"text-sm text-gray-600",children:"Trips"})]}),H.jsxs("div",{children:[H.jsx("div",{className:"text-2xl font-bold text-green-600",children:"1.0kg"}),H.jsx("div",{className:"text-sm text-gray-600",children:"CO₂ Saved"})]}),H.jsxs("div",{children:[H.jsx("div",{className:"text-2xl font-bold text-purple-600",children:"7.7km"}),H.jsx("div",{className:"text-sm text-gray-600",children:"Distance"})]})]})]})}),H.jsx("div",{className:"space-y-3",children:sB.map(_=>H.jsx(Bi,{className:"cursor-pointer hover:shadow-md transition-shadow",children:H.jsx(ji,{className:"p-4",children:H.jsxs("div",{className:"flex items-start justify-between",children:[H.jsxs("div",{className:"flex-1",children:[H.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[H.jsx(Ux,{className:"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0"}),H.jsx("span",{className:"font-medium text-sm",children:_.route})]}),H.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-600",children:[H.jsxs("div",{className:"flex items-center gap-1",children:[H.jsx(U_,{className:"h-3 w-3"}),H.jsxs("span",{children:[_.date," • ",_.time]})]}),H.jsxs("div",{className:"flex items-center gap-1",children:[H.jsx(K_,{className:"h-3 w-3 text-green-600"}),H.jsx("span",{children:_.co2Saved})]})]})]}),H.jsxs("div",{className:"text-right flex items-center gap-2",children:[H.jsxs("div",{children:[H.jsx("div",{className:"font-semibold",children:_.cost}),H.jsx("div",{className:"text-xs text-gray-600",children:_.duration})]}),H.jsx(Sz,{className:"h-4 w-4 text-gray-400"})]})]})})},_.id))})]})})}const aB=()=>H.jsxs("div",{className:"h-dvh flex flex-col gap-0",children:[H.jsx("div",{className:"relative overflow-hidden flex-1",children:H.jsxs(bR,{children:[H.jsx(ch,{path:"/",element:H.jsx(rm,{}),index:!0}),H.jsx(ch,{path:"/start",element:H.jsx(rm,{})}),H.jsx(ch,{path:"/eco",element:H.jsx(rm,{})}),H.jsx(ch,{path:"/wallet",element:H.jsx(rm,{})}),H.jsx(ch,{path:"/payment",element:H.jsx(rm,{})}),H.jsx(ch,{path:"/active-ride",element:H.jsx(rm,{})}),H.jsx(ch,{path:"/profile",element:H.jsx(iB,{})}),H.jsx(ch,{path:"/history",element:H.jsx(oB,{})}),H.jsx(ch,{path:"*",element:H.jsx(xR,{to:"/"})})]})}),H.jsx(hk,{})]});PP.createRoot(document.getElementById("root")).render(H.jsx(Nr.StrictMode,{children:H.jsx(ER,{children:H.jsx(aB,{})})}));
//# sourceMappingURL=index-D3ClffgU.js.map
